(self.webpackChunkfe_blog=self.webpackChunkfe_blog||[]).push([[179],{8901:(ut,Ue,re)=>{"use strict";re.d(Ue,{TY:()=>Xe,_v:()=>ht,he:()=>nt,pV:()=>Ge,w5:()=>at,x4:()=>Ke,z2:()=>Ye});var S=re(4221);const Ke=(0,S.PH)("[auth page] login start",(0,S.Ky)()),nt=(0,S.PH)("[auth page] login Success",(0,S.Ky)()),Ye=(0,S.PH)("[Registration] Register",(0,S.Ky)()),Ge=(0,S.PH)("[Registration] Register Success",(0,S.Ky)()),Xe=(0,S.PH)("[Registration] Register Failure",(0,S.Ky)()),at=(0,S.PH)("[auth page] auto login"),ht=(0,S.PH)("[auth page] logout")},8939:(ut,Ue,re)=>{"use strict";re.r(Ue),re.d(Ue,{UserModule:()=>dn});var S=re(6814),Re=re(95),K=re(8901),l=re(5879),ge=re(4221),Ke=re(4382);function nt(St,Bn){1&St&&(l.TgZ(0,"span",12),l._uU(1," Email is required."),l.qZA())}function Ye(St,Bn){1&St&&(l.TgZ(0,"span",12),l._uU(1," Email not valid."),l.qZA())}function Ge(St,Bn){1&St&&(l.TgZ(0,"span",12),l._uU(1," Username is required."),l.qZA())}function Xe(St,Bn){1&St&&(l.TgZ(0,"div",12),l._uU(1," Username must be at least 4 characters long. "),l.qZA())}let at=(()=>{var St;class Bn{constructor(kn,Dn){this.store=kn,this.router=Dn,this.emailForm=new Re.cw({username:new Re.NI("",[Re.kI.required,Re.kI.minLength(4)]),email:new Re.NI("",[Re.kI.required,Re.kI.email]),password:new Re.NI("",[Re.kI.required,Re.kI.minLength(4)])})}OnInit(){}onSubmit(){this.emailForm.valid&&(this.store.dispatch((0,K.z2)({userData:{username:this.emailForm.value.username,email:this.emailForm.value.email,password:this.emailForm.value.password}})),this.router.navigate(["/login"]),this.emailForm.reset())}}return(St=Bn).\u0275fac=function(kn){return new(kn||St)(l.Y36(ge.yh),l.Y36(Ke.F0))},St.\u0275cmp=l.Xpm({type:St,selectors:[["app-register"]],decls:22,vars:6,consts:[[1,"container","center-form"],[1,"row"],[1,"col-md-12"],[1,"custom-form",3,"formGroup","ngSubmit"],[1,"mb-3"],["for","exampleInputEmail1",1,"form-label"],["type","email","id","exampleInputEmail1","aria-describedby","emailHelp","formControlName","email",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["type","username","aria-describedby","username","formControlName","username",1,"form-control"],["for","exampleInputPassword1",1,"form-label"],["type","password","id","exampleInputPassword1","formControlName","password",1,"form-control"],["type","submit",1,"btn","btn-primary","custom-btn-primary",3,"disabled"],[1,"invalid-feedback"]],template:function(kn,Dn){if(1&kn&&(l.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),l.NdJ("ngSubmit",function(){return Dn.onSubmit()}),l.TgZ(4,"div",4)(5,"label",5),l._uU(6,"Email address"),l.qZA(),l._UZ(7,"input",6),l.YNc(8,nt,2,0,"span",7),l.YNc(9,Ye,2,0,"span",7),l.qZA(),l.TgZ(10,"div",4)(11,"label",5),l._uU(12,"Username "),l.qZA(),l._UZ(13,"input",8),l.YNc(14,Ge,2,0,"span",7),l.YNc(15,Xe,2,0,"div",7),l.qZA(),l.TgZ(16,"div",4)(17,"label",9),l._uU(18,"Password"),l.qZA(),l._UZ(19,"input",10),l.qZA(),l.TgZ(20,"button",11),l._uU(21," Submit "),l.qZA()()()()()),2&kn){let ft,Ze,Xt,Pt;l.xp6(3),l.Q6J("formGroup",Dn.emailForm),l.xp6(5),l.Q6J("ngIf",(null==(ft=Dn.emailForm.get("email"))?null:ft.hasError("required"))&&(null==(ft=Dn.emailForm.get("email"))?null:ft.touched)),l.xp6(1),l.Q6J("ngIf",(null==(Ze=Dn.emailForm.get("email"))?null:Ze.hasError("email"))&&(null==(Ze=Dn.emailForm.get("email"))?null:Ze.touched)),l.xp6(5),l.Q6J("ngIf",(null==(Xt=Dn.emailForm.get("username"))?null:Xt.hasError("required"))&&(null==(Xt=Dn.emailForm.get("username"))?null:Xt.touched)),l.xp6(1),l.Q6J("ngIf",((null==(Pt=Dn.emailForm.get("username"))?null:Pt.hasError("minlength"))||(null==(Pt=Dn.emailForm.get("username"))?null:Pt.hasError("required")))&&(null==(Pt=Dn.emailForm.get("username"))?null:Pt.touched)),l.xp6(5),l.Q6J("disabled",!Dn.emailForm.valid)}},dependencies:[S.O5,Re._Y,Re.Fj,Re.JJ,Re.JL,Re.sg,Re.u],styles:[".btn-primary[_ngcontent-%COMP%], .custom-form[_ngcontent-%COMP%]   .custom-btn-primary[_ngcontent-%COMP%]{background-color:#333d51;border:none;font-size:13px;width:80px;line-height:24px}.center-form[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh}.custom-form[_ngcontent-%COMP%]{border:1px solid #cbd0d8;padding:20px;background:#cbd0d8;border-radius:10px;width:320px}.custom-form[_ngcontent-%COMP%]   .invalid-feedback[_ngcontent-%COMP%]{display:block}"]}),Bn})(),ht=(()=>{var St;class Bn{constructor(kn){this.store=kn,this.loginForm=new Re.cw({email:new Re.NI("",[Re.kI.required,Re.kI.email]),password:new Re.NI("",[Re.kI.required])})}onSubmit(){this.loginForm.valid&&(this.store.dispatch(K.x4({email:this.loginForm.value.email||"",password:this.loginForm.value.password||""})),this.loginForm.reset())}}return(St=Bn).\u0275fac=function(kn){return new(kn||St)(l.Y36(ge.yh))},St.\u0275cmp=l.Xpm({type:St,selectors:[["app-login"]],decls:14,vars:1,consts:[[1,"container","center-form"],[1,"row"],[1,"col-md-12"],[1,"custom-form",3,"formGroup"],[1,"mb-3"],["for","exampleInputEmail1",1,"form-label"],["type","email","id","exampleInputEmail1","formControlName","email",1,"form-control"],["for","exampleInputPassword1",1,"form-label"],["type","password","id","exampleInputPassword1","formControlName","password",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(kn,Dn){1&kn&&(l.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3)(4,"div",4)(5,"label",5),l._uU(6,"Email address"),l.qZA(),l._UZ(7,"input",6),l.qZA(),l.TgZ(8,"div",4)(9,"label",7),l._uU(10,"Password"),l.qZA(),l._UZ(11,"input",8),l.qZA(),l.TgZ(12,"button",9),l.NdJ("click",function(){return Dn.onSubmit()}),l._uU(13," Submit "),l.qZA()()()()()),2&kn&&(l.xp6(3),l.Q6J("formGroup",Dn.loginForm))},dependencies:[Re._Y,Re.Fj,Re.JJ,Re.JL,Re.sg,Re.u],styles:[".btn-primary[_ngcontent-%COMP%], .custom-form[_ngcontent-%COMP%]   .custom-btn-primary[_ngcontent-%COMP%]{background-color:#333d51;border:none;font-size:13px;width:80px;line-height:24px}.center-form[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh}.custom-form[_ngcontent-%COMP%]{border:1px solid #cbd0d8;padding:20px;background:#cbd0d8;border-radius:10px;width:320px}.custom-form[_ngcontent-%COMP%]   .invalid-feedback[_ngcontent-%COMP%]{display:block}"]}),Bn})();var Bt=re(9862);const zt=[{path:"",children:[{path:"login",component:ht},{path:"register",component:at}]}];let dn=(()=>{var St;class Bn{}return(St=Bn).\u0275fac=function(kn){return new(kn||St)},St.\u0275mod=l.oAB({type:St}),St.\u0275inj=l.cJS({imports:[S.ez,Re.u5,Re.UX,Bt.JF,Ke.Bz.forChild(zt)]}),Bn})()},2101:(ut,Ue,re)=>{"use strict";var S=re(6593),Re=re(4382),K=re(5879),l=re(4221);const ge=(0,l.ZF)("blogs"),Ke=(0,l.P1)(ge,E=>E.blogs),nt=(0,l.P1)(ge,E=>E.loading),Ye=(0,l.P1)(ge,E=>E.error),Xe_apiUrl=((0,l.P1)(Ke,E=>{const h=localStorage.getItem("userId");return h?E.filter(v=>v.userId===h):[]}),"https://erin-awful-turkey.cyclic.cloud");class at{constructor(h,v,_,T){this.username=h,this.token=v,this.userId=_,this.expiresIn=T}get expireDate(){return this.expiresIn}get userToken(){return this.token}}var ht=re(9862);let Bt=(()=>{var E;class h{constructor(_){this.http=_,this.apiUrl=Xe_apiUrl}login(_,T){return this.http.post(`${this.apiUrl}/login`,{email:_,password:T})}register(_){return this.http.post(`${this.apiUrl}/register`,_)}formatUser(_){const T=new Date((new Date).getTime()+1e3*+_.expiresIn);return new at(_.username,_.token,_.userId,T)}runTimeoutInterval(_){const T=(new Date).getTime(),te=_.expireDate.getTime()-T;this.timeoutInterval=setTimeout(()=>{},te)}setUserInLocalStorage(_){localStorage.setItem("userData",JSON.stringify(_)),this.runTimeoutInterval(_)}getUserFromLocalStorage(){const _=localStorage.getItem("userData");if(_){const T=JSON.parse(_),V=new Date(T.expirationDate),te=new at(T.username,T.token,T.userId,V);return this.runTimeoutInterval(te),te}return null}getUserId(){const _=localStorage.getItem("userData");return _?JSON.parse(_).userId:null}logout(){localStorage.removeItem("userData"),this.timeoutInterval&&(clearTimeout(this.timeoutInterval),this.timeoutInterval=null)}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(ht.eN))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})();var zt=re(6814);function dn(E,h){if(1&E){const v=K.EpF();K.TgZ(0,"div")(1,"button",9),K.NdJ("click",function(){K.CHM(v);const T=K.oxw().$implicit,V=K.oxw();return K.KtG(V.goToEditPage(T._id))}),K._uU(2," Edit "),K.qZA()()}}function St(E,h){if(1&E&&(K.TgZ(0,"div",4)(1,"div",5)(2,"h5",6),K._uU(3),K.qZA(),K.TgZ(4,"p",7),K._uU(5),K.qZA()(),K.YNc(6,dn,3,0,"div",8),K.qZA()),2&E){const v=h.$implicit,_=K.oxw();K.xp6(3),K.Oqu(v.title),K.xp6(2),K.Oqu(v.content),K.xp6(1),K.Q6J("ngIf",v.userId==_.userId)}}let Bn=(()=>{var E;class h{constructor(_,T,V){this.store=_,this.router=T,this.userService=V,this.blogs$=this.store.select(Ke),this.loading$=this.store.select(nt),this.error$=this.store.select(Ye),this.userId=this.userService.getUserId()}ngOnInit(){}goToEditPage(_){console.log(_),this.router.navigate(["/posts/"+_])}}return(E=h).\u0275fac=function(_){return new(_||E)(K.Y36(l.yh),K.Y36(Re.F0),K.Y36(Bt))},E.\u0275cmp=K.Xpm({type:E,selectors:[["app-blogs"]],decls:5,vars:3,consts:[[1,"container"],[1,"row"],[1,"col","d-flex","justify-content-center","flex-wrap"],["class","card m-2","style","width: 18rem",4,"ngFor","ngForOf"],[1,"card","m-2",2,"width","18rem"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(_,T){1&_&&(K.TgZ(0,"div",0)(1,"div",1)(2,"div",2),K.YNc(3,St,7,3,"div",3),K.ALo(4,"async"),K.qZA()()()),2&_&&(K.xp6(3),K.Q6J("ngForOf",K.lcZ(4,1,T.blogs$)))},dependencies:[zt.sg,zt.O5,zt.Ov]}),h})(),Tn=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275cmp=K.Xpm({type:E,selectors:[["app-home"]],decls:1,vars:0,template:function(_,T){1&_&&K._UZ(0,"app-blogs")},dependencies:[Bn]}),h})();const kn=(0,l.PH)("[Blog] Add Blog",(0,l.Ky)()),Dn=(0,l.PH)("[Blog] Add Blog Success",(0,l.Ky)()),ft=(0,l.PH)("[Blog] Add Blog Failure",(0,l.Ky)());var Ze=re(95);let Xt=(()=>{var E;class h{constructor(_,T){this.store=_,this.router=T,this.addPost=new Ze.cw({title:new Ze.NI("",[Ze.kI.minLength(4)]),content:new Ze.NI("",[Ze.kI.minLength(4)])})}onSubmit(){if(this.addPost.valid){const _=this.addPost.get("title")?.value||"",T=this.addPost.get("content")?.value||"";this.store.dispatch(kn({title:_,content:T}))}else console.log("Form is not valid")}}return(E=h).\u0275fac=function(_){return new(_||E)(K.Y36(l.yh),K.Y36(Re.F0))},E.\u0275cmp=K.Xpm({type:E,selectors:[["app-add-blog"]],decls:14,vars:1,consts:[[1,"container","center-form"],[1,"row"],[1,"col-md-12"],[1,"custom-form",3,"formGroup"],[1,"mb-3"],[1,"form-label"],["type","email","id","exampleInputEmail1","formControlName","title",1,"form-control"],["type","text","id","exampleInputPassword1","formControlName","content",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(_,T){1&_&&(K.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3)(4,"div",4)(5,"label",5),K._uU(6,"Title"),K.qZA(),K._UZ(7,"input",6),K.qZA(),K.TgZ(8,"div",4)(9,"label",5),K._uU(10,"Content"),K.qZA(),K._UZ(11,"input",7),K.qZA(),K.TgZ(12,"button",8),K.NdJ("click",function(){return T.onSubmit()}),K._uU(13," Submit "),K.qZA()()()()()),2&_&&(K.xp6(3),K.Q6J("formGroup",T.addPost))},dependencies:[Ze._Y,Ze.Fj,Ze.JJ,Ze.JL,Ze.sg,Ze.u]}),h})();const Pt=(0,l.ZF)("getBlog"),qt=(0,l.P1)(Pt,E=>E),vn=(0,l.PH)("[Get Post] Get Post",(0,l.Ky)()),Ti=(0,l.PH)("[Get Post Success] Get Post Success",(0,l.Ky)()),Ei=(0,l.PH)("[Edit Post] Edit Post",(0,l.Ky)()),Li=(0,l.PH)("[Edit Post] Edit Post",(0,l.Ky)());function Mr(E,h){if(1&E){const v=K.EpF();K.TgZ(0,"div",2),K._UZ(1,"img",3),K.TgZ(2,"div",4)(3,"h5",5),K._uU(4),K.qZA(),K.TgZ(5,"p",6),K._uU(6),K.qZA(),K._UZ(7,"input",7),K.TgZ(8,"button",8),K.NdJ("click",function(){K.CHM(v);const T=K.oxw();return K.KtG(T.saveBlog())}),K._uU(9,"Save"),K.qZA()()()}if(2&E){const v=h.ngIf;K.xp6(1),K.Q6J("src","http://localhost:3000"+v.imageUrl,K.LSH),K.xp6(3),K.Oqu(v.title),K.xp6(2),K.Oqu(v.content),K.xp6(1),K.s9C("value",v.title)}}let hi=(()=>{var E;class h{constructor(_,T){this.store=_,this.route=T,this.blog$=this.store.select(qt)}ngOnInit(){const _=this.route.snapshot.paramMap.get("id");null!==_&&this.store.dispatch(vn({blogId:_}))}saveBlog(){this.store.dispatch(Ei({_id:"test",title:"test",content:"",imageUrl:""}))}}return(E=h).\u0275fac=function(_){return new(_||E)(K.Y36(l.yh),K.Y36(Re.gz))},E.\u0275cmp=K.Xpm({type:E,selectors:[["app-edit-blog"]],decls:3,vars:3,consts:[[1,"container","d-flex","justify-content-center"],["class","card","style","width: 18rem",4,"ngIf"],[1,"card",2,"width","18rem"],["alt","Blog Image",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["type","text",3,"value"],[1,"btn","btn-primary",3,"click"]],template:function(_,T){1&_&&(K.TgZ(0,"div",0),K.YNc(1,Mr,10,4,"div",1),K.ALo(2,"async"),K.qZA()),2&_&&(K.xp6(1),K.Q6J("ngIf",K.lcZ(2,1,T.blog$)))},dependencies:[zt.O5,zt.Ov]}),h})();var mr=re(7398);const ji=(0,l.ZF)("auth"),_t=((0,l.P1)(ji,E=>E),(0,l.P1)(ji,E=>!!E.user)),bn=((0,l.P1)(ji,E=>E),(0,l.P1)(ji,E=>E),(0,l.P1)(ji,E=>E),(0,l.P1)(ji,E=>E.user?E.user.userToken:null));let $t=(()=>{var E;class h{constructor(_,T){this.store=_,this.router=T}canActivate(){return this.store.select(_t).pipe((0,mr.U)(_=>!!_))}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(l.yh),K.LFG(Re.F0))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})();const Vt=(0,l.PH)("[Blog] Load Blogs"),Gt=(0,l.PH)("[Blog] Load Blogs Success",(0,l.Ky)()),zn=(0,l.PH)("[Blog] Load Blogs Failure",(0,l.Ky)());(0,l.PH)("[Blog] Load Blogs By User Id",(0,l.Ky)());let Ln=(()=>{var E;class h{constructor(_){this.store=_}resolve(){const _=localStorage.getItem("blogs");if(_){const T=JSON.parse(_);this.store.dispatch(Gt({blogs:T}))}else this.store.dispatch(Vt())}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(l.yh))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac}),h})();var ti=re(2574);const $i=[{path:"",redirectTo:"/map",pathMatch:"full"},{path:"home",component:Tn,canActivate:[$t],resolve:{blogs:Ln}},{path:"new-post",component:Xt,canActivate:[$t]},{path:"posts/:id",component:hi},{path:"map",component:(()=>{var E;class h{constructor(){}ngOnInit(){this.initializeMap()}initializeMap(){this.map=new ti.Map({accessToken:"pk.eyJ1IjoiZ29sZGd1biIsImEiOiJjbG0wbmN1djIxYnVvM2RwNjBjY2ZqdTJoIn0.IRn0RbczCcxZL0RKkO2Z2g",container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-74.5,40],zoom:9}),this.map.on("load",()=>{this.map.addLayer({id:"maptiler-layer",type:"raster",source:{type:"raster",tileSize:256},minzoom:0,maxzoom:22})})}}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275cmp=K.Xpm({type:E,selectors:[["app-map"]],decls:1,vars:0,consts:[["id","map",1,"match-parent"]],template:function(_,T){1&_&&K._UZ(0,"div",0)},styles:[".map_box_container[_ngcontent-%COMP%]{position:relative;height:100%!important;width:100%!important}#map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%}"]}),h})()},{path:"",loadChildren:()=>Promise.resolve().then(re.bind(re,8939)).then(E=>E.UserModule)}];let Gr=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({imports:[Re.Bz.forRoot($i),Re.Bz]}),h})();var vi=re(8901);class Zi{}class Do{}const Yr="*";function To(E,h=null){return{type:2,steps:E,options:h}}function ii(E){return{type:6,styles:E,offset:null}}function gi(E,h,v){return{type:0,name:E,styles:h,options:v}}class nr{constructor(h=0,v=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=h+v}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(h=>h()),this._onDoneFns=[])}onStart(h){this._originalOnStartFns.push(h),this._onStartFns.push(h)}onDone(h){this._originalOnDoneFns.push(h),this._onDoneFns.push(h)}onDestroy(h){this._onDestroyFns.push(h)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(h=>h()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(h=>h()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(h){this._position=this.totalTime?h*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(h){const v="start"==h?this._onStartFns:this._onDoneFns;v.forEach(_=>_()),v.length=0}}class xo{constructor(h){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=h;let v=0,_=0,T=0;const V=this.players.length;0==V?queueMicrotask(()=>this._onFinish()):this.players.forEach(te=>{te.onDone(()=>{++v==V&&this._onFinish()}),te.onDestroy(()=>{++_==V&&this._onDestroy()}),te.onStart(()=>{++T==V&&this._onStart()})}),this.totalTime=this.players.reduce((te,me)=>Math.max(te,me.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(h=>h()),this._onDoneFns=[])}init(){this.players.forEach(h=>h.init())}onStart(h){this._onStartFns.push(h)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(h=>h()),this._onStartFns=[])}onDone(h){this._onDoneFns.push(h)}onDestroy(h){this._onDestroyFns.push(h)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(h=>h.play())}pause(){this.players.forEach(h=>h.pause())}restart(){this.players.forEach(h=>h.restart())}finish(){this._onFinish(),this.players.forEach(h=>h.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(h=>h.destroy()),this._onDestroyFns.forEach(h=>h()),this._onDestroyFns=[])}reset(){this.players.forEach(h=>h.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(h){const v=h*this.totalTime;this.players.forEach(_=>{const T=_.totalTime?Math.min(1,v/_.totalTime):1;_.setPosition(T)})}getPosition(){const h=this.players.reduce((v,_)=>null===v||_.totalTime>v.totalTime?_:v,null);return null!=h?h.getPosition():0}beforeDestroy(){this.players.forEach(h=>{h.beforeDestroy&&h.beforeDestroy()})}triggerCallback(h){const v="start"==h?this._onStartFns:this._onDoneFns;v.forEach(_=>_()),v.length=0}}const Uo=function sr(E,h){return{type:7,name:E,definitions:h,options:{}}}("navbarAnimation",[gi("collapsed",ii({height:"0",opacity:"0"})),gi("expanded",ii({height:"*",opacity:"1"})),function Er(E,h,v=null){return{type:1,expr:E,animation:h,options:v}}("collapsed <=> expanded",function wr(E,h=null){return{type:4,styles:h,timings:E}}("300ms ease-in-out"))]);function Le(E,h){1&E&&(K.TgZ(0,"a",13),K._uU(1,"Blogs"),K.qZA())}function ce(E,h){1&E&&(K.TgZ(0,"a",14),K._uU(1,"New Post"),K.qZA())}function ue(E,h){1&E&&(K.TgZ(0,"li",7)(1,"a",15),K._uU(2,"Register"),K.qZA()())}function Se(E,h){1&E&&(K.TgZ(0,"li",7)(1,"a",16),K._uU(2,"Login"),K.qZA()())}function $e(E,h){1&E&&K._UZ(0,"li",7)}let it=(()=>{var E;class h{constructor(_){this.store=_,this.navbarState="expanded",this.lastScrollTop=0}ngOnInit(){this.isAuthenticated=this.store.select(_t)}onScroll(_){const T=window.pageYOffset||document.documentElement.scrollTop;this.navbarState=T>this.lastScrollTop?"collapsed":"expanded",this.lastScrollTop=T}logout(_){_.preventDefault(),this.store.dispatch((0,vi._v)())}}return(E=h).\u0275fac=function(_){return new(_||E)(K.Y36(l.yh))},E.\u0275cmp=K.Xpm({type:E,selectors:[["app-navbar"]],hostBindings:function(_,T){1&_&&K.NdJ("scroll",function(te){return T.onScroll(te)},!1,K.Jf7)},decls:26,vars:16,consts:[[1,"navbar","navbar-expand-md","navbar-light","bg-light","fixed-top"],[1,"container-fluid"],["href","#",1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarNav","aria-controls","navbarNav","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarNav",1,"collapse","navbar-collapse"],[1,"navbar-nav"],[1,"nav-item"],["class","nav-link","routerLink","/home",4,"ngIf"],["class","nav-link","routerLink","/new-post",4,"ngIf"],["routerLink","/map",1,"nav-link"],["class","nav-item",4,"ngIf"],["routerLink","/login",1,"nav-link",3,"click"],["routerLink","/home",1,"nav-link"],["routerLink","/new-post",1,"nav-link"],["routerLink","/register",1,"nav-link"],["routerLink","/login",1,"nav-link"]],template:function(_,T){1&_&&(K.TgZ(0,"nav",0)(1,"div",1)(2,"a",2),K._uU(3,"Navbar"),K.qZA(),K.TgZ(4,"button",3),K._UZ(5,"span",4),K.qZA(),K.TgZ(6,"div",5)(7,"ul",6),K._UZ(8,"li",7),K.TgZ(9,"li",7),K.YNc(10,Le,2,0,"a",8),K.ALo(11,"async"),K.qZA(),K.TgZ(12,"li",7),K.YNc(13,ce,2,0,"a",9),K.ALo(14,"async"),K.qZA(),K.TgZ(15,"li",7)(16,"a",10),K._uU(17,"Map"),K.qZA()(),K.YNc(18,ue,3,0,"li",11),K.ALo(19,"async"),K.YNc(20,Se,3,0,"li",11),K.ALo(21,"async"),K.YNc(22,$e,1,0,"li",11),K.ALo(23,"async"),K.TgZ(24,"a",12),K.NdJ("click",function(te){return T.logout(te)}),K._uU(25,"Logout"),K.qZA()()()()()),2&_&&(K.Q6J("@navbarAnimation",T.navbarState),K.xp6(10),K.Q6J("ngIf",K.lcZ(11,6,T.isAuthenticated)),K.xp6(3),K.Q6J("ngIf",K.lcZ(14,8,T.isAuthenticated)),K.xp6(5),K.Q6J("ngIf",!K.lcZ(19,10,T.isAuthenticated)),K.xp6(2),K.Q6J("ngIf",!K.lcZ(21,12,T.isAuthenticated)),K.xp6(2),K.Q6J("ngIf",K.lcZ(23,14,T.isAuthenticated)))},dependencies:[zt.O5,Re.rH,zt.Ov],styles:[".navbar[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;transition:top .3s}.navbar.navbar-hidden[_ngcontent-%COMP%]{top:-100px}"],data:{animation:[Uo]}}),h})(),vt=(()=>{var E;class h{constructor(_){this.store=_}ngOnInit(){this.store.dispatch((0,vi.w5)())}}return(E=h).\u0275fac=function(_){return new(_||E)(K.Y36(l.yh))},E.\u0275cmp=K.Xpm({type:E,selectors:[["app-root"]],decls:2,vars:0,template:function(_,T){1&_&&K._UZ(0,"app-navbar")(1,"router-outlet")},dependencies:[Re.lC,it]}),h})();var ct=re(8939),Je=re(7632),wt=re(3019),an=re(5592),fn=re(8645),qe=re(9360),He=re(8251),pt=re(2420),mt=re(6232),Ut=re(2096),_n=re(8504),Gn=re(4674);class _i{constructor(h,v,_){this.kind=h,this.value=v,this.error=_,this.hasValue="N"===h}observe(h){return Cr(this,h)}do(h,v,_){const{kind:T,value:V,error:te}=this;return"N"===T?h?.(V):"E"===T?v?.(te):_?.()}accept(h,v,_){var T;return(0,Gn.m)(null===(T=h)||void 0===T?void 0:T.next)?this.observe(h):this.do(h,v,_)}toObservable(){const{kind:h,value:v,error:_}=this,T="N"===h?(0,Ut.of)(v):"E"===h?(0,_n._)(()=>_):"C"===h?mt.E:0;if(!T)throw new TypeError(`Unexpected notification kind ${h}`);return T}static createNext(h){return new _i("N",h)}static createError(h){return new _i("E",void 0,h)}static createComplete(){return _i.completeNotification}}function Cr(E,h){var v,_,T;const{kind:V,value:te,error:me}=E;if("string"!=typeof V)throw new TypeError('Invalid notification, missing "kind"');"N"===V?null===(v=h.next)||void 0===v||v.call(h,te):"E"===V?null===(_=h.error)||void 0===_||_.call(h,me):null===(T=h.complete)||void 0===T||T.call(h)}_i.completeNotification=new _i("C");var lt=re(6306),Be=re(2181),Ft=re(4829);function Rt(E,h,v,_){return(0,qe.e)((T,V)=>{let te;h&&"function"!=typeof h?({duration:v,element:te,connector:_}=h):te=h;const me=new Map,je=Un=>{me.forEach(Un),Un(V)},ot=Un=>je(ei=>ei.error(Un));let Zt=0,cn=!1;const di=new He.Q(V,Un=>{try{const ei=E(Un);let cr=me.get(ei);if(!cr){me.set(ei,cr=_?_():new fn.x);const vo=function si(Un,ei){const cr=new an.y(vo=>{Zt++;const qr=ei.subscribe(vo);return()=>{qr.unsubscribe(),0==--Zt&&cn&&di.unsubscribe()}});return cr.key=Un,cr}(ei,cr);if(V.next(vo),v){const qr=(0,He.x)(cr,()=>{cr.complete(),qr?.unsubscribe()},void 0,void 0,()=>me.delete(ei));di.add((0,Ft.Xf)(v(vo)).subscribe(qr))}}cr.next(te?te(Un):Un)}catch(ei){ot(ei)}},()=>je(Un=>Un.complete()),ot,()=>me.clear(),()=>(cn=!0,0===Zt));T.subscribe(di)})}var en=re(1631);function wn(E,h){return h?v=>v.pipe(wn((_,T)=>(0,Ft.Xf)(E(_,T)).pipe((0,mr.U)((V,te)=>h(_,V,T,te))))):(0,qe.e)((v,_)=>{let T=0,V=null,te=!1;v.subscribe((0,He.x)(_,me=>{V||(V=(0,He.x)(_,void 0,()=>{V=null,te&&_.complete()}),(0,Ft.Xf)(E(me,T++)).subscribe(V))},()=>{te=!0,!V&&_.complete()}))})}var An=re(8180);const qi={dispatch:!0,functional:!1,useEffectsErrorHandler:!0},Ci="__@ngrx/effects_create__";function dr(E,h={}){const v=h.functional?E:E(),_={...qi,...h};return Object.defineProperty(v,Ci,{value:_}),v}function So(E){return Object.getPrototypeOf(E)}function xt(E){return"function"==typeof E}function Xi(E){return E.filter(xt)}function Lr(E,h,v){const _=So(E),V=_&&"Object"!==_.constructor.name?_.constructor.name:null,te=function Jr(E){return function Mo(E){return Object.getOwnPropertyNames(E).filter(_=>!(!E[_]||!E[_].hasOwnProperty(Ci))&&E[_][Ci].hasOwnProperty("dispatch")).map(_=>({propertyName:_,...E[_][Ci]}))}(E)}(E).map(({propertyName:me,dispatch:je,useEffectsErrorHandler:ot})=>{const Zt="function"==typeof E[me]?E[me]():E[me],cn=ot?v(Zt,h):Zt;return!1===je?cn.pipe(function Ve(){return(0,qe.e)((E,h)=>{E.subscribe((0,He.x)(h,pt.Z))})}()):cn.pipe(function ur(){return(0,qe.e)((E,h)=>{E.subscribe((0,He.x)(h,v=>{h.next(_i.createNext(v))},()=>{h.next(_i.createComplete()),h.complete()},v=>{h.next(_i.createError(v)),h.complete()}))})}()).pipe((0,mr.U)(si=>({effect:E[me],notification:si,propertyName:me,sourceName:V,sourceInstance:E})))});return(0,wt.T)(...te)}function ao(E,h,v=10){return E.pipe((0,lt.K)(_=>(h&&h.handleError(_),v<=1?E:ao(E,h,v-1))))}let Vo=(()=>{var E;class h extends an.y{constructor(_){super(),_&&(this.source=_)}lift(_){const T=new h;return T.source=this,T.operator=_,T}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(l.Y$))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})();function Pr(...E){return(0,Be.h)(h=>E.some(v=>"string"==typeof v?v===h.type:v.type===h.type))}const gs=new K.OlP("@ngrx/effects Internal Root Guard"),Sn=new K.OlP("@ngrx/effects User Provided Effects"),ci=new K.OlP("@ngrx/effects Internal Root Effects"),mi=new K.OlP("@ngrx/effects Internal Root Effects Instances"),mo=new K.OlP("@ngrx/effects Internal Feature Effects"),jo=new K.OlP("@ngrx/effects Internal Feature Effects Instance Groups"),Bi=new K.OlP("@ngrx/effects Effects Error Handler",{providedIn:"root",factory:()=>ao}),wo="@ngrx/effects/init";(0,l.PH)(wo);function Nn(E){return xi(E,"ngrxOnInitEffects")}function xi(E,h){return E&&h in E&&"function"==typeof E[h]}let Sr=(()=>{var E;class h extends fn.x{constructor(_,T){super(),this.errorHandler=_,this.effectsErrorHandler=T}addEffects(_){this.next(_)}toActions(){return this.pipe(Rt(_=>function qo(E){return!!E.constructor&&"Object"!==E.constructor.name&&"Function"!==E.constructor.name}(_)?So(_):_),(0,en.z)(_=>_.pipe(Rt(gr))),(0,en.z)(_=>{const T=_.pipe(wn(te=>function ri(E,h){return v=>{const _=Lr(v,E,h);return function bt(E){return xi(E,"ngrxOnRunEffects")}(v)?v.ngrxOnRunEffects(_):_}}(this.errorHandler,this.effectsErrorHandler)(te)),(0,mr.U)(te=>(function ks(E,h){if("N"===E.notification.kind){const v=E.notification.value;!function ts(E){return"function"!=typeof E&&E&&E.type&&"string"==typeof E.type}(v)&&h.handleError(new Error(`Effect ${function Ur({propertyName:E,sourceInstance:h,sourceName:v}){const _="function"==typeof h[E];return v?`"${v}.${String(E)}${_?"()":""}"`:`"${String(E)}()"`}(E)} dispatched an invalid action: ${function ls(E){try{return JSON.stringify(E)}catch{return E}}(v)}`))}}(te,this.errorHandler),te.notification)),(0,Be.h)(te=>"N"===te.kind&&null!=te.value),function Kn(){return(0,qe.e)((E,h)=>{E.subscribe((0,He.x)(h,v=>Cr(v,h)))})}()),V=_.pipe((0,An.q)(1),(0,Be.h)(Nn),(0,mr.U)(te=>te.ngrxOnInitEffects()));return(0,wt.T)(T,V)}))}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(K.qLn),K.LFG(Bi))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})();function gr(E){return function Ot(E){return xi(E,"ngrxOnIdentifyEffects")}(E)?E.ngrxOnIdentifyEffects():""}let Jn=(()=>{var E;class h{get isStarted(){return!!this.effectsSubscription}constructor(_,T){this.effectSources=_,this.store=T,this.effectsSubscription=null}start(){this.effectsSubscription||(this.effectsSubscription=this.effectSources.toActions().subscribe(this.store))}ngOnDestroy(){this.effectsSubscription&&(this.effectsSubscription.unsubscribe(),this.effectsSubscription=null)}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(Sr),K.LFG(l.yh))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})(),br=(()=>{var E;class h{constructor(_,T,V,te,me,je,ot){this.sources=_,T.start();for(const Zt of te)_.addEffects(Zt);V.dispatch({type:wo})}addEffects(_){this.sources.addEffects(_)}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(Sr),K.LFG(Jn),K.LFG(l.yh),K.LFG(mi),K.LFG(l.cr,8),K.LFG(l.CK,8),K.LFG(gs,8))},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({}),h})(),Qr=(()=>{var E;class h{constructor(_,T,V,te){const me=T.flat();for(const je of me)_.addEffects(je)}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(br),K.LFG(jo),K.LFG(l.cr,8),K.LFG(l.CK,8))},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({}),h})(),Ji=(()=>{var E;class h{static forFeature(..._){const T=_.flat(),V=Xi(T);return{ngModule:Qr,providers:[V,{provide:mo,multi:!0,useValue:T},{provide:Sn,multi:!0,useValue:[]},{provide:jo,multi:!0,useFactory:Io,deps:[mo,Sn]}]}}static forRoot(..._){const T=_.flat(),V=Xi(T);return{ngModule:br,providers:[V,{provide:ci,useValue:[T]},{provide:gs,useFactory:el},{provide:Sn,multi:!0,useValue:[]},{provide:mi,useFactory:Io,deps:[ci,Sn]}]}}}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({}),h})();function Io(E,h){const v=[];for(const _ of E)v.push(..._);for(const _ of h)v.push(..._);return v.map(_=>function ar(E){return E instanceof K.OlP||xt(E)}(_)?(0,K.f3M)(_):_)}function el(){const E=(0,K.f3M)(Jn,{optional:!0,skipSelf:!0}),h=(0,K.f3M)(ci,{self:!0});if((1!==h.length||0!==h[0].length)&&E)throw new TypeError("EffectsModule.forRoot() called twice. Feature modules should use EffectsModule.forFeature() instead.");return"guarded"}const oi=(0,l.Lq)({email:null,password:"",token:null,loading:!1,error:null,success:!1},(0,l.on)(vi.he,(E,h)=>({...E,user:h.user})),(0,l.on)(vi._v,E=>({...E,user:null})),(0,l.on)(vi.z2,E=>({...E,loading:!0,error:null,success:!1})),(0,l.on)(vi.pV,E=>({...E,loading:!1,success:!0})),(0,l.on)(vi.TY,(E,{error:h})=>({...E,loading:!1,error:h,success:!1})));var xr=re(4664);let Po=(()=>{var E;class h{constructor(_,T,V){this.actions$=_,this.loginService=T,this.router=V,this.login$=dr(()=>this.actions$.pipe(Pr(vi.x4),wn(te=>this.loginService.login(te.email,te.password).pipe((0,mr.U)(me=>{const je=this.loginService.formatUser(me);return this.loginService.setUserInLocalStorage(je),this.router.navigate(["home"]),vi.he({user:je,redirect:!0})}))))),this.register$=dr(()=>this.actions$.pipe(Pr(vi.z2),(0,xr.w)(({userData:te})=>this.loginService.register(te).pipe((0,mr.U)(me=>vi.pV({user:me})),(0,lt.K)(me=>(console.error("HTTP Error:",me),(0,Ut.of)(vi.TY({error:me})))))))),this.autoLogin$=dr(()=>this.actions$.pipe(Pr(vi.w5),(0,en.z)(()=>{const te=this.loginService.getUserFromLocalStorage();return(0,Ut.of)(vi.he({user:te,redirect:!1}))}))),this.logout$=dr(()=>this.actions$.pipe(Pr(vi._v),(0,mr.U)(te=>{this.loginService.logout(),this.router.navigate(["login"])})),{dispatch:!1})}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(Vo),K.LFG(Bt),K.LFG(Re.F0))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac}),h})(),Ro=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({imports:[l.Aw.forFeature("auth",oi),Ji.forFeature([Po])]}),h})();const Ds=(0,l.Lq)({blogs:[],loading:!1,error:null},(0,l.on)(Vt,E=>({...E,loading:!0})),(0,l.on)(Gt,(E,{blogs:h})=>({...E,blogs:h,loading:!1})),(0,l.on)(zn,(E,{error:h})=>({...E,error:h,loading:!1})));let go=(()=>{var E;class h{constructor(_){this.http=_,this.apiUrl=Xe_apiUrl}getBlogs(){return this.http.get(`${this.apiUrl}/posts`)}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(ht.eN))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})(),$o=(()=>{var E;class h{constructor(_,T){this.actions$=_,this.blogService=T,this.loadBlogs$=dr(()=>this.actions$.pipe(Pr(Vt),(0,en.z)(()=>this.blogService.getBlogs().pipe((0,mr.U)(V=>(localStorage.setItem("blogs",JSON.stringify(V)),Gt({blogs:V}))),(0,lt.K)(V=>(0,Ut.of)(zn({error:V.message})))))))}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(Vo),K.LFG(go))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac}),h})(),cs=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({providers:[Ln],imports:[l.Aw.forFeature("blogs",Ds),Ji.forFeature([$o])]}),h})(),bi=(()=>{var E;class h{constructor(_){this.http=_,this.apiUrl=Xe_apiUrl}createBlog(_,T){const V=new ht.WM({Authorization:`${T}`}),te=new FormData;return te.append("title",_.title),te.append("content",_.content),this.http.post(`${this.apiUrl}/posts`,_,{headers:V})}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(ht.eN))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})(),Ts=(()=>{var E;class h{constructor(_,T){this.actions$=_,this.addBlogService=T,this.addBlog$=dr(()=>this.actions$.pipe(Pr(kn),(0,xr.w)(V=>this.addBlogService.createBlog(V,"asdas").pipe((0,mr.U)(te=>(localStorage.removeItem("blogs"),Dn({message:te.message,postId:te.postId}))),(0,lt.K)(te=>(0,Ut.of)(ft({error:te.message})))))))}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(Vo),K.LFG(bi))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac}),h})();const ns=(0,l.Lq)({message:null,postId:null,error:null},(0,l.on)(Dn,(E,{message:h,postId:v})=>({...E,message:h,postId:v,error:null})),(0,l.on)(ft,(E,{error:h})=>({...E,message:null,postId:null,error:h})));let Fr=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({imports:[l.Aw.forFeature("newBlog",ns),Ji.forFeature([Ts])]}),h})();const Ws=(0,l.Lq)({_id:"",title:"",content:"",imageUrl:"",userId:""},(0,l.on)(Ti,(E,{response:h})=>({...E,_id:h._id,title:h.title,content:h.content,imageUrl:h.imageUrl,userId:h.userId})));let Ko=(()=>{var E;class h{constructor(_){this.http=_,this.apiUrl=Xe_apiUrl}getBlog(_){return this.http.get(`${this.apiUrl}/post/${_}`)}editBlog(_){const T=localStorage.getItem("token"),V=new ht.WM({Authorization:T});return this.http.put(`${this.apiUrl}/posts/64fc929e18e4d343a4e1fdb7`,_,{headers:V})}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(ht.eN))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})(),_s=(()=>{var E;class h{constructor(_,T){this.actions$=_,this.blogService=T,this.getPostId$=dr(()=>this.actions$.pipe(Pr(vn),(0,xr.w)(V=>this.blogService.getBlog(V.blogId).pipe((0,mr.U)(te=>Ti({response:te}))))))}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(Vo),K.LFG(Ko))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac}),h})(),tl=(()=>{var E;class h{constructor(_,T){this.actions$=_,this.blogService=T,this.editPost$=dr(()=>this.actions$.pipe(Pr(Ei),(0,xr.w)(({_id:V,title:te,content:me,imageUrl:je})=>this.blogService.editBlog({_id:V,title:te,content:me,imageUrl:je}).pipe((0,mr.U)(ot=>(console.log(ot),Li({response:ot})))))))}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(Vo),K.LFG(Ko))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac}),h})(),ys=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({imports:[l.Aw.forFeature("getBlog",Ws),Ji.forFeature([tl,_s])]}),h})(),Ms=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({imports:[cs,Fr,Ro,ys,cs,Fr,Ro,ys]}),h})(),Fs=(()=>{var E;class h{constructor(_){this.store=_}intercept(_,T){return this.store.select(bn).pipe((0,An.q)(1),wn(V=>{if(!V)return T.handle(_);let te=_.clone({setHeaders:{Authorization:`${V}`}});return T.handle(te)}))}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(l.yh))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac}),h})();function Xn(E){return new K.vHH(3e3,!1)}function _o(E){switch(E.length){case 0:return new nr;case 1:return E[0];default:return new xo(E)}}function us(E,h,v=new Map,_=new Map){const T=[],V=[];let te=-1,me=null;if(h.forEach(je=>{const ot=je.get("offset"),Zt=ot==te,cn=Zt&&me||new Map;je.forEach((di,si)=>{let Un=si,ei=di;if("offset"!==si)switch(Un=E.normalizePropertyName(Un,T),ei){case"!":ei=v.get(si);break;case Yr:ei=_.get(si);break;default:ei=E.normalizeStyleValue(si,Un,ei,T)}cn.set(Un,ei)}),Zt||V.push(cn),me=cn,te=ot}),T.length)throw function ou(E){return new K.vHH(3502,!1)}();return V}function ko(E,h,v,_){switch(h){case"start":E.onStart(()=>_(v&&Bs(v,"start",E)));break;case"done":E.onDone(()=>_(v&&Bs(v,"done",E)));break;case"destroy":E.onDestroy(()=>_(v&&Bs(v,"destroy",E)))}}function Bs(E,h,v){const V=Da(E.element,E.triggerName,E.fromState,E.toState,h||E.phaseName,v.totalTime??E.totalTime,!!v.disabled),te=E._data;return null!=te&&(V._data=te),V}function Da(E,h,v,_,T="",V=0,te){return{element:E,triggerName:h,fromState:v,toState:_,phaseName:T,totalTime:V,disabled:!!te}}function Nr(E,h,v){let _=E.get(h);return _||E.set(h,_=v),_}function gl(E){const h=E.indexOf(":");return[E.substring(1,h),E.slice(h+1)]}const _l=(()=>typeof document>"u"?null:document.documentElement)();function Ta(E){const h=E.parentNode||E.host||null;return h===_l?null:h}let Sa=null,au=!1;function yl(E,h){for(;h;){if(h===E)return!0;h=Ta(h)}return!1}function vl(E,h,v){if(v)return Array.from(E.querySelectorAll(h));const _=E.querySelector(h);return _?[_]:[]}let bl=(()=>{var E;class h{validateStyleProperty(_){return function zs(E){Sa||(Sa=function yo(){return typeof document<"u"?document.body:null}()||{},au=!!Sa.style&&"WebkitAppearance"in Sa.style);let h=!0;return Sa.style&&!function Ma(E){return"ebkit"==E.substring(1,6)}(E)&&(h=E in Sa.style,!h&&au&&(h="Webkit"+E.charAt(0).toUpperCase()+E.slice(1)in Sa.style)),h}(_)}matchesElement(_,T){return!1}containsElement(_,T){return yl(_,T)}getParentElement(_){return Ta(_)}query(_,T,V){return vl(_,T,V)}computeStyle(_,T,V){return V||""}animate(_,T,V,te,me,je=[],ot){return new nr(V,te)}}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac}),h})(),il=(()=>{class h{}return h.NOOP=new bl,h})();const Sl=1e3,xl="ng-enter",fa="ng-leave",$a="ng-trigger",ec=".ng-trigger",lu="ng-animating",cu=".ng-animating";function pa(E){if("number"==typeof E)return E;const h=E.match(/^(-?[\.\d]+)(m?s)/);return!h||h.length<2?0:tc(parseFloat(h[1]),h[2])}function tc(E,h){return"s"===h?E*Sl:E}function Ha(E,h,v){return E.hasOwnProperty("duration")?E:function rl(E,h,v){let T,V=0,te="";if("string"==typeof E){const me=E.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===me)return h.push(Xn()),{duration:0,delay:0,easing:""};T=tc(parseFloat(me[1]),me[2]);const je=me[3];null!=je&&(V=tc(parseFloat(je),me[4]));const ot=me[5];ot&&(te=ot)}else T=E;if(!v){let me=!1,je=h.length;T<0&&(h.push(function Dc(){return new K.vHH(3100,!1)}()),me=!0),V<0&&(h.push(function Ua(){return new K.vHH(3101,!1)}()),me=!0),me&&h.splice(je,0,Xn())}return{duration:T,delay:V,easing:te}}(E,h,v)}function Ga(E,h={}){return Object.keys(E).forEach(v=>{h[v]=E[v]}),h}function nc(E){const h=new Map;return Object.keys(E).forEach(v=>{h.set(v,E[v])}),h}function Bo(E,h=new Map,v){if(v)for(let[_,T]of v)h.set(_,T);for(let[_,T]of E)h.set(_,T);return h}function N(E,h,v){h.forEach((_,T)=>{const V=Qi(T);v&&!v.has(T)&&v.set(T,E.style[V]),E.style[V]=_})}function ee(E,h){h.forEach((v,_)=>{const T=Qi(_);E.style[T]=""})}function Me(E){return Array.isArray(E)?1==E.length?E[0]:To(E):E}const ve=new RegExp("{{\\s*(.+?)\\s*}}","g");function rt(E){let h=[];if("string"==typeof E){let v;for(;v=ve.exec(E);)h.push(v[1]);ve.lastIndex=0}return h}function Tt(E,h,v){const _=E.toString(),T=_.replace(ve,(V,te)=>{let me=h[te];return null==me&&(v.push(function Yo(E){return new K.vHH(3003,!1)}()),me=""),me.toString()});return T==_?E:T}function on(E){const h=[];let v=E.next();for(;!v.done;)h.push(v.value),v=E.next();return h}const Wi=/-+([a-z0-9])/g;function Qi(E){return E.replace(Wi,(...h)=>h[1].toUpperCase())}function Pi(E,h,v){switch(h.type){case 7:return E.visitTrigger(h,v);case 0:return E.visitState(h,v);case 1:return E.visitTransition(h,v);case 2:return E.visitSequence(h,v);case 3:return E.visitGroup(h,v);case 4:return E.visitAnimate(h,v);case 5:return E.visitKeyframes(h,v);case 6:return E.visitStyle(h,v);case 8:return E.visitReference(h,v);case 9:return E.visitAnimateChild(h,v);case 10:return E.visitAnimateRef(h,v);case 11:return E.visitQuery(h,v);case 12:return E.visitStagger(h,v);default:throw function qs(E){return new K.vHH(3004,!1)}()}}function _r(E,h){return window.getComputedStyle(E)[h]}const Ps="*";function ic(E,h){const v=[];return"string"==typeof E?E.split(/\s*,\s*/).forEach(_=>function Fn(E,h,v){if(":"==E[0]){const je=function ma(E,h){switch(E){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(v,_)=>parseFloat(_)>parseFloat(v);case":decrement":return(v,_)=>parseFloat(_)<parseFloat(v);default:return h.push(function Ki(E){return new K.vHH(3016,!1)}()),"* => *"}}(E,v);if("function"==typeof je)return void h.push(je);E=je}const _=E.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==_||_.length<4)return v.push(function Jl(E){return new K.vHH(3015,!1)}()),h;const T=_[1],V=_[2],te=_[3];h.push(rc(T,te));"<"==V[0]&&!(T==Ps&&te==Ps)&&h.push(rc(te,T))}(_,v,h)):v.push(E),v}const Ri=new Set(["true","1"]),sa=new Set(["false","0"]);function rc(E,h){const v=Ri.has(E)||sa.has(E),_=Ri.has(h)||sa.has(h);return(T,V)=>{let te=E==Ps||E==T,me=h==Ps||h==V;return!te&&v&&"boolean"==typeof T&&(te=T?Ri.has(E):sa.has(E)),!me&&_&&"boolean"==typeof V&&(me=V?Ri.has(h):sa.has(h)),te&&me}}const Il=new RegExp("s*:selfs*,?","g");function oc(E,h,v,_){return new Wa(E).build(h,v,_)}class Wa{constructor(h){this._driver=h}build(h,v,_){const T=new ac(v);return this._resetContextStyleTimingState(T),Pi(this,Me(h),T)}_resetContextStyleTimingState(h){h.currentQuerySelector="",h.collectedStyles=new Map,h.collectedStyles.set("",new Map),h.currentTime=0}visitTrigger(h,v){let _=v.queryCount=0,T=v.depCount=0;const V=[],te=[];return"@"==h.name.charAt(0)&&v.errors.push(function Ns(){return new K.vHH(3006,!1)}()),h.definitions.forEach(me=>{if(this._resetContextStyleTimingState(v),0==me.type){const je=me,ot=je.name;ot.toString().split(/\s*,\s*/).forEach(Zt=>{je.name=Zt,V.push(this.visitState(je,v))}),je.name=ot}else if(1==me.type){const je=this.visitTransition(me,v);_+=je.queryCount,T+=je.depCount,te.push(je)}else v.errors.push(function Zr(){return new K.vHH(3007,!1)}())}),{type:7,name:h.name,states:V,transitions:te,queryCount:_,depCount:T,options:null}}visitState(h,v){const _=this.visitStyle(h.styles,v),T=h.options&&h.options.params||null;if(_.containsDynamicStyles){const V=new Set,te=T||{};_.styles.forEach(me=>{me instanceof Map&&me.forEach(je=>{rt(je).forEach(ot=>{te.hasOwnProperty(ot)||V.add(ot)})})}),V.size&&(on(V.values()),v.errors.push(function ml(E,h){return new K.vHH(3008,!1)}()))}return{type:0,name:h.name,style:_,options:T?{params:T}:null}}visitTransition(h,v){v.queryCount=0,v.depCount=0;const _=Pi(this,Me(h.animation),v);return{type:1,matchers:ic(h.expr,v.errors),animation:_,queryCount:v.queryCount,depCount:v.depCount,options:hn(h.options)}}visitSequence(h,v){return{type:2,steps:h.steps.map(_=>Pi(this,_,v)),options:hn(h.options)}}visitGroup(h,v){const _=v.currentTime;let T=0;const V=h.steps.map(te=>{v.currentTime=_;const me=Pi(this,te,v);return T=Math.max(T,v.currentTime),me});return v.currentTime=T,{type:3,steps:V,options:hn(h.options)}}visitAnimate(h,v){const _=function Za(E,h){if(E.hasOwnProperty("duration"))return E;if("number"==typeof E)return lr(Ha(E,h).duration,0,"");const v=E;if(v.split(/\s+/).some(V=>"{"==V.charAt(0)&&"{"==V.charAt(1))){const V=lr(0,0,"");return V.dynamic=!0,V.strValue=v,V}const T=Ha(v,h);return lr(T.duration,T.delay,T.easing)}(h.timings,v.errors);v.currentAnimateTimings=_;let T,V=h.styles?h.styles:ii({});if(5==V.type)T=this.visitKeyframes(V,v);else{let te=h.styles,me=!1;if(!te){me=!0;const ot={};_.easing&&(ot.easing=_.easing),te=ii(ot)}v.currentTime+=_.duration+_.delay;const je=this.visitStyle(te,v);je.isEmptyStep=me,T=je}return v.currentAnimateTimings=null,{type:4,timings:_,style:T,options:null}}visitStyle(h,v){const _=this._makeStyleAst(h,v);return this._validateStyleAst(_,v),_}_makeStyleAst(h,v){const _=[],T=Array.isArray(h.styles)?h.styles:[h.styles];for(let me of T)"string"==typeof me?me===Yr?_.push(me):v.errors.push(new K.vHH(3002,!1)):_.push(nc(me));let V=!1,te=null;return _.forEach(me=>{if(me instanceof Map&&(me.has("easing")&&(te=me.get("easing"),me.delete("easing")),!V))for(let je of me.values())if(je.toString().indexOf("{{")>=0){V=!0;break}}),{type:6,styles:_,easing:te,offset:h.offset,containsDynamicStyles:V,options:null}}_validateStyleAst(h,v){const _=v.currentAnimateTimings;let T=v.currentTime,V=v.currentTime;_&&V>0&&(V-=_.duration+_.delay),h.styles.forEach(te=>{"string"!=typeof te&&te.forEach((me,je)=>{const ot=v.collectedStyles.get(v.currentQuerySelector),Zt=ot.get(je);let cn=!0;Zt&&(V!=T&&V>=Zt.startTime&&T<=Zt.endTime&&(v.errors.push(function ta(E,h,v,_,T){return new K.vHH(3010,!1)}()),cn=!1),V=Zt.startTime),cn&&ot.set(je,{startTime:V,endTime:T}),v.options&&function J(E,h,v){const _=h.params||{},T=rt(E);T.length&&T.forEach(V=>{_.hasOwnProperty(V)||v.push(function pl(E){return new K.vHH(3001,!1)}())})}(me,v.options,v.errors)})})}visitKeyframes(h,v){const _={type:5,styles:[],options:null};if(!v.currentAnimateTimings)return v.errors.push(function Ss(){return new K.vHH(3011,!1)}()),_;let V=0;const te=[];let me=!1,je=!1,ot=0;const Zt=h.steps.map(vo=>{const qr=this._makeStyleAst(vo,v);let n=null!=qr.offset?qr.offset:function Pc(E){if("string"==typeof E)return null;let h=null;if(Array.isArray(E))E.forEach(v=>{if(v instanceof Map&&v.has("offset")){const _=v;h=parseFloat(_.get("offset")),_.delete("offset")}});else if(E instanceof Map&&E.has("offset")){const v=E;h=parseFloat(v.get("offset")),v.delete("offset")}return h}(qr.styles),e=0;return null!=n&&(V++,e=qr.offset=n),je=je||e<0||e>1,me=me||e<ot,ot=e,te.push(e),qr});je&&v.errors.push(function na(){return new K.vHH(3012,!1)}()),me&&v.errors.push(function Is(){return new K.vHH(3200,!1)}());const cn=h.steps.length;let di=0;V>0&&V<cn?v.errors.push(function Ks(){return new K.vHH(3202,!1)}()):0==V&&(di=1/(cn-1));const si=cn-1,Un=v.currentTime,ei=v.currentAnimateTimings,cr=ei.duration;return Zt.forEach((vo,qr)=>{const n=di>0?qr==si?1:di*qr:te[qr],e=n*cr;v.currentTime=Un+ei.delay+e,ei.duration=e,this._validateStyleAst(vo,v),vo.offset=n,_.styles.push(vo)}),_}visitReference(h,v){return{type:8,animation:Pi(this,Me(h.animation),v),options:hn(h.options)}}visitAnimateChild(h,v){return v.depCount++,{type:9,options:hn(h.options)}}visitAnimateRef(h,v){return{type:10,animation:this.visitReference(h.animation,v),options:hn(h.options)}}visitQuery(h,v){const _=v.currentQuerySelector,T=h.options||{};v.queryCount++,v.currentQuery=h;const[V,te]=function Ac(E){const h=!!E.split(/\s*,\s*/).find(v=>":self"==v);return h&&(E=E.replace(Il,"")),E=E.replace(/@\*/g,ec).replace(/@\w+/g,v=>ec+"-"+v.slice(1)).replace(/:animating/g,cu),[E,h]}(h.selector);v.currentQuerySelector=_.length?_+" "+V:V,Nr(v.collectedStyles,v.currentQuerySelector,new Map);const me=Pi(this,Me(h.animation),v);return v.currentQuery=null,v.currentQuerySelector=_,{type:11,selector:V,limit:T.limit||0,optional:!!T.optional,includeSelf:te,animation:me,originalSelector:h.selector,options:hn(h.options)}}visitStagger(h,v){v.currentQuery||v.errors.push(function ha(){return new K.vHH(3013,!1)}());const _="full"===h.timings?{duration:0,delay:0,easing:"full"}:Ha(h.timings,v.errors,!0);return{type:12,animation:Pi(this,Me(h.animation),v),timings:_,options:null}}}class ac{constructor(h){this.errors=h,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function hn(E){return E?(E=Ga(E)).params&&(E.params=function sc(E){return E?Ga(E):null}(E.params)):E={},E}function lr(E,h,v){return{duration:E,delay:h,easing:v}}function lc(E,h,v,_,T,V,te=null,me=!1){return{type:1,element:E,keyframes:h,preStyleProps:v,postStyleProps:_,duration:T,delay:V,totalTime:T+V,easing:te,subTimeline:me}}class Al{constructor(){this._map=new Map}get(h){return this._map.get(h)||[]}append(h,v){let _=this._map.get(h);_||this._map.set(h,_=[]),_.push(...v)}has(h){return this._map.has(h)}clear(){this._map.clear()}}const ga=new RegExp(":enter","g"),cc=new RegExp(":leave","g");function uc(E,h,v,_,T,V=new Map,te=new Map,me,je,ot=[]){return(new Rc).buildKeyframes(E,h,v,_,T,V,te,me,je,ot)}class Rc{buildKeyframes(h,v,_,T,V,te,me,je,ot,Zt=[]){ot=ot||new Al;const cn=new Ra(h,v,ot,T,V,Zt,[]);cn.options=je;const di=je.delay?pa(je.delay):0;cn.currentTimeline.delayNextStep(di),cn.currentTimeline.setStyles([te],null,cn.errors,je),Pi(this,_,cn);const si=cn.timelines.filter(Un=>Un.containsAnimation());if(si.length&&me.size){let Un;for(let ei=si.length-1;ei>=0;ei--){const cr=si[ei];if(cr.element===v){Un=cr;break}}Un&&!Un.allowOnlyTimelineStyles()&&Un.setStyles([me],null,cn.errors,je)}return si.length?si.map(Un=>Un.buildKeyframes()):[lc(v,[],[],[],0,di,"",!1)]}visitTrigger(h,v){}visitState(h,v){}visitTransition(h,v){}visitAnimateChild(h,v){const _=v.subInstructions.get(v.element);if(_){const T=v.createSubContext(h.options),V=v.currentTimeline.currentTime,te=this._visitSubInstructions(_,T,T.options);V!=te&&v.transformIntoNewTimeline(te)}v.previousNode=h}visitAnimateRef(h,v){const _=v.createSubContext(h.options);_.transformIntoNewTimeline(),this._applyAnimationRefDelays([h.options,h.animation.options],v,_),this.visitReference(h.animation,_),v.transformIntoNewTimeline(_.currentTimeline.currentTime),v.previousNode=h}_applyAnimationRefDelays(h,v,_){for(const T of h){const V=T?.delay;if(V){const te="number"==typeof V?V:pa(Tt(V,T?.params??{},v.errors));_.delayNextStep(te)}}}_visitSubInstructions(h,v,_){let V=v.currentTimeline.currentTime;const te=null!=_.duration?pa(_.duration):null,me=null!=_.delay?pa(_.delay):null;return 0!==te&&h.forEach(je=>{const ot=v.appendInstructionToTimeline(je,te,me);V=Math.max(V,ot.duration+ot.delay)}),V}visitReference(h,v){v.updateOptions(h.options,!0),Pi(this,h.animation,v),v.previousNode=h}visitSequence(h,v){const _=v.subContextCount;let T=v;const V=h.options;if(V&&(V.params||V.delay)&&(T=v.createSubContext(V),T.transformIntoNewTimeline(),null!=V.delay)){6==T.previousNode.type&&(T.currentTimeline.snapshotCurrentStyles(),T.previousNode=Oc);const te=pa(V.delay);T.delayNextStep(te)}h.steps.length&&(h.steps.forEach(te=>Pi(this,te,T)),T.currentTimeline.applyStylesToKeyframe(),T.subContextCount>_&&T.transformIntoNewTimeline()),v.previousNode=h}visitGroup(h,v){const _=[];let T=v.currentTimeline.currentTime;const V=h.options&&h.options.delay?pa(h.options.delay):0;h.steps.forEach(te=>{const me=v.createSubContext(h.options);V&&me.delayNextStep(V),Pi(this,te,me),T=Math.max(T,me.currentTimeline.currentTime),_.push(me.currentTimeline)}),_.forEach(te=>v.currentTimeline.mergeTimelineCollectedStyles(te)),v.transformIntoNewTimeline(T),v.previousNode=h}_visitTiming(h,v){if(h.dynamic){const _=h.strValue;return Ha(v.params?Tt(_,v.params,v.errors):_,v.errors)}return{duration:h.duration,delay:h.delay,easing:h.easing}}visitAnimate(h,v){const _=v.currentAnimateTimings=this._visitTiming(h.timings,v),T=v.currentTimeline;_.delay&&(v.incrementTime(_.delay),T.snapshotCurrentStyles());const V=h.style;5==V.type?this.visitKeyframes(V,v):(v.incrementTime(_.duration),this.visitStyle(V,v),T.applyStylesToKeyframe()),v.currentAnimateTimings=null,v.previousNode=h}visitStyle(h,v){const _=v.currentTimeline,T=v.currentAnimateTimings;!T&&_.hasCurrentStyleProperties()&&_.forwardFrame();const V=T&&T.easing||h.easing;h.isEmptyStep?_.applyEmptyStep(V):_.setStyles(h.styles,V,v.errors,v.options),v.previousNode=h}visitKeyframes(h,v){const _=v.currentAnimateTimings,T=v.currentTimeline.duration,V=_.duration,me=v.createSubContext().currentTimeline;me.easing=_.easing,h.styles.forEach(je=>{me.forwardTime((je.offset||0)*V),me.setStyles(je.styles,je.easing,v.errors,v.options),me.applyStylesToKeyframe()}),v.currentTimeline.mergeTimelineCollectedStyles(me),v.transformIntoNewTimeline(T+V),v.previousNode=h}visitQuery(h,v){const _=v.currentTimeline.currentTime,T=h.options||{},V=T.delay?pa(T.delay):0;V&&(6===v.previousNode.type||0==_&&v.currentTimeline.hasCurrentStyleProperties())&&(v.currentTimeline.snapshotCurrentStyles(),v.previousNode=Oc);let te=_;const me=v.invokeQuery(h.selector,h.originalSelector,h.limit,h.includeSelf,!!T.optional,v.errors);v.currentQueryTotal=me.length;let je=null;me.forEach((ot,Zt)=>{v.currentQueryIndex=Zt;const cn=v.createSubContext(h.options,ot);V&&cn.delayNextStep(V),ot===v.element&&(je=cn.currentTimeline),Pi(this,h.animation,cn),cn.currentTimeline.applyStylesToKeyframe(),te=Math.max(te,cn.currentTimeline.currentTime)}),v.currentQueryIndex=0,v.currentQueryTotal=0,v.transformIntoNewTimeline(te),je&&(v.currentTimeline.mergeTimelineCollectedStyles(je),v.currentTimeline.snapshotCurrentStyles()),v.previousNode=h}visitStagger(h,v){const _=v.parentContext,T=v.currentTimeline,V=h.timings,te=Math.abs(V.duration),me=te*(v.currentQueryTotal-1);let je=te*v.currentQueryIndex;switch(V.duration<0?"reverse":V.easing){case"reverse":je=me-je;break;case"full":je=_.currentStaggerTime}const Zt=v.currentTimeline;je&&Zt.delayNextStep(je);const cn=Zt.currentTime;Pi(this,h.animation,v),v.previousNode=h,_.currentStaggerTime=T.currentTime-cn+(T.startTime-_.currentTimeline.startTime)}}const Oc={};class Ra{constructor(h,v,_,T,V,te,me,je){this._driver=h,this.element=v,this.subInstructions=_,this._enterClassName=T,this._leaveClassName=V,this.errors=te,this.timelines=me,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Oc,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=je||new rs(this._driver,v,0),me.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(h,v){if(!h)return;const _=h;let T=this.options;null!=_.duration&&(T.duration=pa(_.duration)),null!=_.delay&&(T.delay=pa(_.delay));const V=_.params;if(V){let te=T.params;te||(te=this.options.params={}),Object.keys(V).forEach(me=>{(!v||!te.hasOwnProperty(me))&&(te[me]=Tt(V[me],te,this.errors))})}}_copyOptions(){const h={};if(this.options){const v=this.options.params;if(v){const _=h.params={};Object.keys(v).forEach(T=>{_[T]=v[T]})}}return h}createSubContext(h=null,v,_){const T=v||this.element,V=new Ra(this._driver,T,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(T,_||0));return V.previousNode=this.previousNode,V.currentAnimateTimings=this.currentAnimateTimings,V.options=this._copyOptions(),V.updateOptions(h),V.currentQueryIndex=this.currentQueryIndex,V.currentQueryTotal=this.currentQueryTotal,V.parentContext=this,this.subContextCount++,V}transformIntoNewTimeline(h){return this.previousNode=Oc,this.currentTimeline=this.currentTimeline.fork(this.element,h),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(h,v,_){const T={duration:v??h.duration,delay:this.currentTimeline.currentTime+(_??0)+h.delay,easing:""},V=new qa(this._driver,h.element,h.keyframes,h.preStyleProps,h.postStyleProps,T,h.stretchStartingKeyframe);return this.timelines.push(V),T}incrementTime(h){this.currentTimeline.forwardTime(this.currentTimeline.duration+h)}delayNextStep(h){h>0&&this.currentTimeline.delayNextStep(h)}invokeQuery(h,v,_,T,V,te){let me=[];if(T&&me.push(this.element),h.length>0){h=(h=h.replace(ga,"."+this._enterClassName)).replace(cc,"."+this._leaveClassName);let ot=this._driver.query(this.element,h,1!=_);0!==_&&(ot=_<0?ot.slice(ot.length+_,ot.length):ot.slice(0,_)),me.push(...ot)}return!V&&0==me.length&&te.push(function Va(E){return new K.vHH(3014,!1)}()),me}}class rs{constructor(h,v,_,T){this._driver=h,this.element=v,this.startTime=_,this._elementTimelineStylesLookup=T,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(v),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(v,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(h){const v=1===this._keyframes.size&&this._pendingStyles.size;this.duration||v?(this.forwardTime(this.currentTime+h),v&&this.snapshotCurrentStyles()):this.startTime+=h}fork(h,v){return this.applyStylesToKeyframe(),new rs(this._driver,h,v||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(h){this.applyStylesToKeyframe(),this.duration=h,this._loadKeyframe()}_updateStyle(h,v){this._localTimelineStyles.set(h,v),this._globalTimelineStyles.set(h,v),this._styleSummary.set(h,{time:this.currentTime,value:v})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(h){h&&this._previousKeyframe.set("easing",h);for(let[v,_]of this._globalTimelineStyles)this._backFill.set(v,_||Yr),this._currentKeyframe.set(v,Yr);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(h,v,_,T){v&&this._previousKeyframe.set("easing",v);const V=T&&T.params||{},te=function Rl(E,h){const v=new Map;let _;return E.forEach(T=>{if("*"===T){_=_||h.keys();for(let V of _)v.set(V,Yr)}else Bo(T,v)}),v}(h,this._globalTimelineStyles);for(let[me,je]of te){const ot=Tt(je,V,_);this._pendingStyles.set(me,ot),this._localTimelineStyles.has(me)||this._backFill.set(me,this._globalTimelineStyles.get(me)??Yr),this._updateStyle(me,ot)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((h,v)=>{this._currentKeyframe.set(v,h)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((h,v)=>{this._currentKeyframe.has(v)||this._currentKeyframe.set(v,h)}))}snapshotCurrentStyles(){for(let[h,v]of this._localTimelineStyles)this._pendingStyles.set(h,v),this._updateStyle(h,v)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const h=[];for(let v in this._currentKeyframe)h.push(v);return h}mergeTimelineCollectedStyles(h){h._styleSummary.forEach((v,_)=>{const T=this._styleSummary.get(_);(!T||v.time>T.time)&&this._updateStyle(_,v.value)})}buildKeyframes(){this.applyStylesToKeyframe();const h=new Set,v=new Set,_=1===this._keyframes.size&&0===this.duration;let T=[];this._keyframes.forEach((me,je)=>{const ot=Bo(me,new Map,this._backFill);ot.forEach((Zt,cn)=>{"!"===Zt?h.add(cn):Zt===Yr&&v.add(cn)}),_||ot.set("offset",je/this.duration),T.push(ot)});const V=h.size?on(h.values()):[],te=v.size?on(v.values()):[];if(_){const me=T[0],je=new Map(me);me.set("offset",0),je.set("offset",1),T=[me,je]}return lc(this.element,T,V,te,this.duration,this.startTime,this.easing,!1)}}class qa extends rs{constructor(h,v,_,T,V,te,me=!1){super(h,v,te.delay),this.keyframes=_,this.preStyleProps=T,this.postStyleProps=V,this._stretchStartingKeyframe=me,this.timings={duration:te.duration,delay:te.delay,easing:te.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let h=this.keyframes,{delay:v,duration:_,easing:T}=this.timings;if(this._stretchStartingKeyframe&&v){const V=[],te=_+v,me=v/te,je=Bo(h[0]);je.set("offset",0),V.push(je);const ot=Bo(h[0]);ot.set("offset",uu(me)),V.push(ot);const Zt=h.length-1;for(let cn=1;cn<=Zt;cn++){let di=Bo(h[cn]);const si=di.get("offset");di.set("offset",uu((v+si*_)/te)),V.push(di)}_=te,v=0,T="",h=V}return lc(this.element,h,this.preStyleProps,this.postStyleProps,_,v,T,!0)}}function uu(E,h=3){const v=Math.pow(10,h-1);return Math.round(E*v)/v}class kc{}const bs=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class Cd extends kc{normalizePropertyName(h,v){return Qi(h)}normalizeStyleValue(h,v,_,T){let V="";const te=_.toString().trim();if(bs.has(v)&&0!==_&&"0"!==_)if("number"==typeof _)V="px";else{const me=_.match(/^[+-]?[\d\.]+([a-z]*)$/);me&&0==me[1].length&&T.push(function Oo(E,h){return new K.vHH(3005,!1)}())}return te+V}}function dc(E,h,v,_,T,V,te,me,je,ot,Zt,cn,di){return{type:0,element:E,triggerName:h,isRemovalTransition:T,fromState:v,fromStyles:V,toState:_,toStyles:te,timelines:me,queriedElements:je,preStyleProps:ot,postStyleProps:Zt,totalTime:cn,errors:di}}const hc={};class du{constructor(h,v,_){this._triggerName=h,this.ast=v,this._stateStyles=_}match(h,v,_,T){return function hu(E,h,v,_,T){return E.some(V=>V(h,v,_,T))}(this.ast.matchers,h,v,_,T)}buildStyles(h,v,_){let T=this._stateStyles.get("*");return void 0!==h&&(T=this._stateStyles.get(h?.toString())||T),T?T.buildStyles(v,_):new Map}build(h,v,_,T,V,te,me,je,ot,Zt){const cn=[],di=this.ast.options&&this.ast.options.params||hc,Un=this.buildStyles(_,me&&me.params||hc,cn),ei=je&&je.params||hc,cr=this.buildStyles(T,ei,cn),vo=new Set,qr=new Map,n=new Map,e="void"===T,i={params:Uu(ei,di),delay:this.ast.options?.delay},s=Zt?[]:uc(h,v,this.ast.animation,V,te,Un,cr,i,ot,cn);let u=0;if(s.forEach(y=>{u=Math.max(y.duration+y.delay,u)}),cn.length)return dc(v,this._triggerName,_,T,e,Un,cr,[],[],qr,n,u,cn);s.forEach(y=>{const x=y.element,D=Nr(qr,x,new Set);y.preStyleProps.forEach(F=>D.add(F));const M=Nr(n,x,new Set);y.postStyleProps.forEach(F=>M.add(F)),x!==v&&vo.add(x)});const p=on(vo.values());return dc(v,this._triggerName,_,T,e,Un,cr,s,p,qr,n,u)}}function Uu(E,h){const v=Ga(h);for(const _ in E)E.hasOwnProperty(_)&&null!=E[_]&&(v[_]=E[_]);return v}class aa{constructor(h,v,_){this.styles=h,this.defaultParams=v,this.normalizer=_}buildStyles(h,v){const _=new Map,T=Ga(this.defaultParams);return Object.keys(h).forEach(V=>{const te=h[V];null!==te&&(T[V]=te)}),this.styles.styles.forEach(V=>{"string"!=typeof V&&V.forEach((te,me)=>{te&&(te=Tt(te,T,v));const je=this.normalizer.normalizePropertyName(me,v);te=this.normalizer.normalizeStyleValue(me,je,te,v),_.set(me,te)})}),_}}class wl{constructor(h,v,_){this.name=h,this.ast=v,this._normalizer=_,this.transitionFactories=[],this.states=new Map,v.states.forEach(T=>{this.states.set(T.name,new aa(T.style,T.options&&T.options.params||{},_))}),Wn(this.states,"true","1"),Wn(this.states,"false","0"),v.transitions.forEach(T=>{this.transitionFactories.push(new du(h,T,this.states))}),this.fallbackTransition=function Lc(E,h,v){return new du(E,{type:1,animation:{type:2,steps:[],options:null},matchers:[(te,me)=>!0],options:null,queryCount:0,depCount:0},h)}(h,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(h,v,_,T){return this.transitionFactories.find(te=>te.match(h,v,_,T))||null}matchStyles(h,v,_){return this.fallbackTransition.buildStyles(h,v,_)}}function Wn(E,h,v){E.has(h)?E.has(v)||E.set(v,E.get(h)):E.has(v)&&E.set(h,E.get(v))}const Fc=new Al;class L{constructor(h,v,_){this.bodyNode=h,this._driver=v,this._normalizer=_,this._animations=new Map,this._playersById=new Map,this.players=[]}register(h,v){const _=[],V=oc(this._driver,v,_,[]);if(_.length)throw function nl(E){return new K.vHH(3503,!1)}();this._animations.set(h,V)}_buildPlayer(h,v,_){const T=h.element,V=us(this._normalizer,h.keyframes,v,_);return this._driver.animate(T,V,h.duration,h.delay,h.easing,[],!0)}create(h,v,_={}){const T=[],V=this._animations.get(h);let te;const me=new Map;if(V?(te=uc(this._driver,v,V,xl,fa,new Map,new Map,_,Fc,T),te.forEach(Zt=>{const cn=Nr(me,Zt.element,new Map);Zt.postStyleProps.forEach(di=>cn.set(di,null))})):(T.push(function co(){return new K.vHH(3300,!1)}()),te=[]),T.length)throw function su(E){return new K.vHH(3504,!1)}();me.forEach((Zt,cn)=>{Zt.forEach((di,si)=>{Zt.set(si,this._driver.computeStyle(cn,si,Yr))})});const ot=_o(te.map(Zt=>{const cn=me.get(Zt.element);return this._buildPlayer(Zt,new Map,cn)}));return this._playersById.set(h,ot),ot.onDestroy(()=>this.destroy(h)),this.players.push(ot),ot}destroy(h){const v=this._getPlayer(h);v.destroy(),this._playersById.delete(h);const _=this.players.indexOf(v);_>=0&&this.players.splice(_,1)}_getPlayer(h){const v=this._playersById.get(h);if(!v)throw function Bu(E){return new K.vHH(3301,!1)}();return v}listen(h,v,_,T){const V=Da(v,"","","");return ko(this._getPlayer(h),_,V,T),()=>{}}command(h,v,_,T){if("register"==_)return void this.register(h,T[0]);if("create"==_)return void this.create(h,v,T[0]||{});const V=this._getPlayer(h);switch(_){case"play":V.play();break;case"pause":V.pause();break;case"reset":V.reset();break;case"restart":V.restart();break;case"finish":V.finish();break;case"init":V.init();break;case"setPosition":V.setPosition(parseFloat(T[0]));break;case"destroy":this.destroy(h)}}}const B="ng-animate-queued",O="ng-animate-disabled",Et=[],Mn={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},jt={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},ui="__ng_removed";class Yi{get params(){return this.options.params}constructor(h,v=""){this.namespaceId=v;const _=h&&h.hasOwnProperty("value");if(this.value=function c(E){return E??null}(_?h.value:h),_){const V=Ga(h);delete V.value,this.options=V}else this.options={};this.options.params||(this.options.params={})}absorbOptions(h){const v=h.params;if(v){const _=this.options.params;Object.keys(v).forEach(T=>{null==_[T]&&(_[T]=v[T])})}}}const Rr="void",Tr=new Yi(Rr);class xs{constructor(h,v,_){this.id=h,this.hostElement=v,this._engine=_,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+h,z(v,this._hostClassName)}listen(h,v,_,T){if(!this._triggers.has(v))throw function ne(E,h){return new K.vHH(3302,!1)}();if(null==_||0==_.length)throw function Q(E){return new K.vHH(3303,!1)}();if(!function b(E){return"start"==E||"done"==E}(_))throw function ye(E,h){return new K.vHH(3400,!1)}();const V=Nr(this._elementListeners,h,[]),te={name:v,phase:_,callback:T};V.push(te);const me=Nr(this._engine.statesByElement,h,new Map);return me.has(v)||(z(h,$a),z(h,$a+"-"+v),me.set(v,Tr)),()=>{this._engine.afterFlush(()=>{const je=V.indexOf(te);je>=0&&V.splice(je,1),this._triggers.has(v)||me.delete(v)})}}register(h,v){return!this._triggers.has(h)&&(this._triggers.set(h,v),!0)}_getTrigger(h){const v=this._triggers.get(h);if(!v)throw function ie(E){return new K.vHH(3401,!1)}();return v}trigger(h,v,_,T=!0){const V=this._getTrigger(v),te=new f(this.id,v,h);let me=this._engine.statesByElement.get(h);me||(z(h,$a),z(h,$a+"-"+v),this._engine.statesByElement.set(h,me=new Map));let je=me.get(v);const ot=new Yi(_,this.id);if(!(_&&_.hasOwnProperty("value"))&&je&&ot.absorbOptions(je.options),me.set(v,ot),je||(je=Tr),ot.value!==Rr&&je.value===ot.value){if(!function be(E,h){const v=Object.keys(E),_=Object.keys(h);if(v.length!=_.length)return!1;for(let T=0;T<v.length;T++){const V=v[T];if(!h.hasOwnProperty(V)||E[V]!==h[V])return!1}return!0}(je.params,ot.params)){const ei=[],cr=V.matchStyles(je.value,je.params,ei),vo=V.matchStyles(ot.value,ot.params,ei);ei.length?this._engine.reportError(ei):this._engine.afterFlush(()=>{ee(h,cr),N(h,vo)})}return}const di=Nr(this._engine.playersByElement,h,[]);di.forEach(ei=>{ei.namespaceId==this.id&&ei.triggerName==v&&ei.queued&&ei.destroy()});let si=V.matchTransition(je.value,ot.value,h,ot.params),Un=!1;if(!si){if(!T)return;si=V.fallbackTransition,Un=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:h,triggerName:v,transition:si,fromState:je,toState:ot,player:te,isFallbackTransition:Un}),Un||(z(h,B),te.onStart(()=>{W(h,B)})),te.onDone(()=>{let ei=this.players.indexOf(te);ei>=0&&this.players.splice(ei,1);const cr=this._engine.playersByElement.get(h);if(cr){let vo=cr.indexOf(te);vo>=0&&cr.splice(vo,1)}}),this.players.push(te),di.push(te),te}deregister(h){this._triggers.delete(h),this._engine.statesByElement.forEach(v=>v.delete(h)),this._elementListeners.forEach((v,_)=>{this._elementListeners.set(_,v.filter(T=>T.name!=h))})}clearElementCache(h){this._engine.statesByElement.delete(h),this._elementListeners.delete(h);const v=this._engine.playersByElement.get(h);v&&(v.forEach(_=>_.destroy()),this._engine.playersByElement.delete(h))}_signalRemovalForInnerTriggers(h,v){const _=this._engine.driver.query(h,ec,!0);_.forEach(T=>{if(T[ui])return;const V=this._engine.fetchNamespacesByElement(T);V.size?V.forEach(te=>te.triggerLeaveAnimation(T,v,!1,!0)):this.clearElementCache(T)}),this._engine.afterFlushAnimationsDone(()=>_.forEach(T=>this.clearElementCache(T)))}triggerLeaveAnimation(h,v,_,T){const V=this._engine.statesByElement.get(h),te=new Map;if(V){const me=[];if(V.forEach((je,ot)=>{if(te.set(ot,je.value),this._triggers.has(ot)){const Zt=this.trigger(h,ot,Rr,T);Zt&&me.push(Zt)}}),me.length)return this._engine.markElementAsRemoved(this.id,h,!0,v,te),_&&_o(me).onDone(()=>this._engine.processLeaveNode(h)),!0}return!1}prepareLeaveAnimationListeners(h){const v=this._elementListeners.get(h),_=this._engine.statesByElement.get(h);if(v&&_){const T=new Set;v.forEach(V=>{const te=V.name;if(T.has(te))return;T.add(te);const je=this._triggers.get(te).fallbackTransition,ot=_.get(te)||Tr,Zt=new Yi(Rr),cn=new f(this.id,te,h);this._engine.totalQueuedPlayers++,this._queue.push({element:h,triggerName:te,transition:je,fromState:ot,toState:Zt,player:cn,isFallbackTransition:!0})})}}removeNode(h,v){const _=this._engine;if(h.childElementCount&&this._signalRemovalForInnerTriggers(h,v),this.triggerLeaveAnimation(h,v,!0))return;let T=!1;if(_.totalAnimations){const V=_.players.length?_.playersByQueriedElement.get(h):[];if(V&&V.length)T=!0;else{let te=h;for(;te=te.parentNode;)if(_.statesByElement.get(te)){T=!0;break}}}if(this.prepareLeaveAnimationListeners(h),T)_.markElementAsRemoved(this.id,h,!1,v);else{const V=h[ui];(!V||V===Mn)&&(_.afterFlush(()=>this.clearElementCache(h)),_.destroyInnerAnimations(h),_._onRemovalComplete(h,v))}}insertNode(h,v){z(h,this._hostClassName)}drainQueuedTransitions(h){const v=[];return this._queue.forEach(_=>{const T=_.player;if(T.destroyed)return;const V=_.element,te=this._elementListeners.get(V);te&&te.forEach(me=>{if(me.name==_.triggerName){const je=Da(V,_.triggerName,_.fromState.value,_.toState.value);je._data=h,ko(_.player,me.phase,je,me.callback)}}),T.markedForDestroy?this._engine.afterFlush(()=>{T.destroy()}):v.push(_)}),this._queue=[],v.sort((_,T)=>{const V=_.transition.ast.depCount,te=T.transition.ast.depCount;return 0==V||0==te?V-te:this._engine.driver.containsElement(_.element,T.element)?1:-1})}destroy(h){this.players.forEach(v=>v.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,h)}}class Js{_onRemovalComplete(h,v){this.onRemovalComplete(h,v)}constructor(h,v,_){this.bodyNode=h,this.driver=v,this._normalizer=_,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(T,V)=>{}}get queuedPlayers(){const h=[];return this._namespaceList.forEach(v=>{v.players.forEach(_=>{_.queued&&h.push(_)})}),h}createNamespace(h,v){const _=new xs(h,v,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,v)?this._balanceNamespaceList(_,v):(this.newHostElements.set(v,_),this.collectEnterElement(v)),this._namespaceLookup[h]=_}_balanceNamespaceList(h,v){const _=this._namespaceList,T=this.namespacesByHostElement;if(_.length-1>=0){let te=!1,me=this.driver.getParentElement(v);for(;me;){const je=T.get(me);if(je){const ot=_.indexOf(je);_.splice(ot+1,0,h),te=!0;break}me=this.driver.getParentElement(me)}te||_.unshift(h)}else _.push(h);return T.set(v,h),h}register(h,v){let _=this._namespaceLookup[h];return _||(_=this.createNamespace(h,v)),_}registerTrigger(h,v,_){let T=this._namespaceLookup[h];T&&T.register(v,_)&&this.totalAnimations++}destroy(h,v){h&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const _=this._fetchNamespace(h);this.namespacesByHostElement.delete(_.hostElement);const T=this._namespaceList.indexOf(_);T>=0&&this._namespaceList.splice(T,1),_.destroy(v),delete this._namespaceLookup[h]}))}_fetchNamespace(h){return this._namespaceLookup[h]}fetchNamespacesByElement(h){const v=new Set,_=this.statesByElement.get(h);if(_)for(let T of _.values())if(T.namespaceId){const V=this._fetchNamespace(T.namespaceId);V&&v.add(V)}return v}trigger(h,v,_,T){if(m(v)){const V=this._fetchNamespace(h);if(V)return V.trigger(v,_,T),!0}return!1}insertNode(h,v,_,T){if(!m(v))return;const V=v[ui];if(V&&V.setForRemoval){V.setForRemoval=!1,V.setForMove=!0;const te=this.collectedLeaveElements.indexOf(v);te>=0&&this.collectedLeaveElements.splice(te,1)}if(h){const te=this._fetchNamespace(h);te&&te.insertNode(v,_)}T&&this.collectEnterElement(v)}collectEnterElement(h){this.collectedEnterElements.push(h)}markElementAsDisabled(h,v){v?this.disabledNodes.has(h)||(this.disabledNodes.add(h),z(h,O)):this.disabledNodes.has(h)&&(this.disabledNodes.delete(h),W(h,O))}removeNode(h,v,_){if(m(v)){const T=h?this._fetchNamespace(h):null;T?T.removeNode(v,_):this.markElementAsRemoved(h,v,!1,_);const V=this.namespacesByHostElement.get(v);V&&V.id!==h&&V.removeNode(v,_)}else this._onRemovalComplete(v,_)}markElementAsRemoved(h,v,_,T,V){this.collectedLeaveElements.push(v),v[ui]={namespaceId:h,setForRemoval:T,hasAnimation:_,removedBeforeQueried:!1,previousTriggersValues:V}}listen(h,v,_,T,V){return m(v)?this._fetchNamespace(h).listen(v,_,T,V):()=>{}}_buildInstruction(h,v,_,T,V){return h.transition.build(this.driver,h.element,h.fromState.value,h.toState.value,_,T,h.fromState.options,h.toState.options,v,V)}destroyInnerAnimations(h){let v=this.driver.query(h,ec,!0);v.forEach(_=>this.destroyActiveAnimationsForElement(_)),0!=this.playersByQueriedElement.size&&(v=this.driver.query(h,cu,!0),v.forEach(_=>this.finishActiveQueriedAnimationOnElement(_)))}destroyActiveAnimationsForElement(h){const v=this.playersByElement.get(h);v&&v.forEach(_=>{_.queued?_.markedForDestroy=!0:_.destroy()})}finishActiveQueriedAnimationOnElement(h){const v=this.playersByQueriedElement.get(h);v&&v.forEach(_=>_.finish())}whenRenderingDone(){return new Promise(h=>{if(this.players.length)return _o(this.players).onDone(()=>h());h()})}processLeaveNode(h){const v=h[ui];if(v&&v.setForRemoval){if(h[ui]=Mn,v.namespaceId){this.destroyInnerAnimations(h);const _=this._fetchNamespace(v.namespaceId);_&&_.clearElementCache(h)}this._onRemovalComplete(h,v.setForRemoval)}h.classList?.contains(O)&&this.markElementAsDisabled(h,!1),this.driver.query(h,".ng-animate-disabled",!0).forEach(_=>{this.markElementAsDisabled(_,!1)})}flush(h=-1){let v=[];if(this.newHostElements.size&&(this.newHostElements.forEach((_,T)=>this._balanceNamespaceList(_,T)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let _=0;_<this.collectedEnterElements.length;_++)z(this.collectedEnterElements[_],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const _=[];try{v=this._flushAnimations(_,h)}finally{for(let T=0;T<_.length;T++)_[T]()}}else for(let _=0;_<this.collectedLeaveElements.length;_++)this.processLeaveNode(this.collectedLeaveElements[_]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(_=>_()),this._flushFns=[],this._whenQuietFns.length){const _=this._whenQuietFns;this._whenQuietFns=[],v.length?_o(v).onDone(()=>{_.forEach(T=>T())}):_.forEach(T=>T())}}reportError(h){throw function Ae(E){return new K.vHH(3402,!1)}()}_flushAnimations(h,v){const _=new Al,T=[],V=new Map,te=[],me=new Map,je=new Map,ot=new Map,Zt=new Set;this.disabledNodes.forEach(G=>{Zt.add(G);const Y=this.driver.query(G,".ng-animate-queued",!0);for(let oe=0;oe<Y.length;oe++)Zt.add(Y[oe])});const cn=this.bodyNode,di=Array.from(this.statesByElement.keys()),si=R(di,this.collectedEnterElements),Un=new Map;let ei=0;si.forEach((G,Y)=>{const oe=xl+ei++;Un.set(Y,oe),G.forEach(de=>z(de,oe))});const cr=[],vo=new Set,qr=new Set;for(let G=0;G<this.collectedLeaveElements.length;G++){const Y=this.collectedLeaveElements[G],oe=Y[ui];oe&&oe.setForRemoval&&(cr.push(Y),vo.add(Y),oe.hasAnimation?this.driver.query(Y,".ng-star-inserted",!0).forEach(de=>vo.add(de)):qr.add(Y))}const n=new Map,e=R(di,Array.from(vo));e.forEach((G,Y)=>{const oe=fa+ei++;n.set(Y,oe),G.forEach(de=>z(de,oe))}),h.push(()=>{si.forEach((G,Y)=>{const oe=Un.get(Y);G.forEach(de=>W(de,oe))}),e.forEach((G,Y)=>{const oe=n.get(Y);G.forEach(de=>W(de,oe))}),cr.forEach(G=>{this.processLeaveNode(G)})});const i=[],s=[];for(let G=this._namespaceList.length-1;G>=0;G--)this._namespaceList[G].drainQueuedTransitions(v).forEach(oe=>{const de=oe.player,Ee=oe.element;if(i.push(de),this.collectedEnterElements.length){const yt=Ee[ui];if(yt&&yt.setForMove){if(yt.previousTriggersValues&&yt.previousTriggersValues.has(oe.triggerName)){const Wt=yt.previousTriggersValues.get(oe.triggerName),sn=this.statesByElement.get(oe.element);if(sn&&sn.has(oe.triggerName)){const Lt=sn.get(oe.triggerName);Lt.value=Wt,sn.set(oe.triggerName,Lt)}}return void de.destroy()}}const Ne=!cn||!this.driver.containsElement(cn,Ee),Ce=n.get(Ee),Fe=Un.get(Ee),ze=this._buildInstruction(oe,_,Fe,Ce,Ne);if(ze.errors&&ze.errors.length)return void s.push(ze);if(Ne)return de.onStart(()=>ee(Ee,ze.fromStyles)),de.onDestroy(()=>N(Ee,ze.toStyles)),void T.push(de);if(oe.isFallbackTransition)return de.onStart(()=>ee(Ee,ze.fromStyles)),de.onDestroy(()=>N(Ee,ze.toStyles)),void T.push(de);const We=[];ze.timelines.forEach(yt=>{yt.stretchStartingKeyframe=!0,this.disabledNodes.has(yt.element)||We.push(yt)}),ze.timelines=We,_.append(Ee,ze.timelines),te.push({instruction:ze,player:de,element:Ee}),ze.queriedElements.forEach(yt=>Nr(me,yt,[]).push(de)),ze.preStyleProps.forEach((yt,Wt)=>{if(yt.size){let sn=je.get(Wt);sn||je.set(Wt,sn=new Set),yt.forEach((Lt,nn)=>sn.add(nn))}}),ze.postStyleProps.forEach((yt,Wt)=>{let sn=ot.get(Wt);sn||ot.set(Wt,sn=new Set),yt.forEach((Lt,nn)=>sn.add(nn))})});if(s.length){const G=[];s.forEach(Y=>{G.push(function Ii(E,h){return new K.vHH(3505,!1)}())}),i.forEach(Y=>Y.destroy()),this.reportError(G)}const u=new Map,p=new Map;te.forEach(G=>{const Y=G.element;_.has(Y)&&(p.set(Y,Y),this._beforeAnimationBuild(G.player.namespaceId,G.instruction,u))}),T.forEach(G=>{const Y=G.element;this._getPreviousPlayers(Y,!1,G.namespaceId,G.triggerName,null).forEach(de=>{Nr(u,Y,[]).push(de),de.destroy()})});const y=cr.filter(G=>we(G,je,ot)),x=new Map;P(x,this.driver,qr,ot,Yr).forEach(G=>{we(G,je,ot)&&y.push(G)});const M=new Map;si.forEach((G,Y)=>{P(M,this.driver,new Set(G),je,"!")}),y.forEach(G=>{const Y=x.get(G),oe=M.get(G);x.set(G,new Map([...Y?.entries()??[],...oe?.entries()??[]]))});const F=[],U=[],H={};te.forEach(G=>{const{element:Y,player:oe,instruction:de}=G;if(_.has(Y)){if(Zt.has(Y))return oe.onDestroy(()=>N(Y,de.toStyles)),oe.disabled=!0,oe.overrideTotalTime(de.totalTime),void T.push(oe);let Ee=H;if(p.size>1){let Ce=Y;const Fe=[];for(;Ce=Ce.parentNode;){const ze=p.get(Ce);if(ze){Ee=ze;break}Fe.push(Ce)}Fe.forEach(ze=>p.set(ze,Ee))}const Ne=this._buildAnimation(oe.namespaceId,de,u,V,M,x);if(oe.setRealPlayer(Ne),Ee===H)F.push(oe);else{const Ce=this.playersByElement.get(Ee);Ce&&Ce.length&&(oe.parentPlayer=_o(Ce)),T.push(oe)}}else ee(Y,de.fromStyles),oe.onDestroy(()=>N(Y,de.toStyles)),U.push(oe),Zt.has(Y)&&T.push(oe)}),U.forEach(G=>{const Y=V.get(G.element);if(Y&&Y.length){const oe=_o(Y);G.setRealPlayer(oe)}}),T.forEach(G=>{G.parentPlayer?G.syncPlayerEvents(G.parentPlayer):G.destroy()});for(let G=0;G<cr.length;G++){const Y=cr[G],oe=Y[ui];if(W(Y,fa),oe&&oe.hasAnimation)continue;let de=[];if(me.size){let Ne=me.get(Y);Ne&&Ne.length&&de.push(...Ne);let Ce=this.driver.query(Y,cu,!0);for(let Fe=0;Fe<Ce.length;Fe++){let ze=me.get(Ce[Fe]);ze&&ze.length&&de.push(...ze)}}const Ee=de.filter(Ne=>!Ne.destroyed);Ee.length?q(this,Y,Ee):this.processLeaveNode(Y)}return cr.length=0,F.forEach(G=>{this.players.push(G),G.onDone(()=>{G.destroy();const Y=this.players.indexOf(G);this.players.splice(Y,1)}),G.play()}),F}afterFlush(h){this._flushFns.push(h)}afterFlushAnimationsDone(h){this._whenQuietFns.push(h)}_getPreviousPlayers(h,v,_,T,V){let te=[];if(v){const me=this.playersByQueriedElement.get(h);me&&(te=me)}else{const me=this.playersByElement.get(h);if(me){const je=!V||V==Rr;me.forEach(ot=>{ot.queued||!je&&ot.triggerName!=T||te.push(ot)})}}return(_||T)&&(te=te.filter(me=>!(_&&_!=me.namespaceId||T&&T!=me.triggerName))),te}_beforeAnimationBuild(h,v,_){const V=v.element,te=v.isRemovalTransition?void 0:h,me=v.isRemovalTransition?void 0:v.triggerName;for(const je of v.timelines){const ot=je.element,Zt=ot!==V,cn=Nr(_,ot,[]);this._getPreviousPlayers(ot,Zt,te,me,v.toState).forEach(si=>{const Un=si.getRealPlayer();Un.beforeDestroy&&Un.beforeDestroy(),si.destroy(),cn.push(si)})}ee(V,v.fromStyles)}_buildAnimation(h,v,_,T,V,te){const me=v.triggerName,je=v.element,ot=[],Zt=new Set,cn=new Set,di=v.timelines.map(Un=>{const ei=Un.element;Zt.add(ei);const cr=ei[ui];if(cr&&cr.removedBeforeQueried)return new nr(Un.duration,Un.delay);const vo=ei!==je,qr=function ae(E){const h=[];return fe(E,h),h}((_.get(ei)||Et).map(u=>u.getRealPlayer())).filter(u=>!!u.element&&u.element===ei),n=V.get(ei),e=te.get(ei),i=us(this._normalizer,Un.keyframes,n,e),s=this._buildPlayer(Un,i,qr);if(Un.subTimeline&&T&&cn.add(ei),vo){const u=new f(h,me,ei);u.setRealPlayer(s),ot.push(u)}return s});ot.forEach(Un=>{Nr(this.playersByQueriedElement,Un.element,[]).push(Un),Un.onDone(()=>function r(E,h,v){let _=E.get(h);if(_){if(_.length){const T=_.indexOf(v);_.splice(T,1)}0==_.length&&E.delete(h)}return _}(this.playersByQueriedElement,Un.element,Un))}),Zt.forEach(Un=>z(Un,lu));const si=_o(di);return si.onDestroy(()=>{Zt.forEach(Un=>W(Un,lu)),N(je,v.toStyles)}),cn.forEach(Un=>{Nr(T,Un,[]).push(si)}),si}_buildPlayer(h,v,_){return v.length>0?this.driver.animate(h.element,v,h.duration,h.delay,h.easing,_):new nr(h.duration,h.delay)}}class f{constructor(h,v,_){this.namespaceId=h,this.triggerName=v,this.element=_,this._player=new nr,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(h){this._containsRealPlayer||(this._player=h,this._queuedCallbacks.forEach((v,_)=>{v.forEach(T=>ko(h,_,void 0,T))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(h.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(h){this.totalTime=h}syncPlayerEvents(h){const v=this._player;v.triggerCallback&&h.onStart(()=>v.triggerCallback("start")),h.onDone(()=>this.finish()),h.onDestroy(()=>this.destroy())}_queueEvent(h,v){Nr(this._queuedCallbacks,h,[]).push(v)}onDone(h){this.queued&&this._queueEvent("done",h),this._player.onDone(h)}onStart(h){this.queued&&this._queueEvent("start",h),this._player.onStart(h)}onDestroy(h){this.queued&&this._queueEvent("destroy",h),this._player.onDestroy(h)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(h){this.queued||this._player.setPosition(h)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(h){const v=this._player;v.triggerCallback&&v.triggerCallback(h)}}function m(E){return E&&1===E.nodeType}function C(E,h){const v=E.style.display;return E.style.display=h??"none",v}function P(E,h,v,_,T){const V=[];v.forEach(je=>V.push(C(je)));const te=[];_.forEach((je,ot)=>{const Zt=new Map;je.forEach(cn=>{const di=h.computeStyle(ot,cn,T);Zt.set(cn,di),(!di||0==di.length)&&(ot[ui]=jt,te.push(ot))}),E.set(ot,Zt)});let me=0;return v.forEach(je=>C(je,V[me++])),te}function R(E,h){const v=new Map;if(E.forEach(me=>v.set(me,[])),0==h.length)return v;const T=new Set(h),V=new Map;function te(me){if(!me)return 1;let je=V.get(me);if(je)return je;const ot=me.parentNode;return je=v.has(ot)?ot:T.has(ot)?1:te(ot),V.set(me,je),je}return h.forEach(me=>{const je=te(me);1!==je&&v.get(je).push(me)}),v}function z(E,h){E.classList?.add(h)}function W(E,h){E.classList?.remove(h)}function q(E,h,v){_o(v).onDone(()=>E.processLeaveNode(h))}function fe(E,h){for(let v=0;v<E.length;v++){const _=E[v];_ instanceof xo?fe(_.players,h):h.push(_)}}function we(E,h,v){const _=v.get(E);if(!_)return!1;let T=h.get(E);return T?_.forEach(V=>T.add(V)):h.set(E,_),v.delete(E),!0}class xe{constructor(h,v,_){this.bodyNode=h,this._driver=v,this._normalizer=_,this._triggerCache={},this.onRemovalComplete=(T,V)=>{},this._transitionEngine=new Js(h,v,_),this._timelineEngine=new L(h,v,_),this._transitionEngine.onRemovalComplete=(T,V)=>this.onRemovalComplete(T,V)}registerTrigger(h,v,_,T,V){const te=h+"-"+T;let me=this._triggerCache[te];if(!me){const je=[],Zt=oc(this._driver,V,je,[]);if(je.length)throw function Ql(E,h){return new K.vHH(3404,!1)}();me=function Oa(E,h,v){return new wl(E,h,v)}(T,Zt,this._normalizer),this._triggerCache[te]=me}this._transitionEngine.registerTrigger(v,T,me)}register(h,v){this._transitionEngine.register(h,v)}destroy(h,v){this._transitionEngine.destroy(h,v)}onInsert(h,v,_,T){this._transitionEngine.insertNode(h,v,_,T)}onRemove(h,v,_){this._transitionEngine.removeNode(h,v,_)}disableAnimations(h,v){this._transitionEngine.markElementAsDisabled(h,v)}process(h,v,_,T){if("@"==_.charAt(0)){const[V,te]=gl(_);this._timelineEngine.command(V,v,te,T)}else this._transitionEngine.trigger(h,v,_,T)}listen(h,v,_,T,V){if("@"==_.charAt(0)){const[te,me]=gl(_);return this._timelineEngine.listen(te,v,me,V)}return this._transitionEngine.listen(h,v,_,T,V)}flush(h=-1){this._transitionEngine.flush(h)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(h){this._transitionEngine.afterFlushAnimationsDone(h)}}let le=(()=>{class h{constructor(_,T,V){this._element=_,this._startStyles=T,this._endStyles=V,this._state=0;let te=h.initialStylesByElement.get(_);te||h.initialStylesByElement.set(_,te=new Map),this._initialStyles=te}start(){this._state<1&&(this._startStyles&&N(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(N(this._element,this._initialStyles),this._endStyles&&(N(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(h.initialStylesByElement.delete(this._element),this._startStyles&&(ee(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(ee(this._element,this._endStyles),this._endStyles=null),N(this._element,this._initialStyles),this._state=3)}}return h.initialStylesByElement=new WeakMap,h})();function _e(E){let h=null;return E.forEach((v,_)=>{(function Ie(E){return"display"===E||"position"===E})(_)&&(h=h||new Map,h.set(_,v))}),h}class Pe{constructor(h,v,_,T){this.element=h,this.keyframes=v,this.options=_,this._specialStyles=T,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=_.duration,this._delay=_.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(h=>h()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const h=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,h,this.options),this._finalKeyframe=h.length?h[h.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(h){const v=[];return h.forEach(_=>{v.push(Object.fromEntries(_))}),v}_triggerWebAnimation(h,v,_){return h.animate(this._convertKeyframesToObject(v),_)}onStart(h){this._originalOnStartFns.push(h),this._onStartFns.push(h)}onDone(h){this._originalOnDoneFns.push(h),this._onDoneFns.push(h)}onDestroy(h){this._onDestroyFns.push(h)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(h=>h()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(h=>h()),this._onDestroyFns=[])}setPosition(h){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=h*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const h=new Map;this.hasStarted()&&this._finalKeyframe.forEach((_,T)=>{"offset"!==T&&h.set(T,this._finished?_:_r(this.element,T))}),this.currentSnapshot=h}triggerCallback(h){const v="start"===h?this._onStartFns:this._onDoneFns;v.forEach(_=>_()),v.length=0}}class Qe{validateStyleProperty(h){return!0}validateAnimatableStyleProperty(h){return!0}matchesElement(h,v){return!1}containsElement(h,v){return yl(h,v)}getParentElement(h){return Ta(h)}query(h,v,_){return vl(h,v,_)}computeStyle(h,v,_){return window.getComputedStyle(h)[v]}animate(h,v,_,T,V,te=[]){const je={duration:_,delay:T,fill:0==T?"both":"forwards"};V&&(je.easing=V);const ot=new Map,Zt=te.filter(si=>si instanceof Pe);(function ir(E,h){return 0===E||0===h})(_,T)&&Zt.forEach(si=>{si.currentSnapshot.forEach((Un,ei)=>ot.set(ei,Un))});let cn=function Aa(E){return E.length?E[0]instanceof Map?E:E.map(h=>nc(h)):[]}(v).map(si=>Bo(si));cn=function eo(E,h,v){if(v.size&&h.length){let _=h[0],T=[];if(v.forEach((V,te)=>{_.has(te)||T.push(te),_.set(te,V)}),T.length)for(let V=1;V<h.length;V++){let te=h[V];T.forEach(me=>te.set(me,_r(E,me)))}}return h}(h,cn,ot);const di=function De(E,h){let v=null,_=null;return Array.isArray(h)&&h.length?(v=_e(h[0]),h.length>1&&(_=_e(h[h.length-1]))):h instanceof Map&&(v=_e(h)),v||_?new le(E,v,_):null}(h,cn);return new Pe(h,cn,je,di)}}let tt=(()=>{var E;class h extends Zi{constructor(_,T){super(),this._nextAnimationId=0,this._renderer=_.createRenderer(T.body,{id:"0",encapsulation:K.ifc.None,styles:[],data:{animation:[]}})}build(_){const T=this._nextAnimationId.toString();this._nextAnimationId++;const V=Array.isArray(_)?To(_):_;return st(this._renderer,null,T,"register",[V]),new et(T,this._renderer)}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(K.FYo),K.LFG(zt.K0))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac}),h})();class et extends Do{constructor(h,v){super(),this._id=h,this._renderer=v}create(h,v){return new gt(this._id,h,v||{},this._renderer)}}class gt{constructor(h,v,_,T){this.id=h,this.element=v,this._renderer=T,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",_)}_listen(h,v){return this._renderer.listen(this.element,`@@${this.id}:${h}`,v)}_command(h,...v){return st(this._renderer,this.element,this.id,h,v)}onDone(h){this._listen("done",h)}onStart(h){this._listen("start",h)}onDestroy(h){this._listen("destroy",h)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(h){this._command("setPosition",h)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function st(E,h,v,_,T){return E.setProperty(h,`@@${v}:${_}`,T)}const pn="@.disabled";let Ct=(()=>{var E;class h{constructor(_,T,V){this.delegate=_,this.engine=T,this._zone=V,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,T.onRemovalComplete=(te,me)=>{const je=me?.parentNode(te);je&&me.removeChild(je,te)}}createRenderer(_,T){const te=this.delegate.createRenderer(_,T);if(!(_&&T&&T.data&&T.data.animation)){let cn=this._rendererCache.get(te);return cn||(cn=new Qt("",te,this.engine,()=>this._rendererCache.delete(te)),this._rendererCache.set(te,cn)),cn}const me=T.id,je=T.id+"-"+this._currentId;this._currentId++,this.engine.register(je,_);const ot=cn=>{Array.isArray(cn)?cn.forEach(ot):this.engine.registerTrigger(me,je,_,cn.name,cn)};return T.data.animation.forEach(ot),new kt(this,je,te,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(_,T,V){_>=0&&_<this._microtaskId?this._zone.run(()=>T(V)):(0==this._animationCallbacksBuffer.length&&queueMicrotask(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(te=>{const[me,je]=te;me(je)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([T,V]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(K.FYo),K.LFG(xe),K.LFG(K.R0b))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac}),h})();class Qt{constructor(h,v,_,T){this.namespaceId=h,this.delegate=v,this.engine=_,this._onDestroy=T}get data(){return this.delegate.data}destroyNode(h){this.delegate.destroyNode?.(h)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(h,v){return this.delegate.createElement(h,v)}createComment(h){return this.delegate.createComment(h)}createText(h){return this.delegate.createText(h)}appendChild(h,v){this.delegate.appendChild(h,v),this.engine.onInsert(this.namespaceId,v,h,!1)}insertBefore(h,v,_,T=!0){this.delegate.insertBefore(h,v,_),this.engine.onInsert(this.namespaceId,v,h,T)}removeChild(h,v,_){this.engine.onRemove(this.namespaceId,v,this.delegate)}selectRootElement(h,v){return this.delegate.selectRootElement(h,v)}parentNode(h){return this.delegate.parentNode(h)}nextSibling(h){return this.delegate.nextSibling(h)}setAttribute(h,v,_,T){this.delegate.setAttribute(h,v,_,T)}removeAttribute(h,v,_){this.delegate.removeAttribute(h,v,_)}addClass(h,v){this.delegate.addClass(h,v)}removeClass(h,v){this.delegate.removeClass(h,v)}setStyle(h,v,_,T){this.delegate.setStyle(h,v,_,T)}removeStyle(h,v,_){this.delegate.removeStyle(h,v,_)}setProperty(h,v,_){"@"==v.charAt(0)&&v==pn?this.disableAnimations(h,!!_):this.delegate.setProperty(h,v,_)}setValue(h,v){this.delegate.setValue(h,v)}listen(h,v,_){return this.delegate.listen(h,v,_)}disableAnimations(h,v){this.engine.disableAnimations(h,v)}}class kt extends Qt{constructor(h,v,_,T,V){super(v,_,T,V),this.factory=h,this.namespaceId=v}setProperty(h,v,_){"@"==v.charAt(0)?"."==v.charAt(1)&&v==pn?this.disableAnimations(h,_=void 0===_||!!_):this.engine.process(this.namespaceId,h,v.slice(1),_):this.delegate.setProperty(h,v,_)}listen(h,v,_){if("@"==v.charAt(0)){const T=function mn(E){switch(E){case"body":return document.body;case"document":return document;case"window":return window;default:return E}}(h);let V=v.slice(1),te="";return"@"!=V.charAt(0)&&([V,te]=function It(E){const h=E.indexOf(".");return[E.substring(0,h),E.slice(h+1)]}(V)),this.engine.listen(this.namespaceId,T,V,te,me=>{this.factory.scheduleListenerCallback(me._data||-1,_,me)})}return this.delegate.listen(h,v,_)}}const Cn=[{provide:Zi,useClass:tt},{provide:kc,useFactory:function En(){return new Cd}},{provide:xe,useClass:(()=>{var E;class h extends xe{constructor(_,T,V,te){super(_.body,T,V)}ngOnDestroy(){this.flush()}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(zt.K0),K.LFG(il),K.LFG(kc),K.LFG(K.z2F))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac}),h})()},{provide:K.FYo,useFactory:function ln(E,h,v){return new Ct(E,h,v)},deps:[S.se,xe,K.R0b]}],ai=[{provide:il,useFactory:()=>new Qe},{provide:K.QbO,useValue:"BrowserAnimations"},...Cn],Ai=[{provide:il,useClass:bl},{provide:K.QbO,useValue:"NoopAnimations"},...Cn];let Qn,Hn=(()=>{var E;class h{static withConfig(_){return{ngModule:h,providers:_.disableAnimations?Ai:ai}}}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({providers:ai,imports:[S.b2]}),h})();try{Qn=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Qn=!1}let Wo,hr,yr=(()=>{var E;class h{constructor(_){this._platformId=_,this.isBrowser=this._platformId?(0,zt.NF)(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!Qn)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(K.Lbi))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})();function Vs(E){return function ya(){if(null==Wo&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Wo=!0}))}finally{Wo=Wo||!1}return Wo}()?E:!!E.capture}function pr(){if(null==hr){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return hr=!1,hr;if("scrollBehavior"in document.documentElement.style)hr=!0;else{const E=Element.prototype.scrollTo;hr=!!E&&!/\{\s*\[native code\]\s*\}/.test(E.toString())}}return hr}function Ol(E){return E.composedPath?E.composedPath()[0]:E.target}function Nc(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Xu(E){return Array.isArray(E)?E:[E]}function es(E){return null==E?"":"string"==typeof E?E:`${E}px`}function Eu(E){return E instanceof K.SBq?E.nativeElement:E}var zc=re(2572),Xr=re(5211),kf=re(836),Ul=re(3620),Dl=re(7921),xa=re(9773);const hs=new Set;let Uc,js=(()=>{var E;class h{constructor(_,T){this._platform=_,this._nonce=T,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Cu}matchMedia(_){return(this._platform.WEBKIT||this._platform.BLINK)&&function Ch(E,h){if(!hs.has(E))try{Uc||(Uc=document.createElement("style"),h&&(Uc.nonce=h),Uc.setAttribute("type","text/css"),document.head.appendChild(Uc)),Uc.sheet&&(Uc.sheet.insertRule(`@media ${E} {body{ }}`,0),hs.add(E))}catch(v){console.error(v)}}(_,this._nonce),this._matchMedia(_)}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(yr),K.LFG(K.Ojb,8))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})();function Cu(E){return{matches:"all"===E||""===E,media:E,addListener:()=>{},removeListener:()=>{}}}let yc=(()=>{var E;class h{constructor(_,T){this._mediaMatcher=_,this._zone=T,this._queries=new Map,this._destroySubject=new fn.x}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(_){return Dh(Xu(_)).some(V=>this._registerQuery(V).mql.matches)}observe(_){const V=Dh(Xu(_)).map(me=>this._registerQuery(me).observable);let te=(0,zc.a)(V);return te=(0,Xr.z)(te.pipe((0,An.q)(1)),te.pipe((0,kf.T)(1),(0,Ul.b)(0))),te.pipe((0,mr.U)(me=>{const je={matches:!1,breakpoints:{}};return me.forEach(({matches:ot,query:Zt})=>{je.matches=je.matches||ot,je.breakpoints[Zt]=ot}),je}))}_registerQuery(_){if(this._queries.has(_))return this._queries.get(_);const T=this._mediaMatcher.matchMedia(_),te={observable:new an.y(me=>{const je=ot=>this._zone.run(()=>me.next(ot));return T.addListener(je),()=>{T.removeListener(je)}}).pipe((0,Dl.O)(T),(0,mr.U)(({matches:me})=>({query:_,matches:me})),(0,xa.R)(this._destroySubject)),mql:T};return this._queries.set(_,te),te}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(js),K.LFG(K.R0b))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})();function Dh(E){return E.map(h=>h.split(",")).reduce((h,v)=>h.concat(v)).map(h=>h.trim())}const Bf="cdk-high-contrast-black-on-white",rm="cdk-high-contrast-white-on-black",Ld="cdk-high-contrast-active";let wg=(()=>{var E;class h{constructor(_,T){this._platform=_,this._document=T,this._breakpointSubscription=(0,K.f3M)(yc).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const _=this._document.createElement("div");_.style.backgroundColor="rgb(1,2,3)",_.style.position="absolute",this._document.body.appendChild(_);const T=this._document.defaultView||window,V=T&&T.getComputedStyle?T.getComputedStyle(_):null,te=(V&&V.backgroundColor||"").replace(/ /g,"");switch(_.remove(),te){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const _=this._document.body.classList;_.remove(Ld,Bf,rm),this._hasCheckedHighContrastMode=!0;const T=this.getHighContrastMode();1===T?_.add(Ld,Bf):2===T&&_.add(Ld,rm)}}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(yr),K.LFG(zt.K0))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})();const zf=new K.OlP("cdk-dir-doc",{providedIn:"root",factory:function to(){return(0,K.f3M)(zt.K0)}}),Hc=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let Nd=(()=>{var E;class h{constructor(_){this.value="ltr",this.change=new K.vpe,_&&(this.value=function Uf(E){const h=E?.toLowerCase()||"";return"auto"===h&&typeof navigator<"u"&&navigator?.language?Hc.test(navigator.language)?"rtl":"ltr":"rtl"===h?"rtl":"ltr"}((_.body?_.body.dir:null)||(_.documentElement?_.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(zf,8))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})(),Gc=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({}),h})();const nd=new K.OlP("mat-sanity-checks",{providedIn:"root",factory:function Vf(){return!0}});let id=(()=>{var E;class h{constructor(_,T,V){this._sanityChecks=T,this._document=V,this._hasDoneGlobalChecks=!1,_._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(_){return!Nc()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[_])}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(wg),K.LFG(nd,8),K.LFG(zt.K0))},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({imports:[Gc,Gc]}),h})();class $d{constructor(h,v,_,T=!1){this._renderer=h,this.element=v,this.config=_,this._animationForciblyDisabledThroughCss=T,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const Hd=Vs({passive:!0,capture:!0});class lm{constructor(){this._events=new Map,this._delegateEventHandler=h=>{const v=Ol(h);v&&this._events.get(h.type)?.forEach((_,T)=>{(T===v||T.contains(v))&&_.forEach(V=>V.handleEvent(h))})}}addHandler(h,v,_,T){const V=this._events.get(v);if(V){const te=V.get(_);te?te.add(T):V.set(_,new Set([T]))}else this._events.set(v,new Map([[_,new Set([T])]])),h.runOutsideAngular(()=>{document.addEventListener(v,this._delegateEventHandler,Hd)})}removeHandler(h,v,_){const T=this._events.get(h);if(!T)return;const V=T.get(v);V&&(V.delete(_),0===V.size&&T.delete(v),0===T.size&&(this._events.delete(h),document.removeEventListener(h,this._delegateEventHandler,Hd)))}}const $h={enterDuration:225,exitDuration:150},Gf=Vs({passive:!0,capture:!0}),Gd=["mousedown","touchstart"],rd=["mouseup","mouseleave","touchend","touchcancel"];class Wd{constructor(h,v,_,T){this._target=h,this._ngZone=v,this._platform=T,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,T.isBrowser&&(this._containerElement=Eu(_))}fadeInRipple(h,v,_={}){const T=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),V={...$h,..._.animation};_.centered&&(h=T.left+T.width/2,v=T.top+T.height/2);const te=_.radius||function Wf(E,h,v){const _=Math.max(Math.abs(E-v.left),Math.abs(E-v.right)),T=Math.max(Math.abs(h-v.top),Math.abs(h-v.bottom));return Math.sqrt(_*_+T*T)}(h,v,T),me=h-T.left,je=v-T.top,ot=V.enterDuration,Zt=document.createElement("div");Zt.classList.add("mat-ripple-element"),Zt.style.left=me-te+"px",Zt.style.top=je-te+"px",Zt.style.height=2*te+"px",Zt.style.width=2*te+"px",null!=_.color&&(Zt.style.backgroundColor=_.color),Zt.style.transitionDuration=`${ot}ms`,this._containerElement.appendChild(Zt);const cn=window.getComputedStyle(Zt),si=cn.transitionDuration,Un="none"===cn.transitionProperty||"0s"===si||"0s, 0s"===si||0===T.width&&0===T.height,ei=new $d(this,Zt,_,Un);Zt.style.transform="scale3d(1, 1, 1)",ei.state=0,_.persistent||(this._mostRecentTransientRipple=ei);let cr=null;return!Un&&(ot||V.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const vo=()=>this._finishRippleTransition(ei),qr=()=>this._destroyRipple(ei);Zt.addEventListener("transitionend",vo),Zt.addEventListener("transitioncancel",qr),cr={onTransitionEnd:vo,onTransitionCancel:qr}}),this._activeRipples.set(ei,cr),(Un||!ot)&&this._finishRippleTransition(ei),ei}fadeOutRipple(h){if(2===h.state||3===h.state)return;const v=h.element,_={...$h,...h.config.animation};v.style.transitionDuration=`${_.exitDuration}ms`,v.style.opacity="0",h.state=2,(h._animationForciblyDisabledThroughCss||!_.exitDuration)&&this._finishRippleTransition(h)}fadeOutAll(){this._getActiveRipples().forEach(h=>h.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(h=>{h.config.persistent||h.fadeOut()})}setupTriggerEvents(h){const v=Eu(h);!this._platform.isBrowser||!v||v===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=v,Gd.forEach(_=>{Wd._eventManager.addHandler(this._ngZone,_,v,this)}))}handleEvent(h){"mousedown"===h.type?this._onMousedown(h):"touchstart"===h.type?this._onTouchStart(h):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{rd.forEach(v=>{this._triggerElement.addEventListener(v,this,Gf)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(h){0===h.state?this._startFadeOutTransition(h):2===h.state&&this._destroyRipple(h)}_startFadeOutTransition(h){const v=h===this._mostRecentTransientRipple,{persistent:_}=h.config;h.state=1,!_&&(!v||!this._isPointerDown)&&h.fadeOut()}_destroyRipple(h){const v=this._activeRipples.get(h)??null;this._activeRipples.delete(h),this._activeRipples.size||(this._containerRect=null),h===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),h.state=3,null!==v&&(h.element.removeEventListener("transitionend",v.onTransitionEnd),h.element.removeEventListener("transitioncancel",v.onTransitionCancel)),h.element.remove()}_onMousedown(h){const v=function Vl(E){return 0===E.buttons||0===E.offsetX&&0===E.offsetY}(h),_=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!v&&!_&&(this._isPointerDown=!0,this.fadeInRipple(h.clientX,h.clientY,this._target.rippleConfig))}_onTouchStart(h){if(!this._target.rippleDisabled&&!function wa(E){const h=E.touches&&E.touches[0]||E.changedTouches&&E.changedTouches[0];return!(!h||-1!==h.identifier||null!=h.radiusX&&1!==h.radiusX||null!=h.radiusY&&1!==h.radiusY)}(h)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const v=h.changedTouches;if(v)for(let _=0;_<v.length;_++)this.fadeInRipple(v[_].clientX,v[_].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(h=>{!h.config.persistent&&(1===h.state||h.config.terminateOnPointerUp&&0===h.state)&&h.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const h=this._triggerElement;h&&(Gd.forEach(v=>Wd._eventManager.removeHandler(v,h,this)),this._pointerUpEventsRegistered&&rd.forEach(v=>h.removeEventListener(v,this,Gf)))}}Wd._eventManager=new lm;let qc=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({imports:[id,id]}),h})(),Wg=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({imports:[id,qc,id]}),h})();var qd=re(4266),Kd=re(7400);const wm=["addListener","removeListener"],Xc=["addEventListener","removeEventListener"],ep=["on","off"];function Jc(E,h,v,_){if((0,Gn.m)(v)&&(_=v,v=void 0),_)return Jc(E,h,v).pipe((0,Kd.Z)(_));const[T,V]=function np(E){return(0,Gn.m)(E.addEventListener)&&(0,Gn.m)(E.removeEventListener)}(E)?Xc.map(te=>me=>E[te](h,me,v)):function Zg(E){return(0,Gn.m)(E.addListener)&&(0,Gn.m)(E.removeListener)}(E)?wm.map(ad(E,h)):function tp(E){return(0,Gn.m)(E.on)&&(0,Gn.m)(E.off)}(E)?ep.map(ad(E,h)):[];if(!T&&(0,qd.z)(E))return(0,en.z)(te=>Jc(te,h,v))((0,Ft.Xf)(E));if(!T)throw new TypeError("Invalid event target");return new an.y(te=>{const me=(...je)=>te.next(1<je.length?je:je[0]);return T(me),()=>V(me)})}function ad(E,h){return v=>_=>E[v](h,_)}var la=re(1954),Yd=re(7394);const Mu={schedule(E){let h=requestAnimationFrame,v=cancelAnimationFrame;const{delegate:_}=Mu;_&&(h=_.requestAnimationFrame,v=_.cancelAnimationFrame);const T=h(V=>{v=void 0,E(V)});return new Yd.w0(()=>v?.(T))},requestAnimationFrame(...E){const{delegate:h}=Mu;return(h?.requestAnimationFrame||requestAnimationFrame)(...E)},cancelAnimationFrame(...E){const{delegate:h}=Mu;return(h?.cancelAnimationFrame||cancelAnimationFrame)(...E)},delegate:void 0};var Xd=re(2631);new class qh extends Xd.v{flush(h){this._active=!0;const v=this._scheduled;this._scheduled=void 0;const{actions:_}=this;let T;h=h||_.shift();do{if(T=h.execute(h.state,h.delay))break}while((h=_[0])&&h.id===v&&_.shift());if(this._active=!1,T){for(;(h=_[0])&&h.id===v&&_.shift();)h.unsubscribe();throw T}}}(class Xa extends la.o{constructor(h,v){super(h,v),this.scheduler=h,this.work=v}requestAsyncId(h,v,_=0){return null!==_&&_>0?super.requestAsyncId(h,v,_):(h.actions.push(this),h._scheduled||(h._scheduled=Mu.requestAnimationFrame(()=>h.flush(void 0))))}recycleAsyncId(h,v,_=0){var T;if(null!=_?_>0:this.delay>0)return super.recycleAsyncId(h,v,_);const{actions:V}=h;null!=v&&(null===(T=V[V.length-1])||void 0===T?void 0:T.id)!==v&&(Mu.cancelAnimationFrame(v),h._scheduled=void 0)}});let rp,Kh=1;const ld={};function op(E){return E in ld&&(delete ld[E],!0)}const Em={setImmediate(E){const h=Kh++;return ld[h]=!0,rp||(rp=Promise.resolve()),rp.then(()=>op(h)&&E()),h},clearImmediate(E){op(E)}},{setImmediate:Cm,clearImmediate:Dm}=Em,cd={setImmediate(...E){const{delegate:h}=cd;return(h?.setImmediate||Cm)(...E)},clearImmediate(E){const{delegate:h}=cd;return(h?.clearImmediate||Dm)(E)},delegate:void 0};new class cl extends Xd.v{flush(h){this._active=!0;const v=this._scheduled;this._scheduled=void 0;const{actions:_}=this;let T;h=h||_.shift();do{if(T=h.execute(h.state,h.delay))break}while((h=_[0])&&h.id===v&&_.shift());if(this._active=!1,T){for(;(h=_[0])&&h.id===v&&_.shift();)h.unsubscribe();throw T}}}(class Tm extends la.o{constructor(h,v){super(h,v),this.scheduler=h,this.work=v}requestAsyncId(h,v,_=0){return null!==_&&_>0?super.requestAsyncId(h,v,_):(h.actions.push(this),h._scheduled||(h._scheduled=cd.setImmediate(h.flush.bind(h,void 0))))}recycleAsyncId(h,v,_=0){var T;if(null!=_?_>0:this.delay>0)return super.recycleAsyncId(h,v,_);const{actions:V}=h;null!=v&&(null===(T=V[V.length-1])||void 0===T?void 0:T.id)!==v&&(cd.clearImmediate(v),h._scheduled===v&&(h._scheduled=void 0))}});var sp=re(6321),Yh=re(671),Hl=re(93);function ap(E,h=sp.z){return function Mm(E){return(0,qe.e)((h,v)=>{let _=!1,T=null,V=null,te=!1;const me=()=>{if(V?.unsubscribe(),V=null,_){_=!1;const ot=T;T=null,v.next(ot)}te&&v.complete()},je=()=>{V=null,te&&v.complete()};h.subscribe((0,He.x)(v,ot=>{_=!0,T=ot,V||(0,Ft.Xf)(E(ot)).subscribe(V=(0,He.x)(v,me,je))},()=>{te=!0,(!_||!V||V.closed)&&v.complete()}))})}(()=>function Sm(E=0,h,v=sp.P){let _=-1;return null!=h&&((0,Yh.K)(h)?v=h:_=h),new an.y(T=>{let V=(0,Hl.q)(E)?+E-v.now():E;V<0&&(V=0);let te=0;return v.schedule(function(){T.closed||(T.next(te++),0<=_?this.schedule(void 0,_):T.complete())},V)})}(E,h))}let Su=(()=>{var E;class h{constructor(_,T,V){this._ngZone=_,this._platform=T,this._scrolled=new fn.x,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=V}register(_){this.scrollContainers.has(_)||this.scrollContainers.set(_,_.elementScrolled().subscribe(()=>this._scrolled.next(_)))}deregister(_){const T=this.scrollContainers.get(_);T&&(T.unsubscribe(),this.scrollContainers.delete(_))}scrolled(_=20){return this._platform.isBrowser?new an.y(T=>{this._globalSubscription||this._addGlobalListener();const V=_>0?this._scrolled.pipe(ap(_)).subscribe(T):this._scrolled.subscribe(T);return this._scrolledCount++,()=>{V.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):(0,Ut.of)()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((_,T)=>this.deregister(T)),this._scrolled.complete()}ancestorScrolled(_,T){const V=this.getAncestorScrollContainers(_);return this.scrolled(T).pipe((0,Be.h)(te=>!te||V.indexOf(te)>-1))}getAncestorScrollContainers(_){const T=[];return this.scrollContainers.forEach((V,te)=>{this._scrollableContainsElement(te,_)&&T.push(te)}),T}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(_,T){let V=Eu(T),te=_.getElementRef().nativeElement;do{if(V==te)return!0}while(V=V.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>Jc(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(K.R0b),K.LFG(yr),K.LFG(zt.K0,8))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})(),Jh=(()=>{var E;class h{constructor(_,T,V){this._platform=_,this._change=new fn.x,this._changeListener=te=>{this._change.next(te)},this._document=V,T.runOutsideAngular(()=>{if(_.isBrowser){const te=this._getWindow();te.addEventListener("resize",this._changeListener),te.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const _=this._getWindow();_.removeEventListener("resize",this._changeListener),_.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const _={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),_}getViewportRect(){const _=this.getViewportScrollPosition(),{width:T,height:V}=this.getViewportSize();return{top:_.top,left:_.left,bottom:_.top+V,right:_.left+T,height:V,width:T}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const _=this._document,T=this._getWindow(),V=_.documentElement,te=V.getBoundingClientRect();return{top:-te.top||_.body.scrollTop||T.scrollY||V.scrollTop||0,left:-te.left||_.body.scrollLeft||T.scrollX||V.scrollLeft||0}}change(_=20){return _>0?this._change.pipe(ap(_)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const _=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:_.innerWidth,height:_.innerHeight}:{width:0,height:0}}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(yr),K.LFG(K.R0b),K.LFG(zt.K0,8))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})(),ud=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({}),h})(),tf=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({imports:[Gc,ud,Gc,ud]}),h})();class ih{attach(h){return this._attachedHost=h,h.attach(this)}detach(){let h=this._attachedHost;null!=h&&(this._attachedHost=null,h.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(h){this._attachedHost=h}}class cp extends ih{constructor(h,v,_,T,V){super(),this.component=h,this.viewContainerRef=v,this.injector=_,this.componentFactoryResolver=T,this.projectableNodes=V}}class nf extends ih{constructor(h,v,_,T){super(),this.templateRef=h,this.viewContainerRef=v,this.context=_,this.injector=T}get origin(){return this.templateRef.elementRef}attach(h,v=this.context){return this.context=v,super.attach(h)}detach(){return this.context=void 0,super.detach()}}class up extends ih{constructor(h){super(),this.element=h instanceof K.SBq?h.nativeElement:h}}class e_{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(h){return h instanceof cp?(this._attachedPortal=h,this.attachComponentPortal(h)):h instanceof nf?(this._attachedPortal=h,this.attachTemplatePortal(h)):this.attachDomPortal&&h instanceof up?(this._attachedPortal=h,this.attachDomPortal(h)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(h){this._disposeFn=h}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class tu extends e_{constructor(h,v,_,T,V){super(),this.outletElement=h,this._componentFactoryResolver=v,this._appRef=_,this._defaultInjector=T,this.attachDomPortal=te=>{const me=te.element,je=this._document.createComment("dom-portal");me.parentNode.insertBefore(je,me),this.outletElement.appendChild(me),this._attachedPortal=te,super.setDisposeFn(()=>{je.parentNode&&je.parentNode.replaceChild(me,je)})},this._document=V}attachComponentPortal(h){const _=(h.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(h.component);let T;return h.viewContainerRef?(T=h.viewContainerRef.createComponent(_,h.viewContainerRef.length,h.injector||h.viewContainerRef.injector,h.projectableNodes||void 0),this.setDisposeFn(()=>T.destroy())):(T=_.create(h.injector||this._defaultInjector||K.zs3.NULL),this._appRef.attachView(T.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(T.hostView),T.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(T)),this._attachedPortal=h,T}attachTemplatePortal(h){let v=h.viewContainerRef,_=v.createEmbeddedView(h.templateRef,h.context,{injector:h.injector});return _.rootNodes.forEach(T=>this.outletElement.appendChild(T)),_.detectChanges(),this.setDisposeFn(()=>{let T=v.indexOf(_);-1!==T&&v.remove(T)}),this._attachedPortal=h,_}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(h){return h.hostView.rootNodes[0]}}let dd=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({}),h})();const hd=pr();class rf{constructor(h,v){this._viewportRuler=h,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=v}attach(){}enable(){if(this._canBeEnabled()){const h=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=h.style.left||"",this._previousHTMLStyles.top=h.style.top||"",h.style.left=es(-this._previousScrollPosition.left),h.style.top=es(-this._previousScrollPosition.top),h.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const h=this._document.documentElement,_=h.style,T=this._document.body.style,V=_.scrollBehavior||"",te=T.scrollBehavior||"";this._isEnabled=!1,_.left=this._previousHTMLStyles.left,_.top=this._previousHTMLStyles.top,h.classList.remove("cdk-global-scrollblock"),hd&&(_.scrollBehavior=T.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),hd&&(_.scrollBehavior=V,T.scrollBehavior=te)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const v=this._document.body,_=this._viewportRuler.getViewportSize();return v.scrollHeight>_.height||v.scrollWidth>_.width}}class Au{constructor(h,v,_,T){this._scrollDispatcher=h,this._ngZone=v,this._viewportRuler=_,this._config=T,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(h){this._overlayRef=h}enable(){if(this._scrollSubscription)return;const h=this._scrollDispatcher.scrolled(0).pipe((0,Be.h)(v=>!v||!this._overlayRef.overlayElement.contains(v.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=h.subscribe(()=>{const v=this._viewportRuler.getViewportScrollPosition().top;Math.abs(v-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=h.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class fd{enable(){}disable(){}attach(){}}function tr(E,h){return h.some(v=>E.bottom<v.top||E.top>v.bottom||E.right<v.left||E.left>v.right)}function sf(E,h){return h.some(v=>E.top<v.top||E.bottom>v.bottom||E.left<v.left||E.right>v.right)}class fp{constructor(h,v,_,T){this._scrollDispatcher=h,this._viewportRuler=v,this._ngZone=_,this._config=T,this._scrollSubscription=null}attach(h){this._overlayRef=h}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const v=this._overlayRef.overlayElement.getBoundingClientRect(),{width:_,height:T}=this._viewportRuler.getViewportSize();tr(v,[{width:_,height:T,bottom:T,right:_,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let pd=(()=>{var E;class h{constructor(_,T,V,te){this._scrollDispatcher=_,this._viewportRuler=T,this._ngZone=V,this.noop=()=>new fd,this.close=me=>new Au(this._scrollDispatcher,this._ngZone,this._viewportRuler,me),this.block=()=>new rf(this._viewportRuler,this._document),this.reposition=me=>new fp(this._scrollDispatcher,this._viewportRuler,this._ngZone,me),this._document=te}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(Su),K.LFG(Jh),K.LFG(K.R0b),K.LFG(zt.K0))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})();class pp{constructor(h){if(this.scrollStrategy=new fd,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,h){const v=Object.keys(h);for(const _ of v)void 0!==h[_]&&(this[_]=h[_])}}}class md{constructor(h,v){this.connectionPair=h,this.scrollableViewProperties=v}}let gp=(()=>{var E;class h{constructor(_){this._attachedOverlays=[],this._document=_}ngOnDestroy(){this.detach()}add(_){this.remove(_),this._attachedOverlays.push(_)}remove(_){const T=this._attachedOverlays.indexOf(_);T>-1&&this._attachedOverlays.splice(T,1),0===this._attachedOverlays.length&&this.detach()}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(zt.K0))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})(),gd=(()=>{var E;class h extends gp{constructor(_,T){super(_),this._ngZone=T,this._keydownListener=V=>{const te=this._attachedOverlays;for(let me=te.length-1;me>-1;me--)if(te[me]._keydownEvents.observers.length>0){const je=te[me]._keydownEvents;this._ngZone?this._ngZone.run(()=>je.next(V)):je.next(V);break}}}add(_){super.add(_),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(zt.K0),K.LFG(K.R0b,8))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})(),_d=(()=>{var E;class h extends gp{constructor(_,T,V){super(_),this._platform=T,this._ngZone=V,this._cursorStyleIsSet=!1,this._pointerDownListener=te=>{this._pointerDownEventTarget=Ol(te)},this._clickListener=te=>{const me=Ol(te),je="click"===te.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:me;this._pointerDownEventTarget=null;const ot=this._attachedOverlays.slice();for(let Zt=ot.length-1;Zt>-1;Zt--){const cn=ot[Zt];if(cn._outsidePointerEvents.observers.length<1||!cn.hasAttached())continue;if(cn.overlayElement.contains(me)||cn.overlayElement.contains(je))break;const di=cn._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>di.next(te)):di.next(te)}}}add(_){if(super.add(_),!this._isAttached){const T=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(T)):this._addEventListeners(T),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=T.style.cursor,T.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const _=this._document.body;_.removeEventListener("pointerdown",this._pointerDownListener,!0),_.removeEventListener("click",this._clickListener,!0),_.removeEventListener("auxclick",this._clickListener,!0),_.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(_.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(_){_.addEventListener("pointerdown",this._pointerDownListener,!0),_.addEventListener("click",this._clickListener,!0),_.addEventListener("auxclick",this._clickListener,!0),_.addEventListener("contextmenu",this._clickListener,!0)}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(zt.K0),K.LFG(yr),K.LFG(K.R0b,8))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})(),Pu=(()=>{var E;class h{constructor(_,T){this._platform=T,this._document=_}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const _="cdk-overlay-container";if(this._platform.isBrowser||Nc()){const V=this._document.querySelectorAll(`.${_}[platform="server"], .${_}[platform="test"]`);for(let te=0;te<V.length;te++)V[te].remove()}const T=this._document.createElement("div");T.classList.add(_),Nc()?T.setAttribute("platform","test"):this._platform.isBrowser||T.setAttribute("platform","server"),this._document.body.appendChild(T),this._containerElement=T}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(zt.K0),K.LFG(yr))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})();class Rm{constructor(h,v,_,T,V,te,me,je,ot,Zt=!1){this._portalOutlet=h,this._host=v,this._pane=_,this._config=T,this._ngZone=V,this._keyboardDispatcher=te,this._document=me,this._location=je,this._outsideClickDispatcher=ot,this._animationsDisabled=Zt,this._backdropElement=null,this._backdropClick=new fn.x,this._attachments=new fn.x,this._detachments=new fn.x,this._locationChanges=Yd.w0.EMPTY,this._backdropClickHandler=cn=>this._backdropClick.next(cn),this._backdropTransitionendHandler=cn=>{this._disposeBackdrop(cn.target)},this._keydownEvents=new fn.x,this._outsidePointerEvents=new fn.x,T.scrollStrategy&&(this._scrollStrategy=T.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=T.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(h){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const v=this._portalOutlet.attach(h);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe((0,An.q)(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof v?.onDestroy&&v.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),v}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const h=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),h}dispose(){const h=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,h&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(h){h!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=h,this.hasAttached()&&(h.attach(this),this.updatePosition()))}updateSize(h){this._config={...this._config,...h},this._updateElementSize()}setDirection(h){this._config={...this._config,direction:h},this._updateElementDirection()}addPanelClass(h){this._pane&&this._toggleClasses(this._pane,h,!0)}removePanelClass(h){this._pane&&this._toggleClasses(this._pane,h,!1)}getDirection(){const h=this._config.direction;return h?"string"==typeof h?h:h.value:"ltr"}updateScrollStrategy(h){h!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=h,this.hasAttached()&&(h.attach(this),h.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const h=this._pane.style;h.width=es(this._config.width),h.height=es(this._config.height),h.minWidth=es(this._config.minWidth),h.minHeight=es(this._config.minHeight),h.maxWidth=es(this._config.maxWidth),h.maxHeight=es(this._config.maxHeight)}_togglePointerEvents(h){this._pane.style.pointerEvents=h?"":"none"}_attachBackdrop(){const h="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(h)})}):this._backdropElement.classList.add(h)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const h=this._backdropElement;if(h){if(this._animationsDisabled)return void this._disposeBackdrop(h);h.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{h.addEventListener("transitionend",this._backdropTransitionendHandler)}),h.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(h)},500))}}_toggleClasses(h,v,_){const T=Xu(v||[]).filter(V=>!!V);T.length&&(_?h.classList.add(...T):h.classList.remove(...T))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const h=this._ngZone.onStable.pipe((0,xa.R)((0,wt.T)(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),h.unsubscribe())})})}_disposeScrollStrategy(){const h=this._scrollStrategy;h&&(h.disable(),h.detach&&h.detach())}_disposeBackdrop(h){h&&(h.removeEventListener("click",this._backdropClickHandler),h.removeEventListener("transitionend",this._backdropTransitionendHandler),h.remove(),this._backdropElement===h&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const yd="cdk-overlay-connected-position-bounding-box",_p=/([A-Za-z%]+)$/;class nu{get positions(){return this._preferredPositions}constructor(h,v,_,T,V){this._viewportRuler=v,this._document=_,this._platform=T,this._overlayContainer=V,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new fn.x,this._resizeSubscription=Yd.w0.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(h)}attach(h){this._validatePositions(),h.hostElement.classList.add(yd),this._overlayRef=h,this._boundingBox=h.hostElement,this._pane=h.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const h=this._originRect,v=this._overlayRect,_=this._viewportRect,T=this._containerRect,V=[];let te;for(let me of this._preferredPositions){let je=this._getOriginPoint(h,T,me),ot=this._getOverlayPoint(je,v,me),Zt=this._getOverlayFit(ot,v,_,me);if(Zt.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(me,je);this._canFitWithFlexibleDimensions(Zt,ot,_)?V.push({position:me,origin:je,overlayRect:v,boundingBoxRect:this._calculateBoundingBoxRect(je,me)}):(!te||te.overlayFit.visibleArea<Zt.visibleArea)&&(te={overlayFit:Zt,overlayPoint:ot,originPoint:je,position:me,overlayRect:v})}if(V.length){let me=null,je=-1;for(const ot of V){const Zt=ot.boundingBoxRect.width*ot.boundingBoxRect.height*(ot.position.weight||1);Zt>je&&(je=Zt,me=ot)}return this._isPushed=!1,void this._applyPosition(me.position,me.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(te.position,te.originPoint);this._applyPosition(te.position,te.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Ru(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(yd),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const h=this._lastPosition;if(h){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const v=this._getOriginPoint(this._originRect,this._containerRect,h);this._applyPosition(h,v)}else this.apply()}withScrollableContainers(h){return this._scrollables=h,this}withPositions(h){return this._preferredPositions=h,-1===h.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(h){return this._viewportMargin=h,this}withFlexibleDimensions(h=!0){return this._hasFlexibleDimensions=h,this}withGrowAfterOpen(h=!0){return this._growAfterOpen=h,this}withPush(h=!0){return this._canPush=h,this}withLockedPosition(h=!0){return this._positionLocked=h,this}setOrigin(h){return this._origin=h,this}withDefaultOffsetX(h){return this._offsetX=h,this}withDefaultOffsetY(h){return this._offsetY=h,this}withTransformOriginOn(h){return this._transformOriginSelector=h,this}_getOriginPoint(h,v,_){let T,V;if("center"==_.originX)T=h.left+h.width/2;else{const te=this._isRtl()?h.right:h.left,me=this._isRtl()?h.left:h.right;T="start"==_.originX?te:me}return v.left<0&&(T-=v.left),V="center"==_.originY?h.top+h.height/2:"top"==_.originY?h.top:h.bottom,v.top<0&&(V-=v.top),{x:T,y:V}}_getOverlayPoint(h,v,_){let T,V;return T="center"==_.overlayX?-v.width/2:"start"===_.overlayX?this._isRtl()?-v.width:0:this._isRtl()?0:-v.width,V="center"==_.overlayY?-v.height/2:"top"==_.overlayY?0:-v.height,{x:h.x+T,y:h.y+V}}_getOverlayFit(h,v,_,T){const V=yp(v);let{x:te,y:me}=h,je=this._getOffset(T,"x"),ot=this._getOffset(T,"y");je&&(te+=je),ot&&(me+=ot);let di=0-me,si=me+V.height-_.height,Un=this._subtractOverflows(V.width,0-te,te+V.width-_.width),ei=this._subtractOverflows(V.height,di,si),cr=Un*ei;return{visibleArea:cr,isCompletelyWithinViewport:V.width*V.height===cr,fitsInViewportVertically:ei===V.height,fitsInViewportHorizontally:Un==V.width}}_canFitWithFlexibleDimensions(h,v,_){if(this._hasFlexibleDimensions){const T=_.bottom-v.y,V=_.right-v.x,te=oh(this._overlayRef.getConfig().minHeight),me=oh(this._overlayRef.getConfig().minWidth);return(h.fitsInViewportVertically||null!=te&&te<=T)&&(h.fitsInViewportHorizontally||null!=me&&me<=V)}return!1}_pushOverlayOnScreen(h,v,_){if(this._previousPushAmount&&this._positionLocked)return{x:h.x+this._previousPushAmount.x,y:h.y+this._previousPushAmount.y};const T=yp(v),V=this._viewportRect,te=Math.max(h.x+T.width-V.width,0),me=Math.max(h.y+T.height-V.height,0),je=Math.max(V.top-_.top-h.y,0),ot=Math.max(V.left-_.left-h.x,0);let Zt=0,cn=0;return Zt=T.width<=V.width?ot||-te:h.x<this._viewportMargin?V.left-_.left-h.x:0,cn=T.height<=V.height?je||-me:h.y<this._viewportMargin?V.top-_.top-h.y:0,this._previousPushAmount={x:Zt,y:cn},{x:h.x+Zt,y:h.y+cn}}_applyPosition(h,v){if(this._setTransformOrigin(h),this._setOverlayElementStyles(v,h),this._setBoundingBoxStyles(v,h),h.panelClass&&this._addPanelClasses(h.panelClass),this._lastPosition=h,this._positionChanges.observers.length){const _=this._getScrollVisibility(),T=new md(h,_);this._positionChanges.next(T)}this._isInitialRender=!1}_setTransformOrigin(h){if(!this._transformOriginSelector)return;const v=this._boundingBox.querySelectorAll(this._transformOriginSelector);let _,T=h.overlayY;_="center"===h.overlayX?"center":this._isRtl()?"start"===h.overlayX?"right":"left":"start"===h.overlayX?"left":"right";for(let V=0;V<v.length;V++)v[V].style.transformOrigin=`${_} ${T}`}_calculateBoundingBoxRect(h,v){const _=this._viewportRect,T=this._isRtl();let V,te,me,Zt,cn,di;if("top"===v.overlayY)te=h.y,V=_.height-te+this._viewportMargin;else if("bottom"===v.overlayY)me=_.height-h.y+2*this._viewportMargin,V=_.height-me+this._viewportMargin;else{const si=Math.min(_.bottom-h.y+_.top,h.y),Un=this._lastBoundingBoxSize.height;V=2*si,te=h.y-si,V>Un&&!this._isInitialRender&&!this._growAfterOpen&&(te=h.y-Un/2)}if("end"===v.overlayX&&!T||"start"===v.overlayX&&T)di=_.width-h.x+this._viewportMargin,Zt=h.x-this._viewportMargin;else if("start"===v.overlayX&&!T||"end"===v.overlayX&&T)cn=h.x,Zt=_.right-h.x;else{const si=Math.min(_.right-h.x+_.left,h.x),Un=this._lastBoundingBoxSize.width;Zt=2*si,cn=h.x-si,Zt>Un&&!this._isInitialRender&&!this._growAfterOpen&&(cn=h.x-Un/2)}return{top:te,left:cn,bottom:me,right:di,width:Zt,height:V}}_setBoundingBoxStyles(h,v){const _=this._calculateBoundingBoxRect(h,v);!this._isInitialRender&&!this._growAfterOpen&&(_.height=Math.min(_.height,this._lastBoundingBoxSize.height),_.width=Math.min(_.width,this._lastBoundingBoxSize.width));const T={};if(this._hasExactPosition())T.top=T.left="0",T.bottom=T.right=T.maxHeight=T.maxWidth="",T.width=T.height="100%";else{const V=this._overlayRef.getConfig().maxHeight,te=this._overlayRef.getConfig().maxWidth;T.height=es(_.height),T.top=es(_.top),T.bottom=es(_.bottom),T.width=es(_.width),T.left=es(_.left),T.right=es(_.right),T.alignItems="center"===v.overlayX?"center":"end"===v.overlayX?"flex-end":"flex-start",T.justifyContent="center"===v.overlayY?"center":"bottom"===v.overlayY?"flex-end":"flex-start",V&&(T.maxHeight=es(V)),te&&(T.maxWidth=es(te))}this._lastBoundingBoxSize=_,Ru(this._boundingBox.style,T)}_resetBoundingBoxStyles(){Ru(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Ru(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(h,v){const _={},T=this._hasExactPosition(),V=this._hasFlexibleDimensions,te=this._overlayRef.getConfig();if(T){const Zt=this._viewportRuler.getViewportScrollPosition();Ru(_,this._getExactOverlayY(v,h,Zt)),Ru(_,this._getExactOverlayX(v,h,Zt))}else _.position="static";let me="",je=this._getOffset(v,"x"),ot=this._getOffset(v,"y");je&&(me+=`translateX(${je}px) `),ot&&(me+=`translateY(${ot}px)`),_.transform=me.trim(),te.maxHeight&&(T?_.maxHeight=es(te.maxHeight):V&&(_.maxHeight="")),te.maxWidth&&(T?_.maxWidth=es(te.maxWidth):V&&(_.maxWidth="")),Ru(this._pane.style,_)}_getExactOverlayY(h,v,_){let T={top:"",bottom:""},V=this._getOverlayPoint(v,this._overlayRect,h);return this._isPushed&&(V=this._pushOverlayOnScreen(V,this._overlayRect,_)),"bottom"===h.overlayY?T.bottom=this._document.documentElement.clientHeight-(V.y+this._overlayRect.height)+"px":T.top=es(V.y),T}_getExactOverlayX(h,v,_){let te,T={left:"",right:""},V=this._getOverlayPoint(v,this._overlayRect,h);return this._isPushed&&(V=this._pushOverlayOnScreen(V,this._overlayRect,_)),te=this._isRtl()?"end"===h.overlayX?"left":"right":"end"===h.overlayX?"right":"left","right"===te?T.right=this._document.documentElement.clientWidth-(V.x+this._overlayRect.width)+"px":T.left=es(V.x),T}_getScrollVisibility(){const h=this._getOriginRect(),v=this._pane.getBoundingClientRect(),_=this._scrollables.map(T=>T.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:sf(h,_),isOriginOutsideView:tr(h,_),isOverlayClipped:sf(v,_),isOverlayOutsideView:tr(v,_)}}_subtractOverflows(h,...v){return v.reduce((_,T)=>_-Math.max(T,0),h)}_getNarrowedViewportRect(){const h=this._document.documentElement.clientWidth,v=this._document.documentElement.clientHeight,_=this._viewportRuler.getViewportScrollPosition();return{top:_.top+this._viewportMargin,left:_.left+this._viewportMargin,right:_.left+h-this._viewportMargin,bottom:_.top+v-this._viewportMargin,width:h-2*this._viewportMargin,height:v-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(h,v){return"x"===v?null==h.offsetX?this._offsetX:h.offsetX:null==h.offsetY?this._offsetY:h.offsetY}_validatePositions(){}_addPanelClasses(h){this._pane&&Xu(h).forEach(v=>{""!==v&&-1===this._appliedPanelClasses.indexOf(v)&&(this._appliedPanelClasses.push(v),this._pane.classList.add(v))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(h=>{this._pane.classList.remove(h)}),this._appliedPanelClasses=[])}_getOriginRect(){const h=this._origin;if(h instanceof K.SBq)return h.nativeElement.getBoundingClientRect();if(h instanceof Element)return h.getBoundingClientRect();const v=h.width||0,_=h.height||0;return{top:h.y,bottom:h.y+_,left:h.x,right:h.x+v,height:_,width:v}}}function Ru(E,h){for(let v in h)h.hasOwnProperty(v)&&(E[v]=h[v]);return E}function oh(E){if("number"!=typeof E&&null!=E){const[h,v]=E.split(_p);return v&&"px"!==v?null:parseFloat(h)}return E||null}function yp(E){return{top:Math.floor(E.top),right:Math.floor(E.right),bottom:Math.floor(E.bottom),left:Math.floor(E.left),width:Math.floor(E.width),height:Math.floor(E.height)}}const Om="cdk-global-overlay-wrapper";class km{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(h){const v=h.getConfig();this._overlayRef=h,this._width&&!v.width&&h.updateSize({width:this._width}),this._height&&!v.height&&h.updateSize({height:this._height}),h.hostElement.classList.add(Om),this._isDisposed=!1}top(h=""){return this._bottomOffset="",this._topOffset=h,this._alignItems="flex-start",this}left(h=""){return this._xOffset=h,this._xPosition="left",this}bottom(h=""){return this._topOffset="",this._bottomOffset=h,this._alignItems="flex-end",this}right(h=""){return this._xOffset=h,this._xPosition="right",this}start(h=""){return this._xOffset=h,this._xPosition="start",this}end(h=""){return this._xOffset=h,this._xPosition="end",this}width(h=""){return this._overlayRef?this._overlayRef.updateSize({width:h}):this._width=h,this}height(h=""){return this._overlayRef?this._overlayRef.updateSize({height:h}):this._height=h,this}centerHorizontally(h=""){return this.left(h),this._xPosition="center",this}centerVertically(h=""){return this.top(h),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const h=this._overlayRef.overlayElement.style,v=this._overlayRef.hostElement.style,_=this._overlayRef.getConfig(),{width:T,height:V,maxWidth:te,maxHeight:me}=_,je=!("100%"!==T&&"100vw"!==T||te&&"100%"!==te&&"100vw"!==te),ot=!("100%"!==V&&"100vh"!==V||me&&"100%"!==me&&"100vh"!==me),Zt=this._xPosition,cn=this._xOffset,di="rtl"===this._overlayRef.getConfig().direction;let si="",Un="",ei="";je?ei="flex-start":"center"===Zt?(ei="center",di?Un=cn:si=cn):di?"left"===Zt||"end"===Zt?(ei="flex-end",si=cn):("right"===Zt||"start"===Zt)&&(ei="flex-start",Un=cn):"left"===Zt||"start"===Zt?(ei="flex-start",si=cn):("right"===Zt||"end"===Zt)&&(ei="flex-end",Un=cn),h.position=this._cssPosition,h.marginLeft=je?"0":si,h.marginTop=ot?"0":this._topOffset,h.marginBottom=this._bottomOffset,h.marginRight=je?"0":Un,v.justifyContent=ei,v.alignItems=ot?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const h=this._overlayRef.overlayElement.style,v=this._overlayRef.hostElement,_=v.style;v.classList.remove(Om),_.justifyContent=_.alignItems=h.marginTop=h.marginBottom=h.marginLeft=h.marginRight=h.position="",this._overlayRef=null,this._isDisposed=!0}}let Lm=(()=>{var E;class h{constructor(_,T,V,te){this._viewportRuler=_,this._document=T,this._platform=V,this._overlayContainer=te}global(){return new km}flexibleConnectedTo(_){return new nu(_,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(Jh),K.LFG(zt.K0),K.LFG(yr),K.LFG(Pu))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})(),bp=0,xp=(()=>{var E;class h{constructor(_,T,V,te,me,je,ot,Zt,cn,di,si,Un){this.scrollStrategies=_,this._overlayContainer=T,this._componentFactoryResolver=V,this._positionBuilder=te,this._keyboardDispatcher=me,this._injector=je,this._ngZone=ot,this._document=Zt,this._directionality=cn,this._location=di,this._outsideClickDispatcher=si,this._animationsModuleType=Un}create(_){const T=this._createHostElement(),V=this._createPaneElement(T),te=this._createPortalOutlet(V),me=new pp(_);return me.direction=me.direction||this._directionality.value,new Rm(te,T,V,me,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(_){const T=this._document.createElement("div");return T.id="cdk-overlay-"+bp++,T.classList.add("cdk-overlay-pane"),_.appendChild(T),T}_createHostElement(){const _=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(_),_}_createPortalOutlet(_){return this._appRef||(this._appRef=this._injector.get(K.z2F)),new tu(_,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return(E=h).\u0275fac=function(_){return new(_||E)(K.LFG(pd),K.LFG(Pu),K.LFG(K._Vd),K.LFG(Lm),K.LFG(gd),K.LFG(K.zs3),K.LFG(K.R0b),K.LFG(zt.K0),K.LFG(Nd),K.LFG(zt.Ye),K.LFG(_d),K.LFG(K.QbO,8))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),h})();const Ep={provide:new K.OlP("cdk-connected-overlay-scroll-strategy"),deps:[xp],useFactory:function wp(E){return()=>E.scrollStrategies.reposition()}};let ul=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({providers:[xp,Ep],imports:[Gc,dd,tf,tf]}),h})();const $s={provide:new K.OlP("mat-menu-scroll-strategy"),deps:[xp],useFactory:function ah(E){return()=>E.scrollStrategies.reposition()}};let Mp=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E}),E.\u0275inj=K.cJS({providers:[$s],imports:[zt.ez,qc,id,ul,ud,id]}),h})(),Vm=(()=>{var E;class h{}return(E=h).\u0275fac=function(_){return new(_||E)},E.\u0275mod=K.oAB({type:E,bootstrap:[vt]}),E.\u0275inj=K.cJS({providers:[{provide:ht.TP,useClass:Fs,multi:!0}],imports:[S.b2,Gr,ct.UserModule,Ze.u5,zt.ez,ht.JF,Ze.UX,Hn,l.Aw.forRoot({}),Ji.forRoot([]),Ms,Je.FT.instrument({maxAge:25}),Wg,Mp]}),h})();S.q6().bootstrapModule(Vm).catch(E=>console.error(E))},2574:function(ut){ut.exports=function(){"use strict";var Ue,re,S;function Re(l,ge){if(Ue)if(re){var Ke="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ue+")(sharedChunk); ("+re+")(sharedChunk); self.onerror = null;",nt={};Ue(nt),S=ge(nt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(S.workerUrl=window.URL.createObjectURL(new Blob([Ke],{type:"text/javascript"})))}else re=ge;else Ue=ge}return Re(0,function(l){var ge=typeof self<"u"?self:{},Ke="2.15.0";let nt;const Ye={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==nt){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{nt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{nt=n}}return nt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ye.API_URL)return null;try{const n=new URL(Ye.API_URL);return"api.mapbox.cn"===n.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===n.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ge={supported:!1,testSupport:function(n){!ht&&at&&(Bt?zt(n):Xe=n)}};let Xe,at,ht=!1,Bt=!1;function zt(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,at),n.isContextLost())return;Ge.supported=!0}catch{}n.deleteTexture(e),ht=!0}ge.document&&(at=ge.document.createElement("img"),at.onload=function(){Xe&&zt(Xe),Xe=null,Bt=!0},at.onerror=function(){ht=!0,Xe=null},at.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const dn="01";function St(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Bn=Tn;function Tn(n,e,i,s){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=i,this.p2y=s}Tn.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(void 0===e&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var i=n,s=0;s<8;s++){var u=this.sampleCurveX(i)-n;if(Math.abs(u)<e)return i;var p=this.sampleCurveDerivativeX(i);if(Math.abs(p)<1e-6)break;i-=u/p}var y=0,x=1;for(i=n,s=0;s<20&&(u=this.sampleCurveX(i),!(Math.abs(u-n)<e));s++)n>u?y=i:x=i,i=.5*(x-y)+y;return i},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var kn=St(Bn),Dn=ft;function ft(n,e){this.x=n,this.y=e}ft.prototype={clone:function(){return new ft(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),i=Math.sin(n),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround:function(n,e){var i=Math.cos(n),s=Math.sin(n),u=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ft.convert=function(n){return n instanceof ft?n:Array.isArray(n)?new ft(n[0],n[1]):n};var Ze=St(Dn);const Xt=Math.PI/180,Pt=180/Math.PI;function qt(n){return n*Xt}function vn(n){return n*Pt}const Ti=[[0,0],[1,0],[1,1],[0,1]];function Ei(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function Li(n,e,i,s){const u=new kn(n,e,i,s);return function(p){return u.solve(p)}}const Mr=Li(.25,.1,.25,1);function hi(n,e,i){return Math.min(i,Math.max(e,n))}function mr(n,e,i){return(i=hi((i-n)/(e-n),0,1))*i*(3-2*i)}function Oi(n,e,i){const s=i-e,u=((n-e)%s+s)%s+e;return u===e?i:u}function ji(n,e,i){if(!n.length)return i(null,[]);let s=n.length;const u=new Array(n.length);let p=null;n.forEach((y,x)=>{e(y,(D,M)=>{D&&(p=D),u[x]=M,0==--s&&i(p,u)})})}function so(n){const e=[];for(const i in n)e.push(n[i]);return e}function _t(n,...e){for(const i of e)for(const s in i)n[s]=i[s];return n}let Nt=1;function Yt(){return Nt++}function Kt(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function bn(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function $t(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Vt(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Gt(n,e){return-1!==n.indexOf(e,n.length-e.length)}function zn(n,e,i){const s={};for(const u in n)s[u]=e.call(i||this,n[u],u,n);return s}function Yn(n,e,i){const s={};for(const u in n)e.call(i||this,n[u],u,n)&&(s[u]=n[u]);return s}function Ln(n){return Array.isArray(n)?n.map(Ln):"object"==typeof n&&n?zn(n,Ln):n}const ti={};function fi(n){ti[n]||(typeof console<"u"&&console.warn(n),ti[n]=!0)}function $i(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Gr(n){let e=0;for(let i,s,u=0,p=n.length,y=p-1;u<p;y=u++)i=n[u],s=n[y],e+=(s.x-i.x)*(i.y+s.y);return e}function vi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Zi(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,u,p)=>{const y=u||p;return e[s]=!y||y.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Do=null;function Yr(n){if(null==Do){const e=n.navigator?n.navigator.userAgent:null;Do=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Do}function sr(n){try{const e=ge[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function wr(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const bo="mapbox-tiles";let gi,Mi,To=500,ii=50;function Er(){try{return ge.caches}catch{}}function fo(){Er()&&!gi&&(gi=ge.caches.open(bo))}function po(n){const e=n.indexOf("?");if(e<0)return n;const s=function(u){const p=u.indexOf("?");return p>0?u.slice(p+1).split("&"):[]}(n).filter(u=>{const p=u.split("=");return"language"===p[0]||"worldview"===p[0]});return s.length?`${n.slice(0,e)}?${s.join("&")}`:n.slice(0,e)}let Gi=1/0;const Si={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Si);class Ao extends Error{constructor(e,i,s){401===i&&vt(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const nr=vi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ge.location.protocol?ge.parent:ge).location.href,xo=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(nr())&&!/^\w+:/.test(i))){if(ge.fetch&&ge.Request&&ge.AbortController&&ge.Request.prototype.hasOwnProperty("signal"))return function(s,u){const p=new ge.AbortController,y=new ge.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:nr(),referrerPolicy:s.referrerPolicy,signal:p.signal});let x=!1,D=!1;const M=(F=y.url).indexOf("sku=")>0&&vt(F);var F;"json"===s.type&&y.headers.set("Accept","application/json");const U=(G,Y,oe)=>{if(D)return;if(G&&"SecurityError"!==G.message&&fi(G.toString()),Y&&oe)return H(Y);const de=Date.now();ge.fetch(y).then(Ee=>{if(Ee.ok){const Ne=M?Ee.clone():null;return H(Ee,Ne,de)}return u(new Ao(Ee.statusText,Ee.status,s.url))}).catch(Ee=>{"AbortError"!==Ee.name&&u(new Error(`${Ee.message} ${s.url}`))})},H=(G,Y,oe)=>{("arrayBuffer"===s.type?G.arrayBuffer():"json"===s.type?G.json():G.text()).then(de=>{D||(Y&&oe&&function(Ee,Ne,Ce){if(fo(),!gi)return;const Fe={status:Ne.status,statusText:Ne.statusText,headers:new ge.Headers};Ne.headers.forEach((At,yt)=>Fe.headers.set(yt,At));const ze=Zi(Ne.headers.get("Cache-Control")||"");if(ze["no-store"])return;ze["max-age"]&&Fe.headers.set("Expires",new Date(Ce+1e3*ze["max-age"]).toUTCString());const We=Fe.headers.get("Expires");We&&(new Date(We).getTime()-Ce<42e4||function(At,yt){if(void 0===Mi)try{new Response(new ReadableStream),Mi=!0}catch{Mi=!1}Mi?yt(At.body):At.blob().then(yt)}(Ne,At=>{const yt=new ge.Response(At,Fe);fo(),gi&&gi.then(Wt=>Wt.put(po(Ee.url),yt)).catch(Wt=>fi(Wt.message))}))}(y,Y,oe),x=!0,u(null,de,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch(de=>{D||u(new Error(de.message))})};return M?function(G,Y){if(fo(),!gi)return Y(null);const oe=po(G.url);gi.then(de=>{de.match(oe).then(Ee=>{const Ne=function(Ce){if(!Ce)return!1;const Fe=new Date(Ce.headers.get("Expires")||0),ze=Zi(Ce.headers.get("Cache-Control")||"");return Fe>Date.now()&&!ze["no-cache"]}(Ee);de.delete(oe),Ne&&de.put(oe,Ee.clone()),Y(null,Ee,Ne)}).catch(Y)}).catch(Y)}(y,U):U(null,null),{cancel:()=>{D=!0,x||p.abort()}}}(n,e);if(vi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(s,u){const p=new ge.XMLHttpRequest;p.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(p.responseType="arraybuffer");for(const y in s.headers)p.setRequestHeader(y,s.headers[y]);return"json"===s.type&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials="include"===s.credentials,p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||0===p.status)&&null!==p.response){let y=p.response;if("json"===s.type)try{y=JSON.parse(p.response)}catch(x){return u(x)}u(null,y,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else u(new Ao(p.statusText,p.status,s.url))},p.send(s.body),{cancel:()=>p.abort()}}(n,e)},Hi=function(n,e){return xo(_t(n,{type:"arrayBuffer"}),e)};function Uo(n){const e=ge.document.createElement("a");return e.href=n,e.protocol===ge.document.location.protocol&&e.host===ge.document.location.host}const Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ce,ue;ce=[],ue=0;const Se=function(n,e){if(Ge.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),ue>=Ye.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ce.push(p),p}ue++;let i=!1;const s=()=>{if(!i)for(i=!0,ue--;ce.length&&ue<Ye.MAX_PARALLEL_IMAGE_REQUESTS;){const p=ce.shift(),{requestParameters:y,callback:x,cancelled:D}=p;D||(p.cancel=Se(y,x).cancel)}},u=Hi(n,(p,y,x,D)=>{s(),p?e(p):y&&(ge.createImageBitmap?function(M,F){const U=new ge.Blob([new Uint8Array(M)],{type:"image/png"});ge.createImageBitmap(U).then(H=>{F(null,H)}).catch(H=>{F(new Error(`Could not load image because of ${H.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(M,F)=>e(M,F,x,D)):function(M,F){const U=new ge.Image,H=ge.URL;U.onload=()=>{F(null,U),H.revokeObjectURL(U.src),U.onload=null,ge.requestAnimationFrame(()=>{U.src=Le})},U.onerror=()=>F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const G=new ge.Blob([new Uint8Array(M)],{type:"image/png"});U.src=M.byteLength?H.createObjectURL(G):Le}(y,(M,F)=>e(M,F,x,D)))});return{cancel:()=>{u.cancel(),s()}}},$e="NO_ACCESS_TOKEN";function it(n){return 0===n.indexOf("mapbox:")}function vt(n){return Ye.API_URL_REGEX.test(n)}function ct(n){return Ye.API_CDN_URL_REGEX.test(n)}function Je(n){return Ye.API_STYLE_REGEX.test(n)&&!wt(n)}function wt(n){return Ye.API_SPRITE_REGEX.test(n)}const an=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function fn(n){const e=n.match(an);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function qe(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}const He="mapbox.eventData";function pt(n){if(!n)return null;const e=n.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(ge.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ve{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=pt(Ye.ACCESS_TOKEN);let s="";return s=i&&i.u?ge.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,p)=>String.fromCharCode(+("0x"+p)))):Ye.ACCESS_TOKEN||"",e?`${He}.${e}:${s}`:`${He}:${s}`}fetchEventData(){const e=sr("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const u=ge.localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));const p=ge.localStorage.getItem(s);p&&(this.anonId=p)}catch{fi("Unable to read from LocalStorage")}}saveEventData(){const e=sr("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{ge.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&ge.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{fi("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,s,u){if(!Ye.EVENTS_URL)return;const p=fn(Ye.EVENTS_URL);p.params.push(`access_token=${u||Ye.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(e).toISOString()},x=i?_t(y,i):y,D={url:qe(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};var F;this.pendingRequest=(F=M=>{this.pendingRequest=null,s(M),this.saveEventData(),this.processRequests(u)},xo(_t(D,{method:"POST"}),F))}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const mt=new class extends Ve{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){Ye.EVENTS_URL&&Ye.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>it(i)||vt(i))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=pt(Ye.ACCESS_TOKEN),i=e?e.u:Ye.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;$t(this.anonId)||(this.anonId=Kt(),s=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),y=new Date(u),x=(u-this.eventData.lastSuccess)/864e5;s=s||x>=1||x<-1||p.getDate()!==y.getDate()}else s=!0;s?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ke,skuId:dn,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},n):this.processRequests()}},Ut=mt.postTurnstileEvent.bind(mt),_n=new class extends Ve{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,i,s){this.skuToken=e,this.errorCb=s,Ye.EVENTS_URL&&(i||Ye.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error($e)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),$t(this.anonId)||(this.anonId=Kt()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ke,skuId:dn,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n))}},Gn=_n.postMapLoadEvent.bind(_n),qn=new class extends Ve{constructor(){super("gljs.performance")}postPerformanceEvent(n,e){Ye.EVENTS_URL&&(n||Ye.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},n)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:i}=this.queue.shift(),s=function(u){const p=ge.performance.getEntriesByType("resource"),y=ge.performance.getEntriesByType("mark"),x=function(H){const G={};if(H)for(const Y in H)if("other"!==Y)for(const oe of H[Y]){const de=`${Y}ResolveRangeMin`,Ee=`${Y}ResolveRangeMax`,Ne=`${Y}RequestCount`,Ce=`${Y}RequestCachedCount`;G[de]=Math.min(G[de]||1/0,oe.startTime),G[Ee]=Math.max(G[Ee]||-1/0,oe.responseEnd);const Fe=ze=>{void 0===G[ze]&&(G[ze]=0),++G[ze]};void 0!==oe.transferSize&&0===oe.transferSize&&Fe(Ce),Fe(Ne)}return G}(function(H,G){const Y={};if(H)for(const oe of H){const de=G(oe);void 0===Y[de]&&(Y[de]=[]),Y[de].push(oe)}return Y}(p,Rt)),D=ge.devicePixelRatio,M=ge.navigator.connection||ge.navigator.mozConnection||ge.navigator.webkitConnection,F={counters:[],metadata:[],attributes:[]},U=(H,G,Y)=>{null!=Y&&H.push({name:G,value:Y.toString()})};for(const H in x)U(F.counters,H,x[H]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(U(F.counters,"interactionRangeMin",u.interactionRange[0]),U(F.counters,"interactionRangeMax",u.interactionRange[1])),y)for(const H of Object.keys(Be)){const G=Be[H],Y=y.find(oe=>oe.name===G);Y&&U(F.counters,G,Y.startTime)}return U(F.counters,"visibilityHidden",u.visibilityHidden),U(F.attributes,"style",function(H){if(H)for(const G of H){const Y=G.name.split("?")[0];if(Je(Y)){const oe=Y.split("/").slice(-2);if(2===oe.length)return`mapbox://styles/${oe[0]}/${oe[1]}`}}}(p)),U(F.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),U(F.attributes,"fogEnabled",u.fogEnabled?"true":"false"),U(F.attributes,"projection",u.projection),U(F.attributes,"zoom",u.zoom),U(F.metadata,"devicePixelRatio",D),U(F.metadata,"connectionEffectiveType",M?M.effectiveType:void 0),U(F.metadata,"navigatorUserAgent",ge.navigator.userAgent),U(F.metadata,"screenWidth",ge.screen.width),U(F.metadata,"screenHeight",ge.screen.height),U(F.metadata,"windowWidth",ge.innerWidth),U(F.metadata,"windowHeight",ge.innerHeight),U(F.metadata,"mapWidth",u.width/D),U(F.metadata,"mapHeight",u.height/D),U(F.metadata,"webglRenderer",u.renderer),U(F.metadata,"webglVendor",u.vendor),U(F.metadata,"sdkVersion",Ke),U(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(i);for(const u of s.metadata);for(const u of s.counters);for(const u of s.attributes);this.postEvent(e,s,()=>{},n)}},_i=qn.postPerformanceEvent.bind(qn),Cr=new class extends Ve{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,i,s){if(!Ye.API_URL||!Ye.SESSION_PATH)return;const u=fn(Ye.API_URL+Ye.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${s||Ye.ACCESS_TOKEN||""}`);const p={url:qe(u),headers:{"Content-Type":"text/plain"}};var x;this.pendingRequest=(x=y=>{this.pendingRequest=null,i(y),this.saveEventData(),this.processRequests(s)},xo(_t(p,{method:"GET"}),x))}getSessionAPI(n,e,i,s){this.skuToken=e,this.errorCb=s,Ye.SESSION_PATH&&Ye.API_URL&&(i||Ye.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error($e)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n)}},ur=Cr.getSessionAPI.bind(Cr),lt=new Set,Be={create:"create",load:"load",fullLoad:"fullLoad"},Ft={mark(n){ge.performance.mark(n)},measure(n,e,i){ge.performance.measure(n,e,i)}};function Rt(n){const e=n.name.split("?")[0];return ct(e)&&e.includes("mapbox-gl.js")?"javascript":ct(e)&&e.includes("mapbox-gl.css")?"css":Ye.API_FONTS_REGEX.test(e)?"fontRange":wt(e)?"sprite":Je(e)?"style":Ye.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const en=ge.performance;function wn(n){const e=n?n.url.toString():void 0;return en.getEntriesByName(e)}let Kn,An,qi,Ci;const dr={now:()=>void 0!==qi?qi:ge.performance.now(),setNow(n){qi=n},restoreNow(){qi=void 0},frame(n){const e=ge.requestAnimationFrame(n);return{cancel:()=>ge.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:s}=n;Ci||(Ci=ge.document.createElement("canvas"));const u=Ci.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>Ci.width||s>Ci.height)&&(Ci.width=i,Ci.height=s),u.clearRect(-e,-e,i+2*e,s+2*e),u.drawImage(n,0,0,i,s),u.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:n=>(Kn||(Kn=ge.document.createElement("a")),Kn.href=n,Kn.href),get devicePixelRatio(){return ge.devicePixelRatio},get prefersReducedMotion(){return!!ge.matchMedia&&(null==An&&(An=ge.matchMedia("(prefers-reduced-motion: reduce)")),An.matches)}};function Mo(n,e,i){i[n]&&-1!==i[n].indexOf(e)||(i[n]=i[n]||[],i[n].push(e))}function Ar(n,e,i){if(i&&i[n]){const s=i[n].indexOf(e);-1!==s&&i[n].splice(s,1)}}class Jr{constructor(e,i={}){_t(this,i),this.type=e}}class So extends Jr{constructor(e,i={}){super("error",_t({error:e},i))}}class qo{on(e,i){return this._listeners=this._listeners||{},Mo(e,i,this._listeners),this}off(e,i){return Ar(e,i,this._listeners),Ar(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Mo(e,i,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,i){"string"==typeof e&&(e=new Jr(e,i||{}));const s=e.type;if(this.listens(s)){e.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const x of u)x.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const x of p)Ar(s,x,this._oneTimeListeners),x.call(this,e);const y=this._eventedParent;y&&(_t(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof So&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var xt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Xi(n,...e){for(const i of e)for(const s in i)n[s]=i[s];return n}function ar(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Lr(n){if(Array.isArray(n))return n.map(Lr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Lr(n[i]);return e}return ar(n)}class Wr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var ao=Wr;class Vo{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,u]of i)this.bindings[s]=u}concat(e){return new Vo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Pr=Vo;const gs={kind:"null"},Sn={kind:"number"},ci={kind:"string"},mi={kind:"boolean"},mo={kind:"color"},jo={kind:"object"},Bi={kind:"value"},wo={kind:"collator"},da={kind:"formatted"},ks={kind:"resolvedImage"};function ts(n,e){return{kind:"array",itemType:n,N:e}}function Ur(n){if("array"===n.kind){const e=Ur(n.itemType);return"number"==typeof n.N?`array<${e}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${e}>`}return n.kind}const ls=[gs,Sn,ci,mi,mo,da,jo,ts(Bi),ks];function Oe(n,e){if("error"===e.kind)return null;if("array"===n.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Oe(n.itemType,e.itemType))&&("number"!=typeof n.N||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if("value"===n.kind)for(const i of ls)if(!Oe(i,e))return null}return`Expected ${Ur(n)} but found ${Ur(e)} instead.`}function Ot(n,e){return e.some(i=>i.kind===n.kind)}function tn(n,e){return e.some(i=>"null"===i?null===n:"array"===i?Array.isArray(n):"object"===i?n&&!Array.isArray(n)&&"object"==typeof n:i===typeof n)}var bt,yn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Nn(n){return(n=Math.round(n))<0?0:n>255?255:n}function xi(n){return Nn("%"===n[n.length-1]?parseFloat(n)/100*255:parseInt(n))}function Sr(n){return(e="%"===n[n.length-1]?parseFloat(n)/100:parseFloat(n))<0?0:e>1?1:e;var e}function gr(n,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?n+(e-n)*i*6:2*i<1?e:3*i<2?n+(e-n)*(2/3-i)*6:n}try{bt={}.parseCSSColor=function(n){var e,i=n.replace(/ /g,"").toLowerCase();if(i in yn)return yn[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=i.indexOf("("),u=i.indexOf(")");if(-1!==s&&u+1===i.length){var p=i.substr(0,s),y=i.substr(s+1,u-(s+1)).split(","),x=1;switch(p){case"rgba":if(4!==y.length)return null;x=Sr(y.pop());case"rgb":return 3!==y.length?null:[xi(y[0]),xi(y[1]),xi(y[2]),x];case"hsla":if(4!==y.length)return null;x=Sr(y.pop());case"hsl":if(3!==y.length)return null;var D=(parseFloat(y[0])%360+360)%360/360,M=Sr(y[1]),F=Sr(y[2]),U=F<=.5?F*(M+1):F+M-F*M,H=2*F-U;return[Nn(255*gr(H,U,D+1/3)),Nn(255*gr(H,U,D)),Nn(255*gr(H,U,D-1/3)),x];default:return null}}return null}}catch{}class ri{constructor(e,i,s,u=1){this.r=e,this.g=i,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof ri)return e;if("string"!=typeof e)return;const i=bt(e);return i?new ri(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,s,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${u})`}toArray(){const{r:e,g:i,b:s,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*i/u,255*s/u,u]}toArray01(){const{r:e,g:i,b:s,a:u}=this;return 0===u?[0,0,0,0]:[e/u,i/u,s/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:s,a:u}=this;return[e,i,s,u]}}ri.black=new ri(0,0,0,1),ri.white=new ri(1,1,1,1),ri.transparent=new ri(0,0,0,0),ri.red=new ri(1,0,0,1),ri.blue=new ri(0,0,1,1);var Jn=ri;class br{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qr{constructor(e,i,s,u,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=u,this.textColor=p}}class Ji{constructor(e){this.sections=e}static fromString(e){return new Ji([new Qr(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Ji?e:Ji.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(s)}return e}}class Io{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Io({name:e,available:!1}):null}serialize(){return["image",this.name]}}function el(n,e,i,s){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[n,e,i,s]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ea(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof Jn||n instanceof br||n instanceof Ji||n instanceof Io)return!0;if(Array.isArray(n)){for(const e of n)if(!ea(e))return!1;return!0}if("object"==typeof n){for(const e in n)if(!ea(n[e]))return!1;return!0}return!1}function Dr(n){if(null===n)return gs;if("string"==typeof n)return ci;if("boolean"==typeof n)return mi;if("number"==typeof n)return Sn;if(n instanceof Jn)return mo;if(n instanceof br)return wo;if(n instanceof Ji)return da;if(n instanceof Io)return ks;if(Array.isArray(n)){const e=n.length;let i;for(const s of n){const u=Dr(s);if(i){if(i===u)continue;i=Bi;break}i=u}return ts(i||Bi,e)}return jo}function za(n){const e=typeof n;return null===n?"":"string"===e||"number"===e||"boolean"===e?String(n):n instanceof Jn||n instanceof Ji||n instanceof Io?n.toString():JSON.stringify(n)}class Vr{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ea(e[1]))return i.error("invalid value");const s=e[1];let u=Dr(s);const p=i.expectedType;return"array"!==u.kind||0!==u.N||!p||"array"!==p.kind||"number"==typeof p.N&&0!==p.N||(u=p),new Vr(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Jn?["rgba"].concat(this.value.toArray()):this.value instanceof Ji?this.value.serialize():this.value}}var $n=Vr,oi=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const xr={string:ci,number:Sn,boolean:mi,object:jo};class Po{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,u=1;const p=e[0];if("array"===p){let x,D;if(e.length>2){const M=e[1];if("string"!=typeof M||!(M in xr)||"object"===M)return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=xr[M],u++}else x=Bi;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);D=e[2],u++}s=ts(x,D)}else s=xr[p];const y=[];for(;u<e.length;u++){const x=i.parse(e[u],u,Bi);if(!x)return null;y.push(x)}return new Po(s,y)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!Oe(this.type,Dr(s)))return s;if(i===this.args.length-1)throw new oi(`Expected value to be of type ${Ur(this.type)}, but found ${Ur(Dr(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){i.push(s.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(s=>s.serialize()))}}var Ro=Po;class jr{constructor(e){this.type=da,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return i.error("First argument must be an image or text section.");const u=[];let p=!1;for(let y=1;y<=e.length-1;++y){const x=e[y];if(p&&"object"==typeof x&&!Array.isArray(x)){p=!1;let D=null;if(x["font-scale"]&&(D=i.parse(x["font-scale"],1,Sn),!D))return null;let M=null;if(x["text-font"]&&(M=i.parse(x["text-font"],1,ts(ci)),!M))return null;let F=null;if(x["text-color"]&&(F=i.parse(x["text-color"],1,mo),!F))return null;const U=u[u.length-1];U.scale=D,U.font=M,U.textColor=F}else{const D=i.parse(e[y],1,Bi);if(!D)return null;const M=D.type.kind;if("string"!==M&&"value"!==M&&"null"!==M&&"resolvedImage"!==M)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:D,scale:null,font:null,textColor:null})}}return new jr(u)}evaluate(e){return new Ji(this.sections.map(i=>{const s=i.content.evaluate(e);return Dr(s)===ks?new Qr("",s,null,null,null):new Qr(za(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class Ds{constructor(e){this.type=ks,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");const s=i.parse(e[1],1,ci);return s?new Ds(s):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),s=Io.fromString(i);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(i)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const go={"to-boolean":mi,"to-color":mo,"to-number":Sn,"to-string":ci};class $o{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return i.error("Expected one argument.");const u=go[s],p=[];for(let y=1;y<e.length;y++){const x=i.parse(e[y],y,Bi);if(!x)return null;p.push(x)}return new $o(u,p)}evaluate(e){if("boolean"===this.type.kind)return!!this.args[0].evaluate(e);if("color"===this.type.kind){let i,s;for(const u of this.args){if(i=u.evaluate(e),s=null,i instanceof Jn)return i;if("string"==typeof i){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:el(i[0],i[1],i[2],i[3]),!s))return new Jn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new oi(s||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const s of this.args){if(i=s.evaluate(e),null===i)return 0;const u=Number(i);if(!isNaN(u))return u}throw new oi(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?Ji.fromString(za(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Io.fromString(za(this.args[0].evaluate(e))):za(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new jr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ds(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var cs=$o;const bi=["Unknown","Point","LineString","Polygon"];var Ts=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?bi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-n[0])+this.featureDistanceData.bearing[1]*(s*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=Jn.parse(n)),e}};class Ls{constructor(e,i,s,u){this.name=e,this.type=i,this._evaluate=s,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],u=Ls.definitions[s];if(!u)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,y=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=y.filter(([M])=>!Array.isArray(M)||M.length===e.length-1);let D=null;for(const[M,F]of x){D=new Is(i.registry,i.path,null,i.scope);const U=[];let H=!1;for(let G=1;G<e.length;G++){const Y=e[G],oe=Array.isArray(M)?M[G-1]:M.type,de=D.parse(Y,1+U.length,oe);if(!de){H=!0;break}U.push(de)}if(!H)if(Array.isArray(M)&&M.length!==U.length)D.error(`Expected ${M.length} arguments, but found ${U.length} instead.`);else{for(let G=0;G<U.length;G++){const Y=Array.isArray(M)?M[G]:M.type,oe=U[G];D.concat(G+1).checkSubtype(Y,oe.type)}if(0===D.errors.length)return new Ls(s,p,F,U)}}if(1===x.length)i.errors.push(...D.errors);else{const M=(x.length?x:y).map(([U])=>{return H=U,Array.isArray(H)?`(${H.map(Ur).join(", ")})`:`(${Ur(H.type)}...)`;var H}).join(" | "),F=[];for(let U=1;U<e.length;U++){const H=i.parse(e[U],1+F.length);if(!H)return null;F.push(Ur(H.type))}i.error(`Expected arguments of type ${M}, but found (${F.join(", ")}) instead.`)}return null}static register(e,i){Ls.definitions=i;for(const s in i)e[s]=Ls}}var ns=Ls;class Fr{constructor(e,i,s){this.type=wo,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return i.error("Collator options argument must be an object.");const u=i.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,mi);if(!u)return null;const p=i.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,mi);if(!p)return null;let y=null;return s.locale&&(y=i.parse(s.locale,1,ci),!y)?null:new Fr(u,p,y)}evaluate(e){return new br(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const is=8192;function Ws(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Ko(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function _s(n,e){const i=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*is),Math.round(s*u*is)]}function tl(n,e,i){const s=n[0]-e[0],u=n[1]-e[1],p=n[0]-i[0],y=n[1]-i[1];return s*y-p*u==0&&s*p<=0&&u*y<=0}function ys(n,e){let i=!1;for(let y=0,x=e.length;y<x;y++){const D=e[y];for(let M=0,F=D.length;M<F-1;M++){if(tl(n,D[M],D[M+1]))return!1;(u=D[M])[1]>(s=n)[1]!=(p=D[M+1])[1]>s[1]&&s[0]<(p[0]-u[0])*(s[1]-u[1])/(p[1]-u[1])+u[0]&&(i=!i)}}var s,u,p;return i}function Ms(n,e){for(let i=0;i<e.length;i++)if(ys(n,e[i]))return!0;return!1}function Fs(n,e,i,s){const u=s[0]-i[0],p=s[1]-i[1],y=(n[0]-i[0])*p-u*(n[1]-i[1]),x=(e[0]-i[0])*p-u*(e[1]-i[1]);return y>0&&x<0||y<0&&x>0}function Zs(n,e,i){for(const M of i)for(let F=0;F<M.length-1;++F)if((x=[(y=M[F+1])[0]-(p=M[F])[0],y[1]-p[1]])[0]*(D=[(u=e)[0]-(s=n)[0],u[1]-s[1]])[1]-x[1]*D[0]!=0&&Fs(s,u,p,y)&&Fs(p,y,s,u))return!0;var s,u,p,y,x,D;return!1}function Xn(n,e){for(let i=0;i<n.length;++i)if(!ys(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Zs(n[i],n[i+1],e))return!1;return!0}function Dc(n,e){for(let i=0;i<e.length;i++)if(Xn(n,e[i]))return!0;return!1}function Ua(n,e,i){const s=[];for(let u=0;u<n.length;u++){const p=[];for(let y=0;y<n[u].length;y++){const x=_s(n[u][y],i);Ws(e,x),p.push(x)}s.push(p)}return s}function pl(n,e,i){const s=[];for(let u=0;u<n.length;u++){const p=Ua(n[u],e,i);s.push(p)}return s}function Yo(n,e,i,s){if(n[0]<i[0]||n[0]>i[2]){const u=.5*s;let p=n[0]-i[0]>u?-s:i[0]-n[0]>u?s:0;0===p&&(p=n[0]-i[2]>u?-s:i[2]-n[0]>u?s:0),n[0]+=p}Ws(e,n)}function qs(n,e,i,s){const u=Math.pow(2,s.z)*is,p=[s.x*is,s.y*is],y=[];if(!n)return y;for(const x of n)for(const D of x){const M=[D.x+p[0],D.y+p[1]];Yo(M,e,i,u),y.push(M)}return y}function Oo(n,e,i,s){const u=Math.pow(2,s.z)*is,p=[s.x*is,s.y*is],y=[];if(!n)return y;for(const D of n){const M=[];for(const F of D){const U=[F.x+p[0],F.y+p[1]];Ws(e,U),M.push(U)}y.push(M)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const D of y)for(const M of D)Yo(M,e,i,u)}var x;return y}class Ns{constructor(e,i){this.type=mi,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ea(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let u=0;u<s.features.length;++u){const p=s.features[u].geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new Ns(s,s.features[u].geometry)}else if("Feature"===s.type){const u=s.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new Ns(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new Ns(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(i,s){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if(!y)return!1;if("Polygon"===s.type){const x=Ua(s.coordinates,p,y),D=qs(i.geometry(),u,p,y);if(!Ko(u,p))return!1;for(const M of D)if(!ys(M,x))return!1}if("MultiPolygon"===s.type){const x=pl(s.coordinates,p,y),D=qs(i.geometry(),u,p,y);if(!Ko(u,p))return!1;for(const M of D)if(!Ms(M,x))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(i,s){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if(!y)return!1;if("Polygon"===s.type){const x=Ua(s.coordinates,p,y),D=Oo(i.geometry(),u,p,y);if(!Ko(u,p))return!1;for(const M of D)if(!Xn(M,x))return!1}if("MultiPolygon"===s.type){const x=pl(s.coordinates,p,y),D=Oo(i.geometry(),u,p,y);if(!Ko(u,p))return!1;for(const M of D)if(!Dc(M,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Zr=Ns;function ml(n){if(n instanceof ns&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof Zr)return!1;let e=!0;return n.eachChild(i=>{e&&!ml(i)&&(e=!1)}),e}function lo(n){if(n instanceof ns&&"feature-state"===n.name)return!1;let e=!0;return n.eachChild(i=>{e&&!lo(i)&&(e=!1)}),e}function Eo(n,e){if(n instanceof ns&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(s=>{i&&!Eo(s,e)&&(i=!1)}),i}class ta{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new ta(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ss=ta;class na{constructor(e,i=[],s,u=new Pr,p=[]){this.registry=e,this.path=i,this.key=i.map(y=>`[${y}]`).join(""),this.scope=u,this.errors=p,this.expectedType=s}parse(e,i,s,u,p={}){return i?this.concat(i,s,u)._parse(e,p):this._parse(e,p)}_parse(e,i){function s(u,p,y){return"assert"===y?new Ro(p,[u]):"coerce"===y?new cs(p,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let y=p.parse(e,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,D=y.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==D.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==D.kind&&"string"!==D.kind){if(this.checkSubtype(x,D))return null}else y=s(y,x,i.typeAnnotation||"coerce");else y=s(y,x,i.typeAnnotation||"assert")}if(!(y instanceof $n)&&"resolvedImage"!==y.type.kind&&Ks(y)){const x=new Ts;try{y=new $n(y.type,y.evaluate(x))}catch(D){return this.error(D.message),null}}return y}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s){const u="number"==typeof e?this.path.concat(e):this.path,p=s?this.scope.concat(s):this.scope;return new na(this.registry,u,i||null,p,this.errors)}error(e,...i){const s=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new ao(s,e))}checkSubtype(e,i){const s=Oe(e,i);return s&&this.error(s),s}}var Is=na;function Ks(n){if(n instanceof Ss)return Ks(n.boundExpression);if(n instanceof ns&&"error"===n.name||n instanceof Fr||n instanceof Zr)return!1;const e=n instanceof cs||n instanceof Ro;let i=!0;return n.eachChild(s=>{i=e?i&&Ks(s):i&&s instanceof $n}),!!i&&ml(n)&&Eo(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ha(n,e){const i=n.length-1;let s,u,p=0,y=i,x=0;for(;p<=y;)if(x=Math.floor((p+y)/2),s=n[x],u=n[x+1],s<=e){if(x===i||e<u)return x;p=x+1}else{if(!(s>e))throw new oi("Input is not a number.");y=x-1}return 0}class Va{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,p]of s)this.labels.push(u),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Sn);if(!s)return null;const u=[];let p=null;i.expectedType&&"value"!==i.expectedType.kind&&(p=i.expectedType);for(let y=1;y<e.length;y+=2){const x=1===y?-1/0:e[y],D=e[y+1],M=y,F=y+1;if("number"!=typeof x)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const U=i.parse(D,F,p);if(!U)return null;p=p||U.type,u.push([x,U])}return new Va(p,s,u)}evaluate(e){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const p=i.length;return u>=i[p-1]?s[p-1].evaluate(e):s[ha(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Jl=Va;function Ki(n,e,i){return n*(1-i)+e*i}var ia=Object.freeze({__proto__:null,array:function(n,e,i){return n.map((s,u)=>Ki(s,e[u],i))},color:function(n,e,i){return new Jn(Ki(n.r,e.r,i),Ki(n.g,e.g,i),Ki(n.b,e.b,i),Ki(n.a,e.a,i))},number:Ki});const ou=4/29,nl=6/29,co=3*nl*nl,su=nl*nl*nl,Bu=Math.PI/180,ne=180/Math.PI;function Q(n){return n>su?Math.pow(n,1/3):n/co+ou}function ye(n){return n>nl?n*n*n:co*(n-ou)}function ie(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Ae(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Pn(n){const e=Ae(n.r),i=Ae(n.g),s=Ae(n.b),u=Q((.4124564*e+.3575761*i+.1804375*s)/.95047),p=Q((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-Q((.0193339*e+.119192*i+.9503041*s)/1.08883)),alpha:n.a}}function Ii(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*ye(e),i=.95047*ye(i),s=1.08883*ye(s),new Jn(ie(3.2404542*i-1.5371385*e-.4985314*s),ie(-.969266*i+1.8760108*e+.041556*s),ie(.0556434*i-.2040259*e+1.0572252*s),n.alpha)}function Ho(n,e,i){const s=e-n;return n+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const _o={forward:Pn,reverse:Ii,interpolate:function(n,e,i){return{l:Ki(n.l,e.l,i),a:Ki(n.a,e.a,i),b:Ki(n.b,e.b,i),alpha:Ki(n.alpha,e.alpha,i)}}},us={forward:function(n){const{l:e,a:i,b:s}=Pn(n),u=Math.atan2(s,i)*ne;return{h:u<0?u+360:u,c:Math.sqrt(i*i+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Bu,i=n.c;return Ii({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Ho(n.h,e.h,i),c:Ki(n.c,e.c,i),l:Ki(n.l,e.l,i),alpha:Ki(n.alpha,e.alpha,i)}}};var ko=Object.freeze({__proto__:null,hcl:us,lab:_o});class Bs{constructor(e,i,s,u,p){this.type=e,this.operator=i,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[y,x]of p)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(e,i,s,u){let p=0;if("exponential"===e.name)p=Da(i,e.base,s,u);else if("linear"===e.name)p=Da(i,1,s,u);else if("cubic-bezier"===e.name){const y=e.controlPoints;p=new kn(y[0],y[1],y[2],y[3]).solve(Da(i,1,s,u))}return p}static parse(e,i){let[s,u,p,...y]=e;if(!Array.isArray(u)||0===u.length)return i.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const M=u[1];if("number"!=typeof M)return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if("cubic-bezier"!==u[0])return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(4!==M.length||M.some(F=>"number"!=typeof F||F<0||F>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,Sn),!p)return null;const x=[];let D=null;"interpolate-hcl"===s||"interpolate-lab"===s?D=mo:i.expectedType&&"value"!==i.expectedType.kind&&(D=i.expectedType);for(let M=0;M<y.length;M+=2){const F=y[M],U=y[M+1],H=M+3,G=M+4;if("number"!=typeof F)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(x.length&&x[x.length-1][0]>=F)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const Y=i.parse(U,G,D);if(!Y)return null;D=D||Y.type,x.push([F,Y])}return"number"===D.kind||"color"===D.kind||"array"===D.kind&&"number"===D.itemType.kind&&"number"==typeof D.N?new Bs(D,s,u,p,x):i.error(`Type ${Ur(D)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const p=i.length;if(u>=i[p-1])return s[p-1].evaluate(e);const y=ha(i,u),x=Bs.interpolationFactor(this.interpolation,u,i[y],i[y+1]),D=s[y].evaluate(e),M=s[y+1].evaluate(e);return"interpolate"===this.operator?ia[this.type.kind.toLowerCase()](D,M,x):"interpolate-hcl"===this.operator?us.reverse(us.interpolate(us.forward(D),us.forward(M),x)):_o.reverse(_o.interpolate(_o.forward(D),_o.forward(M),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function Da(n,e,i,s){const u=s-i,p=n-i;return 0===u?0:1===e?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}var Nr=Bs;class gl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const u=i.expectedType;u&&"value"!==u.kind&&(s=u);const p=[];for(const x of e.slice(1)){const D=i.parse(x,1+p.length,s,void 0,{typeAnnotation:"omit"});if(!D)return null;s=s||D.type,p.push(D)}const y=u&&p.some(x=>Oe(u,x.type));return new gl(y?Bi:s,p)}evaluate(e){let i,s=null,u=0;for(const p of this.args){if(u++,s=p.evaluate(e),s&&s instanceof Io&&!s.available&&(i||(i=s),s=null,u===this.args.length))return i;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var _l=gl;class Ta{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let p=1;p<e.length-1;p+=2){const y=e[p];if("string"!=typeof y)return i.error(`Expected string, but found ${typeof y} instead.`,p);if(/[^a-zA-Z0-9_]/.test(y))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=i.parse(e[p+1],p+1);if(!x)return null;s.push([y,x])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return u?new Ta(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}var Ma=Ta;class Sa{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Sn),u=i.parse(e[2],2,ts(i.expectedType||Bi));return s&&u?new Sa(u.type.itemType,s,u):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new oi(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new oi(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new oi(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var au=Sa;class zs{constructor(e,i){this.type=mi,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Bi),u=i.parse(e[2],2,Bi);return s&&u?Ot(s.type,[mi,ci,Sn,gs,Bi])?new zs(s,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ur(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!tn(i,["boolean","string","number","null"]))throw new oi(`Expected first argument to be of type boolean, string, number or null, but found ${Ur(Dr(i))} instead.`);if(!tn(s,["string","array"]))throw new oi(`Expected second argument to be of type array or string, but found ${Ur(Dr(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ja=zs;class yo{constructor(e,i,s){this.type=Sn,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Bi),u=i.parse(e[2],2,Bi);if(!s||!u)return null;if(!Ot(s.type,[mi,ci,Sn,gs,Bi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ur(s.type)} instead`);if(4===e.length){const p=i.parse(e[3],3,Sn);return p?new yo(s,u,p):null}return new yo(s,u)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!tn(i,["boolean","string","number","null"]))throw new oi(`Expected first argument to be of type boolean, string, number or null, but found ${Ur(Dr(i))} instead.`);if(!tn(s,["string","array"]))throw new oi(`Expected second argument to be of type array or string, but found ${Ur(Dr(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(i,u)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var yl=yo;class vl{constructor(e,i,s,u,p,y){this.inputType=e,this.type=i,this.input=s,this.cases=u,this.outputs=p,this.otherwise=y}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,u;i.expectedType&&"value"!==i.expectedType.kind&&(u=i.expectedType);const p={},y=[];for(let M=2;M<e.length-1;M+=2){let F=e[M];const U=e[M+1];Array.isArray(F)||(F=[F]);const H=i.concat(M);if(0===F.length)return H.error("Expected at least one branch label.");for(const Y of F){if("number"!=typeof Y&&"string"!=typeof Y)return H.error("Branch labels must be numbers or strings.");if("number"==typeof Y&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof Y&&Math.floor(Y)!==Y)return H.error("Numeric branch labels must be integer values.");if(s){if(H.checkSubtype(s,Dr(Y)))return null}else s=Dr(Y);if(void 0!==p[String(Y)])return H.error("Branch labels must be unique.");p[String(Y)]=y.length}const G=i.parse(U,M,u);if(!G)return null;u=u||G.type,y.push(G)}const x=i.parse(e[1],1,Bi);if(!x)return null;const D=i.parse(e[e.length-1],e.length-1,u);return D?"value"!==x.type.kind&&i.concat(1).checkSubtype(s,x.type)?null:new vl(s,u,x,p,y,D):null}evaluate(e){const i=this.input.evaluate(e);return(Dr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],u={};for(const y of i){const x=u[this.cases[y]];void 0===x?(u[this.cases[y]]=s.length,s.push([this.cases[y],[y]])):s[x][1].push(y)}const p=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,x]of s)e.push(1===x.length?p(x[0]):x.map(p)),e.push(this.outputs[y].serialize());return e.push(this.otherwise.serialize()),e}}var Mc=vl;class bl{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&"value"!==i.expectedType.kind&&(s=i.expectedType);const u=[];for(let y=1;y<e.length-1;y+=2){const x=i.parse(e[y],y,mi);if(!x)return null;const D=i.parse(e[y+1],y+1,s);if(!D)return null;u.push([x,D]),s=s||D.type}const p=i.parse(e[e.length-1],e.length-1,s);return p?new bl(s,u,p):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var il=bl;class Sl{constructor(e,i,s,u){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Bi),u=i.parse(e[2],2,Sn);if(!s||!u)return null;if(!Ot(s.type,[ts(Bi),ci,Bi]))return i.error(`Expected first argument to be of type array or string, but found ${Ur(s.type)} instead`);if(4===e.length){const p=i.parse(e[3],3,Sn);return p?new Sl(s.type,s,u,p):null}return new Sl(s.type,s,u)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!tn(i,["string","array"]))throw new oi(`Expected first argument to be of type array or string, but found ${Ur(Dr(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(s,u)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Sc=Sl;function Ia(n,e){return"=="===n||"!="===n?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function xl(n,e,i,s){return 0===s.compare(e,i)}function fa(n,e,i){const s="=="!==n&&"!="!==n;return class Wx{constructor(p,y,x){this.type=mi,this.lhs=p,this.rhs=y,this.collator=x,this.hasUntypedArgument="value"===p.type.kind||"value"===y.type.kind}static parse(p,y){if(3!==p.length&&4!==p.length)return y.error("Expected two or three arguments.");const x=p[0];let D=y.parse(p[1],1,Bi);if(!D)return null;if(!Ia(x,D.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${Ur(D.type)}'.`);let M=y.parse(p[2],2,Bi);if(!M)return null;if(!Ia(x,M.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${Ur(M.type)}'.`);if(D.type.kind!==M.type.kind&&"value"!==D.type.kind&&"value"!==M.type.kind)return y.error(`Cannot compare types '${Ur(D.type)}' and '${Ur(M.type)}'.`);s&&("value"===D.type.kind&&"value"!==M.type.kind?D=new Ro(M.type,[D]):"value"!==D.type.kind&&"value"===M.type.kind&&(M=new Ro(D.type,[M])));let F=null;if(4===p.length){if("string"!==D.type.kind&&"string"!==M.type.kind&&"value"!==D.type.kind&&"value"!==M.type.kind)return y.error("Cannot use collator to compare non-string types.");if(F=y.parse(p[3],3,wo),!F)return null}return new Wx(D,M,F)}evaluate(p){const y=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(s&&this.hasUntypedArgument){const D=Dr(y),M=Dr(x);if(D.kind!==M.kind||"string"!==D.kind&&"number"!==D.kind)throw new oi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${D.kind}, ${M.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const D=Dr(y),M=Dr(x);if("string"!==D.kind||"string"!==M.kind)return e(p,y,x)}return this.collator?i(p,y,x,this.collator.evaluate(p)):e(p,y,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[n];return this.eachChild(y=>{p.push(y.serialize())}),p}}}const $a=fa("==",function(n,e,i){return e===i},xl),ec=fa("!=",function(n,e,i){return e!==i},function(n,e,i,s){return!xl(0,e,i,s)}),lu=fa("<",function(n,e,i){return e<i},function(n,e,i,s){return s.compare(e,i)<0}),cu=fa(">",function(n,e,i){return e>i},function(n,e,i,s){return s.compare(e,i)>0}),pa=fa("<=",function(n,e,i){return e<=i},function(n,e,i,s){return s.compare(e,i)<=0}),tc=fa(">=",function(n,e,i){return e>=i},function(n,e,i,s){return s.compare(e,i)>=0});class Ha{constructor(e,i,s,u,p,y){this.type=ci,this.number=e,this.locale=i,this.currency=s,this.unit=u,this.minFractionDigits=p,this.maxFractionDigits=y}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Sn);if(!s)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=i.parse(u.locale,1,ci),!p))return null;let y=null;if(u.currency&&(y=i.parse(u.currency,1,ci),!y))return null;let x=null;if(u.unit&&(x=i.parse(u.unit,1,ci),!x))return null;let D=null;if(u["min-fraction-digits"]&&(D=i.parse(u["min-fraction-digits"],1,Sn),!D))return null;let M=null;return u["max-fraction-digits"]&&(M=i.parse(u["max-fraction-digits"],1,Sn),!M)?null:new Ha(s,p,y,x,D,M)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class rl{constructor(e){this.type=Sn,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?i.error(`Expected argument of type string or array, but found ${Ur(s.type)} instead.`):new rl(s):null}evaluate(e){const i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new oi(`Expected value to be of type string or array, but found ${Ur(Dr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Ga={"==":$a,"!=":ec,">":cu,"<":lu,">=":tc,"<=":pa,array:Ro,at:au,boolean:Ro,case:il,coalesce:_l,collator:Fr,format:jr,image:Ds,in:ja,"index-of":yl,interpolate:Nr,"interpolate-hcl":Nr,"interpolate-lab":Nr,length:rl,let:Ma,literal:$n,match:Mc,number:Ro,"number-format":Ha,object:Ro,slice:Sc,step:Jl,string:Ro,"to-boolean":cs,"to-color":cs,"to-number":cs,"to-string":cs,var:Ss,within:Zr};function nc(n,[e,i,s,u]){e=e.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const p=u?u.evaluate(n):1,y=el(e,i,s,p);if(y)throw new oi(y);return new Jn(e/255*p,i/255*p,s/255*p,p)}function Aa(n,e){return n in e}function Pa(n,e){const i=e[n];return void 0===i?null:i}function Bo(n){return{type:n}}ns.register(Ga,{error:[{kind:"error"},[ci],(n,[e])=>{throw new oi(e.evaluate(n))}],typeof:[ci,[Bi],(n,[e])=>Ur(Dr(e.evaluate(n)))],"to-rgba":[ts(Sn,4),[mo],(n,[e])=>e.evaluate(n).toArray()],rgb:[mo,[Sn,Sn,Sn],nc],rgba:[mo,[Sn,Sn,Sn,Sn],nc],has:{type:mi,overloads:[[[ci],(n,[e])=>Aa(e.evaluate(n),n.properties())],[[ci,jo],(n,[e,i])=>Aa(e.evaluate(n),i.evaluate(n))]]},get:{type:Bi,overloads:[[[ci],(n,[e])=>Pa(e.evaluate(n),n.properties())],[[ci,jo],(n,[e,i])=>Pa(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Bi,[ci],(n,[e])=>Pa(e.evaluate(n),n.featureState||{})],properties:[jo,[],n=>n.properties()],"geometry-type":[ci,[],n=>n.geometryType()],id:[Bi,[],n=>n.id()],zoom:[Sn,[],n=>n.globals.zoom],pitch:[Sn,[],n=>n.globals.pitch||0],"distance-from-center":[Sn,[],n=>n.distanceFromCenter()],"heatmap-density":[Sn,[],n=>n.globals.heatmapDensity||0],"line-progress":[Sn,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[Sn,[],n=>n.globals.skyRadialProgress||0],accumulated:[Bi,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[Sn,Bo(Sn),(n,e)=>{let i=0;for(const s of e)i+=s.evaluate(n);return i}],"*":[Sn,Bo(Sn),(n,e)=>{let i=1;for(const s of e)i*=s.evaluate(n);return i}],"-":{type:Sn,overloads:[[[Sn,Sn],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Sn],(n,[e])=>-e.evaluate(n)]]},"/":[Sn,[Sn,Sn],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Sn,[Sn,Sn],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Sn,[],()=>Math.LN2],pi:[Sn,[],()=>Math.PI],e:[Sn,[],()=>Math.E],"^":[Sn,[Sn,Sn],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Sn,[Sn],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Sn,[Sn],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Sn,[Sn],(n,[e])=>Math.log(e.evaluate(n))],log2:[Sn,[Sn],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Sn,[Sn],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Sn,[Sn],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Sn,[Sn],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Sn,[Sn],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Sn,[Sn],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Sn,[Sn],(n,[e])=>Math.atan(e.evaluate(n))],min:[Sn,Bo(Sn),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Sn,Bo(Sn),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Sn,[Sn],(n,[e])=>Math.abs(e.evaluate(n))],round:[Sn,[Sn],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Sn,[Sn],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Sn,[Sn],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[mi,[ci,Bi],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[mi,[Bi],(n,[e])=>n.id()===e.value],"filter-type-==":[mi,[ci],(n,[e])=>n.geometryType()===e.value],"filter-<":[mi,[ci,Bi],(n,[e,i])=>{const s=n.properties()[e.value],u=i.value;return typeof s==typeof u&&s<u}],"filter-id-<":[mi,[Bi],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[mi,[ci,Bi],(n,[e,i])=>{const s=n.properties()[e.value],u=i.value;return typeof s==typeof u&&s>u}],"filter-id->":[mi,[Bi],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[mi,[ci,Bi],(n,[e,i])=>{const s=n.properties()[e.value],u=i.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[mi,[Bi],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[mi,[ci,Bi],(n,[e,i])=>{const s=n.properties()[e.value],u=i.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[mi,[Bi],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[mi,[Bi],(n,[e])=>e.value in n.properties()],"filter-has-id":[mi,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[mi,[ts(ci)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[mi,[ts(Bi)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[mi,[ci,ts(Bi)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[mi,[ci,ts(Bi)],(n,[e,i])=>function(s,u,p,y){for(;p<=y;){const x=p+y>>1;if(u[x]===s)return!0;u[x]>s?y=x-1:p=x+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:mi,overloads:[[[mi,mi],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[Bo(mi),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:mi,overloads:[[[mi,mi],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[Bo(mi),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[mi,[mi],(n,[e])=>!e.evaluate(n)],"is-supported-script":[mi,[ci],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[ci,[ci],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[ci,[ci],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[ci,Bo(Bi),(n,e)=>e.map(i=>za(i.evaluate(n))).join("")],"resolved-locale":[ci,[wo],(n,[e])=>e.evaluate(n).resolvedLocale()]});var N=Ga;function ee(n){return{result:"success",value:n}}function Me(n){return{result:"error",value:n}}function J(n){return"data-driven"===n["property-type"]}function ve(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function rt(n){return!!n.expression&&n.expression.interpolated}function Tt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}function on(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function Wi(n){return n}function Qi(n,e){const i="color"===e.type,s=n.stops&&"object"==typeof n.stops[0][0],u=s||!(s||void 0!==n.property),p=n.type||(rt(e)?"exponential":"interval");if(i&&((n=Xi({},n)).stops&&(n.stops=n.stops.map(M=>[M[0],Jn.parse(M[1])])),n.default=Jn.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!ko[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let y,x,D;if("exponential"===p)y=Pi;else if("interval"===p)y=eo;else if("categorical"===p){y=ir,x=Object.create(null);for(const M of n.stops)x[M[0]]=M[1];D=typeof n.stops[0][0]}else{if("identity"!==p)throw new Error(`Unknown function type "${p}"`);y=_r}if(s){const M={},F=[];for(let G=0;G<n.stops.length;G++){const Y=n.stops[G],oe=Y[0].zoom;void 0===M[oe]&&(M[oe]={zoom:oe,type:n.type,property:n.property,default:n.default,stops:[]},F.push(oe)),M[oe].stops.push([Y[0].value,Y[1]])}const U=[];for(const G of F)U.push([M[G].zoom,Qi(M[G],e)]);const H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:Nr.interpolationFactor.bind(void 0,H),zoomStops:U.map(G=>G[0]),evaluate:({zoom:G},Y)=>Pi({stops:U,base:n.base},e,G).evaluate(G,Y)}}if(u){const M="exponential"===p?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Nr.interpolationFactor.bind(void 0,M),zoomStops:n.stops.map(F=>F[0]),evaluate:({zoom:F})=>y(n,e,F,x,D)}}return{kind:"source",evaluate(M,F){const U=F&&F.properties?F.properties[n.property]:void 0;return void 0===U?zi(n.default,e.default):y(n,e,U,x,D)}}}function zi(n,e,i){return void 0!==n?n:void 0!==e?e:void 0!==i?i:void 0}function ir(n,e,i,s,u){return zi(typeof i===u?s[i]:void 0,n.default,e.default)}function eo(n,e,i){if("number"!==Tt(i))return zi(n.default,e.default);const s=n.stops.length;if(1===s||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[s-1][0])return n.stops[s-1][1];const u=ha(n.stops.map(p=>p[0]),i);return n.stops[u][1]}function Pi(n,e,i){const s=void 0!==n.base?n.base:1;if("number"!==Tt(i))return zi(n.default,e.default);const u=n.stops.length;if(1===u||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const p=ha(n.stops.map(F=>F[0]),i),y=function(F,U,H,G){const Y=G-H,oe=F-H;return 0===Y?0:1===U?oe/Y:(Math.pow(U,oe)-1)/(Math.pow(U,Y)-1)}(i,s,n.stops[p][0],n.stops[p+1][0]),x=n.stops[p][1],D=n.stops[p+1][1];let M=ia[e.type]||Wi;if(n.colorSpace&&"rgb"!==n.colorSpace){const F=ko[n.colorSpace];M=(U,H)=>F.reverse(F.interpolate(F.forward(U),F.forward(H),y))}return"function"==typeof x.evaluate?{evaluate(...F){const U=x.evaluate.apply(void 0,F),H=D.evaluate.apply(void 0,F);if(void 0!==U&&void 0!==H)return M(U,H,y)}}:M(x,D,y)}function _r(n,e,i){return"color"===e.type?i=Jn.parse(i):"formatted"===e.type?i=Ji.fromString(i.toString()):"resolvedImage"===e.type?i=Io.fromString(i.toString()):Tt(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),zi(i,n.default,e.default)}class ra{constructor(e,i){var s;this.expression=e,this._warningHistory={},this._evaluator=new Ts,this._defaultValue=i?"color"===(s=i).type&&(on(s.default)||Array.isArray(s.default))?new Jn(0,0,0,0):"color"===s.type?Jn.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,s,u,p,y,x,D){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,u,p,y,x,D){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=D||null;try{const M=this.expression.evaluate(this._evaluator);if(null==M||"number"==typeof M&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new oi(`Expected value to be one of ${Object.keys(this._enumValues).map(F=>JSON.stringify(F)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function As(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in N}function vs(n,e){const i=new Is(N,[],e?function(u){const p={color:mo,string:ci,number:Sn,enum:ci,boolean:mi,formatted:da,resolvedImage:ks};return"array"===u.type?ts(p[u.value]||Bi,u.length):p[u.type]}(e):void 0),s=i.parse(n,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?ee(new ra(s,e)):Me(i.errors)}class Lo{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!lo(i.expression)}evaluateWithoutErrorHandling(e,i,s,u,p,y){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,p,y)}evaluate(e,i,s,u,p,y){return this._styleExpression.evaluate(e,i,s,u,p,y)}}class Ys{constructor(e,i,s,u){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent="camera"!==e&&!lo(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,s,u,p,y){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,p,y)}evaluate(e,i,s,u,p,y){return this._styleExpression.evaluate(e,i,s,u,p,y)}interpolationFactor(e,i,s){return this.interpolationType?Nr.interpolationFactor(this.interpolationType,e,i,s):0}}function oa(n,e){if("error"===(n=vs(n,e)).result)return n;const i=n.value.expression,s=ml(i);if(!s&&!J(e))return Me([new ao("","data expressions not supported")]);const u=Eo(i,["zoom","pitch","distance-from-center"]);if(!u&&!ve(e))return Me([new ao("","zoom expressions not supported")]);const p=ic(i);return p||u?p instanceof ao?Me([p]):p instanceof Nr&&!rt(e)?Me([new ao("",'"interpolate" expressions cannot be used with this property')]):ee(p?new Ys(s?"camera":"composite",n.value,p.labels,p instanceof Nr?p.interpolation:void 0):new Lo(s?"constant":"source",n.value)):Me([new ao("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ps{constructor(e,i){this._parameters=e,this._specification=i,Xi(this,Qi(this._parameters,this._specification))}static deserialize(e){return new Ps(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ic(n){let e=null;if(n instanceof Ma)e=ic(n.result);else if(n instanceof _l){for(const i of n.args)if(e=ic(i),e)break}else(n instanceof Jl||n instanceof Nr)&&n.input instanceof ns&&"zoom"===n.input.name&&(e=n);return e instanceof ao||n.eachChild(i=>{const s=ic(i);s instanceof ao?e=s:!e&&s?e=new ao("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new ao("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Fn{constructor(e,i,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),null!=i&&i.__line__&&(this.line=i.__line__)}}function ma(n){const e=n.key,i=n.value,s=n.valueSpec||{},u=n.objectElementValidators||{},p=n.style,y=n.styleSpec;let x=[];const D=Tt(i);if("object"!==D)return[new Fn(e,i,`object expected, ${D} found`)];for(const M in i){const F=M.split(".")[0];let U;u[F]?U=u[F]:s[F]?U=bs:u["*"]?U=u["*"]:s["*"]&&(U=bs),U?x=x.concat(U({key:(e&&`${e}.`)+M,value:i[M],valueSpec:s[F]||s["*"],style:p,styleSpec:y,object:i,objectKey:M},i)):x.push(new Fn(e,i[M],`unknown property "${M}"`))}for(const M in s)u[M]||s[M].required&&void 0===s[M].default&&void 0===i[M]&&x.push(new Fn(e,i,`missing required property "${M}"`));return x}function Ri(n){const e=n.value,i=n.valueSpec,s=n.style,u=n.styleSpec,p=n.key,y=n.arrayElementValidator||bs;if("array"!==Tt(e))return[new Fn(p,e,`array expected, ${Tt(e)} found`)];if(i.length&&e.length!==i.length)return[new Fn(p,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Fn(p,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let x={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};u.$version<7&&(x.function=i.function),"object"===Tt(i.value)&&(x=i.value);let D=[];for(let M=0;M<e.length;M++)D=D.concat(y({array:e,arrayIndex:M,value:e[M],valueSpec:x,style:s,styleSpec:u,key:`${p}[${M}]`}));return D}function sa(n){const e=n.key,i=n.value,s=n.valueSpec;let u=Tt(i);if("number"===u&&i!=i&&(u="NaN"),"number"!==u)return[new Fn(e,i,`number expected, ${u} found`)];if("minimum"in s){let p=s.minimum;if("array"===Tt(s.minimum)&&(p=s.minimum[n.arrayIndex]),i<p)return[new Fn(e,i,`${i} is less than the minimum value ${p}`)]}if("maximum"in s){let p=s.maximum;if("array"===Tt(s.maximum)&&(p=s.maximum[n.arrayIndex]),i>p)return[new Fn(e,i,`${i} is greater than the maximum value ${p}`)]}return[]}function rc(n){const e=n.valueSpec,i=ar(n.value.type);let s,u,p,y={};const x="categorical"!==i&&void 0===n.value.property,D=!x,M="array"===Tt(n.value.stops)&&"array"===Tt(n.value.stops[0])&&"object"===Tt(n.value.stops[0][0]),F=ma({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(G){if("identity"===i)return[new Fn(G.key,G.value,'identity function may not have a "stops" property')];let Y=[];const oe=G.value;return Y=Y.concat(Ri({key:G.key,value:oe,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:U})),"array"===Tt(oe)&&0===oe.length&&Y.push(new Fn(G.key,oe,"array must have at least one stop")),Y},default:function(G){return bs({key:G.key,value:G.value,valueSpec:e,style:G.style,styleSpec:G.styleSpec})}}});return"identity"===i&&x&&F.push(new Fn(n.key,n.value,'missing required property "property"')),"identity"===i||n.value.stops||F.push(new Fn(n.key,n.value,'missing required property "stops"')),"exponential"===i&&n.valueSpec.expression&&!rt(n.valueSpec)&&F.push(new Fn(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(D&&!J(n.valueSpec)?F.push(new Fn(n.key,n.value,"property functions not supported")):x&&!ve(n.valueSpec)&&F.push(new Fn(n.key,n.value,"zoom functions not supported"))),"categorical"!==i&&!M||void 0!==n.value.property||F.push(new Fn(n.key,n.value,'"property" property is required')),F;function U(G){let Y=[];const oe=G.value,de=G.key;if("array"!==Tt(oe))return[new Fn(de,oe,`array expected, ${Tt(oe)} found`)];if(2!==oe.length)return[new Fn(de,oe,`array length 2 expected, length ${oe.length} found`)];if(M){if("object"!==Tt(oe[0]))return[new Fn(de,oe,`object expected, ${Tt(oe[0])} found`)];if(void 0===oe[0].zoom)return[new Fn(de,oe,"object stop key must have zoom")];if(void 0===oe[0].value)return[new Fn(de,oe,"object stop key must have value")];const Ee=ar(oe[0].zoom);if("number"!=typeof Ee)return[new Fn(de,oe[0].zoom,"stop zoom values must be numbers")];if(p&&p>Ee)return[new Fn(de,oe[0].zoom,"stop zoom values must appear in ascending order")];Ee!==p&&(p=Ee,u=void 0,y={}),Y=Y.concat(ma({key:`${de}[0]`,value:oe[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:sa,value:H}}))}else Y=Y.concat(H({key:`${de}[0]`,value:oe[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},oe));return As(Lr(oe[1]))?Y.concat([new Fn(`${de}[1]`,oe[1],"expressions are not allowed in function stops.")]):Y.concat(bs({key:`${de}[1]`,value:oe[1],valueSpec:e,style:G.style,styleSpec:G.styleSpec}))}function H(G,Y){const oe=Tt(G.value),de=ar(G.value),Ee=null!==G.value?G.value:Y;if(s){if(oe!==s)return[new Fn(G.key,Ee,`${oe} stop domain type must match previous stop domain type ${s}`)]}else s=oe;if("number"!==oe&&"string"!==oe&&"boolean"!==oe&&"number"!=typeof de&&"string"!=typeof de&&"boolean"!=typeof de)return[new Fn(G.key,Ee,"stop domain value must be a number, string, or boolean")];if("number"!==oe&&"categorical"!==i){let Ne=`number expected, ${oe} found`;return J(e)&&void 0===i&&(Ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Fn(G.key,Ee,Ne)]}return"categorical"!==i||"number"!==oe||"number"==typeof de&&isFinite(de)&&Math.floor(de)===de?"categorical"!==i&&"number"===oe&&"number"==typeof de&&"number"==typeof u&&void 0!==u&&de<u?[new Fn(G.key,Ee,"stop domain values must appear in ascending order")]:(u=de,"categorical"===i&&de in y?[new Fn(G.key,Ee,"stop domain values must be unique")]:(y[de]=!0,[])):[new Fn(G.key,Ee,`integer expected, found ${String(de)}`)]}}function Xo(n){const e=("property"===n.expressionContext?oa:vs)(Lr(n.value),n.valueSpec);if("error"===e.result)return e.value.map(s=>new Fn(`${n.key}${s.key}`,n.value,s.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!i.outputDefined())return[new Fn(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!lo(i))return[new Fn(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return Il(i,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!Eo(i,["zoom","feature-state"]))return[new Fn(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!ml(i))return[new Fn(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Il(n,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)i.delete(u);if(0===i.size)return[];const s=[];return n instanceof ns&&i.has(n.name)?[new Fn(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(u=>{s.push(...Il(u,e))}),s)}function oc(n){const e=n.key,i=n.value,s=n.valueSpec,u=[];return Array.isArray(s.values)?-1===s.values.indexOf(ar(i))&&u.push(new Fn(e,i,`expected one of [${s.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(s.values).indexOf(ar(i))&&u.push(new Fn(e,i,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function Ic(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Ic(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Wa(n,e="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ic(n)||(n=lr(n));const i=n;let s=!0;try{s=function(M){if(!ac(M))return M;let F=Lr(M);return sc(F),F=Ac(F),F}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const u=xt[`filter_${e}`],p=vs(s,u);let y=null;if("error"===p.result)throw new Error(p.value.map(M=>`${M.key}: ${M.message}`).join(", "));y=(M,F,U)=>p.value.evaluate(M,F,{},U);let x=null,D=null;if(s!==i){const M=vs(i,u);if("error"===M.result)throw new Error(M.value.map(F=>`${F.key}: ${F.message}`).join(", "));x=(F,U,H,G,Y)=>M.value.evaluate(F,U,{},H,void 0,void 0,G,Y),D=!ml(M.value.expression)}return{filter:y,dynamicFilter:x||void 0,needGeometry:hn(s),needFeature:!!D}}function Ac(n){if(!Array.isArray(n))return n;const e=function(i){if(Pc.has(i[0]))for(let s=1;s<i.length;s++)if(ac(i[s]))return!0;return i}(n);return!0===e?e:e.map(i=>Ac(i))}function sc(n){let e=!1;const i=[];if("case"===n[0]){for(let s=1;s<n.length-1;s+=2)e=e||ac(n[s]),i.push(n[s+1]);i.push(n[n.length-1])}else if("match"===n[0]){e=e||ac(n[1]);for(let s=2;s<n.length-1;s+=2)i.push(n[s+1]);i.push(n[n.length-1])}else if("step"===n[0]){e=e||ac(n[1]);for(let s=1;s<n.length-1;s+=2)i.push(n[s+1])}e&&(n.length=0,n.push("any",...i));for(let s=1;s<n.length;s++)sc(n[s])}function ac(n){if(!Array.isArray(n))return!1;if("pitch"===(e=n[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<n.length;i++)if(ac(n[i]))return!0;return!1}const Pc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Za(n,e){return n<e?-1:n>e?1:0}function hn(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let e=1;e<n.length;e++)if(hn(n[e]))return!0;return!1}function lr(n){if(!n)return!0;const e=n[0];return n.length<=1?"any"!==e:"=="===e?lc(n[1],n[2],"=="):"!="===e?Pl(lc(n[1],n[2],"==")):"<"===e||">"===e||"<="===e||">="===e?lc(n[1],n[2],e):"any"===e?(i=n.slice(1),["any"].concat(i.map(lr))):"all"===e?["all"].concat(n.slice(1).map(lr)):"none"===e?["all"].concat(n.slice(1).map(lr).map(Pl)):"in"===e?Al(n[1],n.slice(2)):"!in"===e?Pl(Al(n[1],n.slice(2))):"has"===e?Go(n[1]):"!has"===e?Pl(Go(n[1])):"within"!==e||n;var i}function lc(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Al(n,e){if(0===e.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Za)]]:["filter-in-small",n,["literal",e]]}}function Go(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Pl(n){return["!",n]}function ga(n){return Ic(Lr(n.value))?Xo(Xi({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):Us(n)}function Us(n){const e=n.value,i=n.key;if("array"!==Tt(e))return[new Fn(i,e,`array expected, ${Tt(e)} found`)];const s=n.styleSpec;let u,p=[];if(e.length<1)return[new Fn(i,e,"filter array must have at least 1 element")];switch(p=p.concat(oc({key:`${i}[0]`,value:e[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),ar(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===ar(e[1])&&p.push(new Fn(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&p.push(new Fn(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Tt(e[1]),"string"!==u&&p.push(new Fn(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let y=2;y<e.length;y++)u=Tt(e[y]),"$type"===ar(e[1])?p=p.concat(oc({key:`${i}[${y}]`,value:e[y],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&p.push(new Fn(`${i}[${y}]`,e[y],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)p=p.concat(Us({key:`${i}[${y}]`,value:e[y],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Tt(e[1]),2!==e.length?p.push(new Fn(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&p.push(new Fn(`${i}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=Tt(e[1]),2!==e.length?p.push(new Fn(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&p.push(new Fn(`${i}[1]`,e[1],`object expected, ${u} found`))}return p}function cc(n,e){const i=n.key,s=n.style,u=n.styleSpec,p=n.value,y=n.objectKey,x=u[`${e}_${n.layerType}`];if(!x)return[];const D=y.match(/^(.*)-transition$/);if("paint"===e&&D&&x[D[1]]&&x[D[1]].transition)return bs({key:i,value:p,valueSpec:u.transition,style:s,styleSpec:u});const M=n.valueSpec||x[y];if(!M)return[new Fn(i,p,`unknown property "${y}"`)];let F;if("string"===Tt(p)&&J(M)&&!M.tokens&&(F=/^{([^}]+)}$/.exec(p))){const H=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new Fn(i,p,`"${y}" does not support interpolation syntax\nUse an identity property function instead: ${H}.`)]}const U=[];return"symbol"===n.layerType&&("text-field"===y&&s&&!s.glyphs&&U.push(new Fn(i,p,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&on(Lr(p))&&"identity"===ar(p.type)&&U.push(new Fn(i,p,'"text-font" does not support identity functions'))),U.concat(bs({key:n.key,value:p,valueSpec:M,style:s,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:y}))}function uc(n){return cc(n,"paint")}function Rc(n){return cc(n,"layout")}function Oc(n){let e=[];const i=n.value,s=n.key,u=n.style,p=n.styleSpec;i.type||i.ref||e.push(new Fn(s,i,'either "type" or "ref" is required'));let y=ar(i.type);const x=ar(i.ref);if(i.id){const D=ar(i.id);for(let M=0;M<n.arrayIndex;M++){const F=u.layers[M];ar(F.id)===D&&e.push(new Fn(s,i.id,`duplicate layer id "${i.id}", previously used at line ${F.id.__line__}`))}}if("ref"in i){let D;["type","source","source-layer","filter","layout"].forEach(M=>{M in i&&e.push(new Fn(s,i[M],`"${M}" is prohibited for ref layers`))}),u.layers.forEach(M=>{ar(M.id)===x&&(D=M)}),D?D.ref?e.push(new Fn(s,i.ref,"ref cannot reference another ref layer")):y=ar(D.type):"string"==typeof x&&e.push(new Fn(s,i.ref,`ref layer "${x}" not found`))}else if("background"!==y&&"sky"!==y)if(i.source){const D=u.sources&&u.sources[i.source],M=D&&ar(D.type);D?"vector"===M&&"raster"===y?e.push(new Fn(s,i.source,`layer "${i.id}" requires a raster source`)):"raster"===M&&"raster"!==y?e.push(new Fn(s,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==M||i["source-layer"]?"raster-dem"===M&&"hillshade"!==y?e.push(new Fn(s,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===M&&D.lineMetrics||e.push(new Fn(s,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Fn(s,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Fn(s,i.source,`source "${i.source}" not found`))}else e.push(new Fn(s,i,'missing required property "source"'));return e=e.concat(ma({key:s,value:i,valueSpec:p.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>bs({key:`${s}.type`,value:i.type,valueSpec:p.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:D=>ga(Xi({layerType:y},D)),layout:D=>ma({layer:i,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":M=>Rc(Xi({layerType:y},M))}}),paint:D=>ma({layer:i,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":M=>uc(Xi({layerType:y},M))}})}})),e}function Ra(n){const e=n.value,i=n.key,s=Tt(e);return"string"!==s?[new Fn(i,e,`string expected, ${s} found`)]:[]}const rs={promoteId:function({key:n,value:e}){if("string"===Tt(e))return Ra({key:n,value:e});{const i=[];for(const s in e)i.push(...Ra({key:`${n}.${s}`,value:e[s]}));return i}}};function qa(n){const e=n.value,i=n.key,s=n.styleSpec,u=n.style;if(!e.type)return[new Fn(i,e,'"type" is required')];const p=ar(e.type);let y;switch(p){case"vector":case"raster":case"raster-dem":return y=ma({key:i,value:e,valueSpec:s[`source_${p.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:rs}),y;case"geojson":if(y=ma({key:i,value:e,valueSpec:s.source_geojson,style:u,styleSpec:s,objectElementValidators:rs}),e.cluster)for(const x in e.clusterProperties){const[D,M]=e.clusterProperties[x],F="string"==typeof D?[D,["accumulated"],["get",x]]:D;y.push(...Xo({key:`${i}.${x}.map`,value:M,expressionContext:"cluster-map"})),y.push(...Xo({key:`${i}.${x}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return y;case"video":return ma({key:i,value:e,valueSpec:s.source_video,style:u,styleSpec:s});case"image":return ma({key:i,value:e,valueSpec:s.source_image,style:u,styleSpec:s});case"canvas":return[new Fn(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return oc({key:`${i}.type`,value:e.type,valueSpec:{values:uu(s)},style:u,styleSpec:s})}}function uu(n){return n.source.reduce((e,i)=>{const s=n[i];return"enum"===s.type.type&&(e=e.concat(Object.keys(s.type.values))),e},[])}function Rl(n){const e=n.value,i=n.styleSpec,s=i.light,u=n.style;let p=[];const y=Tt(e);if(void 0===e)return p;if("object"!==y)return p=p.concat([new Fn("light",e,`object expected, ${y} found`)]),p;for(const x in e){const D=x.match(/^(.*)-transition$/);p=p.concat(D&&s[D[1]]&&s[D[1]].transition?bs({key:x,value:e[x],valueSpec:i.transition,style:u,styleSpec:i}):s[x]?bs({key:x,value:e[x],valueSpec:s[x],style:u,styleSpec:i}):[new Fn(x,e[x],`unknown property "${x}"`)])}return p}function _a(n){const e=n.value,i=n.key,s=n.style,u=n.styleSpec,p=u.terrain;let y=[];const x=Tt(e);if(void 0===e)return y;if("object"!==x)return y=y.concat([new Fn("terrain",e,`object expected, ${x} found`)]),y;for(const D in e){const M=D.match(/^(.*)-transition$/);y=y.concat(M&&p[M[1]]&&p[M[1]].transition?bs({key:D,value:e[D],valueSpec:u.transition,style:s,styleSpec:u}):p[D]?bs({key:D,value:e[D],valueSpec:p[D],style:s,styleSpec:u}):[new Fn(D,e[D],`unknown property "${D}"`)])}if(e.source){const D=s.sources&&s.sources[e.source],M=D&&ar(D.type);D?"raster-dem"!==M&&y.push(new Fn(i,e.source,`terrain cannot be used with a source of type ${String(M)}, it only be used with a "raster-dem" source type`)):y.push(new Fn(i,e.source,`source "${e.source}" not found`))}else y.push(new Fn(i,e,'terrain is missing required property "source"'));return y}function kc(n){const e=n.value,i=n.style,s=n.styleSpec,u=s.fog;let p=[];const y=Tt(e);if(void 0===e)return p;if("object"!==y)return p=p.concat([new Fn("fog",e,`object expected, ${y} found`)]),p;for(const x in e){const D=x.match(/^(.*)-transition$/);p=p.concat(D&&u[D[1]]&&u[D[1]].transition?bs({key:x,value:e[x],valueSpec:s.transition,style:i,styleSpec:s}):u[x]?bs({key:x,value:e[x],valueSpec:u[x],style:i,styleSpec:s}):[new Fn(x,e[x],`unknown property "${x}"`)])}return p}const zu={"*":()=>[],array:Ri,boolean:function(n){const e=n.value,i=n.key,s=Tt(e);return"boolean"!==s?[new Fn(i,e,`boolean expected, ${s} found`)]:[]},number:sa,color:function(n){const e=n.key,i=n.value,s=Tt(i);return"string"!==s?[new Fn(e,i,`color expected, ${s} found`)]:null===bt(i)?[new Fn(e,i,`color expected, "${i}" found`)]:[]},enum:oc,filter:ga,function:rc,layer:Oc,object:ma,source:qa,light:Rl,terrain:_a,fog:kc,string:Ra,formatted:function(n){return 0===Ra(n).length?[]:Xo(n)},resolvedImage:function(n){return 0===Ra(n).length?[]:Xo(n)},projection:function(n){const e=n.value,i=n.styleSpec,s=i.projection,u=n.style;let p=[];const y=Tt(e);if("object"===y)for(const x in e)p=p.concat(bs({key:x,value:e[x],valueSpec:s[x],style:u,styleSpec:i}));else"string"!==y&&(p=p.concat([new Fn("projection",e,`object or string expected, ${y} found`)]));return p}};function bs(n){const e=n.value,i=n.valueSpec,s=n.styleSpec;return i.expression&&on(ar(e))?rc(n):i.expression&&As(Lr(e))?Xo(n):i.type&&zu[i.type]?zu[i.type](n):ma(Xi({},n,{valueSpec:i.type?s[i.type]:i}))}function Cd(n){const e=n.value,i=n.key,s=Ra(n);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new Fn(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new Fn(i,e,'"glyphs" url must include a "{range}" token'))),s}function dc(n,e=xt){return Xs(bs({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:Cd,"*":()=>[]}}))}const hc=n=>Xs(uc(n)),du=n=>Xs(Rc(n));function Xs(n){return n.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function hu(n,e){let i=!1;if(e&&e.length)for(const s of e)n.fire(new So(new Error(s.message))),i=!0;return i}var Uu=Oa,aa=3;function Oa(n,e,i){var s=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var u=new Int32Array(this.arrayBuffer);n=u[0],this.d=(e=u[1])+2*(i=u[2]);for(var p=0;p<this.d*this.d;p++){var y=u[aa+p],x=u[aa+p+1];s.push(y===x?null:u.subarray(y,x))}var D=u[aa+s.length+1];this.keys=u.subarray(u[aa+s.length],D),this.bboxes=u.subarray(D),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var M=0;M<this.d*this.d;M++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=i,this.scale=e/n,this.uid=0;var F=i/e*n;this.min=-F,this.max=n+F}Oa.prototype.insert=function(n,e,i,s,u){this._forEachCell(e,i,s,u,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(u)},Oa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Oa.prototype._insertCell=function(n,e,i,s,u,p){this.cells[u].push(p)},Oa.prototype.query=function(n,e,i,s,u){var p=this.min,y=this.max;if(n<=p&&e<=p&&y<=i&&y<=s&&!u)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(n,e,i,s,this._queryCell,x,{},u),x},Oa.prototype._queryCell=function(n,e,i,s,u,p,y,x){var D=this.cells[u];if(null!==D)for(var M=this.keys,F=this.bboxes,U=0;U<D.length;U++){var H=D[U];if(void 0===y[H]){var G=4*H;(x?x(F[G+0],F[G+1],F[G+2],F[G+3]):n<=F[G+2]&&e<=F[G+3]&&i>=F[G+0]&&s>=F[G+1])?(y[H]=!0,p.push(M[H])):y[H]=!1}}},Oa.prototype._forEachCell=function(n,e,i,s,u,p,y,x){for(var D=this._convertToCellCoord(n),M=this._convertToCellCoord(e),F=this._convertToCellCoord(i),U=this._convertToCellCoord(s),H=D;H<=F;H++)for(var G=M;G<=U;G++){var Y=this.d*G+H;if((!x||x(this._convertFromCellCoord(H),this._convertFromCellCoord(G),this._convertFromCellCoord(H+1),this._convertFromCellCoord(G+1)))&&u.call(this,n,e,i,s,Y,p,y,x))return}},Oa.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Oa.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Oa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=aa+this.cells.length+1+1,i=0,s=0;s<this.cells.length;s++)i+=this.cells[s].length;var u=new Int32Array(e+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var p=e,y=0;y<n.length;y++){var x=n[y];u[aa+y]=p,u.set(x,p),p+=x.length}return u[aa+n.length]=p,u.set(this.keys,p),u[aa+n.length+1]=p+=this.keys.length,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer};var wl=St(Uu);const Lc={};function Wn(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),Lc[e]={klass:n,omit:i.omit||[]}}Wn(Object,"Object"),wl.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.push(i),{buffer:i}},wl.deserialize=function(n){return new wl(n.buffer)},Object.defineProperty(wl,"name",{value:"Grid"}),Wn(wl,"Grid"),Wn(Jn,"Color"),Wn(Error,"Error"),Wn(Ao,"AJAXError"),Wn(Io,"ResolvedImage"),Wn(Ps,"StylePropertyFunction"),Wn(ra,"StyleExpression",{omit:["_evaluator"]}),Wn(Ys,"ZoomDependentExpression"),Wn(Lo,"ZoomConstantExpression"),Wn(ns,"CompoundExpression",{omit:["_evaluate"]});for(const n in N)Lc[N[n]._classRegistryKey]||Wn(N[n],`Expression${n}`);function Fc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function L(n){return ge.ImageBitmap&&n instanceof ge.ImageBitmap}function B(n,e){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Fc(n)||L(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return e&&e.push(i.buffer),i}if(n instanceof ge.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const s of n)i.push(B(s,e));return i}if("object"==typeof n){const i=n.constructor,s=i._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const u=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const p in n)n.hasOwnProperty(p)&&(Lc[s].omit.indexOf(p)>=0||(u[p]=B(n[p],e)));n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof n)}function $(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Fc(n)||L(n)||ArrayBuffer.isView(n)||n instanceof ge.ImageData)return n;if(Array.isArray(n))return n.map($);if("object"==typeof n){const e=n.$name||"Object",{klass:i}=Lc[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const s=Object.create(i.prototype);for(const u of Object.keys(n))"$name"!==u&&(s[u]=$(n[u]));return s}throw new Error("can't deserialize object of type "+typeof n)}const O={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function X(n){for(const e of n)if(Et(e.charCodeAt(0)))return!0;return!1}function pe(n){for(const e of n)if(!Te(e.charCodeAt(0)))return!1;return!0}function Te(n){return!(O.Arabic(n)||O["Arabic Supplement"](n)||O["Arabic Extended-A"](n)||O["Arabic Presentation Forms-A"](n)||O["Arabic Presentation Forms-B"](n))}function Et(n){return!(746!==n&&747!==n&&(n<4352||!(O["Bopomofo Extended"](n)||O.Bopomofo(n)||O["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||O["CJK Compatibility Ideographs"](n)||O["CJK Compatibility"](n)||O["CJK Radicals Supplement"](n)||O["CJK Strokes"](n)||!(!O["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||O["CJK Unified Ideographs Extension A"](n)||O["CJK Unified Ideographs"](n)||O["Enclosed CJK Letters and Months"](n)||O["Hangul Compatibility Jamo"](n)||O["Hangul Jamo Extended-A"](n)||O["Hangul Jamo Extended-B"](n)||O["Hangul Jamo"](n)||O["Hangul Syllables"](n)||O.Hiragana(n)||O["Ideographic Description Characters"](n)||O.Kanbun(n)||O["Kangxi Radicals"](n)||O["Katakana Phonetic Extensions"](n)||O.Katakana(n)&&12540!==n||!(!O["Halfwidth and Fullwidth Forms"](n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!O["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||O["Unified Canadian Aboriginal Syllabics"](n)||O["Unified Canadian Aboriginal Syllabics Extended"](n)||O["Vertical Forms"](n)||O["Yijing Hexagram Symbols"](n)||O["Yi Syllables"](n)||O["Yi Radicals"](n))))}function Mn(n){return!(Et(n)||(e=n,O["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||O["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||O["Letterlike Symbols"](e)||O["Number Forms"](e)||O["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||O["Control Pictures"](e)&&9251!==e||O["Optical Character Recognition"](e)||O["Enclosed Alphanumerics"](e)||O["Geometric Shapes"](e)||O["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||O["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||O["CJK Symbols and Punctuation"](e)||O.Katakana(e)||O["Private Use Area"](e)||O["CJK Compatibility Forms"](e)||O["Small Form Variants"](e)||O["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function jt(n){return n>=1424&&n<=2303||O["Arabic Presentation Forms-A"](n)||O["Arabic Presentation Forms-B"](n)}function ui(n,e){return!(!e&&jt(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||O.Khmer(n))}function Yi(n){for(const e of n)if(jt(e.charCodeAt(0)))return!0;return!1}const Rr="deferred",Tr="loading",xs="loaded";let Js=null,f="unavailable",r=null;const c=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(f="error"),Js&&Js(n)};function m(){b.fire(new Jr("pluginStateChange",{pluginStatus:f,pluginURL:r}))}const b=new qo,C=function(){return f},P=function(){if(f!==Rr||!r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");f=Tr,m(),r&&Hi({url:r},n=>{n?c(n):(f=xs,m())})},R={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>f===xs||null!=R.applyArabicShaping,isLoading:()=>f===Tr,setState(n){f=n.pluginStatus,r=n.pluginURL},isParsed:()=>null!=R.applyArabicShaping&&null!=R.processBidirectionalText&&null!=R.processStyledBidirectionalText,getPluginURL:()=>r};class z{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,s){for(const u of i)if(!ui(u.charCodeAt(0),s))return!1;return!0}(e,R.isLoaded())}}class W{constructor(e,i){this.property=e,this.value=i,this.expression=function(s,u){if(on(s))return new Ps(s,u);if(As(s)){const p=oa(s,u);if("error"===p.result)throw new Error(p.value.map(y=>`${y.key}: ${y.message}`).join(", "));return p.value}{let p=s;return"string"==typeof s&&"color"===u.type&&(p=Jn.parse(s)),{kind:"constant",evaluate:()=>p}}}(void 0===i?e.specification.default:i,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class q{constructor(e){this.property=e,this.value=new W(e,void 0)}transitioned(e,i){return new fe(this.property,this.value,i,_t({},e.transition,this.transition),e.now)}untransitioned(){return new fe(this.property,this.value,null,{},0)}}class ae{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ln(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new q(this._values[e].property)),this._values[e].value=new W(this._values[e].property,null===i?void 0:Ln(i))}getTransition(e){return Ln(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new q(this._values[e].property)),this._values[e].transition=Ln(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(e[i]=s);const u=this.getTransition(i);void 0!==u&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const s=new be(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,i._values[u]);return s}untransitioned(){const e=new be(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class fe{constructor(e,i,s,u,p){const y=u.delay||0,x=u.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+y,this.end=this.begin+x,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const u=e.now||0,p=this.value.possiblyEvaluate(e,i,s),y=this.prior;if(y){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return y.possiblyEvaluate(e,i,s);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,i,s),p,Ei(x))}}return p}}class be{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const u=new De(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class we{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Ln(this._values[e].value)}setValue(e,i){this._values[e]=new W(this._values[e].property,null===i?void 0:Ln(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const u=new De(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,s);return u}}class xe{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,s,u){return this.property.evaluate(this.value,this.parameters,e,i,s,u)}}class De{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class le{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const u=ia[this.specification.type];return u?u(e,i,s):e}}class _e{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,u){return new xe(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},s,u)}:e.expression,i)}interpolate(e,i,s){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new xe(this,{kind:"constant",value:void 0},e.parameters);const u=ia[this.specification.type];return u?new xe(this,{kind:"constant",value:u(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,u,p,y){return"constant"===e.kind?e.value:e.evaluate(i,s,u,p,y)}}class Ie{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,u){return!!e.expression.evaluate(i,null,{},s,u)}interpolate(){return!1}}class Pe{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new z(0,{});for(const s in e){const u=e[s];u.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new W(u,void 0),y=this.defaultTransitionablePropertyValues[s]=new q(u);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate(i)}}}function Qe(n,e){return 256*(n=hi(Math.floor(n),0,255))+hi(Math.floor(e),0,255)}Wn(_e,"DataDrivenProperty"),Wn(le,"DataConstantProperty"),Wn(Ie,"ColorRampProperty");const tt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class et{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function st(n,e=1){let i=0,s=0;return{members:n.map(u=>{const p=tt[u.type].BYTES_PER_ELEMENT,y=i=Mt(i,Math.max(e,p)),x=u.components||1;return s=Math.max(s,p),i+=p*x,{name:u.name,type:u.type,components:x,offset:y}}),size:Mt(i,Math.max(s,e)),alignment:e}}function Mt(n,e){return Math.ceil(n/e)*e}class pn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=s,e}}pn.prototype.bytesPerElement=4,Wn(pn,"StructArrayLayout2i4");class Ct extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=s,this.int16[p+2]=u,e}}Ct.prototype.bytesPerElement=6,Wn(Ct,"StructArrayLayout3i6");class Qt extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const y=4*e;return this.int16[y+0]=i,this.int16[y+1]=s,this.int16[y+2]=u,this.int16[y+3]=p,e}}Qt.prototype.bytesPerElement=8,Wn(Qt,"StructArrayLayout4i8");class kt extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,y,x){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,s,u,p,y,x)}emplace(e,i,s,u,p,y,x,D){const M=6*e,F=12*e,U=3*e;return this.int16[M+0]=i,this.int16[M+1]=s,this.uint8[F+4]=u,this.uint8[F+5]=p,this.uint8[F+6]=y,this.uint8[F+7]=x,this.float32[U+2]=D,e}}kt.prototype.bytesPerElement=12,Wn(kt,"StructArrayLayout2i4ub1f12");class mn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const y=4*e;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=u,this.float32[y+3]=p,e}}mn.prototype.bytesPerElement=16,Wn(mn,"StructArrayLayout4f16");class It extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,u,p)}emplace(e,i,s,u,p,y){const x=6*e,D=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=s,this.uint16[x+2]=u,this.uint16[x+3]=p,this.float32[D+2]=y,e}}It.prototype.bytesPerElement=12,Wn(It,"StructArrayLayout4ui1f12");class Jt extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const y=4*e;return this.uint16[y+0]=i,this.uint16[y+1]=s,this.uint16[y+2]=u,this.uint16[y+3]=p,e}}Jt.prototype.bytesPerElement=8,Wn(Jt,"StructArrayLayout4ui8");class En extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,u,p,y)}emplace(e,i,s,u,p,y,x){const D=6*e;return this.int16[D+0]=i,this.int16[D+1]=s,this.int16[D+2]=u,this.int16[D+3]=p,this.int16[D+4]=y,this.int16[D+5]=x,e}}En.prototype.bytesPerElement=12,Wn(En,"StructArrayLayout6i12");class ln extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,y,x,D,M,F,U,H){const G=this.length;return this.resize(G+1),this.emplace(G,e,i,s,u,p,y,x,D,M,F,U,H)}emplace(e,i,s,u,p,y,x,D,M,F,U,H,G){const Y=12*e;return this.int16[Y+0]=i,this.int16[Y+1]=s,this.int16[Y+2]=u,this.int16[Y+3]=p,this.uint16[Y+4]=y,this.uint16[Y+5]=x,this.uint16[Y+6]=D,this.uint16[Y+7]=M,this.int16[Y+8]=F,this.int16[Y+9]=U,this.int16[Y+10]=H,this.int16[Y+11]=G,e}}ln.prototype.bytesPerElement=24,Wn(ln,"StructArrayLayout4i4ui4i24");class Cn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,u,p,y)}emplace(e,i,s,u,p,y,x){const D=10*e,M=5*e;return this.int16[D+0]=i,this.int16[D+1]=s,this.int16[D+2]=u,this.float32[M+2]=p,this.float32[M+3]=y,this.float32[M+4]=x,e}}Cn.prototype.bytesPerElement=20,Wn(Cn,"StructArrayLayout3i3f20");class ai extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}ai.prototype.bytesPerElement=4,Wn(ai,"StructArrayLayout1ul4");class Ai extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,y,x,D,M,F,U,H,G){const Y=this.length;return this.resize(Y+1),this.emplace(Y,e,i,s,u,p,y,x,D,M,F,U,H,G)}emplace(e,i,s,u,p,y,x,D,M,F,U,H,G,Y){const oe=20*e,de=10*e;return this.int16[oe+0]=i,this.int16[oe+1]=s,this.int16[oe+2]=u,this.int16[oe+3]=p,this.int16[oe+4]=y,this.float32[de+3]=x,this.float32[de+4]=D,this.float32[de+5]=M,this.float32[de+6]=F,this.int16[oe+14]=U,this.uint32[de+8]=H,this.uint16[oe+18]=G,this.uint16[oe+19]=Y,e}}Ai.prototype.bytesPerElement=40,Wn(Ai,"StructArrayLayout5i4f1i1ul2ui40");class Hn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,y,x){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,s,u,p,y,x)}emplace(e,i,s,u,p,y,x,D){const M=8*e;return this.int16[M+0]=i,this.int16[M+1]=s,this.int16[M+2]=u,this.int16[M+4]=p,this.int16[M+5]=y,this.int16[M+6]=x,this.int16[M+7]=D,e}}Hn.prototype.bytesPerElement=16,Wn(Hn,"StructArrayLayout3i2i2i16");class wi extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,u,p)}emplace(e,i,s,u,p,y){const x=4*e,D=8*e;return this.float32[x+0]=i,this.float32[x+1]=s,this.float32[x+2]=u,this.int16[D+6]=p,this.int16[D+7]=y,e}}wi.prototype.bytesPerElement=16,Wn(wi,"StructArrayLayout2f1f2i16");class rr extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const y=12*e,x=3*e;return this.uint8[y+0]=i,this.uint8[y+1]=s,this.float32[x+1]=u,this.float32[x+2]=p,e}}rr.prototype.bytesPerElement=12,Wn(rr,"StructArrayLayout2ub2f12");class er extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=s,this.float32[p+2]=u,e}}er.prototype.bytesPerElement=12,Wn(er,"StructArrayLayout3f12");class Qn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=s,this.uint16[p+2]=u,e}}Qn.prototype.bytesPerElement=6,Wn(Qn,"StructArrayLayout3ui6");class yr extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,y,x,D,M,F,U,H,G,Y,oe,de,Ee,Ne,Ce,Fe,ze){const We=this.length;return this.resize(We+1),this.emplace(We,e,i,s,u,p,y,x,D,M,F,U,H,G,Y,oe,de,Ee,Ne,Ce,Fe,ze)}emplace(e,i,s,u,p,y,x,D,M,F,U,H,G,Y,oe,de,Ee,Ne,Ce,Fe,ze,We){const At=30*e,yt=15*e,Wt=60*e;return this.int16[At+0]=i,this.int16[At+1]=s,this.int16[At+2]=u,this.float32[yt+2]=p,this.float32[yt+3]=y,this.uint16[At+8]=x,this.uint16[At+9]=D,this.uint32[yt+5]=M,this.uint32[yt+6]=F,this.uint32[yt+7]=U,this.uint16[At+16]=H,this.uint16[At+17]=G,this.uint16[At+18]=Y,this.float32[yt+10]=oe,this.float32[yt+11]=de,this.uint8[Wt+48]=Ee,this.uint8[Wt+49]=Ne,this.uint8[Wt+50]=Ce,this.uint32[yt+13]=Fe,this.int16[At+28]=ze,this.uint8[Wt+58]=We,e}}yr.prototype.bytesPerElement=60,Wn(yr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class or extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,y,x,D,M,F,U,H,G,Y,oe,de,Ee,Ne,Ce,Fe,ze,We,At,yt,Wt,sn,Lt,nn,rn,gn){const xn=this.length;return this.resize(xn+1),this.emplace(xn,e,i,s,u,p,y,x,D,M,F,U,H,G,Y,oe,de,Ee,Ne,Ce,Fe,ze,We,At,yt,Wt,sn,Lt,nn,rn,gn)}emplace(e,i,s,u,p,y,x,D,M,F,U,H,G,Y,oe,de,Ee,Ne,Ce,Fe,ze,We,At,yt,Wt,sn,Lt,nn,rn,gn,xn){const Ht=38*e,On=19*e;return this.int16[Ht+0]=i,this.int16[Ht+1]=s,this.int16[Ht+2]=u,this.float32[On+2]=p,this.float32[On+3]=y,this.int16[Ht+8]=x,this.int16[Ht+9]=D,this.int16[Ht+10]=M,this.int16[Ht+11]=F,this.int16[Ht+12]=U,this.int16[Ht+13]=H,this.uint16[Ht+14]=G,this.uint16[Ht+15]=Y,this.uint16[Ht+16]=oe,this.uint16[Ht+17]=de,this.uint16[Ht+18]=Ee,this.uint16[Ht+19]=Ne,this.uint16[Ht+20]=Ce,this.uint16[Ht+21]=Fe,this.uint16[Ht+22]=ze,this.uint16[Ht+23]=We,this.uint16[Ht+24]=At,this.uint16[Ht+25]=yt,this.uint16[Ht+26]=Wt,this.uint16[Ht+27]=sn,this.uint16[Ht+28]=Lt,this.uint32[On+15]=nn,this.float32[On+16]=rn,this.float32[On+17]=gn,this.float32[On+18]=xn,e}}or.prototype.bytesPerElement=76,Wn(or,"StructArrayLayout3i2f6i15ui1ul3f76");class Ir extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ir.prototype.bytesPerElement=4,Wn(Ir,"StructArrayLayout1f4");class $r extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,u,p)}emplace(e,i,s,u,p,y){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=s,this.float32[x+2]=u,this.float32[x+3]=p,this.float32[x+4]=y,e}}$r.prototype.bytesPerElement=20,Wn($r,"StructArrayLayout5f20");class Rs extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const y=6*e;return this.uint32[3*e+0]=i,this.uint16[y+2]=s,this.uint16[y+3]=u,this.uint16[y+4]=p,e}}Rs.prototype.bytesPerElement=12,Wn(Rs,"StructArrayLayout1ul3ui12");class Wo extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=s,e}}Wo.prototype.bytesPerElement=4,Wn(Wo,"StructArrayLayout2ui4");class ya extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}ya.prototype.bytesPerElement=2,Wn(ya,"StructArrayLayout1ui2");class Vs extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=s,e}}Vs.prototype.bytesPerElement=8,Wn(Vs,"StructArrayLayout2f8");class Or extends et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Or.prototype.size=40;class hr extends Ai{get(e){return new Or(this,e)}}Wn(hr,"CollisionBoxArray");class pr extends et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}pr.prototype.size=60;class Jo extends yr{get(e){return new pr(this,e)}}Wn(Jo,"PlacedSymbolArray");class ds extends et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ds.prototype.size=76;class Hr extends or{get(e){return new ds(this,e)}}Wn(Hr,"SymbolInstanceArray");class ka extends Ir{getoffsetX(e){return this.float32[1*e+0]}}Wn(ka,"GlyphOffsetArray");class Dd extends pn{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Wn(Dd,"SymbolLineVertexArray");class Ol extends et{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ol.prototype.size=12;class Nc extends Rs{get(e){return new Ol(this,e)}}Wn(Nc,"FeatureIndexArray");class fc extends Wo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Wn(fc,"FillExtrusionCentroidArray");const Bc=st([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),fu=st([{name:"a_dash",components:4,type:"Uint16"}]);var dh={exports:{}},ws=function(n,e){var i,s,u,p,y,x,D,M;for(s=n.length-(i=3&n.length),u=e,y=3432918353,x=461845907,M=0;M<s;)D=255&n.charCodeAt(M)|(255&n.charCodeAt(++M))<<8|(255&n.charCodeAt(++M))<<16|(255&n.charCodeAt(++M))<<24,++M,u=27492+(65535&(p=5*(65535&(u=(u^=D=(65535&(D=(D=(65535&D)*y+(((D>>>16)*y&65535)<<16)&4294967295)<<15|D>>>17))*x+(((D>>>16)*x&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(D=0,i){case 3:D^=(255&n.charCodeAt(M+2))<<16;case 2:D^=(255&n.charCodeAt(M+1))<<8;case 1:u^=D=(65535&(D=(D=(65535&(D^=255&n.charCodeAt(M)))*y+(((D>>>16)*y&65535)<<16)&4294967295)<<15|D>>>17))*x+(((D>>>16)*x&65535)<<16)&4294967295}return u^=n.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0},D_=function(n,e){for(var i,s=n.length,u=e^s,p=0;s>=4;)i=1540483477*(65535&(i=255&n.charCodeAt(p)|(255&n.charCodeAt(++p))<<8|(255&n.charCodeAt(++p))<<16|(255&n.charCodeAt(++p))<<24))+((1540483477*(i>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),s-=4,++p;switch(s){case 3:u^=(255&n.charCodeAt(p+2))<<16;case 2:u^=(255&n.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&n.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};dh.exports=ws,dh.exports.murmur3=ws,dh.exports.murmur2=D_;var Vu=St(dh.exports);class _f{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,s,u){this.ids.push(ol(e)),this.positions.push(i,s,u)}getPositions(e){const i=ol(e);let s=0,u=this.ids.length-1;for(;s<u;){const y=s+u>>1;this.ids[y]>=i?u=y:s=y+1}const p=[];for(;this.ids[s]===i;)p.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return p}static serialize(e,i){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return pu(s,u,0,s.length-1),i&&i.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(e){const i=new _f;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function ol(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Vu(String(n))}function pu(n,e,i,s){for(;i<s;){const u=n[i+s>>1];let p=i-1,y=s+1;for(;;){do{p++}while(n[p]<u);do{y--}while(n[y]>u);if(p>=y)break;hh(n,p,y),hh(e,3*p,3*y),hh(e,3*p+1,3*y+1),hh(e,3*p+2,3*y+2)}y-i<s-y?(pu(n,e,i,y),i=y+1):(pu(n,e,y+1,s),s=y)}}function hh(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}Wn(_f,"FeaturePositionMap");class Cl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class mu extends Cl{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Qm extends Cl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class T_ extends Cl{constructor(e){super(e),this.current=Jn.transparent}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const M_=new Float32Array(16),Cy=new Float32Array(9),sl=new Float32Array(4);function fh(n){return[Qe(255*n.r,255*n.g),Qe(255*n.b,255*n.a)]}class pc{constructor(e,i,s){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=s}setUniform(e,i,s,u,p){i.set(e,p,u.constantOr(this.value))}getBinding(e,i){return"color"===this.type?new T_(e):new mu(e)}}class ph{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,s,u,p){const y="u_pattern"===p||"u_dash"===p?this.pattern:"u_pixel_ratio"===p?this.pixelRatio:null;y&&i.set(e,p,y)}getBinding(e,i){return"u_pattern"===i||"u_dash"===i?new Qm(e):new mu(e)}}class mc{constructor(e,i,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,s,u,p,y){const x=this.paintVertexArray.length,D=this.expression.evaluate(new z(0),i,{},p,u,y);this.paintVertexArray.resize(e),this._setPaintValue(x,e,D)}updatePaintArray(e,i,s,u,p){const y=this.expression.evaluate({zoom:0},s,u,void 0,p);this._setPaintValue(e,i,y)}_setPaintValue(e,i,s){if("color"===this.type){const u=fh(s);for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class kl{constructor(e,i,s,u,p,y){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,i,s,u,p,y){const x=this.expression.evaluate(new z(this.zoom),i,{},p,u,y),D=this.expression.evaluate(new z(this.zoom+1),i,{},p,u,y),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,x,D)}updatePaintArray(e,i,s,u,p){const y=this.expression.evaluate({zoom:this.zoom},s,u,void 0,p),x=this.expression.evaluate({zoom:this.zoom+1},s,u,void 0,p);this._setPaintValue(e,i,y,x)}_setPaintValue(e,i,s,u){if("color"===this.type){const p=fh(s),y=fh(u);for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,p[0],p[1],y[0],y[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,u,p){const y=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,x=hi(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);i.set(e,p,x)}getBinding(e,i){return new mu(e)}}class gu{constructor(e,i,s,u,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=("array"===s?fu:Bc).members;for(let y=0;y<i.length;++y);this.paintVertexArray=new u}populatePaintArray(e,i,s){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,u,p,y){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],y)}_setPaintValues(e,i,s,u){if(!u||!s)return;const p=u[s];if(!p)return;const{tl:y,br:x,pixelRatio:D}=p;for(let M=e;M<i;M++)this.paintVertexArray.emplace(M,y[0],y[1],x[0],x[1],D)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _u{constructor(e,i,s=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const p in e.paint._values){if(!s(p))continue;const y=e.paint.get(p);if(!(y instanceof xe&&J(y.property.specification)))continue;const x=I_(p,e.type),D=y.value,M=y.property.specification.type,F=!!y.property.useIntegerZoom,U="line-dasharray"===p||p.endsWith("pattern"),H="line-dasharray"===p&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==D.kind||H)if("source"===D.kind||H||U){const G=Np(p,M,"source");this.binders[p]=U?new gu(D,x,M,G,e.id):new mc(D,x,M,G),u.push(`/a_${p}`)}else{const G=Np(p,M,"composite");this.binders[p]=new kl(D,x,M,F,i,G),u.push(`/z_${p}`)}else this.binders[p]=U?new ph(D.value,x):new pc(D.value,x,M),u.push(`/u_${p}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof mc||i instanceof kl?i.maxValue:0}populatePaintArrays(e,i,s,u,p,y){for(const x in this.binders){const D=this.binders[x];(D instanceof mc||D instanceof kl||D instanceof gu)&&D.populatePaintArray(e,i,s,u,p,y)}}setConstantPatternPositions(e){for(const i in this.binders){const s=this.binders[i];s instanceof ph&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,i,s,u,p,y){let x=!1;for(const D in e){const M=i.getPositions(D);for(const F of M){const U=s.feature(F.index);for(const H in this.binders){const G=this.binders[H];if((G instanceof mc||G instanceof kl||G instanceof gu)&&!0===G.expression.isStateDependent){const Y=u.paint.get(H);G.expression=Y.value,G.updatePaintArray(F.start,F.end,U,e[D],p,y),x=!0}}}}return x}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof pc||s instanceof ph)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof mc||s instanceof kl||s instanceof gu)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof pc||s instanceof ph||s instanceof kl)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof pc||u instanceof ph||u instanceof kl)for(const p of u.uniformNames)i.push({name:p,property:s,binding:u.getBinding(e,p)})}return i}setUniforms(e,i,s,u,p){for(const{name:y,property:x,binding:D}of s)this.binders[x].setUniform(e,D,p,u.get(x),y)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof mc||i instanceof kl||i instanceof gu)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof mc||s instanceof kl||s instanceof gu)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof mc||i instanceof kl||i instanceof gu)&&i.destroy()}}}class ju{constructor(e,i,s=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new _u(u,i,s);this.needsUpload=!1,this._featureMap=new _f,this._bufferOffset=0}populatePaintArrays(e,i,s,u,p,y,x){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(e,i,u,p,y,x);void 0!==i.id&&this._featureMap.add(i.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,u,p){for(const y of s)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,i,y,u,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const S_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function I_(n,e){return S_[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const Fp={"line-pattern":{source:It,composite:It},"fill-pattern":{source:It,composite:It},"fill-extrusion-pattern":{source:It,composite:It},"line-dasharray":{source:Jt,composite:Jt}},yf={color:{source:Vs,composite:mn},number:{source:Ir,composite:Vs}};function Np(n,e,i){const s=Fp[n];return s&&s[i]||yf[e][i]}Wn(pc,"ConstantBinder"),Wn(ph,"PatternConstantBinder"),Wn(mc,"SourceExpressionBinder"),Wn(gu,"PatternCompositeBinder"),Wn(kl,"CompositeExpressionBinder"),Wn(_u,"ProgramConfiguration",{omit:["_buffers"]}),Wn(ju,"ProgramConfigurationSet");const mh="-transition";class Ll extends qo{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new we(i.layout)),i.paint)){this._transitionablePaint=new ae(i.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new De(i.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,s={}){null!=i&&this._validate(du,`layers.${this.id}.layout.${e}`,e,i,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return Gt(e,mh)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,s={}){if(null!=i&&this._validate(hc,`layers.${this.id}.paint.${e}`,e,i,s))return!1;if(Gt(e,mh))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const u=this._transitionablePaint._values[e],p=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value,D=x.isDataDriven(),M=Gt(e,"pattern")||"line-dasharray"===e;return D||p||M||this._handleOverridablePaintPropertyUpdate(e,y,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Yn(e,(i,s)=>!(void 0===i||"layout"===s&&!Object.keys(i).length||"paint"===s&&!Object.keys(i).length))}_validate(e,i,s,u,p={}){return(!p||!1!==p.validate)&&hu(this,e.call(dc,{key:i,layerType:this.type,objectKey:s,value:u,styleSpec:xt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof xe&&J(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Wa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const vf=st([{name:"a_pos",components:2,type:"Int16"}],4),A_=st([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Qo{constructor(e=[]){this.segments=e}prepareSegment(e,i,s,u){let p=this.segments[this.segments.length-1];return e>Qo.MAX_VERTEX_ARRAY_LENGTH&&fi(`Max vertices per segment is ${Qo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Qo.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:i.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==u&&(p.sortKey=u),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,u){return new Qo([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}Qo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Wn(Qo,"SegmentVector");var pi=8192;class Fl{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Xr?new Xr(e.lng,e.lat):Xr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Xr?new Xr(e.lng,e.lat):Xr.convert(e),this}extend(e){const i=this._sw,s=this._ne;let u,p;if(e instanceof Xr)u=e,p=e;else{if(!(e instanceof Fl))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Fl.convert(e)):this.extend(Xr.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Xr.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return i||s?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),s.lng=Math.max(p.lng,s.lng),s.lat=Math.max(p.lat,s.lat)):(this._sw=new Xr(u.lng,u.lat),this._ne=new Xr(p.lng,p.lat)),this}getCenter(){return new Xr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Xr(this.getWest(),this.getNorth())}getSouthEast(){return new Xr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=Xr.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){return!e||e instanceof Fl?e:new Fl(e)}}var gh=1e-6,Ka=typeof Float32Array<"u"?Float32Array:Array;function eg(){var n=new Ka(9);return Ka!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function $u(n,e,i){var s=e[0],u=e[1],p=e[2],y=e[3],x=e[4],D=e[5],M=e[6],F=e[7],U=e[8],H=i[0],G=i[1],Y=i[2],oe=i[3],de=i[4],Ee=i[5],Ne=i[6],Ce=i[7],Fe=i[8];return n[0]=H*s+G*y+Y*M,n[1]=H*u+G*x+Y*F,n[2]=H*p+G*D+Y*U,n[3]=oe*s+de*y+Ee*M,n[4]=oe*u+de*x+Ee*F,n[5]=oe*p+de*D+Ee*U,n[6]=Ne*s+Ce*y+Fe*M,n[7]=Ne*u+Ce*x+Fe*F,n[8]=Ne*p+Ce*D+Fe*U,n}function La(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Bp(n,e){var i=e[0],s=e[1],u=e[2],p=e[3],y=e[4],x=e[5],D=e[6],M=e[7],F=e[8],U=e[9],H=e[10],G=e[11],Y=e[12],oe=e[13],de=e[14],Ee=e[15],Ne=i*x-s*y,Ce=i*D-u*y,Fe=i*M-p*y,ze=s*D-u*x,We=s*M-p*x,At=u*M-p*D,yt=F*oe-U*Y,Wt=F*de-H*Y,sn=F*Ee-G*Y,Lt=U*de-H*oe,nn=U*Ee-G*oe,rn=H*Ee-G*de,gn=Ne*rn-Ce*nn+Fe*Lt+ze*sn-We*Wt+At*yt;return gn?(n[0]=(x*rn-D*nn+M*Lt)*(gn=1/gn),n[1]=(u*nn-s*rn-p*Lt)*gn,n[2]=(oe*At-de*We+Ee*ze)*gn,n[3]=(H*We-U*At-G*ze)*gn,n[4]=(D*sn-y*rn-M*Wt)*gn,n[5]=(i*rn-u*sn+p*Wt)*gn,n[6]=(de*Fe-Y*At-Ee*Ce)*gn,n[7]=(F*At-H*Fe+G*Ce)*gn,n[8]=(y*nn-x*sn+M*yt)*gn,n[9]=(s*sn-i*nn-p*yt)*gn,n[10]=(Y*We-oe*Fe+Ee*Ne)*gn,n[11]=(U*Fe-F*We-G*Ne)*gn,n[12]=(x*Wt-y*Lt-D*yt)*gn,n[13]=(i*Lt-s*Wt+u*yt)*gn,n[14]=(oe*Ce-Y*ze-de*Ne)*gn,n[15]=(F*ze-U*Ce+H*Ne)*gn,n):null}function Md(n,e,i){var s=e[0],u=e[1],p=e[2],y=e[3],x=e[4],D=e[5],M=e[6],F=e[7],U=e[8],H=e[9],G=e[10],Y=e[11],oe=e[12],de=e[13],Ee=e[14],Ne=e[15],Ce=i[0],Fe=i[1],ze=i[2],We=i[3];return n[0]=Ce*s+Fe*x+ze*U+We*oe,n[1]=Ce*u+Fe*D+ze*H+We*de,n[2]=Ce*p+Fe*M+ze*G+We*Ee,n[3]=Ce*y+Fe*F+ze*Y+We*Ne,n[4]=(Ce=i[4])*s+(Fe=i[5])*x+(ze=i[6])*U+(We=i[7])*oe,n[5]=Ce*u+Fe*D+ze*H+We*de,n[6]=Ce*p+Fe*M+ze*G+We*Ee,n[7]=Ce*y+Fe*F+ze*Y+We*Ne,n[8]=(Ce=i[8])*s+(Fe=i[9])*x+(ze=i[10])*U+(We=i[11])*oe,n[9]=Ce*u+Fe*D+ze*H+We*de,n[10]=Ce*p+Fe*M+ze*G+We*Ee,n[11]=Ce*y+Fe*F+ze*Y+We*Ne,n[12]=(Ce=i[12])*s+(Fe=i[13])*x+(ze=i[14])*U+(We=i[15])*oe,n[13]=Ce*u+Fe*D+ze*H+We*de,n[14]=Ce*p+Fe*M+ze*G+We*Ee,n[15]=Ce*y+Fe*F+ze*Y+We*Ne,n}function Sd(n,e,i){var s,u,p,y,x,D,M,F,U,H,G,Y,oe=i[0],de=i[1],Ee=i[2];return e===n?(n[12]=e[0]*oe+e[4]*de+e[8]*Ee+e[12],n[13]=e[1]*oe+e[5]*de+e[9]*Ee+e[13],n[14]=e[2]*oe+e[6]*de+e[10]*Ee+e[14],n[15]=e[3]*oe+e[7]*de+e[11]*Ee+e[15]):(u=e[1],p=e[2],y=e[3],x=e[4],D=e[5],M=e[6],F=e[7],U=e[8],H=e[9],G=e[10],Y=e[11],n[0]=s=e[0],n[1]=u,n[2]=p,n[3]=y,n[4]=x,n[5]=D,n[6]=M,n[7]=F,n[8]=U,n[9]=H,n[10]=G,n[11]=Y,n[12]=s*oe+x*de+U*Ee+e[12],n[13]=u*oe+D*de+H*Ee+e[13],n[14]=p*oe+M*de+G*Ee+e[14],n[15]=y*oe+F*de+Y*Ee+e[15]),n}function Hu(n,e,i){var s=i[0],u=i[1],p=i[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*p,n[9]=e[9]*p,n[10]=e[10]*p,n[11]=e[11]*p,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function tg(n,e,i){var s=Math.sin(i),u=Math.cos(i),p=e[4],y=e[5],x=e[6],D=e[7],M=e[8],F=e[9],U=e[10],H=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=p*u+M*s,n[5]=y*u+F*s,n[6]=x*u+U*s,n[7]=D*u+H*s,n[8]=M*u-p*s,n[9]=F*u-y*s,n[10]=U*u-x*s,n[11]=H*u-D*s,n}function bf(n,e,i){var s=Math.sin(i),u=Math.cos(i),p=e[0],y=e[1],x=e[2],D=e[3],M=e[8],F=e[9],U=e[10],H=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*u-M*s,n[1]=y*u-F*s,n[2]=x*u-U*s,n[3]=D*u-H*s,n[8]=p*s+M*u,n[9]=y*s+F*u,n[10]=x*s+U*u,n[11]=D*s+H*u,n}function ng(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ig(n,e,i){var s,u,p,y=i[0],x=i[1],D=i[2],M=Math.hypot(y,x,D);return M<gh?null:(y*=M=1/M,x*=M,D*=M,s=Math.sin(e),u=Math.cos(e),n[0]=y*y*(p=1-u)+u,n[1]=x*y*p+D*s,n[2]=D*y*p-x*s,n[3]=0,n[4]=y*x*p-D*s,n[5]=x*x*p+u,n[6]=D*x*p+y*s,n[7]=0,n[8]=y*D*p+x*s,n[9]=x*D*p-y*s,n[10]=D*D*p+u,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var xf=Md;function wf(){var n=new Ka(3);return Ka!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function rg(n){var e=new Ka(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Id(n){return Math.hypot(n[0],n[1],n[2])}function _h(n,e,i){var s=new Ka(3);return s[0]=n,s[1]=e,s[2]=i,s}function gc(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function og(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function sg(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function yh(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Gu(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function al(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Ef(n,e,i,s){return n[0]=e[0]+i[0]*s,n[1]=e[1]+i[1]*s,n[2]=e[2]+i[2]*s,n}function Qs(n,e){var i=e[0],s=e[1],u=e[2],p=i*i+s*s+u*u;return p>0&&(p=1/Math.sqrt(p)),n[0]=e[0]*p,n[1]=e[1]*p,n[2]=e[2]*p,n}function Nl(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function ag(n,e,i){var s=e[0],u=e[1],p=e[2],y=i[0],x=i[1],D=i[2];return n[0]=u*D-p*x,n[1]=p*y-s*D,n[2]=s*x-u*y,n}function os(n,e,i){var s=e[0],u=e[1],p=e[2],y=i[3]*s+i[7]*u+i[11]*p+i[15];return n[0]=(i[0]*s+i[4]*u+i[8]*p+i[12])/(y=y||1),n[1]=(i[1]*s+i[5]*u+i[9]*p+i[13])/y,n[2]=(i[2]*s+i[6]*u+i[10]*p+i[14])/y,n}function P_(n,e,i){var s=i[0],u=i[1],p=i[2],y=e[0],x=e[1],D=e[2],M=u*D-p*x,F=p*y-s*D,U=s*x-u*y,H=u*U-p*F,G=p*M-s*U,Y=s*F-u*M,oe=2*i[3];return F*=oe,U*=oe,G*=2,Y*=2,n[0]=y+(M*=oe)+(H*=2),n[1]=x+F+G,n[2]=D+U+Y,n}var Cf,Bl=og,Df=sg,Tf=Id;function zp(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function Up(n,e){var i=e[0],s=e[1],u=e[2],p=e[3],y=i*i+s*s+u*u+p*p;return y>0&&(y=1/Math.sqrt(y)),n[0]=i*y,n[1]=s*y,n[2]=u*y,n[3]=p*y,n}function yu(n,e,i){var s=e[0],u=e[1],p=e[2],y=e[3];return n[0]=i[0]*s+i[4]*u+i[8]*p+i[12]*y,n[1]=i[1]*s+i[5]*u+i[9]*p+i[13]*y,n[2]=i[2]*s+i[6]*u+i[10]*p+i[14]*y,n[3]=i[3]*s+i[7]*u+i[11]*p+i[15]*y,n}function Wu(){var n=new Ka(4);return Ka!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Vp(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function jp(n,e,i){i*=.5;var s=e[0],u=e[1],p=e[2],y=e[3],x=Math.sin(i),D=Math.cos(i);return n[0]=s*D+y*x,n[1]=u*D+p*x,n[2]=p*D-u*x,n[3]=y*D-s*x,n}function vh(n,e,i){i*=.5;var s=e[0],u=e[1],p=e[2],y=e[3],x=Math.sin(i),D=Math.cos(i);return n[0]=s*D-p*x,n[1]=u*D+y*x,n[2]=p*D+s*x,n[3]=y*D-u*x,n}wf(),Cf=new Ka(4),Ka!=Float32Array&&(Cf[0]=0,Cf[1]=0,Cf[2]=0,Cf[3]=0);var Mf=Up;wf(),_h(1,0,0),_h(0,1,0),Wu(),Wu(),eg();const Sf=st([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:lg}=Sf,cg=st([{name:"a_pos_3",components:3,type:"Int16"}]);var bh=st([{name:"a_pos",type:"Int16",components:2}]);class If{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const u=Nl(i,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,s[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,i,s){if(oe=(G=this.pos)[0],de=G[1],Ee=G[2],Ne=(Y=e)[0],Ce=Y[1],Fe=Y[2],Math.abs(oe-Ne)<=gh*Math.max(1,Math.abs(oe),Math.abs(Ne))&&Math.abs(de-Ce)<=gh*Math.max(1,Math.abs(de),Math.abs(Ce))&&Math.abs(Ee-Fe)<=gh*Math.max(1,Math.abs(Ee),Math.abs(Fe))||0===i)return s[0]=s[1]=s[2]=0,!1;var G,Y,oe,de,Ee,Ne,Ce,Fe;const[u,p,y]=this.dir,x=this.pos[0]-e[0],D=this.pos[1]-e[1],M=this.pos[2]-e[2],F=u*u+p*p+y*y,U=2*(x*u+D*p+M*y),H=U*U-4*F*(x*x+D*D+M*M-i*i);if(H<0){const G=Math.max(-U/2,0),Y=x+u*G,oe=D+p*G,de=M+y*G,Ee=Math.hypot(Y,oe,de);return s[0]=Y*i/Ee,s[1]=oe*i/Ee,s[2]=de*i/Ee,!1}{const G=(-U-Math.sqrt(H))/(2*F);if(G<0){const Y=Math.hypot(x,D,M);return s[0]=x*i/Y,s[1]=D*i/Y,s[2]=M*i/Y,!1}return s[0]=x+u*G,s[1]=D+p*G,s[2]=M+y*G,!0}}}class xh{constructor(e,i,s,u,p){this.TL=e,this.TR=i,this.BR=s,this.BL=u,this.horizon=p}static fromInvProjectionMatrix(e,i,s){const u=[-1,1,1],p=[1,1,1],y=[1,-1,1],x=[-1,-1,1],D=os(u,u,e),M=os(p,p,e),F=os(y,y,e),U=os(x,x,e);return new xh(D,M,F,U,i/s)}}class $p{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,s,u){const p=Math.pow(2,s),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const M=yu([],D,e),F=1/M[3]/i*p;return(U=M)[0]=(H=M)[0]*(G=[F,F,u?1/M[3]:F,F])[0],U[1]=H[1]*G[1],U[2]=H[2]*G[2],U[3]=H[3]*G[3],U;var U,H,G}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const M=Qs([],ag([],Bl([],y[D[0]],y[D[1]]),Bl([],y[D[2]],y[D[1]]))),F=-Nl(M,y[D[1]]);return M.concat(F)});return new $p(y,x)}}class va{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const u of e)yh(i,i,u),Gu(s,s,u);return new va(i,s)}static applyTransform(e,i){const s=e.getCorners();for(let u=0;u<s.length;++u)os(s[u],s[u],i);return va.fromPoints(s)}constructor(e,i){this.min=e,this.max=i,this.center=al([],gc([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=rg(this.min),u=rg(this.max);for(let p=0;p<i.length;p++)s[p]=i[p]?this.min[p]:this.center[p],u[p]=i[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new va(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let s=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let y=0;for(let x=0;x<i.length;x++)y+=Nl(p,i[x])+p[3]>=0;if(0===y)return 0;y!==i.length&&(s=!1)}if(s)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let x=0;x<e.points.length;x++){const D=e.points[x][u]-this.min[u];p=Math.min(p,D),y=Math.max(y,D)}if(y<0||p>this.max[u]-this.min[u])return 0}return 1}}const Hp=5,Gp=6,_c=pi/Math.PI/2,R_=16383,Zu=[64,32,16],ll=-_c,Ya=_c,ba=[new va([ll,ll,ll],[Ya,Ya,Ya]),new va([ll,ll,ll],[0,0,Ya]),new va([0,ll,ll],[Ya,0,Ya]),new va([ll,0,ll],[0,Ya,Ya]),new va([0,0,ll],[Ya,Ya,Ya])];function vu(n){return n*_c/Eu}function Wp(n,e,i,s=!0){const u=al([],n._camera.position,n.worldSize),p=[e,i,1,1];yu(p,p,n.pixelMatrixInverse),zp(p,p,1/p[3]);const y=Qs([],Bl([],p,u)),x=n.globeMatrix,D=[x[12],x[13],x[14]],M=Bl([],D,u),F=Id(M),U=Qs([],M),H=n.worldSize/(2*Math.PI),G=Nl(U,y),Y=Math.asin(H/F);if(Y<Math.acos(G)){if(!s)return null;const sn=[],Lt=[];al(sn,y,F/G),Qs(Lt,Bl(Lt,sn,M)),Qs(y,gc(y,M,al(y,Lt,Math.tan(Y)*F)))}const oe=[];new If(u,y).closestPointOnSphere(D,H,oe);const de=Qs([],wr(x,0)),Ee=Qs([],wr(x,1)),Ne=Qs([],wr(x,2)),Ce=Nl(de,oe),Fe=Nl(Ee,oe),ze=Nl(Ne,oe),We=vn(Math.asin(-Fe/H));let At=vn(Math.atan2(Ce,ze));At=n.center.lng+function(sn,Lt){const nn=(Lt-sn+180)%360-180;return nn<-180?nn+360:nn}(n.center.lng,At);const yt=Ul(At),Wt=hi(Dl(We),0,1);return new Cu(yt,Wt)}class ug{constructor(e,i,s){this.a=Bl([],e,s),this.b=Bl([],i,s),this.center=s;const u=Qs([],this.a),p=Qs([],this.b);this.angle=Math.acos(Nl(u,p))}}function Zp(n,e){if(0===n.angle)return null;let i;return i=0===n.a[e]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(s,u,p,y){const x=Math.sin(p);return s*(Math.sin((1-y)*p)/x)+u*(Math.sin(y*p)/x)}(n.a[e],n.b[e],n.angle,hi(i,0,1))+n.center[e]}function zl(n){if(n.z<=1)return ba[n.z+2*n.y+n.x];const e=Kp(Af(n));return va.fromPoints(e)}function qu(n,e,i){return al(n,n,1-i),Ef(n,n,e,i)}function qp(n,e){const i=Ku(e.zoom);if(0===i)return zl(n);const s=Af(n),u=Kp(s),p=Ul(s.getWest())*e.worldSize,y=Ul(s.getEast())*e.worldSize,x=Dl(s.getNorth())*e.worldSize,D=Dl(s.getSouth())*e.worldSize,M=[p,x,0],F=[y,x,0],U=[p,D,0],H=[y,D,0],G=Bp([],e.globeMatrix);return os(M,M,G),os(F,F,G),os(U,U,G),os(H,H,G),u[0]=qu(u[0],U,i),u[1]=qu(u[1],H,i),u[2]=qu(u[2],F,i),u[3]=qu(u[3],M,i),va.fromPoints(u)}function dg(n,e,i){for(const s of n)os(s,s,e),al(s,s,i)}function Af({x:n,y:e,z:i}){const s=1/(1<<i),u=new Xr(Fa(n*s),hs((e+1)*s)),p=new Xr(Fa((n+1)*s),hs(e*s));return new Fl(u,p)}function Kp(n){const e=qt(n.getNorth()),i=qt(n.getSouth()),s=Math.cos(e),u=Math.cos(i),p=Math.sin(e),y=Math.sin(i),x=n.getWest(),D=n.getEast();return[bu(u,y,x),bu(u,y,D),bu(s,p,D),bu(s,p,x)]}function bu(n,e,i,s=_c){return i=qt(i),[n*Math.sin(i)*s,-e*s,n*Math.cos(i)*s]}function xu(n,e,i){return bu(Math.cos(qt(n)),Math.sin(qt(n)),e,i)}function wh(n,e,i,s){const u=1<<i.z,p=(n/pi+i.x)/u;return xu(hs((e/pi+i.y)/u),Fa(p),s)}function wu({min:n,max:e}){return R_/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const fg=new Float64Array(16);function Eh(n){const e=wu(n),i=ng(fg,[e,e,e]);return Sd(i,i,((s=[])[0]=-(u=n.min)[0],s[1]=-u[1],s[2]=-u[2],s));var s,u}function Pf(n){const e=(s=n.min,(i=fg)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i);var i,s;const u=1/wu(n);return Hu(e,e,[u,u,u])}function Rf(n,e,i,s,u){const p=function(D){const M=pi/(2*Math.PI);return D/(2*Math.PI)/M}(i),y=[n,e,-i/(2*Math.PI)],x=La(new Float64Array(16));return Sd(x,x,y),Hu(x,x,[p,p,p]),tg(x,x,qt(-u)),bf(x,x,qt(-s)),x}function Ku(n){return mr(Hp,Gp,n)}function Yu(n,e){const i=xu(e.lat,e.lng);return y=(u=og([],function(Y){const oe=xu(Y._center.lat,Y._center.lng);let de=ag([],_h(0,1,0),oe);const Ee=ig([],-Y.angle,oe);de=os(de,de,Ee),ig(Ee,-Y._pitch,de);const Ne=Qs([],oe);return al(Ne,Ne,vu(Y.cameraToCenterDistance/Y.pixelsPerMeter)),os(Ne,Ne,Ee),gc([],oe,Ne)}(n),i))[0],x=u[1],D=u[2],M=(p=i)[0],F=p[1],U=p[2],G=(H=Math.sqrt(y*y+x*x+D*D)*Math.sqrt(M*M+F*F+U*U))&&Nl(u,p)/H,Math.acos(Math.min(Math.max(G,-1),1));var u,p,y,x,D,M,F,U,H,G}function Ad(n,e){return Yu(n,e)>Math.PI/2*1.01}const Of=qt(85),Xu=Math.cos(Of),es=Math.sin(Of),Eu=6371008.8,pg=2*Math.PI*Eu;class zc{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new zc(Oi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,u=e.lat*i,p=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return Eu*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new Fl(new zc(this.lng-s,this.lat-i),new zc(this.lng+s,this.lat+i))}toEcef(e){const i=vu(e);return xu(this.lat,this.lng,_c+i)}static convert(e){if(e instanceof zc)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new zc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new zc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Xr=zc;function kf(n){return pg*Math.cos(n*Math.PI/180)}function Ul(n){return(180+n)/360}function Dl(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function xa(n,e){return n/kf(e)}function Fa(n){return 360*n-180}function hs(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Uc(n,e){return n*kf(hs(e))}const js=85.051129;function Ch(n){return 1/Math.cos(n*Math.PI/180)}class Cu{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=Xr.convert(e);return new Cu(Ul(s.lng),Dl(s.lat),xa(i,s.lat))}toLngLat(){return new Xr(Fa(this.x),hs(this.y))}toAltitude(){return Uc(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/pg*Ch(hs(this.y))}}function yc(n,e,i,s,u,p,y,x,D){const M=(e+s)/2,F=(i+u)/2,U=new Ze(M,F);x(U),function(H,G,Y,oe,de,Ee){const Ne=Y-de,Ce=oe-Ee;return Math.abs((oe-G)*Ne-(Y-H)*Ce)/Math.hypot(Ne,Ce)}(U.x,U.y,p.x,p.y,y.x,y.y)>=D?(yc(n,e,i,M,F,p,U,x,D),yc(n,M,F,s,u,U,y,x,D)):n.push(y)}function Dh(n,e,i){let s=n[0],u=s.x,p=s.y;e(s);const y=[s];for(let x=1;x<n.length;x++){const D=n[x],{x:M,y:F}=D;e(D),yc(y,u,p,M,F,s,D,e,i),u=M,p=F,s=D}return y}function Lf(n,e,i,s){if(s(e,i)){const u=e.add(i)._mult(.5);Lf(n,e,u,s),Lf(n,u,i,s)}else n.push(i)}function Yp(n,e){let i=n[0];const s=[i];for(let u=1;u<n.length;u++){const p=n[u];Lf(s,i,p,e),i=p}return s}const mg=Math.pow(2,14)-1,Th=-mg-1;function Xp(n,e){const i=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=hi(i,Th,mg),n.y=hi(s,Th,mg),(i<n.x||i>n.x+1||s<n.y||s>n.y+1)&&fi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function vc(n,e,i){const s=n.loadGeometry(),u=n.extent,p=pi/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const y=1<<e.z,{scale:x,x:D,y:M,projection:F}=i,U=H=>{const G=Fa((e.x+H.x/u)/y),Y=hs((e.y+H.y/u)/y),oe=F.project(G,Y);H.x=(oe.x*x-D)*u,H.y=(oe.y*x-M)*u};for(let H=0;H<s.length;H++)if(1!==n.type)s[H]=Dh(s[H],U,1);else{const G=[];for(const Y of s[H])Y.x<0||Y.x>=u||Y.y<0||Y.y>=u||(U(Y),G.push(Y));s[H]=G}}for(const y of s)for(const x of y)Xp(x,p);return s}function Vc(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?vc(n):[]}}function Mh(n,e,i,s,u){n.emplaceBack(2*e+(s+1)/2,2*i+(u+1)/2)}function Ju(n,e,i){n.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class Ff{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new pn,this.indexArray=new Qn,this.segments=new Qo,this.programConfigurations=new ju(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,u){const p=this.layers[0],y=[];let x=null;"circle"===p.type&&(x=p.layout.get("circle-sort-key"));for(const{feature:M,id:F,index:U,sourceLayerIndex:H}of e){const G=this.layers[0]._featureFilter.needGeometry,Y=Vc(M,G);if(!this.layers[0]._featureFilter.filter(new z(this.zoom),Y,s))continue;const oe=x?x.evaluate(Y,{},s):void 0,de={id:F,properties:M.properties,type:M.type,sourceLayerIndex:H,index:U,geometry:G?Y.geometry:vc(M,s,u),patterns:{},sortKey:oe};y.push(de)}x&&y.sort((M,F)=>M.sortKey-F.sortKey);let D=null;"globe"===u.projection.name&&(this.globeExtVertexArray=new En,D=u.projection);for(const M of y){const{geometry:F,index:U,sourceLayerIndex:H}=M,G=e[U].feature;this.addFeature(M,F,U,i.availableImages,s,D),i.featureIndex.insert(G,F,U,H,this.index)}}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,A_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,s,u,p,y){for(const x of i)for(const D of x){const M=D.x,F=D.y;if(M<0||M>=pi||F<0||F>=pi)continue;if(y){const G=y.projectTilePoint(M,F,p),Y=y.upVector(p,M,F),oe=this.globeExtVertexArray;Ju(oe,G,Y),Ju(oe,G,Y),Ju(oe,G,Y),Ju(oe,G,Y)}const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),H=U.vertexLength;Mh(this.layoutVertexArray,M,F,-1,-1),Mh(this.layoutVertexArray,M,F,1,-1),Mh(this.layoutVertexArray,M,F,1,1),Mh(this.layoutVertexArray,M,F,-1,1),this.indexArray.emplaceBack(H,H+1,H+2),this.indexArray.emplaceBack(H,H+2,H+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,p)}}function Sh(n,e){for(let i=0;i<n.length;i++)if(jc(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(jc(n,e[i]))return!0;return!!Pd(n,e)}function Ih(n,e,i){return!!jc(n,e)||!!Ah(e,n,i)}function Jp(n,e){if(1===n.length)return _g(e,n[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let u=0;u<s.length;u++)if(jc(n,s[u]))return!0}for(let i=0;i<n.length;i++)if(_g(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Pd(n,e[i]))return!0;return!1}function Qp(n,e,i){if(n.length>1){if(Pd(n,e))return!0;for(let s=0;s<e.length;s++)if(Ah(e[s],n,i))return!0}for(let s=0;s<n.length;s++)if(Ah(n[s],e,i))return!0;return!1}function Pd(n,e){if(0===n.length||0===e.length)return!1;for(let i=0;i<n.length-1;i++){const s=n[i],u=n[i+1];for(let p=0;p<e.length-1;p++)if(gg(s,u,e[p],e[p+1]))return!0}return!1}function gg(n,e,i,s){return $i(n,i,s)!==$i(e,i,s)&&$i(n,e,i)!==$i(n,e,s)}function Ah(n,e,i){const s=i*i;if(1===e.length)return n.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(Rd(n,e[u-1],e[u])<s)return!0;return!1}function Rd(n,e,i){const s=e.distSqr(i);if(0===s)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/s;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function _g(n,e){let i,s,u,p=!1;for(let y=0;y<n.length;y++){i=n[y];for(let x=0,D=i.length-1;x<i.length;D=x++)s=i[x],u=i[D],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(p=!p)}return p}function jc(n,e){let i=!1;for(let s=0,u=n.length-1;s<n.length;u=s++){const p=n[s],y=n[u];p.y>e.y!=y.y>e.y&&e.x<(y.x-p.x)*(e.y-p.y)/(y.y-p.y)+p.x&&(i=!i)}return i}function em(n,e,i,s,u){for(const y of n)if(e<=y.x&&i<=y.y&&s>=y.x&&u>=y.y)return!0;const p=[new Ze(e,i),new Ze(e,u),new Ze(s,u),new Ze(s,i)];if(n.length>2)for(const y of p)if(jc(n,y))return!0;for(let y=0;y<n.length-1;y++)if(yg(n[y],n[y+1],p))return!0;return!1}function yg(n,e,i){const s=i[0],u=i[2];if(n.x<s.x&&e.x<s.x||n.x>u.x&&e.x>u.x||n.y<s.y&&e.y<s.y||n.y>u.y&&e.y>u.y)return!1;const p=$i(n,e,i[0]);return p!==$i(n,e,i[1])||p!==$i(n,e,i[2])||p!==$i(n,e,i[3])}function Qu(n,e,i){const s=e.paint.get(n).value;return"constant"===s.kind?s.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Od(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Ph(n,e,i,s,u){if(!e[0]&&!e[1])return n;const p=Ze.convert(e)._mult(u);"viewport"===i&&p._rotate(-s);const y=[];for(let x=0;x<n.length;x++)y.push(n[x].sub(p));return y}function Rh(n,e,i,s){const u=Ze.convert(n)._mult(s);return"viewport"===e&&u._rotate(-i),u}Wn(Ff,"CircleBucket",{omit:["layers"]});const tm=new Pe({"circle-sort-key":new _e(xt.layout_circle["circle-sort-key"])});var kd={paint:new Pe({"circle-radius":new _e(xt.paint_circle["circle-radius"]),"circle-color":new _e(xt.paint_circle["circle-color"]),"circle-blur":new _e(xt.paint_circle["circle-blur"]),"circle-opacity":new _e(xt.paint_circle["circle-opacity"]),"circle-translate":new le(xt.paint_circle["circle-translate"]),"circle-translate-anchor":new le(xt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new le(xt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new le(xt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _e(xt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _e(xt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _e(xt.paint_circle["circle-stroke-opacity"])}),layout:tm};function vg(n,e,i,s,u,p,y,x,D){if(p&&n.queryGeometry.isAboveHorizon)return!1;p&&(D*=n.pixelToTileUnitsFactor);const M=n.tileID.canonical,F=i.projection.upVectorScale(M,i.center.lat,i.worldSize).metersToTile;for(const U of e)for(const H of U){const G=H.add(x),Y=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(G.x,G.y,!0):0,oe=i.projection.projectTilePoint(G.x,G.y,M);if(Y>0){const Ce=i.projection.upVector(M,G.x,G.y);oe.x+=Ce[0]*F*Y,oe.y+=Ce[1]*F*Y,oe.z+=Ce[2]*F*Y}const de=p?G:O_(oe.x,oe.y,oe.z,s),Ee=p?n.tilespaceRays.map(Ce=>nm(Ce,Y)):n.queryGeometry.screenGeometry,Ne=yu([],[oe.x,oe.y,oe.z,1],s);if(!y&&p?D*=Ne[3]/i.cameraToCenterDistance:y&&!p&&(D*=i.cameraToCenterDistance/Ne[3]),p){const Ce=hs((H.y/pi+M.y)/(1<<M.z));D/=i.projection.pixelsPerMeter(Ce,1)/xa(1,Ce)}if(Ih(Ee,de,D))return!0}return!1}function O_(n,e,i,s){const u=yu([],[n,e,i,1],s);return new Ze(u[0]/u[3],u[1]/u[3])}const k_=_h(0,0,0),L_=_h(0,0,1);function nm(n,e){const i=wf();return k_[2]=e,n.intersectsPlane(k_,L_,i),new Ze(i[0],i[1])}class bg extends Ff{}function ed(n,{width:e,height:i},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*s);return n.width=e,n.height=i,n.data=u,n}function Oh(n,e,i){const{width:s,height:u}=e;s===n.width&&u===n.height||(kh(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,u)},i),n.width=s,n.height=u,n.data=e.data)}function kh(n,e,i,s,u,p){if(0===u.width||0===u.height)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const y=n.data,x=e.data;for(let D=0;D<u.height;D++){const M=((i.y+D)*n.width+i.x)*p,F=((s.y+D)*e.width+s.x)*p;for(let U=0;U<u.width*p;U++)x[F+U]=y[M+U]}return e}Wn(bg,"HeatmapBucket",{omit:["layers"]});class Vl{constructor(e,i){ed(this,e,1,i)}resize(e){Oh(this,new Vl(e),1)}clone(){return new Vl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,p){kh(e,i,s,u,p,1)}}class wa{constructor(e,i){ed(this,e,4,i)}resize(e){Oh(this,new wa(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new wa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,p){kh(e,i,s,u,p,4)}}Wn(Vl,"AlphaImage"),Wn(wa,"RGBAImage");var xg={paint:new Pe({"heatmap-radius":new _e(xt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _e(xt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new le(xt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ie(xt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new le(xt.paint_heatmap["heatmap-opacity"])})};function Nf(n){const e={},i=n.resolution||256,s=n.clips?n.clips.length:1,u=n.image||new wa({width:i,height:s}),p=(y,x,D)=>{e[n.evaluationKey]=D;const M=n.expression.evaluate(e);u.data[y+x+0]=Math.floor(255*M.r/M.a),u.data[y+x+1]=Math.floor(255*M.g/M.a),u.data[y+x+2]=Math.floor(255*M.b/M.a),u.data[y+x+3]=Math.floor(255*M.a)};if(n.clips)for(let y=0,x=0;y<s;++y,x+=4*i)for(let D=0,M=0;D<i;D++,M+=4){const F=D/(i-1),{start:U,end:H}=n.clips[y];p(x,M,U*(1-F)+H*F)}else for(let y=0,x=0;y<i;y++,x+=4)p(0,x,y/(i-1));return u}var F_={paint:new Pe({"hillshade-illumination-direction":new le(xt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new le(xt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new le(xt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new le(xt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new le(xt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new le(xt.paint_hillshade["hillshade-accent-color"])})};const N_=st([{name:"a_pos",components:2,type:"Int16"}],4),{members:B_}=N_;var im={exports:{}};function Lh(n,e,i){i=i||2;var s,u,p,y,x,D,M,F=e&&e.length,U=F?e[0]*i:n.length,H=$c(n,0,U,i,!0),G=[];if(!H||H.next===H.prev)return G;if(F&&(H=function(oe,de,Ee,Ne){var Ce,Fe,ze,We=[];for(Ce=0,Fe=de.length;Ce<Fe;Ce++)(ze=$c(oe,de[Ce]*Ne,Ce<Fe-1?de[Ce+1]*Ne:oe.length,Ne,!1))===ze.next&&(ze.steiner=!0),We.push(wg(ze));for(We.sort(Iy),Ce=0;Ce<We.length;Ce++)Ee=Bf(We[Ce],Ee);return Ee}(n,e,H,i)),n.length>80*i){s=p=n[0],u=y=n[1];for(var Y=i;Y<U;Y+=i)(x=n[Y])<s&&(s=x),(D=n[Y+1])<u&&(u=D),x>p&&(p=x),D>y&&(y=D);M=0!==(M=Math.max(p-s,y-u))?32767/M:0}return Fh(H,G,i,s,u,M,0),G}function $c(n,e,i,s,u){var p,y;if(u===Eg(n,e,i,s)>0)for(p=e;p<i;p+=s)y=sm(p,n[p],n[p+1],y);else for(p=i-s;p>=e;p-=s)y=sm(p,n[p],n[p+1],y);return y&&Hc(y,y.next)&&(td(y),y=y.next),y}function jl(n,e){if(!n)return n;e||(e=n);var i,s=n;do{if(i=!1,s.steiner||!Hc(s,s.next)&&0!==to(s.prev,s,s.next))s=s.next;else{if(td(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function Fh(n,e,i,s,u,p,y){if(n){!y&&p&&function(F,U,H,G){var Y=F;do{0===Y.z&&(Y.z=Ld(Y.x,Y.y,U,H,G)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next}while(Y!==F);Y.prevZ.nextZ=null,Y.prevZ=null,function(oe){var de,Ee,Ne,Ce,Fe,ze,We,At,yt=1;do{for(Ee=oe,oe=null,Fe=null,ze=0;Ee;){for(ze++,Ne=Ee,We=0,de=0;de<yt&&(We++,Ne=Ne.nextZ);de++);for(At=yt;We>0||At>0&&Ne;)0!==We&&(0===At||!Ne||Ee.z<=Ne.z)?(Ce=Ee,Ee=Ee.nextZ,We--):(Ce=Ne,Ne=Ne.nextZ,At--),Fe?Fe.nextZ=Ce:oe=Ce,Ce.prevZ=Fe,Fe=Ce;Ee=Ne}Fe.nextZ=null,yt*=2}while(ze>1)}(Y)}(n,s,u,p);for(var x,D,M=n;n.prev!==n.next;)if(x=n.prev,D=n.next,p?Ty(n,s,u,p):Dy(n))e.push(x.i/i|0),e.push(n.i/i|0),e.push(D.i/i|0),td(n),n=D.next,M=D.next;else if((n=D)===M){y?1===y?Fh(n=My(jl(n),e,i),e,i,s,u,p,2):2===y&&Sy(n,e,i,s,u,p):Fh(jl(n),e,i,s,u,p,1);break}}}function Dy(n){var e=n.prev,i=n,s=n.next;if(to(e,i,s)>=0)return!1;for(var u=e.x,p=i.x,y=s.x,x=e.y,D=i.y,M=s.y,F=u<p?u<y?u:y:p<y?p:y,U=x<D?x<M?x:M:D<M?D:M,H=u>p?u>y?u:y:p>y?p:y,G=x>D?x>M?x:M:D>M?D:M,Y=s.next;Y!==e;){if(Y.x>=F&&Y.x<=H&&Y.y>=U&&Y.y<=G&&Fd(u,x,p,D,y,M,Y.x,Y.y)&&to(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function Ty(n,e,i,s){var u=n.prev,p=n,y=n.next;if(to(u,p,y)>=0)return!1;for(var x=u.x,D=p.x,M=y.x,F=u.y,U=p.y,H=y.y,G=x<D?x<M?x:M:D<M?D:M,Y=F<U?F<H?F:H:U<H?U:H,oe=x>D?x>M?x:M:D>M?D:M,de=F>U?F>H?F:H:U>H?U:H,Ee=Ld(G,Y,e,i,s),Ne=Ld(oe,de,e,i,s),Ce=n.prevZ,Fe=n.nextZ;Ce&&Ce.z>=Ee&&Fe&&Fe.z<=Ne;){if(Ce.x>=G&&Ce.x<=oe&&Ce.y>=Y&&Ce.y<=de&&Ce!==u&&Ce!==y&&Fd(x,F,D,U,M,H,Ce.x,Ce.y)&&to(Ce.prev,Ce,Ce.next)>=0||(Ce=Ce.prevZ,Fe.x>=G&&Fe.x<=oe&&Fe.y>=Y&&Fe.y<=de&&Fe!==u&&Fe!==y&&Fd(x,F,D,U,M,H,Fe.x,Fe.y)&&to(Fe.prev,Fe,Fe.next)>=0))return!1;Fe=Fe.nextZ}for(;Ce&&Ce.z>=Ee;){if(Ce.x>=G&&Ce.x<=oe&&Ce.y>=Y&&Ce.y<=de&&Ce!==u&&Ce!==y&&Fd(x,F,D,U,M,H,Ce.x,Ce.y)&&to(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.prevZ}for(;Fe&&Fe.z<=Ne;){if(Fe.x>=G&&Fe.x<=oe&&Fe.y>=Y&&Fe.y<=de&&Fe!==u&&Fe!==y&&Fd(x,F,D,U,M,H,Fe.x,Fe.y)&&to(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.nextZ}return!0}function My(n,e,i){var s=n;do{var u=s.prev,p=s.next.next;!Hc(u,p)&&Uf(u,s,s.next,p)&&Gc(u,p)&&Gc(p,u)&&(e.push(u.i/i|0),e.push(s.i/i|0),e.push(p.i/i|0),td(s),td(s.next),s=n=p),s=s.next}while(s!==n);return jl(s)}function Sy(n,e,i,s,u,p){var y=n;do{for(var x=y.next.next;x!==y.prev;){if(y.i!==x.i&&zf(y,x)){var D=om(y,x);return y=jl(y,y.next),D=jl(D,D.next),Fh(y,e,i,s,u,p,0),void Fh(D,e,i,s,u,p,0)}x=x.next}y=y.next}while(y!==n)}function Iy(n,e){return n.x-e.x}function Bf(n,e){var i=function(u,p){var y,x=p,D=u.x,M=u.y,F=-1/0;do{if(M<=x.y&&M>=x.next.y&&x.next.y!==x.y){var U=x.x+(M-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(U<=D&&U>F&&(F=U,y=x.x<x.next.x?x:x.next,U===D))return y}x=x.next}while(x!==p);if(!y)return null;var H,G=y,Y=y.x,oe=y.y,de=1/0;x=y;do{D>=x.x&&x.x>=Y&&D!==x.x&&Fd(M<oe?D:F,M,Y,oe,M<oe?F:D,M,x.x,x.y)&&(H=Math.abs(M-x.y)/(D-x.x),Gc(x,u)&&(H<de||H===de&&(x.x>y.x||x.x===y.x&&rm(y,x)))&&(y=x,de=H)),x=x.next}while(x!==G);return y}(n,e);if(!i)return e;var s=om(i,n);return jl(s,s.next),jl(i,i.next)}function rm(n,e){return to(n.prev,n,e.prev)<0&&to(e.next,n,n.next)<0}function Ld(n,e,i,s,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wg(n){var e=n,i=n;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==n);return i}function Fd(n,e,i,s,u,p,y,x){return(u-y)*(e-x)>=(n-y)*(p-x)&&(n-y)*(s-x)>=(i-y)*(e-x)&&(i-y)*(p-x)>=(u-y)*(s-x)}function zf(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,s){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==s.i&&u.next.i!==s.i&&Uf(u,u.next,i,s))return!0;u=u.next}while(u!==i);return!1}(n,e)&&(Gc(n,e)&&Gc(e,n)&&function(i,s){var u=i,p=!1,y=(i.x+s.x)/2,x=(i.y+s.y)/2;do{u.y>x!=u.next.y>x&&u.next.y!==u.y&&y<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next}while(u!==i);return p}(n,e)&&(to(n.prev,n,e.prev)||to(n,e.prev,e))||Hc(n,e)&&to(n.prev,n,n.next)>0&&to(e.prev,e,e.next)>0)}function to(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Hc(n,e){return n.x===e.x&&n.y===e.y}function Uf(n,e,i,s){var u=Nh(to(n,e,i)),p=Nh(to(n,e,s)),y=Nh(to(i,s,n)),x=Nh(to(i,s,e));return u!==p&&y!==x||!(0!==u||!Nd(n,i,e))||!(0!==p||!Nd(n,s,e))||!(0!==y||!Nd(i,n,s))||!(0!==x||!Nd(i,e,s))}function Nd(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Nh(n){return n>0?1:n<0?-1:0}function Gc(n,e){return to(n.prev,n,n.next)<0?to(n,e,n.next)>=0&&to(n,n.prev,e)>=0:to(n,e,n.prev)<0||to(n,n.next,e)<0}function om(n,e){var i=new Bh(n.i,n.x,n.y),s=new Bh(e.i,e.x,e.y),u=n.next,p=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,s.next=i,i.prev=s,p.next=s,s.prev=p,s}function sm(n,e,i,s){var u=new Bh(n,e,i);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function td(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Bh(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Eg(n,e,i,s){for(var u=0,p=e,y=i-s;p<i;p+=s)u+=(n[y]-n[p])*(n[p+1]+n[y+1]),y=p;return u}im.exports=Lh,im.exports.default=Lh,Lh.deviation=function(n,e,i,s){var u=e&&e.length,p=Math.abs(Eg(n,0,u?e[0]*i:n.length,i));if(u)for(var y=0,x=e.length;y<x;y++)p-=Math.abs(Eg(n,e[y]*i,y<x-1?e[y+1]*i:n.length,i));var D=0;for(y=0;y<s.length;y+=3){var M=s[y]*i,F=s[y+1]*i,U=s[y+2]*i;D+=Math.abs((n[M]-n[U])*(n[F+1]-n[M+1])-(n[M]-n[F])*(n[U+1]-n[M+1]))}return 0===p&&0===D?0:Math.abs((D-p)/p)},Lh.flatten=function(n){for(var e=n[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,u=0;u<n.length;u++){for(var p=0;p<n[u].length;p++)for(var y=0;y<e;y++)i.vertices.push(n[u][p][y]);u>0&&i.holes.push(s+=n[u-1].length)}return i};var Cg=St(im.exports);function Dg(n,e,i,s,u){Tg(n,e,i||0,s||n.length-1,u||z_)}function Tg(n,e,i,s,u){for(;s>i;){if(s-i>600){var p=s-i+1,y=e-i+1,x=Math.log(p),D=.5*Math.exp(2*x/3),M=.5*Math.sqrt(x*D*(p-D)/p)*(y-p/2<0?-1:1);Tg(n,e,Math.max(i,Math.floor(e-y*D/p+M)),Math.min(s,Math.floor(e+(p-y)*D/p+M)),u)}var F=n[e],U=i,H=s;for(zh(n,i,e),u(n[s],F)>0&&zh(n,i,s);U<H;){for(zh(n,U,H),U++,H--;u(n[U],F)<0;)U++;for(;u(n[H],F)>0;)H--}0===u(n[i],F)?zh(n,i,H):zh(n,++H,s),H<=e&&(i=H+1),e<=H&&(s=H-1)}}function zh(n,e,i){var s=n[e];n[e]=n[i],n[i]=s}function z_(n,e){return n<e?-1:n>e?1:0}function Uh(n,e){const i=n.length;if(i<=1)return[n];const s=[];let u,p;for(let y=0;y<i;y++){const x=Gr(n[y]);0!==x&&(n[y].area=Math.abs(x),void 0===p&&(p=x<0),p===x<0?(u&&s.push(u),u=[n[y]]):u.push(n[y]))}if(u&&s.push(u),e>1)for(let y=0;y<s.length;y++)s[y].length<=e||(Dg(s[y],e,1,s[y].length-1,Mg),s[y]=s[y].slice(0,e));return s}function Mg(n,e){return e.area-n.area}function Bd(n,e,i){const s=i.patternDependencies;let u=!1;for(const p of e){const y=p.paint.get(`${n}-pattern`);y.isConstant()||(u=!0);const x=y.constantOr(null);x&&(u=!0,s[x]=!0)}return u}function Vf(n,e,i,s,u){const p=u.patternDependencies;for(const y of e){const x=y.paint.get(`${n}-pattern`).value;if("constant"!==x.kind){let D=x.evaluate({zoom:s},i,{},u.availableImages);D=D&&D.name?D.name:D,p[D]=!0,i.patterns[y.id]=D}}return i}class nd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pn,this.indexArray=new Qn,this.indexArray2=new Wo,this.programConfigurations=new ju(e.layers,e.zoom),this.segments=new Qo,this.segments2=new Qo,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,s,u){this.hasPattern=Bd("fill",this.layers,i);const p=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:x,id:D,index:M,sourceLayerIndex:F}of e){const U=this.layers[0]._featureFilter.needGeometry,H=Vc(x,U);if(!this.layers[0]._featureFilter.filter(new z(this.zoom),H,s))continue;const G=p?p.evaluate(H,{},s,i.availableImages):void 0,Y={id:D,properties:x.properties,type:x.type,sourceLayerIndex:F,index:M,geometry:U?H.geometry:vc(x,s,u),patterns:{},sortKey:G};y.push(Y)}p&&y.sort((x,D)=>x.sortKey-D.sortKey);for(const x of y){const{geometry:D,index:M,sourceLayerIndex:F}=x;if(this.hasPattern){const U=Vf("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(U)}else this.addFeature(x,D,M,s,{},i.availableImages);i.featureIndex.insert(e[M].feature,D,M,F,this.index)}}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}addFeatures(e,i,s,u,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,B_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,s,u,p,y=[]){for(const x of Uh(i,500)){let D=0;for(const Y of x)D+=Y.length;const M=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),F=M.vertexLength,U=[],H=[];for(const Y of x){if(0===Y.length)continue;Y!==x[0]&&H.push(U.length/2);const oe=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),de=oe.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(de+Y.length-1,de),U.push(Y[0].x),U.push(Y[0].y);for(let Ee=1;Ee<Y.length;Ee++)this.layoutVertexArray.emplaceBack(Y[Ee].x,Y[Ee].y),this.indexArray2.emplaceBack(de+Ee-1,de+Ee),U.push(Y[Ee].x),U.push(Y[Ee].y);oe.vertexLength+=Y.length,oe.primitiveLength+=Y.length}const G=Cg(U,H);for(let Y=0;Y<G.length;Y+=3)this.indexArray.emplaceBack(F+G[Y],F+G[Y+1],F+G[Y+2]);M.vertexLength+=D,M.primitiveLength+=G.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,y,u)}}Wn(nd,"FillBucket",{omit:["layers","patternFeatures"]});const id=new Pe({"fill-sort-key":new _e(xt.layout_fill["fill-sort-key"])});var zd={paint:new Pe({"fill-antialias":new le(xt.paint_fill["fill-antialias"]),"fill-opacity":new _e(xt.paint_fill["fill-opacity"]),"fill-color":new _e(xt.paint_fill["fill-color"]),"fill-outline-color":new _e(xt.paint_fill["fill-outline-color"]),"fill-translate":new le(xt.paint_fill["fill-translate"]),"fill-translate-anchor":new le(xt.paint_fill["fill-translate-anchor"]),"fill-pattern":new _e(xt.paint_fill["fill-pattern"])}),layout:id};const U_=st([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),V_=st([{name:"a_centroid_pos",components:2,type:"Uint16"}]),am=st([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Sg}=U_;var jf={},j_=Dn,Ig=Ud;function Ud(n,e,i,s,u){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=s,this._values=u,n.readFields(Ag,this,e)}function Ag(n,e,i){1==n?e.id=i.readVarint():2==n?function(s,u){for(var p=s.readVarint()+s.pos;s.pos<p;){var y=u._keys[s.readVarint()],x=u._values[s.readVarint()];u.properties[y]=x}}(i,e):3==n?e.type=i.readVarint():4==n&&(e._geometry=i.pos)}function $_(n){for(var e,i,s=0,u=0,p=n.length,y=p-1;u<p;y=u++)s+=((i=n[y]).x-(e=n[u]).x)*(e.y+i.y);return s}Ud.types=["Unknown","Point","LineString","Polygon"],Ud.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,i=n.readVarint()+n.pos,s=1,u=0,p=0,y=0,x=[];n.pos<i;){if(u<=0){var D=n.readVarint();s=7&D,u=D>>3}if(u--,1===s||2===s)p+=n.readSVarint(),y+=n.readSVarint(),1===s&&(e&&x.push(e),e=[]),e.push(new j_(p,y));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&x.push(e),x},Ud.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,i=1,s=0,u=0,p=0,y=1/0,x=-1/0,D=1/0,M=-1/0;n.pos<e;){if(s<=0){var F=n.readVarint();i=7&F,s=F>>3}if(s--,1===i||2===i)(u+=n.readSVarint())<y&&(y=u),u>x&&(x=u),(p+=n.readSVarint())<D&&(D=p),p>M&&(M=p);else if(7!==i)throw new Error("unknown command "+i)}return[y,D,x,M]},Ud.prototype.toGeoJSON=function(n,e,i){var s,u,p=this.extent*Math.pow(2,i),y=this.extent*n,x=this.extent*e,D=this.loadGeometry(),M=Ud.types[this.type];function F(G){for(var Y=0;Y<G.length;Y++){var oe=G[Y];G[Y]=[360*(oe.x+y)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+x)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(s=0;s<D.length;s++)U[s]=D[s][0];F(D=U);break;case 2:for(s=0;s<D.length;s++)F(D[s]);break;case 3:for(D=function(G){var Y=G.length;if(Y<=1)return[G];for(var oe,de,Ee=[],Ne=0;Ne<Y;Ne++){var Ce=$_(G[Ne]);0!==Ce&&(void 0===de&&(de=Ce<0),de===Ce<0?(oe&&Ee.push(oe),oe=[G[Ne]]):oe.push(G[Ne]))}return oe&&Ee.push(oe),Ee}(D),s=0;s<D.length;s++)for(u=0;u<D[s].length;u++)F(D[s][u])}1===D.length?D=D[0]:M="Multi"+M;var H={type:"Feature",geometry:{type:M,coordinates:D},properties:this.properties};return"id"in this&&(H.id=this.id),H};var Ay=Ig,Vd=no;function no(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(Vh,this,e),this.length=this._features.length}function Vh(n,e,i){15===n?e.version=i.readVarint():1===n?e.name=i.readString():5===n?e.extent=i.readVarint():2===n?e._features.push(i.pos):3===n?e._keys.push(i.readString()):4===n&&e._values.push(function(s){for(var u=null,p=s.readVarint()+s.pos;s.pos<p;){var y=s.readVarint()>>3;u=1===y?s.readString():2===y?s.readFloat():3===y?s.readDouble():4===y?s.readVarint64():5===y?s.readVarint():6===y?s.readSVarint():7===y?s.readBoolean():null}return u}(i))}no.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new Ay(this._pbf,e,this.extent,this._keys,this._values)};var Pg=Vd;function Rg(n,e,i){if(3===n){var s=new Pg(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}var jh=jf.VectorTile=function(n,e){this.layers=n.readFields(Rg,{},e)},jd=jf.VectorTileFeature=Ig;function $f(n,e,i,s){const u=[],p=0===s?(y,x,D,M,F,U)=>{y.push(new Ze(U,D+(U-x)/(M-x)*(F-D)))}:(y,x,D,M,F,U)=>{y.push(new Ze(x+(U-D)/(F-D)*(M-x),U))};for(const y of n){const x=[];for(const D of y){if(D.length<=2)continue;const M=[];for(let H=0;H<D.length-1;H++){const G=D[H].x,Y=D[H].y,oe=D[H+1].x,de=D[H+1].y,Ee=0===s?G:Y,Ne=0===s?oe:de;Ee<e?Ne>e&&p(M,G,Y,oe,de,e):Ee>i?Ne<i&&p(M,G,Y,oe,de,i):M.push(D[H]),Ne<e&&Ee>=e&&p(M,G,Y,oe,de,e),Ne>i&&Ee<=i&&p(M,G,Y,oe,de,i)}let F=D[D.length-1];const U=0===s?F.x:F.y;U>=e&&U<=i&&M.push(F),M.length&&(F=M[M.length-1],M[0].x===F.x&&M[0].y===F.y||M.push(M[0]),x.push(M))}x.length&&u.push(x)}return u}jf.VectorTileLayer=Vd;const Og=jd.types,kg=Math.pow(2,13);function Du(n,e,i,s,u,p,y,x){n.emplaceBack((e<<1)+y,(i<<1)+p,(Math.floor(s*kg)<<1)+u,Math.round(x))}function Wc(n,e,i){n.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class Hf{constructor(){this.acc=new Ze(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ze(e.x,e.y),this.max=new Ze(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,u=this.max;e.x<s.x?s.x=e.x:e.x>u.x&&(u.x=e.x),e.y<s.y?s.y=e.y:e.y>u.y&&(u.y=e.y),((0===e.x||e.x===pi)&&e.x===i.x)!=((0===e.y||e.y===pi)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,Ki(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>pi!=e.x>pi&&this.addBorderIntersection(1,Ki(i.y,e.y,(pi-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ki(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>pi!=e.y>pi&&this.addBorderIntersection(3,Ki(i.x,e.x,(pi-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((i,s)=>i+s.edges,0);return 0!==e?this.acc.div(e)._round():new Ze(0,0)}span(){return new Ze(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class $d{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Qt,this.centroidVertexArray=new fc,this.indexArray=new Qn,this.programConfigurations=new ju(e.layers,e.zoom),this.segments=new Qo,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,s,u){this.features=[],this.hasPattern=Bd("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const y=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*y/(y*y+1)/pi/(1<<p.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:y,index:x,sourceLayerIndex:D}of e){const M=this.layers[0]._featureFilter.needGeometry,F=Vc(p,M);if(!this.layers[0]._featureFilter.filter(new z(this.zoom),F,s))continue;const U={id:y,sourceLayerIndex:D,index:x,geometry:M?F.geometry:vc(p,s,u),properties:p.properties,type:p.type,patterns:{}},H=this.layoutVertexArray.length;this.hasPattern?this.features.push(Vf("fill-extrusion",this.layers,U,this.zoom,i)):this.addFeature(U,U.geometry,x,s,{},i.availableImages,u),i.featureIndex.insert(p,U.geometry,x,D,this.index,H)}this.sortBorders()}addFeatures(e,i,s,u,p){for(const y of this.features){const{geometry:x}=y;this.addFeature(y,x,y.index,i,s,u,p)}this.sortBorders()}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,am.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,V_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,u,p,y,x){const D=[new Ze(0,0),new Ze(pi,pi)],M=x.projection,F="globe"===M.name,U=this.enableTerrain&&!F?new Hf:null,H="Polygon"===Og[e.type];F&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new En);const G=Uh(i,500);for(let Ee=G.length-1;Ee>=0;Ee--){const Ne=G[Ee];(0===Ne.length||(Y=Ne[0]).every(Ce=>Ce.x<=0)||Y.every(Ce=>Ce.x>=pi)||Y.every(Ce=>Ce.y<=0)||Y.every(Ce=>Ce.y>=pi))&&G.splice(Ee,1)}var Y;let oe;if(F)oe=Wd(G,D,u);else{oe=[];for(const Ee of G)oe.push({polygon:Ee,bounds:D})}const de=H?this.edgeRadius:0;for(const{polygon:Ee,bounds:Ne}of oe){let Ce=0,Fe=0;for(const We of Ee)H&&!We[0].equals(We[We.length-1])&&We.push(We[0]),Fe+=H?We.length-1:We.length;const ze=this.segments.prepareSegment((H?5:4)*Fe,this.layoutVertexArray,this.indexArray);if(H){const We=[],At=[];Ce=ze.vertexLength;for(const Wt of Ee){let sn,Lt;Wt.length&&Wt!==Ee[0]&&At.push(We.length/2),sn=Wt[1].sub(Wt[0])._perp()._unit();for(let nn=1;nn<Wt.length;nn++){const rn=Wt[nn],gn=Wt[nn===Wt.length-1?1:nn+1];let{x:xn,y:Ht}=rn;if(de){Lt=gn.sub(rn)._perp()._unit();const On=sn.add(Lt)._unit(),Zn=de*Math.min(4,1/(sn.x*On.x+sn.y*On.y));xn+=Zn*On.x,Ht+=Zn*On.y,sn=Lt}Du(this.layoutVertexArray,xn,Ht,0,0,1,1,0),ze.vertexLength++,We.push(rn.x,rn.y),F&&Wc(this.layoutVertexExtArray,M.projectTilePoint(xn,Ht,u),M.upVector(u,xn,Ht))}}const yt=Cg(We,At);for(let Wt=0;Wt<yt.length;Wt+=3)this.indexArray.emplaceBack(Ce+yt[Wt],Ce+yt[Wt+2],Ce+yt[Wt+1]),ze.primitiveLength++}for(const We of Ee){U&&We.length&&U.startRing(We[0]);let At,yt,Wt,sn=We.length>4&&Gf(We[We.length-2],We[0],We[1]),Lt=de?lm(We[We.length-2],We[0],We[1],de):0;yt=We[1].sub(We[0])._perp()._unit();let nn=!0;for(let rn=1,gn=0;rn<We.length;rn++){let xn=We[rn-1],Ht=We[rn];const On=We[rn===We.length-1?1:rn+1];if(U&&H&&U.currentPolyCount.top++,Zc(Ht,xn,Ne)){de&&(yt=On.sub(Ht)._perp()._unit(),nn=!nn);continue}U&&U.append(Ht,xn);const Zn=Ht.sub(xn)._perp(),jn=Zn.x/(Math.abs(Zn.x)+Math.abs(Zn.y)),Di=Zn.y>0?1:0,In=xn.dist(Ht);if(gn+In>32768&&(gn=0),de){Wt=On.sub(Ht)._perp()._unit();let Ni=$h(xn,Ht,On,Hd(yt,Wt),de);isNaN(Ni)&&(Ni=0);const yi=Ht.sub(xn)._unit();xn=xn.add(yi.mult(Lt))._round(),Ht=Ht.add(yi.mult(-Ni))._round(),Lt=Ni,yt=Wt}const li=ze.vertexLength,Fi=We.length>4&&Gf(xn,Ht,On);let vr=Gd(gn,sn,nn);if(Du(this.layoutVertexArray,xn.x,xn.y,jn,Di,0,0,vr),Du(this.layoutVertexArray,xn.x,xn.y,jn,Di,0,1,vr),gn+=In,vr=Gd(gn,Fi,!nn),sn=Fi,Du(this.layoutVertexArray,Ht.x,Ht.y,jn,Di,0,0,vr),Du(this.layoutVertexArray,Ht.x,Ht.y,jn,Di,0,1,vr),ze.vertexLength+=4,this.indexArray.emplaceBack(li+0,li+1,li+2),this.indexArray.emplaceBack(li+1,li+3,li+2),ze.primitiveLength+=2,de){const Ni=Ce+(1===rn?We.length-2:rn-2),yi=1===rn?Ce:Ni+1;if(this.indexArray.emplaceBack(li+1,Ni,li+3),this.indexArray.emplaceBack(Ni,yi,li+3),ze.primitiveLength+=2,void 0===At&&(At=li),!Zc(On,We[rn],Ne)){const Kr=rn===We.length-1?At:ze.vertexLength;this.indexArray.emplaceBack(li+2,li+3,Kr),this.indexArray.emplaceBack(li+3,Kr+1,Kr),this.indexArray.emplaceBack(li+3,yi,Kr+1),ze.primitiveLength+=3}nn=!nn}if(F){const Ni=this.layoutVertexExtArray,yi=M.projectTilePoint(xn.x,xn.y,u),Kr=M.projectTilePoint(Ht.x,Ht.y,u),Ui=M.upVector(u,xn.x,xn.y),Vi=M.upVector(u,Ht.x,Ht.y);Wc(Ni,yi,Ui),Wc(Ni,yi,Ui),Wc(Ni,Kr,Vi),Wc(Ni,Kr,Vi)}}H&&(Ce+=We.length-1)}}if(U&&U.polyCount.length>0){if(U.borders){U.vertexArrayOffset=this.centroidVertexArray.length;const Ee=U.borders,Ne=this.featuresOnBorder.push(U)-1;for(let Ce=0;Ce<4;Ce++)Ee[Ce][0]!==Number.MAX_VALUE&&this.borders[Ce].push(Ne)}this.encodeCentroid(U.borders?void 0:U.centroid(),U)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,y,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,i,s=!0){let u,p;if(e)if(0!==e.y){const x=i.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else u=Math.ceil(7*(e.x+450)),p=0;else u=0,p=+s;let y=s?this.centroidVertexArray.length:i.vertexArrayOffset;for(const x of i.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let D=0;D<x.top;D++)this.centroidVertexArray.emplace(y++,u,p);for(let D=0;D<2*x.edges;D++)this.centroidVertexArray.emplace(y++,0,p),this.centroidVertexArray.emplace(y++,u,p)}}}function Hd(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function lm(n,e,i,s){const u=e.sub(n)._perp()._unit(),p=i.sub(e)._perp()._unit();return $h(n,e,i,Hd(u,p),s)}function $h(n,e,i,s,u){const p=Math.sqrt(1-s*s);return Math.min(n.dist(e)/3,e.dist(i)/3,u*p/s)}function Zc(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function Gf(n,e,i){if(n.x<0||n.x>=pi||e.x<0||e.x>=pi||i.x<0||i.x>=pi)return!1;const s=i.sub(e),u=s.perp(),p=n.sub(e);return(s.x*p.x+s.y*p.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(p.x*p.x+p.y*p.y))>-.866&&u.x*p.x+u.y*p.y<0}function Gd(n,e,i){const s=e?2|n:-3&n;return i?1|s:-2&s}function rd(){const n=Math.PI/32,e=Math.tan(n),i=Eu;return i*Math.sqrt(1+2*e*e)-i}function Wd(n,e,i){const s=1<<i.z,u=Fa(i.x/s),p=Fa((i.x+1)/s),y=hs(i.y/s),x=hs((i.y+1)/s);return function(D,M,F,U,H=0,G){const Y=[];if(!D.length||!F||!U)return Y;const oe=(We,At)=>{for(const yt of We)Y.push({polygon:yt,bounds:At})},de=Math.ceil(Math.log2(F)),Ee=Math.ceil(Math.log2(U)),Ne=de-Ee,Ce=[];for(let We=0;We<Math.abs(Ne);We++)Ce.push(Ne>0?0:1);for(let We=0;We<Math.min(de,Ee);We++)Ce.push(0),Ce.push(1);let Fe=D;if(Fe=$f(Fe,M[0].y-H,M[1].y+H,1),Fe=$f(Fe,M[0].x-H,M[1].x+H,0),!Fe.length)return Y;const ze=[];for(Ce.length?ze.push({polygons:Fe,bounds:M,depth:0}):oe(Fe,M);ze.length;){const We=ze.pop(),At=We.depth,yt=Ce[At],Wt=We.bounds[0],sn=We.bounds[1],Lt=0===yt?Wt.x:Wt.y,nn=0===yt?sn.x:sn.y,rn=G?G(yt,Lt,nn):.5*(Lt+nn),gn=$f(We.polygons,Lt-H,rn+H,yt),xn=$f(We.polygons,rn-H,nn+H,yt);if(gn.length){const Ht=[Wt,new Ze(0===yt?rn:sn.x,1===yt?rn:sn.y)];Ce.length>At+1?ze.push({polygons:gn,bounds:Ht,depth:At+1}):oe(gn,Ht)}if(xn.length){const Ht=[new Ze(0===yt?rn:Wt.x,1===yt?rn:Wt.y),sn];Ce.length>At+1?ze.push({polygons:xn,bounds:Ht,depth:At+1}):oe(xn,Ht)}}return Y}(n,e,Math.ceil((p-u)/11.25),Math.ceil((y-x)/11.25),1,(D,M,F)=>{if(0===D)return.5*(M+F);{const U=hs((i.y+M/pi)/s);return(Dl(.5*(hs((i.y+F/pi)/s)+U))*s-i.y)*pi}})}Wn($d,"FillExtrusionBucket",{omit:["layers","features"]}),Wn(Hf,"PartMetadata");const Wf=new Pe({"fill-extrusion-edge-radius":new le(xt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Zf={paint:new Pe({"fill-extrusion-opacity":new le(xt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _e(xt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new le(xt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new le(xt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _e(xt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _e(xt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _e(xt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new le(xt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new le(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new le(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new le(xt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Wf};function $l(n,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class qc{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Hh(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=(y=this.y,x=this.z,D=$l(256*(p=this.x),256*(y=Math.pow(2,x)-y-1),x),M=$l(256*(p+1),256*(y+1),x),D[0]+","+D[1]+","+M[0]+","+M[1]),u=function(p,y,x){let D,M="";for(let F=p;F>0;F--)D=1<<F-1,M+=(y&D?1:0)+(x&D?2:0);return M}(this.z,this.x,this.y);var p,y,x,D,M;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qf{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Hh(e,i.z,i.z,i.x,i.y)}}class Ea{constructor(e,i,s,u,p){this.overscaledZ=e,this.wrap=i,this.canonical=new qc(s,+u,+p),this.key=0===i&&e===s?this.canonical.key:Hh(i,e,s,u,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Ea(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ea(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Hh(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Hh(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Ea(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new Ea(i,this.wrap,i,s,u),new Ea(i,this.wrap,i,s+1,u),new Ea(i,this.wrap,i,s,u+1),new Ea(i,this.wrap,i,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ea(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ea(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Hh(n,e,i,s,u){const p=1<<Math.min(i,22);let y=p*(u%p)+s%p;return n&&i<22&&(y+=p*p*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*y+i)+(e-i)}Wn(qc,"CanonicalTileID"),Wn(Ea,"OverscaledTileID",{omit:["projMatrix"]});class od extends Ze{constructor(e,i,s){super(e,i),this.z=s}}function bc(n,e){return n.x*e.x+n.y*e.y}function Lg(n,e){if(1===n.length){let i=0;const s=e[i++];let u;for(;!u||s.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const p=e[i],y=n[0],x=u.sub(s),D=p.sub(s),M=y.sub(s),F=bc(x,x),U=bc(x,D),H=bc(D,D),G=bc(M,x),Y=bc(M,D),oe=F*H-U*U,de=(H*G-U*Y)/oe,Ee=(F*Y-U*G)/oe,Ne=s.z*(1-de-Ee)+u.z*de+p.z*Ee;if(isFinite(Ne))return Ne}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function Fg(n,e,i,s,u,p,y,x){const D=y*u.getElevationAt(n,e,!0,!0),M=0!==p[0],F=M?0===p[1]?y*(p[0]/7-450):y*function(U,H,G){const Y=Math.floor(H[0]/8),oe=Math.floor(H[1]/8),de=10*(H[0]-8*Y),Ee=10*(H[1]-8*oe),Ne=U.getElevationAt(Y,oe,!0,!0),Ce=U.getMeterToDEM(G),Fe=Math.floor(.5*(de*Ce-1)),ze=Math.floor(.5*(Ee*Ce-1)),We=U.tileCoordToPixel(Y,oe),At=2*Fe+1,yt=2*ze+1,Wt=(Zn=At,jn=yt,[(xn=U).getElevationAtPixel(Ht=We.x-Fe,On=We.y-ze,!0),xn.getElevationAtPixel(Ht+jn,On,!0),xn.getElevationAtPixel(Ht,On+jn,!0),xn.getElevationAtPixel(Ht+Zn,On+jn,!0)]),sn=Math.abs(Wt[0]-Wt[1]),Lt=Math.abs(Wt[2]-Wt[3]),nn=Math.abs(Wt[0]-Wt[2])+Math.abs(Wt[1]-Wt[3]),rn=Math.min(.25,.5*Ce*(sn+Lt)/At),gn=Math.min(.25,.5*Ce*nn/yt);var xn,Ht,On,Zn,jn;return Ne+Math.max(rn*de,gn*Ee)}(u,p,x):D;return{base:D+(0===i)?-1:i,top:M?Math.max(F+s,D+i+2):D+s}}const H_=st([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:cm}=H_,Ng=st([{name:"a_packed",components:4,type:"Float32"}]),{members:G_}=Ng,Bg=jd.types,um=Math.cos(Math.PI/180*37.5);class dm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new kt,this.layoutVertexArray2=new mn,this.indexArray=new Qn,this.programConfigurations=new ju(e.layers,e.zoom),this.segments=new Qo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,u){this.hasPattern=Bd("line",this.layers,i);const p=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:F,id:U,index:H,sourceLayerIndex:G}of e){const Y=this.layers[0]._featureFilter.needGeometry,oe=Vc(F,Y);if(!this.layers[0]._featureFilter.filter(new z(this.zoom),oe,s))continue;const de=p?p.evaluate(oe,{},s):void 0,Ee={id:U,properties:F.properties,type:F.type,sourceLayerIndex:G,index:H,geometry:Y?oe.geometry:vc(F,s,u),patterns:{},sortKey:de};y.push(Ee)}p&&y.sort((F,U)=>F.sortKey-U.sortKey);const{lineAtlas:x,featureIndex:D}=i,M=this.addConstantDashes(x);for(const F of y){const{geometry:U,index:H,sourceLayerIndex:G}=F;if(M&&this.addFeatureDashes(F,x),this.hasPattern){const Y=Vf("line",this.layers,F,this.zoom,i);this.patternFeatures.push(Y)}else this.addFeature(F,U,H,s,x.positions,i.availableImages);D.insert(e[H].feature,U,H,G,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,p=s.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==p.kind)i=!0;else{const y=p.value,x=u.value;if(!x)continue;e.addDash(x,y)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,y=u.layout.get("line-cap").value;if("constant"===p.kind&&"constant"===y.kind)continue;let x,D;if("constant"===p.kind){if(x=p.value,!x)continue}else x=p.evaluate({zoom:s},e);D="constant"===y.kind?y.value:y.evaluate({zoom:s},e),i.addDash(x,D),e.patterns[u.id]=i.getKey(x,D)}}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}addFeatures(e,i,s,u,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,G_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,u,p,y){const x=this.layers[0].layout,D=x.get("line-join").evaluate(e,{}),M=x.get("line-cap").evaluate(e,{}),F=x.get("line-miter-limit"),U=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const H of i)this.addLine(H,e,D,M,F,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,y,u)}addLine(e,i,s,u,p,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ee=0;Ee<e.length-1;Ee++)this.totalDistance+=e[Ee].dist(e[Ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===Bg[i.type];let D=e.length;for(;D>=2&&e[D-1].equals(e[D-2]);)D--;let M=0;for(;M<D-1&&e[M].equals(e[M+1]);)M++;if(D<(x?3:2))return;"bevel"===s&&(p=1.05);const F=this.overscaling<=16?15*pi/(512*this.overscaling):0,U=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let H,G,Y,oe,de;this.e1=this.e2=-1,x&&(H=e[D-2],de=e[M].sub(H)._unit()._perp());for(let Ee=M;Ee<D;Ee++){if(Y=Ee===D-1?x?e[M+1]:void 0:e[Ee+1],Y&&e[Ee].equals(Y))continue;de&&(oe=de),H&&(G=H),H=e[Ee],de=Y?Y.sub(H)._unit()._perp():oe,oe=oe||de;let Ne=oe.add(de);0===Ne.x&&0===Ne.y||Ne._unit();const Ce=oe.x*de.x+oe.y*de.y,Fe=Ne.x*de.x+Ne.y*de.y,ze=0!==Fe?1/Fe:1/0,We=2*Math.sqrt(2-2*Fe),At=Fe<um&&G&&Y,yt=oe.x*de.y-oe.y*de.x>0;if(At&&Ee>M){const Lt=H.dist(G);if(Lt>2*F){const nn=H.sub(H.sub(G)._mult(F/Lt)._round());this.updateDistance(G,nn),this.addCurrentVertex(nn,oe,0,0,U),G=nn}}const Wt=G&&Y;let sn=Wt?s:x?"butt":u;if(Wt&&"round"===sn&&(ze<y?sn="miter":ze<=2&&(sn="fakeround")),"miter"===sn&&ze>p&&(sn="bevel"),"bevel"===sn&&(ze>2&&(sn="flipbevel"),ze<p&&(sn="miter")),G&&this.updateDistance(G,H),"miter"===sn)Ne._mult(ze),this.addCurrentVertex(H,Ne,0,0,U);else if("flipbevel"===sn){if(ze>100)Ne=de.mult(-1);else{const Lt=ze*oe.add(de).mag()/oe.sub(de).mag();Ne._perp()._mult(Lt*(yt?-1:1))}this.addCurrentVertex(H,Ne,0,0,U),this.addCurrentVertex(H,Ne.mult(-1),0,0,U)}else if("bevel"===sn||"fakeround"===sn){const Lt=-Math.sqrt(ze*ze-1),nn=yt?Lt:0,rn=yt?0:Lt;if(G&&this.addCurrentVertex(H,oe,nn,rn,U),"fakeround"===sn){const gn=Math.round(180*We/Math.PI/20);for(let xn=1;xn<gn;xn++){let Ht=xn/gn;if(.5!==Ht){const Zn=Ht-.5;Ht+=Ht*Zn*(Ht-1)*((1.0904+Ce*(Ce*(3.55645-1.43519*Ce)-3.2452))*Zn*Zn+(.848013+Ce*(.215638*Ce-1.06021)))}const On=de.sub(oe)._mult(Ht)._add(oe)._unit()._mult(yt?-1:1);this.addHalfVertex(H,On.x,On.y,!1,yt,0,U)}}Y&&this.addCurrentVertex(H,de,-nn,-rn,U)}else if("butt"===sn)this.addCurrentVertex(H,Ne,0,0,U);else if("square"===sn){const Lt=G?1:-1;G||this.addCurrentVertex(H,Ne,Lt,Lt,U),this.addCurrentVertex(H,Ne,0,0,U),G&&this.addCurrentVertex(H,Ne,Lt,Lt,U)}else"round"===sn&&(G&&(this.addCurrentVertex(H,oe,0,0,U),this.addCurrentVertex(H,oe,1,1,U,!0)),Y&&(this.addCurrentVertex(H,de,-1,-1,U,!0),this.addCurrentVertex(H,de,0,0,U)));if(At&&Ee<D-1){const Lt=H.dist(Y);if(Lt>2*F){const nn=H.add(Y.sub(H)._mult(F/Lt)._round());this.updateDistance(H,nn),this.addCurrentVertex(nn,de,0,0,U),H=nn}}}}addCurrentVertex(e,i,s,u,p,y=!1){const x=i.y*u-i.x,D=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*s,i.y-i.x*s,y,!1,s,p),this.addHalfVertex(e,x,D,y,!0,-u,p)}addHalfVertex({x:e,y:i},s,u,p,y,x,D){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(y?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const M=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),D.primitiveLength++),y?this.e2=M:this.e1=M}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Wn(dm,"LineBucket",{omit:["layers","patternFeatures"]});const W_=new Pe({"line-cap":new _e(xt.layout_line["line-cap"]),"line-join":new _e(xt.layout_line["line-join"]),"line-miter-limit":new le(xt.layout_line["line-miter-limit"]),"line-round-limit":new le(xt.layout_line["line-round-limit"]),"line-sort-key":new _e(xt.layout_line["line-sort-key"])});var zg={paint:new Pe({"line-opacity":new _e(xt.paint_line["line-opacity"]),"line-color":new _e(xt.paint_line["line-color"]),"line-translate":new le(xt.paint_line["line-translate"]),"line-translate-anchor":new le(xt.paint_line["line-translate-anchor"]),"line-width":new _e(xt.paint_line["line-width"]),"line-gap-width":new _e(xt.paint_line["line-gap-width"]),"line-offset":new _e(xt.paint_line["line-offset"]),"line-blur":new _e(xt.paint_line["line-blur"]),"line-dasharray":new _e(xt.paint_line["line-dasharray"]),"line-pattern":new _e(xt.paint_line["line-pattern"]),"line-gradient":new Ie(xt.paint_line["line-gradient"]),"line-trim-offset":new le(xt.paint_line["line-trim-offset"])}),layout:W_};const Ug=new class extends _e{possiblyEvaluate(n,e){return e=new z(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,i,s){return e=_t({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,i,s)}}(zg.paint.properties["line-width"].specification);function Z_(n,e){return e>0?e+2*n:n}Ug.useIntegerZoom=!0;const Py=st([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Kf=st([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),q_=st([{name:"a_projected_pos",components:4,type:"Float32"}],4);st([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const hm=st([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),fm=st([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);st([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const sd=st([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),pm=st([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);st([{name:"triangle",components:3,type:"Uint16"}]),st([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),st([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),st([{type:"Float32",name:"offsetX"}]),st([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Es=24;const Na=128;function Zd(n,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new z(n+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:u}=i;let p=0;for(;p<s.length&&s[p]<=n;)p++;p=Math.max(0,p-1);let y=p;for(;y<s.length&&s[y]<n+1;)y++;y=Math.min(s.length-1,y);const x=s[p],D=s[y];return"composite"===i.kind?{kind:"composite",minZoom:x,maxZoom:D,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:D,minSize:i.evaluate(new z(x)),maxSize:i.evaluate(new z(D)),interpolationType:u}}}function Kc(n,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:u}){return"source"===n.kind?s/Na:"composite"===n.kind?Ki(s/Na,u/Na,i):e}function Tu(n,e){let i=0,s=0;if("constant"===n.kind)s=n.layoutSize;else if("source"!==n.kind){const{interpolationType:u,minZoom:p,maxZoom:y}=n,x=u?hi(Nr.interpolationFactor(u,e,p,y),0,1):0;"camera"===n.kind?s=Ki(n.minSize,n.maxSize,x):i=x}return{uSizeT:i,uSize:s}}var mm=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Na,evaluateSizeForFeature:Kc,evaluateSizeForZoom:Tu,getSizeData:Zd});function Yf(n,e,i){return n.sections.forEach(s=>{s.text=function(u,p,y){const x=p.layout.get("text-transform").evaluate(y,{});return"uppercase"===x?u=u.toLocaleUpperCase():"lowercase"===x&&(u=u.toLocaleLowerCase()),R.applyArabicShaping&&(u=R.applyArabicShaping(u)),u}(s.text,e,i)}),n}const Xf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function gm(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function Gh(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var Vg=io,_m=function(n,e,i,s,u){var p,y,x=8*u-s-1,D=(1<<x)-1,M=D>>1,F=-7,U=i?u-1:0,H=i?-1:1,G=n[e+U];for(U+=H,p=G&(1<<-F)-1,G>>=-F,F+=x;F>0;p=256*p+n[e+U],U+=H,F-=8);for(y=p&(1<<-F)-1,p>>=-F,F+=s;F>0;y=256*y+n[e+U],U+=H,F-=8);if(0===p)p=1-M;else{if(p===D)return y?NaN:1/0*(G?-1:1);y+=Math.pow(2,s),p-=M}return(G?-1:1)*y*Math.pow(2,p-s)},jg=function(n,e,i,s,u,p){var y,x,D,M=8*p-u-1,F=(1<<M)-1,U=F>>1,H=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,G=s?0:p-1,Y=s?1:-1,oe=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,y=F):(y=Math.floor(Math.log(e)/Math.LN2),e*(D=Math.pow(2,-y))<1&&(y--,D*=2),(e+=y+U>=1?H/D:H*Math.pow(2,1-U))*D>=2&&(y++,D/=2),y+U>=F?(x=0,y=F):y+U>=1?(x=(e*D-1)*Math.pow(2,u),y+=U):(x=e*Math.pow(2,U-1)*Math.pow(2,u),y=0));u>=8;n[i+G]=255&x,G+=Y,x/=256,u-=8);for(y=y<<u|x,M+=u;M>0;n[i+G]=255&y,G+=Y,y/=256,M-=8);n[i+G-Y]|=128*oe};function io(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}io.Varint=0,io.Fixed64=1,io.Bytes=2,io.Fixed32=5;var Wh=4294967296,ym=1/Wh,$g=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Yc(n){return n.type===io.Bytes?n.readVarint()+n.pos:n.pos+1}function vm(n,e,i){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(var u=i.pos-1;u>=n;u--)i.buf[u+s]=i.buf[u]}function Jf(n,e){for(var i=0;i<n.length;i++)e.writeVarint(n[i])}function bm(n,e){for(var i=0;i<n.length;i++)e.writeSVarint(n[i])}function K_(n,e){for(var i=0;i<n.length;i++)e.writeFloat(n[i])}function Hg(n,e){for(var i=0;i<n.length;i++)e.writeDouble(n[i])}function xm(n,e){for(var i=0;i<n.length;i++)e.writeBoolean(n[i])}function Qf(n,e){for(var i=0;i<n.length;i++)e.writeFixed32(n[i])}function Y_(n,e){for(var i=0;i<n.length;i++)e.writeSFixed32(n[i])}function Gg(n,e){for(var i=0;i<n.length;i++)e.writeFixed64(n[i])}function Wg(n,e){for(var i=0;i<n.length;i++)e.writeSFixed64(n[i])}function qd(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function Kd(n,e,i){n[i]=e,n[i+1]=e>>>8,n[i+2]=e>>>16,n[i+3]=e>>>24}function wm(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}io.prototype={destroy:function(){this.buf=null},readFields:function(n,e,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),u=s>>3,p=this.pos;this.type=7&s,n(u,e,this),this.pos===p&&this.skip(s)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=qd(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=wm(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=qd(this.buf,this.pos)+qd(this.buf,this.pos+4)*Wh;return this.pos+=8,n},readSFixed64:function(){var n=qd(this.buf,this.pos)+wm(this.buf,this.pos+4)*Wh;return this.pos+=8,n},readFloat:function(){var n=_m(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=_m(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,i,s=this.buf;return e=127&(i=s[this.pos++]),i<128?e:(e|=(127&(i=s[this.pos++]))<<7,i<128?e:(e|=(127&(i=s[this.pos++]))<<14,i<128?e:(e|=(127&(i=s[this.pos++]))<<21,i<128?e:function(u,p,y){var x,D,M=y.buf;if(x=(112&(D=M[y.pos++]))>>4,D<128||(x|=(127&(D=M[y.pos++]))<<3,D<128)||(x|=(127&(D=M[y.pos++]))<<10,D<128)||(x|=(127&(D=M[y.pos++]))<<17,D<128)||(x|=(127&(D=M[y.pos++]))<<24,D<128)||(x|=(1&(D=M[y.pos++]))<<31,D<128))return function Zh(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}(u,x,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=s[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&$g?$g.decode(this.buf.subarray(e,n)):function(i,s,u){for(var p="",y=s;y<u;){var x,D,M,F=i[y],U=null,H=F>239?4:F>223?3:F>191?2:1;if(y+H>u)break;1===H?F<128&&(U=F):2===H?128==(192&(x=i[y+1]))&&(U=(31&F)<<6|63&x)<=127&&(U=null):3===H?(D=i[y+2],128==(192&(x=i[y+1]))&&128==(192&D)&&((U=(15&F)<<12|(63&x)<<6|63&D)<=2047||U>=55296&&U<=57343)&&(U=null)):4===H&&(D=i[y+2],M=i[y+3],128==(192&(x=i[y+1]))&&128==(192&D)&&128==(192&M)&&((U=(15&F)<<18|(63&x)<<12|(63&D)<<6|63&M)<=65535||U>=1114112)&&(U=null)),null===U?(U=65533,H=1):U>65535&&(U-=65536,p+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),p+=String.fromCharCode(U),y+=H}return p}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==io.Bytes)return n.push(this.readVarint(e));var i=Yc(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==io.Bytes)return n.push(this.readSVarint());var e=Yc(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==io.Bytes)return n.push(this.readBoolean());var e=Yc(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==io.Bytes)return n.push(this.readFloat());var e=Yc(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==io.Bytes)return n.push(this.readDouble());var e=Yc(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==io.Bytes)return n.push(this.readFixed32());var e=Yc(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==io.Bytes)return n.push(this.readSFixed32());var e=Yc(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==io.Bytes)return n.push(this.readFixed64());var e=Yc(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==io.Bytes)return n.push(this.readSFixed64());var e=Yc(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===io.Varint)for(;this.buf[this.pos++]>127;);else if(e===io.Bytes)this.pos=this.readVarint()+this.pos;else if(e===io.Fixed32)this.pos+=4;else{if(e!==io.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Kd(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Kd(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Kd(this.buf,-1&n,this.pos),Kd(this.buf,Math.floor(n*ym),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Kd(this.buf,-1&n,this.pos),Kd(this.buf,Math.floor(n*ym),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,i){var s,u,p,x;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),p=s,(x=i).buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7),function(p,y){var x=(7&p)<<4;y.buf[y.pos++]|=x|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))}(u,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(s,u,p){for(var y,x,D=0;D<u.length;D++){if((y=u.charCodeAt(D))>55295&&y<57344){if(!x){y>56319||D+1===u.length?(s[p++]=239,s[p++]=191,s[p++]=189):x=y;continue}if(y<56320){s[p++]=239,s[p++]=191,s[p++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(s[p++]=239,s[p++]=191,s[p++]=189,x=null);y<128?s[p++]=y:(y<2048?s[p++]=y>>6|192:(y<65536?s[p++]=y>>12|224:(s[p++]=y>>18|240,s[p++]=y>>12&63|128),s[p++]=y>>6&63|128),s[p++]=63&y|128)}return p}(this.buf,n,this.pos);var i=this.pos-e;i>=128&&vm(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),jg(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),jg(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,e){this.pos++;var i=this.pos;n(e,this);var s=this.pos-i;s>=128&&vm(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(n,e,i){this.writeTag(n,io.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,Jf,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,bm,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,xm,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,K_,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,Hg,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,Qf,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,Y_,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,Gg,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,Wg,e)},writeBytesField:function(n,e){this.writeTag(n,io.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,io.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,io.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,io.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,io.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,io.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,io.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,io.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,io.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,io.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};var Xc=St(Vg);const ep=3;function Jc(n,e,i){e.glyphs=[],1===n&&i.readMessage(ad,e)}function ad(n,e,i){if(3===n){const{id:s,bitmap:u,width:p,height:y,left:x,top:D,advance:M}=i.readMessage(Zg,{});e.glyphs.push({id:s,bitmap:new Vl({width:p+2*ep,height:y+2*ep},u),metrics:{width:p,height:y,left:x,top:D,advance:M}})}else 4===n?e.ascender=i.readSVarint():5===n&&(e.descender=i.readSVarint())}function Zg(n,e,i){1===n?e.id=i.readVarint():2===n?e.bitmap=i.readBytes():3===n?e.width=i.readVarint():4===n?e.height=i.readVarint():5===n?e.left=i.readSVarint():6===n?e.top=i.readSVarint():7===n&&(e.advance=i.readVarint())}const tp=ep;function np(n){let e=0,i=0;for(const y of n)e+=y.w*y.h,i=Math.max(i,y.w);n.sort((y,x)=>x.h-y.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,p=0;for(const y of n)for(let x=s.length-1;x>=0;x--){const D=s[x];if(!(y.w>D.w||y.h>D.h)){if(y.x=D.x,y.y=D.y,p=Math.max(p,y.y+y.h),u=Math.max(u,y.x+y.w),y.w===D.w&&y.h===D.h){const M=s.pop();x<s.length&&(s[x]=M)}else y.h===D.h?(D.x+=y.w,D.w-=y.w):y.w===D.w?(D.y+=y.h,D.h-=y.h):(s.push({x:D.x+y.w,y:D.y,w:D.w-y.w,h:y.h}),D.y+=y.h,D.h-=y.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}const la=1;class Yd{constructor(e,{pixelRatio:i,version:s,stretchX:u,stretchY:p,content:y}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=p,this.content=y,this.version=s}get tl(){return[this.paddedRect.x+la,this.paddedRect.y+la]}get br(){return[this.paddedRect.x+this.paddedRect.w-la,this.paddedRect.y+this.paddedRect.h-la]}get displaySize(){return[(this.paddedRect.w-2*la)/this.pixelRatio,(this.paddedRect.h-2*la)/this.pixelRatio]}}class Mu{constructor(e,i){const s={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,s,p),this.addImages(i,u,p);const{w:y,h:x}=np(p),D=new wa({width:y||1,height:x||1});for(const M in e){const F=e[M],U=s[M].paddedRect;wa.copy(F.data,D,{x:0,y:0},{x:U.x+la,y:U.y+la},F.data)}for(const M in i){const F=i[M],U=u[M].paddedRect,H=U.x+la,G=U.y+la,Y=F.data.width,oe=F.data.height;wa.copy(F.data,D,{x:0,y:0},{x:H,y:G},F.data),wa.copy(F.data,D,{x:0,y:oe-1},{x:H,y:G-1},{width:Y,height:1}),wa.copy(F.data,D,{x:0,y:0},{x:H,y:G+oe},{width:Y,height:1}),wa.copy(F.data,D,{x:Y-1,y:0},{x:H-1,y:G},{width:1,height:oe}),wa.copy(F.data,D,{x:0,y:0},{x:H+Y,y:G},{width:1,height:oe})}this.image=D,this.iconPositions=s,this.patternPositions=u}addImages(e,i,s){for(const u in e){const p=e[u],y={x:0,y:0,w:p.data.width+2*la,h:p.data.height+2*la};s.push(y),i[u]=new Yd(y,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),i),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),i)}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,p]=e.tl;s.update(i.data,void 0,{x:u,y:p})}}Wn(Yd,"ImagePosition"),Wn(Mu,"ImageAtlas");const Xa={horizontal:1,vertical:2,horizontalOnly:3},Xd=-17;class qh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const s=new qh;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new qh;return i.imageName=e,i}}class xc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const s=new xc;for(let u=0;u<e.sections.length;u++){const p=e.sections[u];p.image?s.addImageSection(p):s.addTextSection(p,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,s){let u="";for(let p=0;p<i.length;p++){const y=i.charCodeAt(p+1)||null,x=i.charCodeAt(p-1)||null;u+=!s&&(y&&Mn(y)&&!Xf[i[p+1]]||x&&Mn(x)&&!Xf[i[p-1]])||!Xf[i[p]]?i[p]:Xf[i[p]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Kh[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Kh[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new xc;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(qh.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){const i=e.image?e.image.name:"";if(0===i.length)return void fi("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(qh.forImage(i)),this.sectionIndex.push(this.sections.length-1)):fi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ip(n,e,i,s,u,p,y,x,D,M,F,U,H,G,Y){const oe=xc.fromFeature(n,u);U===Xa.vertical&&oe.verticalizePunctuation(H);let de=[];const Ee=function(We,At,yt,Wt,sn,Lt){if(!We)return[];const nn=[],rn=function(On,Zn,jn,Di,In,li){let Fi=0;for(let vr=0;vr<On.length();vr++){const Ni=On.getSection(vr);Fi+=ld(On.getCharCode(vr),Ni,Di,In,Zn,li)}return Fi/Math.max(1,Math.ceil(Fi/jn))}(We,At,yt,Wt,sn,Lt),gn=We.text.indexOf("\u200b")>=0;let xn=0;for(let On=0;On<We.length();On++){const Zn=We.getSection(On),jn=We.getCharCode(On);if(Kh[jn]||(xn+=ld(jn,Zn,Wt,sn,At,Lt)),On<We.length()-1){const Di=!((Ht=jn)<11904||!(O["Bopomofo Extended"](Ht)||O.Bopomofo(Ht)||O["CJK Compatibility Forms"](Ht)||O["CJK Compatibility Ideographs"](Ht)||O["CJK Compatibility"](Ht)||O["CJK Radicals Supplement"](Ht)||O["CJK Strokes"](Ht)||O["CJK Symbols and Punctuation"](Ht)||O["CJK Unified Ideographs Extension A"](Ht)||O["CJK Unified Ideographs"](Ht)||O["Enclosed CJK Letters and Months"](Ht)||O["Halfwidth and Fullwidth Forms"](Ht)||O.Hiragana(Ht)||O["Ideographic Description Characters"](Ht)||O["Kangxi Radicals"](Ht)||O["Katakana Phonetic Extensions"](Ht)||O.Katakana(Ht)||O["Vertical Forms"](Ht)||O["Yi Radicals"](Ht)||O["Yi Syllables"](Ht)));(rp[jn]||Di||Zn.imageName)&&nn.push(qg(On+1,xn,rn,nn,Em(jn,We.getCharCode(On+1),Di&&gn),!1))}}var Ht;return Cm(qg(We.length(),xn,rn,nn,0,!0))}(oe,M,p,e,s,G),{processBidirectionalText:Ne,processStyledBidirectionalText:Ce}=R;if(Ne&&1===oe.sections.length){const We=Ne(oe.toString(),Ee);for(const At of We){const yt=new xc;yt.text=At,yt.sections=oe.sections;for(let Wt=0;Wt<At.length;Wt++)yt.sectionIndex.push(0);de.push(yt)}}else if(Ce){const We=Ce(oe.text,oe.sectionIndex,Ee);for(const At of We){const yt=new xc;yt.text=At[0],yt.sectionIndex=At[1],yt.sections=oe.sections,de.push(yt)}}else de=function(We,At){const yt=[],Wt=We.text;let sn=0;for(const Lt of At)yt.push(We.substring(sn,Lt)),sn=Lt;return sn<Wt.length&&yt.push(We.substring(sn,Wt.length)),yt}(oe,Ee);const Fe=[],ze={positionedLines:Fe,text:oe.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:U,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(We,At,yt,Wt,sn,Lt,nn,rn,gn,xn,Ht,On){let Zn=0,jn=0,Di=0;const In="right"===rn?1:"left"===rn?0:.5;let li=!1;for(const Ui of sn){const Vi=Ui.getSections();for(const Br of Vi){if(Br.imageName)continue;const uo=At[Br.fontStack];if(uo&&(li=void 0!==uo.ascender&&void 0!==uo.descender,!li))break}if(!li)break}let Fi=0;for(const Ui of sn){Ui.trim();const Vi=Ui.getMaxScale(),Br=(Vi-1)*Es,uo={positionedGlyphs:[],lineOffset:0};We.positionedLines[Fi]=uo;const ho=uo.positionedGlyphs;let ro=0;if(!Ui.length()){jn+=Lt,++Fi;continue}let Fo=0,Zo=0;for(let oo=0;oo<Ui.length();oo++){const ps=Ui.getSection(oo),as=Ui.getSectionIndex(oo),No=Ui.getCharCode(oo);let zr=ps.scale,Cs=null,Co=null,Ba=null,ms=Es,ua=0;const Hs=!(gn===Xa.horizontal||!Ht&&!Et(No)||Ht&&(Kh[No]||(vr=No,O.Arabic(vr)||O["Arabic Supplement"](vr)||O["Arabic Extended-A"](vr)||O["Arabic Presentation Forms-A"](vr)||O["Arabic Presentation Forms-B"](vr))));if(ps.imageName){const Qa=Wt[ps.imageName];if(!Qa)continue;Ba=ps.imageName,We.iconsInText=We.iconsInText||!0,Co=Qa.paddedRect;const Gs=Qa.displaySize;zr=zr*Es/On,Cs={width:Gs[0],height:Gs[1],left:la,top:-tp,advance:Hs?Gs[1]:Gs[0],localGlyph:!1},ua=li?-Cs.height*zr:Xd+Vi*Es-Gs[1]*zr,ms=Cs.advance;const Cc=(Hs?Gs[0]:Gs[1])*zr-Es*Vi;Cc>0&&Cc>ro&&(ro=Cc)}else{const Qa=yt[ps.fontStack];if(!Qa)continue;Qa[No]&&(Co=Qa[No]);const Gs=At[ps.fontStack];if(!Gs)continue;const Cc=Gs.glyphs[No];if(!Cc)continue;if(Cs=Cc.metrics,ms=8203!==No?Es:0,li){const hf=void 0!==Gs.ascender?Math.abs(Gs.ascender):0,lh=void 0!==Gs.descender?Math.abs(Gs.descender):0,Lu=(hf+lh)*zr;Fo<Lu&&(Fo=Lu,Zo=(hf-lh)/2*zr),ua=-hf*zr}else ua=Xd+(Vi-zr)*Es}Hs?(We.verticalizable=!0,ho.push({glyph:No,imageName:Ba,x:Zn,y:jn+ua,vertical:Hs,scale:zr,localGlyph:Cs.localGlyph,fontStack:ps.fontStack,sectionIndex:as,metrics:Cs,rect:Co}),Zn+=ms*zr+xn):(ho.push({glyph:No,imageName:Ba,x:Zn,y:jn+ua,vertical:Hs,scale:zr,localGlyph:Cs.localGlyph,fontStack:ps.fontStack,sectionIndex:as,metrics:Cs,rect:Co}),Zn+=Cs.advance*zr+xn)}0!==ho.length&&(Di=Math.max(Zn-xn,Di),li?cd(ho,In,ro,Zo,Lt*Vi/2):cd(ho,In,ro,0,Lt/2)),Zn=0;const ss=Lt*Vi+ro;uo.lineOffset=Math.max(ro,Br),jn+=ss,++Fi}var vr;const Ni=jn,{horizontalAlign:yi,verticalAlign:Kr}=Dm(nn);(function(Ui,Vi,Br,uo,ho,ro){const Fo=(Vi-Br)*ho,Zo=-ro*uo;for(const ss of Ui)for(const oo of ss.positionedGlyphs)oo.x+=Fo,oo.y+=Zo})(We.positionedLines,In,yi,Kr,Di,Ni),We.top+=-Kr*Ni,We.bottom=We.top+Ni,We.left+=-yi*Di,We.right=We.left+Di,We.hasBaseline=li}(ze,e,i,s,de,y,x,D,U,M,H,Y),!function(We){for(const At of We)if(0!==At.positionedGlyphs.length)return!1;return!0}(Fe)&&ze}const Kh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ld(n,e,i,s,u,p){if(e.imageName){const y=s[e.imageName];return y?y.displaySize[0]*e.scale*Es/p+u:0}{const y=i[e.fontStack],x=y&&y.glyphs[n];return x?x.metrics.advance*e.scale+u:0}}function op(n,e,i,s){const u=Math.pow(n-e,2);return s?n<e?u/2:2*u:u+Math.abs(i)*i}function Em(n,e,i){let s=0;return 10===n&&(s-=1e4),i&&(s+=150),40!==n&&65288!==n||(s+=50),41!==e&&65289!==e||(s+=50),s}function qg(n,e,i,s,u,p){let y=null,x=op(e,i,u,p);for(const D of s){const M=op(e-D.x,i,u,p)+D.badness;M<=x&&(y=D,x=M)}return{index:n,x:e,priorBreak:y,badness:x}}function Cm(n){return n?Cm(n.priorBreak).concat(n.index):[]}function Dm(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function cd(n,e,i,s,u){if(!(e||i||s||u))return;const p=n.length-1,y=n[p],x=(y.x+y.metrics.advance*y.scale)*e;for(let D=0;D<=p;D++)n[D].x-=x,n[D].y+=i+s+u}function Tm(n,e,i){const{horizontalAlign:s,verticalAlign:u}=Dm(i),p=e[0]-n.displaySize[0]*s,y=e[1]-n.displaySize[1]*u;return{image:n,top:y,bottom:y+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function cl(n,e,i,s,u,p){const y=n.image;let x;if(y.content){const de=y.content,Ee=y.pixelRatio||1;x=[de[0]/Ee,de[1]/Ee,y.displaySize[0]-de[2]/Ee,y.displaySize[1]-de[3]/Ee]}const D=e.left*p,M=e.right*p;let F,U,H,G;"width"===i||"both"===i?(G=u[0]+D-s[3],U=u[0]+M+s[1]):(G=u[0]+(D+M-y.displaySize[0])/2,U=G+y.displaySize[0]);const Y=e.top*p,oe=e.bottom*p;return"height"===i||"both"===i?(F=u[1]+Y-s[0],H=u[1]+oe+s[2]):(F=u[1]+(Y+oe-y.displaySize[1])/2,H=F+y.displaySize[1]),{image:y,top:F,right:U,bottom:H,left:G,collisionPadding:x}}class Ja extends Ze{constructor(e,i,s,u,p){super(e,i),this.angle=u,this.z=s,void 0!==p&&(this.segment=p)}clone(){return new Ja(this.x,this.y,this.z,this.angle,this.segment)}}function Kg(n,e,i,s,u){if(void 0===e.segment)return!0;let p=e,y=e.segment+1,x=0;for(;x>-i/2;){if(y--,y<0)return!1;x-=n[y].dist(p),p=n[y]}x+=n[y].dist(n[y+1]),y++;const D=[];let M=0;for(;x<i/2;){const F=n[y],U=n[y+1];if(!U)return!1;let H=n[y-1].angleTo(F)-F.angleTo(U);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:x,angleDelta:H}),M+=H;x-D[0].distance>s;)M-=D.shift().angleDelta;if(M>u)return!1;y++,x+=F.dist(U)}return!0}function sp(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function Mm(n,e,i){return n?.6*e*i:0}function Yh(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Hl(n,e,i,s,u,p){const y=Mm(i,u,p),x=Yh(i,s)*p;let D=0;const M=sp(n)/2;for(let F=0;F<n.length-1;F++){const U=n[F],H=n[F+1],G=U.dist(H);if(D+G>M){const Y=(M-D)/G,oe=Ki(U.x,H.x,Y),de=Ki(U.y,H.y,Y),Ee=new Ja(oe,de,0,H.angleTo(U),F);return!y||Kg(n,Ee,x,y,e)?Ee:void 0}D+=G}}function Sm(n,e,i,s,u,p,y,x,D){const M=Mm(s,p,y),F=Yh(s,u),U=F*y,H=0===n[0].x||n[0].x===D||0===n[0].y||n[0].y===D;return e-U<e/4&&(e=U+e/4),ap(n,H?e/2*x%e:(F/2+2*p)*y*x%e,e,M,i,U,H,!1,D)}function ap(n,e,i,s,u,p,y,x,D){const M=p/2,F=sp(n);let U=0,H=e-i,G=[];for(let Y=0;Y<n.length-1;Y++){const oe=n[Y],de=n[Y+1],Ee=oe.dist(de),Ne=de.angleTo(oe);for(;H+i<U+Ee;){H+=i;const Ce=(H-U)/Ee,Fe=Ki(oe.x,de.x,Ce),ze=Ki(oe.y,de.y,Ce);if(Fe>=0&&Fe<D&&ze>=0&&ze<D&&H-M>=0&&H+M<=F){const We=new Ja(Fe,ze,0,Ne,Y);We._round(),s&&!Kg(n,We,p,s,u)||G.push(We)}}U+=Ee}return x||G.length||y||(G=ap(n,U/2,i,s,u,p,y,!0,D)),G}function X_(n,e,i,s,u){const p=[];for(let y=0;y<n.length;y++){const x=n[y];let D;for(let M=0;M<x.length-1;M++){let F=x[M],U=x[M+1];F.x<e&&U.x<e||(F.x<e?F=new Ze(e,F.y+(e-F.x)/(U.x-F.x)*(U.y-F.y))._round():U.x<e&&(U=new Ze(e,F.y+(e-F.x)/(U.x-F.x)*(U.y-F.y))._round()),F.y<i&&U.y<i||(F.y<i?F=new Ze(F.x+(i-F.y)/(U.y-F.y)*(U.x-F.x),i)._round():U.y<i&&(U=new Ze(F.x+(i-F.y)/(U.y-F.y)*(U.x-F.x),i)._round()),F.x>=s&&U.x>=s||(F.x>=s?F=new Ze(s,F.y+(s-F.x)/(U.x-F.x)*(U.y-F.y))._round():U.x>=s&&(U=new Ze(s,F.y+(s-F.x)/(U.x-F.x)*(U.y-F.y))._round()),F.y>=u&&U.y>=u||(F.y>=u?F=new Ze(F.x+(u-F.y)/(U.y-F.y)*(U.x-F.x),u)._round():U.y>=u&&(U=new Ze(F.x+(u-F.y)/(U.y-F.y)*(U.x-F.x),u)._round()),D&&F.equals(D[D.length-1])||(D=[F],p.push(D)),D.push(U)))))}}return p}Wn(Ja,"Anchor");const fs=1e20;function Yg(n,e,i,s,u,p,y,x,D){for(let M=e;M<e+s;M++)lp(n,i*p+M,p,u,y,x,D);for(let M=i;M<i+u;M++)lp(n,M*p+e,1,s,y,x,D)}function lp(n,e,i,s,u,p,y){p[0]=0,y[0]=-fs,y[1]=fs,u[0]=n[e];for(let x=1,D=0,M=0;x<s;x++){u[x]=n[e+x*i];const F=x*x;do{const U=p[D];M=(u[x]-u[U]+F-U*U)/(x-U)/2}while(M<=y[D]&&--D>-1);D++,p[D]=x,y[D]=M,y[D+1]=fs}for(let x=0,D=0;x<s;x++){for(;y[D+1]<x;)D++;const M=p[D],F=x-M;n[e+x*i]=u[M]+F*F}}const Gl=2,Im={none:0,ideographs:1,all:2};class Qc{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const s=[];for(const u in e)for(const p of e[u])s.push({stack:u,id:p});ji(s,({stack:u,id:p},y)=>{let x=this.entries[u];x||(x=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=x.glyphs[p];if(void 0!==D)return void y(null,{stack:u,id:p,glyph:D});if(D=this._tinySDF(x,u,p),D)return x.glyphs[p]=D,void y(null,{stack:u,id:p,glyph:D});const M=Math.floor(p/256);if(256*M>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[M])return void y(null,{stack:u,id:p,glyph:D});let F=x.requests[M];F||(F=x.requests[M]=[],Qc.loadGlyphRange(u,M,this.url,this.requestManager,(U,H)=>{if(H){x.ascender=H.ascender,x.descender=H.descender;for(const G in H.glyphs)this._doesCharSupportLocalGlyph(+G)||(x.glyphs[+G]=H.glyphs[+G]);x.ranges[M]=!0}for(const G of F)G(U,H);delete x.requests[M]})),F.push((U,H)=>{U?y(U):H&&y(null,{stack:u,id:p,glyph:H.glyphs[p]||null})})},(u,p)=>{if(u)i(u);else if(p){const y={};for(const{stack:x,id:D,glyph:M}of p)void 0===y[x]&&(y[x]={}),void 0===y[x].glyphs&&(y[x].glyphs={}),y[x].glyphs[D]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;i(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Im.none&&(this.localGlyphMode===Im.all?!!this.localFontFamily:!!this.localFontFamily&&(O["CJK Unified Ideographs"](e)||O["Hangul Syllables"](e)||O.Hiragana(e)||O.Katakana(e)||O["CJK Symbols and Punctuation"](e)))}_tinySDF(e,i,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let p=e.tinySDF;if(!p){let oe="400";/bold/i.test(i)?oe="900":/medium/i.test(i)?oe="500":/light/i.test(i)&&(oe="200"),p=e.tinySDF=new Qc.TinySDF({fontFamily:u,fontWeight:oe,fontSize:24*Gl,buffer:3*Gl,radius:8*Gl}),p.fontWeight=oe}if(this.localGlyphs[p.fontWeight][s])return this.localGlyphs[p.fontWeight][s];const y=String.fromCharCode(s),{data:x,width:D,height:M,glyphWidth:F,glyphHeight:U,glyphLeft:H,glyphTop:G,glyphAdvance:Y}=p.draw(y);return this.localGlyphs[p.fontWeight][s]={id:s,bitmap:new Vl({width:D,height:M},x),metrics:{width:F/Gl,height:U/Gl,left:H/Gl,top:G/Gl-27,advance:Y/Gl,localGlyph:!0}}}}Qc.loadGlyphRange=function(n,e,i,s,u){const p=256*e,y=p+255,x=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${p}-${y}`),Si.Glyphs);Hi(x,(D,M)=>{if(D)u(D);else if(M){const F={},U=new Xc(M).readFields(Jc,{});for(const H of U.glyphs)F[H.id]=H;u(null,{glyphs:F,ascender:U.ascender,descender:U.descender})}})},Qc.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=i;const x=this.size=n+4*e,D=this._createCanvas(x),M=this.ctx=D.getContext("2d",{willReadFrequently:!0});M.font=`${y} ${p} ${n}px ${u}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(n),y=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),D=Math.min(this.size-this.buffer,y+Math.ceil(s)),M=x+2*this.buffer,F=D+2*this.buffer,U=Math.max(M*F,0),H=new Uint8ClampedArray(U),G={data:H,width:M,height:F,glyphWidth:x,glyphHeight:D,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(0===x||0===D)return G;const{ctx:Y,buffer:oe,gridInner:de,gridOuter:Ee}=this;Y.clearRect(oe,oe,x,D),Y.fillText(n,oe,oe+y);const Ne=Y.getImageData(oe,oe,x,D);Ee.fill(fs,0,U),de.fill(0,0,U);for(let Ce=0;Ce<D;Ce++)for(let Fe=0;Fe<x;Fe++){const ze=Ne.data[4*(Ce*x+Fe)+3]/255;if(0===ze)continue;const We=(Ce+oe)*M+Fe+oe;if(1===ze)Ee[We]=0,de[We]=fs;else{const At=.5-ze;Ee[We]=At>0?At*At:0,de[We]=At<0?At*At:0}}Yg(Ee,0,0,M,F,M,this.f,this.v,this.z),Yg(de,oe,oe,x,D,M,this.f,this.v,this.z);for(let Ce=0;Ce<U;Ce++){const Fe=Math.sqrt(Ee[Ce])-Math.sqrt(de[Ce]);H[Ce]=Math.round(255-255*(Fe/this.radius+this.cutoff))}return G}};const Su=la;function Am(n,e,i,s){const u=[],p=n.image,y=p.pixelRatio,x=p.paddedRect.w-2*Su,D=p.paddedRect.h-2*Su,M=n.right-n.left,F=n.bottom-n.top,U=p.stretchX||[[0,x]],H=p.stretchY||[[0,D]],G=(Lt,nn)=>Lt+nn[1]-nn[0],Y=U.reduce(G,0),oe=H.reduce(G,0),de=x-Y,Ee=D-oe;let Ne=0,Ce=Y,Fe=0,ze=oe,We=0,At=de,yt=0,Wt=Ee;if(p.content&&s){const Lt=p.content;Ne=Xh(U,0,Lt[0]),Fe=Xh(H,0,Lt[1]),Ce=Xh(U,Lt[0],Lt[2]),ze=Xh(H,Lt[1],Lt[3]),We=Lt[0]-Ne,yt=Lt[1]-Fe,At=Lt[2]-Lt[0]-Ce,Wt=Lt[3]-Lt[1]-ze}const sn=(Lt,nn,rn,gn)=>{const xn=Qh(Lt.stretch-Ne,Ce,M,n.left),Ht=ef(Lt.fixed-We,At,Lt.stretch,Y),On=Qh(nn.stretch-Fe,ze,F,n.top),Zn=ef(nn.fixed-yt,Wt,nn.stretch,oe),jn=Qh(rn.stretch-Ne,Ce,M,n.left),Di=ef(rn.fixed-We,At,rn.stretch,Y),In=Qh(gn.stretch-Fe,ze,F,n.top),li=ef(gn.fixed-yt,Wt,gn.stretch,oe),Fi=new Ze(xn,On),vr=new Ze(jn,On),Ni=new Ze(jn,In),yi=new Ze(xn,In),Kr=new Ze(Ht/y,Zn/y),Ui=new Ze(Di/y,li/y),Vi=e*Math.PI/180;if(Vi){const ho=Math.sin(Vi),ro=Math.cos(Vi),Fo=[ro,-ho,ho,ro];Fi._matMult(Fo),vr._matMult(Fo),yi._matMult(Fo),Ni._matMult(Fo)}const Br=Lt.stretch+Lt.fixed,uo=nn.stretch+nn.fixed;return{tl:Fi,tr:vr,bl:yi,br:Ni,tex:{x:p.paddedRect.x+Su+Br,y:p.paddedRect.y+Su+uo,w:rn.stretch+rn.fixed-Br,h:gn.stretch+gn.fixed-uo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Kr,pixelOffsetBR:Ui,minFontScaleX:At/y/M,minFontScaleY:Wt/y/F,isSDF:i}};if(s&&(p.stretchX||p.stretchY)){const Lt=Jh(U,de,Y),nn=Jh(H,Ee,oe);for(let rn=0;rn<Lt.length-1;rn++){const gn=Lt[rn],xn=Lt[rn+1];for(let Ht=0;Ht<nn.length-1;Ht++)u.push(sn(gn,nn[Ht],xn,nn[Ht+1]))}}else u.push(sn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:D+1}));return u}function Xh(n,e,i){let s=0;for(const u of n)s+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return s}function Jh(n,e,i){const s=[{fixed:-Su,stretch:0}];for(const[u,p]of n){const y=s[s.length-1];s.push({fixed:u-y.stretch,stretch:y.stretch}),s.push({fixed:u-y.stretch,stretch:y.stretch+(p-u)})}return s.push({fixed:e+Su,stretch:i}),s}function Qh(n,e,i,s){return n/e*i+s}function ef(n,e,i,s){return n-e*i/s}function J_(n,e,i,s){const u=e+n.positionedLines[s].lineOffset;return 0===s?i+u/2:i+(u+(e+n.positionedLines[s-1].lineOffset))/2}class Xg{constructor(e=[],i=Jd){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,u=i[e];for(;e>0;){const p=e-1>>1,y=i[p];if(s(u,y)>=0)break;i[e]=y,e=p}i[e]=u}_down(e){const{data:i,compare:s}=this,u=this.length>>1,p=i[e];for(;e<u;){let y=1+(e<<1),x=i[y];const D=y+1;if(D<this.length&&s(i[D],x)<0&&(y=D,x=i[D]),s(x,p)>=0)break;i[e]=x,e=y}i[e]=p}}function Jd(n,e){return n<e?-1:n>e?1:0}function eu(n,e=1,i=!1){let s=1/0,u=1/0,p=-1/0,y=-1/0;const x=n[0];for(let G=0;G<x.length;G++){const Y=x[G];(!G||Y.x<s)&&(s=Y.x),(!G||Y.y<u)&&(u=Y.y),(!G||Y.x>p)&&(p=Y.x),(!G||Y.y>y)&&(y=Y.y)}const D=Math.min(p-s,y-u);let M=D/2;const F=new Xg([],Qd);if(0===D)return new Ze(s,u);for(let G=s;G<p;G+=D)for(let Y=u;Y<y;Y+=D)F.push(new eh(G+M,Y+M,M,n));let U=function(G){let Y=0,oe=0,de=0;const Ee=G[0];for(let Ne=0,Ce=Ee.length,Fe=Ce-1;Ne<Ce;Fe=Ne++){const ze=Ee[Ne],We=Ee[Fe],At=ze.x*We.y-We.x*ze.y;oe+=(ze.x+We.x)*At,de+=(ze.y+We.y)*At,Y+=3*At}return new eh(oe/Y,de/Y,0,G)}(n),H=F.length;for(;F.length;){const G=F.pop();(G.d>U.d||!U.d)&&(U=G,i&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,H)),G.max-U.d<=e||(M=G.h/2,F.push(new eh(G.p.x-M,G.p.y-M,M,n)),F.push(new eh(G.p.x+M,G.p.y-M,M,n)),F.push(new eh(G.p.x-M,G.p.y+M,M,n)),F.push(new eh(G.p.x+M,G.p.y+M,M,n)),H+=4)}return i&&(console.log(`num probes: ${H}`),console.log(`best distance: ${U.d}`)),U.p}function Qd(n,e){return e.max-n.max}class eh{constructor(e,i,s,u){this.p=new Ze(e,i),this.h=s,this.d=function(p,y){let x=!1,D=1/0;for(let M=0;M<y.length;M++){const F=y[M];for(let U=0,H=F.length,G=H-1;U<H;G=U++){const Y=F[U],oe=F[G];Y.y>p.y!=oe.y>p.y&&p.x<(oe.x-Y.x)*(p.y-Y.y)/(oe.y-Y.y)+Y.x&&(x=!x),D=Math.min(D,Rd(p,Y,oe))}}return(x?1:-1)*Math.sqrt(D)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const th=7,ud=Number.POSITIVE_INFINITY,tf=Math.sqrt(2);function nh(n,[e,i]){let s=0,u=0;if(i===ud){e<0&&(e=0);const p=e/tf;switch(n){case"top-right":case"top-left":u=p-th;break;case"bottom-right":case"bottom-left":u=-p+th;break;case"bottom":u=-e+th;break;case"top":u=e-th}switch(n){case"top-right":case"bottom-right":s=-p;break;case"top-left":case"bottom-left":s=p;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":u=i-th;break;case"bottom-right":case"bottom-left":case"bottom":u=-i+th}switch(n){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,u]}function Jg(n,e,i,s,u,p,y,x,D,M){n.createArrays(),n.tilePixelRatio=pi/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const F=n.layers[0].layout,U=n.layers[0]._unevaluatedLayout._values,H={};if("composite"===n.textSizeData.kind){const{minZoom:oe,maxZoom:de}=n.textSizeData;H.compositeTextSizes=[U["text-size"].possiblyEvaluate(new z(oe),x),U["text-size"].possiblyEvaluate(new z(de),x)]}if("composite"===n.iconSizeData.kind){const{minZoom:oe,maxZoom:de}=n.iconSizeData;H.compositeIconSizes=[U["icon-size"].possiblyEvaluate(new z(oe),x),U["icon-size"].possiblyEvaluate(new z(de),x)]}H.layoutTextSize=U["text-size"].possiblyEvaluate(new z(D+1),x),H.layoutIconSize=U["icon-size"].possiblyEvaluate(new z(D+1),x),H.textMaxSize=U["text-size"].possiblyEvaluate(new z(18),x);const G="map"===F.get("text-rotation-alignment")&&"point"!==F.get("symbol-placement"),Y=F.get("text-size");for(const oe of n.features){const de=F.get("text-font").evaluate(oe,{},x).join(","),Ee=Y.evaluate(oe,{},x),Ne=H.layoutTextSize.evaluate(oe,{},x),Ce=(H.layoutIconSize.evaluate(oe,{},x),{horizontal:{},vertical:void 0}),Fe=oe.text;let ze,We=[0,0];if(Fe){const Wt=Fe.toString(),sn=F.get("text-letter-spacing").evaluate(oe,{},x)*Es,Lt=F.get("text-line-height").evaluate(oe,{},x)*Es,nn=pe(Wt)?sn:0,rn=F.get("text-anchor").evaluate(oe,{},x),gn=F.get("text-variable-anchor");if(!gn){const jn=F.get("text-radial-offset").evaluate(oe,{},x);We=jn?nh(rn,[jn*Es,ud]):F.get("text-offset").evaluate(oe,{},x).map(Di=>Di*Es)}let xn=G?"center":F.get("text-justify").evaluate(oe,{},x);const Ht="point"===F.get("symbol-placement"),On=Ht?F.get("text-max-width").evaluate(oe,{},x)*Es:1/0,Zn=jn=>{n.allowVerticalPlacement&&X(Wt)&&(Ce.vertical=ip(Fe,e,i,u,de,On,Lt,rn,jn,nn,We,Xa.vertical,!0,Ne,Ee))};if(!G&&gn){const jn="auto"===xn?gn.map(In=>Qg(In)):[xn];let Di=!1;for(let In=0;In<jn.length;In++){const li=jn[In];if(!Ce.horizontal[li])if(Di)Ce.horizontal[li]=Ce.horizontal[0];else{const Fi=ip(Fe,e,i,u,de,On,Lt,"center",li,nn,We,Xa.horizontal,!1,Ne,Ee);Fi&&(Ce.horizontal[li]=Fi,Di=1===Fi.positionedLines.length)}}Zn("left")}else{if("auto"===xn&&(xn=Qg(rn)),Ht||F.get("text-writing-mode").indexOf("horizontal")>=0||!X(Wt)){const jn=ip(Fe,e,i,u,de,On,Lt,rn,xn,nn,We,Xa.horizontal,!1,Ne,Ee);jn&&(Ce.horizontal[xn]=jn)}Zn(Ht?"left":xn)}}let At=!1;if(oe.icon&&oe.icon.name){const Wt=s[oe.icon.name];Wt&&(ze=Tm(u[oe.icon.name],F.get("icon-offset").evaluate(oe,{},x),F.get("icon-anchor").evaluate(oe,{},x)),At=Wt.sdf,void 0===n.sdfIcons?n.sdfIcons=Wt.sdf:n.sdfIcons!==Wt.sdf&&fi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Wt.pixelRatio!==n.pixelRatio||0!==F.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const yt=cp(Ce.horizontal)||Ce.vertical;n.iconsInText||(n.iconsInText=!!yt&&yt.iconsInText),(yt||ze)&&Pm(n,oe,Ce,ze,s,H,Ne,0,We,At,y,x,M)}p&&n.generateCollisionDebugBuffers(D,n.collisionBoxArray)}function Qg(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pm(n,e,i,s,u,p,y,x,D,M,F,U,H){let G=p.textMaxSize.evaluate(e,{},U);void 0===G&&(G=y);const Y=n.layers[0].layout,oe=Y.get("icon-offset").evaluate(e,{},U),de=cp(i.horizontal)||i.vertical,Ee="globe"===H.name,Ne=Es,Ce=y/Ne,Fe=n.tilePixelRatio*G/Ne,ze=(rn=n.overscaling,n.zoom>18&&rn>2&&(rn>>=1),Math.max(pi/(512*rn),1)*Y.get("symbol-spacing")),We=Y.get("text-padding")*n.tilePixelRatio,At=Y.get("icon-padding")*n.tilePixelRatio,yt=qt(Y.get("text-max-angle")),Wt="map"===Y.get("text-rotation-alignment")&&"point"!==Y.get("symbol-placement"),sn="map"===Y.get("icon-rotation-alignment")&&"point"!==Y.get("symbol-placement"),Lt=Y.get("symbol-placement"),nn=ze/2;var rn;const gn=Y.get("icon-text-fit");let xn;s&&"none"!==gn&&(n.allowVerticalPlacement&&i.vertical&&(xn=cl(s,i.vertical,gn,Y.get("icon-text-fit-padding"),oe,Ce)),de&&(s=cl(s,de,gn,Y.get("icon-text-fit-padding"),oe,Ce)));const Ht=(On,Zn,jn)=>{if(Zn.x<0||Zn.x>=pi||Zn.y<0||Zn.y>=pi)return;let Di=null;if(Ee){const{x:In,y:li,z:Fi}=H.projectTilePoint(Zn.x,Zn.y,jn);Di={anchor:new Ja(In,li,Fi,0,void 0),up:H.upVector(jn,Zn.x,Zn.y)}}!function(In,li,Fi,vr,Ni,yi,Kr,Ui,Vi,Br,uo,ho,ro,Fo,Zo,ss,oo,ps,as,No,zr,Cs,Co,Ba,ms){const ua=In.addToLineVertexArray(li,vr);let Hs,Qa,Gs,Cc,hf,lh,Lu,jm=0,Sp=0,u_=0,ff=0,$m=-1,d_=-1;const hl={};let ry=Vu("");const ch=Fi?Fi.anchor:li;let h_=0,f_=0;if(void 0===Vi._unevaluatedLayout.getValue("text-radial-offset")?[h_,f_]=Vi.layout.get("text-offset").evaluate(zr,{},ms).map(Tl=>Tl*Es):(h_=Vi.layout.get("text-radial-offset").evaluate(zr,{},ms)*Es,f_=ud),In.allowVerticalPlacement&&Ni.vertical){const Tl=Ni.vertical;if(Zo)lh=up(Tl),Ui&&(Lu=up(Ui));else{const fl=Vi.layout.get("text-rotate").evaluate(zr,{},ms)+90;Gs=nf(Br,ch,li,uo,ho,ro,Tl,Fo,fl,ss),Ui&&(Cc=nf(Br,ch,li,uo,ho,ro,Ui,ps,fl))}}if(yi){const Tl=Vi.layout.get("icon-rotate").evaluate(zr,{},ms),fl="none"!==Vi.layout.get("icon-text-fit"),Ip=Am(yi,Tl,Co,fl),Ap=Ui?Am(Ui,Tl,Co,fl):void 0;Qa=nf(Br,ch,li,uo,ho,ro,yi,ps,Tl),jm=4*Ip.length;const oy=In.iconSizeData;let xd=null;"source"===oy.kind?(xd=[Na*Vi.layout.get("icon-size").evaluate(zr,{},ms)],xd[0]>Wl&&fi(`${In.layerIds[0]}: Value for "icon-size" is >= ${wc}. Reduce your "icon-size".`)):"composite"===oy.kind&&(xd=[Na*Cs.compositeIconSizes[0].evaluate(zr,{},ms),Na*Cs.compositeIconSizes[1].evaluate(zr,{},ms)],(xd[0]>Wl||xd[1]>Wl)&&fi(`${In.layerIds[0]}: Value for "icon-size" is >= ${wc}. Reduce your "icon-size".`)),In.addSymbols(In.icon,Ip,xd,No,as,zr,!1,Fi,li,ua.lineStartIndex,ua.lineLength,-1,Ba,ms),$m=In.icon.placedSymbolArray.length-1,Ap&&(Sp=4*Ap.length,In.addSymbols(In.icon,Ap,xd,No,as,zr,Xa.vertical,Fi,li,ua.lineStartIndex,ua.lineLength,-1,Ba,ms),d_=In.icon.placedSymbolArray.length-1)}for(const Tl in Ni.horizontal){const fl=Ni.horizontal[Tl];Hs||(ry=Vu(fl.text),Zo?hf=up(fl):Hs=nf(Br,ch,li,uo,ho,ro,fl,Fo,Vi.layout.get("text-rotate").evaluate(zr,{},ms),ss));const Ip=1===fl.positionedLines.length;if(u_+=ih(In,Fi,li,fl,Kr,Vi,Zo,zr,ss,ua,Ni.vertical?Xa.horizontal:Xa.horizontalOnly,Ip?Object.keys(Ni.horizontal):[Tl],hl,$m,Cs,Ba,ms),Ip)break}Ni.vertical&&(ff+=ih(In,Fi,li,Ni.vertical,Kr,Vi,Zo,zr,ss,ua,Xa.vertical,["vertical"],hl,d_,Cs,Ba,ms));let ru=-1;const pf=(Tl,fl)=>Tl?Math.max(Tl,fl):fl;ru=pf(hf,ru),ru=pf(lh,ru),ru=pf(Lu,ru);const Hm=ru>-1?1:0;In.glyphOffsetArray.length>=nu.MAX_GLYPHS&&fi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==zr.sortKey&&In.addToSortKeyRanges(In.symbolInstances.length,zr.sortKey),In.symbolInstances.emplaceBack(ch.x,ch.y,ch.z,li.x,li.y,hl.right>=0?hl.right:-1,hl.center>=0?hl.center:-1,hl.left>=0?hl.left:-1,hl.vertical>=0?hl.vertical:-1,$m,d_,ry,void 0!==Hs?Hs:In.collisionBoxArray.length,void 0!==Hs?Hs+1:In.collisionBoxArray.length,void 0!==Gs?Gs:In.collisionBoxArray.length,void 0!==Gs?Gs+1:In.collisionBoxArray.length,void 0!==Qa?Qa:In.collisionBoxArray.length,void 0!==Qa?Qa+1:In.collisionBoxArray.length,Cc||In.collisionBoxArray.length,Cc?Cc+1:In.collisionBoxArray.length,uo,u_,ff,jm,Sp,Hm,0,h_,f_,ru)}(n,Zn,Di,On,i,s,u,xn,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,We,Wt,D,0,At,sn,oe,e,p,M,F,U)};if("line"===Lt)for(const On of X_(e.geometry,0,0,pi,pi)){const Zn=Sm(On,ze,yt,i.vertical||de,s,Ne,Fe,n.overscaling,pi);for(const jn of Zn)de&&e_(n,de.text,nn,jn)||Ht(On,jn,U)}else if("line-center"===Lt){for(const On of e.geometry)if(On.length>1){const Zn=Hl(On,yt,i.vertical||de,s,Ne,Fe);Zn&&Ht(On,Zn,U)}}else if("Polygon"===e.type)for(const On of Uh(e.geometry,0)){const Zn=eu(On,16);Ht(On[0],new Ja(Zn.x,Zn.y,0,0,void 0),U)}else if("LineString"===e.type)for(const On of e.geometry)Ht(On,new Ja(On[0].x,On[0].y,0,0,void 0),U);else if("Point"===e.type)for(const On of e.geometry)for(const Zn of On)Ht([Zn],new Ja(Zn.x,Zn.y,0,0,void 0),U)}const wc=255,Wl=wc*Na;function ih(n,e,i,s,u,p,y,x,D,M,F,U,H,G,Y,oe,de){const Ee=function(Fe,ze,We,At,yt,Wt,sn,Lt){const nn=[];if(0===ze.positionedLines.length)return nn;const rn=At.layout.get("text-rotate").evaluate(Wt,{})*Math.PI/180,gn=function(jn){const Di=jn[0],In=jn[1],li=Di*In;return li>0?[Di,-In]:li<0?[-Di,In]:0===Di?[In,Di]:[In,-Di]}(We);let xn=Math.abs(ze.top-ze.bottom);for(const jn of ze.positionedLines)xn-=jn.lineOffset;const Ht=ze.positionedLines.length,On=xn/Ht;let Zn=ze.top-We[1];for(let jn=0;jn<Ht;++jn){const Di=ze.positionedLines[jn];Zn=J_(ze,On,Zn,jn);for(const In of Di.positionedGlyphs){if(!In.rect)continue;const li=In.rect||{};let Fi=tp+1,vr=!0,Ni=1,yi=0;if(In.imageName){const Co=sn[In.imageName];if(!Co)continue;if(Co.sdf){fi("SDF images are not supported in formatted text and will be ignored.");continue}vr=!1,Ni=Co.pixelRatio,Fi=la/Ni}const Kr=(yt||Lt)&&In.vertical,Ui=In.metrics.advance*In.scale/2,Vi=In.metrics,Br=In.rect;if(null===Br)continue;Lt&&ze.verticalizable&&(yi=In.imageName?Ui-In.metrics.width*In.scale/2:0);const uo=yt?[In.x+Ui,In.y]:[0,0];let ho=[0,0],ro=[0,0],Fo=!1;yt||(Kr?(ro=[In.x+Ui+gn[0],In.y+gn[1]-yi],Fo=!0):ho=[In.x+Ui+We[0],In.y+We[1]-yi]);const Zo=Br.w*In.scale/(Ni*(In.localGlyph?Gl:1)),ss=Br.h*In.scale/(Ni*(In.localGlyph?Gl:1));let oo,ps,as,No;if(Kr){const Co=In.y-Zn,Ba=new Ze(-Ui,Ui-Co),ms=-Math.PI/2,ua=new Ze(...ro);oo=new Ze(-Ui+ho[0],ho[1]),oo._rotateAround(ms,Ba)._add(ua),oo.x+=-Co+Ui,oo.y-=(Vi.left-Fi)*In.scale;const Hs=In.imageName?Vi.advance*In.scale:Es*In.scale,Qa=String.fromCharCode(In.glyph);gm(Qa)?oo.x+=(1-Fi)*In.scale:Gh(Qa)?oo.x+=Hs-Vi.height*In.scale+(-Fi-1)*In.scale:oo.x+=In.imageName||Vi.width+2*Fi===Br.w&&Vi.height+2*Fi===Br.h?(Hs-ss)/2:(Hs-(Vi.height+2*Fi)*In.scale)/2,ps=new Ze(oo.x,oo.y-Zo),as=new Ze(oo.x+ss,oo.y),No=new Ze(oo.x+ss,oo.y-Zo)}else{const Co=(Vi.left-Fi)*In.scale-Ui+ho[0],Ba=(-Vi.top-Fi)*In.scale+ho[1],ms=Co+Zo,ua=Ba+ss;oo=new Ze(Co,Ba),ps=new Ze(ms,Ba),as=new Ze(Co,ua),No=new Ze(ms,ua)}if(rn){let Co;Co=yt?new Ze(0,0):Fo?new Ze(gn[0],gn[1]):new Ze(We[0],We[1]),oo._rotateAround(rn,Co),ps._rotateAround(rn,Co),as._rotateAround(rn,Co),No._rotateAround(rn,Co)}const zr=new Ze(0,0),Cs=new Ze(0,0);nn.push({tl:oo,tr:ps,bl:as,br:No,tex:li,writingMode:ze.writingMode,glyphOffset:uo,sectionIndex:In.sectionIndex,isSDF:vr,pixelOffsetTL:zr,pixelOffsetBR:Cs,minFontScaleX:0,minFontScaleY:0})}}return nn}(0,s,D,p,y,x,u,n.allowVerticalPlacement),Ne=n.textSizeData;let Ce=null;"source"===Ne.kind?(Ce=[Na*p.layout.get("text-size").evaluate(x,{},de)],Ce[0]>Wl&&fi(`${n.layerIds[0]}: Value for "text-size" is >= ${wc}. Reduce your "text-size".`)):"composite"===Ne.kind&&(Ce=[Na*Y.compositeTextSizes[0].evaluate(x,{},de),Na*Y.compositeTextSizes[1].evaluate(x,{},de)],(Ce[0]>Wl||Ce[1]>Wl)&&fi(`${n.layerIds[0]}: Value for "text-size" is >= ${wc}. Reduce your "text-size".`)),n.addSymbols(n.text,Ee,Ce,D,y,x,F,e,i,M.lineStartIndex,M.lineLength,G,oe,de);for(const Fe of U)H[Fe]=n.text.placedSymbolArray.length-1;return 4*Ee.length}function cp(n){for(const e in n)return n[e];return null}function nf(n,e,i,s,u,p,y,x,D,M){let F=y.top,U=y.bottom,H=y.left,G=y.right;const Y=y.collisionPadding;if(Y&&(H-=Y[0],F-=Y[1],G+=Y[2],U+=Y[3]),D){const oe=new Ze(H,F),de=new Ze(G,F),Ee=new Ze(H,U),Ne=new Ze(G,U),Ce=qt(D);let Fe=new Ze(0,0);M&&(Fe=new Ze(M[0],M[1])),oe._rotateAround(Ce,Fe),de._rotateAround(Ce,Fe),Ee._rotateAround(Ce,Fe),Ne._rotateAround(Ce,Fe),H=Math.min(oe.x,de.x,Ee.x,Ne.x),G=Math.max(oe.x,de.x,Ee.x,Ne.x),F=Math.min(oe.y,de.y,Ee.y,Ne.y),U=Math.max(oe.y,de.y,Ee.y,Ne.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,H,F,G,U,x,s,u,p),n.length-1}function up(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function e_(n,e,i,s){const u=n.compareText;if(e in u){const p=u[e];for(let y=p.length-1;y>=0;y--)if(s.dist(p[y])<i)return!0}else u[e]=[];return u[e].push(s),!1}function t_(n,e){const i=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,u=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),p=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01)),y=Math.sin(n._pitch)*p+u;return Math.min(1.01*y,u*(1/n._horizonShift))}function tu(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),s=n.x*i,u=(n.x+1)*i,p=n.y*i,y=(n.y+1)*i,x=Fa(s),D=Fa(u),M=hs(p),F=hs(y),U=e.project(x,M),H=e.project(D,M),G=e.project(D,F),Y=e.project(x,F);let oe=Math.min(U.x,H.x,G.x,Y.x),de=Math.min(U.y,H.y,G.y,Y.y),Ee=Math.max(U.x,H.x,G.x,Y.x),Ne=Math.max(U.y,H.y,G.y,Y.y);const Ce=i/16;function Fe(We,At,yt,Wt,sn,Lt){const nn=(yt+sn)/2,rn=(Wt+Lt)/2,gn=e.project(Fa(nn),hs(rn)),xn=Math.max(0,oe-gn.x,de-gn.y,gn.x-Ee,gn.y-Ne);oe=Math.min(oe,gn.x),Ee=Math.max(Ee,gn.x),de=Math.min(de,gn.y),Ne=Math.max(Ne,gn.y),xn>Ce&&(Fe(We,gn,yt,Wt,nn,rn),Fe(gn,At,nn,rn,sn,Lt))}Fe(U,H,s,p,u,p),Fe(H,G,u,p,u,y),Fe(G,Y,u,y,s,y),Fe(Y,U,s,y,s,p),oe-=Ce,de-=Ce,Ee+=Ce,Ne+=Ce;const ze=1/Math.max(Ee-oe,Ne-de);return{scale:ze,x:oe*ze,y:de*ze,x2:Ee*ze,y2:Ne*ze,projection:e}}const Ry=La(new Float32Array(16));class Iu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Xr(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s=!0){return e._coordinatePoint(e.locationCoordinate(i),s)}pixelsPerMeter(e,i){return xa(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return t_(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,u){const p=e.horizonLineFromTop(!1),y=new Ze(i,Math.max(p,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(y,u))}pointCoordinate3D(e,i,s){const u=new Ze(i,s);if(e.elevation)return e.elevation.pointCoordinate(u);{const p=this.pointCoordinate(e,u.x,u.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return Ry}createTileMatrix(e,i,s){let u,p,y;const x=s.canonical,D=La(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=tu(x,this);u=1,p=M.x+s.wrap*M.scale,y=M.y,Hu(D,D,[u/M.scale,u/M.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(x.z),p=(x.x+Math.pow(2,x.z)*s.wrap)*u,y=x.y*u;return Sd(D,D,[p,y,0]),Hu(D,D,[u/pi,u/pi,1]),D}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class Oy extends Iu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(qt(i));this.n=(u+Math.sin(qt(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:u,r0:p}=this,y=qt(e-this.center[0]),x=qt(i),D=Math.sqrt(u-2*s*Math.sin(x))/s;return{x:D*Math.sin(y*s),y:D*Math.cos(y*s)-p,z:0}}unproject(e,i){const{n:s,c:u,r0:p}=this,y=p+i;let x=Math.atan2(e,Math.abs(y))*Math.sign(y);y*s<0&&(x-=Math.PI*Math.sign(e)*Math.sign(y));const D=qt(this.center[0])*s;x=Oi(x,-Math.PI-D,Math.PI-D);const M=hi(vn(x/s)+this.center[0],-180,180),F=Math.asin(hi((u-(e*e+y*y)*s*s)/(2*s),-1,1)),U=hi(vn(F),-js,js);return new Xr(M,U)}}const dp=1.340264,rh=-.081106,dd=893e-6,hp=.003796,hd=Math.sqrt(3)/2;class rf extends Iu{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(hd*Math.sin(i)),u=s*s,p=u*u*u;return{x:.5*(e*Math.cos(s)/(hd*(dp+3*rh*u+p*(7*dd+9*hp*u)))/Math.PI+.5),y:1-.5*(s*(dp+rh*u+p*(dd+hp*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=s*s,p=u*u*u;for(let F,U,H,G=0;G<12&&(U=s*(dp+rh*u+p*(dd+hp*u))-i,H=dp+3*rh*u+p*(7*dd+9*hp*u),F=U/H,s=hi(s-F,-Math.PI/3,Math.PI/3),u=s*s,p=u*u*u,!(Math.abs(F)<1e-12));++G);const y=hd*e*(dp+3*rh*u+p*(7*dd+9*hp*u))/Math.cos(s),x=Math.asin(Math.sin(s)/hd),D=hi(180*y/Math.PI,-180,180),M=hi(180*x/Math.PI,-js,js);return new Xr(D,M)}}class n_ extends Iu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),u=hi(360*(.5-i),-js,js);return new Xr(s,u)}}const Au=Math.PI/2;function fd(n){return Math.tan((Au+n)/2)}class tr extends Iu{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let u=qt(i),p=qt(s);this.southernCenter=u+p<0,this.southernCenter&&(u=-u,p=-p);const y=Math.cos(u),x=fd(u);this.n=u===p?Math.sin(u):Math.log(y/Math.cos(p))/Math.log(fd(p)/x),this.f=y*Math.pow(fd(u),this.n)/this.n}project(e,i){i=qt(i),this.southernCenter&&(i=-i),e=qt(e-this.center[0]);const s=1e-6,{n:u,f:p}=this;p>0?i<-Au+s&&(i=-Au+s):i>Au-s&&(i=Au-s);const y=p/Math.pow(fd(i),u);let x=y*Math.sin(u*e),D=p-y*Math.cos(u*e);return x=.5*(x/Math.PI+.5),D=.5*(D/Math.PI+.5),{x,y:this.southernCenter?D:1-D,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:u}=this,p=u-i,y=Math.sign(p),x=Math.sign(s)*Math.sqrt(e*e+p*p);let D=Math.atan2(e,Math.abs(p))*y;p*s<0&&(D-=Math.PI*Math.sign(e)*y);const M=hi(vn(D/s)+this.center[0],-180,180),F=hi(vn(2*Math.atan(Math.pow(u/x,1/s))-Au),-js,js);return new Xr(M,this.southernCenter?-F:F)}}class sf extends Iu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Ul(e),y:Dl(i),z:0}}unproject(e,i){const s=Fa(e),u=hs(i);return new Xr(s,u)}}const fp=qt(js);class pd extends Iu{project(e,i){const s=(i=qt(i))*i,u=s*s;return{x:.5*((e=qt(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=25,p=0,y=s*s;do{y=s*s;const M=y*y;p=(s*(1.007226+y*(.015085+M*(.028874*y-.044475-.005916*M)))-i)/(1.007226+y*(.045255+M*(.259866*y-.311325-.005916*11*M))),s=hi(s-p,-fp,fp)}while(Math.abs(p)>1e-6&&--u>0);y=s*s;const x=hi(vn(e/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),D=vn(s);return new Xr(x,D)}}const pp=qt(js);class Q_ extends Iu{project(e,i){i=qt(i),e=qt(e);const s=Math.cos(i),u=2/Math.PI,p=Math.acos(s*Math.cos(e/2)),y=Math.sin(p)/p,x=.5*(e*u+2*s*Math.sin(e/2)/y)||0,D=.5*(i+Math.sin(i)/y)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(D/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,p=25;const y=1e-6;let x=0,D=0;do{const M=Math.cos(u),F=Math.sin(u),U=2*F*M,H=F*F,G=M*M,Y=Math.cos(s/2),oe=Math.sin(s/2),de=2*Y*oe,Ee=oe*oe,Ne=1-G*Y*Y,Ce=Ne?1/Ne:0,Fe=Ne?Math.acos(M*Y)*Math.sqrt(1/Ne):0,ze=.5*(2*Fe*M*oe+2*s/Math.PI)-e,We=.5*(Fe*F+u)-i,At=.5*Ce*(G*Ee+Fe*M*Y*H)+1/Math.PI,yt=Ce*(de*U/4-Fe*F*oe),Wt=.125*Ce*(U*oe-Fe*F*G*de),sn=.5*Ce*(H*Y+Fe*Ee*M)+.5,Lt=yt*Wt-sn*At;x=(We*yt-ze*sn)/Lt,D=(ze*Wt-We*At)/Lt,s=hi(s-x,-Math.PI,Math.PI),u=hi(u-D,-pp,pp)}while((Math.abs(x)>y||Math.abs(D)>y)&&--p>0);return new Xr(vn(s),vn(u))}}class af extends Iu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(qt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:u}=this;return{x:qt(e)*u*s+.5,y:-Math.sin(qt(i))/u*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:u}=this,p=-(i-.5)/s,y=hi(vn((e-.5)/s)/u,-180,180),x=Math.asin(hi(p*u,-1,1)),D=hi(vn(x),-js,js);return new Xr(y,D)}}class md extends sf{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const u=wh(e,i,s);return os(u,u,Eh(zl(s))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i){const s=xu(i.lat,i.lng),u=Qs([],s),p=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Ef(s,s,u,xa(1,0)*pi*p);const y=La(new Float64Array(16));return Md(y,e.pixelMatrix,e.globeMatrix),os(s,s,y),new Ze(s[0],s[1])}pixelsPerMeter(e,i){return xa(1,0)*i}pixelSpaceConversion(e,i,s){const u=xa(1,e)*i,p=Ki(xa(1,45)*i,u,s);return this.pixelsPerMeter(e,i)/p}createTileMatrix(e,i,s){const u=Pf(zl(s.canonical));return Md(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:s}=e,u=Eh(zl(i));return bf(u,u,qt(s.lng)),tg(u,u,qt(s.lat)),Hu(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,s,u){return Wp(e,i,s,!0)||new Cu(0,0)}pointCoordinate3D(e,i,s){const u=this.pointCoordinate(e,i,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!Wp(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(u,p){const y=u.cameraToCenterDistance,x=u._centerAltitude*p,D=u._camera,M=u._camera.forward(),F=gc([],al([],M,-y),[0,0,x]),U=u.worldSize/(2*Math.PI),H=[0,0,-U],G=u.width/u.height,Y=Math.tan(u.fovAboveCenter),oe=al([],D.up(),Y),de=al([],D.right(),Y*G),Ee=Qs([],gc([],gc([],M,oe),de)),Ne=[];let Ce;if(new If(F,Ee).closestPointOnSphere(H,U,Ne)){const Fe=gc([],Ne,H),ze=Bl([],Fe,F);Ce=Math.cos(u.fovAboveCenter)*Id(ze)}else{const Fe=Bl([],F,H),ze=Bl([],H,F);Qs(ze,ze);const We=Id(Fe)-U;Ce=Math.sqrt(We*(We+2*U));const At=Math.acos(Ce/(U+We))-Math.acos(Nl(M,ze));Ce*=Math.cos(At)}return 1.01*Ce}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Ku(e.zoom);if(s>0){const u=t_(e,xa(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),y=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ki(i,u+p*(1-Math.cos(y)),Math.pow(s,10))}return i}upVector(e,i,s){return wh(i,s,e,1)}upVectorScale(e){return{metersToTile:vu(wu(zl(e)))}}}function mp(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new sf(n);case"equirectangular":return new n_(n);case"naturalEarth":return new pd(n);case"equalEarth":return new rf(n);case"winkelTripel":return new Q_(n);case"albers":return i?new af(n):new Oy(n);case"lambertConformalConic":return i?new af(n):new tr(n);case"globe":return new md(n)}throw new Error(`Invalid projection name: ${n.name}`)}const lf=jd.types,gp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gd(n,e,i,s,u,p,y,x,D,M,F,U,H){const G=x?Math.min(Wl,Math.round(x[0])):0,Y=x?Math.min(Wl,Math.round(x[1])):0;n.emplaceBack(e,i,Math.round(32*s),Math.round(32*u),p,y,(G<<1)+(D?1:0),Y,16*M,16*F,256*U,256*H)}function _d(n,e,i,s,u,p,y){n.emplaceBack(e,i,s,u,p,y)}function Pu(n,e,i,s,u){n.emplaceBack(e,i,s,u),n.emplaceBack(e,i,s,u),n.emplaceBack(e,i,s,u),n.emplaceBack(e,i,s,u)}function Rm(n){for(const e of n.sections)if(Yi(e.text))return!0;return!1}class yd{constructor(e){this.layoutVertexArray=new ln,this.indexArray=new Qn,this.programConfigurations=e,this.segments=new Qo,this.dynamicLayoutVertexArray=new mn,this.opacityVertexArray=new ai,this.placedSymbolArray=new Jo,this.globeExtVertexArray=new Cn}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,i,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Py.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,q_.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,gp,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Kf.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Wn(yd,"SymbolBuffers");class _p{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new Qo,this.collisionVertexArray=new rr,this.collisionVertexArrayExt=new er}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,hm.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,fm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Wn(_p,"CollisionBuffers");class nu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=La([]),this.placementViewportMatrix=La([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Zd(this.zoom,i["text-size"]),this.iconSizeData=Zd(this.zoom,i["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==p&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===p||"auto"===p&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(y=>Xa[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new yd(new ju(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new yd(new ju(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ka,this.lineVertexArray=new Dd,this.symbolInstances=new Hr}calculateGlyphDependencies(e,i,s,u,p){for(let y=0;y<e.length;y++)if(i[e.charCodeAt(y)]=!0,u&&p){const x=Xf[e.charAt(y)];x&&(i[x.charCodeAt(0)]=!0)}}populate(e,i,s,u){const p=this.layers[0],y=p.layout,x="globe"===this.projection.name,D=y.get("text-font"),M=y.get("text-field"),F=y.get("icon-image"),U=("constant"!==M.value.kind||M.value.value instanceof Ji&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&("constant"!==D.value.kind||D.value.value.length>0),H="constant"!==F.value.kind||!!F.value.value||Object.keys(F.parameters).length>0,G=y.get("symbol-sort-key");if(this.features=[],!U&&!H)return;const Y=i.iconDependencies,oe=i.glyphDependencies,de=i.availableImages,Ee=new z(this.zoom);for(const{feature:Ne,id:Ce,index:Fe,sourceLayerIndex:ze}of e){const We=p._featureFilter.needGeometry,At=Vc(Ne,We);if(!p._featureFilter.filter(Ee,At,s))continue;if(We||(At.geometry=vc(Ne,s,u)),x&&1!==Ne.type&&s.z<=5){const Lt=At.geometry,nn=.98078528056,rn=(gn,xn)=>Nl(wh(gn.x,gn.y,s,1),wh(xn.x,xn.y,s,1))<nn;for(let gn=0;gn<Lt.length;gn++)Lt[gn]=Yp(Lt[gn],rn)}let yt,Wt;if(U){const Lt=p.getValueAndResolveTokens("text-field",At,s,de),nn=Ji.factory(Lt);Rm(nn)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===C()||this.hasRTLText&&R.isParsed())&&(yt=Yf(nn,p,At))}if(H){const Lt=p.getValueAndResolveTokens("icon-image",At,s,de);Wt=Lt instanceof Io?Lt:Io.fromString(Lt)}if(!yt&&!Wt)continue;const sn=this.sortFeaturesByKey?G.evaluate(At,{},s):void 0;if(this.features.push({id:Ce,text:yt,icon:Wt,index:Fe,sourceLayerIndex:ze,geometry:At.geometry,properties:Ne.properties,type:lf[Ne.type],sortKey:sn}),Wt&&(Y[Wt.name]=!0),yt){const Lt=D.evaluate(At,{},s).join(","),nn="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Xa.vertical)>=0;for(const rn of yt.sections)if(rn.image)Y[rn.image.name]=!0;else{const gn=X(yt.toString()),xn=rn.fontStack||Lt,Ht=oe[xn]=oe[xn]||{};this.calculateGlyphDependencies(rn.text,Ht,nn,this.allowVerticalPlacement,gn)}}}"line"===y.get("symbol-placement")&&(this.features=function(Ne){const Ce={},Fe={},ze=[];let We=0;function At(Lt){ze.push(Ne[Lt]),We++}function yt(Lt,nn,rn){const gn=Fe[Lt];return delete Fe[Lt],Fe[nn]=gn,ze[gn].geometry[0].pop(),ze[gn].geometry[0]=ze[gn].geometry[0].concat(rn[0]),gn}function Wt(Lt,nn,rn){const gn=Ce[nn];return delete Ce[nn],Ce[Lt]=gn,ze[gn].geometry[0].shift(),ze[gn].geometry[0]=rn[0].concat(ze[gn].geometry[0]),gn}function sn(Lt,nn,rn){const gn=rn?nn[0][nn[0].length-1]:nn[0][0];return`${Lt}:${gn.x}:${gn.y}`}for(let Lt=0;Lt<Ne.length;Lt++){const nn=Ne[Lt],rn=nn.geometry,gn=nn.text?nn.text.toString():null;if(!gn){At(Lt);continue}const xn=sn(gn,rn),Ht=sn(gn,rn,!0);if(xn in Fe&&Ht in Ce&&Fe[xn]!==Ce[Ht]){const On=Wt(xn,Ht,rn),Zn=yt(xn,Ht,ze[On].geometry);delete Ce[xn],delete Fe[Ht],Fe[sn(gn,ze[Zn].geometry,!0)]=Zn,ze[On].geometry=null}else xn in Fe?yt(xn,Ht,rn):Ht in Ce?Wt(xn,Ht,rn):(At(Lt),Ce[xn]=We-1,Fe[Ht]=We-1)}return ze.filter(Lt=>Lt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ne,Ce)=>Ne.sortKey-Ce.sortKey)}update(e,i,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,s,u),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,s,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=mp(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:u,y:p}of i)this.lineVertexArray.emplaceBack(u,p);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,u,p,y,x,D,M,F,U,H,G,Y){const oe=e.indexArray,de=e.layoutVertexArray,Ee=e.globeExtVertexArray,Ne=e.segments.prepareSegment(4*i.length,de,oe,this.canOverlap?y.sortKey:void 0),Ce=this.glyphOffsetArray.length,Fe=Ne.vertexLength,ze=this.allowVerticalPlacement&&x===Xa.vertical?Math.PI/2:0,We=y.text&&y.text.sections;for(let yt=0;yt<i.length;yt++){const{tl:Wt,tr:sn,bl:Lt,br:nn,tex:rn,pixelOffsetTL:gn,pixelOffsetBR:xn,minFontScaleX:Ht,minFontScaleY:On,glyphOffset:Zn,isSDF:jn,sectionIndex:Di}=i[yt],In=Ne.vertexLength,li=Zn[1];if(gd(de,M.x,M.y,Wt.x,li+Wt.y,rn.x,rn.y,s,jn,gn.x,gn.y,Ht,On),gd(de,M.x,M.y,sn.x,li+sn.y,rn.x+rn.w,rn.y,s,jn,xn.x,gn.y,Ht,On),gd(de,M.x,M.y,Lt.x,li+Lt.y,rn.x,rn.y+rn.h,s,jn,gn.x,xn.y,Ht,On),gd(de,M.x,M.y,nn.x,li+nn.y,rn.x+rn.w,rn.y+rn.h,s,jn,xn.x,xn.y,Ht,On),D){const{x:Fi,y:vr,z:Ni}=D.anchor,[yi,Kr,Ui]=D.up;_d(Ee,Fi,vr,Ni,yi,Kr,Ui),_d(Ee,Fi,vr,Ni,yi,Kr,Ui),_d(Ee,Fi,vr,Ni,yi,Kr,Ui),_d(Ee,Fi,vr,Ni,yi,Kr,Ui),Pu(e.dynamicLayoutVertexArray,Fi,vr,Ni,ze)}else Pu(e.dynamicLayoutVertexArray,M.x,M.y,M.z,ze);oe.emplaceBack(In,In+1,In+2),oe.emplaceBack(In+1,In+2,In+3),Ne.vertexLength+=4,Ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Zn[0]),yt!==i.length-1&&Di===i[yt+1].sectionIndex||e.programConfigurations.populatePaintArrays(de.length,y,y.index,{},G,Y,We&&We[Di])}const At=D?D.anchor:M;e.placedSymbolArray.emplaceBack(At.x,At.y,At.z,M.x,M.y,Ce,this.glyphOffsetArray.length-Ce,Fe,F,U,M.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],x,0,!1,0,H,0)}_commitLayoutVertex(e,i,s,u,p,y,x){e.emplaceBack(i,s,u,p,y,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,s,u,p,y,x){const D=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),M=D.vertexLength,F=x.tileAnchorX,U=x.tileAnchorY;for(let G=0;G<4;G++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,u,p,y,F,U,new Ze(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,p,y,F,U,new Ze(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,p,y,F,U,new Ze(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,p,y,F,U,new Ze(e.x1,e.y2)),D.vertexLength+=4;const H=s.indexArray;H.emplaceBack(M,M+1),H.emplaceBack(M+1,M+2),H.emplaceBack(M+2,M+3),H.emplaceBack(M+3,M),D.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,u,p,y){for(let x=u;x<p;x++){const D=s.get(x),M=this.getSymbolInstanceTextSize(e,y,i,x);this._addCollisionDebugVertices(D,M,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(e,i,s,u,p,y){for(let x=u;x<p;x++){const D=s.get(x),M=this.getSymbolInstanceIconSize(e,i,y.placedIconSymbolIndex);this._addCollisionDebugVertices(D,M,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,y)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new _p(Hn,sd.members,Wo),this.iconCollisionBox=new _p(Hn,sd.members,Wo);const s=Tu(this.iconSizeData,e),u=Tu(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(u,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(u,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(s,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(s,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,i,s,u){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),y=Kc(this.textSizeData,e,p)/Es;return this.tilePixelRatio*y}getSymbolInstanceIconSize(e,i,s){const u=this.icon.placedSymbolArray.get(s),p=Kc(this.iconSizeData,e,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,s){e.emplaceBack(i,-s,-s),e.emplaceBack(i,s,-s),e.emplaceBack(i,s,s),e.emplaceBack(i,-s,s)}_updateTextDebugCollisionBoxes(e,i,s,u,p,y){for(let x=u;x<p;x++){const D=s.get(x),M=this.getSymbolInstanceTextSize(e,y,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,D.padding)}}_updateIconDebugCollisionBoxes(e,i,s,u,p,y){for(let x=u;x<p;x++){const D=s.get(x),M=this.getSymbolInstanceIconSize(e,i,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,D.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Tu(this.iconSizeData,e),u=Tu(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(u,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(u,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(s,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,u,p,y,x,D,M){const F={};if(i<s){const{x1:U,y1:H,x2:G,y2:Y,padding:oe,projectedAnchorX:de,projectedAnchorY:Ee,projectedAnchorZ:Ne,tileAnchorX:Ce,tileAnchorY:Fe,featureIndex:ze}=e.get(i);F.textBox={x1:U,y1:H,x2:G,y2:Y,padding:oe,projectedAnchorX:de,projectedAnchorY:Ee,projectedAnchorZ:Ne,tileAnchorX:Ce,tileAnchorY:Fe},F.textFeatureIndex=ze}if(u<p){const{x1:U,y1:H,x2:G,y2:Y,padding:oe,projectedAnchorX:de,projectedAnchorY:Ee,projectedAnchorZ:Ne,tileAnchorX:Ce,tileAnchorY:Fe,featureIndex:ze}=e.get(u);F.verticalTextBox={x1:U,y1:H,x2:G,y2:Y,padding:oe,projectedAnchorX:de,projectedAnchorY:Ee,projectedAnchorZ:Ne,tileAnchorX:Ce,tileAnchorY:Fe},F.verticalTextFeatureIndex=ze}if(y<x){const{x1:U,y1:H,x2:G,y2:Y,padding:oe,projectedAnchorX:de,projectedAnchorY:Ee,projectedAnchorZ:Ne,tileAnchorX:Ce,tileAnchorY:Fe,featureIndex:ze}=e.get(y);F.iconBox={x1:U,y1:H,x2:G,y2:Y,padding:oe,projectedAnchorX:de,projectedAnchorY:Ee,projectedAnchorZ:Ne,tileAnchorX:Ce,tileAnchorY:Fe},F.iconFeatureIndex=ze}if(D<M){const{x1:U,y1:H,x2:G,y2:Y,padding:oe,projectedAnchorX:de,projectedAnchorY:Ee,projectedAnchorZ:Ne,tileAnchorX:Ce,tileAnchorY:Fe,featureIndex:ze}=e.get(D);F.verticalIconBox={x1:U,y1:H,x2:G,y2:Y,padding:oe,projectedAnchorX:de,projectedAnchorY:Ee,projectedAnchorZ:Ne,tileAnchorX:Ce,tileAnchorY:Fe},F.verticalIconFeatureIndex=ze}return F}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),u=s.vertexStartIndex+4*s.numGlyphs;for(let p=s.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),u=[],p=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const D=this.symbolInstances.get(x);u.push(0|Math.round(i*D.tileAnchorX+s*D.tileAnchorY)),p.push(D.featureIndex)}return y.sort((x,D)=>u[x]-u[D]||p[D]-p[x]),y}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:M}=s;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&y!==p&&y!==u&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Wn(nu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),nu.MAX_GLYPHS=65535,nu.addDynamicAttributes=Pu;const Ru=new Pe({"symbol-placement":new le(xt.layout_symbol["symbol-placement"]),"symbol-spacing":new le(xt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new le(xt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _e(xt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new le(xt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new le(xt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new le(xt.layout_symbol["icon-ignore-placement"]),"icon-optional":new le(xt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new le(xt.layout_symbol["icon-rotation-alignment"]),"icon-size":new _e(xt.layout_symbol["icon-size"]),"icon-text-fit":new le(xt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new le(xt.layout_symbol["icon-text-fit-padding"]),"icon-image":new _e(xt.layout_symbol["icon-image"]),"icon-rotate":new _e(xt.layout_symbol["icon-rotate"]),"icon-padding":new le(xt.layout_symbol["icon-padding"]),"icon-keep-upright":new le(xt.layout_symbol["icon-keep-upright"]),"icon-offset":new _e(xt.layout_symbol["icon-offset"]),"icon-anchor":new _e(xt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new le(xt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new le(xt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new le(xt.layout_symbol["text-rotation-alignment"]),"text-field":new _e(xt.layout_symbol["text-field"]),"text-font":new _e(xt.layout_symbol["text-font"]),"text-size":new _e(xt.layout_symbol["text-size"]),"text-max-width":new _e(xt.layout_symbol["text-max-width"]),"text-line-height":new _e(xt.layout_symbol["text-line-height"]),"text-letter-spacing":new _e(xt.layout_symbol["text-letter-spacing"]),"text-justify":new _e(xt.layout_symbol["text-justify"]),"text-radial-offset":new _e(xt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new le(xt.layout_symbol["text-variable-anchor"]),"text-anchor":new _e(xt.layout_symbol["text-anchor"]),"text-max-angle":new le(xt.layout_symbol["text-max-angle"]),"text-writing-mode":new le(xt.layout_symbol["text-writing-mode"]),"text-rotate":new _e(xt.layout_symbol["text-rotate"]),"text-padding":new le(xt.layout_symbol["text-padding"]),"text-keep-upright":new le(xt.layout_symbol["text-keep-upright"]),"text-transform":new _e(xt.layout_symbol["text-transform"]),"text-offset":new _e(xt.layout_symbol["text-offset"]),"text-allow-overlap":new le(xt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new le(xt.layout_symbol["text-ignore-placement"]),"text-optional":new le(xt.layout_symbol["text-optional"])});var oh={paint:new Pe({"icon-opacity":new _e(xt.paint_symbol["icon-opacity"]),"icon-color":new _e(xt.paint_symbol["icon-color"]),"icon-halo-color":new _e(xt.paint_symbol["icon-halo-color"]),"icon-halo-width":new _e(xt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _e(xt.paint_symbol["icon-halo-blur"]),"icon-translate":new le(xt.paint_symbol["icon-translate"]),"icon-translate-anchor":new le(xt.paint_symbol["icon-translate-anchor"]),"text-opacity":new _e(xt.paint_symbol["text-opacity"]),"text-color":new _e(xt.paint_symbol["text-color"],{runtimeType:mo,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new _e(xt.paint_symbol["text-halo-color"]),"text-halo-width":new _e(xt.paint_symbol["text-halo-width"]),"text-halo-blur":new _e(xt.paint_symbol["text-halo-blur"]),"text-translate":new le(xt.paint_symbol["text-translate"]),"text-translate-anchor":new le(xt.paint_symbol["text-translate-anchor"])}),layout:Ru};class yp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:gs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Wn(yp,"FormatSectionOverride",{omit:["defaultValue"]});class vp extends Ll{constructor(e){super(e,oh)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const p of s)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,s,u){const p=this.layout.get(e).evaluate(i,{},s,u),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||As(y.value)||!p?p:(x=i.properties,p.replace(/{([^{}]+)}/g,(M,F)=>F in x?String(x[F]):""));var x}createBucket(e){return new nu(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of oh.paint.overridableProperties){if(!vp.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new yp(i),u=new ra(s,i.property.specification);let p=null;p="constant"===i.value.kind||"source"===i.value.kind?new Lo("source",u):new Ys("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new xe(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&vp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),u=oh.paint.properties[i];let p=!1;const y=x=>{for(const D of x)if(u.overrides&&u.overrides.hasOverride(D))return void(p=!0)};if("constant"===s.value.kind&&s.value.value instanceof Ji)y(s.value.value.sections);else if("source"===s.value.kind){const x=M=>{p||(M instanceof $n&&Dr(M.value)===da?y(M.value.sections):M instanceof jr?y(M.sections):M.eachChild(x))},D=s.value;D._styleExpression&&x(D._styleExpression.expression)}return p}getProgramConfiguration(e){return new _u(this,e)}}var ey={paint:new Pe({"background-color":new le(xt.paint_background["background-color"]),"background-pattern":new le(xt.paint_background["background-pattern"]),"background-opacity":new le(xt.paint_background["background-opacity"])})},Om={paint:new Pe({"raster-opacity":new le(xt.paint_raster["raster-opacity"]),"raster-hue-rotate":new le(xt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new le(xt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new le(xt.paint_raster["raster-brightness-max"]),"raster-saturation":new le(xt.paint_raster["raster-saturation"]),"raster-contrast":new le(xt.paint_raster["raster-contrast"]),"raster-resampling":new le(xt.paint_raster["raster-resampling"]),"raster-fade-duration":new le(xt.paint_raster["raster-fade-duration"])})};class km extends Ll{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Lm={paint:new Pe({"sky-type":new le(xt.paint_sky["sky-type"]),"sky-atmosphere-sun":new le(xt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new le(xt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new le(xt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new le(xt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ie(xt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new le(xt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new le(xt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new le(xt.paint_sky["sky-opacity"])})};function bp(n,e,i){const s=[0,0,1],u=Vp([]);return vh(u,u,i?-qt(n)+Math.PI:qt(n)),jp(u,u,-qt(e)),P_(s,s,u),Qs(s,s)}const xp={circle:class extends Ll{constructor(n){super(n,kd)}createBucket(n){return new Ff(n)}queryRadius(n){const e=n;return Qu("circle-radius",this,e)+Qu("circle-stroke-width",this,e)+Od(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,s,u,p,y,x){const D=Rh(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return vg(n,s,p,y,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),D,M)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new _u(this,n)}},heatmap:class extends Ll{createBucket(n){return new bg(n)}constructor(n){super(n,xg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Nf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Qu("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,s,u,p,y,x){const D=this.paint.get("heatmap-radius").evaluate(e,i);return vg(n,s,p,y,x,!0,!0,new Ze(0,0),D)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new _u(this,n)}},hillshade:class extends Ll{constructor(n){super(n,F_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ll{constructor(n){super(n,zd)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new _u(this,n)}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new nd(n)}queryRadius(){return Od(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,s,u,p){return!n.queryGeometry.isAboveHorizon&&Jp(Ph(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Ll{constructor(n){super(n,Zf)}createBucket(n){return new $d(n)}queryRadius(){return Od(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new _u(this,n)}queryIntersectsFeature(n,e,i,s,u,p,y,x,D){const M=Rh(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),F=this.paint.get("fill-extrusion-height").evaluate(e,i),U=this.paint.get("fill-extrusion-base").evaluate(e,i),H=[0,0],G=x&&p.elevation,Y=p.elevation?p.elevation.exaggeration():1,oe=n.tile.getBucket(this);if(G&&oe instanceof $d){const Fe=oe.centroidVertexArray,ze=D+1;ze<Fe.length&&(H[0]=Fe.geta_centroid_pos0(ze),H[1]=Fe.geta_centroid_pos1(ze))}if(0===H[0]&&1===H[1])return!1;"globe"===p.projection.name&&(s=Wd([s],[new Ze(0,0),new Ze(pi,pi)],n.tileID.canonical).map(Fe=>Fe.polygon).flat());const de=G?x:null,[Ee,Ne]=(ze=s,We=U,At=F,yt=M,Wt=y,sn=de,Lt=H,nn=Y,rn=p.center.lat,"globe"===(Fe=p).projection.name?function(xn,Ht,On,Zn,jn,Di,In,li,Fi,vr,Ni){const yi=[],Kr=[],Ui=xn.projection.upVectorScale(Ni,xn.center.lat,xn.worldSize).metersToTile,Vi=[0,0,0,1],Br=[0,0,0,1],uo=(ro,Fo,Zo,ss)=>{ro[0]=Fo,ro[1]=Zo,ro[2]=ss,ro[3]=1},ho=rd();On>0&&(On+=ho),Zn+=ho;for(const ro of Ht){const Fo=[],Zo=[];for(const ss of ro){const oo=ss.x+jn.x,ps=ss.y+jn.y,as=xn.projection.projectTilePoint(oo,ps,Ni),No=xn.projection.upVector(Ni,ss.x,ss.y);let zr=On,Cs=Zn;if(In){const Co=Fg(oo,ps,On,Zn,In,li,Fi,vr);zr+=Co.base,Cs+=Co.top}0!==On?uo(Vi,as.x+No[0]*Ui*zr,as.y+No[1]*Ui*zr,as.z+No[2]*Ui*zr):uo(Vi,as.x,as.y,as.z),uo(Br,as.x+No[0]*Ui*Cs,as.y+No[1]*Ui*Cs,as.z+No[2]*Ui*Cs),os(Vi,Vi,Di),os(Br,Br,Di),Fo.push(new od(Vi[0],Vi[1],Vi[2])),Zo.push(new od(Br[0],Br[1],Br[2]))}yi.push(Fo),Kr.push(Zo)}return[yi,Kr]}(Fe,ze,We,At,yt,Wt,sn,Lt,nn,rn,n.tileID.canonical):sn?function(xn,Ht,On,Zn,jn,Di,In,li,Fi){const vr=[],Ni=[],yi=[0,0,0,1];for(const Kr of xn){const Ui=[],Vi=[];for(const Br of Kr){const uo=Br.x+Zn.x,ho=Br.y+Zn.y,ro=Fg(uo,ho,Ht,On,Di,In,li,Fi);yi[0]=uo,yi[1]=ho,yi[2]=ro.base,yi[3]=1,yu(yi,yi,jn),yi[3]=Math.max(yi[3],1e-5);const Fo=new od(yi[0]/yi[3],yi[1]/yi[3],yi[2]/yi[3]);yi[0]=uo,yi[1]=ho,yi[2]=ro.top,yi[3]=1,yu(yi,yi,jn),yi[3]=Math.max(yi[3],1e-5);const Zo=new od(yi[0]/yi[3],yi[1]/yi[3],yi[2]/yi[3]);Ui.push(Fo),Vi.push(Zo)}vr.push(Ui),Ni.push(Vi)}return[vr,Ni]}(ze,We,At,yt,Wt,sn,Lt,nn,rn):function(xn,Ht,On,Zn,jn){const Di=[],In=[],li=jn[8]*Ht,Fi=jn[9]*Ht,vr=jn[10]*Ht,Ni=jn[11]*Ht,yi=jn[8]*On,Kr=jn[9]*On,Ui=jn[10]*On,Vi=jn[11]*On;for(const Br of xn){const uo=[],ho=[];for(const ro of Br){const Fo=ro.x+Zn.x,Zo=ro.y+Zn.y,ss=jn[0]*Fo+jn[4]*Zo+jn[12],oo=jn[1]*Fo+jn[5]*Zo+jn[13],ps=jn[2]*Fo+jn[6]*Zo+jn[14],as=jn[3]*Fo+jn[7]*Zo+jn[15],No=ss+li,zr=oo+Fi,Cs=ps+vr,Co=Math.max(as+Ni,1e-5),Ba=ss+yi,ms=oo+Kr,ua=ps+Ui,Hs=Math.max(as+Vi,1e-5);uo.push(new od(No/Co,zr/Co,Cs/Co)),ho.push(new od(Ba/Hs,ms/Hs,ua/Hs))}Di.push(uo),In.push(ho)}return[Di,In]}(ze,We,At,yt,Wt)),Ce=n.queryGeometry;var Fe,ze,We,At,yt,Wt,sn,Lt,nn,rn;return function(Fe,ze,We){let At=1/0;Jp(We,ze)&&(At=Lg(We,ze[0]));for(let yt=0;yt<ze.length;yt++){const Wt=ze[yt],sn=Fe[yt];for(let Lt=0;Lt<Wt.length-1;Lt++){const nn=Wt[Lt],rn=[nn,Wt[Lt+1],sn[Lt+1],sn[Lt],nn];Sh(We,rn)&&(At=Math.min(At,Lg(We,rn)))}}return At!==1/0&&At}(Ee,Ne,Ce.isPointQuery()?Ce.screenBounds:Ce.screenGeometry)}},line:class extends Ll{constructor(n){super(n,zg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Jl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=Ug.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new dm(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new _u(this,n)}queryRadius(n){const e=n,i=Z_(Qu("line-width",this,e),Qu("line-gap-width",this,e)),s=Qu("line-offset",this,e);return i/2+Math.abs(s)+Od(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,s,u,p){if(n.queryGeometry.isAboveHorizon)return!1;const y=Ph(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),x=n.pixelToTileUnitsFactor/2*Z_(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),D=this.paint.get("line-offset").evaluate(e,i);return D&&(s=function(M,F){const U=[],H=new Ze(0,0);for(let G=0;G<M.length;G++){const Y=M[G],oe=[];for(let de=0;de<Y.length;de++){const Ee=Y[de],Ne=Y[de+1],Ce=0===de?H:Ee.sub(Y[de-1])._unit()._perp(),Fe=de===Y.length-1?H:Ne.sub(Ee)._unit()._perp(),ze=Ce._add(Fe)._unit();ze._mult(1/(ze.x*Fe.x+ze.y*Fe.y)),oe.push(ze._mult(F)._add(Ee))}U.push(oe)}return U}(s,D*n.pixelToTileUnitsFactor)),function(M,F,U){for(let H=0;H<F.length;H++){const G=F[H];if(M.length>=3)for(let Y=0;Y<G.length;Y++)if(jc(M,G[Y]))return!0;if(Qp(M,G,U))return!0}return!1}(y,s,x)}isTileClipped(){return!0}},symbol:vp,background:class extends Ll{constructor(n){super(n,ey)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ll{constructor(n){super(n,Om)}getProgramIds(){return["raster"]}},sky:class extends Ll{constructor(n){super(n,Lm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Nf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),u=!s,p=n.style.light,y=p.properties.get("position");return u&&"viewport"===p.properties.get("anchor")&&fi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?bp(y.azimuthal,90-y.polar,e):bp(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return bp(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}}};class ca{constructor(e,i,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,s){const{width:u,height:p}=e,{context:y}=this,{gl:x}=y,{HTMLImageElement:D,HTMLCanvasElement:M,HTMLVideoElement:F,ImageData:U,ImageBitmap:H}=ge;if(x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||!1!==i.premultiply)),s||this.size&&this.size[0]===u&&this.size[1]===p){const{x:G,y:Y}=s||{x:0,y:0};e instanceof D||e instanceof M||e instanceof F||e instanceof U||H&&e instanceof H?x.texSubImage2D(x.TEXTURE_2D,0,G,Y,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,G,Y,u,p,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[u,p],e instanceof D||e instanceof M||e instanceof F||e instanceof U||H&&e instanceof H?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,p,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,i){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class i_{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ty{constructor(){this.tasks={},this.taskQueue=[],Vt(["process"],this),this.invoker=new i_(this.process),this.nextId=0}add(e,i){const s=this.nextId++,u=function({type:p,isSymbolTile:y,zoom:x}){return x=x||0,"message"===p?0:"maybePrepare"!==p||y?"parseTile"!==p||y?"parseTile"===p&&y?300-x:"maybePrepare"===p&&y?400-x:500:200-x:100-x}(i);if(0===u){vi();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:i,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){vi();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<i&&(i=p.priority,e=u)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class ny{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const wp=["tile","layer","source","sourceLayer","state"];class Ep{constructor(e,i,s,u,p){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=u,this.properties=e.properties,this.id=p}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const i of wp)void 0!==this[i]&&(e[i]=this[i]);return e}}const Ou=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,i=0,s=0,u=0,p=0,y=0,x=0;for(1&e?u=p=y=32:i=s=x=32;(e>>=1)>1;){const M=i+u>>1,F=s+p>>1;1&e?(u=i,p=s,i=y,s=x):(i=u,s=p,u=y,p=x),y=M,x=F}const D=4*n;Ou[D+0]=i,Ou[D+1]=s,Ou[D+2]=u,Ou[D+3]=p}const Zl=new Uint16Array(2178),ku=new Uint8Array(1089),Cp=new Uint16Array(1089);function Dp(n){return 0===n?-.03125:32===n?.03125:0}var r_=st([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const o_={type:2,extent:pi,loadGeometry:()=>[[new Ze(0,0),new Ze(pi+1,0),new Ze(pi+1,pi+1),new Ze(0,pi+1),new Ze(0,0)]]};class Fm{constructor(e,i,s,u,p){this.tileID=e,this.uid=Yt(),this.uses=0,this.tileSize=i,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<dr.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=tu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,p){const y={};if(!p)return y;for(const x of u){const D=x.layerIds.map(M=>p.getLayer(M)).filter(Boolean);if(0!==D.length){x.layers=D,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(M=>D.filter(F=>F.id===M)[0]));for(const M of D)y[M.id]=x}}return y}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof nu){if(this.hasSymbolBuckets=!0,!s)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof nu&&p.hasRTLText){this.hasRTLText=!0,R.isLoading()||R.isLoaded()||"deferred"!==C()||P();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new hr}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const u=this.buckets[s];u.uploadPending()&&u.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ca(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ca(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ca(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,s,u,p,y,x,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:x,transform:y,params:p,tileTransform:this.tileTransform},e,i,s):{}}querySourceFeatures(e,i){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),p=i?i.sourceLayer:"",y=u._geojsonTileLayer||u[p];if(!y)return;const x=Wa(i&&i.filter),{z:D,x:M,y:F}=this.tileID.canonical,U={z:D,x:M,y:F};for(let H=0;H<y.length;H++){const G=y.feature(H);if(x.needGeometry){const de=Vc(G,!0);if(!x.filter(new z(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!x.filter(new z(this.tileID.overscaledZ),G))continue;const Y=s.getId(G,p),oe=new Ep(G,D,M,F,Y);oe.tile=U,e.push(oe)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const s=Zi(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const p=this.expirationTime-i;p?this.expirationTime=s+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!i)return;const s=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages();for(const p in this.buckets){if(!i.style.hasLayer(p))continue;const y=this.buckets[p],x=y.layers[0].sourceLayer||"_geojsonTileLayer",D=s[x],M=e[x];if(!D||!M||0===Object.keys(M).length)continue;if(y.update(M,D,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof dm||y instanceof nd){const U=i.style._getSourceCache(y.layers[0].source);i._terrain&&i._terrain.enabled&&U&&y.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(U.id,this.tileID)}const F=i&&i.style&&i.style.getLayer(p);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<dr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=dr.now()+e}setTexture(e,i){const s=i.context,u=s.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new ca(s,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,i){const s={};for(const u of i)s[u]=!0;this.dependencies[e]=s}hasDependency(e,i){for(const s of e){const u=this.dependencies[s];if(u)for(const p of i)if(u[p])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const s=vc(o_,this.tileID.canonical,this.tileTransform)[0],u=new pn,p=new ya;for(let y=0;y<s.length;y++){const{x,y:D}=s[y];u.emplaceBack(x,D),p.emplaceBack(y)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(u,bh.members),this._tileDebugSegments=Qo.simpleSegment(0,0,u.length,p.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const s=vc(o_,this.tileID.canonical,this.tileTransform)[0];let u,p;if(this.isRaster){const y=function(x,D){const M=tu(x,D),F=Math.pow(2,x.z);for(let de=0;de<33;de++)for(let Ee=0;Ee<33;Ee++){const Ne=Fa((x.x+(Ee+Dp(Ee))/32)/F),Ce=hs((x.y+(de+Dp(de))/32)/F),Fe=D.project(Ne,Ce),ze=33*de+Ee;Zl[2*ze+0]=Math.round((Fe.x*M.scale-M.x)*pi),Zl[2*ze+1]=Math.round((Fe.y*M.scale-M.y)*pi)}ku.fill(0),Cp.fill(0);for(let de=2045;de>=0;de--){const Ee=4*de,Ne=Ou[Ee+0],Ce=Ou[Ee+1],Fe=Ou[Ee+2],ze=Ou[Ee+3],We=Ne+Fe>>1,At=Ce+ze>>1,yt=We+At-Ce,Wt=At+Ne-We,sn=33*Ce+Ne,Lt=33*ze+Fe,nn=33*At+We,rn=Math.hypot((Zl[2*sn+0]+Zl[2*Lt+0])/2-Zl[2*nn+0],(Zl[2*sn+1]+Zl[2*Lt+1])/2-Zl[2*nn+1])>=16;ku[nn]=ku[nn]||(rn?1:0),de<1022&&(ku[nn]=ku[nn]||ku[33*(Ce+Wt>>1)+(Ne+yt>>1)]||ku[33*(ze+Wt>>1)+(Fe+yt>>1)])}const U=new Qt,H=new Qn;let G=0;function Y(de,Ee){const Ne=33*Ee+de;return 0===Cp[Ne]&&(U.emplaceBack(Zl[2*Ne+0],Zl[2*Ne+1],de*pi/32,Ee*pi/32),Cp[Ne]=++G),Cp[Ne]-1}function oe(de,Ee,Ne,Ce,Fe,ze){const We=de+Ne>>1,At=Ee+Ce>>1;if(Math.abs(de-Fe)+Math.abs(Ee-ze)>1&&ku[33*At+We])oe(Fe,ze,de,Ee,We,At),oe(Ne,Ce,Fe,ze,We,At);else{const yt=Y(de,Ee),Wt=Y(Ne,Ce),sn=Y(Fe,ze);H.emplaceBack(yt,Wt,sn)}}return oe(0,0,32,32,32,0),oe(32,32,0,0,0,32),{vertices:U,indices:H}}(this.tileID.canonical,i);u=y.vertices,p=y.indices}else{u=new Qt,p=new Qn;for(const{x,y:D}of s)u.emplaceBack(x,D,0,0);const y=Cg(u.int16,void 0,4);for(let x=0;x<y.length;x+=3)p.emplaceBack(y[x],y[x+1],y[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,r_.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=Qo.simpleSegment(0,0,u.length,p.length)}_makeGlobeTileDebugBuffers(e,i){const s=i.projection;if(!s||"globe"!==s.name||i.freezeTileCoverage)return;const u=this.tileID.canonical,p=Eh(qp(u,i)),y=Ku(i.zoom);let x;y>0&&(x=Bp(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,i,p,x,y),this._makeGlobeTileDebugTextBuffer(e,u,i,p,x,y)}_globePoint(e,i,s,u,p,y,x){let D=wh(e,i,s);if(y){const M=1<<s.z,F=Ul(u.center.lng),U=Dl(u.center.lat),H=(s.x+.5)/M-F;let G=0;H>.5?G=-1:H<-.5&&(G=1);let Y=(e/pi+s.x)/M+G,oe=(i/pi+s.y)/M;Y=(Y-F)*u._pixelsPerMercatorPixel+F,oe=(oe-U)*u._pixelsPerMercatorPixel+U;const de=[Y*u.worldSize,oe*u.worldSize,0];os(de,de,y),D=qu(D,de,x)}return os(D,D,p)}_makeGlobeTileDebugBorderBuffer(e,i,s,u,p,y){const x=new pn,D=new ya,M=new Ct,F=(H,G,Y,oe,de)=>{const Ee=(Y-H)/(de-1),Ne=(oe-G)/(de-1),Ce=x.length;for(let Fe=0;Fe<de;Fe++){const ze=H+Fe*Ee,We=G+Fe*Ne;x.emplaceBack(ze,We);const At=this._globePoint(ze,We,i,s,u,p,y);M.emplaceBack(At[0],At[1],At[2]),D.emplaceBack(Ce+Fe)}},U=pi;F(0,0,U,0,16),F(U,0,U,U,16),F(U,U,0,U,16),F(0,U,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(D),this._tileDebugBuffer=e.createVertexBuffer(x,bh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(M,cg.members),this._tileDebugSegments=Qo.simpleSegment(0,0,x.length,D.length)}_makeGlobeTileDebugTextBuffer(e,i,s,u,p,y){const x=pi/4,D=new pn,M=new Qn,F=new Ct,U=25;M.reserve(32),D.reserve(U),F.reserve(U);const H=(G,Y)=>U*G+Y;for(let G=0;G<U;G++){const Y=G*x;for(let oe=0;oe<U;oe++){const de=oe*x;D.emplaceBack(de,Y);const Ee=this._globePoint(de,Y,i,s,u,p,y);F.emplaceBack(Ee[0],Ee[1],Ee[2])}}for(let G=0;G<4;G++)for(let Y=0;Y<4;Y++){const oe=H(G,Y),de=H(G,Y+1),Ee=H(G+1,Y),Ne=H(G+1,Y+1);M.emplaceBack(oe,de,Ee),M.emplaceBack(Ee,de,Ne)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(M),this._tileDebugTextBuffer=e.createVertexBuffer(D,bh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(F,cg.members),this._tileDebugTextSegments=Qo.simpleSegment(0,0,U,32)}}class iy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,s){const u=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},_t(this.stateChanges[e][u],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const p in this.state[e][u])s[p]||(this.deletedStates[e][u][p]=null)}else for(const p in s)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][p]&&delete this.deletedStates[e][u][p]}removeFeatureState(e,i,s){if(null===this.deletedStates[e])return;const u=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==i)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][s]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][u])for(s in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][s]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,i){const s=String(i),u=_t({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const p=this.deletedStates[e][i];if(null===p)return{};for(const y in p)delete u[y]}return u}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const y in this.stateChanges[u])this.state[u][y]||(this.state[u][y]={}),_t(this.state[u][y],this.stateChanges[u][y]),p[y]=this.state[u][y];s[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(null===this.deletedStates[u])for(const y in this.state[u])p[y]={},this.state[u][y]={};else for(const y in this.deletedStates[u]){if(null===this.deletedStates[u][y])this.state[u][y]={};else if(this.state[u][y])for(const x of Object.keys(this.deletedStates[u][y]))delete this.state[u][y][x];p[y]=this.state[u][y]}s[u]=s[u]||{},_t(s[u],p)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const u in e)e[u].setFeatureState(s,i)}}class s_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function ql(n,e,i,s){let u=0,p=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(s[y])<1e-15){if(i[y]<n[y]||i[y]>e[y])return null}else{const x=1/s[y];let D=(n[y]-i[y])*x,M=(e[y]-i[y])*x;if(D>M){const F=D;D=M,M=F}if(D>u&&(u=D),M<p&&(p=M),u>p)return null}return u}function Tp(n,e,i,s,u,p,y,x,D,M,F){const U=s-n,H=u-e,G=p-i,Y=y-n,oe=x-e,de=D-i,Ee=F[1]*de-F[2]*oe,Ne=F[2]*Y-F[0]*de,Ce=F[0]*oe-F[1]*Y,Fe=U*Ee+H*Ne+G*Ce;if(Math.abs(Fe)<1e-15)return null;const ze=1/Fe,We=M[0]-n,At=M[1]-e,yt=M[2]-i,Wt=(We*Ee+At*Ne+yt*Ce)*ze;if(Wt<0||Wt>1)return null;const sn=At*G-yt*H,Lt=yt*U-We*G,nn=We*H-At*U,rn=(F[0]*sn+F[1]*Lt+F[2]*nn)*ze;return rn<0||Wt+rn>1?null:(Y*sn+oe*Lt+de*nn)*ze}function a_(n,e,i){return(n-e)/(i-e)}function Nm(n,e,i,s,u,p,y,x,D){const M=1<<i,F=p-s,U=y-u,H=(n+1)/M*F+s,G=(e+0)/M*U+u,Y=(e+1)/M*U+u;x[0]=(n+0)/M*F+s,x[1]=G,D[0]=H,D[1]=Y}class l_{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(p){const y=Math.ceil(Math.log2(p.dim/8)),x=[];let D=Math.ceil(Math.pow(2,y));const M=1/D,F=(G,Y,oe,de,Ee)=>{const Ne=de?1:0,Ce=(G+1)*oe-Ne,Fe=Y*oe,ze=(Y+1)*oe-Ne;Ee[0]=G*oe,Ee[1]=Fe,Ee[2]=Ce,Ee[3]=ze};let U=new s_(D);const H=[];for(let G=0;G<D*D;G++){F(G%D,Math.floor(G/D),M,!1,H);const Y=iu(H[0],H[1],p),oe=iu(H[2],H[1],p),de=iu(H[2],H[3],p),Ee=iu(H[0],H[3],p);U.minimums.push(Math.min(Y,oe,de,Ee)),U.maximums.push(Math.max(Y,oe,de,Ee)),U.leaves.push(1)}for(x.push(U),D/=2;D>=1;D/=2){const G=x[x.length-1];U=new s_(D);for(let Y=0;Y<D*D;Y++){F(Y%D,Math.floor(Y/D),2,!0,H);const oe=G.getElevation(H[0],H[1]),de=G.getElevation(H[2],H[1]),Ee=G.getElevation(H[2],H[3]),Ne=G.getElevation(H[0],H[3]),Ce=G.isLeaf(H[0],H[1]),Fe=G.isLeaf(H[2],H[1]),ze=G.isLeaf(H[2],H[3]),We=G.isLeaf(H[0],H[3]),At=Math.min(oe.min,de.min,Ee.min,Ne.min),yt=Math.max(oe.max,de.max,Ee.max,Ne.max),Wt=Ce&&Fe&&ze&&We;U.maximums.push(yt),U.minimums.push(At),U.leaves.push(yt-At<=5&&Wt?1:0)}x.push(U)}return x}(this.dem),s=i.length-1,u=i[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,u,p,y,x=1){return ql([e,i,-100],[s,u,this.maximums[0]*x],p,y)}raycast(e,i,s,u,p,y,x=1){if(!this.nodeCount)return null;const D=this.raycastRoot(e,i,s,u,p,y,x);if(null==D)return null;const M=[],F=[],U=[],H=[],G=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;G.length>0;){const{idx:Y,t:oe,nodex:de,nodey:Ee,depth:Ne}=G.pop();if(this.leaves[Y]){Nm(de,Ee,Ne,e,i,s,u,U,H);const Fe=1<<Ne,ze=(de+0)/Fe,We=(de+1)/Fe,At=(Ee+0)/Fe,yt=(Ee+1)/Fe,Wt=iu(ze,At,this.dem)*x,sn=iu(We,At,this.dem)*x,Lt=iu(We,yt,this.dem)*x,nn=iu(ze,yt,this.dem)*x,rn=Tp(U[0],U[1],Wt,H[0],U[1],sn,H[0],H[1],Lt,p,y),gn=Tp(H[0],H[1],Lt,U[0],H[1],nn,U[0],U[1],Wt,p,y),xn=Math.min(null!==rn?rn:Number.MAX_VALUE,null!==gn?gn:Number.MAX_VALUE);if(xn!==Number.MAX_VALUE)return xn;{const Ht=Ef([],p,y,oe);if(cf(Wt,sn,nn,Lt,a_(Ht[0],U[0],H[0]),a_(Ht[1],U[1],H[1]))>=Ht[2])return oe}continue}let Ce=0;for(let Fe=0;Fe<this._siblingOffset.length;Fe++){Nm((de<<1)+this._siblingOffset[Fe][0],(Ee<<1)+this._siblingOffset[Fe][1],Ne+1,e,i,s,u,U,H),U[2]=-100,H[2]=this.maximums[this.childOffsets[Y]+Fe]*x;const ze=ql(U,H,p,y);if(null!=ze){const We=ze;M[Fe]=We;let At=!1;for(let yt=0;yt<Ce&&!At;yt++)We>=M[F[yt]]&&(F.splice(yt,0,Fe),At=!0);At||(F[Ce]=Fe),Ce++}}for(let Fe=0;Fe<Ce;Fe++){const ze=F[Fe];G.push({idx:this.childOffsets[Y]+ze,t:M[ze],nodex:(de<<1)+this._siblingOffset[ze][0],nodey:(Ee<<1)+this._siblingOffset[ze][1],depth:Ne+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,u,p){if(1===e[u].isLeaf(i,s))return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const y=u-1,x=e[y];let D=0,M=0;for(let F=0;F<this._siblingOffset.length;F++){const U=2*i+this._siblingOffset[F][0],H=2*s+this._siblingOffset[F][1],G=x.getElevation(U,H),Y=x.isLeaf(U,H),oe=this._addNode(G.min,G.max,Y);Y&&(D|=1<<F),M||(M=oe)}for(let F=0;F<this._siblingOffset.length;F++)D&1<<F||this._construct(e,2*i+this._siblingOffset[F][0],2*s+this._siblingOffset[F][1],y,M+F)}}function cf(n,e,i,s,u,p){return Ki(Ki(n,i,p),Ki(e,s,p),u)}function iu(n,e,i){const s=i.dim,u=hi(n*s-.5,0,s-1),p=hi(e*s-.5,0,s-1),y=Math.floor(u),x=Math.floor(p),D=Math.min(y+1,s-1),M=Math.min(x+1,s-1);return cf(i.get(y,x),i.get(D,x),i.get(y,M),i.get(D,M),u-y,p-x)}const uf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Bm(n,e,i){return(256*n*256+256*e+i)/10-1e4}function ky(n,e,i){return 256*n+e+i/256-32768}class sh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,u=!1,p=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return fi(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const y=this.dim=i.height-2,x=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=s||"mapbox",this.borderReady=u,!u){for(let D=0;D<y;D++)x[this._idx(-1,D)]=x[this._idx(0,D)],x[this._idx(y,D)]=x[this._idx(y-1,D)],x[this._idx(D,-1)]=x[this._idx(D,0)],x[this._idx(D,y)]=x[this._idx(D,y-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(y,-1)]=x[this._idx(y-1,0)],x[this._idx(-1,y)]=x[this._idx(0,y-1)],x[this._idx(y,y)]=x[this._idx(y-1,y-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new l_(this)}get(e,i,s=!1){s&&(e=hi(e,-1,this.dim),i=hi(i,-1,this.dim));const u=4*this._idx(e,i);return("terrarium"===this.encoding?ky:Bm)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return uf[e]}get unpackVector(){return uf[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],u=sh.getUnpackVector(i);let p=Math.floor((e+u[3])/u[2]);return s[2]=p%256,p=Math.floor(p/256),s[1]=p%256,p=Math.floor(p/256),s[0]=p,s}getPixels(){return new wa({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,p=i*this.dim+this.dim,y=s*this.dim,x=s*this.dim+this.dim;switch(i){case-1:u=p-1;break;case 1:p=u+1}switch(s){case-1:y=x-1;break;case 1:x=y+1}const D=-i*this.dim,M=-s*this.dim;for(let F=y;F<x;F++)for(let U=u;U<p;U++){const H=4*this._idx(U,F),G=4*this._idx(U+D,F+M);this.pixels[H+0]=e.pixels[G+0],this.pixels[H+1]=e.pixels[G+1],this.pixels[H+2]=e.pixels[G+2],this.pixels[H+3]=e.pixels[G+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Wn(sh,"DEMData"),Wn(l_,"DemMinMaxQuadTree",{omit:["dem"]});class c_{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,s){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const p={value:i,timeout:void 0};if(void 0!==s&&(p.timeout=setTimeout(()=>{this.remove(e,p)},s)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const s=e.wrapped().key,u=void 0===i?0:this.data[s].indexOf(i),p=this.data[s][u];return this.data[s].splice(u,1),p.timeout&&clearTimeout(p.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(p.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const s in this.data)for(const u of this.data[s])e(u.value)||i.push(u);for(const s of i)this.remove(s.value.tileID,s)}}class vd{constructor(e,i,s){this.func=e,this.mask=i,this.range=s}}vd.ReadOnly=!1,vd.ReadWrite=!0,vd.disabled=new vd(519,vd.ReadOnly,[0,1]);class ah{constructor(e,i,s,u,p,y){this.test=e,this.ref=i,this.mask=s,this.fail=u,this.depthFail=p,this.pass=y}}ah.disabled=new ah({func:519,mask:0},0,0,7680,7680,7680);class $s{constructor(e,i,s){this.blendFunction=e,this.blendColor=i,this.mask=s}}$s.Replace=[1,0],$s.disabled=new $s($s.Replace,Jn.transparent,[!1,!1,!1,!1]),$s.unblended=new $s($s.Replace,Jn.transparent,[!0,!0,!0,!0]),$s.alphaBlended=new $s([1,771],Jn.transparent,[!0,!0,!0,!0]);class dl{constructor(e,i,s){this.enable=e,this.mode=i,this.frontFace=s}}dl.disabled=new dl(!1,1029,2305),dl.backCCW=new dl(!0,1029,2305),dl.backCW=new dl(!0,1029,2304),dl.frontCW=new dl(!0,1028,2304),dl.frontCCW=new dl(!0,1028,2305);class bd extends qo{constructor(e,i,s){super(),this.id=e,this._onlySymbols=s,i.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new c_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new iy,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const s=this._tiles[i];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return so(this._tiles).map(e=>e.tileID).sort(Mp).map(e=>e.key)}getRenderableIds(e){const i=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&i.push(this._tiles[s]);return e?i.sort((s,u)=>{const p=s.tileID,y=u.tileID,x=new Ze(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),D=new Ze(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-y.overscaledZ||D.y-x.y||D.x-x.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(Mp).map(s=>s.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=i),this._loadTile(s,this._tileLoaded.bind(this,s,e,i)))}_tileLoaded(e,i,s,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new So(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=dr.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Jr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const p=i[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const y=this.getTileByID(p);s(e,y),s(y,e)}}function s(u,p){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let y=p.tileID.canonical.x-u.tileID.canonical.x;const x=p.tileID.canonical.y-u.tileID.canonical.y,D=Math.pow(2,u.tileID.canonical.z),M=p.tileID.key;0===y&&0===x||Math.abs(x)>1||(Math.abs(y)>1&&(1===Math.abs(y+D)?y+=D:1===Math.abs(y-D)&&(y-=D)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,y,x),u.neighboringTiles&&u.neighboringTiles[M]&&(u.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,s,u){for(const p in this._tiles){let y=this._tiles[p];if(u[p]||!y.hasData()||y.tileID.overscaledZ<=i||y.tileID.overscaledZ>s)continue;let x=y.tileID;for(;y&&y.tileID.overscaledZ>i+1;){const M=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[M.key],y&&y.hasData()&&(x=M)}let D=x;for(;D.overscaledZ>i;)if(D=D.scaledTo(D.overscaledZ-1),e[D.key]){u[x.key]=x;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=i?s:null}for(let s=e.overscaledZ-1;s>=i;s--){const u=e.scaledTo(s),p=this._getLoadedTile(u);if(p)return p}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const s=Math.ceil(e.width/i)+1,u=Math.ceil(e.height/i)+1,p=Math.floor(s*u*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,p):p,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(x)}handleWrapJump(e){const i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){const s={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+i),s[p.tileID.key]=p}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,i,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let u;this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Ea(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(u=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(x=>this._source.hasTile(x)))):u=[];const p=this._updateRetainedTiles(u);if(Vm(this._source.type)&&0!==u.length){const x={},D={},M=Object.keys(p);for(const U of M){const H=p[U],G=this._tiles[U];if(!G||G.fadeEndTime&&G.fadeEndTime<=dr.now())continue;const Y=this.findLoadedParent(H,Math.max(H.overscaledZ-bd.maxOverzooming,this._source.minzoom));Y&&(this._addTile(Y.tileID),x[Y.tileID.key]=Y.tileID),D[U]=H}const F=u[u.length-1].overscaledZ;for(const U in this._tiles){const H=this._tiles[U];if(p[U]||!H.hasData())continue;let G=H.tileID;for(;G.overscaledZ>F;){G=G.scaledTo(G.overscaledZ-1);const Y=this._tiles[G.key];if(Y&&Y.hasData()&&D[G.key]){p[U]=H.tileID;break}}}for(const U in x)p[U]||(this._coveredTiles[U]=!0,p[U]=x[U])}for(const x in p)this._tiles[x].clearFadeHold();const y=function(x,D){const M=[];for(const F in x)F in D||M.push(F);return M}(this._tiles,p);for(const x of y){const D=this._tiles[x];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const s={},u=e.reduce((M,F)=>Math.min(M,F.overscaledZ),1/0),p=e[0].overscaledZ,y=Math.max(p-bd.maxOverzooming,this._source.minzoom),x=Math.max(p+bd.maxUnderzooming,this._source.minzoom),D={};for(const M of e){const F=this._addTile(M);i[M.key]=M,F.hasData()||u<this._source.maxzoom&&(D[M.key]=M)}this._retainLoadedChildren(D,u,x,i);for(const M of e){let F=this._tiles[M.key];if(F.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const H=M.children(this._source.maxzoom)[0],G=this.getTile(H);if(G&&G.hasData()){i[H.key]=H;continue}}else{const H=M.children(this._source.maxzoom);if(i[H[0].key]&&i[H[1].key]&&i[H[2].key]&&i[H[3].key])continue}let U=F.wasRequested();for(let H=M.overscaledZ-1;H>=y;--H){const G=M.scaledTo(H);if(s[G.key]||(s[G.key]=!0,F=this.getTile(G),!F&&U&&(F=this._addTile(G)),F&&(i[G.key]=G,U=F.wasRequested(),F.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let s,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}i.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(p),s)break;u=p}for(const p of i)this._loadedParentTiles[p]=s}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const s=!!i;if(!s){const u=this.map?this.map.painter:null;i=new Fm(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,s||this._source.fire(new Jr("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=i.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,s){const u=[],p=this.transform;if(!p)return u;const y="globe"===p.projection.name,x=Ul(p.center.lng);for(const D in this._tiles){const M=this._tiles[D];if(s&&M.clearQueryDebugViz(),M.holdingForFade())continue;let F;if(y){const U=M.tileID.canonical;if(0===U.z){const H=[Math.abs(hi(x,...E(U,-1))-x),Math.abs(hi(x,...E(U,1))-x)];F=[0,2*H.indexOf(Math.min(...H))-1]}else{const H=[Math.abs(hi(x,...E(U,-1))-x),Math.abs(hi(x,...E(U,0))-x),Math.abs(hi(x,...E(U,1))-x)];F=[H.indexOf(Math.min(...H))-1]}}else F=[0];for(const U of F){const H=e.containsTile(M,p,i,U);H&&u.push(H)}}return u}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of i)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Vm(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=dr.now())return!0}return!1}setFeatureState(e,i,s){this._state.updateState(e=e||"_geojsonTileLayer",i,s)}removeFeatureState(e,i,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,s)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,s){const u=this._tiles[e];u&&u.setDependencies(i,s)}reloadTilesForDependencies(e,i){for(const s in this._tiles)this._tiles[s].hasDependency(e,i)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const x=()=>{this._sourceLoaded&&(this._source.off("data",x),this._preloadTiles(e,i))};return void this._source.on("data",x)}const s=new Map,u=Array.isArray(e)?e:[e],p=this.map.painter.terrain,y=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const x of u){const D=x.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const M of D)s.set(M.key,M);this.usedForTerrain&&x.updateElevation(!1)}ji(Array.from(s.values()),(x,D)=>{const M=new Fm(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(M,F=>{"raster-dem"===this._source.type&&M.dem&&this._backfillDEM(M),D(F,M)})},i)}}function Mp(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||s-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function Vm(n){return"raster"===n||"image"===n||"video"===n||"custom"===n}function E(n,e){const i=1<<n.z;return[n.x/i+e,(n.x+1)/i+e]}bd.maxOverzooming=10,bd.maxUnderzooming=3;class h{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const u=s||e.findDEMTileFor(i);if(!u||!u.dem)return;const p=u.dem,y=u.tileID,x=1<<i.canonical.z-y.canonical.z;return new h(u,u.tileSize/pi/x,[(i.canonical.x/x-y.canonical.x)*p.dim,(i.canonical.y/x-y.canonical.y)*p.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(s);return new Ze(u,p)}getElevationAt(e,i,s,u){const p=e*this._scale+this._offset[0],y=i*this._scale+this._offset[1],x=Math.floor(p),D=Math.floor(y),M=this._dem;return u=!!u,s?Ki(Ki(M.get(x,D,u),M.get(x,D+1,u),y-D),Ki(M.get(x+1,D,u),M.get(x+1,D+1,u),y-D),p-x):M.get(x,D,u)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*xa(1,e)*this._dem.stride}}class v{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new wl(pi,16,0),this.featureIndexArray=new Nc,this.promoteId=i}insert(e,i,s,u,p,y=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,p,y);const D=this.grid;for(let M=0;M<i.length;M++){const F=i[M],U=[1/0,1/0,-1/0,-1/0];for(let H=0;H<F.length;H++){const G=F[H];U[0]=Math.min(U[0],G.x),U[1]=Math.min(U[1],G.y),U[2]=Math.max(U[2],G.x),U[3]=Math.max(U[3],G.y)}U[0]<pi&&U[1]<pi&&U[2]>=0&&U[3]>=0&&D.insert(x,U[0],U[1],U[2],U[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new jh(new Xc(this.rawTileData)).layers,this.sourceLayerCoder=new ny(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,s,u){this.loadVTLayers();const p=e.params||{},y=Wa(p.filter),x=e.tileResult,D=e.transform,M=x.bufferedTilespaceBounds,F=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(Y,oe,de,Ee)=>em(x.bufferedTilespaceGeometry,Y,oe,de,Ee));F.sort(T);let U=null;D.elevation&&F.length>0&&(U=h.create(D.elevation,this.tileID));const H={};let G;for(let Y=0;Y<F.length;Y++){const oe=F[Y];if(oe===G)continue;G=oe;const de=this.featureIndexArray.get(oe);let Ee=null;this.loadMatchingFeature(H,de,y,p.layers,p.availableImages,i,s,u,(Ne,Ce,Fe,ze=0)=>(Ee||(Ee=vc(Ne,this.tileID.canonical,e.tileTransform)),Ce.queryIntersectsFeature(x,Ne,Fe,Ee,this.z,e.transform,e.pixelPosMatrix,U,ze)))}return H}loadMatchingFeature(e,i,s,u,p,y,x,D,M){const{featureIndex:F,bucketIndex:U,sourceLayerIndex:H,layoutVertexArrayOffset:G}=i,Y=this.bucketLayerIDs[U];if(u&&!function(Ne,Ce){for(let Fe=0;Fe<Ne.length;Fe++)if(Ce.indexOf(Ne[Fe])>=0)return!0;return!1}(u,Y))return;const oe=this.sourceLayerCoder.decode(H),de=this.vtLayers[oe].feature(F);if(s.needGeometry){const Ne=Vc(de,!0);if(!s.filter(new z(this.tileID.overscaledZ),Ne,this.tileID.canonical))return}else if(!s.filter(new z(this.tileID.overscaledZ),de))return;const Ee=this.getId(de,oe);for(let Ne=0;Ne<Y.length;Ne++){const Ce=Y[Ne];if(u&&u.indexOf(Ce)<0)continue;const Fe=y[Ce];if(!Fe)continue;let ze={};void 0!==Ee&&D&&(ze=D.getState(Fe.sourceLayer||"_geojsonTileLayer",Ee));const We=_t({},x[Ce]);We.paint=_(We.paint,Fe.paint,de,ze,p),We.layout=_(We.layout,Fe.layout,de,ze,p);const At=!M||M(de,Fe,ze,G);if(!At)continue;const yt=new Ep(de,this.z,this.x,this.y,Ee);yt.layer=We;let Wt=e[Ce];void 0===Wt&&(Wt=e[Ce]=[]),Wt.push({featureIndex:F,feature:yt,intersectionZ:At})}}lookupSymbolFeatures(e,i,s,u,p,y,x,D){const M={};this.loadVTLayers();const F=Wa(p);for(const U of e)this.loadMatchingFeature(M,{bucketIndex:s,sourceLayerIndex:u,featureIndex:U,layoutVertexArrayOffset:0},F,y,x,D,i);return M}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),p=this.vtFeatures[u];if(p[i])return p[i];const y=this.vtLayers[u].feature(i);return p[i]=y,y}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const u="string"==typeof this.promoteId?this.promoteId:this.promoteId[i];null!=u&&(s=e.properties[u]),"boolean"==typeof s&&(s=Number(s))}return s}}function _(n,e,i,s,u){return zn(n,(p,y)=>{const x=e instanceof De?e.get(y):null;return x&&x.evaluate?x.evaluate(i,s,u):x})}function T(n,e){return e-n}Wn(v,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class V{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Vl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=bn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const u=[];let p=e.length%2==1?-e[e.length-1]*s:0,y=e[0]*s,x=!0;u.push({left:p,right:y,isDash:x,zeroLength:0===e[0]});let D=e[0];for(let M=1;M<e.length;M++){x=!x;const F=e[M];p=D*s,D+=F,y=D*s,u.push({left:p,right:y,isDash:x,zeroLength:0===F})}return u}addRoundDash(e,i,s){const u=i/2;for(let p=-s;p<=s;p++){const y=this.width*(this.nextRow+s+p);let x=0,D=e[x];for(let M=0;M<this.width;M++){M/D.right>1&&(D=e[++x]);const F=Math.abs(M-D.left),U=Math.abs(M-D.right),H=Math.min(F,U);let G;const Y=p/s*(u+1);if(D.isDash){const oe=u-Math.abs(Y);G=Math.sqrt(H*H+oe*oe)}else G=u-Math.sqrt(H*H+Y*Y);this.image.data[y+M]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e,i){for(let D=e.length-1;D>=0;--D){const M=e[D],F=e[D+1];M.zeroLength?e.splice(D,1):F&&F.isDash===M.isDash&&(F.left=M.left,e.splice(D,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const p=this.width*this.nextRow;let y=0,x=e[y];for(let D=0;D<this.width;D++){D/x.right>1&&(x=e[++y]);const M=Math.abs(D-x.left),F=Math.abs(D-x.right),U=Math.min(M,F);this.image.data[p+D]=Math.max(0,Math.min(255,(x.isDash?U:-U)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const u="round"===i,p=u?7:0,y=2*p+1;if(this.nextRow+y>this.height)return fi("LineAtlas out of space"),null;0===e.length&&e.push(1);let x=0;for(let F=0;F<e.length;F++)e[F]<0&&(fi("Negative value is found in line dasharray, replacing values with 0"),e[F]=0),x+=e[F];if(0!==x){const F=this.width/x,U=this.getDashRanges(e,this.width,F);u?this.addRoundDash(U,F,p):this.addRegularDash(U,"square"===i?.5*F:0)}const D=this.nextRow+p;this.nextRow+=y;const M={tl:[D,p],br:[x,0]};return this.positions[s]=M,M}}Wn(V,"LineAtlas");const te=1*Gl;class me{constructor(e){const i={},s=[];for(const x in e){const D=e[x],M=i[x]={};for(const F in D.glyphs){const U=D.glyphs[+F];if(!U||0===U.bitmap.width||0===U.bitmap.height)continue;const H=U.metrics.localGlyph?te:1,G={x:0,y:0,w:U.bitmap.width+2*H,h:U.bitmap.height+2*H};s.push(G),M[F]=G}}const{w:u,h:p}=np(s),y=new Vl({width:u||1,height:p||1});for(const x in e){const D=e[x];for(const M in D.glyphs){const F=D.glyphs[+M];if(!F||0===F.bitmap.width||0===F.bitmap.height)continue;const U=i[x][M],H=F.metrics.localGlyph?te:1;Vl.copy(F.bitmap,y,{x:0,y:0},{x:U.x+H,y:U.y+H},F.bitmap)}}this.image=y,this.positions=i}}Wn(me,"GlyphAtlas");class je{constructor(e){this.tileID=new Ea(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=tu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,s,u,p){this.status="parsing",this.data=e,this.collisionBoxArray=new hr;const y=new ny(Object.keys(e.layers).sort()),x=new v(this.tileID,this.promoteId);x.bucketLayerIDs=[];const D={},M=new V(256,256),F={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:M,availableImages:s},U=i.familiesBySource[this.source];for(const ze in U){const We=e.layers[ze];if(!We)continue;let At=!1,yt=!1;for(const Lt of U[ze])"symbol"===Lt[0].type?At=!0:yt=!0;if(!0===this.isSymbolTile&&!At||!1===this.isSymbolTile&&!yt)continue;1===We.version&&fi(`Vector tile source "${this.source}" layer "${ze}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Wt=y.encode(ze),sn=[];for(let Lt=0;Lt<We.length;Lt++){const nn=We.feature(Lt),rn=x.getId(nn,ze);sn.push({feature:nn,id:rn,index:Lt,sourceLayerIndex:Wt})}for(const Lt of U[ze]){const nn=Lt[0];void 0!==this.isSymbolTile&&"symbol"===nn.type!==this.isSymbolTile||nn.minzoom&&this.zoom<Math.floor(nn.minzoom)||nn.maxzoom&&this.zoom>=nn.maxzoom||"none"!==nn.visibility&&(ot(Lt,this.zoom,s),(D[nn.id]=nn.createBucket({index:x.bucketLayerIDs.length,layers:Lt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(sn,F,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Lt.map(rn=>rn.id)))}}let H,G,Y,oe;M.trim();const de={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ee=()=>{if(H)return p(H);if(G&&Y&&oe){const ze=new me(G),We=new Mu(Y,oe);for(const At in D){const yt=D[At];yt instanceof nu?(ot(yt.layers,this.zoom,s),Jg(yt,G,ze.positions,Y,We.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):yt.hasPattern&&(yt instanceof dm||yt instanceof nd||yt instanceof $d)&&(ot(yt.layers,this.zoom,s),yt.addFeatures(F,this.tileID.canonical,We.patternPositions,s,this.tileTransform))}this.status="done",p(null,{buckets:so(D).filter(At=>!At.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ze.image,lineAtlas:M,imageAtlas:We,glyphMap:this.returnDependencies?G:null,iconMap:this.returnDependencies?Y:null,glyphPositions:this.returnDependencies?ze.positions:null})}},Ne=zn(F.glyphDependencies,ze=>Object.keys(ze).map(Number));Object.keys(Ne).length?u.send("getGlyphs",{uid:this.uid,stacks:Ne},(ze,We)=>{H||(H=ze,G=We,Ee())},void 0,!1,de):G={};const Ce=Object.keys(F.iconDependencies);Ce.length?u.send("getImages",{icons:Ce,source:this.source,tileID:this.tileID,type:"icons"},(ze,We)=>{H||(H=ze,Y=We,Ee())},void 0,!1,de):Y={};const Fe=Object.keys(F.patternDependencies);Fe.length?u.send("getImages",{icons:Fe,source:this.source,tileID:this.tileID,type:"patterns"},(ze,We)=>{H||(H=ze,oe=We,Ee())},void 0,!1,de):oe={},Ee()}}function ot(n,e,i){const s=new z(e);for(const u of n)u.recalculate(s,i)}class Zt{constructor(e){this.entries={},this.scheduler=e}request(e,i,s,u){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[y,x]=p.result;return this.scheduler?this.scheduler.add(()=>{u(y,x)},i):u(y,x),()=>{}}return p.callbacks.push(u),p.cancel||(p.cancel=s((y,x)=>{p.result=[y,x];for(const D of p.callbacks)this.scheduler?this.scheduler.add(()=>{D(y,x)},i):D(y,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(y=>y!==u),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function cn(n,e,i){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},u=>{const p=Hi(n.request,(y,x,D,M)=>{y?u(y):x&&u(null,{vectorTile:i?void 0:new jh(new Xc(x)),rawData:x,cacheControl:D,expires:M})});return()=>{p.cancel(),u()}},e)}const di=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class si{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(219!==i)throw new Error("Data does not appear to be in a KDBush format.");const u=s>>4;if(1!==u)throw new Error(`Got v${u} data when expected v1.`);const p=di[15&s];if(!p)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new si(x,y,p,e)}constructor(e,i=64,s=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=di.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-x%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${s}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+D,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+x+D),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+D,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Un(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:x}=this,D=[0,p.length-1,0],M=[];for(;D.length;){const F=D.pop()||0,U=D.pop()||0,H=D.pop()||0;if(U-H<=x){for(let de=H;de<=U;de++){const Ee=y[2*de],Ne=y[2*de+1];Ee>=e&&Ee<=s&&Ne>=i&&Ne<=u&&M.push(p[de])}continue}const G=H+U>>1,Y=y[2*G],oe=y[2*G+1];Y>=e&&Y<=s&&oe>=i&&oe<=u&&M.push(p[G]),(0===F?e<=Y:i<=oe)&&(D.push(H),D.push(G-1),D.push(1-F)),(0===F?s>=Y:u>=oe)&&(D.push(G+1),D.push(U),D.push(1-F))}return M}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:y}=this,x=[0,u.length-1,0],D=[],M=s*s;for(;x.length;){const F=x.pop()||0,U=x.pop()||0,H=x.pop()||0;if(U-H<=y){for(let de=H;de<=U;de++)qr(p[2*de],p[2*de+1],e,i)<=M&&D.push(u[de]);continue}const G=H+U>>1,Y=p[2*G],oe=p[2*G+1];qr(Y,oe,e,i)<=M&&D.push(u[G]),(0===F?e-s<=Y:i-s<=oe)&&(x.push(H),x.push(G-1),x.push(1-F)),(0===F?e+s>=Y:i+s>=oe)&&(x.push(G+1),x.push(U),x.push(1-F))}return D}}function Un(n,e,i,s,u,p){if(u-s<=i)return;const y=s+u>>1;ei(n,e,y,s,u,p),Un(n,e,i,s,y-1,1-p),Un(n,e,i,y+1,u,1-p)}function ei(n,e,i,s,u,p){for(;u>s;){if(u-s>600){const M=u-s+1,F=i-s+1,U=Math.log(M),H=.5*Math.exp(2*U/3),G=.5*Math.sqrt(U*H*(M-H)/M)*(F-M/2<0?-1:1);ei(n,e,i,Math.max(s,Math.floor(i-F*H/M+G)),Math.min(u,Math.floor(i+(M-F)*H/M+G)),p)}const y=e[2*i+p];let x=s,D=u;for(cr(n,e,s,i),e[2*u+p]>y&&cr(n,e,s,u);x<D;){for(cr(n,e,x,D),x++,D--;e[2*x+p]<y;)x++;for(;e[2*D+p]>y;)D--}e[2*s+p]===y?cr(n,e,s,D):(D++,cr(n,e,D,u)),D<=i&&(s=D+1),i<=D&&(u=D-1)}}function cr(n,e,i,s){vo(n,i,s),vo(e,2*i,2*s),vo(e,2*i+1,2*s+1)}function vo(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}function qr(n,e,i,s){const u=n-i,p=e-s;return u*u+p*p}l.ARRAY_TYPE=Ka,l.AUTH_ERR_MSG=$e,l.Aabb=va,l.Actor=class{constructor(n,e,i){this.target=n,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Vt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=vi()?n:ge,this.scheduler=new ty}send(n,e,i,s,u=!1,p){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=p,this.callbacks[y]=i);const x=Yr(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:n,hasCallback:!!i,targetMapId:s,mustQueue:u,sourceMapId:this.mapId,data:B(e,x)},x),{cancel:()=>{i&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(n){const e=n.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[i];delete this.cancelCallbacks[i],s&&s.cancel()}else if(e.mustQueue||vi()){const s=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),s&&s.metadata||{type:"message"})}else this.processTask(i,e)}processTask(n,e){if("<response>"===e.type){const i=this.callbacks[n];delete this.callbacks[n],i&&(e.error?i($(e.error)):i(null,$(e.data)))}else{const i=Yr(this.globalScope)?void 0:[],s=e.hasCallback?(p,y)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:p?B(p):null,data:B(y,i)},i)}:p=>{},u=$(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,s);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],u.source)[p[1]](u,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.CanonicalTileID=qc,l.Color=Jn,l.ColorMode=$s,l.CullFaceMode=dl,l.DEMData=sh,l.DataConstantProperty=le,l.DedupedRequest=Zt,l.DepthMode=vd,l.EXTENT=pi,l.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,u=Math.floor(n.x),p=Math.floor((n.x-u)*s),y=Math.floor(n.y*s),x=this.findDEMTileFor(new Ea(i,u,i,p,y));return!(!x||!x.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const u=s.getSource().maxzoom,p=1<<u,y=Math.floor(n.x),x=n.x-y,D=new Ea(u,y,u,Math.floor(x*p),Math.floor(n.y*p)),M=this.findDEMTileFor(D);if(!M||!M.dem)return e;const F=M.dem,U=1<<M.tileID.canonical.z,H=(x*U-M.tileID.canonical.x)*F.dim,G=(n.y*U-M.tileID.canonical.y)*F.dim,Y=Math.floor(H),oe=Math.floor(G);return(i?this.exaggeration():1)*Ki(Ki(F.get(Y,oe),F.get(Y,oe+1),G-oe),Ki(F.get(Y+1,oe),F.get(Y+1,oe+1),G-oe),H-Y)}getAtTileOffset(n,e,i){const s=1<<n.canonical.z;return this.getAtPointOrZero(new Cu(n.wrap+(n.canonical.x+e/pi)/s,(n.canonical.y+i/pi)/s))}getAtTileOffsetFunc(n,e,i,s){return u=>{const p=this.getAtTileOffset(n,u.x,u.y),y=s.upVector(n.canonical,u.x,u.y);return al(y,y,p*s.upVectorScale(n.canonical,e,i).metersToTile),y}}getForTilePoints(n,e,i,s){if(this.isUsingMockSource())return!1;const u=h.create(this,n,s);return!!u&&(e.forEach(p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,u=1<<n.canonical.z-s.canonical.z;let p=n.canonical.x/u-s.canonical.x,y=n.canonical.y/u-s.canonical.y,x=0;for(let D=0;D<n.canonical.z-s.canonical.z&&!i.leaves[x];D++){p*=2,y*=2;const M=2*Math.floor(y)+Math.floor(p);x=i.childOffsets[x]+M,p%=1,y%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},l.ErrorEvent=So,l.EvaluationParameters=z,l.Event=Jr,l.Evented=qo,l.FillExtrusionBucket=$d,l.Frustum=$p,l.FrustumCorners=xh,l.GLOBE_RADIUS=_c,l.GLOBE_SCALE_MATCH_LATITUDE=45,l.GLOBE_ZOOM_THRESHOLD_MAX=Gp,l.GLOBE_ZOOM_THRESHOLD_MIN=Hp,l.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_fillGridMeshWithLods(n,e){const i=new pn,s=new Qn,u=[],p=n+1+2,y=e[0]+1,x=e[0]+1+(1+e.length),D=(M,F,U)=>{let H=M===p-1?M-2:0===M?M:M-1;return H+=U?24575:0,[H,F]};for(let M=0;M<p;++M)i.emplaceBack(...D(M,0,!0));for(let M=0;M<y;++M)for(let F=0;F<p;++F)i.emplaceBack(...D(F,M,(0===F||F===p-1)&&!0));for(let M=0;M<e.length;++M){const F=e[M];for(let U=0;U<p;++U)i.emplaceBack(...D(U,F,!0))}for(let M=0;M<e.length;++M){const F=s.length,U=e[M]+1+2,H=new Qn;for(let oe=0;oe<U-1;oe++){const de=oe===U-2,Ee=de?p*(x-e.length+M-oe):p;for(let Ne=0;Ne<p-1;Ne++){const Ce=oe*p+Ne;0===oe||de||0===Ne||Ne===p-2?(H.emplaceBack(Ce+1,Ce,Ce+Ee),H.emplaceBack(Ce+Ee,Ce+Ee+1,Ce+1)):(s.emplaceBack(Ce+1,Ce,Ce+Ee),s.emplaceBack(Ce+Ee,Ce+Ee+1,Ce+1))}}const G=Qo.simpleSegment(0,F,i.length,s.length-F);for(let oe=0;oe<H.uint16.length;oe+=3)s.emplaceBack(H.uint16[oe],H.uint16[oe+1],H.uint16[oe+2]);const Y=Qo.simpleSegment(0,F,i.length,s.length-F);u.push({withoutSkirts:G,withSkirts:Y})}return{vertices:i,indices:s,segments:u}}_createGrid(n){const e=this._fillGridMeshWithLods(64,Zu);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,bh.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new Qn;for(let u=0;u<=64;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new $r,s=new $r;this._poleSegments=[];for(let u=0,p=0;u<Hp;u++){const y=360/(1<<u);i.emplaceBack(0,-_c,0,.5,0),s.emplaceBack(0,-_c,0,.5,1);for(let x=0;x<=64;x++){const D=x/64,M=Ki(0,y,D),[F,U,H]=bu(Xu,es,M,_c);i.emplaceBack(F,U,H,D,0),s.emplaceBack(F,U,H,D,1)}this._poleSegments.push(Qo.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,lg,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,lg,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const i=new Wo,s=64,u=s+1+2,p=1;this._wireframeSegments=[];for(let y=0,x=0;y<Zu.length;y++){const D=Zu[y];for(let F=p;F<D+p;F++)for(let U=p;U<s+p;U++){const H=F*u+U;i.emplaceBack(H,H+1),i.emplaceBack(H,H+u),i.emplaceBack(H,H+u+1)}const M=D*s*3;this._wireframeSegments.push(Qo.simpleSegment(0,x,(D+1)*u,M)),x+=M}this._wireframeIndexBuffer=n.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},l.GlyphManager=Qc,l.ImagePosition=Yd,l.KDBush=si,l.LivePerformanceUtils=Ft,l.LngLat=Xr,l.LngLatBounds=Fl,l.LocalGlyphMode=Im,l.MAX_MERCATOR_LATITUDE=js,l.MercatorCoordinate=Cu,l.ONE_EM=Es,l.OverscaledTileID=Ea,l.PerformanceMarkers=Be,l.Point=Ze,l.Properties=Pe,l.RGBAImage=wa,l.Ray=If,l.RequestManager=class{constructor(n,e,i){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",dn,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!it(n))return n;const i=fn(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!it(n))return n;const i=fn(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(n,e,i,s){if(!it(n))return n;const u=fn(n);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),i&&u.params.push(`language=${i}`),s&&u.params.push(`worldview=${s}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(n,e,i,s){const u=fn(n);return it(n)?(u.path=`/styles/v1${u.path}/sprite${e}${i}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${e}${i}`,qe(u))}normalizeTileURL(n,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!it(n))return n;const s=fn(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==s.authority&&512===i?"@2x":""}${Ge.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${Ye.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Ye.TILE_URL_VERSION}${s.path}`);const u=this._customAccessToken||function(p){for(const y of p){const x=y.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(s.params)||Ye.ACCESS_TOKEN;return Ye.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(n,e){const i=fn(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${Ye.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${Ye.TILE_URL_VERSION}/`,"")}`;let u=i.params;return e&&(u=u.filter(p=>!p.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(n,e){const i=!!e&&it(e),s=[];for(const u of n.tiles||[])vt(u)?s.push(this.canonicalizeTileURL(u,i)):s.push(u);return s}_makeAPIURL(n,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=fn(Ye.API_URL);if(n.protocol=s.protocol,n.authority=s.authority,"http"===n.protocol){const u=n.params.indexOf("secure");u>=0&&n.params.splice(u,1)}if("/"!==s.path&&(n.path=`${s.path}${n.path}`),!Ye.REQUIRE_ACCESS_TOKEN)return qe(n);if(e=e||Ye.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(u=>-1===u.indexOf("access_token")),n.params.push(`access_token=${e||""}`),qe(n)}},l.ResourceType=Si,l.SegmentVector=Qo,l.SourceCache=bd,l.StencilMode=ah,l.StructArrayLayout1ui2=ya,l.StructArrayLayout2f1f2i16=wi,l.StructArrayLayout2i4=pn,l.StructArrayLayout2ui4=Wo,l.StructArrayLayout3f12=er,l.StructArrayLayout3ui6=Qn,l.StructArrayLayout4i8=Qt,l.StructArrayLayout5f20=$r,l.Texture=ca,l.Tile=Fm,l.Transitionable=ae,l.Uniform1f=mu,l.Uniform1i=class extends Cl{constructor(n){super(n),this.current=0}set(n,e,i){this.fetchUniformLocation(n,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},l.Uniform2f=class extends Cl{constructor(n){super(n),this.current=[0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},l.Uniform3f=class extends Cl{constructor(n){super(n),this.current=[0,0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},l.Uniform4f=Qm,l.UniformColor=T_,l.UniformMatrix2f=class extends Cl{constructor(n){super(n),this.current=sl}set(n,e,i){if(this.fetchUniformLocation(n,e))for(let s=0;s<4;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},l.UniformMatrix3f=class extends Cl{constructor(n){super(n),this.current=Cy}set(n,e,i){if(this.fetchUniformLocation(n,e))for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},l.UniformMatrix4f=class extends Cl{constructor(n){super(n),this.current=M_}set(n,e,i){if(this.fetchUniformLocation(n,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let s=1;s<16;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},l.UnwrappedTileID=qf,l.ValidationError=Fn,l.VectorTileFeature=jd,l.VectorTileWorkerSource=class extends qo{constructor(n,e,i,s,u){super(),this.actor=n,this.layerIndex=e,this.availableImages=i,this.loadVectorData=u||cn,this.loading={},this.loaded={},this.deduped=new Zt(n.scheduler),this.isSpriteLoaded=s,this.scheduler=n.scheduler}loadTile(n,e){const i=n.uid,s=n&&n.request,u=s&&s.collectResourceTiming,p=this.loading[i]=new je(n);p.abort=this.loadVectorData(n,(y,x)=>{const D=!this.loading[i];if(delete this.loading[i],D||y||!x)return p.status="done",D||(this.loaded[i]=p),e(y);const M=x.rawData,F={};x.expires&&(F.expires=x.expires),x.cacheControl&&(F.cacheControl=x.cacheControl),p.vectorTile=x.vectorTile||new jh(new Xc(M));const U=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(H,G)=>{if(H||!G)return e(H);const Y={};if(u){const oe=wn(s);oe.length>0&&(Y.resourceTiming=JSON.parse(JSON.stringify(oe)))}e(null,_t({rawTileData:M.slice(0)},G,F,Y))})};this.isSpriteLoaded?U():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(U,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):U()}),this.loaded=this.loaded||{},this.loaded[i]=p})}reloadTile(n,e){const i=this.loaded,s=n.uid,u=this;if(i&&i[s]){const p=i[s];p.showCollisionBoxes=n.showCollisionBoxes,p.enableTerrain=!!n.enableTerrain,p.projection=n.projection,p.tileTransform=tu(n.tileID.canonical,n.projection);const y=(x,D)=>{const M=p.reloadCallback;M&&(delete p.reloadCallback,p.parse(p.vectorTile,u.layerIndex,this.availableImages,u.actor,M)),e(x,D)};"parsing"===p.status?p.reloadCallback=y:"done"===p.status&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(n,e){const i=n.uid,s=this.loading[i];s&&(s.abort&&s.abort(),delete this.loading[i]),e()}removeTile(n,e){const i=this.loaded,s=n.uid;i&&i[s]&&delete i[s],e()}},l.WritingMode=Xa,l.ZoomDependentExpression=Ys,l.add=gc,l.addDynamicAttributes=Pu,l.adjoint=function(n,e){var i=e[0],s=e[1],u=e[2],p=e[3],y=e[4],x=e[5],D=e[6],M=e[7],F=e[8];return n[0]=y*F-x*M,n[1]=u*M-s*F,n[2]=s*x-u*y,n[3]=x*D-p*F,n[4]=i*F-u*D,n[5]=u*p-i*x,n[6]=p*M-y*D,n[7]=s*D-i*M,n[8]=i*y-s*p,n},l.asyncAll=ji,l.bezier=Li,l.bindAll=Vt,l.boundsAttributes=r_,l.bufferConvexPolygon=function(n,e){const i=[];for(let s=0;s<n.length;s++){const u=Oi(s-1,-1,n.length-1),p=Oi(s+1,-1,n.length-1),y=n[s],x=n[p],D=n[u].sub(y).unit(),M=x.sub(y).unit(),F=M.angleWithSep(D.x,D.y),U=D.add(M).unit().mult(-1*e/Math.sin(F/2));i.push(y.add(U))}return i},l.cacheEntryPossiblyAdded=function(n){Gi++,Gi>ii&&(n.getActor().send("enforceCacheSizeLimit",To),Gi=0)},l.calculateGlobeLabelMatrix=function(n,e){const{x:i,y:s}=n.point,u=Rf(i,s,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Md(u,u,Pf(zl(e)))},l.calculateGlobeMatrix=function(n){const{x:e,y:i}=n.point,{lng:s,lat:u}=n._center;return Rf(e,i,n.worldSize,s,u)},l.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,i=e/xa(1,n.center.lat),s=La(new Float64Array(16));return Sd(s,s,[n.point.x,n.point.y,0]),Hu(s,s,[i,i,e]),Float32Array.from(s)},l.circumferenceAtLatitude=kf,l.clamp=hi,l.clearTileCache=function(n){if(!Er())return;const e=ge.caches.delete(bo);n&&e.catch(n).then(()=>n())},l.clipLine=X_,l.clone=function(n){var e=new Ka(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},l.clone$1=Ln,l.collisionCircleLayout=pm,l.config=Ye,l.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},l.create=function(){var n=new Ka(16);return Ka!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},l.create$1=eg,l.createExpression=vs,l.createLayout=st,l.createStyleLayer=function(n){return"custom"===n.type?new km(n):new xp[n.type](n)},l.cross=ag,l.degToRad=qt,l.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},l.div=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},l.dot=Nl,l.earthRadius=Eu,l.ease=Mr,l.easeCubicInOut=Ei,l.ecefToLatLng=function([n,e,i]){const s=Math.hypot(n,e,i),u=Math.atan2(n,i),p=.5*Math.PI-Math.acos(-e/s);return new Xr(vn(u),vn(p))},l.emitValidationErrors=hu,l.endsWith=Gt,l.enforceCacheSizeLimit=function(n){fo(),gi&&gi.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-n;s++)e.delete(i[s])})})},l.evaluateSizeForFeature=Kc,l.evaluateSizeForZoom=Tu,l.evaluateVariableOffset=nh,l.evented=b,l.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},l.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},l.exported=dr,l.exported$1=Ge,l.extend=_t,l.extend$1=Xi,l.fillExtrusionHeightLift=rd,l.filterObject=Yn,l.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},l.fromQuat=function(n,e){var i=e[0],s=e[1],u=e[2],p=e[3],y=i+i,x=s+s,D=u+u,M=i*y,F=s*y,U=s*x,H=u*y,G=u*x,Y=u*D,oe=p*y,de=p*x,Ee=p*D;return n[0]=1-U-Y,n[1]=F+Ee,n[2]=H-de,n[3]=0,n[4]=F-Ee,n[5]=1-M-Y,n[6]=G+oe,n[7]=0,n[8]=H+de,n[9]=G-oe,n[10]=1-M-U,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},l.fromRotation=function(n,e){var i=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=i,n[2]=0,n[3]=-i,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},l.fromScaling=ng,l.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return Ti[e]},l.getAABBPointSquareDist=function(n,e,i){let s=0;for(let u=0;u<2;++u){const p=i?i[u]:0;n[u]>p&&(s+=(n[u]-p)*(n[u]-p)),e[u]<p&&(s+=(p-e[u])*(p-e[u]))}return s},l.getAnchorAlignment=Dm,l.getAnchorJustification=Qg,l.getBounds=function(n){let e=1/0,i=1/0,s=-1/0,u=-1/0;for(const p of n)e=Math.min(e,p.x),i=Math.min(i,p.y),s=Math.max(s,p.x),u=Math.max(u,p.y);return{min:new Ze(e,i),max:new Ze(s,u)}},l.getColumn=wr,l.getDefaultExportFromCjs=St,l.getGridMatrix=function(n,e,i,s){const u=e.getNorth(),p=e.getSouth(),y=e.getWest(),x=e.getEast(),D=1<<n.z,M=x-y,F=u-p,U=M/64,H=-F/Zu[i],G=[0,U,0,H,0,0,u,y,0];if(n.z>0){const Y=180/s;$u(G,G,[Y/M+1,0,0,0,Y/F+1,0,-.5*Y/U,.5*Y/H,1])}return G[2]=D,G[5]=n.x,G[8]=n.y,G},l.getImage=Se,l.getJSON=function(n,e){return xo(_t(n,{type:"json"}),e)},l.getLatitudinalLod=function(n){const e=js-5;n=hi(n,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(qt(n))),3);return Math.round(i*(Zu.length-1))},l.getMapSessionAPI=ur,l.getPerformanceMeasurement=wn,l.getProjection=mp,l.getRTLTextPluginStatus=C,l.getReferrer=nr,l.getTilePoint=function(n,{x:e,y:i},s=0){return new Ze(((e-s)*n.scale-n.x)*pi,(i*n.scale-n.y)*pi)},l.getTileVec3=function(n,e,i=0){return _h(((e.x-i)*n.scale-n.x)*pi,(e.y*n.scale-n.y)*pi,Uc(e.z,e.y))},l.getVideo=function(n,e){const i=ge.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<n.length;s++){const u=ge.document.createElement("source");Uo(n[s])||(i.crossOrigin="Anonymous"),u.src=n[s],i.appendChild(u)}return{cancel:()=>{}}},l.globeCenterToScreenPoint=function(n){const e=[0,0,0],i=La(new Float64Array(16));return Md(i,n.pixelMatrix,n.globeMatrix),os(e,e,i),new Ze(e[0],e[1])},l.globeDenormalizeECEF=Pf,l.globeECEFOrigin=function(n,e){const i=[0,0,0];return os(i,i,Eh(zl(e.canonical))),os(i,i,n),i},l.globeMetersToEcef=vu,l.globeNormalizeECEF=Eh,l.globePixelsToTileUnits=function(n,e){return pi/(512*Math.pow(2,n))*wu(zl(e))},l.globePoleMatrixForTile=function(n,e,i){const s=La(new Float64Array(16)),u=(e/(1<<n)-.5)*Math.PI*2;return bf(s,i.globeMatrix,u),Float32Array.from(s)},l.globeTileBounds=zl,l.globeTiltAtLngLat=Yu,l.globeToMercatorTransition=Ku,l.globeUseCustomAntiAliasing=function(n,e,i){const s=Ku(i.zoom),u=n.style.map._antialias,p=!!e.extStandardDerivatives,y=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===s&&!u&&!y&&p},l.identity=La,l.identity$1=Vp,l.invert=Bp,l.isFullscreen=function(){return!!ge.document.fullscreenElement||!!ge.document.webkitFullscreenElement},l.isLngLatBehindGlobe=Ad,l.isMapAuthenticated=function(n){return lt.has(n)},l.isMapboxURL=it,l.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!Yr(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},l.latFromMercatorY=hs,l.latLngToECEF=xu,l.len=Tf,l.length=Id,l.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},l.lngFromMercatorX=Fa,l.loadVectorTile=cn,l.makeRequest=xo,l.mapValue=function(n,e,i,s,u){return hi((n-e)/(i-e)*(u-s)+s,s,u)},l.mercatorScale=Ch,l.mercatorXfromLng=Ul,l.mercatorYfromLat=Dl,l.mercatorZfromAltitude=xa,l.mul=xf,l.mul$1=Df,l.multiply=Md,l.multiply$1=$u,l.multiply$2=sg,l.nextPowerOfTwo=bn,l.normalize=Qs,l.normalize$1=Mf,l.normalize$2=Up,l.number=Ki,l.ortho=function(n,e,i,s,u,p,y){var x=1/(e-i),D=1/(s-u),M=1/(p-y);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*D,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*M,n[11]=0,n[12]=(e+i)*x,n[13]=(u+s)*D,n[14]=(y+p)*M,n[15]=1,n},l.pbf=Vg,l.perspective=function(n,e,i,s,u){var p,y=1/Math.tan(e/2);return n[0]=y/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=u&&u!==1/0?(n[10]=(u+s)*(p=1/(s-u)),n[14]=2*u*s*p):(n[10]=-1,n[14]=-2*s),n},l.pick=function(n,e){const i={};for(let s=0;s<e.length;s++){const u=e[s];u in n&&(i[u]=n[u])}return i},l.plugin=R,l.pointGeometry=Dn,l.polesInViewport=function(n){const e=La(new Float64Array(16));Md(e,n.pixelMatrix,n.globeMatrix);const i=[0,ll,0],s=[0,Ya,0];return os(i,i,e),os(s,s,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!Ad(n,new Xr(n.center.lat,90)),s[0]>0&&s[0]<=n.width&&s[1]>0&&s[1]<=n.height&&!Ad(n,new Xr(n.center.lat,-90))]},l.polygonContainsPoint=jc,l.polygonIntersectsBox=em,l.polygonIntersectsPolygon=Sh,l.polygonizeBounds=function(n,e,i=0,s=!0){const u=new Ze(i,i),p=n.sub(u),y=e.add(u),x=[p,new Ze(y.x,p.y),y,new Ze(p.x,y.y)];return s&&x.push(p.clone()),x},l.posAttributes=bh,l.postMapLoadEvent=Gn,l.postPerformanceEvent=_i,l.postTurnstileEvent=Ut,l.potpack=np,l.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},l.radToDeg=vn,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.registerForPluginStateChange=function(n){return n({pluginStatus:f,pluginURL:r}),b.on("pluginStateChange",n),n},l.removeAuthState=function(n){lt.delete(n)},l.renderColorRamp=Nf,l.resample=Dh,l.rotateX=tg,l.rotateX$1=jp,l.rotateY=bf,l.rotateY$1=vh,l.rotateZ=function(n,e,i){var s=Math.sin(i),u=Math.cos(i),p=e[0],y=e[1],x=e[2],D=e[3],M=e[4],F=e[5],U=e[6],H=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*u+M*s,n[1]=y*u+F*s,n[2]=x*u+U*s,n[3]=D*u+H*s,n[4]=M*u-p*s,n[5]=F*u-y*s,n[6]=U*u-x*s,n[7]=H*u-D*s,n},l.rotateZ$1=function(n,e,i){i*=.5;var s=e[0],u=e[1],p=e[2],y=e[3],x=Math.sin(i),D=Math.cos(i);return n[0]=s*D+u*x,n[1]=u*D-s*x,n[2]=p*D+y*x,n[3]=y*D-p*x,n},l.scale=Hu,l.scale$1=zp,l.scale$2=al,l.scaleAndAdd=Ef,l.set=function(n,e,i,s){return n[0]=e,n[1]=i,n[2]=s,n},l.setCacheLimits=function(n,e){To=n,ii=e},l.setColumn=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},l.setRTLTextPlugin=function(n,e,i=!1){if(f===Rr||f===Tr||f===xs)throw new Error("setRTLTextPlugin cannot be called multiple times.");r=dr.resolveURL(n),f=Rr,Js=e,m(),i||P()},l.smoothstep=mr,l.spec=xt,l.squaredLength=function(n){var e=n[0],i=n[1],s=n[2];return e*e+i*i+s*s},l.storeAuthState=function(n,e){e?lt.add(n):lt.delete(n)},l.sub=Bl,l.subtract=og,l.symbolSize=mm,l.tileAABB=function(n,e,i,s,u,p,y,x,D){if("globe"===D.name)return function hg(n,e,i){const s=e/n.worldSize,u=n.globeMatrix;if(i.z<=1){const yt=zl(i).getCorners();return dg(yt,u,s),va.fromPoints(yt)}const p=Af(i),y=Kp(p);dg(y,u,s);const x=Number.MAX_VALUE,D=[-x,-x,-x],M=[x,x,x];if(p.contains(n.center)){for(const sn of y)yh(M,M,sn),Gu(D,D,sn);D[2]=0;const yt=n.point,Wt=[yt.x*s,yt.y*s,0];return yh(M,M,Wt),Gu(D,D,Wt),new va(M,D)}const F=[u[12]*s,u[13]*s,u[14]*s],U=p.getCenter(),H=hi(n.center.lat,-js,js),G=hi(U.lat,-js,js),Y=Ul(n.center.lng),oe=Dl(H);let de=Y-Ul(U.lng);const Ee=oe-Dl(G);de>.5?de-=1:de<-.5&&(de+=1);let Ne=0;Math.abs(de)>Math.abs(Ee)?Ne=de>=0?1:3:(Ne=Ee>=0?0:2,Ef(F,F,[u[4]*s,u[5]*s,u[6]*s],-Math.sin(qt(Ee>=0?p.getSouth():p.getNorth()))*_c));const Ce=y[Ne],Fe=y[(Ne+1)%4],ze=new ug(Ce,Fe,F),We=[Zp(ze,0)||Ce[0],Zp(ze,1)||Ce[1],Zp(ze,2)||Ce[2]],At=Ku(n.zoom);if(At>0){const yt=function({x:sn,y:Lt,z:nn},rn,gn,xn,Ht){const On=1/(1<<nn);let Zn=sn*On,jn=Zn+On,Di=Lt*On,In=Di+On,li=0;const Fi=(Zn+jn)/2-xn;return Fi>.5?li=-1:Fi<-.5&&(li=1),Zn=((Zn+li)*rn-(xn*=rn))*gn+xn,jn=((jn+li)*rn-xn)*gn+xn,Di=(Di*rn-(Ht*=rn))*gn+Ht,In=(In*rn-Ht)*gn+Ht,[[Zn,In,0],[jn,In,0],[jn,Di,0],[Zn,Di,0]]}(i,e,n._pixelsPerMercatorPixel,Y,oe);for(let sn=0;sn<y.length;sn++)qu(y[sn],yt[sn],At);const Wt=gc([],yt[Ne],yt[(Ne+1)%4]);al(Wt,Wt,.5),qu(We,Wt,At)}for(const yt of y)yh(M,M,yt),Gu(D,D,yt);return M[2]=Math.min(Ce[2],Fe[2]),yh(M,M,We),Gu(D,D,We),new va(M,D)}(n,e,new qc(i,s,u));const M=tu({z:i,x:s,y:u},D);return new va([(p+M.x/M.scale)*e,e*(M.y/M.scale),y],[(p+M.x2/M.scale)*e,e*(M.y2/M.scale),x])},l.tileCornersToBounds=Af,l.tileTransform=tu,l.transformMat3=function(n,e,i){var s=e[0],u=e[1],p=e[2];return n[0]=s*i[0]+u*i[3]+p*i[6],n[1]=s*i[1]+u*i[4]+p*i[7],n[2]=s*i[2]+u*i[5]+p*i[8],n},l.transformMat4=os,l.transformMat4$1=yu,l.transformQuat=P_,l.transitionTileAABBinECEF=qp,l.translate=Sd,l.transpose=function(n,e){if(n===e){var i=e[1],s=e[2],u=e[5];n[1]=e[3],n[2]=e[6],n[3]=i,n[5]=e[7],n[6]=s,n[7]=u}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},l.triggerPluginCompletionEvent=c,l.uniqueId=Yt,l.updateGlobeVertexNormal=function(n,e,i,s,u){const p=5*e+2;n.float32[p+0]=i,n.float32[p+1]=s,n.float32[p+2]=u},l.validateCustomStyleLayer=function(n){const e=[],i=n.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===n.render&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},l.validateFilter=n=>Xs(ga(n)),l.validateFog=n=>Xs(kc(n)),l.validateLayer=n=>Xs(Oc(n)),l.validateLight=n=>Xs(Rl(n)),l.validateSource=n=>Xs(qa(n)),l.validateStyle=dc,l.validateTerrain=n=>Xs(_a(n)),l.values=so,l.vectorTile=jf,l.version=Ke,l.warnOnce=fi,l.window=ge,l.wrap=Oi}),Re(0,function(l){function ge(Le){if("number"==typeof Le||"boolean"==typeof Le||"string"==typeof Le||null==Le)return JSON.stringify(Le);if(Array.isArray(Le)){let ue="[";for(const Se of Le)ue+=`${ge(Se)},`;return`${ue}]`}let ce="{";for(const ue of Object.keys(Le).sort())ce+=`${ue}:${ge(Le[ue])},`;return`${ce}}`}function Ke(Le){let ce="";for(const ue of l.refProperties)ce+=`/${ge(Le[ue])}`;return ce}class nt{constructor(ce){this.keyCache={},ce&&this.replace(ce)}replace(ce){this._layerConfigs={},this._layers={},this.update(ce,[])}update(ce,ue){for(const $e of ce)this._layerConfigs[$e.id]=$e,(this._layers[$e.id]=l.createStyleLayer($e)).compileFilter(),this.keyCache[$e.id]&&delete this.keyCache[$e.id];for(const $e of ue)delete this.keyCache[$e],delete this._layerConfigs[$e],delete this._layers[$e];this.familiesBySource={};const Se=function($e,it){const vt={};for(let Je=0;Je<$e.length;Je++){const wt=it&&it[$e[Je].id]||Ke($e[Je]);it&&(it[$e[Je].id]=wt);let an=vt[wt];an||(an=vt[wt]=[]),an.push($e[Je])}const ct=[];for(const Je in vt)ct.push(vt[Je]);return ct}(l.values(this._layerConfigs),this.keyCache);for(const $e of Se){const it=$e.map(fn=>this._layers[fn.id]),vt=it[0];if("none"===vt.visibility)continue;const ct=vt.source||"";let Je=this.familiesBySource[ct];Je||(Je=this.familiesBySource[ct]={});const wt=vt.sourceLayer||"_geojsonTileLayer";let an=Je[wt];an||(an=Je[wt]=[]),an.push(it)}}}class Ye{loadTile(ce,ue){const{uid:Se,encoding:$e,rawImageData:it,padding:vt,buildQuadTree:ct}=ce,Je=l.window.ImageBitmap&&it instanceof l.window.ImageBitmap?this.getImageData(it,vt):it;ue(null,new l.DEMData(Se,Je,$e,vt<1,ct))}getImageData(ce,ue){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ce.width,ce.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ce.width,this.offscreenCanvas.height=ce.height,this.offscreenCanvasContext.drawImage(ce,0,0,ce.width,ce.height);const Se=this.offscreenCanvasContext.getImageData(-ue,-ue,ce.width+2*ue,ce.height+2*ue);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Se}}function Ge(Le,ce){if(0!==Le.length){Xe(Le[0],ce);for(var ue=1;ue<Le.length;ue++)Xe(Le[ue],!ce)}}function Xe(Le,ce){for(var ue=0,Se=0,$e=0,it=Le.length,vt=it-1;$e<it;vt=$e++){var ct=(Le[$e][0]-Le[vt][0])*(Le[vt][1]+Le[$e][1]),Je=ue+ct;Se+=Math.abs(ue)>=Math.abs(ct)?ue-Je+ct:ct-Je+ue,ue=Je}ue+Se>=0!=!!ce&&Le.reverse()}var at=l.getDefaultExportFromCjs(function Le(ce,ue){var Se,$e=ce&&ce.type;if("FeatureCollection"===$e)for(Se=0;Se<ce.features.length;Se++)Le(ce.features[Se],ue);else if("GeometryCollection"===$e)for(Se=0;Se<ce.geometries.length;Se++)Le(ce.geometries[Se],ue);else if("Feature"===$e)Le(ce.geometry,ue);else if("Polygon"===$e)Ge(ce.coordinates,ue);else if("MultiPolygon"===$e)for(Se=0;Se<ce.coordinates.length;Se++)Ge(ce.coordinates[Se],ue);return ce});const ht=l.VectorTileFeature.prototype.toGeoJSON;var Bt={exports:{}},zt=l.pointGeometry,dn=l.vectorTile.VectorTileFeature,St=Bn;function Bn(Le,ce){this.options=ce||{},this.features=Le,this.length=Le.length}function Tn(Le,ce){this.id="number"==typeof Le.id?Le.id:void 0,this.type=Le.type,this.rawGeometry=1===Le.type?[Le.geometry]:Le.geometry,this.properties=Le.tags,this.extent=ce||4096}Bn.prototype.feature=function(Le){return new Tn(this.features[Le],this.options.extent)},Tn.prototype.loadGeometry=function(){var Le=this.rawGeometry;this.geometry=[];for(var ce=0;ce<Le.length;ce++){for(var ue=Le[ce],Se=[],$e=0;$e<ue.length;$e++)Se.push(new zt(ue[$e][0],ue[$e][1]));this.geometry.push(Se)}return this.geometry},Tn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Le=this.geometry,ce=1/0,ue=-1/0,Se=1/0,$e=-1/0,it=0;it<Le.length;it++)for(var vt=Le[it],ct=0;ct<vt.length;ct++){var Je=vt[ct];ce=Math.min(ce,Je.x),ue=Math.max(ue,Je.x),Se=Math.min(Se,Je.y),$e=Math.max($e,Je.y)}return[ce,Se,ue,$e]},Tn.prototype.toGeoJSON=dn.prototype.toGeoJSON;var kn=l.pbf,Dn=St;function ft(Le){var ce=new kn;return function(ue,Se){for(var $e in ue.layers)Se.writeMessage(3,Ze,ue.layers[$e])}(Le,ce),ce.finish()}function Ze(Le,ce){var ue;ce.writeVarintField(15,Le.version||1),ce.writeStringField(1,Le.name||""),ce.writeVarintField(5,Le.extent||4096);var Se={keys:[],values:[],keycache:{},valuecache:{}};for(ue=0;ue<Le.length;ue++)Se.feature=Le.feature(ue),ce.writeMessage(2,Xt,Se);var $e=Se.keys;for(ue=0;ue<$e.length;ue++)ce.writeStringField(3,$e[ue]);var it=Se.values;for(ue=0;ue<it.length;ue++)ce.writeMessage(4,Ei,it[ue])}function Xt(Le,ce){var ue=Le.feature;void 0!==ue.id&&ce.writeVarintField(1,ue.id),ce.writeMessage(2,Pt,Le),ce.writeVarintField(3,ue.type),ce.writeMessage(4,Ti,ue)}function Pt(Le,ce){var ue=Le.feature,Se=Le.keys,$e=Le.values,it=Le.keycache,vt=Le.valuecache;for(var ct in ue.properties){var Je=ue.properties[ct],wt=it[ct];if(null!==Je){void 0===wt&&(Se.push(ct),it[ct]=wt=Se.length-1),ce.writeVarint(wt);var an=typeof Je;"string"!==an&&"boolean"!==an&&"number"!==an&&(Je=JSON.stringify(Je));var fn=an+":"+Je,qe=vt[fn];void 0===qe&&($e.push(Je),vt[fn]=qe=$e.length-1),ce.writeVarint(qe)}}}function qt(Le,ce){return(ce<<3)+(7&Le)}function vn(Le){return Le<<1^Le>>31}function Ti(Le,ce){for(var ue=Le.loadGeometry(),Se=Le.type,$e=0,it=0,vt=ue.length,ct=0;ct<vt;ct++){var Je=ue[ct],wt=1;1===Se&&(wt=Je.length),ce.writeVarint(qt(1,wt));for(var an=3===Se?Je.length-1:Je.length,fn=0;fn<an;fn++){1===fn&&1!==Se&&ce.writeVarint(qt(2,an-1));var qe=Je[fn].x-$e,He=Je[fn].y-it;ce.writeVarint(vn(qe)),ce.writeVarint(vn(He)),$e+=qe,it+=He}3===Se&&ce.writeVarint(qt(7,1))}}function Ei(Le,ce){var ue=typeof Le;"string"===ue?ce.writeStringField(1,Le):"boolean"===ue?ce.writeBooleanField(7,Le):"number"===ue&&(Le%1!=0?ce.writeDoubleField(3,Le):Le<0?ce.writeSVarintField(6,Le):ce.writeVarintField(5,Le))}Bt.exports=ft,Bt.exports.fromVectorTileJs=ft,Bt.exports.fromGeojsonVt=function(Le,ce){ce=ce||{};var ue={};for(var Se in Le)ue[Se]=new Dn(Le[Se].features,ce),ue[Se].name=Se,ue[Se].version=ce.version,ue[Se].extent=ce.extent;return ft({layers:ue})},Bt.exports.GeoJSONWrapper=Dn;var Li=l.getDefaultExportFromCjs(Bt.exports);const Mr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Le=>Le},hi=Math.fround||(mr=new Float32Array(1),Le=>(mr[0]=+Le,mr[0]));var mr;const Oi=3,ji=5,so=6;class _t{constructor(ce){this.options=Object.assign(Object.create(Mr),ce),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ce){const{log:ue,minZoom:Se,maxZoom:$e}=this.options;ue&&console.time("total time");const it=`prepare ${ce.length} points`;ue&&console.time(it),this.points=ce;const vt=[];for(let Je=0;Je<ce.length;Je++){const wt=ce[Je];if(!wt.geometry)continue;const[an,fn]=wt.geometry.coordinates,qe=hi(Kt(an)),He=hi(bn(fn));vt.push(qe,He,1/0,Je,-1,1),this.options.reduce&&vt.push(0)}let ct=this.trees[$e+1]=this._createTree(vt);ue&&console.timeEnd(it);for(let Je=$e;Je>=Se;Je--){const wt=+Date.now();ct=this.trees[Je]=this._createTree(this._cluster(ct,Je)),ue&&console.log("z%d: %d clusters in %dms",Je,ct.numItems,+Date.now()-wt)}return ue&&console.timeEnd("total time"),this}getClusters(ce,ue){let Se=((ce[0]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,ce[1]));let it=180===ce[2]?180:((ce[2]+180)%360+360)%360-180;const vt=Math.max(-90,Math.min(90,ce[3]));if(ce[2]-ce[0]>=360)Se=-180,it=180;else if(Se>it){const fn=this.getClusters([Se,$e,180,vt],ue),qe=this.getClusters([-180,$e,it,vt],ue);return fn.concat(qe)}const ct=this.trees[this._limitZoom(ue)],Je=ct.range(Kt(Se),bn(vt),Kt(it),bn($e)),wt=ct.data,an=[];for(const fn of Je){const qe=this.stride*fn;an.push(wt[qe+ji]>1?Nt(wt,qe,this.clusterProps):this.points[wt[qe+Oi]])}return an}getChildren(ce){const ue=this._getOriginId(ce),Se=this._getOriginZoom(ce),$e="No cluster with the specified id.",it=this.trees[Se];if(!it)throw new Error($e);const vt=it.data;if(ue*this.stride>=vt.length)throw new Error($e);const ct=this.options.radius/(this.options.extent*Math.pow(2,Se-1)),Je=it.within(vt[ue*this.stride],vt[ue*this.stride+1],ct),wt=[];for(const an of Je){const fn=an*this.stride;vt[fn+4]===ce&&wt.push(vt[fn+ji]>1?Nt(vt,fn,this.clusterProps):this.points[vt[fn+Oi]])}if(0===wt.length)throw new Error($e);return wt}getLeaves(ce,ue,Se){const $e=[];return this._appendLeaves($e,ce,ue=ue||10,Se=Se||0,0),$e}getTile(ce,ue,Se){const $e=this.trees[this._limitZoom(ce)],it=Math.pow(2,ce),{extent:vt,radius:ct}=this.options,Je=ct/vt,wt=(Se-Je)/it,an=(Se+1+Je)/it,fn={features:[]};return this._addTileFeatures($e.range((ue-Je)/it,wt,(ue+1+Je)/it,an),$e.data,ue,Se,it,fn),0===ue&&this._addTileFeatures($e.range(1-Je/it,wt,1,an),$e.data,it,Se,it,fn),ue===it-1&&this._addTileFeatures($e.range(0,wt,Je/it,an),$e.data,-1,Se,it,fn),fn.features.length?fn:null}getClusterExpansionZoom(ce){let ue=this._getOriginZoom(ce)-1;for(;ue<=this.options.maxZoom;){const Se=this.getChildren(ce);if(ue++,1!==Se.length)break;ce=Se[0].properties.cluster_id}return ue}_appendLeaves(ce,ue,Se,$e,it){const vt=this.getChildren(ue);for(const ct of vt){const Je=ct.properties;if(Je&&Je.cluster?it+Je.point_count<=$e?it+=Je.point_count:it=this._appendLeaves(ce,Je.cluster_id,Se,$e,it):it<$e?it++:ce.push(ct),ce.length===Se)break}return it}_createTree(ce){const ue=new l.KDBush(ce.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Se=0;Se<ce.length;Se+=this.stride)ue.add(ce[Se],ce[Se+1]);return ue.finish(),ue.data=ce,ue}_addTileFeatures(ce,ue,Se,$e,it,vt){for(const ct of ce){const Je=ct*this.stride,wt=ue[Je+ji]>1;let an,fn,qe;if(wt)an=Yt(ue,Je,this.clusterProps),fn=ue[Je],qe=ue[Je+1];else{const Ve=this.points[ue[Je+Oi]];an=Ve.properties;const[mt,Ut]=Ve.geometry.coordinates;fn=Kt(mt),qe=bn(Ut)}const He={type:1,geometry:[[Math.round(this.options.extent*(fn*it-Se)),Math.round(this.options.extent*(qe*it-$e))]],tags:an};let pt;pt=wt||this.options.generateId?ue[Je+Oi]:this.points[ue[Je+Oi]].id,void 0!==pt&&(He.id=pt),vt.features.push(He)}}_limitZoom(ce){return Math.max(this.options.minZoom,Math.min(Math.floor(+ce),this.options.maxZoom+1))}_cluster(ce,ue){const{radius:Se,extent:$e,reduce:it,minPoints:vt}=this.options,ct=Se/($e*Math.pow(2,ue)),Je=ce.data,wt=[],an=this.stride;for(let fn=0;fn<Je.length;fn+=an){if(Je[fn+2]<=ue)continue;Je[fn+2]=ue;const qe=Je[fn],He=Je[fn+1],pt=ce.within(Je[fn],Je[fn+1],ct),Ve=Je[fn+ji];let mt=Ve;for(const Ut of pt){const _n=Ut*an;Je[_n+2]>ue&&(mt+=Je[_n+ji])}if(mt>Ve&&mt>=vt){let Ut,_n=qe*Ve,Gn=He*Ve,qn=-1;const _i=((fn/an|0)<<5)+(ue+1)+this.points.length;for(const Cr of pt){const ur=Cr*an;if(Je[ur+2]<=ue)continue;Je[ur+2]=ue;const lt=Je[ur+ji];_n+=Je[ur]*lt,Gn+=Je[ur+1]*lt,Je[ur+4]=_i,it&&(Ut||(Ut=this._map(Je,fn,!0),qn=this.clusterProps.length,this.clusterProps.push(Ut)),it(Ut,this._map(Je,ur)))}Je[fn+4]=_i,wt.push(_n/mt,Gn/mt,1/0,_i,-1,mt),it&&wt.push(qn)}else{for(let Ut=0;Ut<an;Ut++)wt.push(Je[fn+Ut]);if(mt>1)for(const Ut of pt){const _n=Ut*an;if(!(Je[_n+2]<=ue)){Je[_n+2]=ue;for(let Gn=0;Gn<an;Gn++)wt.push(Je[_n+Gn])}}}}return wt}_getOriginId(ce){return ce-this.points.length>>5}_getOriginZoom(ce){return(ce-this.points.length)%32}_map(ce,ue,Se){if(ce[ue+ji]>1){const vt=this.clusterProps[ce[ue+so]];return Se?Object.assign({},vt):vt}const $e=this.points[ce[ue+Oi]].properties,it=this.options.map($e);return Se&&it===$e?Object.assign({},it):it}}function Nt(Le,ce,ue){return{type:"Feature",id:Le[ce+Oi],properties:Yt(Le,ce,ue),geometry:{type:"Point",coordinates:[(Se=Le[ce],360*(Se-.5)),$t(Le[ce+1])]}};var Se}function Yt(Le,ce,ue){const Se=Le[ce+ji],$e=Se>=1e4?`${Math.round(Se/1e3)}k`:Se>=1e3?Math.round(Se/100)/10+"k":Se,it=Le[ce+so],vt=-1===it?{}:Object.assign({},ue[it]);return Object.assign(vt,{cluster:!0,cluster_id:Le[ce+Oi],point_count:Se,point_count_abbreviated:$e})}function Kt(Le){return Le/360+.5}function bn(Le){const ce=Math.sin(Le*Math.PI/180),ue=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return ue<0?0:ue>1?1:ue}function $t(Le){const ce=(180-360*Le)*Math.PI/180;return 360*Math.atan(Math.exp(ce))/Math.PI-90}function Vt(Le,ce,ue,Se){for(var $e,it=Se,vt=ue-ce>>1,ct=ue-ce,Je=Le[ce],wt=Le[ce+1],an=Le[ue],fn=Le[ue+1],qe=ce+3;qe<ue;qe+=3){var He=Gt(Le[qe],Le[qe+1],Je,wt,an,fn);if(He>it)$e=qe,it=He;else if(He===it){var pt=Math.abs(qe-vt);pt<ct&&($e=qe,ct=pt)}}it>Se&&($e-ce>3&&Vt(Le,ce,$e,Se),Le[$e+2]=it,ue-$e>3&&Vt(Le,$e,ue,Se))}function Gt(Le,ce,ue,Se,$e,it){var vt=$e-ue,ct=it-Se;if(0!==vt||0!==ct){var Je=((Le-ue)*vt+(ce-Se)*ct)/(vt*vt+ct*ct);Je>1?(ue=$e,Se=it):Je>0&&(ue+=vt*Je,Se+=ct*Je)}return(vt=Le-ue)*vt+(ct=ce-Se)*ct}function zn(Le,ce,ue,Se){var $e={id:void 0===Le?null:Le,type:ce,geometry:ue,tags:Se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(it){var vt=it.geometry,ct=it.type;if("Point"===ct||"MultiPoint"===ct||"LineString"===ct)Yn(it,vt);else if("Polygon"===ct||"MultiLineString"===ct)for(var Je=0;Je<vt.length;Je++)Yn(it,vt[Je]);else if("MultiPolygon"===ct)for(Je=0;Je<vt.length;Je++)for(var wt=0;wt<vt[Je].length;wt++)Yn(it,vt[Je][wt])}($e),$e}function Yn(Le,ce){for(var ue=0;ue<ce.length;ue+=3)Le.minX=Math.min(Le.minX,ce[ue]),Le.minY=Math.min(Le.minY,ce[ue+1]),Le.maxX=Math.max(Le.maxX,ce[ue]),Le.maxY=Math.max(Le.maxY,ce[ue+1])}function Ln(Le,ce,ue,Se){if(ce.geometry){var $e=ce.geometry.coordinates,it=ce.geometry.type,vt=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2),ct=[],Je=ce.id;if(ue.promoteId?Je=ce.properties[ue.promoteId]:ue.generateId&&(Je=Se||0),"Point"===it)ti($e,ct);else if("MultiPoint"===it)for(var wt=0;wt<$e.length;wt++)ti($e[wt],ct);else if("LineString"===it)fi($e,ct,vt,!1);else if("MultiLineString"===it){if(ue.lineMetrics){for(wt=0;wt<$e.length;wt++)fi($e[wt],ct=[],vt,!1),Le.push(zn(Je,"LineString",ct,ce.properties));return}$i($e,ct,vt,!1)}else if("Polygon"===it)$i($e,ct,vt,!0);else{if("MultiPolygon"!==it){if("GeometryCollection"===it){for(wt=0;wt<ce.geometry.geometries.length;wt++)Ln(Le,{id:Je,geometry:ce.geometry.geometries[wt],properties:ce.properties},ue,Se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(wt=0;wt<$e.length;wt++){var an=[];$i($e[wt],an,vt,!0),ct.push(an)}}Le.push(zn(Je,it,ct,ce.properties))}}function ti(Le,ce){ce.push(Gr(Le[0])),ce.push(vi(Le[1])),ce.push(0)}function fi(Le,ce,ue,Se){for(var $e,it,vt=0,ct=0;ct<Le.length;ct++){var Je=Gr(Le[ct][0]),wt=vi(Le[ct][1]);ce.push(Je),ce.push(wt),ce.push(0),ct>0&&(vt+=Se?($e*wt-Je*it)/2:Math.sqrt(Math.pow(Je-$e,2)+Math.pow(wt-it,2))),$e=Je,it=wt}var an=ce.length-3;ce[2]=1,Vt(ce,0,an,ue),ce[an+2]=1,ce.size=Math.abs(vt),ce.start=0,ce.end=ce.size}function $i(Le,ce,ue,Se){for(var $e=0;$e<Le.length;$e++){var it=[];fi(Le[$e],it,ue,Se),ce.push(it)}}function Gr(Le){return Le/360+.5}function vi(Le){var ce=Math.sin(Le*Math.PI/180),ue=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return ue<0?0:ue>1?1:ue}function Zi(Le,ce,ue,Se,$e,it,vt,ct){if(Se/=ce,it>=(ue/=ce)&&vt<Se)return Le;if(vt<ue||it>=Se)return null;for(var Je=[],wt=0;wt<Le.length;wt++){var an=Le[wt],fn=an.geometry,qe=an.type,He=0===$e?an.minX:an.minY,pt=0===$e?an.maxX:an.maxY;if(He>=ue&&pt<Se)Je.push(an);else if(!(pt<ue||He>=Se)){var Ve=[];if("Point"===qe||"MultiPoint"===qe)Do(fn,Ve,ue,Se,$e);else if("LineString"===qe)Yr(fn,Ve,ue,Se,$e,!1,ct.lineMetrics);else if("MultiLineString"===qe)wr(fn,Ve,ue,Se,$e,!1);else if("Polygon"===qe)wr(fn,Ve,ue,Se,$e,!0);else if("MultiPolygon"===qe)for(var mt=0;mt<fn.length;mt++){var Ut=[];wr(fn[mt],Ut,ue,Se,$e,!0),Ut.length&&Ve.push(Ut)}if(Ve.length){if(ct.lineMetrics&&"LineString"===qe){for(mt=0;mt<Ve.length;mt++)Je.push(zn(an.id,qe,Ve[mt],an.tags));continue}"LineString"!==qe&&"MultiLineString"!==qe||(1===Ve.length?(qe="LineString",Ve=Ve[0]):qe="MultiLineString"),"Point"!==qe&&"MultiPoint"!==qe||(qe=3===Ve.length?"Point":"MultiPoint"),Je.push(zn(an.id,qe,Ve,an.tags))}}}return Je.length?Je:null}function Do(Le,ce,ue,Se,$e){for(var it=0;it<Le.length;it+=3){var vt=Le[it+$e];vt>=ue&&vt<=Se&&(ce.push(Le[it]),ce.push(Le[it+1]),ce.push(Le[it+2]))}}function Yr(Le,ce,ue,Se,$e,it,vt){for(var ct,Je,wt=sr(Le),an=0===$e?To:ii,fn=Le.start,qe=0;qe<Le.length-3;qe+=3){var He=Le[qe],pt=Le[qe+1],Ve=Le[qe+2],mt=Le[qe+3],Ut=Le[qe+4],_n=0===$e?He:pt,Gn=0===$e?mt:Ut,qn=!1;vt&&(ct=Math.sqrt(Math.pow(He-mt,2)+Math.pow(pt-Ut,2))),_n<ue?Gn>ue&&(Je=an(wt,He,pt,mt,Ut,ue),vt&&(wt.start=fn+ct*Je)):_n>Se?Gn<Se&&(Je=an(wt,He,pt,mt,Ut,Se),vt&&(wt.start=fn+ct*Je)):bo(wt,He,pt,Ve),Gn<ue&&_n>=ue&&(Je=an(wt,He,pt,mt,Ut,ue),qn=!0),Gn>Se&&_n<=Se&&(Je=an(wt,He,pt,mt,Ut,Se),qn=!0),!it&&qn&&(vt&&(wt.end=fn+ct*Je),ce.push(wt),wt=sr(Le)),vt&&(fn+=ct)}var _i=Le.length-3;He=Le[_i],pt=Le[_i+1],Ve=Le[_i+2],(_n=0===$e?He:pt)>=ue&&_n<=Se&&bo(wt,He,pt,Ve),_i=wt.length-3,it&&_i>=3&&(wt[_i]!==wt[0]||wt[_i+1]!==wt[1])&&bo(wt,wt[0],wt[1],wt[2]),wt.length&&ce.push(wt)}function sr(Le){var ce=[];return ce.size=Le.size,ce.start=Le.start,ce.end=Le.end,ce}function wr(Le,ce,ue,Se,$e,it){for(var vt=0;vt<Le.length;vt++)Yr(Le[vt],ce,ue,Se,$e,it,!1)}function bo(Le,ce,ue,Se){Le.push(ce),Le.push(ue),Le.push(Se)}function To(Le,ce,ue,Se,$e,it){var vt=(it-ce)/(Se-ce);return Le.push(it),Le.push(ue+($e-ue)*vt),Le.push(1),vt}function ii(Le,ce,ue,Se,$e,it){var vt=(it-ue)/($e-ue);return Le.push(ce+(Se-ce)*vt),Le.push(it),Le.push(1),vt}function gi(Le,ce){for(var ue=[],Se=0;Se<Le.length;Se++){var $e,it=Le[Se],vt=it.type;if("Point"===vt||"MultiPoint"===vt||"LineString"===vt)$e=Mi(it.geometry,ce);else if("MultiLineString"===vt||"Polygon"===vt){$e=[];for(var ct=0;ct<it.geometry.length;ct++)$e.push(Mi(it.geometry[ct],ce))}else if("MultiPolygon"===vt)for($e=[],ct=0;ct<it.geometry.length;ct++){for(var Je=[],wt=0;wt<it.geometry[ct].length;wt++)Je.push(Mi(it.geometry[ct][wt],ce));$e.push(Je)}ue.push(zn(it.id,vt,$e,it.tags))}return ue}function Mi(Le,ce){var ue=[];ue.size=Le.size,void 0!==Le.start&&(ue.start=Le.start,ue.end=Le.end);for(var Se=0;Se<Le.length;Se+=3)ue.push(Le[Se]+ce,Le[Se+1],Le[Se+2]);return ue}function Er(Le,ce){if(Le.transformed)return Le;var ue,Se,$e,it=1<<Le.z,vt=Le.x,ct=Le.y;for(ue=0;ue<Le.features.length;ue++){var Je=Le.features[ue],wt=Je.geometry,an=Je.type;if(Je.geometry=[],1===an)for(Se=0;Se<wt.length;Se+=2)Je.geometry.push(fo(wt[Se],wt[Se+1],ce,it,vt,ct));else for(Se=0;Se<wt.length;Se++){var fn=[];for($e=0;$e<wt[Se].length;$e+=2)fn.push(fo(wt[Se][$e],wt[Se][$e+1],ce,it,vt,ct));Je.geometry.push(fn)}}return Le.transformed=!0,Le}function fo(Le,ce,ue,Se,$e,it){return[Math.round(ue*(Le*Se-$e)),Math.round(ue*(ce*Se-it))]}function po(Le,ce,ue,Se,$e){for(var it=ce===$e.maxZoom?0:$e.tolerance/((1<<ce)*$e.extent),vt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ue,y:Se,z:ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ct=0;ct<Le.length;ct++){vt.numFeatures++,Gi(vt,Le[ct],it,$e);var Je=Le[ct].minX,wt=Le[ct].minY,an=Le[ct].maxX,fn=Le[ct].maxY;Je<vt.minX&&(vt.minX=Je),wt<vt.minY&&(vt.minY=wt),an>vt.maxX&&(vt.maxX=an),fn>vt.maxY&&(vt.maxY=fn)}return vt}function Gi(Le,ce,ue,Se){var $e=ce.geometry,it=ce.type,vt=[];if("Point"===it||"MultiPoint"===it)for(var ct=0;ct<$e.length;ct+=3)vt.push($e[ct]),vt.push($e[ct+1]),Le.numPoints++,Le.numSimplified++;else if("LineString"===it)Si(vt,$e,Le,ue,!1,!1);else if("MultiLineString"===it||"Polygon"===it)for(ct=0;ct<$e.length;ct++)Si(vt,$e[ct],Le,ue,"Polygon"===it,0===ct);else if("MultiPolygon"===it)for(var Je=0;Je<$e.length;Je++){var wt=$e[Je];for(ct=0;ct<wt.length;ct++)Si(vt,wt[ct],Le,ue,!0,0===ct)}if(vt.length){var an=ce.tags||null;if("LineString"===it&&Se.lineMetrics){for(var fn in an={},ce.tags)an[fn]=ce.tags[fn];an.mapbox_clip_start=$e.start/$e.size,an.mapbox_clip_end=$e.end/$e.size}var qe={geometry:vt,type:"Polygon"===it||"MultiPolygon"===it?3:"LineString"===it||"MultiLineString"===it?2:1,tags:an};null!==ce.id&&(qe.id=ce.id),Le.features.push(qe)}}function Si(Le,ce,ue,Se,$e,it){var vt=Se*Se;if(Se>0&&ce.size<($e?vt:Se))ue.numPoints+=ce.length/3;else{for(var ct=[],Je=0;Je<ce.length;Je+=3)(0===Se||ce[Je+2]>vt)&&(ue.numSimplified++,ct.push(ce[Je]),ct.push(ce[Je+1])),ue.numPoints++;$e&&function(wt,an){for(var fn=0,qe=0,He=wt.length,pt=He-2;qe<He;pt=qe,qe+=2)fn+=(wt[qe]-wt[pt])*(wt[qe+1]+wt[pt+1]);if(fn>0===an)for(qe=0,He=wt.length;qe<He/2;qe+=2){var Ve=wt[qe],mt=wt[qe+1];wt[qe]=wt[He-2-qe],wt[qe+1]=wt[He-1-qe],wt[He-2-qe]=Ve,wt[He-1-qe]=mt}}(ct,it),Le.push(ct)}}function Ao(Le,ce){var ue=(ce=this.options=function($e,it){for(var vt in it)$e[vt]=it[vt];return $e}(Object.create(this.options),ce)).debug;if(ue&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");var $e,it,vt,ct,Je,wt,Se=function($e,it){var vt=[];if("FeatureCollection"===$e.type)for(var ct=0;ct<$e.features.length;ct++)Ln(vt,$e.features[ct],it,ct);else Ln(vt,"Feature"===$e.type?$e:{geometry:$e},it);return vt}(Le,ce);this.tiles={},this.tileCoords=[],ue&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ct=$e=Se,Je=Zi($e,1,-1-(vt=(it=ce).buffer/it.extent),vt,0,-1,2,it),wt=Zi($e,1,1-vt,2+vt,0,-1,2,it),(Je||wt)&&(ct=Zi($e,1,-vt,1+vt,0,-1,2,it)||[],Je&&(ct=gi(Je,1).concat(ct)),wt&&(ct=ct.concat(gi(wt,-1)))),(Se=ct).length&&this.splitTile(Se,0,0,0),ue&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function nr(Le,ce,ue){return 32*((1<<Le)*ue+ce)+Le}function xo(Le,ce){const ue=Le.tileID.canonical;if(!this._geoJSONIndex)return ce(null,null);const Se=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!Se)return ce(null,null);const $e=new class{constructor(vt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=vt.length,this._features=vt}feature(vt){return new class{constructor(ct){this._feature=ct,this.extent=l.EXTENT,this.type=ct.type,this.properties=ct.tags,"id"in ct&&!isNaN(ct.id)&&(this.id=parseInt(ct.id,10))}loadGeometry(){if(1===this._feature.type){const ct=[];for(const Je of this._feature.geometry)ct.push([new l.Point(Je[0],Je[1])]);return ct}{const ct=[];for(const Je of this._feature.geometry){const wt=[];for(const an of Je)wt.push(new l.Point(an[0],an[1]));ct.push(wt)}return ct}}toGeoJSON(ct,Je,wt){return ht.call(this,ct,Je,wt)}}(this._features[vt])}}(Se.features);let it=Li($e);0===it.byteOffset&&it.byteLength===it.buffer.byteLength||(it=new Uint8Array(it)),ce(null,{vectorTile:$e,rawData:it.buffer})}Ao.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ao.prototype.splitTile=function(Le,ce,ue,Se,$e,it,vt){for(var ct=[Le,ce,ue,Se],Je=this.options,wt=Je.debug;ct.length;){Se=ct.pop(),ue=ct.pop(),ce=ct.pop(),Le=ct.pop();var an=1<<ce,fn=nr(ce,ue,Se),qe=this.tiles[fn];if(!qe&&(wt>1&&console.time("creation"),qe=this.tiles[fn]=po(Le,ce,ue,Se,Je),this.tileCoords.push({z:ce,x:ue,y:Se}),wt)){wt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,ue,Se,qe.numFeatures,qe.numPoints,qe.numSimplified),console.timeEnd("creation"));var He="z"+ce;this.stats[He]=(this.stats[He]||0)+1,this.total++}if(qe.source=Le,$e){if(ce===Je.maxZoom||ce===$e)continue;var pt=1<<$e-ce;if(ue!==Math.floor(it/pt)||Se!==Math.floor(vt/pt))continue}else if(ce===Je.indexMaxZoom||qe.numPoints<=Je.indexMaxPoints)continue;if(qe.source=null,0!==Le.length){wt>1&&console.time("clipping");var Ve,mt,Ut,_n,Gn,qn,_i=.5*Je.buffer/Je.extent,Cr=.5-_i,ur=.5+_i,lt=1+_i;Ve=mt=Ut=_n=null,Gn=Zi(Le,an,ue-_i,ue+ur,0,qe.minX,qe.maxX,Je),qn=Zi(Le,an,ue+Cr,ue+lt,0,qe.minX,qe.maxX,Je),Le=null,Gn&&(Ve=Zi(Gn,an,Se-_i,Se+ur,1,qe.minY,qe.maxY,Je),mt=Zi(Gn,an,Se+Cr,Se+lt,1,qe.minY,qe.maxY,Je),Gn=null),qn&&(Ut=Zi(qn,an,Se-_i,Se+ur,1,qe.minY,qe.maxY,Je),_n=Zi(qn,an,Se+Cr,Se+lt,1,qe.minY,qe.maxY,Je),qn=null),wt>1&&console.timeEnd("clipping"),ct.push(Ve||[],ce+1,2*ue,2*Se),ct.push(mt||[],ce+1,2*ue,2*Se+1),ct.push(Ut||[],ce+1,2*ue+1,2*Se),ct.push(_n||[],ce+1,2*ue+1,2*Se+1)}}},Ao.prototype.getTile=function(Le,ce,ue){var Se=this.options,$e=Se.extent,it=Se.debug;if(Le<0||Le>24)return null;var vt=1<<Le,ct=nr(Le,ce=(ce%vt+vt)%vt,ue);if(this.tiles[ct])return Er(this.tiles[ct],$e);it>1&&console.log("drilling down to z%d-%d-%d",Le,ce,ue);for(var Je,wt=Le,an=ce,fn=ue;!Je&&wt>0;)wt--,an=Math.floor(an/2),fn=Math.floor(fn/2),Je=this.tiles[nr(wt,an,fn)];return Je&&Je.source?(it>1&&console.log("found parent tile z%d-%d-%d",wt,an,fn),it>1&&console.time("drilling down"),this.splitTile(Je.source,wt,an,fn,Le,ce,ue),it>1&&console.timeEnd("drilling down"),this.tiles[ct]?Er(this.tiles[ct],$e):null):null};class Hi extends l.VectorTileWorkerSource{constructor(ce,ue,Se,$e,it){super(ce,ue,Se,$e,xo),it&&(this.loadGeoJSON=it)}loadData(ce,ue){const Se=ce&&ce.request,$e=Se&&Se.collectResourceTiming;this.loadGeoJSON(ce,(it,vt)=>{if(it||!vt)return ue(it);if("object"!=typeof vt)return ue(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`));{at(vt,!0);try{if(ce.filter){const Je=l.createExpression(ce.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Je.result)throw new Error(Je.value.map(an=>`${an.key}: ${an.message}`).join(", "));vt={type:"FeatureCollection",features:vt.features.filter(an=>Je.value.evaluate({zoom:0},an))}}this._geoJSONIndex=ce.cluster?new _t(function({superclusterOptions:Je,clusterProperties:wt}){if(!wt||!Je)return Je;const an={},fn={},qe={accumulated:null,zoom:0},He={properties:null},pt=Object.keys(wt);for(const Ve of pt){const[mt,Ut]=wt[Ve],_n=l.createExpression(Ut),Gn=l.createExpression("string"==typeof mt?[mt,["accumulated"],["get",Ve]]:mt);an[Ve]=_n.value,fn[Ve]=Gn.value}return Je.map=Ve=>{He.properties=Ve;const mt={};for(const Ut of pt)mt[Ut]=an[Ut].evaluate(qe,He);return mt},Je.reduce=(Ve,mt)=>{He.properties=mt;for(const Ut of pt)qe.accumulated=Ve[Ut],Ve[Ut]=fn[Ut].evaluate(qe,He)},Je}(ce)).load(vt.features):new Ao(Je=vt,ce.geojsonVtOptions)}catch(Je){return ue(Je)}this.loaded={};const ct={};if($e){const Je=l.getPerformanceMeasurement(Se);Je&&(ct.resourceTiming={},ct.resourceTiming[ce.source]=JSON.parse(JSON.stringify(Je)))}ue(null,ct)}var Je})}reloadTile(ce,ue){const Se=this.loaded;return Se&&Se[ce.uid]?super.reloadTile(ce,ue):this.loadTile(ce,ue)}loadGeoJSON(ce,ue){if(ce.request)l.getJSON(ce.request,ue);else{if("string"!=typeof ce.data)return ue(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`));try{return ue(null,JSON.parse(ce.data))}catch{return ue(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ce,ue){try{ue(null,this._geoJSONIndex.getClusterExpansionZoom(ce.clusterId))}catch(Se){ue(Se)}}getClusterChildren(ce,ue){try{ue(null,this._geoJSONIndex.getChildren(ce.clusterId))}catch(Se){ue(Se)}}getClusterLeaves(ce,ue){try{ue(null,this._geoJSONIndex.getLeaves(ce.clusterId,ce.limit,ce.offset))}catch(Se){ue(Se)}}}class Uo{constructor(ce){this.self=ce,this.actor=new l.Actor(ce,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.getProjection({name:"mercator"}),this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:Hi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ue,Se)=>{if(this.workerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.workerSourceTypes[ue]=Se},this.self.registerRTLTextPlugin=ue=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=ue.applyArabicShaping,l.plugin.processBidirectionalText=ue.processBidirectionalText,l.plugin.processStyledBidirectionalText=ue.processStyledBidirectionalText}}clearCaches(ce,ue,Se){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.workerSources[ce],delete this.demWorkerSources[ce],Se()}checkIfReady(ce,ue,Se){Se()}setReferrer(ce,ue){this.referrer=ue}spriteLoaded(ce,ue){this.isSpriteLoaded[ce]=ue;for(const Se in this.workerSources[ce]){const $e=this.workerSources[ce][Se];for(const it in $e)$e[it]instanceof l.VectorTileWorkerSource&&($e[it].isSpriteLoaded=ue,$e[it].fire(new l.Event("isSpriteLoaded")))}}setImages(ce,ue,Se){this.availableImages[ce]=ue;for(const $e in this.workerSources[ce]){const it=this.workerSources[ce][$e];for(const vt in it)it[vt].availableImages=ue}Se()}enableTerrain(ce,ue,Se){this.terrain=ue,Se()}setProjection(ce,ue){this.projections[ce]=l.getProjection(ue)}setLayers(ce,ue,Se){this.getLayerIndex(ce).replace(ue),Se()}updateLayers(ce,ue,Se){this.getLayerIndex(ce).update(ue.layers,ue.removedIds),Se()}loadTile(ce,ue,Se){const $e=this.enableTerrain?l.extend({enableTerrain:this.terrain},ue):ue;$e.projection=this.projections[ce]||this.defaultProjection,this.getWorkerSource(ce,ue.type,ue.source).loadTile($e,Se)}loadDEMTile(ce,ue,Se){const $e=this.enableTerrain?l.extend({buildQuadTree:this.terrain},ue):ue;this.getDEMWorkerSource(ce,ue.source).loadTile($e,Se)}reloadTile(ce,ue,Se){const $e=this.enableTerrain?l.extend({enableTerrain:this.terrain},ue):ue;$e.projection=this.projections[ce]||this.defaultProjection,this.getWorkerSource(ce,ue.type,ue.source).reloadTile($e,Se)}abortTile(ce,ue,Se){this.getWorkerSource(ce,ue.type,ue.source).abortTile(ue,Se)}removeTile(ce,ue,Se){this.getWorkerSource(ce,ue.type,ue.source).removeTile(ue,Se)}removeSource(ce,ue,Se){if(!this.workerSources[ce]||!this.workerSources[ce][ue.type]||!this.workerSources[ce][ue.type][ue.source])return;const $e=this.workerSources[ce][ue.type][ue.source];delete this.workerSources[ce][ue.type][ue.source],void 0!==$e.removeSource?$e.removeSource(ue,Se):Se()}loadWorkerSource(ce,ue,Se){try{this.self.importScripts(ue.url),Se()}catch($e){Se($e.toString())}}syncRTLPluginState(ce,ue,Se){try{l.plugin.setState(ue);const $e=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&null!=$e){this.self.importScripts($e);const it=l.plugin.isParsed();Se(it?void 0:new Error(`RTL Text Plugin failed to import scripts from ${$e}`),it)}}catch($e){Se($e.toString())}}getAvailableImages(ce){let ue=this.availableImages[ce];return ue||(ue=[]),ue}getLayerIndex(ce){let ue=this.layerIndexes[ce];return ue||(ue=this.layerIndexes[ce]=new nt),ue}getWorkerSource(ce,ue,Se){return this.workerSources[ce]||(this.workerSources[ce]={}),this.workerSources[ce][ue]||(this.workerSources[ce][ue]={}),this.workerSources[ce][ue][Se]||(this.workerSources[ce][ue][Se]=new this.workerSourceTypes[ue]({send:(it,vt,ct,Je,wt,an)=>{this.actor.send(it,vt,ct,ce,wt,an)},scheduler:this.actor.scheduler},this.getLayerIndex(ce),this.getAvailableImages(ce),this.isSpriteLoaded[ce])),this.workerSources[ce][ue][Se]}getDEMWorkerSource(ce,ue){return this.demWorkerSources[ce]||(this.demWorkerSources[ce]={}),this.demWorkerSources[ce][ue]||(this.demWorkerSources[ce][ue]=new Ye),this.demWorkerSources[ce][ue]}enforceCacheSizeLimit(ce,ue){l.enforceCacheSizeLimit(ue)}getWorkerPerformanceMetrics(ce,ue,Se){Se(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Uo(self)),Uo}),Re(0,function(l){function ge(f,r){if(Array.isArray(f)){if(!Array.isArray(r)||f.length!==r.length)return!1;for(let c=0;c<f.length;c++)if(!ge(f[c],r[c]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==r){if("object"!=typeof r||Object.keys(f).length!==Object.keys(r).length)return!1;for(const c in f)if(!ge(f[c],r[c]))return!1;return!0}return f===r}var Ke=nt;function nt(f){return r=f,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,b,C=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(C);try{b=new Worker(P),m=!0}catch{m=!1}return b&&b.terminate(),URL.revokeObjectURL(P),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var b=m.getContext("2d");if(!b)return!1;var C=b.getImageData(0,0,1,1);return C&&C.width===m.width}()||(void 0===Ye[c=r&&r.failIfMajorPerformanceCaveat]&&(Ye[c]=function(m){var b,P,R,z,C=(P=m,R=document.createElement("canvas"),(z=Object.create(nt.webGLContextAttributes)).failIfMajorPerformanceCaveat=P,R.getContext("webgl",z)||R.getContext("experimental-webgl",z));if(!C)return!1;try{b=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!b||C.isContextLost())&&(C.shaderSource(b,"void main() {}"),C.compileShader(b),!0===C.getShaderParameter(b,C.COMPILE_STATUS))}(c)),!Ye[c]||document.documentMode));var r,c}var Ye={};function Ge(f,r,c){const m=l.window.document.createElement(f);return void 0!==r&&(m.className=r),c&&c.appendChild(m),m}function Xe(f,r,c){const m=l.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const b of Object.keys(r))m.setAttributeNS(null,b,r[b]);return c&&c.appendChild(m),m}nt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const at=l.window.document&&l.window.document.documentElement.style,ht=at&&void 0!==at.userSelect?"userSelect":"WebkitUserSelect";let Bt;function zt(){at&&ht&&(Bt=at[ht],at[ht]="none")}function dn(){at&&ht&&(at[ht]=Bt)}function St(f){f.preventDefault(),f.stopPropagation(),l.window.removeEventListener("click",St,!0)}function Bn(){l.window.addEventListener("click",St,!0),l.window.setTimeout(()=>{l.window.removeEventListener("click",St,!0)},0)}function Tn(f,r){const c=f.getBoundingClientRect();return ft(f,c,r)}function kn(f,r){const c=f.getBoundingClientRect(),m=[];for(let b=0;b<r.length;b++)m.push(ft(f,c,r[b]));return m}function Dn(f){return void 0!==l.window.InstallTrigger&&2===f.button&&f.ctrlKey&&l.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function ft(f,r,c){const m=f.offsetWidth===r.width?1:f.offsetWidth/r.width;return new l.Point((c.clientX-r.left)*m,(c.clientY-r.top)*m)}function Ze(f,r){var c=r[0],m=r[1],b=r[2],C=r[3],P=c*C-b*m;return P?(f[0]=C*(P=1/P),f[1]=-m*P,f[2]=-b*P,f[3]=c*P,f):null}function Xt(f){const{userImage:r}=f;return!!(r&&r.render&&r.render())&&(f.data.replace(new Uint8Array(r.data.buffer)),!0)}class Pt extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,m);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,c){this._validate(r,c)&&(this.images[r]=c)}_validate(r,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new l.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),m=!1),m}_validateStretch(r,c){if(!r)return!0;let m=0;for(const b of r){if(b[0]<m||b[1]<b[0]||c<b[1])return!1;m=b[1]}return!0}_validateContent(r,c){return!(r&&(4!==r.length||r[0]<0||c.data.width<r[0]||r[1]<0||c.data.height<r[1]||r[2]<0||c.data.width<r[2]||r[3]<0||c.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,c){c.version=this.images[r].version+1,this.images[r]=c,this.updatedImages[r]=!0}removeImage(r){const c=this.images[r];delete this.images[r],delete this.patterns[r],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,c){let m=!0;if(!this.isLoaded())for(const b of r)this.images[b]||(m=!1);this.isLoaded()||m?this._notify(r,c):this.requestors.push({ids:r,callback:c})}_notify(r,c){const m={};for(const b of r){this.images[b]||this.fire(new l.Event("styleimagemissing",{id:b}));const C=this.images[b];C?m[b]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!(!C.userImage||!C.userImage.render)}:l.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,m)}getPixelSize(){const{width:r,height:c}=this.atlasImage;return{width:r,height:c}}getPattern(r){const c=this.patterns[r],m=this.getImage(r);if(!m)return null;if(c&&c.position.version===m.version)return c.position;if(c)c.position.version=m.version;else{const b={w:m.data.width+2,h:m.data.height+2,x:0,y:0},C=new l.ImagePosition(b,m);this.patterns[r]={bin:b,position:C}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const c=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.Texture(r,this.atlasImage,c.RGBA),this.atlasTexture&&this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const C in this.patterns)r.push(this.patterns[C].bin);const{w:c,h:m}=l.potpack(r),b=this.atlasImage;b.resize({width:c||1,height:m||1});for(const C in this.patterns){const{bin:P}=this.patterns[C],R=P.x+1,z=P.y+1,W=this.images[C].data,q=W.width,ae=W.height;l.RGBAImage.copy(W,b,{x:0,y:0},{x:R,y:z},{width:q,height:ae}),l.RGBAImage.copy(W,b,{x:0,y:ae-1},{x:R,y:z-1},{width:q,height:1}),l.RGBAImage.copy(W,b,{x:0,y:0},{x:R,y:z+ae},{width:q,height:1}),l.RGBAImage.copy(W,b,{x:q-1,y:0},{x:R-1,y:z},{width:1,height:ae}),l.RGBAImage.copy(W,b,{x:0,y:0},{x:R+q,y:z},{width:1,height:ae})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const c of r){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const m=this.images[c];Xt(m)&&this.updateImage(c,m)}}}const qt=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(f,r){return function([c,m,b]){const C=l.degToRad(m+90),P=l.degToRad(b);return{x:c*Math.cos(C)*Math.sin(P),y:c*Math.sin(C)*Math.sin(P),z:c*Math.cos(P),azimuthal:m,polar:b}}(f.expression.evaluate(r))}interpolate(f,r,c){return{x:l.number(f.x,r.x,c),y:l.number(f.y,r.y,c),z:l.number(f.z,r.z,c),azimuthal:l.number(f.azimuthal,r.azimuthal,c),polar:l.number(f.polar,r.polar,c)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)});class vn extends l.Evented{constructor(r){super(),this._transitionable=new l.Transitionable(qt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,c={}){if(!this._validate(l.validateLight,r,c))for(const m in r){const b=r[m];l.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),b):this._transitionable.setValue(m,b)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,m){return(!m||!1!==m.validate)&&l.emitValidationErrors(this,r.call(l.validateStyle,l.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}const Ti=new l.Properties({source:new l.DataConstantProperty(l.spec.terrain.source),exaggeration:new l.DataConstantProperty(l.spec.terrain.exaggeration)});let Ei=class extends l.Evented{constructor(f,r){super(),this._transitionable=new l.Transitionable(Ti),this.set(f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(f){for(const r in f){const c=f[r];l.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-11),c):this._transitionable.setValue(r,c)}}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}};function Li(f,r,c,m){const b=l.smoothstep(45,65,c),[C,P]=Mr(f,m),R=l.length(r);let z=1-Math.min(1,Math.exp((R-C)/(P-C)*-6));return z*=z*z,z=Math.min(1,1.00747*z),z*b*f.alpha}function Mr(f,r){const c=.5/Math.tan(.5*r);return[f.range[0]+c,f.range[1]+c]}const hi=new l.Properties({range:new l.DataConstantProperty(l.spec.fog.range),color:new l.DataConstantProperty(l.spec.fog.color),"high-color":new l.DataConstantProperty(l.spec.fog["high-color"]),"space-color":new l.DataConstantProperty(l.spec.fog["space-color"]),"horizon-blend":new l.DataConstantProperty(l.spec.fog["horizon-blend"]),"star-intensity":new l.DataConstantProperty(l.spec.fog["star-intensity"])});class mr extends l.Evented{constructor(r,c){super(),this._transitionable=new l.Transitionable(hi),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const r=this._transform,c="globe"===r.projection.name,m=l.globeToMercatorTransition(r.zoom),b=this.properties.get("range"),C=[.5,3];return{range:c?[l.number(C[0],b[0],m),l.number(C[1],b[1],m)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,c={}){if(!this._validate(l.validateFog,r,c)){for(const m of Object.keys(l.spec.fog))r&&void 0===r[m]&&(r[m]=l.spec.fog[m].default);for(const m in r){const b=r[m];l.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),b):this._transitionable.setValue(m,b)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:l.smoothstep(45,65,r))*c.a}getOpacityAtLatLng(r,c){return this._transform.projection.supportsFog?function(m,b,C){const P=l.MercatorCoordinate.fromLngLat(b),R=C.elevation?C.elevation.getAtPointOrZero(P):0,z=[P.x,P.y,R];return l.transformMat4(z,z,C.mercatorFogMatrix),Li(m,z,C.pitch,C._fov)}(this.state,r,c):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Mr(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,m){return(!m||!1!==m.validate)&&l.emitValidationErrors(this,r.call(l.validateStyle,l.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class Oi{constructor(r,c){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const m=this.workerPool.acquire(this.id);for(let b=0;b<m.length;b++){const C=new Oi.Actor(m[b],c,this.id);C.name=`Worker ${b}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,c,m){l.asyncAll(this.actors,(b,C)=>{b.send(r,c,C)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ji(f,r,c){return r*(l.EXTENT/(f.tileSize*Math.pow(2,c-f.tileID.overscaledZ)))}Oi.Actor=l.Actor;class so{constructor(r,c,m,b){this.screenBounds=r,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(r,c){let m,b;if(r instanceof l.Point||"number"==typeof r[0]){const C=l.Point.convert(r);m=[C],b=c.isPointAboveHorizon(C)}else{const C=l.Point.convert(r[0]),P=l.Point.convert(r[1]);m=[C,P],b=l.polygonizeBounds(C,P).every(R=>c.isPointAboveHorizon(R))}return new so(m,c.getCameraPoint(),b,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return l.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new l.Point(1,1)):this.screenBounds[1],b=l.polygonizeBounds(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?b[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(b[3]=this.cameraPoint)),l.bufferConvexPolygon(b,r)}bufferedCameraGeometryGlobe(r){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new l.Point(1,1)):this.screenBounds[1],b=l.polygonizeBounds(c,m,r),C=this.cameraPoint.clone();switch(3*((C.y>c.y)+(C.y>m.y))+((C.x>c.x)+(C.x>m.x))){case 0:b[0]=C,b[4]=C.clone();break;case 1:b.splice(1,0,C);break;case 2:b[1]=C;break;case 3:b.splice(4,0,C);break;case 5:b.splice(2,0,C);break;case 6:b[3]=C;break;case 7:b.splice(3,0,C);break;case 8:b[2]=C}return b}containsTile(r,c,m,b=0){const C=r.queryPadding/c._pixelsPerMercatorPixel+1,P=m?this._bufferedCameraMercator(C,c):this._bufferedScreenMercator(C,c);let R=r.tileID.wrap+(P.unwrapped?b:0);const z=P.polygon.map(De=>l.getTilePoint(r.tileTransform,De,R));if(!l.polygonIntersectsBox(z,0,0,l.EXTENT,l.EXTENT))return;R=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const W=this.screenGeometryMercator.polygon.map(De=>l.getTileVec3(r.tileTransform,De,R)),q=W.map(De=>new l.Point(De[0],De[1])),ae=c.getFreeCameraOptions().position||new l.MercatorCoordinate(0,0,0),fe=l.getTileVec3(r.tileTransform,ae,R),be=W.map(De=>{const le=l.sub(De,De,fe);return l.normalize(le,le),new l.Ray(fe,le)}),we=ji(r,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:q,tilespaceRays:be,bufferedTilespaceGeometry:z,bufferedTilespaceBounds:(xe=l.getBounds(z),xe.min.x=l.clamp(xe.min.x,0,l.EXTENT),xe.min.y=l.clamp(xe.min.y,0,l.EXTENT),xe.max.x=l.clamp(xe.max.x,0,l.EXTENT),xe.max.y=l.clamp(xe.max.y,0,l.EXTENT),xe),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:we};var xe}_bufferedScreenMercator(r,c){const m=Yt(r);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let b;return b="globe"===c.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),c):{polygon:this.bufferedScreenGeometry(r).map(C=>c.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[m]=b,b}}_bufferedCameraMercator(r,c){const m=Yt(r);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let b;return b="globe"===c.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),c):{polygon:this.bufferedCameraGeometry(r).map(C=>c.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[m]=b,b}}_projectAndResample(r,c){const m=function(C,P){const R=l.multiply([],P.pixelMatrix,P.globeMatrix),z=[0,-l.GLOBE_RADIUS,0,1],W=[0,l.GLOBE_RADIUS,0,1],q=[0,0,0,1];l.transformMat4$1(z,z,R),l.transformMat4$1(W,W,R),l.transformMat4$1(q,q,R);const ae=new l.Point(z[0]/z[3],z[1]/z[3]),fe=new l.Point(W[0]/W[3],W[1]/W[3]),be=l.polygonContainsPoint(C,ae)&&z[3]<q[3],we=l.polygonContainsPoint(C,fe)&&W[3]<q[3];if(!be&&!we)return null;const xe=function(et,gt,st){for(let Mt=1;Mt<et.length;Mt++){const pn=Nt(gt.pointCoordinate3D(et[Mt-1]).x),Ct=Nt(gt.pointCoordinate3D(et[Mt]).x);if(st<0){if(pn<Ct)return{idx:Mt,t:-pn/(Ct-1-pn)}}else if(Ct<pn)return{idx:Mt,t:(1-pn)/(Ct+1-pn)}}return null}(C,P,be?-1:1);if(!xe)return null;const{idx:De,t:le}=xe;let _e=De>1?_t(C.slice(0,De),P):[],Ie=De<C.length?_t(C.slice(De),P):[];_e=_e.map(et=>new l.Point(Nt(et.x),et.y)),Ie=Ie.map(et=>new l.Point(Nt(et.x),et.y));const Pe=[..._e];0===Pe.length&&Pe.push(Ie[Ie.length-1]);const Qe=l.number(Pe[Pe.length-1].y,(0===Ie.length?_e[0]:Ie[0]).y,le);let tt;return tt=be?[new l.Point(0,Qe),new l.Point(0,0),new l.Point(1,0),new l.Point(1,Qe)]:[new l.Point(1,Qe),new l.Point(1,1),new l.Point(0,1),new l.Point(0,Qe)],Pe.push(...tt),0===Ie.length?Pe.push(_e[0]):Pe.push(...Ie),{polygon:Pe.map(et=>new l.MercatorCoordinate(et.x,et.y)),unwrapped:!1}}(r,c);if(m)return m;const b=function(C,P){let R=!1,z=-1/0,W=0;for(let ae=0;ae<C.length-1;ae++)C[ae].x>z&&(z=C[ae].x,W=ae);for(let ae=0;ae<C.length-1;ae++){const fe=(W+ae)%(C.length-1),be=C[fe],we=C[fe+1];Math.abs(be.x-we.x)>.5&&(be.x<we.x?(be.x+=1,0===fe&&(C[C.length-1].x+=1)):(we.x+=1,fe+1===C.length-1&&(C[0].x+=1)),R=!0)}const q=l.mercatorXfromLng(P.center.lng);return R&&q<Math.abs(q-1)&&C.forEach(ae=>{ae.x-=1}),{polygon:C,unwrapped:R}}(_t(r,c).map(C=>new l.Point(Nt(C.x),C.y)),c);return{polygon:b.polygon.map(C=>new l.MercatorCoordinate(C.x,C.y)),unwrapped:b.unwrapped}}}function _t(f,r){return l.resample(f,c=>{const m=r.pointCoordinate3D(c);c.x=m.x,c.y=m.y},1/256)}function Nt(f){return f<0?1+f%1:f%1}function Yt(f){return 100*f|0}function Kt(f,r,c,m,b){const C=function(P,R){if(P)return b(P);if(R){f.url&&R.tiles&&f.tiles&&delete f.tiles;const z=l.pick(l.extend(R,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);R.vector_layers&&(z.vectorLayers=R.vector_layers,z.vectorLayerIds=z.vectorLayers.map(W=>W.id)),z.tiles=r.canonicalizeTileset(z,f.url),b(null,z)}};return f.url?l.getJSON(r.transformRequest(r.normalizeSourceURL(f.url,null,c,m),l.ResourceType.Source),C):l.exported.frame(()=>C(null,f))}class bn{constructor(r,c,m){this.bounds=l.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const c=Math.pow(2,r.z),m=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*c),b=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*c),C=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*c),P=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*c);return r.x>=m&&r.x<C&&r.y>=b&&r.y<P}}class $t{constructor(r,c,m){this.context=r;const b=r.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Vt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gt{constructor(r,c,m,b){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=b,this.context=r;const C=r.gl;this.buffer=C.createBuffer(),r.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,c){for(let m=0;m<this.attributes.length;m++){const b=c.attributes[this.attributes[m].name];void 0!==b&&r.enableVertexAttribArray(b)}}setVertexAttribPointers(r,c,m){for(let b=0;b<this.attributes.length;b++){const C=this.attributes[b],P=c.attributes[C.name];void 0!==P&&r.vertexAttribPointer(P,C.components,r[Vt[C.type]],!1,this.itemSize,C.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yn extends zn{getDefault(){return l.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ln extends zn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class ti extends zn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class fi extends zn{getDefault(){return[!0,!0,!0,!0]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class $i extends zn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Gr extends zn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class vi extends zn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const c=this.current;(r.func!==c.func||r.ref!==c.ref||r.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Zi extends zn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Do extends zn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=r,this.dirty=!1}}class Yr extends zn{getDefault(){return[0,1]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class sr extends zn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=r,this.dirty=!1}}class wr extends zn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class bo extends zn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.BLEND):c.disable(c.BLEND),this.current=r,this.dirty=!1}}class To extends zn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class ii extends zn{getDefault(){return l.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class gi extends zn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Mi extends zn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=r,this.dirty=!1}}class Er extends zn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class fo extends zn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let po,Gi=class extends zn{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Si extends zn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Ao extends zn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class nr extends zn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class xo extends zn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Hi extends zn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Uo extends zn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Le extends zn{getDefault(){return null}set(r){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class ce extends zn{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class ue extends zn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Se extends zn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class $e extends zn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class it extends zn{constructor(r,c){super(r),this.context=r,this.parent=c}getDefault(){return null}}class vt extends it{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class ct extends it{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Je extends ct{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class wt{constructor(r,c,m,b){this.context=r,this.width=c,this.height=m;const C=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new vt(r,C),b&&(this.depthAttachment=new ct(r,C))}destroy(){const r=this.context.gl,c=this.colorAttachment.get();if(c&&r.deleteTexture(c),this.depthAttachment){const m=this.depthAttachment.get();m&&r.deleteRenderbuffer(m)}r.deleteFramebuffer(this.framebuffer)}}class an{constructor(r,c=!1){if(this.gl=r,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const m=r;this.extVertexArrayObject={createVertexArrayOES:m.createVertexArray.bind(r),deleteVertexArrayOES:m.deleteVertexArray.bind(r),bindVertexArrayOES:m.bindVertexArray.bind(r)}}this.clearColor=new Yn(this),this.clearDepth=new Ln(this),this.clearStencil=new ti(this),this.colorMask=new fi(this),this.depthMask=new $i(this),this.stencilMask=new Gr(this),this.stencilFunc=new vi(this),this.stencilOp=new Zi(this),this.stencilTest=new Do(this),this.depthRange=new Yr(this),this.depthTest=new sr(this),this.depthFunc=new wr(this),this.blend=new bo(this),this.blendFunc=new To(this),this.blendColor=new ii(this),this.blendEquation=new gi(this),this.cullFace=new Mi(this),this.cullFaceSide=new Er(this),this.frontFace=new fo(this),this.program=new Gi(this),this.activeTexture=new Si(this),this.viewport=new Ao(this),this.bindFramebuffer=new nr(this),this.bindRenderbuffer=new xo(this),this.bindTexture=new Hi(this),this.bindVertexBuffer=new Uo(this),this.bindElementBuffer=new Le(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ce(this),this.pixelStoreUnpack=new ue(this),this.pixelStoreUnpackPremultiplyAlpha=new Se(this),this.pixelStoreUnpackFlipY=new $e(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=r.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&r.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,c){return new $t(this,r,c)}createVertexBuffer(r,c,m){return new Gt(this,r,c,m)}createRenderbuffer(r,c,m){const b=this.gl,C=b.createRenderbuffer();return this.bindRenderbuffer.set(C),b.renderbufferStorage(b.RENDERBUFFER,r,c,m),this.bindRenderbuffer.set(null),C}createFramebuffer(r,c,m){return new wt(this,r,c,m)}clear({color:r,depth:c,stencil:m}){const b=this.gl;let C=0;r&&(C|=b.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(C|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==m&&(C|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),b.clear(C)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){ge(r.blendFunction,l.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class fn extends l.Evented{constructor(r,c,m,b){if(super(),this.id=r,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(c,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new l.DedupedRequest}load(r){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=Kt(this._options,this.map._requestManager,c,m,(b,C)=>{this._tileJSONRequest=null,this._loaded=!0,b?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),m&&2!==m.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new l.ErrorEvent(b))):C&&(l.extend(this,C),C.bounds&&(this.tileBounds=new bn(C.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(C.tiles,this.map._requestManager._customAccessToken),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(b)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return l.extend({},this._options)}loadTile(r,c){const m=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(m,l.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(b.request.collectResourceTiming=this._collectResourceTiming,r.actor&&"expired"!==r.state)"loading"===r.state?r.reloadCallback=c:r.request=r.actor.send("reloadTile",b,C.bind(this));else if(r.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",b,C.bind(this),void 0,!0);else{const P=l.loadVectorTile.call({deduped:this._deduped},b,(R,z)=>{R||!z?C.call(this,R):(b.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},r.actor&&r.actor.send("loadTile",b,C.bind(this),void 0,!0))},!0);r.request={cancel:P}}function C(P,R){return delete r.request,r.aborted?c(null):P&&404!==P.status?c(P):(R&&R.resourceTiming&&(r.resourceTiming=R.resourceTiming),this.map._refreshExpiredTiles&&R&&r.setExpiryData(R),r.loadVectorData(R,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id})}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class qe extends l.Evented{constructor(r,c,m,b){super(),this.id=r,this.dispatcher=m,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},c),l.extend(this,l.pick(c,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Kt(this._options,this.map._requestManager,null,null,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new l.ErrorEvent(c)):m&&(l.extend(this,m),m.bounds&&(this.tileBounds=new bn(m.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(m.tiles),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(c)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return l.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,c){const m=l.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);r.request=l.getImage(this.map._requestManager.transformRequest(b,l.ResourceType.Tile),(C,P,R,z)=>(delete r.request,r.aborted?(r.state="unloaded",c(null)):C?(r.state="errored",c(C)):P?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:R,expires:z}),r.setTexture(P,this.map.painter),r.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(r,c,m){r.setTexture(c,m)}static unloadTileData(r,c){r.texture&&c.saveTileTexture(r.texture)}abortTile(r,c){r.request&&(r.request.cancel(),delete r.request),c()}unloadTile(r,c){r.texture&&this.map.painter.saveTileTexture(r.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function He(f,r,c,m,b,C,P,R){const z=[f,c,b,r,m,C,1,1,1],W=[P,R,1],q=l.adjoint([],z),[ae,fe,be]=l.transformMat3(W,W,l.transpose(q,q));return l.multiply$1(z,[ae,0,0,0,fe,0,0,0,be],z)}class pt extends l.Evented{constructor(r,c,m,b){super(),this.id=r,this.dispatcher=m,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=c,this._dirty=!1}load(r,c){this._loaded=c||!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(m,b)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new l.ErrorEvent(m));else if(b){const{HTMLImageElement:C}=l.window;this.image=b instanceof C?l.exported.getImageData(b):b,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const c=r.map(l.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let b=1/0,C=1/0,P=-1/0,R=-1/0;for(const ae of m)b=Math.min(b,ae.x),C=Math.min(C,ae.y),P=Math.max(P,ae.x),R=Math.max(R,ae.y);const z=Math.max(P-b,R-C),W=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),q=Math.pow(2,W);return new l.CanonicalTileID(W,Math.floor((b+P)/2*q),Math.floor((C+R)/2*q))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const z in this.tiles){const W=this.tiles[z];"loaded"!==W.state&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray)return;const c=l.tileTransform(this.tileID,this.map.transform.projection),[m,b,C,P]=this.coordinates.map(z=>{const W=c.projection.project(z[0],z[1]);return l.getTilePoint(c,W)._round()});this.perspectiveTransform=function(z,W,q,ae,fe,be,we,xe,De,le){const _e=He(0,0,z,0,0,W,z,W),Ie=He(q,ae,fe,be,we,xe,De,le);return l.multiply$1(Ie,l.adjoint(_e,_e),Ie),[Ie[6]/Ie[8]*z/l.EXTENT,Ie[7]/Ie[8]*W/l.EXTENT]}(this.width,this.height,m.x,m.y,b.x,b.y,P.x,P.y,C.x,C.y);const R=this._boundsArray=new l.StructArrayLayout4i8;R.emplaceBack(m.x,m.y,0,0),R.emplaceBack(b.x,b.y,l.EXTENT,0),R.emplaceBack(P.x,P.y,0,l.EXTENT),R.emplaceBack(C.x,C.y,l.EXTENT,l.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(R,l.boundsAttributes.members),this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,c=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new l.Texture(r,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,c){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},c(null)):(r.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ve={vector:fn,raster:qe,"raster-dem":class extends qe{constructor(f,r,c,m){super(f,r,c,m),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(f,r){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(b,C){b&&(f.state="errored",r(b)),C&&(f.dem=C,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",r(null))}f.request=l.getImage(this.map._requestManager.transformRequest(c,l.ResourceType.Tile),function(b,C,P,R){if(delete f.request,f.aborted)f.state="unloaded",r(null);else if(b)f.state="errored",r(b);else if(C){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:P,expires:R});const z=l.window.ImageBitmap&&C instanceof l.window.ImageBitmap&&(null==po&&(po=l.window.OffscreenCanvas&&new l.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof l.window.createImageBitmap),po),W=1-(C.width-l.prevPowerOfTwo(C.width))/2;W<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const q=z?C:l.exported.getImageData(C,W),ae={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:q,encoding:this.encoding,padding:W};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",ae,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const r=f.canonical,c=Math.pow(2,r.z),m=(r.x-1+c)%c,b=0===r.x?f.wrap-1:f.wrap,C=(r.x+1+c)%c,P=r.x+1===c?f.wrap+1:f.wrap,R={};return R[new l.OverscaledTileID(f.overscaledZ,b,r.z,m,r.y).key]={backfilled:!1},R[new l.OverscaledTileID(f.overscaledZ,P,r.z,C,r.y).key]={backfilled:!1},r.y>0&&(R[new l.OverscaledTileID(f.overscaledZ,b,r.z,m,r.y-1).key]={backfilled:!1},R[new l.OverscaledTileID(f.overscaledZ,f.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},R[new l.OverscaledTileID(f.overscaledZ,P,r.z,C,r.y-1).key]={backfilled:!1}),r.y+1<c&&(R[new l.OverscaledTileID(f.overscaledZ,b,r.z,m,r.y+1).key]={backfilled:!1},R[new l.OverscaledTileID(f.overscaledZ,f.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},R[new l.OverscaledTileID(f.overscaledZ,P,r.z,C,r.y+1).key]={backfilled:!1}),R}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends l.Evented{constructor(f,r,c,m){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=r.data,this._options=l.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const b=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*b,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*b,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:l.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*b,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},r),this}getClusterChildren(f,r){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},r),this}getClusterLeaves(f,r,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:r,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new l.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=l.extend({},this.workerOptions),r=this._data;"string"==typeof r?(f.request=this.map._requestManager.transformRequest(l.exported.resolveURL(r),l.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new l.ErrorEvent(c));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(b.resourceTiming=m.resourceTiming[this.id]),this.fire(new l.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,r){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(c,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,b)=>(delete f.request,f.unloadVectorData(),f.aborted?r(null):m?r(m):(f.loadVectorData(b,this.map.painter,"reloadTile"===c),r(null))),void 0,"loadTile"===c)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends pt{constructor(f,r,c,m){super(f,r,c,m),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const r of f.urls)this.urls.push(this.map._requestManager.transformRequest(r,l.ResourceType.Source).url);l.getVideo(this.urls,(r,c)=>{this._loaded=!0,r?this.fire(new l.ErrorEvent(r)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const r=this.video.seekable;f<r.start(0)||f>r.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,r=f.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new l.Texture(f,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:pt,canvas:class extends pt{constructor(f,r,c,m){super(f,r,c,m),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(C=>"number"!=typeof C))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof l.window.HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof l.window.HTMLCanvasElement?this.options.canvas:l.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends l.Evented{constructor(f,r,c,m){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=r,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new l.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new l.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new bn(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),l.extend(this,l.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return l.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:r,y:c,z:m}=f.canonical;return this._implementation.hasTile({x:r,y:c,z:m})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,r){const{x:c,y:m,z:b}=f.tileID.canonical,C=new l.window.AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:c,y:m,z:b},{signal:C.signal})).then(function(P){return delete f.request,f.aborted?(f.state="unloaded",r(null)):void 0===P?(f.state="errored",r(null)):null===P?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",r(null)):(R=P)instanceof l.window.ImageData||R instanceof l.window.HTMLCanvasElement||R instanceof l.window.ImageBitmap||R instanceof l.window.HTMLImageElement?(this.loadTileData(f,P),f.state="loaded",void r(null)):(f.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var R}.bind(this)).catch(P=>{20!==P.code&&(f.state="errored",r(P))}),f.request.cancel=()=>C.abort()}loadTileData(f,r){qe.loadTileData(f,r,this._map.painter)}unloadTileData(f){qe.unloadTileData(f,this._map.painter)}unloadTile(f,r){if(this.unloadTileData(f),this._implementation.unloadTile){const{x:c,y:m,z:b}=f.tileID.canonical;this._implementation.unloadTile({x:c,y:m,z:b})}r()}abortTile(f,r){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}}},mt=function(f,r,c,m){const b=new Ve[r.type](f,r,c,m);if(b.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${b.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],b),b};function Ut(f,r){const c=l.identity([]);return l.scale(c,c,[.5*f.width,.5*-f.height,1]),l.translate(c,c,[1,-1,0]),l.multiply(c,c,f.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(c)}function _n(f,r,c,m,b,C,P,R=!1){const z=f.tilesIn(m,P,R);z.sort(qn);const W=[];for(const ae of z)W.push({wrappedTileID:ae.tile.tileID.wrapped().key,queryResults:ae.tile.queryRenderedFeatures(r,c,f._state,ae,b,C,Ut(f.transform,ae.tile.tileID),R)});const q=function(ae){const fe={},be={};for(const we of ae){const xe=we.queryResults,De=we.wrappedTileID,le=be[De]=be[De]||{};for(const _e in xe){const Ie=xe[_e],Pe=le[_e]=le[_e]||{},Qe=fe[_e]=fe[_e]||[];for(const tt of Ie)Pe[tt.featureIndex]||(Pe[tt.featureIndex]=!0,Qe.push(tt))}}return fe}(W);for(const ae in q)q[ae].forEach(fe=>{const be=fe.feature,we=be.layer;we&&"background"!==we.type&&"sky"!==we.type&&(be.source=we.source,we["source-layer"]&&(be.sourceLayer=we["source-layer"]),be.state=void 0!==be.id?f.getFeatureState(we["source-layer"],be.id):{})});return q}function Gn(f,r){const c=f.getRenderableIds().map(C=>f.getTileByID(C)),m=[],b={};for(let C=0;C<c.length;C++){const P=c[C],R=P.tileID.canonical.key;b[R]||(b[R]=!0,P.querySourceFeatures(m,r))}return m}function qn(f,r){const c=f.tileID,m=r.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function _i(){return null!=Js.workerClass?new Js.workerClass:new l.window.Worker(Js.workerUrl)}const Cr="mapboxgl_preloaded_worker_pool";class ur{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<ur.workerCount;)this.workers.push(new _i);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Cr]}numActive(){return Object.keys(this.active).length}}let lt;function Be(){return lt||(lt=new ur),lt}function Ft(f,r){const c={};for(const m in f)"ref"!==m&&(c[m]=f[m]);return l.refProperties.forEach(m=>{m in r&&(c[m]=r[m])}),c}function Rt(f){f=f.slice();const r=Object.create(null);for(let c=0;c<f.length;c++)r[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=Ft(f[c],r[f[c].ref]));return f}ur.workerCount=2;const en={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function wn(f,r,c){c.push({command:en.addSource,args:[f,r[f]]})}function Kn(f,r,c){r.push({command:en.removeSource,args:[f]}),c[f]=!0}function An(f,r,c,m){Kn(f,c,m),wn(f,r,c)}function qi(f,r,c){let m;for(m in f[c])if(f[c].hasOwnProperty(m)&&"data"!==m&&!ge(f[c][m],r[c][m]))return!1;for(m in r[c])if(r[c].hasOwnProperty(m)&&"data"!==m&&!ge(f[c][m],r[c][m]))return!1;return!0}function Ci(f,r,c,m,b,C){let P;for(P in r=r||{},f=f||{})f.hasOwnProperty(P)&&(ge(f[P],r[P])||c.push({command:C,args:[m,P,r[P],b]}));for(P in r)r.hasOwnProperty(P)&&!f.hasOwnProperty(P)&&(ge(f[P],r[P])||c.push({command:C,args:[m,P,r[P],b]}))}function dr(f){return f.id}function Mo(f,r){return f[r.id]=r,f}class Ar{constructor(r,c){this.reset(r,c)}reset(r,c){this.points=r||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=l.clamp(r,0,1);let c=1,m=this._distances[c];const b=r*this.paddedLength+this.padding;for(;m<b&&c<this._distances.length;)m=this._distances[++c];const C=c-1,P=this._distances[C],R=m-P,z=R>0?(b-P)/R:0;return this.points[C].mult(1-z).add(this.points[c].mult(z))}}class Jr{constructor(r,c,m){const b=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(r/m),this.yCellCount=Math.ceil(c/m);for(let P=0;P<this.xCellCount*this.yCellCount;P++)b.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=c,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,c,m,b,C){this._forEachCell(c,m,b,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(C)}insertCircle(r,c,m,b){this._forEachCell(c-b,m-b,c+b,m+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(c),this.circles.push(m),this.circles.push(b)}_insertBoxCell(r,c,m,b,C,P){this.boxCells[C].push(P)}_insertCircleCell(r,c,m,b,C,P){this.circleCells[C].push(P)}_query(r,c,m,b,C,P){if(m<0||r>this.width||b<0||c>this.height)return!C&&[];const R=[];if(r<=0&&c<=0&&this.width<=m&&this.height<=b){if(C)return!0;for(let z=0;z<this.boxKeys.length;z++)R.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const W=this.circles[3*z],q=this.circles[3*z+1],ae=this.circles[3*z+2];R.push({key:this.circleKeys[z],x1:W-ae,y1:q-ae,x2:W+ae,y2:q+ae})}return P?R.filter(P):R}return this._forEachCell(r,c,m,b,this._queryCell,R,{hitTest:C,seenUids:{box:{},circle:{}}},P),C?R.length>0:R}_queryCircle(r,c,m,b,C){const P=r-m,R=r+m,z=c-m,W=c+m;if(R<0||P>this.width||W<0||z>this.height)return!b&&[];const q=[];return this._forEachCell(P,z,R,W,this._queryCellCircle,q,{hitTest:b,circle:{x:r,y:c,radius:m},seenUids:{box:{},circle:{}}},C),b?q.length>0:q}query(r,c,m,b,C){return this._query(r,c,m,b,!1,C)}hitTest(r,c,m,b,C){return this._query(r,c,m,b,!0,C)}hitTestCircle(r,c,m,b){return this._queryCircle(r,c,m,!0,b)}_queryCell(r,c,m,b,C,P,R,z){const W=R.seenUids,q=this.boxCells[C];if(null!==q){const fe=this.bboxes;for(const be of q)if(!W.box[be]){W.box[be]=!0;const we=4*be;if(r<=fe[we+2]&&c<=fe[we+3]&&m>=fe[we+0]&&b>=fe[we+1]&&(!z||z(this.boxKeys[be]))){if(R.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[be],x1:fe[we],y1:fe[we+1],x2:fe[we+2],y2:fe[we+3]})}}}const ae=this.circleCells[C];if(null!==ae){const fe=this.circles;for(const be of ae)if(!W.circle[be]){W.circle[be]=!0;const we=3*be;if(this._circleAndRectCollide(fe[we],fe[we+1],fe[we+2],r,c,m,b)&&(!z||z(this.circleKeys[be]))){if(R.hitTest)return P.push(!0),!0;{const xe=fe[we],De=fe[we+1],le=fe[we+2];P.push({key:this.circleKeys[be],x1:xe-le,y1:De-le,x2:xe+le,y2:De+le})}}}}}_queryCellCircle(r,c,m,b,C,P,R,z){const W=R.circle,q=R.seenUids,ae=this.boxCells[C];if(null!==ae){const be=this.bboxes;for(const we of ae)if(!q.box[we]){q.box[we]=!0;const xe=4*we;if(this._circleAndRectCollide(W.x,W.y,W.radius,be[xe+0],be[xe+1],be[xe+2],be[xe+3])&&(!z||z(this.boxKeys[we])))return P.push(!0),!0}}const fe=this.circleCells[C];if(null!==fe){const be=this.circles;for(const we of fe)if(!q.circle[we]){q.circle[we]=!0;const xe=3*we;if(this._circlesCollide(be[xe],be[xe+1],be[xe+2],W.x,W.y,W.radius)&&(!z||z(this.circleKeys[we])))return P.push(!0),!0}}}_forEachCell(r,c,m,b,C,P,R,z){const W=this._convertToXCellCoord(r),q=this._convertToYCellCoord(c),ae=this._convertToXCellCoord(m),fe=this._convertToYCellCoord(b);for(let be=W;be<=ae;be++)for(let we=q;we<=fe;we++)if(C.call(this,r,c,m,b,this.xCellCount*we+be,P,R,z))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,c,m,b,C,P){const R=b-r,z=C-c,W=m+P;return W*W>R*R+z*z}_circleAndRectCollide(r,c,m,b,C,P,R){const z=(P-b)/2,W=Math.abs(r-(b+z));if(W>z+m)return!1;const q=(R-C)/2,ae=Math.abs(c-(C+q));if(ae>q+m)return!1;if(W<=z||ae<=q)return!0;const fe=W-z,be=ae-q;return fe*fe+be*be<=m*m}}const So={unknown:0,flipRequired:1,flipNotRequired:2},qo=Math.tan(85*Math.PI/180);function xt(f,r,c,m,b,C,P){const R=l.create();if(c)if("globe"===C.name){const z=l.calculateGlobeLabelMatrix(b,r);l.multiply(R,R,z)}else{const z=Ze([],P);R[0]=z[0],R[1]=z[1],R[4]=z[2],R[5]=z[3],m||l.rotateZ(R,R,b.angle)}else l.multiply(R,b.labelPlaneMatrix,f);return R}function Xi(f,r,c,m,b,C,P){const R=xt(f,r,c,m,b,C,P);return"globe"===C.name&&c||(R[2]=R[6]=R[10]=R[14]=0),R}function ar(f,r,c,m,b,C,P){if(c){if("globe"===C.name){const R=xt(f,r,c,m,b,C,P);return l.invert(R,R),l.multiply(R,f,R),R}{const R=l.clone(f),z=l.identity([]);return z[0]=P[0],z[1]=P[1],z[4]=P[2],z[5]=P[3],l.multiply(R,R,z),m||l.rotateZ(R,R,-b.angle),R}}return b.glCoordMatrix}function Lr(f,r,c,m){const b=[f,r,c,1];c?l.transformMat4$1(b,b,m):Bi(b,b,m);const C=b[3];return b[0]/=C,b[1]/=C,b[2]/=C,b}function Wr(f,r){return Math.min(.5+f/r*.5,1.5)}function ao(f,r){const c=f[0]/f[3],m=f[1]/f[3];return c>=-r[0]&&c<=r[0]&&m>=-r[1]&&m<=r[1]}function Vo(f,r,c,m,b,C,P,R,z,W){const q=c.transform,ae=m?f.textSizeData:f.iconSizeData,fe=l.evaluateSizeForZoom(ae,c.transform.zoom),be="globe"===q.projection.name,we=[256/c.width*2+1,256/c.height*2+1],xe=m?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;xe.clear();let De=null;be&&(De=m?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const le=f.lineVertexArray,_e=m?f.text.placedSymbolArray:f.icon.placedSymbolArray,Ie=c.transform.width/c.transform.height;let Pe,Qe=!1;for(let tt=0;tt<_e.length;tt++){const et=_e.get(tt),{numGlyphs:gt,writingMode:st}=et;if(st!==l.WritingMode.vertical||Qe||Pe===l.WritingMode.horizontal||(Qe=!0),Pe=st,(et.hidden||st===l.WritingMode.vertical)&&!Qe){jo(gt,xe);continue}Qe=!1;const Mt=new l.Point(et.tileAnchorX,et.tileAnchorY);let{x:pn,y:Ct,z:Qt}=q.projection.projectTilePoint(Mt.x,Mt.y,W.canonical);if(z){const[Ai,Hn,wi]=z(Mt);pn+=Ai,Ct+=Hn,Qt+=wi}const kt=[pn,Ct,Qt,1];if(l.transformMat4$1(kt,kt,r),!ao(kt,we)){jo(gt,xe);continue}const mn=Wr(c.transform.cameraToCenterDistance,kt[3]),It=l.evaluateSizeForFeature(ae,fe,et),Jt=P?It/mn:It*mn,En=Lr(pn,Ct,Qt,b);if(En[3]<=0){jo(gt,xe);continue}let ln={};const Cn=P?null:z,ai=Sn(et,Jt,!1,R,r,b,C,f.glyphOffsetArray,le,xe,De,En,Mt,ln,Ie,Cn,q.projection,W,P);Qe=ai.useVertical,Cn&&ai.needsFlipping&&(ln={}),(ai.notEnoughRoom||Qe||ai.needsFlipping&&Sn(et,Jt,!0,R,r,b,C,f.glyphOffsetArray,le,xe,De,En,Mt,ln,Ie,Cn,q.projection,W,P).notEnoughRoom)&&jo(gt,xe)}m?(f.text.dynamicLayoutVertexBuffer.updateData(xe),De&&f.text.globeExtVertexBuffer.updateData(De)):(f.icon.dynamicLayoutVertexBuffer.updateData(xe),De&&f.icon.globeExtVertexBuffer.updateData(De))}function Pr(f,r,c,m,b,C,P,R,z,W,q,ae,fe,be,we,xe){const{lineStartIndex:De,glyphStartIndex:le,segment:_e}=R,Ie=le+R.numGlyphs,Pe=De+R.lineLength,Qe=r.getoffsetX(le),tt=r.getoffsetX(Ie-1),et=mo(f*Qe,c,m,b,C,P,_e,De,Pe,z,W,q,ae,fe,!0,be,we,xe);if(!et)return null;const gt=mo(f*tt,c,m,b,C,P,_e,De,Pe,z,W,q,ae,fe,!0,be,we,xe);return gt?{first:et,last:gt}:null}function gs(f,r,c,m){return f===l.WritingMode.horizontal&&Math.abs(m)>Math.abs(c)?{useVertical:!0}:f===l.WritingMode.vertical?m>0?{needsFlipping:!0}:null:r!==So.unknown&&(0===(b=c)||Math.abs(m/b)>qo)?r===So.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null;var b}function Sn(f,r,c,m,b,C,P,R,z,W,q,ae,fe,be,we,xe,De,le,_e){const Ie=r/24,Pe=f.lineOffsetX*Ie,Qe=f.lineOffsetY*Ie,{lineStartIndex:tt,glyphStartIndex:et,numGlyphs:gt,segment:st,writingMode:Mt,flipState:pn}=f,Ct=tt+f.lineLength,Qt=kt=>{if(q){const[En,ln,Cn]=kt.up,ai=W.length;l.updateGlobeVertexNormal(q,ai+0,En,ln,Cn),l.updateGlobeVertexNormal(q,ai+1,En,ln,Cn),l.updateGlobeVertexNormal(q,ai+2,En,ln,Cn),l.updateGlobeVertexNormal(q,ai+3,En,ln,Cn)}const[mn,It,Jt]=kt.point;l.addDynamicAttributes(W,mn,It,Jt,kt.angle)};if(gt>1){const kt=Pr(Ie,R,Pe,Qe,c,ae,fe,f,z,C,be,xe,!1,De,le,_e);if(!kt)return{notEnoughRoom:!0};if(m&&!c){let[mn,It,Jt]=kt.first.point,[En,ln,Cn]=kt.last.point;[mn,It]=Lr(mn,It,Jt,P),[En,ln]=Lr(En,ln,Cn,P);const ai=gs(Mt,pn,(En-mn)*we,ln-It);if(f.flipState=ai&&ai.needsFlipping?So.flipRequired:So.flipNotRequired,ai)return ai}Qt(kt.first);for(let mn=et+1;mn<et+gt-1;mn++){const It=mo(Ie*R.getoffsetX(mn),Pe,Qe,c,ae,fe,st,tt,Ct,z,C,be,xe,!1,!1,De,le,_e);if(!It)return W.length-=4*(mn-et),{notEnoughRoom:!0};Qt(It)}Qt(kt.last)}else{if(m&&!c){const mn=Lr(fe.x,fe.y,0,b),It=tt+st+1,Jt=new l.Point(z.getx(It),z.gety(It)),En=Lr(Jt.x,Jt.y,0,b),ln=En[3]>0?En:mi(fe,Jt,mn,1,b,void 0,De,le.canonical),Cn=gs(Mt,pn,(ln[0]-mn[0])*we,ln[1]-mn[1]);if(f.flipState=Cn&&Cn.needsFlipping?So.flipRequired:So.flipNotRequired,Cn)return Cn}const kt=mo(Ie*R.getoffsetX(et),Pe,Qe,c,ae,fe,st,tt,Ct,z,C,be,xe,!1,!1,De,le,_e);if(!kt)return{notEnoughRoom:!0};Qt(kt)}return{}}function ci(f,r,c,m,b){const{x:C,y:P,z:R}=m.projectTilePoint(f.x,f.y,r);if(!b)return Lr(C,P,R,c);const[z,W,q]=b(f);return Lr(C+z,P+W,R+q,c)}function mi(f,r,c,m,b,C,P,R){const z=ci(f.sub(r)._unit()._add(f),R,b,P,C);return l.sub(z,c,z),l.normalize(z,z),l.scaleAndAdd(z,c,z,m)}function mo(f,r,c,m,b,C,P,R,z,W,q,ae,fe,be,we,xe,De,le){const _e=m?f-r:f+r;let Ie=_e>0?1:-1,Pe=0;m&&(Ie*=-1,Pe=Math.PI),Ie<0&&(Pe+=Math.PI);let Qe=R+P+(Ie>0?0:1)|0,tt=b,et=b,gt=0,st=0;const Mt=Math.abs(_e),pn=[],Ct=[];let Qt=C,kt=Qt;const mn=()=>mi(kt,Qt,et,Mt-gt+1,q,fe,xe,De.canonical);for(;gt+st<=Mt;){if(Qe+=Ie,Qe<R||Qe>=z)return null;if(et=tt,kt=Qt,pn.push(et),be&&Ct.push(kt),Qt=new l.Point(W.getx(Qe),W.gety(Qe)),tt=ae[Qe],!tt){const wi=ci(Qt,De.canonical,q,xe,fe);tt=wi[3]>0?ae[Qe]=wi:mn()}gt+=st,st=l.distance(et,tt)}we&&fe&&(ae[Qe]&&(tt=mn(),st=l.distance(et,tt)),ae[Qe]=tt);const It=(Mt-gt)/st,Jt=Qt.sub(kt)._mult(It)._add(kt),En=l.sub([],tt,et),ln=l.scaleAndAdd([],et,En,It);let Cn=[0,0,1],ai=En[0],Ai=En[1];if(le&&(Cn=xe.upVector(De.canonical,Jt.x,Jt.y),0!==Cn[0]||0!==Cn[1]||1!==Cn[2])){const wi=[Cn[2],0,-Cn[0]],rr=l.cross([],Cn,wi);l.normalize(wi,wi),l.normalize(rr,rr),ai=l.dot(En,wi),Ai=l.dot(En,rr)}if(c){const wi=l.cross([],Cn,En);l.normalize(wi,wi),l.scaleAndAdd(ln,ln,wi,c*Ie)}const Hn=Pe+Math.atan2(Ai,ai);return pn.push(ln),be&&Ct.push(Jt),{point:ln,angle:Hn,path:pn,tilePath:Ct,up:Cn}}function jo(f,r){const c=r.length,m=c+4*f;r.resize(m),r.float32.fill(-1/0,4*c,4*m)}function Bi(f,r,c){const m=r[0],b=r[1];return f[0]=c[0]*m+c[4]*b+c[12],f[1]=c[1]*m+c[5]*b+c[13],f[3]=c[3]*m+c[7]*b+c[15],f}const wo=100;class da{constructor(r,c,m=new Jr(r.width+200,r.height+200,25),b=new Jr(r.width+200,r.height+200,25)){this.transform=r,this.grid=m,this.ignoredGrid=b,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+wo,this.screenBottomBoundary=r.height+wo,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=c}placeCollisionBox(r,c,m,b,C,P,R,z){let W=m.projectedAnchorX,q=m.projectedAnchorY,ae=m.projectedAnchorZ;const fe=m.elevation,be=m.tileID,we=r.getProjection();if(fe&&be){const[tt,et,gt]=we.upVector(be.canonical,m.tileAnchorX,m.tileAnchorY),st=we.upVectorScale(be.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;W+=tt*fe*st,q+=et*fe*st,ae+=gt*fe*st}const xe=this.projectAndGetPerspectiveRatio(R,W,q,ae,m.tileID,"globe"===we.name||!!fe||this.transform.pitch>0,we),De=P*xe.perspectiveRatio,le=(m.x1*c+b.x-m.padding)*De+xe.point.x,_e=(m.y1*c+b.y-m.padding)*De+xe.point.y,Ie=(m.x2*c+b.x+m.padding)*De+xe.point.x,Pe=(m.y2*c+b.y+m.padding)*De+xe.point.y,Qe=xe.perspectiveRatio<=.55||xe.occluded;return!this.isInsideGrid(le,_e,Ie,Pe)||!C&&this.grid.hitTest(le,_e,Ie,Pe,z)||Qe?{box:[],offscreen:!1,occluded:xe.occluded}:{box:[le,_e,Ie,Pe],offscreen:this.isOffscreen(le,_e,Ie,Pe),occluded:!1}}placeCollisionCircles(r,c,m,b,C,P,R,z,W,q,ae,fe,be,we,xe){const De=[],le=this.transform.elevation,_e=r.getProjection(),Ie=le?le.getAtTileOffsetFunc(xe,this.transform.center.lat,this.transform.worldSize,_e):null,Pe=new l.Point(m.tileAnchorX,m.tileAnchorY);let{x:Qe,y:tt,z:et}=_e.projectTilePoint(Pe.x,Pe.y,xe.canonical);if(Ie){const[Jt,En,ln]=Ie(Pe);Qe+=Jt,tt+=En,et+=ln}const gt="globe"===_e.name,st=this.projectAndGetPerspectiveRatio(R,Qe,tt,et,xe,gt||!!le||this.transform.pitch>0,_e),{perspectiveRatio:Mt}=st,pn=(ae?P/Mt:P*Mt)/l.ONE_EM,Ct=Lr(Qe,tt,et,z),Qt=st.signedDistanceFromCamera>0?Pr(pn,C,m.lineOffsetX*pn,m.lineOffsetY*pn,!1,Ct,Pe,m,b,z,{},le&&!ae?Ie:null,ae&&!!le,_e,xe,ae):null;let kt=!1,mn=!1,It=!0;if(Qt&&!st.occluded){const Jt=.5*be*Mt+we,En=new l.Point(-100,-100),ln=new l.Point(this.screenRightBoundary,this.screenBottomBoundary),Cn=new Ar,{first:ai,last:Ai}=Qt,Hn=ai.path.length;let wi=[];for(let Qn=Hn-1;Qn>=1;Qn--)wi.push(ai.path[Qn]);for(let Qn=1;Qn<Ai.path.length;Qn++)wi.push(Ai.path[Qn]);const rr=2.5*Jt;W&&(wi=wi.map(([Qn,yr,or],Ir)=>(Ie&&!gt&&(or=Ie(Ir<Hn-1?ai.tilePath[Hn-1-Ir]:Ai.tilePath[Ir-Hn+2])[2]),Lr(Qn,yr,or,W))),wi.some(Qn=>Qn[3]<=0)&&(wi=[]));let er=[];if(wi.length>0){let Qn=1/0,yr=-1/0,or=1/0,Ir=-1/0;for(const $r of wi)Qn=Math.min(Qn,$r[0]),or=Math.min(or,$r[1]),yr=Math.max(yr,$r[0]),Ir=Math.max(Ir,$r[1]);yr>=En.x&&Qn<=ln.x&&Ir>=En.y&&or<=ln.y&&(er=[wi.map($r=>new l.Point($r[0],$r[1]))],(Qn<En.x||yr>ln.x||or<En.y||Ir>ln.y)&&(er=l.clipLine(er,En.x,En.y,ln.x,ln.y)))}for(const Qn of er){Cn.reset(Qn,.25*Jt);let yr=0;yr=Cn.length<=.5*Jt?1:Math.ceil(Cn.paddedLength/rr)+1;for(let or=0;or<yr;or++){const Ir=or/Math.max(yr-1,1),$r=Cn.lerp(Ir),Rs=$r.x+wo,Wo=$r.y+wo;De.push(Rs,Wo,Jt,0);const ya=Rs-Jt,Vs=Wo-Jt,Or=Rs+Jt,hr=Wo+Jt;if(It=It&&this.isOffscreen(ya,Vs,Or,hr),mn=mn||this.isInsideGrid(ya,Vs,Or,hr),!c&&this.grid.hitTestCircle(Rs,Wo,Jt,fe)&&(kt=!0,!q))return{circles:[],offscreen:!1,collisionDetected:kt,occluded:!1}}}}return{circles:!q&&kt||!mn?[]:De,offscreen:It,collisionDetected:kt,occluded:st.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let m=1/0,b=1/0,C=-1/0,P=-1/0;for(const q of r){const ae=new l.Point(q.x+wo,q.y+wo);m=Math.min(m,ae.x),b=Math.min(b,ae.y),C=Math.max(C,ae.x),P=Math.max(P,ae.y),c.push(ae)}const R=this.grid.query(m,b,C,P).concat(this.ignoredGrid.query(m,b,C,P)),z={},W={};for(const q of R){const ae=q.key;if(void 0===z[ae.bucketInstanceId]&&(z[ae.bucketInstanceId]={}),z[ae.bucketInstanceId][ae.featureIndex])continue;const fe=[new l.Point(q.x1,q.y1),new l.Point(q.x2,q.y1),new l.Point(q.x2,q.y2),new l.Point(q.x1,q.y2)];l.polygonIntersectsPolygon(c,fe)&&(z[ae.bucketInstanceId][ae.featureIndex]=!0,void 0===W[ae.bucketInstanceId]&&(W[ae.bucketInstanceId]=[]),W[ae.bucketInstanceId].push(ae.featureIndex))}return W}insertCollisionBox(r,c,m,b,C){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:C},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,c,m,b,C){const P=c?this.ignoredGrid:this.grid,R={bucketInstanceId:m,featureIndex:b,collisionGroupID:C};for(let z=0;z<r.length;z+=4)P.insertCircle(R,r[z],r[z+1],r[z+2])}projectAndGetPerspectiveRatio(r,c,m,b,C,P,R){const z=[c,m,b,1];let W=!1;b||this.transform.pitch>0?(l.transformMat4$1(z,z,r),this.fogState&&C&&"globe"!==R.name&&(W=function(fe,be,we,xe,De,le){const _e=le.calculateFogTileMatrix(De),Ie=[be,we,xe];return l.transformMat4(Ie,Ie,_e),Li(fe,Ie,le.pitch,le._fov)}(this.fogState,c,m,b,C.toUnwrapped(),this.transform)>.9)):Bi(z,z,r);const q=z[3];return{point:new l.Point((z[0]/q+1)/2*this.transform.width+wo,(-z[1]/q+1)/2*this.transform.height+wo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(R)/q*.5,1.5),signedDistanceFromCamera:q,occluded:P&&z[2]>q||W}}isOffscreen(r,c,m,b){return m<wo||r>=this.screenRightBoundary||b<wo||c>this.screenBottomBoundary}isInsideGrid(r,c,m,b){return m>=0&&r<this.gridRightBoundary&&b>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const r=l.identity([]);return l.translate(r,r,[-100,-100,0]),r}}function ks(f,r,c){const m=r.createTileMatrix(f,f.worldSize,c.toUnwrapped());return l.multiply(new Float32Array(16),f.projMatrix,m)}function ts(f,r,c){if(r.projection.name===c.projection.name)return f.projMatrix;const m=c.clone();return m.setProjection(r.projection),ks(m,r.getProjection(),f)}function Ur(f,r,c){return r.name===c.projection.name?f.projMatrix:ks(c,r,f)}class ls{constructor(r,c,m,b){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?c:-c))):b&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class Oe{constructor(r,c,m,b,C,P=!1){this.text=new ls(r?r.text:null,c,m,C),this.icon=new ls(r?r.icon:null,c,b,C),this.clipped=P}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ot{constructor(r,c,m,b=!1){this.text=r,this.icon=c,this.skipFade=m,this.clipped=b}}class tn{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class bt{constructor(r,c,m,b,C){this.bucketInstanceId=r,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=b,this.tileID=C}}class yn{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const c=++this.maxGroupID;this.collisionGroups[r]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[r]}}function Nn(f,r,c,m,b){const{horizontalAlign:C,verticalAlign:P}=l.getAnchorAlignment(f),R=-(C-.5)*r,z=-(P-.5)*c,W=l.evaluateVariableOffset(f,m);return new l.Point(R+W[0]*b,z+W[1]*b)}function xi(f,r,c,m,b){const C=new l.Point(f,r);return c&&C._rotate(m?b:-b),C}class Sr{constructor(r,c,m,b,C){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new da(this.transform,C),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new yn(m),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,c,m,b){const C=m.getBucket(c),P=m.latestFeatureIndex;if(!C||!P||c.id!==C.layerIds[0])return;const R=C.layers[0].layout,z=m.collisionBoxArray,W=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),q=m.tileSize/l.EXTENT,ae=m.tileID.toUnwrapped();this.transform.setProjection(C.projection);const fe=(be=m.tileID,we=C.getProjection(),xe=this.transform,we.name===this.projection?xe.calculateProjMatrix(be.toUnwrapped()):ks(xe,we,be));var be,we,xe;const De="map"===R.get("text-pitch-alignment"),le="map"===R.get("text-rotation-alignment");c.compileFilter();const _e=c.dynamicFilter(),Ie=c.dynamicFilterNeedsFeature(),Pe=this.transform.calculatePixelsToTileUnitsMatrix(m),Qe=Xi(fe,m.tileID.canonical,De,le,this.transform,C.getProjection(),Pe);let tt=null;if(De){const st=ar(fe,m.tileID.canonical,De,le,this.transform,C.getProjection(),Pe);tt=l.multiply([],this.transform.labelPlaneMatrix,st)}let et=null;_e&&m.latestFeatureIndex&&(et={unwrappedTileID:ae,dynamicFilter:_e,dynamicFilterNeedsFeature:Ie,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new bt(C.bucketInstanceId,P,C.sourceLayerIndex,C.index,m.tileID);const gt={bucket:C,layout:R,posMatrix:fe,textLabelPlaneMatrix:Qe,labelToScreenMatrix:tt,clippingData:et,scale:W,textPixelRatio:q,holdingForFade:m.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:l.evaluateSizeForZoom(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(b)for(const st of C.sortKeyRanges){const{sortKey:Mt,symbolInstanceStart:pn,symbolInstanceEnd:Ct}=st;r.push({sortKey:Mt,symbolInstanceStart:pn,symbolInstanceEnd:Ct,parameters:gt})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:gt})}attemptAnchorPlacement(r,c,m,b,C,P,R,z,W,q,ae,fe,be,we,xe,De,le,_e){const{textOffset0:Ie,textOffset1:Pe,crossTileID:Qe}=fe,tt=[Ie,Pe],et=Nn(r,m,b,tt,C),gt=this.collisionIndex.placeCollisionBox(we,C,c,xi(et.x,et.y,P,R,this.transform.angle),ae,z,W,q.predicate);if(De){const st=we.getSymbolInstanceIconSize(_e,this.transform.zoom,fe.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(we,st,De,xi(et.x,et.y,P,R,this.transform.angle),ae,z,W,q.predicate).box.length)return}if(gt.box.length>0){let st;return this.prevPlacement&&this.prevPlacement.variableOffsets[Qe]&&this.prevPlacement.placements[Qe]&&this.prevPlacement.placements[Qe].text&&(st=this.prevPlacement.variableOffsets[Qe].anchor),this.variableOffsets[Qe]={textOffset:tt,width:m,height:b,anchor:r,textScale:C,prevAnchor:st},this.markUsedJustification(we,r,fe,xe),we.allowVerticalPlacement&&(this.markUsedOrientation(we,xe,fe),this.placedOrientations[Qe]=xe),{shift:et,placedGlyphBoxes:gt}}}placeLayerBucketPart(r,c,m,b){const{bucket:C,layout:P,posMatrix:R,textLabelPlaneMatrix:z,labelToScreenMatrix:W,clippingData:q,textPixelRatio:ae,holdingForFade:fe,collisionBoxArray:be,partiallyEvaluatedTextSize:we,partiallyEvaluatedIconSize:xe,collisionGroup:De}=r.parameters,le=P.get("text-optional"),_e=P.get("icon-optional"),Ie=P.get("text-allow-overlap"),Pe=P.get("icon-allow-overlap"),Qe="map"===P.get("text-rotation-alignment"),tt="map"===P.get("text-pitch-alignment"),et="none"!==P.get("icon-text-fit"),gt="viewport-y"===P.get("symbol-z-order");this.transform.setProjection(C.projection);let st=Ie&&(Pe||!C.hasIconData()||_e),Mt=Pe&&(Ie||!C.hasTextData()||le);!C.collisionArrays&&be&&C.deserializeCollisionBoxes(be),m&&b&&C.updateCollisionDebugBuffers(this.transform.zoom,be);const pn=(Ct,Qt,kt)=>{const{crossTileID:mn,numVerticalGlyphVertices:It}=Ct;if(q){const Or={zoom:this.transform.zoom,pitch:this.transform.pitch};let hr=null;if(q.dynamicFilterNeedsFeature){const pr=this.retainedQueryData[C.bucketInstanceId];hr=q.featureIndex.loadFeature({featureIndex:Ct.featureIndex,bucketIndex:pr.bucketIndex,sourceLayerIndex:pr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,q.dynamicFilter)(Or,hr,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new l.Point(Ct.tileAnchorX,Ct.tileAnchorY),this.transform.calculateDistanceTileData(q.unwrappedTileID)))return this.placements[mn]=new Ot(!1,!1,!1,!0),void c.add(mn)}if(c.has(mn))return;if(fe)return void(this.placements[mn]=new Ot(!1,!1,!1));let Jt=!1,En=!1,ln=!0,Cn=!1,ai=!1,Ai=null,Hn={box:null,offscreen:null,occluded:null},wi={box:null,offscreen:null,occluded:null},rr=null,er=null,Qn=null,yr=0,or=0,Ir=0;kt.textFeatureIndex?yr=kt.textFeatureIndex:Ct.useRuntimeCollisionCircles&&(yr=Ct.featureIndex),kt.verticalTextFeatureIndex&&(or=kt.verticalTextFeatureIndex);const $r=Or=>{Or.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const hr=this.transform.elevation;(hr||Or.elevation)&&(Or.elevation=hr?hr.getAtTileOffset(Or.tileID,Or.tileAnchorX,Or.tileAnchorY):0)},Rs=kt.textBox;if(Rs){$r(Rs);const Or=pr=>{let Jo=l.WritingMode.horizontal;if(C.allowVerticalPlacement&&!pr&&this.prevPlacement){const ds=this.prevPlacement.placedOrientations[mn];ds&&(this.placedOrientations[mn]=ds,Jo=ds,this.markUsedOrientation(C,Jo,Ct))}return Jo},hr=(pr,Jo)=>{if(C.allowVerticalPlacement&&It>0&&kt.verticalTextBox){for(const ds of C.writingModes)if(ds===l.WritingMode.vertical?(Hn=Jo(),wi=Hn):Hn=pr(),Hn&&Hn.box&&Hn.box.length)break}else Hn=pr()};if(P.get("text-variable-anchor")){let pr=P.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[mn]){const Hr=this.prevPlacement.variableOffsets[mn];pr.indexOf(Hr.anchor)>0&&(pr=pr.filter(ka=>ka!==Hr.anchor),pr.unshift(Hr.anchor))}const Jo=(Hr,ka,Dd)=>{const Ol=C.getSymbolInstanceTextSize(we,Ct,this.transform.zoom,Qt),Nc=(Hr.x2-Hr.x1)*Ol+2*Hr.padding,fc=(Hr.y2-Hr.y1)*Ol+2*Hr.padding,Bc=et&&!Pe?ka:null;Bc&&$r(Bc);let fu={box:[],offscreen:!1,occluded:!1};const dh=Ie?2*pr.length:pr.length;for(let El=0;El<dh;++El){const Td=this.attemptAnchorPlacement(pr[El%pr.length],Hr,Nc,fc,Ol,Qe,tt,ae,R,De,El>=pr.length,Ct,Qt,C,Dd,Bc,we,xe);if(Td&&(fu=Td.placedGlyphBoxes,fu&&fu.box&&fu.box.length)){Jt=!0,Ai=Td.shift;break}}return fu};hr(()=>Jo(Rs,kt.iconBox,l.WritingMode.horizontal),()=>{const Hr=kt.verticalTextBox;return Hr&&$r(Hr),C.allowVerticalPlacement&&!(Hn&&Hn.box&&Hn.box.length)&&It>0&&Hr?Jo(Hr,kt.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Hn&&(Jt=Hn.box,ln=Hn.offscreen,Cn=Hn.occluded);const ds=Or(!(!Hn||!Hn.box));if(!Jt&&this.prevPlacement){const Hr=this.prevPlacement.variableOffsets[mn];Hr&&(this.variableOffsets[mn]=Hr,this.markUsedJustification(C,Hr.anchor,Ct,ds))}}else{const pr=(Jo,ds)=>{const Hr=C.getSymbolInstanceTextSize(we,Ct,this.transform.zoom,Qt),ka=this.collisionIndex.placeCollisionBox(C,Hr,Jo,new l.Point(0,0),Ie,ae,R,De.predicate);return ka&&ka.box&&ka.box.length&&(this.markUsedOrientation(C,ds,Ct),this.placedOrientations[mn]=ds),ka};hr(()=>pr(Rs,l.WritingMode.horizontal),()=>{const Jo=kt.verticalTextBox;return C.allowVerticalPlacement&&It>0&&Jo?($r(Jo),pr(Jo,l.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Or(!!(Hn&&Hn.box&&Hn.box.length))}}if(rr=Hn,Jt=rr&&rr.box&&rr.box.length>0,ln=rr&&rr.offscreen,Cn=rr&&rr.occluded,Ct.useRuntimeCollisionCircles){const Or=C.text.placedSymbolArray.get(Ct.centerJustifiedTextSymbolIndex>=0?Ct.centerJustifiedTextSymbolIndex:Ct.verticalPlacedTextSymbolIndex),hr=l.evaluateSizeForFeature(C.textSizeData,we,Or),pr=P.get("text-padding");er=this.collisionIndex.placeCollisionCircles(C,Ie,Or,C.lineVertexArray,C.glyphOffsetArray,hr,R,z,W,m,tt,De.predicate,Ct.collisionCircleDiameter*hr/l.ONE_EM,pr,this.retainedQueryData[C.bucketInstanceId].tileID),Jt=Ie||er.circles.length>0&&!er.collisionDetected,ln=ln&&er.offscreen,Cn=er.occluded}if(kt.iconFeatureIndex&&(Ir=kt.iconFeatureIndex),kt.iconBox){const Or=hr=>{$r(hr);const pr=et&&Ai?xi(Ai.x,Ai.y,Qe,tt,this.transform.angle):new l.Point(0,0),Jo=C.getSymbolInstanceIconSize(xe,this.transform.zoom,Ct.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,Jo,hr,pr,Pe,ae,R,De.predicate)};wi&&wi.box&&wi.box.length&&kt.verticalIconBox?(Qn=Or(kt.verticalIconBox),En=Qn.box.length>0):(Qn=Or(kt.iconBox),En=Qn.box.length>0),ln=ln&&Qn.offscreen,ai=Qn.occluded}const Wo=le||0===Ct.numHorizontalGlyphVertices&&0===It,ya=_e||0===Ct.numIconVertices;if(Wo||ya?ya?Wo||(En=En&&Jt):Jt=En&&Jt:En=Jt=En&&Jt,Jt&&rr&&rr.box&&this.collisionIndex.insertCollisionBox(rr.box,P.get("text-ignore-placement"),C.bucketInstanceId,wi&&wi.box&&or?or:yr,De.ID),En&&Qn&&this.collisionIndex.insertCollisionBox(Qn.box,P.get("icon-ignore-placement"),C.bucketInstanceId,Ir,De.ID),er&&(Jt&&this.collisionIndex.insertCollisionCircles(er.circles,P.get("text-ignore-placement"),C.bucketInstanceId,yr,De.ID),m)){const Or=C.bucketInstanceId;let hr=this.collisionCircleArrays[Or];void 0===hr&&(hr=this.collisionCircleArrays[Or]=new tn);for(let pr=0;pr<er.circles.length;pr+=4)hr.circles.push(er.circles[pr+0]),hr.circles.push(er.circles[pr+1]),hr.circles.push(er.circles[pr+2]),hr.circles.push(er.collisionDetected?1:0)}const Vs="globe"!==C.projection.name;st=st&&(Vs||!Cn),Mt=Mt&&(Vs||!ai),this.placements[mn]=new Ot(Jt||st,En||Mt,ln||C.justReloaded),c.add(mn)};if(gt){const Ct=C.getSortedSymbolIndexes(this.transform.angle);for(let Qt=Ct.length-1;Qt>=0;--Qt){const kt=Ct[Qt];pn(C.symbolInstances.get(kt),kt,C.collisionArrays[kt])}}else for(let Ct=r.symbolInstanceStart;Ct<r.symbolInstanceEnd;Ct++)pn(C.symbolInstances.get(Ct),Ct,C.collisionArrays[Ct]);if(m&&C.bucketInstanceId in this.collisionCircleArrays){const Ct=this.collisionCircleArrays[C.bucketInstanceId];l.invert(Ct.invProjMatrix,R),Ct.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(r,c,m,b){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:z,crossTileID:W}=m,q=l.getAnchorJustification(c),ae=b===l.WritingMode.vertical?z:"left"===q?C:"center"===q?P:"right"===q?R:-1;C>=0&&(r.text.placedSymbolArray.get(C).crossTileID=ae>=0&&C!==ae?0:W),P>=0&&(r.text.placedSymbolArray.get(P).crossTileID=ae>=0&&P!==ae?0:W),R>=0&&(r.text.placedSymbolArray.get(R).crossTileID=ae>=0&&R!==ae?0:W),z>=0&&(r.text.placedSymbolArray.get(z).crossTileID=ae>=0&&z!==ae?0:W)}markUsedOrientation(r,c,m){const b=c===l.WritingMode.horizontal||c===l.WritingMode.horizontalOnly?c:0,C=c===l.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:P,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:W}=m,q=r.text.placedSymbolArray;P>=0&&(q.get(P).placedOrientation=b),R>=0&&(q.get(R).placedOrientation=b),z>=0&&(q.get(z).placedOrientation=b),W>=0&&(q.get(W).placedOrientation=C)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const b=c?c.symbolFadeChange(r):1,C=c?c.opacities:{},P=c?c.variableOffsets:{},R=c?c.placedOrientations:{};for(const z in this.placements){const W=this.placements[z],q=C[z];q?(this.opacities[z]=new Oe(q,b,W.text,W.icon,null,W.clipped),m=m||W.text!==q.text.placed||W.icon!==q.icon.placed):(this.opacities[z]=new Oe(null,b,W.text,W.icon,W.skipFade,W.clipped),m=m||W.text||W.icon)}for(const z in C){const W=C[z];if(!this.opacities[z]){const q=new Oe(W,b,!1,!1);q.isHidden()||(this.opacities[z]=q,m=m||W.text.placed||W.icon.placed)}}for(const z in P)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=P[z]);for(const z in R)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=R[z]);m?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:r)}updateLayerOpacities(r,c){const m=new Set;for(const b of c){const C=b.getBucket(r);C&&b.latestFeatureIndex&&r.id===C.layerIds[0]&&this.updateBucketOpacities(C,m,b.collisionBoxArray)}}updateBucketOpacities(r,c,m){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const b=r.layers[0].layout,C=!!r.layers[0].dynamicFilter(),P=new Oe(null,0,!1,!1,!0),R=b.get("text-allow-overlap"),z=b.get("icon-allow-overlap"),W=b.get("text-variable-anchor"),q="map"===b.get("text-rotation-alignment"),ae="map"===b.get("text-pitch-alignment"),fe="none"!==b.get("icon-text-fit"),be=new Oe(null,0,R&&(z||!r.hasIconData()||b.get("icon-optional")),z&&(R||!r.hasTextData()||b.get("text-optional")),!0);!r.collisionArrays&&m&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(m);const we=(De,le,_e)=>{for(let Ie=0;Ie<le/4;Ie++)De.opacityVertexArray.emplaceBack(_e)};let xe=0;for(let De=0;De<r.symbolInstances.length;De++){const le=r.symbolInstances.get(De),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:Ie,crossTileID:Pe,numIconVertices:Qe}=le,tt=c.has(Pe);let et=this.opacities[Pe];tt?et=P:et||(et=be,this.opacities[Pe]=et),c.add(Pe);const gt=_e>0||Ie>0,st=Qe>0,Mt=this.placedOrientations[Pe],pn=Mt===l.WritingMode.vertical,Ct=Mt===l.WritingMode.horizontal||Mt===l.WritingMode.horizontalOnly;if(!gt&&!st||et.isHidden()||xe++,gt){const Qt=ea(et.text);we(r.text,_e,pn?Dr:Qt),we(r.text,Ie,Ct?Dr:Qt);const kt=et.text.isHidden(),{leftJustifiedTextSymbolIndex:mn,centerJustifiedTextSymbolIndex:It,rightJustifiedTextSymbolIndex:Jt,verticalPlacedTextSymbolIndex:En}=le,ln=r.text.placedSymbolArray,Cn=kt||pn?1:0;mn>=0&&(ln.get(mn).hidden=Cn),It>=0&&(ln.get(It).hidden=Cn),Jt>=0&&(ln.get(Jt).hidden=Cn),En>=0&&(ln.get(En).hidden=kt||Ct?1:0);const ai=this.variableOffsets[Pe];ai&&this.markUsedJustification(r,ai.anchor,le,Mt);const Ai=this.placedOrientations[Pe];Ai&&(this.markUsedJustification(r,"left",le,Ai),this.markUsedOrientation(r,Ai,le))}if(st){const Qt=ea(et.icon),{placedIconSymbolIndex:kt,verticalPlacedIconSymbolIndex:mn}=le,It=r.icon.placedSymbolArray,Jt=et.icon.isHidden()?1:0;kt>=0&&(we(r.icon,Qe,pn?Dr:Qt),It.get(kt).hidden=Jt),mn>=0&&(we(r.icon,le.numVerticalIconVertices,Ct?Dr:Qt),It.get(mn).hidden=Jt)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Qt=r.collisionArrays[De];if(Qt){let kt=new l.Point(0,0),mn=!0;if(Qt.textBox||Qt.verticalTextBox){if(W){const Jt=this.variableOffsets[Pe];Jt?(kt=Nn(Jt.anchor,Jt.width,Jt.height,Jt.textOffset,Jt.textScale),q&&kt._rotate(ae?this.transform.angle:-this.transform.angle)):mn=!1}C&&(mn=!et.clipped),Qt.textBox&&gr(r.textCollisionBox.collisionVertexArray,et.text.placed,!mn||pn,kt.x,kt.y),Qt.verticalTextBox&&gr(r.textCollisionBox.collisionVertexArray,et.text.placed,!mn||Ct,kt.x,kt.y)}const It=mn&&!(Ct||!Qt.verticalIconBox);Qt.iconBox&&gr(r.iconCollisionBox.collisionVertexArray,et.icon.placed,It,fe?kt.x:0,fe?kt.y:0),Qt.verticalIconBox&&gr(r.iconCollisionBox.collisionVertexArray,et.icon.placed,!It,fe?kt.x:0,fe?kt.y:0)}}}if(r.fullyClipped=0===xe,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const De=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=De.invProjMatrix,r.placementViewportMatrix=De.viewportMatrix,r.collisionCircleArray=De.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>r}setStale(){this.stale=!0}}function gr(f,r,c,m,b){f.emplaceBack(r?1:0,c?1:0,m||0,b||0),f.emplaceBack(r?1:0,c?1:0,m||0,b||0),f.emplaceBack(r?1:0,c?1:0,m||0,b||0),f.emplaceBack(r?1:0,c?1:0,m||0,b||0)}const ri=Math.pow(2,25),Jn=Math.pow(2,24),br=Math.pow(2,17),Qr=Math.pow(2,16),Ji=Math.pow(2,9),Io=Math.pow(2,8),el=Math.pow(2,1);function ea(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const r=f.placed?1:0,c=Math.floor(127*f.opacity);return c*ri+r*Jn+c*br+r*Qr+c*Ji+r*Io+c*el+r}const Dr=0;class za{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,c,m,b,C){const P=this._bucketParts;for(;this._currentTileIndex<r.length;)if(c.getBucketParts(P,b,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((R,z)=>R.sortKey-z.sortKey));this._currentPartIndex<P.length;){const R=P[this._currentPartIndex];if(c.placeLayerBucketPart(R,this._seenCrossTileIDs,m,0===R.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class Vr{constructor(r,c,m,b,C,P,R,z){this.placement=new Sr(r,C,P,R,z),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(r,c,m){const b=l.exported.now(),C=()=>{const P=l.exported.now()-b;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=c[r[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if("symbol"===P.type&&(!P.minzoom||P.minzoom<=R)&&(!P.maxzoom||P.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new za(P)),this._inProgressLayer.continuePlacement(m[P.source],this.placement,this._showCollisionBoxes,P,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const $n=512/l.EXTENT/2;class oi{constructor(r,c,m){this.tileID=r,this.bucketInstanceId=m,this.index=new l.KDBush(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=r.canonical.x*l.EXTENT,C=r.canonical.y*l.EXTENT;for(let P=0;P<c.length;P++){const{key:R,crossTileID:z,tileAnchorX:W,tileAnchorY:q}=c.get(P),ae=Math.floor((b+W)*$n),fe=Math.floor((C+q)*$n);this.index.add(ae,fe),this.keys.push(R),this.crossTileIDs.push(z)}this.index.finish()}findMatches(r,c,m){const b=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),C=$n/Math.pow(2,c.canonical.z-this.tileID.canonical.z),P=c.canonical.x*l.EXTENT,R=c.canonical.y*l.EXTENT;for(let z=0;z<r.length;z++){const W=r.get(z);if(W.crossTileID)continue;const{key:q,tileAnchorX:ae,tileAnchorY:fe}=W,be=Math.floor((P+ae)*C),we=Math.floor((R+fe)*C),xe=this.index.range(be-b,we-b,be+b,we+b);for(const De of xe){const le=this.crossTileIDs[De];if(this.keys[De]===q&&!m.has(le)){m.add(le),W.crossTileID=le;break}}}}}class xr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Po{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const c=Math.round((r-this.lng)/360);if(0!==c)for(const m in this.indexes){const b=this.indexes[m],C={};for(const P in b){const R=b[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+c),C[R.tileID.key]=R}this.indexes[m]=C}this.lng=r}addBucket(r,c,m){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let C=0;C<c.symbolInstances.length;C++)c.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const b=this.usedCrossTileIDs[r.overscaledZ];for(const C in this.indexes){const P=this.indexes[C];if(Number(C)>r.overscaledZ)for(const R in P){const z=P[R];z.tileID.isChildOf(r)&&z.findMatches(c.symbolInstances,r,b)}else{const R=P[r.scaledTo(Number(C)).key];R&&R.findMatches(c.symbolInstances,r,b)}}for(let C=0;C<c.symbolInstances.length;C++){const P=c.symbolInstances.get(C);P.crossTileID||(P.crossTileID=m.generate(),b.add(P.crossTileID))}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new oi(r,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(r,c){for(const m of c.crossTileIDs)this.usedCrossTileIDs[r].delete(m)}removeStaleBuckets(r){let c=!1;for(const m in this.indexes){const b=this.indexes[m];for(const C in b)r[b[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,b[C]),delete b[C],c=!0)}return c}}class Ro{constructor(){this.layerIndexes={},this.crossTileIDs=new xr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,c,m,b){let C=this.layerIndexes[r.id];void 0===C&&(C=this.layerIndexes[r.id]=new Po);let P=!1;const R={};"globe"!==b.name&&C.handleWrapJump(m);for(const z of c){const W=z.getBucket(r);W&&r.id===W.layerIds[0]&&(W.bucketInstanceId||(W.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(z.tileID,W,this.crossTileIDs)&&(P=!0),R[W.bucketInstanceId]=!0)}return C.removeStaleBuckets(R)&&(P=!0),P}pruneUnusedLayers(r){const c={};r.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const jr=(f,r)=>l.emitValidationErrors(f,r&&r.filter(c=>"source.canvas"!==c.identifier)),Ds=l.pick(en,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),go=l.pick(en,["setCenter","setZoom","setBearing","setPitch"]),$o={version:8,layers:[],sources:{}},cs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class bi extends l.Evented{constructor(r,c={}){super(),this.map=r,this.dispatcher=new Oi(Be(),this),this.imageManager=new Pt,this.imageManager.setEventedParent(this),this.glyphManager=new l.GlyphManager(r._requestManager,c.localFontFamily?l.LocalGlyphMode.all:c.localIdeographFontFamily?l.LocalGlyphMode.ideographs:l.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new Ro,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const m=this;this._rtlTextPluginCallback=bi.registerForPluginStateChange(b=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(C,P)=>{if(l.triggerPluginCompletionEvent(C),P&&P.every(R=>R))for(const R in m._sourceCaches){const z=m._sourceCaches[R],W=z.getSource().type;"vector"!==W&&"geojson"!==W||z.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const C=this.getSource(b.sourceId);if(C&&C.vectorLayerIds)for(const P in this._layers){const R=this._layers[P];R.source===C.id&&this._validateLayer(R)}})}loadURL(r,c={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof c.validate?c.validate:!l.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,c.accessToken);const b=this.map._requestManager.transformRequest(r,l.ResourceType.Style);this._request=l.getJSON(b,(C,P)=>{this._request=null,C?this.fire(new l.ErrorEvent(C)):P&&this._load(P,m)})}loadJSON(r,c={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(r,!1!==c.validate)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load($o,!1)}_updateLayerCount(r,c){const m=c?1:-1;r.is3D()&&(this._num3DLayers+=m),"circle"===r.type&&(this._numCircleLayers+=m),"symbol"===r.type&&(this._numSymbolLayers+=m)}_load(r,c){if(c&&jr(this,l.validateStyle(r)))return;this._loaded=!0,this.stylesheet=l.clone$1(r),this._updateMapProjection();for(const b in r.sources)this.addSource(b,r.sources[b],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const m=Rt(this.stylesheet.layers);this._order=m.map(b=>b.id),this._layers={},this._serializedLayers={};for(const b of m){const C=l.createStyleLayer(b);C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new vn(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(c,m,b){let C,P,R;const z=l.exported.devicePixelRatio>1?"@2x":"";let W=l.getJSON(m.transformRequest(m.normalizeSpriteURL(c,z,".json"),l.ResourceType.SpriteJSON),(fe,be)=>{W=null,R||(R=fe,C=be,ae())}),q=l.getImage(m.transformRequest(m.normalizeSpriteURL(c,z,".png"),l.ResourceType.SpriteImage),(fe,be)=>{q=null,R||(R=fe,P=be,ae())});function ae(){if(R)b(R);else if(C&&P){const fe=l.exported.getImageData(P),be={};for(const we in C){const{width:xe,height:De,x:le,y:_e,sdf:Ie,pixelRatio:Pe,stretchX:Qe,stretchY:tt,content:et}=C[we],gt=new l.RGBAImage({width:xe,height:De});l.RGBAImage.copy(fe,gt,{x:le,y:_e},{x:0,y:0},{width:xe,height:De}),be[we]={data:gt,pixelRatio:Pe,sdf:Ie,stretchX:Qe,stretchY:tt,content:et}}b(null,be)}}return{cancel(){W&&(W.cancel(),W=null),q&&(q.cancel(),q=null)}}}(r,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new l.ErrorEvent(c));else if(m)for(const b in m)this.imageManager.addImage(b,m[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(r){const c=this.getSource(r.source);if(!c)return;const m=r.sourceLayer;m&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(m))&&this.fire(new l.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const c=[];for(const m of r){const b=this._layers[m];"custom"!==b.type&&c.push(b.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&("function"==typeof r.isLayerDraped?r.isLayerDraped():cs[r.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const c=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(b.length||C.length)&&this._updateWorkerLayers(b,C);for(const P in this._updatedSources){const R=this._updatedSources[P];"reload"===R?this._reloadSource(P):"clear"===R&&this._clearSource(P)}this._updateTilesForChangedImages();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const m={};for(const b in this._sourceCaches){const C=this._sourceCaches[b];m[b]=C.used,C.used=!1}for(const b of this._order){const C=this._layers[b];if(C.recalculate(r,this._availableImages),!C.isHidden(r.zoom)){const R=this._getLayerSourceCache(C);R&&(R.used=!0)}const P=this.map.painter;if(P){const R=C.getProgramIds();if(!R)continue;const z=C.getProgramConfiguration(r.zoom);for(const W of R)P.useProgram(W,z)}}for(const b in m){const C=this._sourceCaches[b];m[b]!==C.used&&C.getSource().fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),jr(this,l.validateStyle(r)))return!1;(r=l.clone$1(r)).layers=Rt(r.layers);const c=function(b,C){if(!b)return[{command:en.setStyle,args:[C]}];let P=[];try{if(!ge(b.version,C.version))return[{command:en.setStyle,args:[C]}];ge(b.center,C.center)||P.push({command:en.setCenter,args:[C.center]}),ge(b.zoom,C.zoom)||P.push({command:en.setZoom,args:[C.zoom]}),ge(b.bearing,C.bearing)||P.push({command:en.setBearing,args:[C.bearing]}),ge(b.pitch,C.pitch)||P.push({command:en.setPitch,args:[C.pitch]}),ge(b.sprite,C.sprite)||P.push({command:en.setSprite,args:[C.sprite]}),ge(b.glyphs,C.glyphs)||P.push({command:en.setGlyphs,args:[C.glyphs]}),ge(b.transition,C.transition)||P.push({command:en.setTransition,args:[C.transition]}),ge(b.light,C.light)||P.push({command:en.setLight,args:[C.light]}),ge(b.fog,C.fog)||P.push({command:en.setFog,args:[C.fog]}),ge(b.projection,C.projection)||P.push({command:en.setProjection,args:[C.projection]});const R={},z=[];!function(ae,fe,be,we){let xe;for(xe in fe=fe||{},ae=ae||{})ae.hasOwnProperty(xe)&&(fe.hasOwnProperty(xe)||Kn(xe,be,we));for(xe in fe){if(!fe.hasOwnProperty(xe))continue;const De=fe[xe];ae.hasOwnProperty(xe)?ge(ae[xe],De)||("geojson"===ae[xe].type&&"geojson"===De.type&&qi(ae,fe,xe)?be.push({command:en.setGeoJSONSourceData,args:[xe,De.data]}):An(xe,fe,be,we)):wn(xe,fe,be)}}(b.sources,C.sources,z,R);const W=[];b.layers&&b.layers.forEach(ae=>{ae.source&&R[ae.source]?P.push({command:en.removeLayer,args:[ae.id]}):W.push(ae)});let q=b.terrain;q&&R[q.source]&&(P.push({command:en.setTerrain,args:[void 0]}),q=void 0),P=P.concat(z),ge(q,C.terrain)||P.push({command:en.setTerrain,args:[C.terrain]}),function(ae,fe,be){fe=fe||[];const we=(ae=ae||[]).map(dr),xe=fe.map(dr),De=ae.reduce(Mo,{}),le=fe.reduce(Mo,{}),_e=we.slice(),Ie=Object.create(null);let Pe,Qe,tt,et,gt,st,Mt;for(Pe=0,Qe=0;Pe<we.length;Pe++)tt=we[Pe],le.hasOwnProperty(tt)?Qe++:(be.push({command:en.removeLayer,args:[tt]}),_e.splice(_e.indexOf(tt,Qe),1));for(Pe=0,Qe=0;Pe<xe.length;Pe++)tt=xe[xe.length-1-Pe],_e[_e.length-1-Pe]!==tt&&(De.hasOwnProperty(tt)?(be.push({command:en.removeLayer,args:[tt]}),_e.splice(_e.lastIndexOf(tt,_e.length-Qe),1)):Qe++,st=_e[_e.length-Pe],be.push({command:en.addLayer,args:[le[tt],st]}),_e.splice(_e.length-Pe,0,tt),Ie[tt]=!0);for(Pe=0;Pe<xe.length;Pe++)if(tt=xe[Pe],et=De[tt],gt=le[tt],!Ie[tt]&&!ge(et,gt))if(ge(et.source,gt.source)&&ge(et["source-layer"],gt["source-layer"])&&ge(et.type,gt.type)){for(Mt in Ci(et.layout,gt.layout,be,tt,null,en.setLayoutProperty),Ci(et.paint,gt.paint,be,tt,null,en.setPaintProperty),ge(et.filter,gt.filter)||be.push({command:en.setFilter,args:[tt,gt.filter]}),ge(et.minzoom,gt.minzoom)&&ge(et.maxzoom,gt.maxzoom)||be.push({command:en.setLayerZoomRange,args:[tt,gt.minzoom,gt.maxzoom]}),et)et.hasOwnProperty(Mt)&&"layout"!==Mt&&"paint"!==Mt&&"filter"!==Mt&&"metadata"!==Mt&&"minzoom"!==Mt&&"maxzoom"!==Mt&&(0===Mt.indexOf("paint.")?Ci(et[Mt],gt[Mt],be,tt,Mt.slice(6),en.setPaintProperty):ge(et[Mt],gt[Mt])||be.push({command:en.setLayerProperty,args:[tt,Mt,gt[Mt]]}));for(Mt in gt)gt.hasOwnProperty(Mt)&&!et.hasOwnProperty(Mt)&&"layout"!==Mt&&"paint"!==Mt&&"filter"!==Mt&&"metadata"!==Mt&&"minzoom"!==Mt&&"maxzoom"!==Mt&&(0===Mt.indexOf("paint.")?Ci(et[Mt],gt[Mt],be,tt,Mt.slice(6),en.setPaintProperty):ge(et[Mt],gt[Mt])||be.push({command:en.setLayerProperty,args:[tt,Mt,gt[Mt]]}))}else be.push({command:en.removeLayer,args:[tt]}),st=_e[_e.lastIndexOf(tt)+1],be.push({command:en.addLayer,args:[gt,st]})}(W,C.layers,P)}catch(R){console.warn("Unable to compute style diff:",R),P=[{command:en.setStyle,args:[C]}]}return P}(this.serialize(),r).filter(b=>!(b.command in go));if(0===c.length)return!1;const m=c.filter(b=>!(b.command in Ds));if(m.length>0)throw new Error(`Unimplemented: ${m.map(b=>b.command).join(", ")}.`);return c.forEach(b=>{"setTransition"!==b.command&&"setProjection"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,c){return this.getImage(r)?this.fire(new l.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,c),this._afterImageUpdated(r),this)}updateImage(r,c){this.imageManager.updateImage(r,c)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new l.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,c,m={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(l.validateSource,`sources.${r}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const b=mt(r,c,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:b.serialize(),sourceId:r}));const C=P=>{const R=(P?"symbol:":"other:")+r,z=this._sourceCaches[R]=new l.SourceCache(R,b,P);(P?this._symbolSourceCaches:this._otherSourceCaches)[r]=z,z.style=this,z.onAdd(this.map)};C(!1),"vector"!==c.type&&"geojson"!==c.type||C(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const c=this.getSource(r);if(!c)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===r)return this.fire(new l.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new l.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(r);for(const b of m)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,c){this._checkLoaded(),this.getSource(r).setData(c),this._changed=!0}getSource(r){const c=this._getSourceCache(r);return c&&c.getSource()}_getSources(){const r=[];for(const c in this._otherSourceCaches){const m=this._getSourceCache(c);m&&r.push(m.getSource())}return r}addLayer(r,c,m={}){this._checkLoaded();const b=r.id;if(this.getLayer(b))return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let C;if("custom"===r.type){if(jr(this,l.validateCustomStyleLayer(r)))return;C=l.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(b,r.source),r=l.clone$1(r),r=l.extend(r,{source:b})),this._validate(l.validateLayer,`layers.${b}`,r,{arrayIndex:-1},m))return;C=l.createStyleLayer(r),this._validateLayer(C),C.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}const P=c?this._order.indexOf(c):this._order.length;if(c&&-1===P)return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(P,0,b),this._layerOrderChanged=!0,this._layers[b]=C;const R=this._getLayerSourceCache(C);if(this._removedLayers[b]&&C.source&&R&&"custom"!==C.type){const z=this._removedLayers[b];delete this._removedLayers[b],z.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",R.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,c){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===c)return;const m=this._order.indexOf(r);this._order.splice(m,1);const b=c?this._order.indexOf(c):this._order.length;c&&-1===b?this.fire(new l.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(b,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const c=this._layers[r];if(!c)return void this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const m=this._order.indexOf(r);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=c,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const c in this._layers)if(this._layers[c].type===r)return!0;return!1}setLayerZoomRange(r,c,m){this._checkLoaded();const b=this.getLayer(r);b?b.minzoom===c&&b.maxzoom===m||(null!=c&&(b.minzoom=c),null!=m&&(b.maxzoom=m),this._updateLayer(b)):this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,c,m={}){this._checkLoaded();const b=this.getLayer(r);if(b){if(!ge(b.filter,c))return null==c?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(l.validateFilter,`layers.${b.id}.filter`,c,{layerType:b.type},m)||(b.filter=l.clone$1(c),this._updateLayer(b)))}else this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const c=this.getLayer(r);return c&&l.clone$1(c.filter)}setLayoutProperty(r,c,m,b={}){this._checkLoaded();const C=this.getLayer(r);C?ge(C.getLayoutProperty(c),m)||(C.setLayoutProperty(c,m,b),this._updateLayer(C)):this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,c){const m=this.getLayer(r);if(m)return m.getLayoutProperty(c);this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,c,m,b={}){this._checkLoaded();const C=this.getLayer(r);C?ge(C.getPaintProperty(c),m)||(C.setPaintProperty(c,m,b)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,c){const m=this.getLayer(r);return m&&m.getPaintProperty(c)}setFeatureState(r,c){this._checkLoaded();const m=r.source,b=r.sourceLayer,C=this.getSource(m);if(!C)return void this.fire(new l.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const P=C.type;if("geojson"===P&&b)return void this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===P&&!b)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided.")));const R=this._getSourceCaches(m);for(const z of R)z.setFeatureState(b,r.id,c)}removeFeatureState(r,c){this._checkLoaded();const m=r.source,b=this.getSource(m);if(!b)return void this.fire(new l.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const C=b.type,P="vector"===C?r.sourceLayer:void 0;if("vector"===C&&!P)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const R=this._getSourceCaches(m);for(const z of R)z.removeFeatureState(P,r.id,c)}getFeatureState(r){this._checkLoaded();const c=r.source,m=r.sourceLayer,b=this.getSource(c);if(b){if("vector"!==b.type||m)return void 0===r.id&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(m,r.id);this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();r[m.id]||(r[m.id]=m.serialize())}return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(r){this._updatedLayers[r.id]=!0;const c=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[r.source]="reload",c.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const c=P=>"fill-extrusion"===this._layers[P].type,m={},b=[];for(let P=this._order.length-1;P>=0;P--){const R=this._order[P];if(c(R)){m[R]=P;for(const z of r){const W=z[R];if(W)for(const q of W)b.push(q)}}}b.sort((P,R)=>R.intersectionZ-P.intersectionZ);const C=[];for(let P=this._order.length-1;P>=0;P--){const R=this._order[P];if(c(R))for(let z=b.length-1;z>=0;z--){const W=b[z].feature;if(m[W.layer.id]<P)break;C.push(W),b.pop()}else for(const z of r){const W=z[R];if(W)for(const q of W)C.push(q.feature)}}return C}queryRenderedFeatures(r,c,m){c&&c.filter&&this._validate(l.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const b={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const z of c.layers){const W=this._layers[z];if(!W)return this.fire(new l.ErrorEvent(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];b[W.source]=!0}}const C=[];c.availableImages=this._availableImages;const P=c&&c.layers?c.layers.some(z=>{const W=this.getLayer(z);return W&&W.is3D()}):this.has3DLayers(),R=so.createFromScreenPoints(r,m);for(const z in this._sourceCaches){const W=this._sourceCaches[z].getSource().id;c.layers&&!b[W]||C.push(_n(this._sourceCaches[z],this._layers,this._serializedLayers,R,c,m,P,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(z,W,q,ae,fe,be,we){const xe={},De=be.queryRenderedSymbols(ae),le=[];for(const _e of Object.keys(De).map(Number))le.push(we[_e]);le.sort(qn);for(const _e of le){const Ie=_e.featureIndex.lookupSymbolFeatures(De[_e.bucketInstanceId],W,_e.bucketIndex,_e.sourceLayerIndex,fe.filter,fe.layers,fe.availableImages,z);for(const Pe in Ie){const Qe=xe[Pe]=xe[Pe]||[],tt=Ie[Pe];tt.sort((et,gt)=>{const st=_e.featureSortOrder;if(st){const Mt=st.indexOf(et.featureIndex);return st.indexOf(gt.featureIndex)-Mt}return gt.featureIndex-et.featureIndex});for(const et of tt)Qe.push(et)}}for(const _e in xe)xe[_e].forEach(Ie=>{const Pe=Ie.feature,Qe=q(z[_e]);if(!Qe)return;const tt=Qe.getFeatureState(Pe.layer["source-layer"],Pe.id);Pe.source=Pe.layer.source,Pe.layer["source-layer"]&&(Pe.sourceLayer=Pe.layer["source-layer"]),Pe.state=tt});return xe}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),R.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(r,c){c&&c.filter&&this._validate(l.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const m=this._getSourceCaches(r);let b=[];for(const C of m)b=b.concat(Gn(C,c));return b}addSourceType(r,c,m){return bi.getSourceType(r)?m(new Error(`A source type called "${r}" already exists.`)):(bi.setSourceType(r,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:c.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(r,c={}){this._checkLoaded();const m=this.light.getLight();let b=!1;for(const P in r)if(!ge(r[P],m[P])){b=!0;break}if(!b)return;const C=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,c),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,c=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=r;if(1===c){if("object"==typeof m.source){const b="terrain-dem-src";this.addSource(b,m.source),m=l.clone$1(m),m=l.extend(m,{source:b})}if(this._validate(l.validateTerrain,"terrain",m))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,c)}else{const b=this.terrain,C=b.get();for(const P of Object.keys(l.spec.terrain))!m.hasOwnProperty(P)&&l.spec.terrain[P].default&&(m[P]=l.spec.terrain[P].default);for(const P in m)if(!ge(m[P],C[P])){b.set(m),this.stylesheet.terrain=m;const R=this._setTransitionParameters({duration:0});b.updateTransitions(R);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const c=this.fog=new mr(r,this.map.transform);this.stylesheet.fog=r;const m=this._setTransitionParameters({duration:0});c.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,m=c.get();0===Object.keys(r).length&&c.set(r);for(const b in r)if(!ge(r[b],m[b])){c.set(r),this.stylesheet.fog=r;const C=this._setTransitionParameters({duration:0});c.updateTransitions(C);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:l.exported.now(),transition:l.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(m=>this.isLayerDraped(this._layers[m])),c=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...c)}_createTerrain(r,c){const m=this.terrain=new Ei(r,c);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b=this._setTransitionParameters({duration:0});m.updateTransitions(b)}_force3DLayerUpdate(){for(const r in this._layers){const c=this._layers[r];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const c=this._layers[r];"symbol"===c.type&&this._updateLayer(c)}}_validate(r,c,m,b,C={}){return(!C||!1!==C.validate)&&jr(this,r.call(l.validateStyle,l.extend({key:c,style:this.serialize(),value:m,styleSpec:l.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const c=this._getSourceCaches(r);for(const m of c)m.clearTiles()}_reloadSource(r){const c=this._getSourceCaches(r);for(const m of c)m.resume(),m.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const c in this._sourceCaches)this._sourceCaches[c].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const c=this._sourceCaches[r];c.resume(),c.reload()}}_updatePlacement(r,c,m,b,C=!1){let P=!1,R=!1;const z={};for(const W of this._order){const q=this._layers[W];if("symbol"!==q.type)continue;if(!z[q.source]){const fe=this._getLayerSourceCache(q);if(!fe)continue;z[q.source]=fe.getRenderableIds(!0).map(be=>fe.getTileByID(be)).sort((be,we)=>we.tileID.overscaledZ-be.tileID.overscaledZ||(be.tileID.isLessThan(we.tileID)?-1:1))}const ae=this.crossTileSymbolIndex.addLayer(q,z[q.source],r.center.lng,r.projection);P=P||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),C=C||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new l.Event("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),r.zoom))&&(this.pauseablePlacement=new Vr(r,this._order,C,c,m,b,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),R=!0),P&&this.pauseablePlacement.placement.setStale()),R||P)for(const W of this._order){const q=this._layers[W];"symbol"===q.type&&this.placement.updateLayerOpacities(q,z[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,c,m){this.imageManager.getImages(c.icons,m),this._updateTilesForChangedImages();const b=C=>{C&&C.setDependencies(c.tileID.key,c.type,c.icons)};b(this._otherSourceCaches[c.source]),b(this._symbolSourceCaches[c.source])}getGlyphs(r,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(r,c,m){return l.makeRequest(c,m)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const c=[];return this._otherSourceCaches[r]&&c.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&c.push(this._symbolSourceCaches[r]),c}_isSourceCacheLoaded(r){const c=this._getSourceCaches(r);return 0===c.length?(this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):c.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}bi.getSourceType=function(f){return Ve[f]},bi.setSourceType=function(f,r){Ve[f]=r},bi.registerForPluginStateChange=l.registerForPluginStateChange;var Ts="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Ls="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ns="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Fr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",is="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Ws={},Ko={};const _s=[];Zs(Ts,_s),Zs(ns,_s),Zs(Fr,_s),Zs(is,_s),Ws=Xn("",ns),Ko=Xn(is,Fr);const tl=Xn("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ys=Ts,Ms="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Fs={background:Xn("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Xn("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Xn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Xn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Xn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Xn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Xn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Xn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Xn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Xn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Xn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Xn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Xn("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Xn("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Xn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Xn("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Xn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Xn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Xn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Xn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Xn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Xn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Xn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Xn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ls),skyboxGradient:Xn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ls),skyboxCapture:Xn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Xn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Xn("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Zs(f,r){const c=f.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let m of c)if(m=m.trim(),"#"===m[0]&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=m.split(" ");for(const C of b)r.includes(C)||r.push(C)}}function Xn(f,r){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b={},C=[..._s];return Zs(f,C),Zs(r,C),{fragmentSource:f=f.replace(c,(P,R,z,W,q)=>(b[q]=!0,"define"===R?`\n#ifndef HAS_UNIFORM_u_${q}\nvarying ${z} ${W} ${q};\n#else\nuniform ${z} ${W} u_${q};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${q}\n    ${z} ${W} ${q} = u_${q};\n#endif\n`)),vertexSource:r=r.replace(c,(P,R,z,W,q)=>{const ae="float"===W?"vec2":"vec4",fe=q.match(/color/)?"color":ae;return b[q]?"define"===R?`\n#ifndef HAS_UNIFORM_u_${q}\nuniform lowp float u_${q}_t;\nattribute ${z} ${ae} a_${q};\nvarying ${z} ${W} ${q};\n#else\nuniform ${z} ${W} u_${q};\n#endif\n`:"vec4"===fe?`\n#ifndef HAS_UNIFORM_u_${q}\n    ${q} = a_${q};\n#else\n    ${z} ${W} ${q} = u_${q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${q}\n    ${q} = unpack_mix_${fe}(a_${q}, u_${q}_t);\n#else\n    ${z} ${W} ${q} = u_${q};\n#endif\n`:"define"===R?`\n#ifndef HAS_UNIFORM_u_${q}\nuniform lowp float u_${q}_t;\nattribute ${z} ${ae} a_${q};\n#else\nuniform ${z} ${W} u_${q};\n#endif\n`:"vec4"===fe?`\n#ifndef HAS_UNIFORM_u_${q}\n    ${z} ${W} ${q} = a_${q};\n#else\n    ${z} ${W} ${q} = u_${q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${q}\n    ${z} ${W} ${q} = unpack_mix_${fe}(a_${q}, u_${q}_t);\n#else\n    ${z} ${W} ${q} = u_${q};\n#endif\n`}),staticAttributes:m,usedDefines:C}}class Dc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,c,m,b,C,P,R){this.context=r;let z=this.boundPaintVertexBuffers.length!==b.length;for(let q=0;!z&&q<b.length;q++)this.boundPaintVertexBuffers[q]!==b[q]&&(z=!0);let W=this.boundDynamicVertexBuffers.length!==R.length;for(let q=0;!W&&q<R.length;q++)this.boundDynamicVertexBuffers[q]!==R[q]&&(W=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==m||z||W||this.boundIndexBuffer!==C||this.boundVertexOffset!==P)this.freshBind(c,m,b,C,P,R);else{r.bindVertexArrayOES.set(this.vao);for(const q of R)q&&q.bind();C&&C.dynamicDraw&&C.bind()}}freshBind(r,c,m,b,C,P){let R;const z=r.numAttributes,W=this.context,q=W.gl;if(W.extVertexArrayObject)this.vao&&this.destroy(),this.vao=W.extVertexArrayObject.createVertexArrayOES(),W.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=r,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=b,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=P;else{R=W.currentNumAttributes||0;for(let ae=z;ae<R;ae++)q.disableVertexAttribArray(ae)}c.enableAttributes(q,r),c.bind(),c.setVertexAttribPointers(q,r,C);for(const ae of m)ae.enableAttributes(q,r),ae.bind(),ae.setVertexAttribPointers(q,r,C);for(const ae of P)ae&&(ae.enableAttributes(q,r),ae.bind(),ae.setVertexAttribPointers(q,r,C));b&&b.bind(),W.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ua(f,r){const c=Math.pow(2,r.canonical.z),m=r.canonical.y;return[new l.MercatorCoordinate(0,m/c).toLngLat().lat,new l.MercatorCoordinate(0,(m+1)/c).toLngLat().lat]}function pl(f,r,c,m,b,C,P){const R=f.context,z=R.gl,W=c.fbo;if(!W)return;f.prepareDrawTile();const q=f.useProgram("hillshade");R.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,W.colorAttachment.get());const ae=((xe,De,le,_e)=>{const Ie=le.paint.get("hillshade-shadow-color"),Pe=le.paint.get("hillshade-highlight-color"),Qe=le.paint.get("hillshade-accent-color");let tt=le.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===le.paint.get("hillshade-illumination-anchor")&&(tt-=xe.transform.angle);const et=!xe.options.moving;return{u_matrix:_e||xe.transform.calculateProjMatrix(De.tileID.toUnwrapped(),et),u_image:0,u_latrange:Ua(0,De.tileID),u_light:[le.paint.get("hillshade-exaggeration"),tt],u_shadow:Ie,u_highlight:Pe,u_accent:Qe}})(f,c,m,f.terrain?r.projMatrix:null);f.prepareDrawProgram(R,q,r.toUnwrapped());const{tileBoundsBuffer:fe,tileBoundsIndexBuffer:be,tileBoundsSegments:we}=f.getTileBoundsBuffers(c);q.draw(R,z.TRIANGLES,b,C,P,l.CullFaceMode.disabled,ae,m.id,fe,be,we)}function Yo(f,r,c){if(!r.needsDEMTextureUpload)return;const m=f.context,b=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||f.getTileTexture(c.stride);const C=c.getPixels();r.demTexture?r.demTexture.update(C,{premultiply:!1}):r.demTexture=new l.Texture(m,C,b.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function qs(f,r,c,m,b,C){const P=f.context,R=P.gl;if(!r.dem)return;const z=r.dem;if(P.activeTexture.set(R.TEXTURE1),Yo(f,r,z),!r.demTexture)return;r.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);const W=z.dim;P.activeTexture.set(R.TEXTURE0);let q=r.fbo;if(!q){const we=new l.Texture(P,{width:W,height:W,data:null},R.RGBA);we.bind(R.LINEAR,R.CLAMP_TO_EDGE),q=r.fbo=P.createFramebuffer(W,W,!0),q.colorAttachment.set(we.texture)}P.bindFramebuffer.set(q.framebuffer),P.viewport.set([0,0,W,W]);const{tileBoundsBuffer:ae,tileBoundsIndexBuffer:fe,tileBoundsSegments:be}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(P,R.TRIANGLES,m,b,C,l.CullFaceMode.disabled,((we,xe)=>{const De=xe.stride,le=l.create();return l.ortho(le,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(le,le,[0,-l.EXTENT,0]),{u_matrix:le,u_image:1,u_dimension:[De,De],u_zoom:we.overscaledZ,u_unpack:xe.unpackVector}})(r.tileID,z),c.id,ae,fe,be),r.needsHillshadePrepare=!1}const Oo=f=>({u_matrix:new l.UniformMatrix4f(f),u_image0:new l.Uniform1i(f),u_skirt_height:new l.Uniform1f(f)}),Ns=(f,r)=>({u_matrix:f,u_image0:0,u_skirt_height:r}),Zr=(f,r,c,m,b,C,P,R,z,W,q,ae,fe,be,we)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:c,u_zoom_transition:b,u_merc_center:C,u_image0:0,u_frustum_tl:P,u_frustum_tr:R,u_frustum_br:z,u_frustum_bl:W,u_globe_pos:q,u_globe_radius:ae,u_viewport:fe,u_grid_matrix:we?Float32Array.from(we):new Float32Array(9),u_skirt_height:be});function ml(f,r){return null!=f&&null!=r&&!(!f.hasData()||!r.hasData())&&null!=f.demTexture&&null!=r.demTexture&&f.tileID.key!==r.tileID.key}const lo=new class{constructor(){this.operations={}}newMorphing(f,r,c,m,b){if(f in this.operations){const C=this.operations[f];C.to.tileID.key!==c.tileID.key&&(C.queued=c)}else this.operations[f]={startTime:m,phase:0,duration:b,from:r,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const r=this.operations[f];return{from:r.from,to:r.to,phase:r.phase}}update(f){for(const r in this.operations){const c=this.operations[r];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[r];break}}}_nextOp(f,r){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=r,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Eo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ta(f){return 6*Math.pow(1.5,22-f)}function Ss(f,r){const c=1<<f.z;return!r&&(0===f.x||f.x===c-1)||0===f.y||f.y===c-1}const na=f=>({u_matrix:f});function Is(f,r,c,m,b){if(b>0){const C=l.exported.now(),P=(C-f.timeAdded)/b,R=r?(C-r.timeAdded)/b:-1,z=c.getSource(),W=m.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),q=!r||Math.abs(r.tileID.overscaledZ-W)>Math.abs(f.tileID.overscaledZ-W),ae=q&&f.refreshedUponExpiration?1:l.clamp(q?P:1-R,0,1);return f.refreshedUponExpiration&&P>=1&&(f.refreshedUponExpiration=!1),r?{opacity:1,mix:1-ae}:{opacity:ae,mix:0}}return{opacity:1,mix:0}}class Ks extends l.SourceCache{constructor(r){const c={type:"raster-dem",maxzoom:r.transform.maxZoom},m=new Oi(Be(),null),b=mt("mock-dem",c,m,r.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,c){r.state="loaded",c(null)}}class ha extends l.SourceCache{constructor(r){const c=mt("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Oi(Be(),null),r.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,c,m){if(r.freezeTileCoverage)return;this.transform=r;const b=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,P)=>{if(C[P.key]="",!this._tiles[P.key]){const R=new l.Tile(P,this._source.tileSize*P.overscaleFactor(),r.tileZoom);R.state="loaded",this._tiles[P.key]=R}return C},{});for(const C in this._tiles)C in b||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(r){const c=this.proxyCachedFBO[r];if(void 0!==c){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Va extends l.OverscaledTileID{constructor(r,c,m){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class Jl extends l.Elevation{constructor(r,c){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,b,C]=function(z){const W=new l.StructArrayLayout2i4,q=new l.StructArrayLayout3ui6;W.reserve(17161),q.reserve(33800);const fe=l.EXTENT/128,be=l.EXTENT+fe/2,we=be+fe;for(let De=-fe;De<we;De+=fe)for(let le=-fe;le<we;le+=fe){const _e=le<0||le>be||De<0||De>be?24575:0,Ie=l.clamp(Math.round(le),0,l.EXTENT),Pe=l.clamp(Math.round(De),0,l.EXTENT);W.emplaceBack(Ie+_e,Pe)}const xe=(De,le)=>{const _e=131*le+De;q.emplaceBack(_e+1,_e,_e+131),q.emplaceBack(_e+131,_e+131+1,_e+1)};for(let De=1;De<129;De++)for(let le=1;le<129;le++)xe(le,De);return[0,129].forEach(De=>{for(let le=0;le<130;le++)xe(le,De),xe(De,le)}),[W,q,32768]}(),P=r.context;this.gridBuffer=P.createVertexBuffer(m,l.posAttributes.members),this.gridIndexBuffer=P.createIndexBuffer(b),this.gridSegments=l.SegmentVector.simpleSegment(0,0,m.length,b.length),this.gridNoSkirtSegments=l.SegmentVector.simpleSegment(0,0,m.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ha(c.map),this.orthoMatrix=l.create(),l.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,l.EXTENT,0,l.EXTENT,0,1);const R=P.gl;this._overlapStencilMode=new l.StencilMode({func:R.GEQUAL,mask:255},0,255,R.KEEP,R.KEEP,R.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ks(c.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,c,m){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const b=r.terrain.properties;this.sourceCache=0===r.terrain.drapeRenderMode?this._mockSourceCache:r._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const C=()=>{this.sourceCache.used&&l.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const P=this.getScaledDemTileSize();this.sourceCache.update(c,P,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),c.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&l.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=c.getIds().map(z=>{const W=c.getTileByID(z).tileID;return W.projMatrix=m.calculateProjMatrix(W.toUnwrapped()),W});(function(z,W){const q=W.transform.pointCoordinate(W.transform.getCameraPoint()),ae=new l.Point(q.x,q.y);z.sort((fe,be)=>{if(be.overscaledZ-fe.overscaledZ)return be.overscaledZ-fe.overscaledZ;const we=new l.Point(fe.canonical.x+(1<<fe.canonical.z)*fe.wrap,fe.canonical.y),xe=new l.Point(be.canonical.x+(1<<be.canonical.z)*be.wrap,be.canonical.y),De=ae.mult(1<<fe.canonical.z);return De.x-=.5,De.y-=.5,De.distSqr(we)-De.distSqr(xe)})})(b,this.painter),this._previousZoom=m.zoom;const C=this.proxyToSource||{};this.proxyToSource={},b.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const P=this._style._sourceCaches;for(const z in P){const W=P[z];if(!W.used||(W!==this.sourceCache&&this.resetTileLookupCache(W.id),this._setupProxiedCoordsForOrtho(W,r[z],C),W.usedForTerrain))continue;const q=r[z];W.getSource().reparseOverscaled&&this._assignTerrainTiles(q)}this.proxiedCoords[c.id]=b.map(z=>new Va(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1,this._updateTimestamp=l.exported.now();const R={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const W=this.terrainTileForTile[z.key];if(!W)continue;const q=W.tileID.key;q in R||(this._visibleDemTiles.push(W),R[q]=q)}}_assignTerrainTiles(r){this._initializing||r.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const r=this.painter.context,c=r.gl;for(const m in this.terrainTileForTile){const b=this.terrainTileForTile[m],C=b.dem;!C||b.demTexture&&!b.needsDEMTextureUpload||(r.activeTexture.set(c.TEXTURE1),Yo(this.painter,b,C))}}_prepareDemTileUniforms(r,c,m,b){if(!c||null==c.demTexture)return!1;const C=r.tileID.canonical,P=Math.pow(2,c.tileID.canonical.z-C.z),R=b||"";return m[`u_dem_tl${R}`]=[C.x*P%1,C.y*P%1],m[`u_dem_scale${R}`]=P,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,c=r.gl;if(!this._emptyDepthBufferTexture){const m=new l.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new l.Texture(r,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const c=this._visibleDemTiles.reduce((m,b)=>{if(!b.dem)return m;const C=b.dem.tree.minimums[0];return C>0&&r++,m+C},0);return r?c/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,c=r.gl;r.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),b=new l.RGBAImage({width:1,height:1},new Uint8Array(l.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(b,{premultiply:!1}):C=this._emptyDEMTexture=new l.Texture(r,b,c.RGBA,{premultiply:!1}),C}setupElevationDraw(r,c,m){const b=this.painter.context,C=b.gl,P=(R=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:l.DEMData.getUnpackVector(R),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var R;P.u_dem_size=this.sourceCache.getSource().tileSize,P.u_exaggeration=this.exaggeration();let z=null,W=null,q=1;if(m&&m.morphing&&this._useVertexMorphing){const ae=m.morphing.srcDemTile,fe=m.morphing.dstDemTile;q=m.morphing.phase,ae&&fe&&(this._prepareDemTileUniforms(r,ae,P,"_prev")&&(W=ae),this._prepareDemTileUniforms(r,fe,P)&&(z=fe))}if(W&&z?(b.activeTexture.set(C.TEXTURE2),z.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),b.activeTexture.set(C.TEXTURE4),W.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),P.u_dem_lerp=q):(z=this.terrainTileForTile[r.tileID.key],b.activeTexture.set(C.TEXTURE2),(this._prepareDemTileUniforms(r,z,P)?z.demTexture:this.emptyDEMTexture).bind(C.NEAREST,C.CLAMP_TO_EDGE)),b.activeTexture.set(C.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),this._depthFBO&&(P.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),P.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&z){const ae=(1<<z.tileID.canonical.z)*l.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;P.u_meter_to_dem=ae}if(m&&m.labelPlaneMatrixInv&&(P.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(b,P),"globe"===this.painter.transform.projection.name){const ae=this.globeUniformValues(this.painter.transform,r.tileID.canonical,m&&m.useDenormalizedUpVectorScale);c.setGlobeUniformValues(b,ae)}}globeUniformValues(r,c,m){const b=r.projection;return{u_tile_tl_up:b.upVector(c,0,0),u_tile_tr_up:b.upVector(c,l.EXTENT,0),u_tile_br_up:b.upVector(c,l.EXTENT,l.EXTENT),u_tile_bl_up:b.upVector(c,0,l.EXTENT),u_tile_up_scale:m?l.globeMetersToEcef(1):b.upVectorScale(c,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const c=this.painter,m=this.painter.context;0!==r.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,C,P,R,z){if("globe"===b.transform.projection.name)!function(W,q,ae,fe,be){const we=W.context,xe=we.gl;let De,le;const _e=W.options.showTerrainWireframe?2:0,Ie=W.transform,Pe=l.globeUseCustomAntiAliasing(W,we,Ie),Qe=(mn,It)=>{if(le===mn)return;const Jt=[Eo[mn],"PROJECTION_GLOBE_VIEW"];Pe&&Jt.push("CUSTOM_ANTIALIASING"),It&&Jt.push(Eo[_e]),De=W.useProgram("globeRaster",null,Jt),le=mn},tt=W.colorModeForRenderPass(),et=new l.DepthMode(xe.LEQUAL,l.DepthMode.ReadWrite,W.depthRangeFor3D);lo.update(be);const gt=l.calculateGlobeMercatorMatrix(Ie),st=[l.mercatorXfromLng(Ie.center.lng),l.mercatorYfromLat(Ie.center.lat)],Mt=_e?[!1,!0]:[!1],pn=W.globeSharedBuffers,Ct=[Ie.width*l.exported.devicePixelRatio,Ie.height*l.exported.devicePixelRatio],Qt=Float32Array.from(Ie.globeMatrix),kt={useDenormalizedUpVectorScale:!0};if(Mt.forEach(mn=>{const It=W.transform,Jt=ta(It.zoom)*q.exaggeration();le=-1;const En=mn?xe.LINES:xe.TRIANGLES;for(const ln of fe){const Cn=ae.getTile(ln),ai=l.StencilMode.disabled,Ai=q.prevTerrainTileForTile[ln.key],Hn=q.terrainTileForTile[ln.key];ml(Ai,Hn)&&lo.newMorphing(ln.key,Ai,Hn,be,250),we.activeTexture.set(xe.TEXTURE0),Cn.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE);const wi=lo.getMorphValuesForProxy(ln.key),rr=wi?1:0;wi&&l.extend$1(kt,{morphing:{srcDemTile:wi.from,dstDemTile:wi.to,phase:l.easeCubicInOut(wi.phase)}});const er=l.tileCornersToBounds(ln.canonical),Qn=l.getLatitudinalLod(er.getCenter().lat),yr=l.getGridMatrix(ln.canonical,er,Qn,It.worldSize/It._pixelsPerMercatorPixel),or=l.globeNormalizeECEF(l.globeTileBounds(ln.canonical)),Ir=Zr(It.projMatrix,Qt,gt,or,l.globeToMercatorTransition(It.zoom),st,It.frustumCorners.TL,It.frustumCorners.TR,It.frustumCorners.BR,It.frustumCorners.BL,It.globeCenterInViewSpace,It.globeRadius,Ct,Jt,yr);if(Qe(rr,mn),q.setupElevationDraw(Cn,De,kt),W.prepareDrawProgram(we,De,ln.toUnwrapped()),pn){const[$r,Rs,Wo]=mn?pn.getWirefameBuffers(W.context,Qn):pn.getGridBuffers(Qn,0!==Jt);De.draw(we,En,et,ai,tt,l.CullFaceMode.backCCW,Ir,"globe_raster",$r,Rs,Wo)}}}),pn){const mn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Pe&&mn.push("CUSTOM_ANTIALIASING"),De=W.useProgram("globeRaster",null,mn);for(const It of fe){const{x:Jt,y:En,z:ln}=It.canonical,Cn=0===En,ai=En===(1<<ln)-1,[Ai,Hn,wi,rr]=pn.getPoleBuffers(ln);if(rr&&(Cn||ai)){const er=ae.getTile(It);we.activeTexture.set(xe.TEXTURE0),er.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE);let Qn=l.globePoleMatrixForTile(ln,Jt,Ie);const yr=l.globeNormalizeECEF(l.globeTileBounds(It.canonical)),or=(Ir,$r)=>Ir.draw(we,xe.TRIANGLES,et,l.StencilMode.disabled,tt,l.CullFaceMode.disabled,Zr(Ie.projMatrix,Qn,Qn,yr,0,st,Ie.frustumCorners.TL,Ie.frustumCorners.TR,Ie.frustumCorners.BR,Ie.frustumCorners.BL,Ie.globeCenterInViewSpace,Ie.globeRadius,Ct,0),"globe_pole_raster",$r,wi,rr);q.setupElevationDraw(er,De,kt),W.prepareDrawProgram(we,De,It.toUnwrapped()),Cn&&or(De,Ai),ai&&(Qn=l.scale(l.create(),Qn,[1,-1,1]),or(De,Hn))}}}}(b,C,P,R,z);else{const W=b.context,q=W.gl;let ae,fe;const be=b.options.showTerrainWireframe?2:0,we=(Ie,Pe)=>{if(fe===Ie)return;const Qe=[Eo[Ie]];Pe&&Qe.push(Eo[be]),ae=b.useProgram("terrainRaster",null,Qe),fe=Ie},xe=b.colorModeForRenderPass(),De=new l.DepthMode(q.LEQUAL,l.DepthMode.ReadWrite,b.depthRangeFor3D);lo.update(z);const le=b.transform,_e=ta(le.zoom)*C.exaggeration();(be?[!1,!0]:[!1]).forEach(Ie=>{fe=-1;const Pe=Ie?q.LINES:q.TRIANGLES,[Qe,tt]=Ie?C.getWirefameBuffer():[C.gridIndexBuffer,C.gridSegments];for(const et of R){const gt=P.getTile(et),st=l.StencilMode.disabled,Mt=C.prevTerrainTileForTile[et.key],pn=C.terrainTileForTile[et.key];ml(Mt,pn)&&lo.newMorphing(et.key,Mt,pn,z,250),W.activeTexture.set(q.TEXTURE0),gt.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST);const Ct=lo.getMorphValuesForProxy(et.key),Qt=Ct?1:0;let kt;Ct&&(kt={morphing:{srcDemTile:Ct.from,dstDemTile:Ct.to,phase:l.easeCubicInOut(Ct.phase)}});const mn=Ns(et.projMatrix,Ss(et.canonical,le.renderWorldCopies)?_e/10:_e);we(Qt,Ie),C.setupElevationDraw(gt,ae,kt),b.prepareDrawProgram(W,ae,et.toUnwrapped()),ae.draw(W,Pe,De,st,xe,l.CullFaceMode.backCCW,mn,"terrain_raster",C.gridBuffer,Qe,tt)}})}}(c,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,b=this.proxySourceCache,C=this.proxiedCoords[b.id],P=this._drapedRenderBatches.shift(),R=[],z=c.style.order;let W=0;for(const q of C){const ae=b.getTileByID(q.proxyTileKey),fe=b.proxyCachedFBO[q.key]?b.proxyCachedFBO[q.key][r]:void 0,be=void 0!==fe?b.renderCache[fe]:this.pool[W++],we=void 0!==fe;if(ae.texture=be.tex,we&&!be.dirty){R.push(ae.tileID);continue}let xe;m.bindFramebuffer.set(be.fb.framebuffer),this.renderedToTile=!1,be.dirty&&(m.clear({color:l.Color.transparent,stencil:0}),be.dirty=!1);for(let De=P.start;De<=P.end;++De){const le=c.style._layers[z[De]];if(le.isHidden(c.transform.zoom))continue;const _e=c.style._getLayerSourceCache(le),Ie=_e?this.proxyToSource[q.key][_e.id]:[q];if(!Ie)continue;const Pe=Ie;m.viewport.set([0,0,be.fb.width,be.fb.height]),xe!==(_e?_e.id:null)&&(this._setupStencil(be,Ie,le,_e),xe=_e?_e.id:null),c.renderLayer(c,_e,le,Pe)}this.renderedToTile?(be.dirty=!0,R.push(ae.tileID)):we||--W,5===W&&(W=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),P.end+1}postRender(){}renderCacheEfficiency(r){const c=r.order.length;if(0===c)return{efficiency:100};let m,b=0,C=0,P=!1;for(let R=0;R<c;++R){const z=r._layers[r.order[R]];this._style.isLayerDraped(z)?(P&&++b,++C):P||(P=!0,m=z.id)}return 0===C?{efficiency:100}:{efficiency:100*(1-b/C),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{r=Math.min(r,c.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,c,m){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const P=C.tileID,R=1<<P.overscaledZ,{x:z,y:W}=P.canonical,q=z/R,ae=(z+1)/R,fe=W/R,be=(W+1)/R;return{minx:q,miny:fe,maxx:ae,maxy:be,t:C.dem.tree.raycastRoot(q,fe,ae,be,r,c,m),tile:C}});b.sort((C,P)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==P.t?P.t:Number.MAX_VALUE));for(const C of b){if(null==C.t)return null;const P=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,r,c,m);if(null!=P)return P}return null}_createFBO(){const r=this.painter.context,c=r.gl,m=this.drapeBufferSize;r.activeTexture.set(c.TEXTURE0);const b=new l.Texture(r,{width:m[0],height:m[1],data:null},c.RGBA);b.bind(c.LINEAR,c.CLAMP_TO_EDGE);const C=r.createFramebuffer(m[0],m[1],!1);return C.colorAttachment.set(b.texture),C.depthAttachment=new Je(r,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:C,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const c=this._style._layers[r],m=c.isHidden(this.painter.transform.zoom);return"custom"===c.type?!m&&c.shouldRedrape():!m&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const m of this._style._getSources())if(m instanceof fn){r=!0;break}if(!r)return;const c={};for(let m=0;m<this._style.order.length;++m){const b=this._style._layers[this._style.order[m]],C=this._style._getLayerSourceCache(b);if(C&&!c[C.id]&&!b.isHidden(this.painter.transform.zoom)&&"line"===b.type&&b.widthExpression()instanceof l.ZoomDependentExpression){c[C.id]=!0;for(const P of this.proxyCoords){const R=this.proxyToSource[P.key][C.id];if(R)for(const z of R)this._clearRenderCacheForTile(C.id,z)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const m in this._style._sourceCaches)if(this._style._sourceCaches[m]._source instanceof qe){r=!0;break}if(!r)return;const c={};for(let m=0;m<this._style.order.length;++m){const b=this._style._layers[this._style.order[m]],C=this._style._getLayerSourceCache(b);if(!C||c[C.id]||b.isHidden(this.painter.transform.zoom)||"raster"!==b.type)continue;const P=b.paint.get("raster-fade-duration");for(const R of this.proxyCoords){const z=this.proxyToSource[R.key][C.id];if(z)for(const W of z){const q=Is(C.getTile(W),C.findLoadedParent(W,0),C,this.painter.transform,P);(1!==q.opacity||0!==q.mix)&&this._clearRenderCacheForTile(C.id,W)}}}}_setupDrapedRenderBatches(){const r=this._style.order,c=r.length;if(0===c)return;const m=[];let b,C=0,P=this._style._layers[r[C]];for(;!this._style.isLayerDraped(P)&&P.isHidden(this.painter.transform.zoom)&&++C<c;)P=this._style._layers[r[C]];for(;C<c;++C){const R=this._style._layers[r[C]];R.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(R)?void 0===b&&(b=C):void 0!==b&&(m.push({start:b,end:C-1}),b=void 0))}void 0!==b&&m.push({start:b,end:C-1}),this._drapedRenderBatches=m}_setupRenderCache(r){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const P=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let R=0;R<P.length;++R){const z=Object.values(P[R]);c.renderCachePool.push(...z)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,b=this._tilesDirty;for(let P=m.length-1;P>=0;P--){const R=m[P];if(c.getTileByID(R.key),void 0!==c.proxyCachedFBO[R.key]){const z=r[R.key],W=this.proxyToSource[R.key];let q=0;for(const ae in W){const fe=W[ae],be=z[ae];if(!be||be.length!==fe.length||fe.some((we,xe)=>we!==be[xe]||b[ae]&&b[ae].hasOwnProperty(we.key))){q=-1;break}++q}for(const ae in c.proxyCachedFBO[R.key])c.renderCache[c.proxyCachedFBO[R.key][ae]].dirty=q<0||q!==Object.values(z).length}}const C=[...this._drapedRenderBatches];C.sort((P,R)=>R.end-R.start-(P.end-P.start));for(const P of C)for(const R of m){if(c.proxyCachedFBO[R.key])continue;let z=c.renderCachePool.pop();void 0===z&&c.renderCache.length<50&&(z=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==z&&(c.proxyCachedFBO[R.key]={},c.proxyCachedFBO[R.key][P.start]=z,c.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(r,c,m,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,P=C.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let R;if(m.isTileClipped())R=c.length,this._overlapStencilMode.test={func:P.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);R=1,this._overlapStencilMode.test={func:P.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+R>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=R,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):l.StencilMode.disabled}_renderTileClippingMasks(r,c){const m=this.painter,b=this.painter.context,C=b.gl;m._tileClippingMaskIDs={},b.setColorMode(l.ColorMode.disabled),b.setDepthMode(l.DepthMode.disabled);const P=m.useProgram("clippingMask");for(const R of r){const z=m._tileClippingMaskIDs[R.key]=--c;P.draw(b,C.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:C.ALWAYS,mask:0},z,255,C.KEEP,C.KEEP,C.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,na(R.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(r){const c=this.painter.transform;if(r.x<0||r.x>c.width||r.y<0||r.y>c.height)return null;const m=[r.x,r.y,1,1];l.transformMat4$1(m,m,c.pixelMatrixInverse),l.scale$1(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const b=c._camera.position,C=l.mercatorZfromAltitude(1,c.center.lat),P=[b[0],b[1],b[2]/C,0],R=l.subtract([],m.slice(0,3),P);l.normalize(R,R);const z=this.raycast(P,R,this._exaggeration);return null!==z&&z?(l.scaleAndAdd(P,P,R,z),P[3]=P[2],P[2]*=C,P):null}drawDepth(){const r=this.painter,c=r.context,m=this.proxySourceCache,b=Math.ceil(r.width),C=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===C||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const P=c.gl,R=c.createFramebuffer(b,C,!0);c.activeTexture.set(P.TEXTURE0);const z=new l.Texture(c,{width:b,height:C,data:null},P.RGBA);z.bind(P.NEAREST,P.CLAMP_TO_EDGE),R.colorAttachment.set(z.texture);const W=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,b,C);R.depthAttachment.set(W),this._depthFBO=R,this._depthTexture=z}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,b,C]),function(P,R,z,W){if("globe"===P.transform.projection.name)return;const q=P.context,ae=q.gl;q.clear({depth:1});const fe=P.useProgram("terrainDepth"),be=new l.DepthMode(ae.LESS,l.DepthMode.ReadWrite,P.depthRangeFor3D);for(const we of W){const xe=z.getTile(we),De=Ns(we.projMatrix,0);R.setupElevationDraw(xe,fe),fe.draw(q,ae.TRIANGLES,be,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.backCCW,De,"terrain_depth",R.gridBuffer,R.gridIndexBuffer,R.gridNoSkirtSegments)}}(r,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,c,m){if(r.getSource()instanceof pt)return this._setupProxiedCoordsForImageSource(r,c,m);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const b=this.proxiedCoords[r.id]=[],C=this.proxyCoords;for(let R=0;R<C.length;R++){const z=C[R],W=this._findTileCoveringTileID(z,r);if(W){const q=this._createProxiedId(z,W,m[z.key]&&m[z.key][r.id]);b.push(q),this.proxyToSource[z.key][r.id]=[q]}}let P=!1;for(let R=0;R<c.length;R++){const z=r.getTile(c[R]);if(!z||!z.hasData())continue;const W=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(W&&W.tileID.canonical.z!==z.tileID.canonical.z){const q=this.proxyToSource[W.tileID.key][r.id],ae=this._createProxiedId(W.tileID,z,m[W.tileID.key]&&m[W.tileID.key][r.id]);q?q.splice(q.length-1,0,ae):this.proxyToSource[W.tileID.key][r.id]=[ae],b.push(ae),P=!0}}this._sourceTilesOverlap[r.id]=P}_setupProxiedCoordsForImageSource(r,c,m){if(!r.getSource().loaded())return;const b=this.proxiedCoords[r.id]=[],C=this.proxyCoords,P=r.getSource(),R=new l.Point(P.tileID.x,P.tileID.y)._div(1<<P.tileID.z),z=P.coordinates.map(l.MercatorCoordinate.fromLngLat).reduce((q,ae)=>(q.min.x=Math.min(q.min.x,ae.x-R.x),q.min.y=Math.min(q.min.y,ae.y-R.y),q.max.x=Math.max(q.max.x,ae.x-R.x),q.max.y=Math.max(q.max.y,ae.y-R.y),q),{min:new l.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new l.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),W=(q,ae)=>{const fe=q.wrap+q.canonical.x/(1<<q.canonical.z),be=q.canonical.y/(1<<q.canonical.z),we=l.EXTENT/(1<<q.canonical.z),xe=ae.wrap+ae.canonical.x/(1<<ae.canonical.z),De=ae.canonical.y/(1<<ae.canonical.z);return fe+we<xe+z.min.x||fe>xe+z.max.x||be+we<De+z.min.y||be>De+z.max.y};for(let q=0;q<C.length;q++){const ae=C[q];for(let fe=0;fe<c.length;fe++){const be=r.getTile(c[fe]);if(!be||!be.hasData()||W(ae,be.tileID))continue;const we=this._createProxiedId(ae,be,m[ae.key]&&m[ae.key][r.id]),xe=this.proxyToSource[ae.key][r.id];xe?xe.push(we):this.proxyToSource[ae.key][r.id]=[we],b.push(we)}}}_createProxiedId(r,c,m){let b=this.orthoMatrix;if(m){const C=m.find(P=>P.key===c.tileID.key);if(C)return C}if(c.tileID.key!==r.key){const C=r.canonical.z-c.tileID.canonical.z;let P,R,z;b=l.create();const W=c.tileID.wrap-r.wrap<<r.overscaledZ;C>0?(P=l.EXTENT>>C,R=P*((c.tileID.canonical.x<<C)-r.canonical.x+W),z=P*((c.tileID.canonical.y<<C)-r.canonical.y)):(P=l.EXTENT<<-C,R=l.EXTENT*(c.tileID.canonical.x-(r.canonical.x+W<<-C)),z=l.EXTENT*(c.tileID.canonical.y-(r.canonical.y<<-C))),l.ortho(b,0,P,0,P,0,1),l.translate(b,b,[R,z,0])}return new Va(c.tileID,r.key,b)}_findTileCoveringTileID(r,c){let m=c.getTile(r);if(m&&m.hasData())return m;const b=this._findCoveringTileCache[c.id],C=b[r.key];if(m=C?c.getTileByID(C):null,m&&m.hasData()||null===C)return m;let P=m?m.tileID:r,R=P.overscaledZ;const z=c.getSource().minzoom,W=[];if(!C){const ae=c.getSource().maxzoom;if(r.canonical.z>=ae){const fe=r.canonical.z-ae;c.getSource().reparseOverscaled?(R=Math.max(r.canonical.z+2,c.transform.tileZoom),P=new l.OverscaledTileID(R,r.wrap,ae,r.canonical.x>>fe,r.canonical.y>>fe)):0!==fe&&(R=ae,P=new l.OverscaledTileID(R,r.wrap,ae,r.canonical.x>>fe,r.canonical.y>>fe))}P.key!==r.key&&(W.push(P.key),m=c.getTile(P))}const q=ae=>{W.forEach(fe=>{b[fe]=ae}),W.length=0};for(R-=1;R>=z&&(!m||!m.hasData());R--){m&&q(m.tileID.key);const ae=P.calculateScaledKey(R);if(m=c.getTileByID(ae),m&&m.hasData())break;const fe=b[ae];if(null===fe)break;void 0===fe?W.push(ae):m=c.getTileByID(fe)}return q(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,c){let m=this._tilesDirty[r];m||(m=this._tilesDirty[r]={}),m[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(c){let m=0;const b=new l.StructArrayLayout2ui4,C=131;for(let P=1;P<129;P++){for(let R=1;R<129;R++)m=P*C+R,b.emplaceBack(m,m+1),b.emplaceBack(m,m+C),b.emplaceBack(m+1,m+C),128===P&&b.emplaceBack(m+C,m+C+1);b.emplaceBack(m+1,m+1+C)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=l.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ki{static cacheKey(r,c,m,b){let C=`${c}${b?b.cacheKey:""}`;for(const P of m)r.usedDefines.includes(P)&&(C+=`/${P}`);return C}constructor(r,c,m,b,C,P){const R=r.gl;this.program=R.createProgram();const z=function(le){const _e=[];for(let Ie=0;Ie<le.length;Ie++){if(null===le[Ie])continue;const Pe=le[Ie].split(" ");_e.push(Pe.pop())}return _e}(m.staticAttributes),W=b?b.getBinderAttributes():[],q=z.concat(W);let ae=b?b.defines():[];ae=ae.concat(P.map(le=>`#define ${le}`));const fe=r.isWebGL2?"#version 300 es\n":"",be=fe+ae.concat(r.extStandardDerivatives&&0===fe.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Ms):Ms,Ms,ys,tl.fragmentSource,Ko.fragmentSource,m.fragmentSource).join("\n"),we=fe+ae.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ys,tl.vertexSource,Ko.vertexSource,Ws.vertexSource,m.vertexSource).join("\n"),xe=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);R.shaderSource(xe,be),R.compileShader(xe),R.attachShader(this.program,xe);const De=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(De,we),R.compileShader(De),R.attachShader(this.program,De),this.attributes={},this.numAttributes=q.length;for(let le=0;le<this.numAttributes;le++)q[le]&&(R.bindAttribLocation(this.program,le,q[le]),this.attributes[q[le]]=le);R.linkProgram(this.program),R.deleteShader(De),R.deleteShader(xe),this.fixedUniforms=C(r),this.binderUniforms=b?b.getUniforms(r):[],P.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new l.Uniform1i(le=r),u_dem_prev:new l.Uniform1i(le),u_dem_unpack:new l.Uniform4f(le),u_dem_tl:new l.Uniform2f(le),u_dem_scale:new l.Uniform1f(le),u_dem_tl_prev:new l.Uniform2f(le),u_dem_scale_prev:new l.Uniform1f(le),u_dem_size:new l.Uniform1f(le),u_dem_lerp:new l.Uniform1f(le),u_exaggeration:new l.Uniform1f(le),u_depth:new l.Uniform1i(le),u_depth_size_inv:new l.Uniform2f(le),u_meter_to_dem:new l.Uniform1f(le),u_label_plane_matrix_inv:new l.UniformMatrix4f(le)}),P.includes("GLOBE")&&(this.globeUniforms=(le=>({u_tile_tl_up:new l.Uniform3f(le),u_tile_tr_up:new l.Uniform3f(le),u_tile_br_up:new l.Uniform3f(le),u_tile_bl_up:new l.Uniform3f(le),u_tile_up_scale:new l.Uniform1f(le)}))(r)),P.includes("FOG")&&(this.fogUniforms=(le=>({u_fog_matrix:new l.UniformMatrix4f(le),u_fog_range:new l.Uniform2f(le),u_fog_color:new l.Uniform4f(le),u_fog_horizon_blend:new l.Uniform1f(le),u_fog_temporal_offset:new l.Uniform1f(le),u_frustum_tl:new l.Uniform3f(le),u_frustum_tr:new l.Uniform3f(le),u_frustum_br:new l.Uniform3f(le),u_frustum_bl:new l.Uniform3f(le),u_globe_pos:new l.Uniform3f(le),u_globe_radius:new l.Uniform1f(le),u_globe_transition:new l.Uniform1f(le),u_is_globe:new l.Uniform1i(le),u_viewport:new l.Uniform2f(le)}))(r))}var le}setTerrainUniformValues(r,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const b in c)m[b]&&m[b].set(this.program,b,c[b])}}setGlobeUniformValues(r,c){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const b in c)m[b]&&m[b].set(this.program,b,c[b])}}setFogUniformValues(r,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const b in c)m[b].set(this.program,b,c[b])}}draw(r,c,m,b,C,P,R,z,W,q,ae,fe,be,we,xe){const De=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(m),r.setStencilMode(b),r.setColorMode(C),r.setCullFace(P);for(const _e of Object.keys(this.fixedUniforms))this.fixedUniforms[_e].set(this.program,_e,R[_e]);we&&we.setUniforms(this.program,r,this.binderUniforms,fe,{zoom:be});const le={[De.LINES]:2,[De.TRIANGLES]:3,[De.LINE_STRIP]:1}[c];for(const _e of ae.get()){const Ie=_e.vaos||(_e.vaos={});(Ie[z]||(Ie[z]=new Dc)).bind(r,this,W,we?we.getPaintVertexBuffers():[],q,_e.vertexOffset,xe||[]),De.drawElements(c,_e.primitiveLength*le,De.UNSIGNED_SHORT,_e.primitiveOffset*le*2)}}}function ia(f,r){const c=Math.pow(2,r.tileID.overscaledZ),m=r.tileSize*Math.pow(2,f.transform.tileZoom)/c,b=m*(r.tileID.canonical.x+r.tileID.wrap*c),C=m*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/ji(r,1,f.transform.tileZoom),u_pixel_coord_upper:[b>>16,C>>16],u_pixel_coord_lower:[65535&b,65535&C]}}const Tc=l.create(),Ql=(f,r,c,m,b,C,P,R,z,W,q)=>{const ae=r.style.light,fe=ae.properties.get("position"),be=[fe.x,fe.y,fe.z],we=l.create$1();"viewport"===ae.properties.get("anchor")&&(l.fromRotation(we,-r.transform.angle),l.transformMat3(be,be,we));const xe=ae.properties.get("color"),De=r.transform,le={u_matrix:f,u_lightpos:be,u_lightintensity:ae.properties.get("intensity"),u_lightcolor:[xe.r,xe.g,xe.b],u_vertical_gradient:+c,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Tc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:C};return"globe"===De.projection.name&&(le.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],le.u_zoom_transition=z,le.u_inv_rot_matrix=q,le.u_merc_center=W,le.u_up_dir=De.projection.upVector(new l.CanonicalTileID(0,0,0),W[0]*l.EXTENT,W[1]*l.EXTENT),le.u_height_lift=R),le},ou=(f,r,c,m,b,C,P,R,z,W,q,ae)=>{const fe=Ql(f,r,c,m,b,C,P,z,W,q,ae),be={u_height_factor:-Math.pow(2,P.overscaledZ)/R.tileSize/8};return l.extend(fe,ia(r,R),be)},nl=f=>({u_matrix:f}),co=(f,r,c)=>l.extend(nl(f),ia(r,c)),su=(f,r)=>({u_matrix:f,u_world:r}),Bu=(f,r,c,m)=>l.extend(co(f,r,c),{u_world:m}),ne=l.create(),Q=(f,r,c,m,b,C)=>{const P=f.transform,R="globe"===P.projection.name;let z;if("map"===C.paint.get("circle-pitch-alignment"))if(R){const q=l.globePixelsToTileUnits(P.zoom,r.canonical)*P._pixelsPerMercatorPixel;z=Float32Array.from([q,0,0,q])}else z=P.calculatePixelsToTileUnitsMatrix(c);else z=new Float32Array([P.pixelsToGLUnits[0],0,0,P.pixelsToGLUnits[1]]);const W={u_camera_to_center_distance:P.cameraToCenterDistance,u_matrix:f.translatePosMatrix(r.projMatrix,c,C.paint.get("circle-translate"),C.paint.get("circle-translate-anchor")),u_device_pixel_ratio:l.exported.devicePixelRatio,u_extrude_scale:z,u_inv_rot_matrix:ne,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){W.u_inv_rot_matrix=m,W.u_merc_center=b,W.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],W.u_zoom_transition=l.globeToMercatorTransition(P.zoom);const q=b[0]*l.EXTENT,ae=b[1]*l.EXTENT;W.u_up_dir=P.projection.upVector(new l.CanonicalTileID(0,0,0),q,ae)}return W},ye=f=>{const r=[];return"map"===f.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},ie=(f,r,c,m)=>{const b=l.EXTENT/c.tileSize;return{u_matrix:f,u_camera_to_center_distance:r.getCameraToCenterDistance(m),u_extrude_scale:[r.pixelsToGLUnits[0]/b,r.pixelsToGLUnits[1]/b]}},Ae=(f,r,c=1)=>({u_matrix:f,u_color:r,u_overlay:0,u_overlay_scale:c}),Pn=l.create(),Ii=(f,r,c,m,b,C,P)=>{const R=f.transform,z="globe"===R.projection.name,W=z?l.globePixelsToTileUnits(R.zoom,r.canonical)*R._pixelsPerMercatorPixel:ji(c,1,C),q={u_matrix:r.projMatrix,u_extrude_scale:W,u_intensity:P,u_inv_rot_matrix:Pn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){q.u_inv_rot_matrix=m,q.u_merc_center=b,q.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],q.u_zoom_transition=l.globeToMercatorTransition(R.zoom);const ae=b[0]*l.EXTENT,fe=b[1]*l.EXTENT;q.u_up_dir=R.projection.upVector(new l.CanonicalTileID(0,0,0),ae,fe)}return q},Ho=(f,r,c,m,b,C,P)=>{const R=f.transform,z=R.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:ko(f,r,c,m),u_pixels_to_tile_units:z,u_device_pixel_ratio:C,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:Bs(c)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:us(r,f.transform),u_alpha_discard_threshold:0,u_trim_offset:P}},_o=(f,r,c,m,b)=>{const C=f.transform;return{u_matrix:ko(f,r,c,m),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:b,u_image:0,u_tile_units_to_pixels:us(r,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function us(f,r){return 1/ji(f,1,r.tileZoom)}function ko(f,r,c,m){return f.translatePosMatrix(m||r.tileID.projMatrix,r,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function Bs(f){const r=f.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const Da=(f,r,c,m,b,C)=>{return{u_matrix:f,u_tl_parent:r,u_scale_parent:c,u_fade_t:m.mix,u_opacity:m.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(R=b.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(P=b.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:Nr(b.paint.get("raster-hue-rotate")),u_perspective_transform:C};var P,R};function Nr(f){f*=Math.PI/180;const r=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*r-c+1)/3,(Math.sqrt(3)*r-c+1)/3]}const gl=l.create(),_l=(f,r,c,m,b,C,P,R,z,W,q,ae,fe,be,we,xe)=>{const De=b.transform,le={u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:De.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:De.width/De.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:P,u_coord_matrix:R,u_is_text:+z,u_pitch_with_map:+m,u_texsize:W,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:gl,u_up_vector:[0,-1,0]};return"globe"===xe.name&&(le.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],le.u_zoom_transition=ae,le.u_inv_rot_matrix=be,le.u_merc_center=fe,le.u_camera_forward=De._camera.forward(),le.u_ecef_origin=l.globeECEFOrigin(De.globeMatrix,q.toUnwrapped()),le.u_tile_matrix=Float32Array.from(De.globeMatrix),le.u_up_vector=we),le},Ta=(f,r,c,m,b,C,P,R,z,W,q,ae,fe,be,we,xe,De)=>l.extend(_l(f,r,c,m,b,C,P,R,z,W,ae,fe,be,we,xe,De),{u_gamma_scale:m?b.transform.cameraToCenterDistance*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:l.exported.devicePixelRatio,u_is_halo:+q}),Ma=(f,r,c,m,b,C,P,R,z,W,q,ae,fe,be,we,xe)=>l.extend(Ta(f,r,c,m,b,C,P,R,!0,z,!0,q,ae,fe,be,we,xe),{u_texsize_icon:W,u_texture_icon:1}),Sa=(f,r,c)=>({u_matrix:f,u_opacity:r,u_color:c}),au=(f,r,c,m,b)=>l.extend(function(C,P,R){const z=P.imageManager.getPattern(C.toString()),{width:W,height:q}=P.imageManager.getPixelSize(),ae=Math.pow(2,R.tileID.overscaledZ),fe=R.tileSize*Math.pow(2,P.transform.tileZoom)/ae,be=fe*(R.tileID.canonical.x+R.tileID.wrap*ae),we=fe*R.tileID.canonical.y;return{u_image:0,u_pattern_tl:z.tl,u_pattern_br:z.br,u_texsize:[W,q],u_pattern_size:z.displaySize,u_tile_units_to_pixels:1/ji(R,1,P.transform.tileZoom),u_pixel_coord_upper:[be>>16,we>>16],u_pixel_coord_lower:[65535&be,65535&we]}}(m,c,b),{u_matrix:f,u_opacity:r}),zs={fillExtrusion:f=>({u_matrix:new l.UniformMatrix4f(f),u_lightpos:new l.Uniform3f(f),u_lightintensity:new l.Uniform1f(f),u_lightcolor:new l.Uniform3f(f),u_vertical_gradient:new l.Uniform1f(f),u_opacity:new l.Uniform1f(f),u_edge_radius:new l.Uniform1f(f),u_ao:new l.Uniform2f(f),u_tile_id:new l.Uniform3f(f),u_zoom_transition:new l.Uniform1f(f),u_inv_rot_matrix:new l.UniformMatrix4f(f),u_merc_center:new l.Uniform2f(f),u_up_dir:new l.Uniform3f(f),u_height_lift:new l.Uniform1f(f)}),fillExtrusionPattern:f=>({u_matrix:new l.UniformMatrix4f(f),u_lightpos:new l.Uniform3f(f),u_lightintensity:new l.Uniform1f(f),u_lightcolor:new l.Uniform3f(f),u_vertical_gradient:new l.Uniform1f(f),u_height_factor:new l.Uniform1f(f),u_edge_radius:new l.Uniform1f(f),u_ao:new l.Uniform2f(f),u_tile_id:new l.Uniform3f(f),u_zoom_transition:new l.Uniform1f(f),u_inv_rot_matrix:new l.UniformMatrix4f(f),u_merc_center:new l.Uniform2f(f),u_up_dir:new l.Uniform3f(f),u_height_lift:new l.Uniform1f(f),u_image:new l.Uniform1i(f),u_texsize:new l.Uniform2f(f),u_pixel_coord_upper:new l.Uniform2f(f),u_pixel_coord_lower:new l.Uniform2f(f),u_tile_units_to_pixels:new l.Uniform1f(f),u_opacity:new l.Uniform1f(f)}),fill:f=>({u_matrix:new l.UniformMatrix4f(f)}),fillPattern:f=>({u_matrix:new l.UniformMatrix4f(f),u_image:new l.Uniform1i(f),u_texsize:new l.Uniform2f(f),u_pixel_coord_upper:new l.Uniform2f(f),u_pixel_coord_lower:new l.Uniform2f(f),u_tile_units_to_pixels:new l.Uniform1f(f)}),fillOutline:f=>({u_matrix:new l.UniformMatrix4f(f),u_world:new l.Uniform2f(f)}),fillOutlinePattern:f=>({u_matrix:new l.UniformMatrix4f(f),u_world:new l.Uniform2f(f),u_image:new l.Uniform1i(f),u_texsize:new l.Uniform2f(f),u_pixel_coord_upper:new l.Uniform2f(f),u_pixel_coord_lower:new l.Uniform2f(f),u_tile_units_to_pixels:new l.Uniform1f(f)}),circle:f=>({u_camera_to_center_distance:new l.Uniform1f(f),u_extrude_scale:new l.UniformMatrix2f(f),u_device_pixel_ratio:new l.Uniform1f(f),u_matrix:new l.UniformMatrix4f(f),u_inv_rot_matrix:new l.UniformMatrix4f(f),u_merc_center:new l.Uniform2f(f),u_tile_id:new l.Uniform3f(f),u_zoom_transition:new l.Uniform1f(f),u_up_dir:new l.Uniform3f(f)}),collisionBox:f=>({u_matrix:new l.UniformMatrix4f(f),u_camera_to_center_distance:new l.Uniform1f(f),u_extrude_scale:new l.Uniform2f(f)}),collisionCircle:f=>({u_matrix:new l.UniformMatrix4f(f),u_inv_matrix:new l.UniformMatrix4f(f),u_camera_to_center_distance:new l.Uniform1f(f),u_viewport_size:new l.Uniform2f(f)}),debug:f=>({u_color:new l.UniformColor(f),u_matrix:new l.UniformMatrix4f(f),u_overlay:new l.Uniform1i(f),u_overlay_scale:new l.Uniform1f(f)}),clippingMask:f=>({u_matrix:new l.UniformMatrix4f(f)}),heatmap:f=>({u_extrude_scale:new l.Uniform1f(f),u_intensity:new l.Uniform1f(f),u_matrix:new l.UniformMatrix4f(f),u_inv_rot_matrix:new l.UniformMatrix4f(f),u_merc_center:new l.Uniform2f(f),u_tile_id:new l.Uniform3f(f),u_zoom_transition:new l.Uniform1f(f),u_up_dir:new l.Uniform3f(f)}),heatmapTexture:f=>({u_image:new l.Uniform1i(f),u_color_ramp:new l.Uniform1i(f),u_opacity:new l.Uniform1f(f)}),hillshade:f=>({u_matrix:new l.UniformMatrix4f(f),u_image:new l.Uniform1i(f),u_latrange:new l.Uniform2f(f),u_light:new l.Uniform2f(f),u_shadow:new l.UniformColor(f),u_highlight:new l.UniformColor(f),u_accent:new l.UniformColor(f)}),hillshadePrepare:f=>({u_matrix:new l.UniformMatrix4f(f),u_image:new l.Uniform1i(f),u_dimension:new l.Uniform2f(f),u_zoom:new l.Uniform1f(f),u_unpack:new l.Uniform4f(f)}),line:f=>({u_matrix:new l.UniformMatrix4f(f),u_pixels_to_tile_units:new l.UniformMatrix2f(f),u_device_pixel_ratio:new l.Uniform1f(f),u_units_to_pixels:new l.Uniform2f(f),u_dash_image:new l.Uniform1i(f),u_gradient_image:new l.Uniform1i(f),u_image_height:new l.Uniform1f(f),u_texsize:new l.Uniform2f(f),u_tile_units_to_pixels:new l.Uniform1f(f),u_alpha_discard_threshold:new l.Uniform1f(f),u_trim_offset:new l.Uniform2f(f)}),linePattern:f=>({u_matrix:new l.UniformMatrix4f(f),u_texsize:new l.Uniform2f(f),u_pixels_to_tile_units:new l.UniformMatrix2f(f),u_device_pixel_ratio:new l.Uniform1f(f),u_image:new l.Uniform1i(f),u_units_to_pixels:new l.Uniform2f(f),u_tile_units_to_pixels:new l.Uniform1f(f),u_alpha_discard_threshold:new l.Uniform1f(f)}),raster:f=>({u_matrix:new l.UniformMatrix4f(f),u_tl_parent:new l.Uniform2f(f),u_scale_parent:new l.Uniform1f(f),u_fade_t:new l.Uniform1f(f),u_opacity:new l.Uniform1f(f),u_image0:new l.Uniform1i(f),u_image1:new l.Uniform1i(f),u_brightness_low:new l.Uniform1f(f),u_brightness_high:new l.Uniform1f(f),u_saturation_factor:new l.Uniform1f(f),u_contrast_factor:new l.Uniform1f(f),u_spin_weights:new l.Uniform3f(f),u_perspective_transform:new l.Uniform2f(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new l.Uniform1i(f),u_is_size_feature_constant:new l.Uniform1i(f),u_size_t:new l.Uniform1f(f),u_size:new l.Uniform1f(f),u_camera_to_center_distance:new l.Uniform1f(f),u_rotate_symbol:new l.Uniform1i(f),u_aspect_ratio:new l.Uniform1f(f),u_fade_change:new l.Uniform1f(f),u_matrix:new l.UniformMatrix4f(f),u_label_plane_matrix:new l.UniformMatrix4f(f),u_coord_matrix:new l.UniformMatrix4f(f),u_is_text:new l.Uniform1i(f),u_pitch_with_map:new l.Uniform1i(f),u_texsize:new l.Uniform2f(f),u_tile_id:new l.Uniform3f(f),u_zoom_transition:new l.Uniform1f(f),u_inv_rot_matrix:new l.UniformMatrix4f(f),u_merc_center:new l.Uniform2f(f),u_camera_forward:new l.Uniform3f(f),u_tile_matrix:new l.UniformMatrix4f(f),u_up_vector:new l.Uniform3f(f),u_ecef_origin:new l.Uniform3f(f),u_texture:new l.Uniform1i(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new l.Uniform1i(f),u_is_size_feature_constant:new l.Uniform1i(f),u_size_t:new l.Uniform1f(f),u_size:new l.Uniform1f(f),u_camera_to_center_distance:new l.Uniform1f(f),u_rotate_symbol:new l.Uniform1i(f),u_aspect_ratio:new l.Uniform1f(f),u_fade_change:new l.Uniform1f(f),u_matrix:new l.UniformMatrix4f(f),u_label_plane_matrix:new l.UniformMatrix4f(f),u_coord_matrix:new l.UniformMatrix4f(f),u_is_text:new l.Uniform1i(f),u_pitch_with_map:new l.Uniform1i(f),u_texsize:new l.Uniform2f(f),u_texture:new l.Uniform1i(f),u_gamma_scale:new l.Uniform1f(f),u_device_pixel_ratio:new l.Uniform1f(f),u_tile_id:new l.Uniform3f(f),u_zoom_transition:new l.Uniform1f(f),u_inv_rot_matrix:new l.UniformMatrix4f(f),u_merc_center:new l.Uniform2f(f),u_camera_forward:new l.Uniform3f(f),u_tile_matrix:new l.UniformMatrix4f(f),u_up_vector:new l.Uniform3f(f),u_ecef_origin:new l.Uniform3f(f),u_is_halo:new l.Uniform1i(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new l.Uniform1i(f),u_is_size_feature_constant:new l.Uniform1i(f),u_size_t:new l.Uniform1f(f),u_size:new l.Uniform1f(f),u_camera_to_center_distance:new l.Uniform1f(f),u_rotate_symbol:new l.Uniform1i(f),u_aspect_ratio:new l.Uniform1f(f),u_fade_change:new l.Uniform1f(f),u_matrix:new l.UniformMatrix4f(f),u_label_plane_matrix:new l.UniformMatrix4f(f),u_coord_matrix:new l.UniformMatrix4f(f),u_is_text:new l.Uniform1i(f),u_pitch_with_map:new l.Uniform1i(f),u_texsize:new l.Uniform2f(f),u_texsize_icon:new l.Uniform2f(f),u_texture:new l.Uniform1i(f),u_texture_icon:new l.Uniform1i(f),u_gamma_scale:new l.Uniform1f(f),u_device_pixel_ratio:new l.Uniform1f(f),u_is_halo:new l.Uniform1i(f)}),background:f=>({u_matrix:new l.UniformMatrix4f(f),u_opacity:new l.Uniform1f(f),u_color:new l.UniformColor(f)}),backgroundPattern:f=>({u_matrix:new l.UniformMatrix4f(f),u_opacity:new l.Uniform1f(f),u_image:new l.Uniform1i(f),u_pattern_tl:new l.Uniform2f(f),u_pattern_br:new l.Uniform2f(f),u_texsize:new l.Uniform2f(f),u_pattern_size:new l.Uniform2f(f),u_pixel_coord_upper:new l.Uniform2f(f),u_pixel_coord_lower:new l.Uniform2f(f),u_tile_units_to_pixels:new l.Uniform1f(f)}),terrainRaster:Oo,terrainDepth:Oo,skybox:f=>({u_matrix:new l.UniformMatrix4f(f),u_sun_direction:new l.Uniform3f(f),u_cubemap:new l.Uniform1i(f),u_opacity:new l.Uniform1f(f),u_temporal_offset:new l.Uniform1f(f)}),skyboxGradient:f=>({u_matrix:new l.UniformMatrix4f(f),u_color_ramp:new l.Uniform1i(f),u_center_direction:new l.Uniform3f(f),u_radius:new l.Uniform1f(f),u_opacity:new l.Uniform1f(f),u_temporal_offset:new l.Uniform1f(f)}),skyboxCapture:f=>({u_matrix_3f:new l.UniformMatrix3f(f),u_sun_direction:new l.Uniform3f(f),u_sun_intensity:new l.Uniform1f(f),u_color_tint_r:new l.Uniform4f(f),u_color_tint_m:new l.Uniform4f(f),u_luminance:new l.Uniform1f(f)}),globeRaster:f=>({u_proj_matrix:new l.UniformMatrix4f(f),u_globe_matrix:new l.UniformMatrix4f(f),u_normalize_matrix:new l.UniformMatrix4f(f),u_merc_matrix:new l.UniformMatrix4f(f),u_zoom_transition:new l.Uniform1f(f),u_merc_center:new l.Uniform2f(f),u_image0:new l.Uniform1i(f),u_grid_matrix:new l.UniformMatrix3f(f),u_skirt_height:new l.Uniform1f(f),u_frustum_tl:new l.Uniform3f(f),u_frustum_tr:new l.Uniform3f(f),u_frustum_br:new l.Uniform3f(f),u_frustum_bl:new l.Uniform3f(f),u_globe_pos:new l.Uniform3f(f),u_globe_radius:new l.Uniform1f(f),u_viewport:new l.Uniform2f(f)}),globeAtmosphere:f=>({u_frustum_tl:new l.Uniform3f(f),u_frustum_tr:new l.Uniform3f(f),u_frustum_br:new l.Uniform3f(f),u_frustum_bl:new l.Uniform3f(f),u_horizon:new l.Uniform1f(f),u_transition:new l.Uniform1f(f),u_fadeout_range:new l.Uniform1f(f),u_color:new l.Uniform4f(f),u_high_color:new l.Uniform4f(f),u_space_color:new l.Uniform4f(f),u_star_intensity:new l.Uniform1f(f),u_star_density:new l.Uniform1f(f),u_star_size:new l.Uniform1f(f),u_temporal_offset:new l.Uniform1f(f),u_horizon_angle:new l.Uniform1f(f),u_rotation_matrix:new l.UniformMatrix4f(f)})};let ja;function yo(f,r,c,m,b,C,P){const R=f.context,z=R.gl,W=f.transform,q=f.useProgram("collisionBox"),ae=[];let fe=0,be=0;for(let Pe=0;Pe<m.length;Pe++){const Qe=m[Pe],tt=r.getTile(Qe),et=tt.getBucket(c);if(!et)continue;const gt=ts(Qe,et,W);let st=gt;0===b[0]&&0===b[1]||(st=f.translatePosMatrix(gt,tt,b,C));const Mt=P?et.textCollisionBox:et.iconCollisionBox,pn=et.collisionCircleArray;if(pn.length>0){const Ct=l.create(),Qt=st;l.mul(Ct,et.placementInvProjMatrix,W.glCoordMatrix),l.mul(Ct,Ct,et.placementViewportMatrix),ae.push({circleArray:pn,circleOffset:be,transform:Qt,invTransform:Ct,projection:et.getProjection()}),fe+=pn.length/4,be=fe}Mt&&(f.terrain&&f.terrain.setupElevationDraw(tt,q),q.draw(R,z.LINES,l.DepthMode.disabled,l.StencilMode.disabled,f.colorModeForRenderPass(),l.CullFaceMode.disabled,ie(st,W,tt,et.getProjection()),c.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,null,W.zoom,null,[Mt.collisionVertexBuffer,Mt.collisionVertexBufferExt]))}if(!P||!ae.length)return;const we=f.useProgram("collisionCircle"),xe=new l.StructArrayLayout2f1f2i16;xe.resize(4*fe),xe._trim();let De=0;for(const Pe of ae)for(let Qe=0;Qe<Pe.circleArray.length/4;Qe++){const tt=4*Qe,et=Pe.circleArray[tt+0],gt=Pe.circleArray[tt+1],st=Pe.circleArray[tt+2],Mt=Pe.circleArray[tt+3];xe.emplace(De++,et,gt,st,Mt,0),xe.emplace(De++,et,gt,st,Mt,1),xe.emplace(De++,et,gt,st,Mt,2),xe.emplace(De++,et,gt,st,Mt,3)}(!ja||ja.length<2*fe)&&(ja=function(Pe){const Qe=2*Pe,tt=new l.StructArrayLayout3ui6;tt.resize(Qe),tt._trim();for(let et=0;et<Qe;et++){const gt=6*et;tt.uint16[gt+0]=4*et+0,tt.uint16[gt+1]=4*et+1,tt.uint16[gt+2]=4*et+2,tt.uint16[gt+3]=4*et+2,tt.uint16[gt+4]=4*et+3,tt.uint16[gt+5]=4*et+0}return tt}(fe));const le=R.createIndexBuffer(ja,!0),_e=R.createVertexBuffer(xe,l.collisionCircleLayout.members,!0);for(const Pe of ae){const Qe={u_matrix:Pe.transform,u_inv_matrix:Pe.invTransform,u_camera_to_center_distance:(Ie=W).getCameraToCenterDistance(Pe.projection),u_viewport_size:[Ie.width,Ie.height]};we.draw(R,z.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,f.colorModeForRenderPass(),l.CullFaceMode.disabled,Qe,c.id,_e,le,l.SegmentVector.simpleSegment(0,2*Pe.circleOffset,Pe.circleArray.length,Pe.circleArray.length/2),null,W.zoom)}var Ie;_e.destroy(),le.destroy()}const yl=l.create();function vl({width:f,height:r,anchor:c,textOffset:m,textScale:b},C){const{horizontalAlign:P,verticalAlign:R}=l.getAnchorAlignment(c),z=-(P-.5)*f,W=-(R-.5)*r,q=l.evaluateVariableOffset(c,m);return new l.Point((z/b+q[0])*C,(W/b+q[1])*C)}function Mc(f,r,c,m,b,C,P,R,z,W,q){const ae=f.text.placedSymbolArray,fe=f.text.dynamicLayoutVertexArray,be=f.icon.dynamicLayoutVertexArray,we={},xe=f.getProjection(),De=Ur(R,xe,C),le=C.elevation,_e=xe.upVectorScale(R.canonical,C.center.lat,C.worldSize).metersToTile;fe.clear();for(let Ie=0;Ie<ae.length;Ie++){const Pe=ae.get(Ie),{tileAnchorX:Qe,tileAnchorY:tt,numGlyphs:et}=Pe,gt=Pe.hidden||!Pe.crossTileID||f.allowVerticalPlacement&&!Pe.placedOrientation?null:m[Pe.crossTileID];if(gt){let st=0,Mt=0,pn=0;if(le){const Cn=le?le.getAtTileOffset(R,Qe,tt):0,[ai,Ai,Hn]=xe.upVector(R.canonical,Qe,tt);st=Cn*ai*_e,Mt=Cn*Ai*_e,pn=Cn*Hn*_e}let[Ct,Qt,kt,mn]=Lr(Pe.projectedAnchorX+st,Pe.projectedAnchorY+Mt,Pe.projectedAnchorZ+pn,c?De:P);const It=Wr(C.getCameraToCenterDistance(xe),mn);let Jt=b.evaluateSizeForFeature(f.textSizeData,W,Pe)*It/l.ONE_EM;c&&(Jt*=f.tilePixelRatio/z);const En=vl(gt,Jt);c?(({x:Ct,y:Qt,z:kt}=xe.projectTilePoint(Qe+En.x,tt+En.y,R.canonical)),[Ct,Qt,kt]=Lr(Ct+st,Qt+Mt,kt+pn,P)):(r&&En._rotate(-C.angle),Ct+=En.x,Qt+=En.y,kt=0);const ln=f.allowVerticalPlacement&&Pe.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let Cn=0;Cn<et;Cn++)l.addDynamicAttributes(fe,Ct,Qt,kt,ln);q&&Pe.associatedIconIndex>=0&&(we[Pe.associatedIconIndex]={x:Ct,y:Qt,z:kt,angle:ln})}else jo(et,fe)}if(q){be.clear();const Ie=f.icon.placedSymbolArray;for(let Pe=0;Pe<Ie.length;Pe++){const Qe=Ie.get(Pe),{numGlyphs:tt}=Qe,et=we[Pe];if(Qe.hidden||!et)jo(tt,be);else{const{x:gt,y:st,z:Mt,angle:pn}=et;for(let Ct=0;Ct<tt;Ct++)l.addDynamicAttributes(be,gt,st,Mt,pn)}}f.icon.dynamicLayoutVertexBuffer.updateData(be)}f.text.dynamicLayoutVertexBuffer.updateData(fe)}function bl(f,r,c){return c.iconsInText&&r?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function il(f,r,c,m,b,C,P,R,z,W,q,ae){const fe=f.context,be=fe.gl,we=f.transform,xe="map"===R,De="map"===z,le=xe&&"point"!==c.layout.get("symbol-placement"),_e=xe&&!De&&!le,Ie=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let Pe=!1;const Qe=f.depthModeForSublayer(0,l.DepthMode.ReadOnly),tt=[l.mercatorXfromLng(we.center.lng),l.mercatorYfromLat(we.center.lat)],et=c.layout.get("text-variable-anchor"),gt="globe"===we.projection.name,st=[],Mt=[0,-1,0];let pn=Mt;!gt&&!we.mercatorFromTransition||xe||(pn=function(Ct){const Qt=Ct._camera.getWorldToCamera(Ct.worldSize,1),kt=l.multiply([],Qt,Ct.globeMatrix);l.invert(kt,kt);const mn=[0,0,0],It=[0,1,0,0];return l.transformMat4$1(It,It,kt),mn[0]=It[0],mn[1]=It[1],mn[2]=It[2],l.normalize(mn,mn),mn}(we));for(const Ct of m){const Qt=r.getTile(Ct),kt=Qt.getBucket(c);if(!kt||"mercator"===kt.projection.name&&gt)continue;const mn=b?kt.text:kt.icon;if(!mn||kt.fullyClipped||!mn.segments.get().length)continue;const It=mn.programConfigurations.get(c.id),Jt=b||kt.sdfIcons,En=b?kt.textSizeData:kt.iconSizeData,ln=De||0!==we.pitch,Cn=l.evaluateSizeForZoom(En,we.zoom);let ai,Ai,Hn,wi,rr=[0,0],er=null;if(b)Ai=Qt.glyphAtlasTexture,Hn=be.LINEAR,ai=Qt.glyphAtlasTexture.size,kt.iconsInText&&(rr=Qt.imageAtlasTexture.size,er=Qt.imageAtlasTexture,wi=ln||f.options.rotating||f.options.zooming||"composite"===En.kind||"camera"===En.kind?be.LINEAR:be.NEAREST);else{const fc=1!==c.layout.get("icon-size").constantOr(0)||kt.iconsNeedLinear;Ai=Qt.imageAtlasTexture,Hn=Jt||f.options.rotating||f.options.zooming||fc||ln?be.LINEAR:be.NEAREST,ai=Qt.imageAtlasTexture.size}const Qn="globe"===kt.projection.name,yr=Qn?pn:Mt,or=Qn?l.globeToMercatorTransition(we.zoom):0,Ir=Ur(Ct,kt.getProjection(),we),$r=we.calculatePixelsToTileUnitsMatrix(Qt),Rs=xt(Ir,Qt.tileID.canonical,De,xe,we,kt.getProjection(),$r),Wo=f.terrain&&De&&le?l.invert(l.create(),Rs):yl,ya=ar(Ir,Qt.tileID.canonical,De,xe,we,kt.getProjection(),$r),Vs=et&&kt.hasTextData(),Or="none"!==c.layout.get("icon-text-fit")&&Vs&&kt.hasIconData();if(le){const fc=we.elevation,Bc=fc?fc.getAtTileOffsetFunc(Ct,we.center.lat,we.worldSize,kt.getProjection()):null,fu=Xi(Ir,Qt.tileID.canonical,De,xe,we,kt.getProjection(),$r);Vo(kt,Ir,f,b,fu,ya,De,W,Bc,Ct)}const hr=le||b&&et||Or,pr=f.translatePosMatrix(Ir,Qt,C,P),Jo=hr?yl:Rs,ds=f.translatePosMatrix(ya,Qt,C,P,!0),Hr=kt.getProjection().createInversionMatrix(we,Ct.canonical),ka=[];f.terrainRenderModeElevated()&&De&&ka.push("PITCH_WITH_MAP_TERRAIN"),Qn&&ka.push("PROJECTION_GLOBE_VIEW"),hr&&ka.push("PROJECTED_POS_ON_VIEWPORT");const Dd=Jt&&0!==c.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let Ol;Ol=Jt?kt.iconsInText?Ma(En.kind,Cn,_e,De,f,pr,Jo,ds,ai,rr,Ct,or,tt,Hr,yr,kt.getProjection()):Ta(En.kind,Cn,_e,De,f,pr,Jo,ds,b,ai,!0,Ct,or,tt,Hr,yr,kt.getProjection()):_l(En.kind,Cn,_e,De,f,pr,Jo,ds,b,ai,Ct,or,tt,Hr,yr,kt.getProjection());const Nc={program:f.useProgram(bl(Jt,b,kt),It,ka),buffers:mn,uniformValues:Ol,atlasTexture:Ai,atlasTextureIcon:er,atlasInterpolation:Hn,atlasInterpolationIcon:wi,isSDF:Jt,hasHalo:Dd,tile:Qt,labelPlaneMatrixInv:Wo};if(Ie&&kt.canOverlap){Pe=!0;const fc=mn.segments.get();for(const Bc of fc)st.push({segments:new l.SegmentVector([Bc]),sortKey:Bc.sortKey,state:Nc})}else st.push({segments:mn.segments,sortKey:0,state:Nc})}Pe&&st.sort((Ct,Qt)=>Ct.sortKey-Qt.sortKey);for(const Ct of st){const Qt=Ct.state;if(f.terrain&&f.terrain.setupElevationDraw(Qt.tile,Qt.program,{useDepthForOcclusion:!gt,labelPlaneMatrixInv:Qt.labelPlaneMatrixInv}),fe.activeTexture.set(be.TEXTURE0),Qt.atlasTexture.bind(Qt.atlasInterpolation,be.CLAMP_TO_EDGE),Qt.atlasTextureIcon&&(fe.activeTexture.set(be.TEXTURE1),Qt.atlasTextureIcon&&Qt.atlasTextureIcon.bind(Qt.atlasInterpolationIcon,be.CLAMP_TO_EDGE)),Qt.isSDF){const kt=Qt.uniformValues;Qt.hasHalo&&(kt.u_is_halo=1,Sl(Qt.buffers,Ct.segments,c,f,Qt.program,Qe,q,ae,kt)),kt.u_is_halo=0}Sl(Qt.buffers,Ct.segments,c,f,Qt.program,Qe,q,ae,Qt.uniformValues)}}function Sl(f,r,c,m,b,C,P,R,z){const W=m.context,q=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer];b.draw(W,W.gl.TRIANGLES,C,P,R,l.CullFaceMode.disabled,z,c.id,f.layoutVertexBuffer,f.indexBuffer,r,c.paint,m.transform.zoom,f.programConfigurations.get(c.id),q)}function Sc(f,r,c,m,b,C,P){const R=f.context.gl,z=c.paint.get("fill-pattern"),W=z&&z.constantOr(1);let q,ae,fe,be,we;P?(ae=W&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=R.LINES):(ae=W?"fillPattern":"fill",q=R.TRIANGLES);for(const xe of m){const De=r.getTile(xe);if(W&&!De.patternsLoaded())continue;const le=De.getBucket(c);if(!le)continue;f.prepareDrawTile();const _e=le.programConfigurations.get(c.id),Ie=f.useProgram(ae,_e);W&&(f.context.activeTexture.set(R.TEXTURE0),De.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),_e.updatePaintBuffers());const Pe=z.constantOr(null);if(Pe&&De.imageAtlas){const tt=De.imageAtlas.patternPositions[Pe.toString()];tt&&_e.setConstantPatternPositions(tt)}const Qe=f.translatePosMatrix(xe.projMatrix,De,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(P){be=le.indexBuffer2,we=le.segments2;const tt=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[R.drawingBufferWidth,R.drawingBufferHeight];fe="fillOutlinePattern"===ae&&W?Bu(Qe,f,De,tt):su(Qe,tt)}else be=le.indexBuffer,we=le.segments,fe=W?co(Qe,f,De):nl(Qe);f.prepareDrawProgram(f.context,Ie,xe.toUnwrapped()),Ie.draw(f.context,q,b,f.stencilModeForClipping(xe),C,l.CullFaceMode.disabled,fe,c.id,le.layoutVertexBuffer,be,we,c.paint,f.transform.zoom,_e)}}function Ia(f,r,c,m,b,C,P){const R=f.context,z=R.gl,W=f.transform,q=c.paint.get("fill-extrusion-pattern"),ae=q.constantOr(1),fe=c.paint.get("fill-extrusion-opacity"),be=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],we=c.layout.get("fill-extrusion-edge-radius"),xe=we>0&&!c.paint.get("fill-extrusion-rounded-roof"),De=xe?0:we,le="globe"===W.projection.name?l.fillExtrusionHeightLift():0,_e="globe"===W.projection.name,Ie=_e?l.globeToMercatorTransition(W.zoom):0,Pe=[l.mercatorXfromLng(W.center.lng),l.mercatorYfromLat(W.center.lat)],Qe=[];_e&&Qe.push("PROJECTION_GLOBE_VIEW"),be[0]>0&&Qe.push("FAUX_AO"),xe&&Qe.push("ZERO_ROOF_RADIUS");for(const tt of m){const et=r.getTile(tt),gt=et.getBucket(c);if(!gt||gt.projection.name!==W.projection.name)continue;const st=gt.programConfigurations.get(c.id),Mt=f.useProgram(ae?"fillExtrusionPattern":"fillExtrusion",st,Qe);if(f.terrain){const Jt=f.terrain;if(f.style.terrainSetForDrapingOnly())Jt.setupElevationDraw(et,Mt,{useMeterToDem:!0});else{if(!gt.enableTerrain)continue;if(Jt.setupElevationDraw(et,Mt,{useMeterToDem:!0}),xl(R,r,tt,gt,c,Jt),!gt.centroidVertexBuffer){const En=Mt.attributes.a_centroid_pos;void 0!==En&&z.vertexAttrib2f(En,0,0)}}}ae&&(f.context.activeTexture.set(z.TEXTURE0),et.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),st.updatePaintBuffers());const pn=q.constantOr(null);if(pn&&et.imageAtlas){const Jt=et.imageAtlas.patternPositions[pn.toString()];Jt&&st.setConstantPatternPositions(Jt)}const Ct=f.translatePosMatrix(tt.projMatrix,et,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Qt=W.projection.createInversionMatrix(W,tt.canonical),kt=c.paint.get("fill-extrusion-vertical-gradient"),mn=ae?ou(Ct,f,kt,fe,be,De,tt,et,le,Ie,Pe,Qt):Ql(Ct,f,kt,fe,be,De,tt,le,Ie,Pe,Qt);f.prepareDrawProgram(R,Mt,tt.toUnwrapped());const It=[];f.terrain&&It.push(gt.centroidVertexBuffer),_e&&It.push(gt.layoutVertexExtBuffer),Mt.draw(R,R.gl.TRIANGLES,b,C,P,l.CullFaceMode.backCCW,mn,c.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,c.paint,f.transform.zoom,st,It)}}function xl(f,r,c,m,b,C){const P=[le=>{let _e=le.canonical.x-1,Ie=le.wrap;return _e<0&&(_e=(1<<le.canonical.z)-1,Ie--),new l.OverscaledTileID(le.overscaledZ,Ie,le.canonical.z,_e,le.canonical.y)},le=>{let _e=le.canonical.x+1,Ie=le.wrap;return _e===1<<le.canonical.z&&(_e=0,Ie++),new l.OverscaledTileID(le.overscaledZ,Ie,le.canonical.z,_e,le.canonical.y)},le=>new l.OverscaledTileID(le.overscaledZ,le.wrap,le.canonical.z,le.canonical.x,(0===le.canonical.y?1<<le.canonical.z:le.canonical.y)-1),le=>new l.OverscaledTileID(le.overscaledZ,le.wrap,le.canonical.z,le.canonical.x,le.canonical.y===(1<<le.canonical.z)-1?0:le.canonical.y+1)],R=le=>{const _e=r.getSource().minzoom,Ie=Qe=>{const tt=r.getTileByID(Qe);if(tt&&tt.hasData())return tt.getBucket(b)},Pe=[0,-1,1];for(const Qe of Pe){if(le.overscaledZ+Qe<_e)continue;const tt=Ie(le.calculateScaledKey(le.overscaledZ+Qe));if(tt)return tt}},z=[0,0,0],W=(le,_e)=>(z[0]=Math.min(le.min.y,_e.min.y),z[1]=Math.max(le.max.y,_e.max.y),z[2]=l.EXTENT-_e.min.x>le.max.x?_e.min.x-l.EXTENT:le.max.x,z),q=(le,_e)=>(z[0]=Math.min(le.min.x,_e.min.x),z[1]=Math.max(le.max.x,_e.max.x),z[2]=l.EXTENT-_e.min.y>le.max.y?_e.min.y-l.EXTENT:le.max.y,z),ae=[(le,_e)=>W(le,_e),(le,_e)=>W(_e,le),(le,_e)=>q(le,_e),(le,_e)=>q(_e,le)],fe=new l.Point(0,0);let be,we,xe;const De=(le,_e,Ie,Pe,Qe)=>{const tt=[[Pe?Ie:le,Pe?le:Ie,0],[Pe?Ie:_e,Pe?_e:Ie,0]],et=Qe<0?l.EXTENT+Qe:Qe,gt=[Pe?et:(le+_e)/2,Pe?(le+_e)/2:et,0];return 0===Ie&&Qe<0||0!==Ie&&Qe>0?C.getForTilePoints(xe,[gt],!0,we):tt.push(gt),C.getForTilePoints(c,tt,!0,be),Math.max(tt[0][2],tt[1][2],gt[2])/C.exaggeration()};for(let le=0;le<4;le++){const _e=(le<2?1:5)-le,Ie=m.borders[le];if(0===Ie.length)continue;const Pe=xe=P[le](c),Qe=R(Pe);if(!(Qe&&Qe instanceof l.FillExtrusionBucket&&Qe.enableTerrain)||m.borderDoneWithNeighborZ[le]===Qe.canonical.z&&Qe.borderDoneWithNeighborZ[_e]===m.canonical.z||(we=C.findDEMTileFor(Pe),!we||!we.dem))continue;if(!be){const st=C.findDEMTileFor(c);if(!st||!st.dem)return;be=st}const tt=Qe.borders[_e];let et=0;const gt=Qe.borderDoneWithNeighborZ[_e]!==m.canonical.z;if(m.canonical.z===Qe.canonical.z){for(let st=0;st<Ie.length;st++){const Mt=m.featuresOnBorder[Ie[st]],pn=Mt.borders[le];let Ct;for(;et<tt.length&&(Ct=Qe.featuresOnBorder[tt[et]],!(Ct.borders[_e][1]>pn[0]+3));)gt&&Qe.encodeCentroid(void 0,Ct,!1),et++;if(Ct&&et<tt.length){const Qt=et;let kt=0;for(;!(Ct.borders[_e][0]>pn[1]-3)&&(kt++,++et!==tt.length);)Ct=Qe.featuresOnBorder[tt[et]];if(Ct=Qe.featuresOnBorder[tt[Qt]],Mt.intersectsCount()>1||Ct.intersectsCount()>1||1!==kt){1!==kt&&(et=Qt),m.encodeCentroid(void 0,Mt,!1),gt&&Qe.encodeCentroid(void 0,Ct,!1);continue}const mn=ae[le](Mt,Ct),It=le%2?l.EXTENT-1:0;fe.x=De(mn[0],Math.min(l.EXTENT-1,mn[1]),It,le<2,mn[2]),fe.y=0,m.encodeCentroid(fe,Mt,!1),gt&&Qe.encodeCentroid(fe,Ct,!1)}else m.encodeCentroid(void 0,Mt,!1)}m.borderDoneWithNeighborZ[le]=Qe.canonical.z,m.needsCentroidUpdate=!0,gt&&(Qe.borderDoneWithNeighborZ[_e]=m.canonical.z,Qe.needsCentroidUpdate=!0)}else{for(const st of Ie)m.encodeCentroid(void 0,m.featuresOnBorder[st],!1);if(gt){for(const st of tt)Qe.encodeCentroid(void 0,Qe.featuresOnBorder[st],!1);Qe.borderDoneWithNeighborZ[_e]=m.canonical.z,Qe.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[le]=Qe.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(f)}const fa=new l.Color(1,0,0,1),$a=new l.Color(0,1,0,1),ec=new l.Color(0,0,1,1),lu=new l.Color(1,0,1,1),cu=new l.Color(0,1,1,1);function pa(f,r,c){const m=f.context,b=f.transform,C=m.gl,P="globe"===b.projection.name,R=P?["PROJECTION_GLOBE_VIEW"]:null;let z=c.projMatrix;if(P&&l.globeToMercatorTransition(b.zoom)>0){const Mt=l.transitionTileAABBinECEF(c.canonical,b),pn=l.globeDenormalizeECEF(Mt);z=l.multiply(new Float32Array(16),b.globeMatrix,pn),l.multiply(z,b.projMatrix,z)}const W=f.useProgram("debug",null,R),q=r.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(q,W);const ae=l.DepthMode.disabled,fe=l.StencilMode.disabled,be=f.colorModeForRenderPass();m.activeTexture.set(C.TEXTURE0),f.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),P?q._makeGlobeTileDebugBuffers(f.context,b):q._makeDebugTileBoundsBuffers(f.context,b.projection);const xe=q._tileDebugBuffer||f.debugBuffer,De=q._tileDebugIndexBuffer||f.debugIndexBuffer,le=q._tileDebugSegments||f.debugSegments;W.draw(m,C.LINE_STRIP,ae,fe,be,l.CullFaceMode.disabled,Ae(z,l.Color.red),"$debug",xe,De,le,null,null,null,[q._globeTileDebugBorderBuffer]);const _e=q.latestRawTileData,Ie=Math.floor((_e&&_e.byteLength||0)/1024),Pe=r.getTile(c).tileSize,Qe=512/Math.min(Pe,512)*(c.overscaledZ/b.zoom)*.5;let tt=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(tt+=` => ${c.overscaledZ}`),tt+=` ${Ie}kb`,function(Mt,pn){Mt.initDebugOverlayCanvas();const Ct=Mt.debugOverlayCanvas,Qt=Mt.context.gl,kt=Mt.debugOverlayCanvas.getContext("2d");kt.clearRect(0,0,Ct.width,Ct.height),kt.shadowColor="white",kt.shadowBlur=2,kt.lineWidth=1.5,kt.strokeStyle="white",kt.textBaseline="top",kt.font="bold 36px Open Sans, sans-serif",kt.fillText(pn,5,5),kt.strokeText(pn,5,5),Mt.debugOverlayTexture.update(Ct),Mt.debugOverlayTexture.bind(Qt.LINEAR,Qt.CLAMP_TO_EDGE)}(f,tt);const et=q._tileDebugTextBuffer||f.debugBuffer,gt=q._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,st=q._tileDebugTextSegments||f.debugSegments;W.draw(m,C.TRIANGLES,ae,fe,l.ColorMode.alphaBlended,l.CullFaceMode.disabled,Ae(z,l.Color.transparent,Qe),"$debug",et,gt,st,null,null,null,[q._globeTileDebugTextBuffer])}function tc(f,r,c,m){rl(f,0,r+c/2,f.transform.width,c,m)}function Ha(f,r,c,m){rl(f,r-c/2,0,c,f.transform.height,m)}function rl(f,r,c,m,b,C){const P=f.context,R=P.gl;R.enable(R.SCISSOR_TEST),R.scissor(r*l.exported.devicePixelRatio,c*l.exported.devicePixelRatio,m*l.exported.devicePixelRatio,b*l.exported.devicePixelRatio),P.clear({color:C}),R.disable(R.SCISSOR_TEST)}const Ga=l.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:nc}=Ga;function Aa(f,r,c,m){f.emplaceBack(r,c,m)}class Pa{constructor(r){this.vertexArray=new l.StructArrayLayout3f12,this.indices=new l.StructArrayLayout3ui6,Aa(this.vertexArray,-1,-1,1),Aa(this.vertexArray,1,-1,1),Aa(this.vertexArray,-1,1,1),Aa(this.vertexArray,1,1,1),Aa(this.vertexArray,-1,-1,-1),Aa(this.vertexArray,1,-1,-1),Aa(this.vertexArray,-1,1,-1),Aa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,nc),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=l.SegmentVector.simpleSegment(0,0,36,12)}}function Bo(f,r,c,m,b,C){const P=f.gl,R=r.paint.get("sky-atmosphere-color"),z=r.paint.get("sky-atmosphere-halo-color"),W=r.paint.get("sky-atmosphere-sun-intensity"),q={u_matrix_3f:l.fromMat4(l.create$1(),m),u_sun_direction:b,u_sun_intensity:W,u_color_tint_r:[(we=R).r,we.g,we.b,we.a],u_color_tint_m:[(xe=z).r,xe.g,xe.b,xe.a],u_luminance:5e-5};var we,xe;P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_CUBE_MAP_POSITIVE_X+C,r.skyboxTexture,0),c.draw(f,P.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.frontCW,q,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const N=l.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ee{constructor(r){const c=new l.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const m=new l.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(c,N.members),this.indexBuffer=r.createIndexBuffer(m),this.segments=l.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Me={symbol:function(f,r,c,m,b){if("translucent"!==f.renderPass)return;const C=l.StencilMode.disabled,P=f.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(R,z,W,q,ae,fe,be){const we=z.transform,xe="map"===ae,De="map"===fe;for(const le of R){const _e=q.getTile(le),Ie=_e.getBucket(W);if(!Ie||!Ie.text||!Ie.text.segments.get().length)continue;const Pe=l.evaluateSizeForZoom(Ie.textSizeData,we.zoom),Qe=Ur(le,Ie.getProjection(),we),tt=we.calculatePixelsToTileUnitsMatrix(_e),et=xt(Qe,_e.tileID.canonical,De,xe,we,Ie.getProjection(),tt),gt="none"!==W.layout.get("icon-text-fit")&&Ie.hasIconData();if(Pe){const st=Math.pow(2,we.zoom-_e.tileID.overscaledZ);Mc(Ie,xe,De,be,l.symbolSize,we,et,le,st,Pe,gt)}}}(m,f,c,r,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),b),0!==c.paint.get("icon-opacity").constantOr(1)&&il(f,r,c,m,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),C,P),0!==c.paint.get("text-opacity").constantOr(1)&&il(f,r,c,m,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),C,P),r.map.showCollisionBoxes&&(yo(f,r,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),yo(f,r,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,r,c,m){if("translucent"!==f.renderPass)return;const b=c.paint.get("circle-opacity"),C=c.paint.get("circle-stroke-width"),P=c.paint.get("circle-stroke-opacity"),R=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===C.constantOr(1)||0===P.constantOr(1)))return;const z=f.context,W=z.gl,q=f.transform,ae=f.depthModeForSublayer(0,l.DepthMode.ReadOnly),fe=l.StencilMode.disabled,be=f.colorModeForRenderPass(),we="globe"===q.projection.name,xe=[l.mercatorXfromLng(q.center.lng),l.mercatorYfromLat(q.center.lat)],De=[];for(let _e=0;_e<m.length;_e++){const Ie=m[_e],Pe=r.getTile(Ie),Qe=Pe.getBucket(c);if(!Qe||Qe.projection.name!==q.projection.name)continue;const tt=Qe.programConfigurations.get(c.id),et=ye(c);we&&et.push("PROJECTION_GLOBE_VIEW");const gt=f.useProgram("circle",tt,et),st=Qe.layoutVertexBuffer,Mt=Qe.globeExtVertexBuffer,pn=Qe.indexBuffer,Ct=q.projection.createInversionMatrix(q,Ie.canonical),Qt={programConfiguration:tt,program:gt,layoutVertexBuffer:st,globeExtVertexBuffer:Mt,indexBuffer:pn,uniformValues:Q(f,Ie,Pe,Ct,xe,c),tile:Pe};if(R){const kt=Qe.segments.get();for(const mn of kt)De.push({segments:new l.SegmentVector([mn]),sortKey:mn.sortKey,state:Qt})}else De.push({segments:Qe.segments,sortKey:0,state:Qt})}R&&De.sort((_e,Ie)=>_e.sortKey-Ie.sortKey);const le={useDepthForOcclusion:!we};for(const _e of De){const{programConfiguration:Ie,program:Pe,layoutVertexBuffer:Qe,globeExtVertexBuffer:tt,indexBuffer:et,uniformValues:gt,tile:st}=_e.state,Mt=_e.segments;f.terrain&&f.terrain.setupElevationDraw(st,Pe,le),f.prepareDrawProgram(z,Pe,st.tileID.toUnwrapped()),Pe.draw(z,W.TRIANGLES,ae,fe,be,l.CullFaceMode.disabled,gt,c.id,Qe,et,Mt,c.paint,q.zoom,Ie,[tt])}},heatmap:function(f,r,c,m){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const b=f.context,C=b.gl,P=l.StencilMode.disabled,R=new l.ColorMode([C.ONE,C.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(be,we,xe,De){const le=be.gl,_e=we.width*De,Ie=we.height*De;be.activeTexture.set(le.TEXTURE1),be.viewport.set([0,0,_e,Ie]);let Pe=xe.heatmapFbo;if(!Pe||Pe&&(Pe.width!==_e||Pe.height!==Ie)){Pe&&Pe.destroy();const Qe=le.createTexture();le.bindTexture(le.TEXTURE_2D,Qe),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MAG_FILTER,le.LINEAR),Pe=xe.heatmapFbo=be.createFramebuffer(_e,Ie,!1),function(tt,et,gt,st,Mt,pn){const Ct=tt.gl;Ct.texImage2D(Ct.TEXTURE_2D,0,tt.isWebGL2&&tt.extRenderToTextureHalfFloat?Ct.RGBA16F:Ct.RGBA,Mt,pn,0,Ct.RGBA,tt.extRenderToTextureHalfFloat?tt.isWebGL2?Ct.HALF_FLOAT:tt.extTextureHalfFloat.HALF_FLOAT_OES:Ct.UNSIGNED_BYTE,null),st.colorAttachment.set(gt)}(be,0,Qe,Pe,_e,Ie)}else le.bindTexture(le.TEXTURE_2D,Pe.colorAttachment.get()),be.bindFramebuffer.set(Pe.framebuffer)})(b,f,c,"globe"===f.transform.projection.name?.5:.25),b.clear({color:l.Color.transparent});const z=f.transform,W="globe"===z.projection.name,q=W?["PROJECTION_GLOBE_VIEW"]:null,ae=W?l.CullFaceMode.frontCCW:l.CullFaceMode.disabled,fe=[l.mercatorXfromLng(z.center.lng),l.mercatorYfromLat(z.center.lat)];for(let be=0;be<m.length;be++){const we=m[be];if(r.hasRenderableParent(we))continue;const xe=r.getTile(we),De=xe.getBucket(c);if(!De||De.projection.name!==z.projection.name)continue;const le=De.programConfigurations.get(c.id),_e=f.useProgram("heatmap",le,q),{zoom:Ie}=f.transform;f.terrain&&f.terrain.setupElevationDraw(xe,_e),f.prepareDrawProgram(b,_e,we.toUnwrapped());const Pe=z.projection.createInversionMatrix(z,we.canonical);_e.draw(b,C.TRIANGLES,l.DepthMode.disabled,P,R,ae,Ii(f,we,xe,Pe,fe,Ie,c.paint.get("heatmap-intensity")),c.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,c.paint,f.transform.zoom,le,W?[De.globeExtVertexBuffer]:null)}b.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(b,C){const P=b.context,R=P.gl,z=C.heatmapFbo;if(!z)return;P.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,z.colorAttachment.get()),P.activeTexture.set(R.TEXTURE1);let W=C.colorRampTexture;W||(W=C.colorRampTexture=new l.Texture(P,C.colorRamp,R.RGBA)),W.bind(R.LINEAR,R.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(P,R.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,b.colorModeForRenderPass(),l.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,C.paint,b.transform.zoom)}(f,c))},line:function(f,r,c,m){if("translucent"!==f.renderPass)return;const b=c.paint.get("line-opacity"),C=c.paint.get("line-width");if(0===b.constantOr(1)||0===C.constantOr(1))return;const P=f.depthModeForSublayer(0,l.DepthMode.ReadOnly),R=f.colorModeForRenderPass(),z=f.terrain&&f.terrain.renderingToTexture?1:l.exported.devicePixelRatio,W=c.paint.get("line-dasharray"),q=W.constantOr(1),ae=c.layout.get("line-cap"),fe=c.paint.get("line-pattern"),be=fe.constantOr(1),we=c.paint.get("line-gradient"),xe=be?"linePattern":"line",De=f.context,le=De.gl,_e=(Pe=>{const Qe=[];Bs(Pe)&&Qe.push("RENDER_LINE_DASH"),Pe.paint.get("line-gradient")&&Qe.push("RENDER_LINE_GRADIENT");const tt=Pe.paint.get("line-trim-offset");0===tt[0]&&0===tt[1]||Qe.push("RENDER_LINE_TRIM_OFFSET");const et=Pe.paint.get("line-pattern").constantOr(1),gt=1!==Pe.paint.get("line-opacity").constantOr(1);return!et&&gt&&Qe.push("RENDER_LINE_ALPHA_DISCARD"),Qe})(c);let Ie=_e.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(Ie=!1);for(const Pe of m){const Qe=r.getTile(Pe);if(be&&!Qe.patternsLoaded())continue;const tt=Qe.getBucket(c);if(!tt)continue;f.prepareDrawTile();const et=tt.programConfigurations.get(c.id),gt=f.useProgram(xe,et,_e),st=fe.constantOr(null);if(st&&Qe.imageAtlas){const Jt=Qe.imageAtlas.patternPositions[st.toString()];Jt&&et.setConstantPatternPositions(Jt)}const Mt=W.constantOr(null),pn=ae.constantOr(null);if(!be&&Mt&&pn&&Qe.lineAtlas){const Jt=Qe.lineAtlas.getDash(Mt,pn);Jt&&et.setConstantPatternPositions(Jt)}let[Ct,Qt]=c.paint.get("line-trim-offset");("round"===pn||"square"===pn)&&Ct!==Qt&&(0===Ct&&(Ct-=1),1===Qt&&(Qt+=1));const kt=f.terrain?Pe.projMatrix:null,mn=be?_o(f,Qe,c,kt,z):Ho(f,Qe,c,kt,tt.lineClipsArray.length,z,[Ct,Qt]);if(we){const Jt=tt.gradients[c.id];let En=Jt.texture;if(c.gradientVersion!==Jt.version){let ln=256;if(c.stepInterpolant){const Cn=r.getSource().maxzoom,ai=Pe.canonical.z===Cn?Math.ceil(1<<f.transform.maxZoom-Pe.canonical.z):1;ln=l.clamp(l.nextPowerOfTwo(tt.maxLineLength/l.EXTENT*1024*ai),256,De.maxTextureSize)}Jt.gradient=l.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ln,image:Jt.gradient||void 0,clips:tt.lineClipsArray}),Jt.texture?Jt.texture.update(Jt.gradient):Jt.texture=new l.Texture(De,Jt.gradient,le.RGBA),Jt.version=c.gradientVersion,En=Jt.texture}De.activeTexture.set(le.TEXTURE1),En.bind(c.stepInterpolant?le.NEAREST:le.LINEAR,le.CLAMP_TO_EDGE)}q&&(De.activeTexture.set(le.TEXTURE0),Qe.lineAtlasTexture.bind(le.LINEAR,le.REPEAT),et.updatePaintBuffers()),be&&(De.activeTexture.set(le.TEXTURE0),Qe.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),et.updatePaintBuffers()),f.prepareDrawProgram(De,gt,Pe.toUnwrapped());const It=Jt=>{gt.draw(De,le.TRIANGLES,P,Jt,R,l.CullFaceMode.disabled,mn,c.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,c.paint,f.transform.zoom,et,[tt.layoutVertexBuffer2])};if(Ie){const Jt=f.stencilModeForClipping(Pe).ref;0===Jt&&f.terrain&&De.clear({stencil:0});const En={func:le.EQUAL,mask:255};mn.u_alpha_discard_threshold=.8,It(new l.StencilMode(En,Jt,255,le.KEEP,le.KEEP,le.INVERT)),mn.u_alpha_discard_threshold=0,It(new l.StencilMode(En,Jt,255,le.KEEP,le.KEEP,le.KEEP))}else It(f.stencilModeForClipping(Pe))}Ie&&(f.resetStencilClippingMasks(),f.terrain&&De.clear({stencil:0}))},fill:function(f,r,c,m){const b=c.paint.get("fill-color"),C=c.paint.get("fill-opacity");if(0===C.constantOr(1))return;const P=f.colorModeForRenderPass(),R=c.paint.get("fill-pattern"),z=f.opaquePassEnabledForLayer()&&!R.constantOr(1)&&1===b.constantOr(l.Color.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(f.renderPass===z){const W=f.depthModeForSublayer(1,"opaque"===f.renderPass?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly);Sc(f,r,c,m,W,P,!1)}if("translucent"===f.renderPass&&c.paint.get("fill-antialias")){const W=f.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,l.DepthMode.ReadOnly);Sc(f,r,c,m,W,P,!0)}},"fill-extrusion":function(f,r,c,m){const b=c.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===f.renderPass){const C=new l.DepthMode(f.context.gl.LEQUAL,l.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==b||c.paint.get("fill-extrusion-pattern").constantOr(1))Ia(f,r,c,m,C,l.StencilMode.disabled,l.ColorMode.disabled),Ia(f,r,c,m,C,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const P=f.colorModeForRenderPass();Ia(f,r,c,m,C,l.StencilMode.disabled,P)}}},hillshade:function(f,r,c,m){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const b=f.context,C=f.depthModeForSublayer(0,l.DepthMode.ReadOnly),P=f.colorModeForRenderPass(),R=f.terrain&&f.terrain.renderingToTexture,[z,W]="translucent"!==f.renderPass||R?[{},m]:f.stencilConfigForOverlap(m);for(const q of W){const ae=r.getTile(q);if(ae.needsHillshadePrepare&&"offscreen"===f.renderPass)qs(f,ae,c,C,l.StencilMode.disabled,P);else if("translucent"===f.renderPass){const fe=R&&f.terrain?f.terrain.stencilModeForRTTOverlap(q):z[q.overscaledZ];pl(f,q,ae,c,C,fe,P)}}b.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,r,c,m,b,C){if("translucent"!==f.renderPass||0===c.paint.get("raster-opacity")||!m.length)return;const P=f.context,R=P.gl,z=r.getSource(),W=f.useProgram("raster"),q=f.colorModeForRenderPass(),ae=f.terrain&&f.terrain.renderingToTexture,[fe,be]=z instanceof pt||ae?[{},m]:f.stencilConfigForOverlap(m),we=be[be.length-1].overscaledZ,xe=!f.options.moving;for(const De of be){const le=ae?l.DepthMode.disabled:f.depthModeForSublayer(De.overscaledZ-we,1===c.paint.get("raster-opacity")?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly,R.LESS),_e=De.toUnwrapped(),Ie=r.getTile(De);if(ae&&(!Ie||!Ie.hasData()))continue;const Pe=ae?De.projMatrix:f.transform.calculateProjMatrix(_e,xe),Qe=f.terrain&&ae?f.terrain.stencilModeForRTTOverlap(De):fe[De.overscaledZ],tt=C?0:c.paint.get("raster-fade-duration");Ie.registerFadeDuration(tt);const et=r.findLoadedParent(De,0),gt=Is(Ie,et,r,f.transform,tt);let st,Mt;f.terrain&&f.terrain.prepareDrawTile();const pn="nearest"===c.paint.get("raster-resampling")?R.NEAREST:R.LINEAR;P.activeTexture.set(R.TEXTURE0),Ie.texture.bind(pn,R.CLAMP_TO_EDGE),P.activeTexture.set(R.TEXTURE1),et?(et.texture.bind(pn,R.CLAMP_TO_EDGE),st=Math.pow(2,et.tileID.overscaledZ-Ie.tileID.overscaledZ),Mt=[Ie.tileID.canonical.x*st%1,Ie.tileID.canonical.y*st%1]):Ie.texture.bind(pn,R.CLAMP_TO_EDGE),Ie.texture.useMipmap&&P.extTextureFilterAnisotropic&&f.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const Ct=Da(Pe,Mt||[0,0],st||1,gt,c,z instanceof pt?z.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(P,W,_e),z instanceof pt)z.boundsBuffer&&z.boundsSegments&&W.draw(P,R.TRIANGLES,le,l.StencilMode.disabled,q,l.CullFaceMode.disabled,Ct,c.id,z.boundsBuffer,f.quadTriangleIndexBuffer,z.boundsSegments);else{const{tileBoundsBuffer:Qt,tileBoundsIndexBuffer:kt,tileBoundsSegments:mn}=f.getTileBoundsBuffers(Ie);W.draw(P,R.TRIANGLES,le,Qe,q,l.CullFaceMode.disabled,Ct,c.id,Qt,kt,mn)}}f.resetStencilClippingMasks()},background:function(f,r,c,m){const b=c.paint.get("background-color"),C=c.paint.get("background-opacity");if(0===C)return;const P=f.context,R=P.gl,z=f.transform,W=z.tileSize,q=c.paint.get("background-pattern");if(f.isPatternMissing(q))return;const ae=!q&&1===b.a&&1===C&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==ae)return;const fe=l.StencilMode.disabled,be=f.depthModeForSublayer(0,"opaque"===ae?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly),we=f.colorModeForRenderPass(),xe=f.useProgram(q?"backgroundPattern":"background");let De,le=m;le||(De=f.getBackgroundTiles(),le=Object.values(De).map(_e=>_e.tileID)),q&&(P.activeTexture.set(R.TEXTURE0),f.imageManager.bind(f.context));for(const _e of le){const Ie=_e.toUnwrapped(),Pe=m?_e.projMatrix:f.transform.calculateProjMatrix(Ie);f.prepareDrawTile();const Qe=r?r.getTile(_e):De?De[_e.key]:new l.Tile(_e,W,z.zoom,f),tt=q?au(Pe,C,f,q,{tileID:_e,tileSize:W}):Sa(Pe,C,b);f.prepareDrawProgram(P,xe,Ie);const{tileBoundsBuffer:et,tileBoundsIndexBuffer:gt,tileBoundsSegments:st}=f.getTileBoundsBuffers(Qe);xe.draw(P,R.TRIANGLES,be,fe,we,l.CullFaceMode.disabled,tt,c.id,et,gt,st)}},sky:function(f,r,c){const m=f.transform,b="mercator"===m.projection.name||"globe"===m.projection.name?1:l.smoothstep(7,8,m.zoom),C=c.paint.get("sky-opacity")*b;if(0===C)return;const P=f.context,R=c.paint.get("sky-type"),z=new l.DepthMode(P.gl.LEQUAL,l.DepthMode.ReadOnly,[0,1]),W=f.frameCounter/1e3%1;"atmosphere"===R?"offscreen"===f.renderPass?c.needsSkyboxCapture(f)&&(function(q,ae,fe,be){const we=q.context,xe=we.gl;let De=ae.skyboxFbo;if(!De){De=ae.skyboxFbo=we.createFramebuffer(32,32,!1),ae.skyboxGeometry=new Pa(we),ae.skyboxTexture=we.gl.createTexture(),xe.bindTexture(xe.TEXTURE_CUBE_MAP,ae.skyboxTexture),xe.texParameteri(xe.TEXTURE_CUBE_MAP,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_CUBE_MAP,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_CUBE_MAP,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_CUBE_MAP,xe.TEXTURE_MAG_FILTER,xe.LINEAR);for(let Pe=0;Pe<6;++Pe)xe.texImage2D(xe.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,xe.RGBA,32,32,0,xe.RGBA,xe.UNSIGNED_BYTE,null)}we.bindFramebuffer.set(De.framebuffer),we.viewport.set([0,0,32,32]);const le=ae.getCenter(q,!0),_e=q.useProgram("skyboxCapture"),Ie=new Float64Array(16);l.identity(Ie),l.rotateY(Ie,Ie,.5*-Math.PI),Bo(we,ae,_e,Ie,le,0),l.identity(Ie),l.rotateY(Ie,Ie,.5*Math.PI),Bo(we,ae,_e,Ie,le,1),l.identity(Ie),l.rotateX(Ie,Ie,.5*-Math.PI),Bo(we,ae,_e,Ie,le,2),l.identity(Ie),l.rotateX(Ie,Ie,.5*Math.PI),Bo(we,ae,_e,Ie,le,3),l.identity(Ie),Bo(we,ae,_e,Ie,le,4),l.identity(Ie),l.rotateY(Ie,Ie,Math.PI),Bo(we,ae,_e,Ie,le,5),we.viewport.set([0,0,q.width,q.height])}(f,c),c.markSkyboxValid(f)):"sky"===f.renderPass&&function(q,ae,fe,be,we){const xe=q.context,De=xe.gl,le=q.transform,_e=q.useProgram("skybox");xe.activeTexture.set(De.TEXTURE0),De.bindTexture(De.TEXTURE_CUBE_MAP,ae.skyboxTexture);const Ie={u_matrix:le.skyboxMatrix,u_sun_direction:ae.getCenter(q,!1),u_cubemap:0,u_opacity:be,u_temporal_offset:we};q.prepareDrawProgram(xe,_e),_e.draw(xe,De.TRIANGLES,fe,l.StencilMode.disabled,q.colorModeForRenderPass(),l.CullFaceMode.backCW,Ie,"skybox",ae.skyboxGeometry.vertexBuffer,ae.skyboxGeometry.indexBuffer,ae.skyboxGeometry.segment)}(f,c,z,C,W):"gradient"===R&&"sky"===f.renderPass&&function(q,ae,fe,be,we){const xe=q.context,De=xe.gl,le=q.transform,_e=q.useProgram("skyboxGradient");ae.skyboxGeometry||(ae.skyboxGeometry=new Pa(xe)),xe.activeTexture.set(De.TEXTURE0);let Ie=ae.colorRampTexture;Ie||(Ie=ae.colorRampTexture=new l.Texture(xe,ae.colorRamp,De.RGBA)),Ie.bind(De.LINEAR,De.CLAMP_TO_EDGE);const Pe=(Qe=le.skyboxMatrix,tt=ae.getCenter(q,!1),et=ae.paint.get("sky-gradient-radius"),gt=be,st=we,{u_matrix:Qe,u_color_ramp:0,u_center_direction:tt,u_radius:l.degToRad(et),u_opacity:gt,u_temporal_offset:st});var Qe,tt,et,gt,st;q.prepareDrawProgram(xe,_e),_e.draw(xe,De.TRIANGLES,fe,l.StencilMode.disabled,q.colorModeForRenderPass(),l.CullFaceMode.backCW,Pe,"skyboxGradient",ae.skyboxGeometry.vertexBuffer,ae.skyboxGeometry.indexBuffer,ae.skyboxGeometry.segment)}(f,c,z,C,W)},debug:function(f,r,c){for(let m=0;m<c.length;m++)pa(f,r,c[m])},custom:function(f,r,c,m){const b=f.context,C=c.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||"offscreen"===f.renderPass)&&c.isLayerDraped()){if("offscreen"===f.renderPass){const P=C.prerender;if(P){if(f.setCustomLayerDefaults(),b.setColorMode(f.colorModeForRenderPass()),"globe"===f.transform.projection.name){const R=f.transform.pointMerc;P.call(C,b.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),l.globeToMercatorTransition(f.transform.zoom),[R.x,R.y],f.transform.pixelsPerMeterRatio)}else P.call(C,b.gl,f.transform.customLayerMatrix());b.setDirty(),f.setBaseState()}}else if("translucent"===f.renderPass){if(f.terrain&&f.terrain.renderingToTexture){const R=C.renderToTile;if(R){const z=m[0].canonical,W=new l.MercatorCoordinate(z.x+m[0].wrap*(1<<z.z),z.y,z.z);b.setDepthMode(l.DepthMode.disabled),b.setStencilMode(l.StencilMode.disabled),b.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),R.call(C,b.gl,W),b.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),b.setColorMode(f.colorModeForRenderPass()),b.setStencilMode(l.StencilMode.disabled);const P="3d"===C.renderingMode?new l.DepthMode(f.context.gl.LEQUAL,l.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,l.DepthMode.ReadOnly);if(b.setDepthMode(P),"globe"===f.transform.projection.name){const R=f.transform.pointMerc;C.render(b.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),l.globeToMercatorTransition(f.transform.zoom),[R.x,R.y],f.transform.pixelsPerMeterRatio)}else C.render(b.gl,f.transform.customLayerMatrix());b.setDirty(),f.setBaseState(),b.bindFramebuffer.set(null)}}else l.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class J{constructor(r,c,m=!1){this.context=new an(r,m),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=l.SourceCache.maxUnderzooming+l.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,c){const m=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Jl(this,r));const b=this._terrain;this.transform.elevation=m?b:null,b.update(r,this.transform,c)}_updateFog(r){const c=r.fog;if(!c||"globe"===this.transform.projection.name||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,b]=c.getFovAdjustedRange(this.transform._fov);if(m>b)return void(this.transform.fogCullDistSq=null);const C=m+.78*(b-m);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,c){if(this.width=r*l.exported.devicePixelRatio,this.height=c*l.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const r=this.context,c=new l.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(l.EXTENT,0),c.emplaceBack(0,l.EXTENT),c.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(c,l.posAttributes.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const m=new l.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(l.EXTENT,0),m.emplaceBack(0,l.EXTENT),m.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=r.createVertexBuffer(m,l.posAttributes.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const b=new l.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(b,l.posAttributes.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const C=new l.StructArrayLayout4i8;C.emplaceBack(0,0,0,0),C.emplaceBack(l.EXTENT,0,l.EXTENT,0),C.emplaceBack(0,l.EXTENT,0,l.EXTENT),C.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(C,l.boundsAttributes.members),this.mercatorBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const P=new l.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(P);const R=new l.StructArrayLayout1ui2;for(const W of[0,1,3,2,0])R.emplaceBack(W);this.debugIndexBuffer=r.createIndexBuffer(R),this.emptyTexture=new l.Texture(r,new l.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=l.create();const z=this.context.gl;this.stencilClearMode=new l.StencilMode({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(l.window.performance.now()),this.atmosphereBuffer=new ee(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,c=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,c.TRIANGLES,l.DepthMode.disabled,this.stencilClearMode,l.ColorMode.disabled,l.CullFaceMode.disabled,na(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,c,m){if(!c||this.currentStencilSource===c.id||!r.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let R=!1;for(const z of m)if(void 0===this._tileClippingMaskIDs[z.key]){R=!0;break}if(!R)return}this.currentStencilSource=c.id;const b=this.context,C=b.gl;this.nextStencilID+m.length>256&&this.clearStencil(),b.setColorMode(l.ColorMode.disabled),b.setDepthMode(l.DepthMode.disabled);const P=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of m){const z=c.getTile(R),W=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,{tileBoundsBuffer:q,tileBoundsIndexBuffer:ae,tileBoundsSegments:fe}=this.getTileBoundsBuffers(z);P.draw(b,C.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:C.ALWAYS,mask:0},W,255,C.KEEP,C.KEEP,C.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,na(R.projMatrix),"$clipping",q,ae,fe)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,c=this.context.gl;return new l.StencilMode({func:c.NOTEQUAL,mask:255},r,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const c=this.context.gl;return new l.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(r){const c=this.context.gl,m=r.sort((P,R)=>R.overscaledZ-P.overscaledZ),b=m[m.length-1].overscaledZ,C=m[0].overscaledZ-b+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const P={};for(let R=0;R<C;R++)P[R+b]=new l.StencilMode({func:c.GEQUAL,mask:255},R+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=C,[P,m]}return[{[b]:l.StencilMode.disabled},m]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new l.ColorMode([r.CONSTANT_COLOR,r.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?l.ColorMode.unblended:l.ColorMode.alphaBlended}depthModeForSublayer(r,c,m){if(!this.opaquePassEnabledForLayer())return l.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new l.DepthMode(m||this.context.gl.LEQUAL,c,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,c){this.style=r,this.options=c,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const m=this.style.order,b=this.style._sourceCaches;for(const W in b){const q=b[W];q.used&&q.prepare(this.context)}const C={},P={},R={};for(const W in b){const q=b[W];C[W]=q.getVisibleCoordinates(),P[W]=C[W].slice().reverse(),R[W]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let W=0;W<m.length;W++)if(this.style._layers[m[W]].is3D()){this.opaquePassCutoff=W;break}if(this.terrain&&(this.terrain.updateTileBinding(R),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new l.GlobeSharedBuffers(this.context)),!l.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const W of m){const q=this.style._layers[W],ae=r._getLayerSourceCache(q);if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const fe=ae?P[ae.id]:void 0;("custom"===q.type||q.isSky()||fe&&fe.length)&&this.renderLayer(this,ae,q,fe)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon];const z=this.terrain;if(z&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&z.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const W=this.style._layers[m[this.currentLayer]],q=r._getLayerSourceCache(W);if(W.isSky())continue;const ae=q?P[q.id]:void 0;this._renderTileClippingMasks(W,q,ae),this.renderLayer(this,q,W,ae)}if(this.style.fog&&this.transform.projection.supportsFog&&function(W,q){const ae=W.context,fe=ae.gl,be=W.transform,we=new l.DepthMode(fe.LEQUAL,l.DepthMode.ReadOnly,[0,1]),xe=W.useProgram("globeAtmosphere",null,"globe"===be.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),De=l.globeToMercatorTransition(be.zoom),le=q.properties.get("color").toArray01(),_e=q.properties.get("high-color").toArray01(),Ie=q.properties.get("space-color").toArray01PremultipliedAlpha(),Pe=l.identity$1([]);l.rotateY$1(Pe,Pe,-l.degToRad(be._center.lng)),l.rotateX$1(Pe,Pe,l.degToRad(be._center.lat)),l.rotateZ$1(Pe,Pe,be.angle),l.rotateX$1(Pe,Pe,-be._pitch);const Qe=l.fromQuat(new Float32Array(16),Pe),tt=l.mapValue(q.properties.get("star-intensity"),0,1,0,.25),gt=l.mapValue(q.properties.get("horizon-blend"),0,1,5e-4,.25),st=l.globeUseCustomAntiAliasing(W,ae,be)&&5e-4===gt?be.worldSize/(2*Math.PI*1.025)-1:be.globeRadius,Mt=W.frameCounter/1e3%1,pn=l.length(be.globeCenterInViewSpace),Ct=Math.sqrt(Math.pow(pn,2)-Math.pow(st,2)),Qt=Math.acos(Ct/pn),kt={u_frustum_tl:be.frustumCorners.TL,u_frustum_tr:be.frustumCorners.TR,u_frustum_br:be.frustumCorners.BR,u_frustum_bl:be.frustumCorners.BL,u_horizon:be.frustumCorners.horizon,u_transition:De,u_fadeout_range:gt,u_color:le,u_high_color:_e,u_space_color:Ie,u_star_intensity:tt,u_star_size:5*l.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Mt,u_horizon_angle:Qt,u_rotation_matrix:Qe};W.prepareDrawProgram(ae,xe);const mn=W.atmosphereBuffer;mn&&xe.draw(ae,fe.TRIANGLES,we,l.StencilMode.disabled,l.ColorMode.alphaBlended,l.CullFaceMode.backCW,kt,"skybox",mn.vertexBuffer,mn.indexBuffer,mn.segments)}(this,this.style.fog),this.renderPass="sky",(l.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const W=this.style._layers[m[this.currentLayer]],q=r._getLayerSourceCache(W);W.isSky()&&this.renderLayer(this,q,W,q?P[q.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const W=this.style._layers[m[this.currentLayer]],q=r._getLayerSourceCache(W);if(W.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(W)){if(W.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ae=q?("symbol"===W.type?R:P)[q.id]:void 0;this._renderTileClippingMasks(W,q,q?C[q.id]:void 0),this.renderLayer(this,q,W,ae),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let W=null;l.values(this.style._layers).forEach(q=>{const ae=r._getLayerSourceCache(q);ae&&!q.isHidden(this.transform.zoom)&&(!W||W.getSource().maxzoom<ae.getSource().maxzoom)&&(W=ae)}),W&&this.options.showTileBoundaries&&Me.debug(this,W,W.getVisibleCoordinates())}this.options.showPadding&&function(W){const q=W.transform.padding;tc(W,W.transform.height-(q.top||0),3,fa),tc(W,q.bottom||0,3,$a),Ha(W,q.left||0,3,ec),Ha(W,W.transform.width-(q.right||0),3,lu);const ae=W.transform.centerPoint;var fe,be,we,xe;rl(fe=W,(be=ae.x)-1,(we=W.transform.height-ae.y)-10,2,20,xe=cu),rl(fe,be-10,we-1,20,2,xe)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(l.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,c,m,b){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||b&&b.length)&&(this.id=m.id,this.gpuTimingStart(m),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(m.type)||r.terrain&&"custom"===m.type)&&Me[m.type](r,c,m,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let m=this.gpuTimers[r.id];m||(m=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),m.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,c=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),r.beginQueryEXT(r.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const c={};for(const m in r){const b=r[m],C=this.context.extTimerQuery,P=C.getQueryObjectEXT(b.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(b.query),c[m]=P}return c}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let m=0;for(const b of r)m+=c.getQueryObjectEXT(b,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(b);return m}translatePosMatrix(r,c,m,b,C){if(!m[0]&&!m[1])return r;const P=C?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(P){const W=Math.sin(P),q=Math.cos(P);m=[m[0]*q-m[1]*W,m[0]*W+m[1]*q]}const R=[C?m[0]:ji(c,m[0],this.transform.zoom),C?m[1]:ji(c,m[1],this.transform.zoom),0],z=new Float32Array(16);return l.translate(z,r,R),z}saveTileTexture(r){const c=this._tileTextures[r.size[0]];c?c.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const c=this._tileTextures[r];return c&&c.length>0?c.pop():null}isPatternMissing(r){return null===r||void 0!==r&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&0===this.terrain.exaggeration(),m=this.style&&this.style.fog,b=[];return this.terrainRenderModeElevated()&&b.push("TERRAIN"),"globe"===this.transform.projection.name&&b.push("GLOBE"),c&&b.push("ZERO_EXAGGERATION"),m&&!r&&0!==m.getOpacity(this.transform.pitch)&&b.push("FOG"),r&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}useProgram(r,c,m){this.cache=this.cache||{};const b=m||[],C=this.currentGlobalDefines().concat(b),P=Ki.cacheKey(Fs[r],r,C,c);return this.cache[P]||(this.cache[P]=new Ki(this.context,r,Fs[r],c,zs[r],C)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=l.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,c,m){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const C=b.getOpacity(this.transform.pitch),P=((R,z,W,q,ae,fe,be,we,xe,De,le)=>{const _e=R.transform,Ie=z.properties.get("color").toArray01();Ie[3]=q;const Pe=R.frameCounter/1e3%1;return{u_fog_matrix:W?_e.calculateFogTileMatrix(W):R.identityMat,u_fog_range:z.getFovAdjustedRange(_e._fov),u_fog_color:Ie,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_temporal_offset:Pe,u_frustum_tl:ae,u_frustum_tr:fe,u_frustum_br:be,u_frustum_bl:we,u_globe_pos:xe,u_globe_radius:De,u_viewport:le,u_globe_transition:l.globeToMercatorTransition(_e.zoom),u_is_globe:+("globe"===_e.projection.name)}})(this,b,m,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*l.exported.devicePixelRatio,this.transform.height*l.exported.devicePixelRatio]);c.setFogUniformValues(r,P)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,c=r.createTexture();return r.bindTexture(r.TEXTURE_2D,c),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const b of m)c[b.key]=r[b.key]||new l.Tile(b,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class ve{constructor(r=0,c=0,m=0,b=0){if(isNaN(r)||r<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=c,this.left=m,this.right=b}interpolate(r,c,m){return null!=c.top&&null!=r.top&&(this.top=l.number(r.top,c.top,m)),null!=c.bottom&&null!=r.bottom&&(this.bottom=l.number(r.bottom,c.bottom,m)),null!=c.left&&null!=r.left&&(this.left=l.number(r.left,c.left,m)),null!=c.right&&null!=r.right&&(this.right=l.number(r.right,c.right,m)),this}getCenter(r,c){const m=l.clamp((this.left+r-this.right)/2,0,r),b=l.clamp((this.top+c-this.bottom)/2,0,c);return new l.Point(m,b)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ve(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function rt(f,r){const c=l.getColumn(f,3);l.fromQuat(f,r),l.setColumn(f,3,c)}function Tt(f,r){const c=l.identity$1([]);return l.rotateZ$1(c,c,-r),l.rotateX$1(c,c,-f),c}function on(f,r){const c=[f[0],f[1],0],m=[r[0],r[1],0];if(l.length(c)>=1e-15){const P=l.normalize([],c);l.scale$2(m,P,l.dot(m,P)),r[0]=m[0],r[1]=m[1]}const b=l.cross([],r,f);if(l.len(b)<1e-15)return null;const C=Math.atan2(-b[1],b[0]);return Tt(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),C)}class Wi{constructor(r,c){this.position=r,this.orientation=c}get position(){return this._position}set position(r){if(r){const c=r instanceof l.MercatorCoordinate?r:new l.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(c.x=l.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(r,c){if(this.orientation=null,!this.position)return;const m=this.position,b=this._elevation?this._elevation.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(r)):0,C=l.MercatorCoordinate.fromLngLat(r,b),P=[C.x-m.x,C.y-m.y,C.z-m.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=on(P,c)}setPitchBearing(r,c){this.orientation=Tt(l.degToRad(r),l.degToRad(-c))}}class Qi{constructor(r,c){this._transform=l.identity([]),this.orientation=c,this.position=r}get mercatorPosition(){const r=this.position;return new l.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=l.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var c;r&&l.setColumn(this._transform,3,[(c=r)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||l.identity$1([]),r&&rt(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,c){this._orientation=Tt(r,c),rt(this._transform,this._orientation)}forward(){const r=l.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=l.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=l.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,c){const m=new Float64Array(16);return l.invert(m,this.getWorldToCamera(r,c)),m}getWorldToCameraPosition(r,c,m){const b=this.position;l.scale$2(b,b,-r);const C=new Float64Array(16);return l.fromScaling(C,[m,m,m]),l.translate(C,C,b),C[10]*=c,C}getWorldToCamera(r,c){const m=new Float64Array(16),b=new Float64Array(4),C=this.position;return l.conjugate(b,this._orientation),l.scale$2(C,C,-r),l.fromQuat(m,b),l.translate(m,m,C),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(r,c,m,b){const C=new Float64Array(16);return l.perspective(C,r,c,m,b),C}getDistanceToElevation(r,c=!1){const m=0===r?0:l.mercatorZfromAltitude(r,c?l.latFromMercatorY(this.position[1]):this.position[1]),b=this.forward();return(m-this.position[2])/b[2]}clone(){return new Qi([...this.position],[...this.orientation])}}function zi(f,r){const c=eo(f.projection,f.zoom,f.width,f.height),m=function(C,P,R,z,W){const q=new l.LngLat(R.lng-180*Pi,R.lat),ae=new l.LngLat(R.lng+180*Pi,R.lat),fe=C.project(q.lng,q.lat),be=C.project(ae.lng,ae.lat),we=-Math.atan2(be.y-fe.y,be.x-fe.x),xe=l.MercatorCoordinate.fromLngLat(R);xe.y=l.clamp(xe.y,-1+Pi,1-Pi);const De=xe.toLngLat(),le=C.project(De.lng,De.lat),_e=l.MercatorCoordinate.fromLngLat(De);_e.x+=Pi;const Ie=_e.toLngLat(),Pe=C.project(Ie.lng,Ie.lat),Qe=ra(Pe.x-le.x,Pe.y-le.y,we),tt=l.MercatorCoordinate.fromLngLat(De);tt.y+=Pi;const et=tt.toLngLat(),gt=C.project(et.lng,et.lat),st=ra(gt.x-le.x,gt.y-le.y,we),Mt=Math.abs(Qe.x)/Math.abs(st.y),pn=l.identity([]);l.rotateZ(pn,pn,-we*(1-(W?0:z)));const Ct=l.identity([]);return l.scale(Ct,Ct,[1,1-(1-Mt)*z,1]),Ct[4]=-st.x/st.y*z,l.rotateZ(Ct,Ct,we),l.multiply(Ct,pn,Ct),Ct}(f.projection,0,f.center,c,r),b=ir(f);return l.scale(m,m,[b,b,1]),m}function ir(f){const r=f.projection,c=eo(f.projection,f.zoom,f.width,f.height),m=_r(r,f.center),b=_r(r,l.LngLat.convert(r.center));return Math.pow(2,m*c+(1-c)*b)}function eo(f,r,c,m,b=1/0){const C=f.range;if(!C)return 0;const P=Math.min(b,Math.max(c,m)),R=Math.log(P/1024)/Math.LN2;return l.smoothstep(C[0]+R,C[1]+R,r)}const Pi=1/4e4;function _r(f,r){const c=l.clamp(r.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),m=new l.LngLat(r.lng-180*Pi,c),b=new l.LngLat(r.lng+180*Pi,c),C=f.project(m.lng,c),P=f.project(b.lng,c),R=l.MercatorCoordinate.fromLngLat(m),z=l.MercatorCoordinate.fromLngLat(b),W=P.x-C.x,q=P.y-C.y,ae=z.x-R.x,fe=z.y-R.y,be=Math.sqrt((ae*ae+fe*fe)/(W*W+q*q));return Math.log(be)/Math.LN2}function ra(f,r,c){const m=Math.cos(c),b=Math.sin(c);return{x:f*m-r*b,y:f*b+r*m}}class As{constructor(r,c,m,b,C,P,R){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=b??60,this.setProjection(P),this.setMaxBounds(R),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ve,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Qi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new As(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,c=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||m)&&this._updateCameraOnTerrain(),(r||m)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return l.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=l.getProjection(this.projectionOptions);const m=!ge(c,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=l.getProjection({name:"mercator"});const c=r!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return l.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.Point(this.width,this.height)}get bearing(){return l.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const c=-r*Math.PI/180;var m,b,C,P,R,z,W,q,ae,fe;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(m=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),b=this.rotationMatrix,P=this.angle,R=(C=this.rotationMatrix)[0],z=C[1],W=C[2],q=C[3],ae=Math.sin(P),fe=Math.cos(P),b[0]=R*fe+W*ae,b[1]=z*fe+q*ae,b[2]=R*-ae+W*fe,b[3]=z*-ae+q*fe)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const c=l.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=l.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const c=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let b=0,C=0;for(let P=0;P<c.length;P++){const R=new l.Point(c[P][0]*this.width,m+c[P][1]*(this.height-m)),z=r.pointCoordinate(R);if(!z)continue;const W=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);b+=z[3]*W,C+=W}return 0===C?NaN:b/C}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,b=this._mercatorZfromZoom(r),C=this._mercatorZfromZoom(this._maxZoom),P=Math.max(b-m,C);this._setZoom(this._zoomFromMercatorZ(P))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let m;m=r.z<this._camera.position[2]?[c.x,c.y,c.z]:[r.x,r.y,r.z];const b=l.length(l.sub([],this._camera.position,m));return l.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let c=!1;if(r.orientation&&!l.exactEquals(r.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(r.orientation)),r.position){const m=[r.position.x,r.position.y,r.position.z];l.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,c=new Wi;return c.position=new l.MercatorCoordinate(r[0],r[1],r[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(r){if(!l.length$1(r))return!1;l.normalize$1(r,r);const c=l.transformQuat([],[0,0,-1],r),m=l.transformQuat([],[0,-1,0],r);if(m[2]<0)return!1;const b=on(c,m);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(r){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;r[2]=l.clamp(r[2],b/m,b/c),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,c,m){this._unmodified=!1,this._edgeInsets.interpolate(r,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const c=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(r){const c=[new l.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const m=this.pointCoordinate(new l.Point(0,0)),b=this.pointCoordinate(new l.Point(this.width,0)),C=this.pointCoordinate(new l.Point(this.width,this.height)),P=this.pointCoordinate(new l.Point(0,this.height)),R=Math.floor(Math.min(m.x,b.x,C.x,P.x)),z=Math.floor(Math.max(m.x,b.x,C.x,P.x)),W=1;for(let q=R-W;q<=z+W;q++)0!==q&&c.push(new l.UnwrappedTileID(q,r))}return c}coveringTiles(r){let c=this.coveringZoomLevel(r);const m=c,b=this.elevation&&!r.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==r.minzoom&&c<r.minzoom)return[];void 0!==r.maxzoom&&c>r.maxzoom&&(c=r.maxzoom);const P=this.locationCoordinate(this.center),R=this.center.lat,z=1<<c,W=[z*P.x,z*P.y,0],q="globe"===this.projection.name,ae=!q,fe=l.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,ae),be=q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),we=z*l.mercatorZfromAltitude(1,this.center.lat),xe=this._camera.position[2]/l.mercatorZfromAltitude(1,this.center.lat),De=[z*be.x,z*be.y,xe*(ae?1:we)],le=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),_e=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,Ie=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Pe=r.isTerrainDEM?-Ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,Qe=this.projection.isReprojectedInTileSpace?ir(this):1,tt=It=>{const En=new l.MercatorCoordinate(It.x+25e-6,It.y,It.z),ln=new l.MercatorCoordinate(It.x,It.y+25e-6,It.z),Cn=It.toLngLat(),ai=En.toLngLat(),Ai=ln.toLngLat(),Hn=this.locationCoordinate(Cn),wi=this.locationCoordinate(ai),rr=this.locationCoordinate(Ai),er=Math.hypot(wi.x-Hn.x,wi.y-Hn.y),Qn=Math.hypot(rr.x-Hn.x,rr.y-Hn.y);return Math.sqrt(er*Qn)*Qe/25e-6},et=It=>{const Jt=Ie,En=Pe;return{aabb:l.tileAABB(this,z,0,0,0,It,En,Jt,this.projection),zoom:0,x:0,y:0,minZ:En,maxZ:Jt,wrap:It,fullyVisible:!1}},gt=[];let st=[];const Mt=c,pn=r.reparseOverscaled?m:c,Ct=It=>It*It,Qt=Ct((xe-this._centerAltitude)*we),kt=It=>{if(!this._elevation||!It.tileID||!C)return;const Jt=this._elevation.getMinMaxForTile(It.tileID),En=It.aabb;Jt?(En.min[2]=Jt.min,En.max[2]=Jt.max,En.center[2]=(En.min[2]+En.max[2])/2):(It.shouldSplit=mn(It),It.shouldSplit||(En.min[2]=En.max[2]=En.center[2]=this._centerAltitude))},mn=It=>{if(It.zoom<_e)return!0;if(It.zoom===Mt)return!1;if(null!=It.shouldSplit)return It.shouldSplit;const Jt=It.aabb.distanceX(De),En=It.aabb.distanceY(De);let ln=Qt,Cn=1;if(q){ln=Ct(It.aabb.distanceZ(De));const Hn=Math.pow(2,It.zoom),wi=l.latFromMercatorY((It.y+1)/Hn),rr=l.latFromMercatorY(It.y/Hn),er=Math.min(Math.max(R,wi),rr),Qn=l.circumferenceAtLatitude(er)/l.circumferenceAtLatitude(R);if(Cn=er===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Qn/this._mercatorScaleRatio),this.zoom<=l.GLOBE_ZOOM_THRESHOLD_MIN&&It.zoom===Mt-1&&Qn>=.9)return!0}else if(b&&(ln=Ct(It.aabb.distanceZ(De)*we)),this.projection.isReprojectedInTileSpace&&m<=5){const Hn=Math.pow(2,It.zoom),wi=tt(new l.MercatorCoordinate((It.x+.5)/Hn,(It.y+.5)/Hn));Cn=wi>.85?1:wi}const ai=Jt*Jt+En*En+ln;return ai<Ct((1<<Mt-It.zoom)*le*Cn*((Hn,wi)=>{if(wi*Ct(.707)<Hn)return 1;const rr=Math.sqrt(wi/Hn);return rr/(1.4144271570014144+(Math.pow(1.1,rr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ln,Qt),ai))};if(this.renderWorldCopies)for(let It=1;It<=3;It++)gt.push(et(-It)),gt.push(et(It));for(gt.push(et(0));gt.length>0;){const It=gt.pop(),Jt=It.x,En=It.y;let ln=It.fullyVisible;if(!ln){const Cn=It.aabb.intersects(fe);if(0===Cn)continue;ln=2===Cn}if(It.zoom!==Mt&&mn(It))for(let Cn=0;Cn<4;Cn++){const ai=(Jt<<1)+Cn%2,Ai=(En<<1)+(Cn>>1),Hn={aabb:C?It.aabb.quadrant(Cn):l.tileAABB(this,z,It.zoom+1,ai,Ai,It.wrap,It.minZ,It.maxZ,this.projection),zoom:It.zoom+1,x:ai,y:Ai,wrap:It.wrap,fullyVisible:ln,tileID:void 0,shouldSplit:void 0,minZ:It.minZ,maxZ:It.maxZ};b&&!q&&(Hn.tileID=new l.OverscaledTileID(It.zoom+1===Mt?pn:It.zoom+1,It.wrap,It.zoom+1,ai,Ai),kt(Hn)),gt.push(Hn)}else{const Cn=It.zoom===Mt?pn:It.zoom;if(r.minzoom&&r.minzoom>Cn)continue;const ai=W[0]-(.5+Jt+(It.wrap<<It.zoom))*(1<<c-It.zoom),Ai=W[1]-.5-En,Hn=It.tileID?It.tileID:new l.OverscaledTileID(Cn,It.wrap,It.zoom,Jt,En);st.push({tileID:Hn,distanceSq:ai*ai+Ai*Ai})}}if(this.fogCullDistSq){const It=this.fogCullDistSq,Jt=this.horizonLineFromTop();st=st.filter(En=>{const ln=[0,0,0,1],Cn=[l.EXTENT,l.EXTENT,0,1],ai=this.calculateFogTileMatrix(En.tileID.toUnwrapped());l.transformMat4$1(ln,ln,ai),l.transformMat4$1(Cn,Cn,ai);const Ai=l.getAABBPointSquareDist(ln,Cn);if(0===Ai)return!0;let Hn=!1;const wi=this._elevation;if(wi&&Ai>It&&0!==Jt){const rr=this.calculateProjMatrix(En.tileID.toUnwrapped());let er;r.isTerrainDEM||(er=wi.getMinMaxForTile(En.tileID)),er||(er={min:Pe,max:Ie});const Qn=l.furthestTileCorner(this.rotation),yr=[Qn[0]*l.EXTENT,Qn[1]*l.EXTENT,er.max];l.transformMat4(yr,yr,rr),Hn=(1-yr[1])*this.height*.5<Jt}return Ai<It||Hn})}return st.sort((It,Jt)=>It.distanceSq-Jt.distanceSq).map(It=>It.tileID)}resize(r,c){this.width=r,this.height=c,this.pixelsToGLUnits=[2/r,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const c=l.clamp(r.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),m=this.projection.project(r.lng,c);return new l.Point(m.x*this.worldSize,m.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/l.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,c){let m,b;const C=this.centerPoint;if("globe"===this.projection.name){const R=this.worldSize;m=(c.x-C.x)/R,b=(c.y-C.y)/R}else{const R=this.pointCoordinate(c),z=this.pointCoordinate(C);m=R.x-z.x,b=R.y-z.y}const P=this.locationCoordinate(r);this.setLocation(new l.MercatorCoordinate(P.x-m,P.y-b))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,c){const m=c?l.mercatorZfromAltitude(c,r.lat):void 0,b=this.projection.project(r.lng,r.lat);return new l.MercatorCoordinate(b.x,b.y,m)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,c){const m=c??this._centerAltitude,b=[r.x,r.y,0,1],C=[r.x,r.y,1,1];l.transformMat4$1(b,b,this.pixelMatrixInverse),l.transformMat4$1(C,C,this.pixelMatrixInverse);const P=C[3];l.scale$1(b,b,1/b[3]),l.scale$1(C,C,1/P);const R=b[2],z=C[2];return{p0:b,p1:C,t:R===z?0:(m-R)/(z-R)}}screenPointToMercatorRay(r){const c=[r.x,r.y,0,1],m=[r.x,r.y,1,1];return l.transformMat4$1(c,c,this.pixelMatrixInverse),l.transformMat4$1(m,m,this.pixelMatrixInverse),l.scale$1(c,c,1/c[3]),l.scale$1(m,m,1/m[3]),c[2]=l.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,m[2]=l.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,l.scale$1(c,c,1/this.worldSize),l.scale$1(m,m,1/this.worldSize),new l.Ray([c[0],c[1],c[2]],l.normalize([],l.sub([],m,c)))}rayIntersectionCoordinate(r){const{p0:c,p1:m,t:b}=r,C=l.mercatorZfromAltitude(c[2],this._center.lat),P=l.mercatorZfromAltitude(m[2],this._center.lat);return new l.MercatorCoordinate(l.number(c[0],m[0],b)/this.worldSize,l.number(c[1],m[1],b)/this.worldSize,l.number(C,P,b))}pointCoordinate(r,c=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,c)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let c=this.projection.pointCoordinate3D(this,r.x,r.y);if(c)return new l.MercatorCoordinate(c[0],c[1],c[2]);let m=0,b=this.horizonLineFromTop();if(r.y>b)return this.pointCoordinate(r);const C=.02*b,P=r.clone();for(let R=0;R<10&&b-m>C;R++){P.y=l.number(m,b,.66);const z=this.projection.pointCoordinate3D(this,P.x,P.y);z?(b=P.y,c=z):m=P.y}return c?new l.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(r);const c=this.pointCoordinate(r);return c.y>=0&&c.y<=1}_coordinatePoint(r,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,b=[r.x*this.worldSize,r.y*this.worldSize,m+r.toAltitude(),1];return l.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new l.Point(b[0]/b[3],b[1]/b[3]):new l.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:c}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,C=this.pointLocation3D(new l.Point(c,r)),P=this.pointLocation3D(new l.Point(b,r)),R=this.pointLocation3D(new l.Point(b,m)),z=this.pointLocation3D(new l.Point(c,m));let W=Math.min(C.lng,P.lng,R.lng,z.lng),q=Math.max(C.lng,P.lng,R.lng,z.lng),ae=Math.min(C.lat,P.lat,R.lat,z.lat),fe=Math.max(C.lat,P.lat,R.lat,z.lat);const be=Math.pow(2,-this.zoom)/16*270,we="globe"===this.projection.name?1:4,xe=(De,le,_e,Ie,Pe)=>{const Qe=(De+_e)/2,tt=(le+Ie)/2,et=new l.Point(Qe,tt),{lng:gt,lat:st}=this.pointLocation3D(et),Mt=Math.max(0,W-gt,ae-st,gt-q,st-fe);W=Math.min(W,gt),q=Math.max(q,gt),ae=Math.min(ae,st),fe=Math.max(fe,st),(Pe<we||Mt>be)&&(xe(De,le,Qe,tt,Pe+1),xe(Qe,tt,_e,Ie,Pe+1))};if(xe(c,r,b,r,1),xe(b,r,b,m,1),xe(b,m,c,m,1),xe(c,m,c,r,1),"globe"===this.projection.name){const[De,le]=l.polesInViewport(this);De?(fe=90,q=180,W=-180):le&&(ae=-90,q=180,W=-180)}return new l.LngLatBounds(new l.LngLat(W,ae),new l.LngLat(q,fe))}_getBoundsRectangular(r,c){const{top:m,left:b}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,P=this.width-this._edgeInsets.right,R=new l.Point(b,m),z=new l.Point(P,m),W=new l.Point(P,C),q=new l.Point(b,C);let ae=this.pointCoordinate(R,r),fe=this.pointCoordinate(z,r);const be=this.pointCoordinate(W,c),we=this.pointCoordinate(q,c),xe=(De,le)=>(le.y-De.y)/(le.x-De.x);return ae.y>1&&fe.y>=0?ae=new l.MercatorCoordinate((1-we.y)/xe(we,ae)+we.x,1):ae.y<0&&fe.y<=1&&(ae=new l.MercatorCoordinate(-we.y/xe(we,ae)+we.x,0)),fe.y>1&&ae.y>=0?fe=new l.MercatorCoordinate((1-be.y)/xe(be,fe)+be.x,1):fe.y<0&&ae.y<=1&&(fe=new l.MercatorCoordinate(-be.y/xe(be,fe)+be.x,0)),(new l.LngLatBounds).extend(this.coordinateLocation(ae)).extend(this.coordinateLocation(fe)).extend(this.coordinateLocation(we)).extend(this.coordinateLocation(be))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=r.visibleDemTiles.reduce((m,b)=>{if(b.dem){const C=b.dem.tree;m.min=Math.min(m.min,C.minimums[0]),m.max=Math.max(m.max,C.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*r.exaggeration(),c.max*r.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return r?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-l.MAX_MERCATOR_LATITUDE,this.maxLat=l.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=l.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=l.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=l.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=l.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,c){return this.projection.createTileMatrix(this,c,r)}calculateDistanceTileData(r){const c=r.key,m=this._distanceTileDataCache;if(m[c])return m[c];const b=r.canonical,C=1/this.height,P=this.cameraWorldSize,R=P/this.zoomScale(b.z),z=(b.x+Math.pow(2,b.z)*r.wrap)*R,W=b.y*R,q=this.point;q.x*=P/this.worldSize,q.y*=P/this.worldSize;const ae=this.angle,fe=Math.sin(-ae),be=-Math.cos(-ae);return m[c]={bearing:[fe,be],center:[(q.x-z)*C,(q.y-W)*C],scale:R/l.EXTENT*C},m[c]}calculateFogTileMatrix(r){const c=r.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return l.multiply(b,this.worldToFogMatrix,b),m[c]=new Float32Array(b),m[c]}calculateProjMatrix(r,c=!1){const m=r.key,b=c?this._alignedProjMatrixCache:this._projMatrixCache;if(b[m])return b[m];const C=this.calculatePosMatrix(r,this.worldSize);return l.multiply(C,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,C),b[m]=new Float32Array(C),b[m]}calculatePixelsToTileUnitsMatrix(r){const c=r.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const b=function(C,P){const{scale:R}=C.tileTransform,z=R*l.EXTENT/(C.tileSize*Math.pow(2,P.zoom-C.tileID.overscaledZ+C.tileID.canonical.z));return W=new Float32Array(4),fe=(q=P.inverseAdjustmentMatrix)[1],be=q[2],we=q[3],De=(ae=[z,z])[1],W[0]=q[0]*(xe=ae[0]),W[1]=fe*xe,W[2]=be*De,W[3]=we*De,W;var W,q,ae,fe,be,we,xe,De}(r,this);return m[c]=b,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const r=1/this.worldSize,c=l.fromScaling([],[r,r,r]);return l.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const c=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),b=this._camera.forward(),C=l.mercatorZfromAltitude(1,this._center.lat);m[2]/=C,b[2]/=C,l.normalize(b,b);const P=r.raycast(m,b,r.exaggeration());if(P){const R=l.scaleAndAdd([],m,b,P),z=new l.MercatorCoordinate(R[0],R[1],l.mercatorZfromAltitude(R[2],l.latFromMercatorY(R[1]))),W=(z.z+l.length([z.x-m[0],z.y-m[1],z.z-m[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(W),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const c=this._elevation,m=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(m),C=c.getAtPointOrZero(new l.MercatorCoordinate(...b)),P=this.pixelsPerMeter/this.worldSize*C,R=this._minimumHeightOverTerrain(),z=b[2]-P;if(z<=R)if(z<0||r){const W=this.locationCoordinate(this._center,this._centerAltitude),q=[b[0],b[1],W.z-b[2]],ae=l.length(q);q[2]-=(R-z)/this._pixelsPerMercatorPixel;const fe=l.length(q);if(0===fe)return;l.scale$2(q,q,ae/fe*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],W.z*this._pixelsPerMercatorPixel-q[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const fe=this.center;return fe.lat=l.clamp(fe.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(fe.lng=l.clamp(fe.lng,this.minLng,this.maxLng)),this.center=fe,void(this._constraining=!1)}const c=this._unmodified,{x:m,y:b}=this.point;let C=0,P=m,R=b;const z=this.width/2,W=this.height/2,q=this.worldMinY*this.scale,ae=this.worldMaxY*this.scale;if(b-W<q&&(R=q+W),b+W>ae&&(R=ae-W),ae-q<this.height&&(C=Math.max(C,this.height/(ae-q)),R=(ae+q)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const fe=this.worldMinX*this.scale,be=this.worldMaxX*this.scale,we=this.worldSize/2-(fe+be)/2;P=(m+we+this.worldSize)%this.worldSize-we,P-z<fe&&(P=fe+z),P+z>be&&(P=be-z),be-fe<this.width&&(C=Math.max(C,this.width/(be-fe)),P=(be+fe)/2)}P===m&&R===b||(this.center=this.unproject(new l.Point(P,R))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,c=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=l.mercatorZfromAltitude(1,this.center.lat)/l.mercatorZfromAltitude(1,l.GLOBE_SCALE_MATCH_LATITUDE));const m=eo(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b="meters"===this.projection.zAxisUnit?c:1,C=this._camera.getWorldToCamera(this.worldSize,b),P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);P[8]=2*-r.x/this.width,P[9]=2*r.y/this.height;let R=l.mul([],P,C);if(this.projection.isReprojectedInTileSpace){const tt=this.locationCoordinate(this.center),et=l.identity([]);l.translate(et,et,[tt.x*this.worldSize,tt.y*this.worldSize,0]),l.multiply(et,et,zi(this)),l.translate(et,et,[-tt.x*this.worldSize,-tt.y*this.worldSize,0]),l.multiply(R,R,et),this.inverseAdjustmentMatrix=function(gt){const st=zi(gt,!0);return Ze([],[st[0],st[1],st[4],st[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=l.scale([],R,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=R,this.invProjMatrix=l.invert(new Float64Array(16),this.projMatrix);const z=l.invert([],P);this.frustumCorners=l.FrustumCorners.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height);const W=new Float32Array(16);l.identity(W),l.scale(W,W,[1,-1,1]),l.rotateX(W,W,this._pitch),l.rotateZ(W,W,this.angle);const q=l.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ae=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-r.x/this.width,q[9]=2*(r.y+ae)/this.height,this.skyboxMatrix=l.multiply(W,q,W);const fe=this.point,be=fe.x,we=fe.y,xe=this.width%2/2,De=this.height%2/2,le=Math.cos(this.angle),_e=Math.sin(this.angle),Ie=be-Math.round(be)+le*xe+_e*De,Pe=we-Math.round(we)+le*De+_e*xe,Qe=new Float64Array(R);if(l.translate(Qe,Qe,[Ie>.5?Ie-1:Ie,Pe>.5?Pe-1:Pe,0]),this.alignedProjMatrix=Qe,R=l.create(),l.scale(R,R,[this.width/2,-this.height/2,1]),l.translate(R,R,[1,-1,0]),this.labelPlaneMatrix=R,R=l.create(),l.scale(R,R,[1,-1,1]),l.translate(R,R,[-1,-1,0]),l.scale(R,R,[2/this.width,2/this.height,1]),this.glCoordMatrix=R,this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},R=l.invert(new Float64Array(16),this.pixelMatrix),!R)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=R,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=l.calculateGlobeMatrix(this);const tt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=l.transformMat4(tt,tt,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=R;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,m=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,C=[r,r,c];l.scale$2(C,C,b),l.scale$2(m,m,-1),l.multiply$2(m,m,C);const P=l.create();l.translate(P,P,m),l.scale(P,P,C),this.mercatorFogMatrix=P,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,c,b)}_computeCameraPosition(r){const c=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),b=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-r/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-m[0]*C,b.y/this.worldSize-m[1]*C,r/this.worldSize*this._centerAltitude-m[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],b=r[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(C=Math.min((c-m)/b,1)),this._camera.position=l.scaleAndAdd([],this._camera.position,r,C),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:b}=this._camera.getPitchBearing(),C=l.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,P=this._mercatorZfromZoom(this._maxZoom)*Math.cos(l.degToRad(this._maxPitch)),R=Math.max((r[2]-C)/Math.cos(m),P),z=this._zoomFromMercatorZ(R);l.scaleAndAdd(r,r,c,R),this._pitch=l.clamp(m,l.degToRad(this.minPitch),l.degToRad(this.maxPitch)),this.angle=l.wrap(b,-Math.PI,Math.PI),this._setZoom(l.clamp(z,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new l.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let c=0,m=l.GLOBE_ZOOM_THRESHOLD_MAX,b=0,C=1/0;for(;m-c>1e-6&&m>c;){const P=c+.5*(m-c),R=this.tileSize*Math.pow(2,P),z=this.getCameraToCenterDistance(this.projection,P,R),W=this.scaleZoom(z/(r*this.tileSize)),q=Math.abs(P-W);q<C&&(C=q,b=P),P<W?c=P:m=P}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(l.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,c){const m=Math.min(r.x,c.x),b=Math.max(r.x,c.x),C=Math.min(r.y,c.y),P=Math.max(r.y,c.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const R=[new l.Point(m,C),new l.Point(b,P),new l.Point(m,P),new l.Point(b,C)],z=this.renderWorldCopies?-3:0,W=this.renderWorldCopies?4:1;for(const q of R){const ae=this.pointRayIntersection(q);if(ae.t<0)return!0;const fe=this.rayIntersectionCoordinate(ae);if(fe.x<z||fe.y<0||fe.x>W||fe.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+l.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new l.Point(0,0),new l.Point(this.width,this.height))}zoomDeltaToMovement(r,c){const m=l.length(l.sub([],this._camera.position,r)),b=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(b)}getCameraPoint(){if("globe"===this.projection.name){const r=function([c,m,b],C){const P=[c,m,b,1];l.transformMat4$1(P,P,C);const R=P[3]=Math.max(P[3],1e-6);return P[0]/=R,P[1]/=R,P[2]/=R,P}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new l.Point(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.Point(0,r))}}getCameraToCenterDistance(r,c=this.zoom,m=this.worldSize){const b=eo(r,c,this.width,this.height,1024),C=r.pixelSpaceConversion(this.center.lat,m,b);return.5/Math.tan(.5*this._fov)*this.height*C}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&l.multiply(r,r,this.globeMatrix),r}}function vs(f,r){let c=!1,m=null;const b=()=>{m=null,c&&(f(),m=setTimeout(b,r),c=!1)};return()=>(c=!0,m||b(),m)}class Lo{constructor(r){this._hashName=r&&encodeURIComponent(r),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=vs(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,l.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),l.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const c=Ys(r);if(this._hashName){const m=this._hashName;let b=!1;const C=l.window.location.hash.slice(1).split("&").map(P=>{const R=P.split("=")[0];return R===m?(b=!0,`${R}=${c}`):P}).filter(P=>P);return b||C.push(`${m}=${c}`),`#${C.join("&")}`}return`#${c}`}_getCurrentHash(){const r=l.window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(m=>isNaN(m))){const m=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(c[3]||0):r.getBearing();return r.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:m,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=l.window.location.href.replace(/(#.+)?$/,this.getHashString());l.window.history.replaceState(l.window.history.state,null,r)}}function Ys(f,r){const c=f.getCenter(),m=Math.round(100*f.getZoom())/100,b=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,b),P=Math.round(c.lng*C)/C,R=Math.round(c.lat*C)/C,z=f.getBearing(),W=f.getPitch();let q=r?`/${P}/${R}/${m}`:`${m}/${R}/${P}`;return(z||W)&&(q+="/"+Math.round(10*z)/10),W&&(q+=`/${Math.round(W)}`),q}const oa={linearity:.3,easing:l.bezier(0,0,.3,1)},Ps=l.extend({deceleration:2500,maxSpeed:1400},oa),ic=l.extend({deceleration:20,maxSpeed:1400},oa),Fn=l.extend({deceleration:1e3,maxSpeed:360},oa),ma=l.extend({deceleration:1e3,maxSpeed:90},oa);class Ri{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,c=l.exported.now();for(;r.length>0&&c-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new l.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)c.zoom+=C.zoomDelta||0,c.bearing+=C.bearingDelta||0,c.pitch+=C.pitchDelta||0,C.panDelta&&c.pan._add(C.panDelta),C.around&&(c.around=C.around),C.pinchAround&&(c.pinchAround=C.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(c.pan.mag()){const C=rc(c.pan.mag(),m,l.extend({},Ps,r||{}));b.offset=c.pan.mult(C.amount/c.pan.mag()),b.center=this._map.transform.center,sa(b,C)}if(c.zoom){const C=rc(c.zoom,m,ic);b.zoom=this._map.transform.zoom+C.amount,sa(b,C)}if(c.bearing){const C=rc(c.bearing,m,Fn);b.bearing=this._map.transform.bearing+l.clamp(C.amount,-179,179),sa(b,C)}if(c.pitch){const C=rc(c.pitch,m,ma);b.pitch=this._map.transform.pitch+C.amount,sa(b,C)}if(b.zoom||b.bearing){const C=void 0===c.pinchAround?c.around:c.pinchAround;b.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function sa(f,r){(!f.duration||f.duration<r.duration)&&(f.duration=r.duration,f.easing=r.easing)}function rc(f,r,c){const{maxSpeed:m,linearity:b,deceleration:C}=c,P=l.clamp(f*b/(r/1e3),-m,m),R=Math.abs(P)/(C*b);return{easing:c.easing,duration:1e3*R,amount:P*(R/2)}}class Xo extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,m,b={}){const C=Tn(c.getCanvasContainer(),m),P=c.unproject(C);super(r,l.extend({point:C,lngLat:P,originalEvent:m},b)),this._defaultPrevented=!1,this.target=c}}class Il extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,m){const b="touchend"===r?m.changedTouches:m.touches,C=kn(c.getCanvasContainer(),b),P=C.map(z=>c.unproject(z)),R=C.reduce((z,W,q,ae)=>z.add(W.div(ae.length)),new l.Point(0,0));super(r,{points:C,point:R,lngLats:P,lngLat:c.unproject(R),originalEvent:m}),this._defaultPrevented=!1}}class oc extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,m){super(r,{originalEvent:m}),this._defaultPrevented=!1}}class Ic{constructor(r,c){this._map=r,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new oc(r.type,this._map,r))}mousedown(r,c){return this._mousedownPos=c,this._firePreventable(new Xo(r.type,this._map,r))}mouseup(r){this._map.fire(new Xo(r.type,this._map,r))}preclick(r){const c=l.extend({},r);c.type="preclick",this._map.fire(new Xo(c.type,this._map,c))}click(r,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Xo(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Xo(r.type,this._map,r))}mouseover(r){this._map.fire(new Xo(r.type,this._map,r))}mouseout(r){this._map.fire(new Xo(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Il(r.type,this._map,r))}touchmove(r){this._map.fire(new Il(r.type,this._map,r))}touchend(r){this._map.fire(new Il(r.type,this._map,r))}touchcancel(r){this._map.fire(new Il(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wa{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Xo(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Xo(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ac{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,c){this.isEnabled()&&r.shiftKey&&0===r.button&&(zt(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(r,c){if(!this._active)return;const m=c,b=this._startPos,C=this._lastPos;if(!b||!C||C.equals(m)||!this._box&&m.dist(b)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=Ge("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const P=Math.min(b.x,m.x),R=Math.max(b.x,m.x),z=Math.min(b.y,m.y),W=Math.max(b.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${P}px,${z}px)`,this._box.style.width=R-P+"px",this._box.style.height=W-z+"px")})}mouseupWindow(r,c){if(!this._active)return;const m=this._startPos,b=c;if(m&&0===r.button){if(this.reset(),Bn(),m.x!==b.x||m.y!==b.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:C=>C.fitScreenCoordinates(m,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),dn(),delete this._startPos,delete this._lastPos}_fireEvent(r,c){return this._map.fire(new l.Event(r,{originalEvent:c}))}}function sc(f,r){const c={};for(let m=0;m<f.length;m++)c[f[m].identifier]=r[m];return c}class ac{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),m.length===this.numTouches&&(this.centroid=function(b){const C=new l.Point(0,0);for(const P of b)C._add(P);return C.div(b.length)}(c),this.touches=sc(m,c)))}touchmove(r,c,m){if(this.aborted||!this.centroid)return;const b=sc(m,c);for(const C in this.touches){const P=b[C];(!P||P.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(r,c,m){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Pc{constructor(r){this.singleTap=new ac(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,c,m){this.singleTap.touchstart(r,c,m)}touchmove(r,c,m){this.singleTap.touchmove(r,c,m)}touchend(r,c,m){const b=this.singleTap.touchend(r,c,m);if(b){const C=r.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(b)<30;if(C&&P||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Za{constructor(){this._zoomIn=new Pc({numTouches:1,numTaps:2}),this._zoomOut=new Pc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,c,m){this._zoomIn.touchstart(r,c,m),this._zoomOut.touchstart(r,c,m)}touchmove(r,c,m){this._zoomIn.touchmove(r,c,m),this._zoomOut.touchmove(r,c,m)}touchend(r,c,m){const b=this._zoomIn.touchend(r,c,m),C=this._zoomOut.touchend(r,c,m);return b?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(b)},{originalEvent:r})}):C?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(C)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const hn={0:1,2:2};class lr{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,c){return!1}_move(r,c){return{}}mousedown(r,c){if(this._lastPoint)return;const m=Dn(r);this._correctButton(r,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(r,c){const m=this._lastPoint;if(m)if(r.preventDefault(),null!=this._eventButton&&function(b,C){const P=hn[C];return void 0===b.buttons||(b.buttons&P)!==P}(r,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}mouseupWindow(r){this._lastPoint&&Dn(r)===this._eventButton&&(this._moved&&Bn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lc extends lr{mousedown(r,c){super.mousedown(r,c),this._lastPoint&&(this._active=!0)}_correctButton(r,c){return 0===c&&!r.ctrlKey}_move(r,c){return{around:c,panDelta:c.sub(r)}}}class Al extends lr{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const m=.8*(c.x-r.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(r){r.preventDefault()}}class Go extends lr{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const m=-.5*(c.y-r.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(r){r.preventDefault()}}class Pl{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),l.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new l.Point(0,0)}touchstart(r,c,m){return this._calculateTransform(r,c,m)}touchmove(r,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length&&!l.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,c,m)}}touchend(r,c,m){this._calculateTransform(r,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,c,m){m.length>0&&(this._active=!0);const b=sc(m,c),C=new l.Point(0,0),P=new l.Point(0,0);let R=0;for(const W in b){const q=b[W],ae=this._touches[W];ae&&(C._add(q),P._add(q.sub(ae)),R++,b[W]=q)}if(this._touches=b,R<this._minTouches||!P.mag())return;const z=P.div(R);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(R),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ge("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ga{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,c,m){return{}}touchstart(r,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(r,c,m){const b=this._firstTwoTouches;if(!b)return;r.preventDefault();const[C,P]=b,R=Us(m,c,C),z=Us(m,c,P);if(!R||!z)return;const W=this._aroundCenter?null:R.add(z).div(2);return this._move([R,z],W,r)}touchend(r,c,m){if(!this._firstTwoTouches)return;const[b,C]=this._firstTwoTouches,P=Us(m,c,b),R=Us(m,c,C);P&&R||(this._active&&Bn(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Us(f,r,c){for(let m=0;m<f.length;m++)if(f[m].identifier===c)return r[m]}function cc(f,r){return Math.log(f/r)/Math.LN2}class uc extends ga{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,c){const m=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(cc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:cc(this._distance,m),pinchAround:c}}}function Rc(f,r){return 180*f.angleWith(r)/Math.PI}class Oc extends ga{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,c){const m=this._vector;if(this._vector=r[0].sub(r[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Rc(this._vector,m),pinchAround:c}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const c=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const b=Rc(r,m);return Math.abs(b)<c}}function Ra(f){return Math.abs(f.y)>Math.abs(f.x)}class rs extends ga{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Ra(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,c,m){const b=this._lastPoints;if(!b)return;const C=r[0].sub(b[0]),P=r[1].sub(b[1]);return this._map._cooperativeGestures&&!l.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(C,P,m.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(C.y+P.y)/2*-.5})}gestureBeginsVertically(r,c,m){if(void 0!==this._valid)return this._valid;const b=r.mag()>=2,C=c.mag()>=2;if(!b&&!C)return;if(!b||!C)return null==this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const P=r.y>0==c.y>0;return Ra(r)&&Ra(c)&&P}}const qa={panStep:100,bearingStep:15,pitchStep:10};class uu{constructor(){const r=qa;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let c=0,m=0,b=0,C=0,P=0;switch(r.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:r.shiftKey?m=-1:(r.preventDefault(),C=-1);break;case 39:r.shiftKey?m=1:(r.preventDefault(),C=1);break;case 38:r.shiftKey?b=1:(r.preventDefault(),P=-1);break;case 40:r.shiftKey?b=-1:(r.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(m=0,b=0),{cameraAnimation:R=>{const z=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Rl,zoom:c?Math.round(z)+c*(r.shiftKey?2:1):z,bearing:R.getBearing()+m*this._bearingStep,pitch:R.getPitch()+b*this._pitchStep,offset:[-C*this._panStep,-P*this._panStep],center:R.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Rl(f){return f*(2-f)}const _a=4.000244140625;class kc{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||l.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=r.deltaMode===l.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const m=l.exported.now(),b=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==c&&c%_a==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(b*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),r.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=r,this._delta-=c,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Tn(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;"wheel"===this._type&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const z="wheel"===this._type&&Math.abs(this._delta)>_a?this._wheelZoomRate:this._defaultZoomRate;let W=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&0!==W&&(W=1/W);const q=c(),ae=Math.pow(2,q),fe="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):ae;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(fe*W))),"wheel"===this._type&&(this._startZoom=q,this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:c(),b=this._startZoom,C=this._easing;let P,R=!1;if("wheel"===this._type&&b&&C){const z=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),W=C(z);P=l.number(b,m,W),z<1?this._frameId||(this._frameId=!0):R=!0}else P=m,R=!0;return this._active=!0,R&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!R,zoomDelta:P-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let c=l.ease;if(this._prevEase){const m=this._prevEase,b=(l.exported.now()-m.start)/m.duration,C=m.easing(b+.01)-m.easing(b),P=.27/Math.sqrt(C*C+1e-4)*.01,R=Math.sqrt(.0729-P*P);c=l.bezier(P,R,.25,1)}return this._prevEase={start:l.exported.now(),duration:r,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ge("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(l.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class zu{constructor(r,c){this._clickZoom=r,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bs{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,c){return r.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(r.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cd{constructor(){this._tap=new Pc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,c,m){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(r,c,m))}touchmove(r,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const b=c[0],C=b.y-this._swipePoint.y;return this._swipePoint=b,r.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(r,c,m)}touchend(r,c,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(r,c,m)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dc{constructor(r,c,m){this._el=r,this._mousePan=c,this._touchPan=m}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class hc{constructor(r,c,m){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class du{constructor(r,c,m,b){this._el=r,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Xs=f=>f.zoom||f.drag||f.pitch||f.rotate;class hu extends l.Event{}class Uu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,c){const m=l.sub([],c,r);this.radius=l.length(m[2]<0?l.div([],m,this.constants):[m[0],m[1],0])}projectRay(r){l.div(r,r,this.constants),l.normalize(r,r),l.mul$1(r,r,this.constants);const c=l.scale$2([],r,this.radius);if(c[2]>0){const m=l.scale$2([],[0,0,1],l.dot(c,[0,0,1])),b=l.scale$2([],l.normalize([],[c[0],c[1],0]),this.radius),C=l.add([],c,l.scale$2([],l.sub([],l.add([],b,m),c),2));c[0]=C[0],c[1]=C[1]}return c}}function aa(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Oa{constructor(r,c){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ri(r),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Uu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),l.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[l.window.document,"mousemove",{capture:!0}],[l.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[l.window,"blur",void 0]];for(const[b,C,P]of this._listeners)b.addEventListener(C,b===l.window.document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[r,c,m]of this._listeners)r.removeEventListener(c,r===l.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(r){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new Ic(c,r));const b=c.boxZoom=new Ac(c,r);this._add("boxZoom",b);const C=new Za,P=new bs;c.doubleClickZoom=new zu(P,C),this._add("tapZoom",C),this._add("clickZoom",P);const R=new Cd;this._add("tapDragZoom",R);const z=c.touchPitch=new rs(c);this._add("touchPitch",z);const W=new Al(r),q=new Go(r);c.dragRotate=new hc(r,W,q),this._add("mouseRotate",W,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]);const ae=new lc(r),fe=new Pl(c,r);c.dragPan=new dc(m,ae,fe),this._add("mousePan",ae),this._add("touchPan",fe,["touchZoom","touchRotate"]);const be=new Oc,we=new uc;c.touchZoomRotate=new du(m,we,be,R),this._add("touchRotate",be,["touchPan","touchZoom"]),this._add("touchZoom",we,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Wa(c));const xe=c.scrollZoom=new kc(c,this);this._add("scrollZoom",xe,["mousePan"]);const De=c.keyboard=new uu;this._add("keyboard",De);for(const le of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[le]&&c[le].enable(r[le])}_add(r,c,m){this._handlers.push({handlerName:r,handler:c,allowed:m}),this._handlersById[r]=c}stop(r){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,c,m){for(const b in r)if(b!==m&&(!c||c.indexOf(b)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const c=[];for(const m of r)this._el.contains(m.target)&&c.push(m);return c}handleEvent(r,c){this._updatingCamera=!0;const m="renderFrame"===r.type,b=m?void 0:r,C={needsRenderFrame:!1},P={},R={},z=r.touches?this._getMapTouches(r.touches):void 0,W=z?kn(this._el,z):m?void 0:Tn(this._el,r);for(const{handlerName:fe,handler:be,allowed:we}of this._handlers){if(!be.isEnabled())continue;let xe;this._blockedByActive(R,we,fe)?be.reset():be[c||r.type]&&(xe=be[c||r.type](r,W,z),this.mergeHandlerResult(C,P,xe,fe,b),xe&&xe.needsRenderFrame&&this._triggerRenderFrame()),(xe||be.isActive())&&(R[fe]=be)}const q={};for(const fe in this._previousActiveHandlers)R[fe]||(q[fe]=b);this._previousActiveHandlers=R,(Object.keys(q).length||aa(C))&&(this._changes.push([C,P,q]),this._triggerRenderFrame()),(Object.keys(R).length||aa(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ae}=C;ae&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ae(this._map))}mergeHandlerResult(r,c,m,b,C){if(!m)return;l.extend(r,m);const P={handlerName:b,originalEvent:m.originalEvent||C};void 0!==m.zoomDelta&&(c.zoom=P),void 0!==m.panDelta&&(c.drag=P),void 0!==m.pitchDelta&&(c.pitch=P),void 0!==m.bearingDelta&&(c.rotate=P)}_applyChanges(){const r={},c={},m={};for(const[b,C,P]of this._changes)b.panDelta&&(r.panDelta=(r.panDelta||new l.Point(0,0))._add(b.panDelta)),b.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(r.around=b.around),void 0!==b.aroundCoord&&(r.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(r.pinchAround=b.pinchAround),b.noInertia&&(r.noInertia=b.noInertia),l.extend(c,C),l.extend(m,P);this._updateMapTransform(r,c,m),this._changes=[]}_updateMapTransform(r,c,m){const b=this._map,C=b.transform,P=_e=>[_e.x,_e.y,_e.z];if((_e=>{const Ie=this._eventsInProgress.drag;return Ie&&!this._handlersById[Ie.handlerName].isActive()})()&&!aa(r)){const _e=C.zoom;C.cameraElevationReference="sea",C.recenterOnTerrain(),C.cameraElevationReference="ground",_e!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&b._stop(!0),!aa(r))return void this._fireEvents(c,m,!0);let{panDelta:R,zoomDelta:z,bearingDelta:W,pitchDelta:q,around:ae,aroundCoord:fe,pinchAround:be}=r;C._isCameraConstrained&&(z>0&&(z=0),C._isCameraConstrained=!1),void 0!==be&&(ae=be),(z||(_e=>c.drag&&!this._eventsInProgress.drag)())&&ae&&(this._dragOrigin=P(C.pointCoordinate3D(ae)),this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",b._stop(!0),ae=ae||b.transform.centerPoint,W&&(C.bearing+=W),q&&(C.pitch+=q),C._updateCameraState();const we=[0,0,0];if(R)if("mercator"===C.projection.name){const _e=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(ae).dir),Ie=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(ae.sub(R)).dir);we[0]=Ie[0]-_e[0],we[1]=Ie[1]-_e[1]}else{const _e=C.pointCoordinate(ae);if("globe"===C.projection.name){R=R.rotate(-C.angle);const Ie=C._pixelsPerMercatorPixel/C.worldSize;we[0]=-R.x*l.mercatorScale(l.latFromMercatorY(_e.y))*Ie,we[1]=-R.y*l.mercatorScale(C.center.lat)*Ie}else{const Ie=C.pointCoordinate(ae.sub(R));_e&&Ie&&(we[0]=Ie.x-_e.x,we[1]=Ie.y-_e.y)}}const xe=C.zoom,De=[0,0,0];if(z){const _e=P(fe||C.pointCoordinate3D(ae)),Ie={dir:l.normalize([],l.sub([],_e,C._camera.position))};if(Ie.dir[2]<0){const Pe=C.zoomDeltaToMovement(_e,z);l.scale$2(De,Ie.dir,Pe)}}const le=l.add(we,we,De);C._translateCameraConstrained(le),z&&Math.abs(C.zoom-xe)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(c,m,!0)}_fireEvents(r,c,m){const b=Xs(this._eventsInProgress),C=Xs(r),P={};for(const q in r){const{originalEvent:ae}=r[q];this._eventsInProgress[q]||(P[`${q}start`]=ae),this._eventsInProgress[q]=r[q]}!b&&C&&this._fireEvent("movestart",C.originalEvent);for(const q in P)this._fireEvent(q,P[q]);C&&this._fireEvent("move",C.originalEvent);for(const q in r){const{originalEvent:ae}=r[q];this._fireEvent(q,ae)}const R={};let z;for(const q in this._eventsInProgress){const{handlerName:ae,originalEvent:fe}=this._eventsInProgress[q];this._handlersById[ae].isActive()||(delete this._eventsInProgress[q],z=c[ae]||fe,R[`${q}end`]=z)}for(const q in R)this._fireEvent(q,R[q]);const W=Xs(this._eventsInProgress);if(m&&(b||C)&&!W){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ae=fe=>0!==fe&&-this._bearingSnap<fe&&fe<this._bearingSnap;q?(ae(q.bearing||this._map.getBearing())&&(q.bearing=0),this._map.easeTo(q,{originalEvent:z})):(this._map.fire(new l.Event("moveend",{originalEvent:z})),ae(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,c){this._map.fire(new l.Event(r,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new hu("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const wl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Lc extends l.Evented{constructor(r,c){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=!1!==c.respectPrefersReducedMotion,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,c){return this.jumpTo({center:r},c)}panBy(r,c,m){return r=l.Point.convert(r).mult(-1),this.panTo(this.transform.center,l.extend({offset:r},c),m)}panTo(r,c,m){return this.easeTo(l.extend({center:r},c),m)}getZoom(){return this.transform.zoom}setZoom(r,c){return this.jumpTo({zoom:r},c),this}zoomTo(r,c,m){return this.easeTo(l.extend({zoom:r},c),m)}zoomIn(r,c){return this.zoomTo(this.getZoom()+1,r,c),this}zoomOut(r,c){return this.zoomTo(this.getZoom()-1,r,c),this}getBearing(){return this.transform.bearing}setBearing(r,c){return this.jumpTo({bearing:r},c),this}getPadding(){return this.transform.padding}setPadding(r,c){return this.jumpTo({padding:r},c),this}rotateTo(r,c,m){return this.easeTo(l.extend({bearing:r},c),m)}resetNorth(r,c){return this.rotateTo(0,l.extend({duration:1e3},r),c),this}resetNorthPitch(r,c){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},r),c),this}snapToNorth(r,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,c):this}getPitch(){return this.transform.pitch}setPitch(r,c){return this.jumpTo({pitch:r},c),this}cameraForBounds(r,c){r=l.LngLatBounds.convert(r);const m=c&&c.bearing||0,b=c&&c.pitch||0,C=r.getNorthWest(),P=r.getSouthEast();return this._cameraForBounds(this.transform,C,P,m,b,c)}_extendCameraOptions(r){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=l.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const m=r.padding;r.padding={top:m,bottom:m,right:m,left:m}}return r.padding=l.extend(c,r.padding),r}_minimumAABBFrustumDistance(r,c){const m=c.max[0]-c.min[0],b=c.max[1]-c.min[1];return m/b>r.aspect?m/(2*Math.tan(.5*r.fovX)*r.aspect):b/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,c,m,b,C,P){const R=r.clone(),z=this._extendCameraOptions(P);R.bearing=b,R.pitch=C;const W=l.LngLat.convert(c),q=l.LngLat.convert(m),ae=.5*(W.lat+q.lat),fe=.5*(W.lng+q.lng),be=l.latLngToECEF(ae,fe),we=l.normalize([],be),xe=l.normalize([],l.cross([],we,[0,1,0])),De=l.cross([],xe,we),le=[xe[0],xe[1],xe[2],0,De[0],De[1],De[2],0,we[0],we[1],we[2],0,0,0,0,1],_e=[be,l.latLngToECEF(W.lat,W.lng),l.latLngToECEF(q.lat,W.lng),l.latLngToECEF(q.lat,q.lng),l.latLngToECEF(W.lat,q.lng),l.latLngToECEF(ae,W.lng),l.latLngToECEF(ae,q.lng),l.latLngToECEF(W.lat,fe),l.latLngToECEF(q.lat,fe)];let Ie=l.Aabb.fromPoints(_e.map(ln=>[l.dot(xe,ln),l.dot(De,ln),l.dot(we,ln)]));const Pe=l.transformMat4([],Ie.center,le);0===l.squaredLength(Pe)&&l.set(Pe,0,0,1),l.normalize(Pe,Pe),l.scale$2(Pe,Pe,l.GLOBE_RADIUS),R.center=l.ecefToLatLng(Pe);const Qe=R.getWorldToCameraMatrix(),tt=l.invert(new Float64Array(16),Qe);Ie=l.Aabb.applyTransform(Ie,l.multiply([],Qe,le)),l.transformMat4(Pe,Pe,Qe);const et=.5*(Ie.max[2]-Ie.min[2]),gt=this._minimumAABBFrustumDistance(R,Ie),st=l.scale$2([],[0,0,1],et),Mt=l.add(st,Pe,st),pn=gt+(0===R.pitch?0:l.distance(Pe,Mt)),Ct=R.globeCenterInViewSpace,Qt=l.sub([],Pe,[Ct[0],Ct[1],Ct[2]]);l.normalize(Qt,Qt),l.scale$2(Qt,Qt,pn);const kt=l.add([],Pe,Qt);l.transformMat4(kt,kt,tt);const mn=l.earthRadius/l.GLOBE_RADIUS,It=l.length(kt),Jt=l.mercatorZfromAltitude(Math.max(It*mn-l.earthRadius,Number.EPSILON),0),En=Math.min(R.zoomFromMercatorZAdjusted(Jt),z.maxZoom);return En>.5*(l.GLOBE_ZOOM_THRESHOLD_MIN+l.GLOBE_ZOOM_THRESHOLD_MAX)?(R.setProjection({name:"mercator"}),R.zoom=En,this._cameraForBounds(R,c,m,b,C,P)):{center:R.center,zoom:En,bearing:b,pitch:C}}queryTerrainElevation(r,c){const m=this.transform.elevation;return m?(c=l.extend({},{exaggerated:!0},c),m.getAtPoint(l.MercatorCoordinate.fromLngLat(r),null,c.exaggerated)):null}_cameraForBounds(r,c,m,b,C,P){if("globe"===r.projection.name)return this._cameraForBoundsOnGlobe(r,c,m,b,C,P);const R=r.clone(),z=this._extendCameraOptions(P),W=R.padding;R.bearing=b,R.pitch=C;const q=l.LngLat.convert(c),ae=l.LngLat.convert(m),fe=new l.LngLat(q.lng,ae.lat),be=new l.LngLat(ae.lng,q.lat),we=R.project(q),xe=R.project(ae),De=this.queryTerrainElevation(q),le=this.queryTerrainElevation(ae),_e=this.queryTerrainElevation(fe),Ie=this.queryTerrainElevation(be),Pe=[[we.x,we.y,Math.min(De||0,le||0,_e||0,Ie||0)],[xe.x,xe.y,Math.max(De||0,le||0,_e||0,Ie||0)]];let Qe=l.Aabb.fromPoints(Pe);const tt=R.getWorldToCameraMatrix(),et=l.invert(new Float64Array(16),tt);Qe=l.Aabb.applyTransform(Qe,tt);const gt=l.sub([],Qe.max,Qe.min),st=W.left||0,Mt=W.right||0,pn=W.bottom||0,Ct=W.top||0,{left:Qt,right:kt,top:mn,bottom:It}=z.padding,Jt=.5*(st+Mt),En=.5*(Ct+pn),ln=Math.min(R.scaleZoom(R.scale*Math.min((R.width-(st+Mt+Qt+kt))/gt[0],(R.height-(pn+Ct+It+mn))/gt[1])),z.maxZoom),Cn=R.scale/R.zoomScale(ln);Qe=new l.Aabb([Qe.min[0]-(Qt+Jt)*Cn,Qe.min[1]-(It+En)*Cn,Qe.min[2]],[Qe.max[0]+(kt+Jt)*Cn,Qe.max[1]+(mn+En)*Cn,Qe.max[2]]);const ai=.5*gt[2],Ai=this._minimumAABBFrustumDistance(R,Qe),Hn=[0,0,1,0];l.transformMat4$1(Hn,Hn,tt),l.normalize$2(Hn,Hn);const wi=l.scale$2([],Hn,Ai+ai),rr=l.add([],Qe.center,wi),er=("number"==typeof z.offset.x&&"number"==typeof z.offset.y?new l.Point(z.offset.x,z.offset.y):l.Point.convert(z.offset)).rotate(-l.degToRad(b));Qe.center[0]-=er.x*Cn,Qe.center[1]+=er.y*Cn,l.transformMat4(Qe.center,Qe.center,et),l.transformMat4(rr,rr,et);const Qn=[Qe.center[0],Qe.center[1],rr[2]*R.pixelsPerMeter];l.scale$2(Qn,Qn,1/R.worldSize);const yr=l.lngFromMercatorX(Qn[0]),or=l.latFromMercatorY(Qn[1]),Ir=Math.min(R._zoomFromMercatorZ(Qn[2]),z.maxZoom),$r=new l.LngLat(yr,or);return R.mercatorFromTransition&&Ir<.5*(l.GLOBE_ZOOM_THRESHOLD_MIN+l.GLOBE_ZOOM_THRESHOLD_MAX)?(R.setProjection({name:"globe"}),R.zoom=Ir,this._cameraForBounds(R,c,m,b,C,P)):{center:$r,zoom:Ir,bearing:b,pitch:C}}fitBounds(r,c,m){const b=this.cameraForBounds(r,c);return this._fitInternal(b,c,m)}fitScreenCoordinates(r,c,m,b,C){const P=l.Point.convert(r),R=l.Point.convert(c),z=new l.Point(Math.min(P.x,R.x),Math.min(P.y,R.y)),W=new l.Point(Math.max(P.x,R.x),Math.max(P.y,R.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(P,R))return this;const q=this.transform.pointLocation3D(z),ae=this.transform.pointLocation3D(W),fe=this.transform.pointLocation3D(new l.Point(z.x,W.y)),be=this.transform.pointLocation3D(new l.Point(W.x,z.y)),we=[Math.min(q.lng,ae.lng,fe.lng,be.lng),Math.min(q.lat,ae.lat,fe.lat,be.lat)],xe=[Math.max(q.lng,ae.lng,fe.lng,be.lng),Math.max(q.lat,ae.lat,fe.lat,be.lat)],De=b&&b.pitch?b.pitch:this.getPitch(),le=this._cameraForBounds(this.transform,we,xe,m,De,b);return this._fitInternal(le,b,C)}_fitInternal(r,c,m){return r?(delete(c=l.extend(r,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(r,c){this.stop();const m=r.preloadOnly?this.transform.clone():this.transform;let b=!1,C=!1,P=!1;return"zoom"in r&&m.zoom!==+r.zoom&&(b=!0,m.zoom=+r.zoom),void 0!==r.center&&(m.center=l.LngLat.convert(r.center)),"bearing"in r&&m.bearing!==+r.bearing&&(C=!0,m.bearing=+r.bearing),"pitch"in r&&m.pitch!==+r.pitch&&(P=!0,m.pitch=+r.pitch),null==r.padding||m.isPaddingEqual(r.padding)||(m.padding=r.padding),r.preloadOnly?(this._preloadTiles(m),this):(this.fire(new l.Event("movestart",c)).fire(new l.Event("move",c)),b&&this.fire(new l.Event("zoomstart",c)).fire(new l.Event("zoom",c)).fire(new l.Event("zoomend",c)),C&&this.fire(new l.Event("rotatestart",c)).fire(new l.Event("rotate",c)).fire(new l.Event("rotateend",c)),P&&this.fire(new l.Event("pitchstart",c)).fire(new l.Event("pitch",c)).fire(new l.Event("pitchend",c)),this.fire(new l.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||l.warnOnce(wl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return l.warnOnce(wl),this;this.stop();const b=m.zoom,C=m.pitch,P=m.bearing;m.setFreeCameraOptions(r);const R=b!==m.zoom,z=C!==m.pitch,W=P!==m.bearing;return this.fire(new l.Event("movestart",c)).fire(new l.Event("move",c)),R&&this.fire(new l.Event("zoomstart",c)).fire(new l.Event("zoom",c)).fire(new l.Event("zoomend",c)),W&&this.fire(new l.Event("rotatestart",c)).fire(new l.Event("rotate",c)).fire(new l.Event("rotateend",c)),z&&this.fire(new l.Event("pitchstart",c)).fire(new l.Event("pitch",c)).fire(new l.Event("pitchend",c)),this.fire(new l.Event("moveend",c)),this}easeTo(r,c){this._stop(!1,r.easeId),(!1===(r=l.extend({offset:[0,0],duration:500,easing:l.ease},r)).animate||this._prefersReducedMotion(r))&&(r.duration=0);const m=this.transform,b=this.getZoom(),C=this.getBearing(),P=this.getPitch(),R=this.getPadding(),z="zoom"in r?+r.zoom:b,W="bearing"in r?this._normalizeBearing(r.bearing,C):C,q="pitch"in r?+r.pitch:P,ae="padding"in r?r.padding:m.padding,fe=l.Point.convert(r.offset);let be,we,xe;if("globe"===m.projection.name){const st=l.MercatorCoordinate.fromLngLat(m.center),Mt=fe.rotate(-m.angle);st.x+=Mt.x/m.worldSize,st.y+=Mt.y/m.worldSize;const pn=st.toLngLat(),Ct=l.LngLat.convert(r.center||pn);this._normalizeCenter(Ct),be=m.centerPoint.add(Mt),we=new l.Point(st.x,st.y).mult(m.worldSize),xe=new l.Point(l.mercatorXfromLng(Ct.lng),l.mercatorYfromLat(Ct.lat)).mult(m.worldSize).sub(we)}else{be=m.centerPoint.add(fe);const st=m.pointLocation(be),Mt=l.LngLat.convert(r.center||st);this._normalizeCenter(Mt),we=m.project(st),xe=m.project(Mt).sub(we)}const De=m.zoomScale(z-b);let le,_e;r.around&&(le=l.LngLat.convert(r.around),_e=m.locationPoint(le));const Ie=this._zooming||z!==b,Pe=this._rotating||C!==W,Qe=this._pitching||q!==P,tt=!m.isPaddingEqual(ae),et=st=>Mt=>{if(Ie&&(st.zoom=l.number(b,z,Mt)),Pe&&(st.bearing=l.number(C,W,Mt)),Qe&&(st.pitch=l.number(P,q,Mt)),tt&&(st.interpolatePadding(R,ae,Mt),be=st.centerPoint.add(fe)),le)st.setLocationAtPoint(le,_e);else{const pn=st.zoomScale(st.zoom-b),Ct=z>b?Math.min(2,De):Math.max(.5,De),Qt=Math.pow(Ct,1-Mt),kt=st.unproject(we.add(xe.mult(Mt*Qt)).mult(pn));st.setLocationAtPoint(st.renderWorldCopies?kt.wrap():kt,be)}return r.preloadOnly||this._fireMoveEvents(c),st};if(r.preloadOnly){const st=this._emulate(et,r.duration,m);return this._preloadTiles(st),this}const gt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ie,this._rotating=Pe,this._pitching=Qe,this._padding=tt,this._easeId=r.easeId,this._prepareEase(c,r.noMoveStart,gt),this._ease(et(m),st=>{m.recenterOnTerrain(),this._afterEase(c,st)},r),this}_prepareEase(r,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||m.moving||this.fire(new l.Event("movestart",r)),this._zooming&&!m.zooming&&this.fire(new l.Event("zoomstart",r)),this._rotating&&!m.rotating&&this.fire(new l.Event("rotatestart",r)),this._pitching&&!m.pitching&&this.fire(new l.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new l.Event("move",r)),this._zooming&&this.fire(new l.Event("zoom",r)),this._rotating&&this.fire(new l.Event("rotate",r)),this._pitching&&this.fire(new l.Event("pitch",r))}_afterEase(r,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,b=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new l.Event("zoomend",r)),b&&this.fire(new l.Event("rotateend",r)),C&&this.fire(new l.Event("pitchend",r)),this.fire(new l.Event("moveend",r))}flyTo(r,c){if(this._prefersReducedMotion(r)){const ln=l.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ln,c)}this.stop(),r=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},r);const m=this.transform,b=this.getZoom(),C=this.getBearing(),P=this.getPitch(),R=this.getPadding(),z="zoom"in r?l.clamp(+r.zoom,m.minZoom,m.maxZoom):b,W="bearing"in r?this._normalizeBearing(r.bearing,C):C,q="pitch"in r?+r.pitch:P,ae="padding"in r?r.padding:m.padding,fe=m.zoomScale(z-b),be=l.Point.convert(r.offset);let we=m.centerPoint.add(be);const xe=m.pointLocation(we),De=l.LngLat.convert(r.center||xe);this._normalizeCenter(De);const le=m.project(xe),_e=m.project(De).sub(le);let Ie=r.curve;const Pe=Math.max(m.width,m.height),Qe=Pe/fe,tt=_e.mag();if("minZoom"in r){const ln=l.clamp(Math.min(r.minZoom,b,z),m.minZoom,m.maxZoom),Cn=Pe/m.zoomScale(ln-b);Ie=Math.sqrt(Cn/tt*2)}const et=Ie*Ie;function gt(ln){const Cn=(Qe*Qe-Pe*Pe+(ln?-1:1)*et*et*tt*tt)/(2*(ln?Qe:Pe)*et*tt);return Math.log(Math.sqrt(Cn*Cn+1)-Cn)}function st(ln){return(Math.exp(ln)-Math.exp(-ln))/2}function Mt(ln){return(Math.exp(ln)+Math.exp(-ln))/2}const pn=gt(0);let Ct=function(ln){return Mt(pn)/Mt(pn+Ie*ln)},Qt=function(ln){return Pe*((Mt(pn)*(st(Cn=pn+Ie*ln)/Mt(Cn))-st(pn))/et)/tt;var Cn},kt=(gt(1)-pn)/Ie;if(Math.abs(tt)<1e-6||!isFinite(kt)){if(Math.abs(Pe-Qe)<1e-6)return this.easeTo(r,c);const ln=Qe<Pe?-1:1;kt=Math.abs(Math.log(Qe/Pe))/Ie,Qt=function(){return 0},Ct=function(Cn){return Math.exp(ln*Ie*Cn)}}r.duration="duration"in r?+r.duration:1e3*kt/("screenSpeed"in r?+r.screenSpeed/Ie:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const mn=C!==W,It=q!==P,Jt=!m.isPaddingEqual(ae),En=ln=>Cn=>{const ai=Cn*kt,Ai=1/Ct(ai);ln.zoom=1===Cn?z:b+ln.scaleZoom(Ai),mn&&(ln.bearing=l.number(C,W,Cn)),It&&(ln.pitch=l.number(P,q,Cn)),Jt&&(ln.interpolatePadding(R,ae,Cn),we=ln.centerPoint.add(be));const Hn=1===Cn?De:ln.unproject(le.add(_e.mult(Qt(ai))).mult(Ai));return ln.setLocationAtPoint(ln.renderWorldCopies?Hn.wrap():Hn,we),ln._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(c),ln};if(r.preloadOnly){const ln=this._emulate(En,r.duration,m);return this._preloadTiles(ln),this}return this._zooming=!0,this._rotating=mn,this._pitching=It,this._padding=Jt,this._prepareEase(c,!1),this._ease(En(m),()=>this._afterEase(c),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,c)}if(!r){const m=this.handlers;m&&m.stop(!1)}return this}_ease(r,c,m){!1===m.animate||0===m.duration?(r(1),c()):(this._easeStart=l.exported.now(),this._easeOptions=m,this._onEaseFrame=r,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,c){r=l.wrap(r,-180,180);const m=Math.abs(r-c);return Math.abs(r-360-c)<m&&(r-=360),Math.abs(r+360-c)<m&&(r+=360),r}_normalizeCenter(r){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const m=r.lng-c.center.lng;r.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&l.exported.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,c,m){const b=Math.ceil(15*c/1e3),C=[],P=r(m.clone());for(let R=0;R<=b;R++){const z=P(R/b);C.push(z.clone())}return C}}class Wn{constructor(r={}){this.options=r,l.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const c=this.options&&this.options.compact;return this._map=r,this._container=Ge("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ge("button","mapboxgl-ctrl-attrib-button",this._container),Ge("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ge("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,c){const m=this._map._getUIString(`AttributionControl.${c}`);r.setAttribute("aria-label",m),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.config.ACCESS_TOKEN}];if(r){const m=c.reduce((b,C,P)=>(C.value&&(b+=`${C.key}=${C.value}${P<c.length-1?"&":""}`),b),"?");r.href=`${l.config.FEEDBACK_URL}/${m}#${Ys(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const c=this._map.style._sourceCaches;for(const b in c){const C=c[b];if(C.used){const P=C.getSource();P.attribution&&r.indexOf(P.attribution)<0&&r.push(P.attribution)}}r.sort((b,C)=>b.length-C.length),r=r.filter((b,C)=>{for(let P=C+1;P<r.length;P++)if(r[P].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const m=r.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,r.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fc{constructor(){l.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=Ge("div","mapboxgl-ctrl");const c=Ge("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const c in r){const m=r[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class L{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const c=++this._id;return this._queue.push({callback:r,id:c,cancelled:!1}),c}remove(r){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const b of m)if(b.id===r)return void(b.cancelled=!0)}run(r=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function B(f,r,c){if(f=new l.LngLat(f.lng,f.lat),r){const m=new l.LngLat(f.lng-360,f.lat),b=new l.LngLat(f.lng+360,f.lat),C=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),P=c.locationPoint(f).distSqr(r),R=r.x<0||r.y<0||r.x>c.width||r.y>c.height;c.locationPoint(m).distSqr(r)<P&&(R||Math.abs(m.lng-c.center.lng)<C)?f=m:c.locationPoint(b).distSqr(r)<P&&(R||Math.abs(b.lng-c.center.lng)<C)&&(f=b)}for(;Math.abs(f.lng-c.center.lng)>180;){const m=c.locationPoint(f);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const $={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class O extends l.Evented{constructor(r,c){if(super(),(r instanceof l.window.HTMLElement||c)&&(r=l.extend({element:r},c)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=l.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ge("div");const b=41,C=27,P=Xe("svg",{display:"block",height:b*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${b}`},this._element),R=Xe("radialGradient",{id:"shadowGradient"},Xe("defs",{},P));Xe("stop",{offset:"10%","stop-opacity":.4},R),Xe("stop",{offset:"100%","stop-opacity":.05},R),Xe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},P),Xe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},P),Xe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},P),Xe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},P),this._offset=l.Point.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const m=this._element.classList;for(const b in $)m.remove(`mapboxgl-marker-anchor-${b}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=l.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const c=r.code,m=r.charCode||r.keyCode;"Space"!==c&&"Enter"!==c&&32!==m&&13!==m||this.togglePopup()}_onMapClick(r){const c=r.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,c=this._pos;if(!r||!c)return!1;const m=r.unproject(c),b=r.getFreeCameraOptions();if(!b.position)return!1;const C=b.position.toLngLat();return C.distanceTo(m)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const c=this._pos;if(!c||c.x<0||c.x>r.transform.width||c.y<0||c.y>r.transform.height)return void this._clearFadeTimer();const m=r.unproject(c);let b;r._showingGlobe()&&l.isLngLatBehindGlobe(r.transform,this._lngLat)?b=0:(b=1-r._queryFogOpacity(m),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${$[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${c.x}px,${c.y}px)\n        `}_calculateXYTransform(){const r=this._pos,c=this._map,m=this.getPitchAlignment();if(!c||!r||"map"!==m)return"";if(!c._showingGlobe()){const z=c.getPitch();return z?`rotateX(${z}deg)`:""}const b=l.radToDeg(l.globeTiltAtLngLat(c.transform,this._lngLat)),C=r.sub(l.globeCenterToScreenPoint(c.transform)),P=Math.abs(C.x)+Math.abs(C.y);if(0===P)return"";const R=b/P;return`rotateX(${-C.y*R}deg) rotateY(${C.x*R}deg)`}_calculateZTransform(){const r=this._pos,c=this._map;if(!c||!r)return"";let m=0;const b=this.getRotationAlignment();if("map"===b)if(c._showingGlobe()){const C=c.project(new l.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),P=c.project(new l.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(C);m=l.radToDeg(Math.atan2(P.y,P.x))-90}else m=-c.getBearing();else if("horizon"===b){const C=l.smoothstep(4,6,c.getZoom()),P=l.globeCenterToScreenPoint(c.transform);P.y+=C*c.transform.height;const R=r.sub(P),z=l.radToDeg(Math.atan2(R.y,R.x));m=(z>90?z-270:z+90)*(1-C)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(r){l.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=B(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),!0===r?this._updateFrameId=l.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=l.Point.convert(r),this._update(),this}_onMove(r){const c=this._map;if(!c)return;const m=this._pointerdownPos,b=this._positionDelta;if(m&&b){if(!this._isDragging){const C=this._clickTolerance||c._clickTolerance;if(r.point.dist(m)<C)return;this._isDragging=!0}this._pos=r.point.sub(b),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(r){const c=this._map,m=this._pos;c&&m&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(m),this._pointerdownPos=r.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const c=this._map;return c&&(r?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const X={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},pe=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Te(f=new l.Point(0,0),r="bottom"){if("number"==typeof f){const c=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(r){case"top":return new l.Point(0,f);case"top-left":return new l.Point(c,c);case"top-right":return new l.Point(-c,c);case"bottom":return new l.Point(0,-f);case"bottom-left":return new l.Point(c,-c);case"bottom-right":return new l.Point(-c,-c);case"left":return new l.Point(f,0);case"right":return new l.Point(-f,0)}return new l.Point(0,0)}return f instanceof l.Point||Array.isArray(f)?l.Point.convert(f):l.Point.convert(f[r]||[0,0])}class Et{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const c=l.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,c,m){this._start=this.getValue(c),this._end=r,this._startTime=c,this._endTime=c+m}}const Mn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},jt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},ui={showCompass:!0,showZoom:!0,visualizePitch:!1};class Yi{constructor(r,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Al({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,m&&(this.mousePitch=new Go({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(r,c){this.mouseRotate.mousedown(r,c),this.mousePitch&&this.mousePitch.mousedown(r,c),zt()}move(r,c){const m=this.map,b=this.mouseRotate.mousemoveWindow(r,c),C=b&&b.bearingDelta;if(C&&m.setBearing(m.getBearing()+C),this.mousePitch){const P=this.mousePitch.mousemoveWindow(r,c),R=P&&P.pitchDelta;R&&m.setPitch(m.getPitch()+R)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){dn(),l.window.removeEventListener("mousemove",this.mousemove),l.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(l.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Tn(this.element,r)),l.window.addEventListener("mousemove",this.mousemove),l.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Tn(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=kn(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=kn(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Rr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Tr={maxWidth:100,unit:"metric"},xs={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Js={version:l.version,supported:Ke,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends Lc{constructor(f){if(l.LivePerformanceUtils.mark(l.PerformanceMarkers.create),null!=(f=l.extend({},jt,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&l.isSafariWithAntialiasingBug(l.window)&&(f.antialias=!1,l.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new As(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._useWebGL2=f.useWebGL2,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new L,this._domRenderTaskQueue=new L,this._controls=[],this._markers=[],this._popups=[],this._mapId=l.uniqueId(),this._locale=l.extend({},Mn,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Et(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new l.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=l.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof l.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&l.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==l.window&&(l.window.addEventListener("online",this._onWindowOnline,!1),l.window.addEventListener("resize",this._onWindowResize,!1),l.window.addEventListener("orientationchange",this._onWindowResize,!1),l.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Oa(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new Lo("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,l.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Wn({customAttribution:f.customAttribution})),this._logoControl=new Fc,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new l.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new l.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(f,r){if(void 0===r&&(r=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const m=this._controlPositions[r];return-1!==r.indexOf("bottom")?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(f);return r>-1&&this._controls.splice(r,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new l.Event("movestart",f)).fire(new l.Event("move",f)),this.fire(new l.Event("resize",f)),r&&this.fire(new l.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(l.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return"auto"===f?l.window.navigator.language:Array.isArray(f)?0===f.length?void 0:f.map(r=>"auto"===r?l.window.navigator.language:r):f}setLanguage(f){const r=this._parseLanguage(f);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(f){return this._lazyInitEmptyStyle(),f?"string"==typeof f&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const f=this.transform,r=f.projection.name;let c;"globe"===r&&f.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX?(f.setMercatorFromTransition(),c=!0):"mercator"===r&&f.zoom<l.GLOBE_ZOOM_THRESHOLD_MAX&&(f.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,r){return this._updateProjection(f||r||{name:"mercator"})}_updateProjection(f){let r;if(r="globe"===f.name&&this.transform.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(f){return this.transform.locationPoint3D(l.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(l.Point.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,r,c){if("mouseenter"===f||"mouseover"===f){let m=!1;const b=P=>{const R=r.filter(W=>this.getLayer(W)),z=R.length?this.queryRenderedFeatures(P.point,{layers:R}):[];z.length?m||(m=!0,c.call(this,new Xo(f,this,P.originalEvent,{features:z}))):m=!1},C=()=>{m=!1};return{layers:new Set(r),listener:c,delegates:{mousemove:b,mouseout:C}}}if("mouseleave"===f||"mouseout"===f){let m=!1;const b=P=>{const R=r.filter(z=>this.getLayer(z));(R.length?this.queryRenderedFeatures(P.point,{layers:R}):[]).length?m=!0:m&&(m=!1,c.call(this,new Xo(f,this,P.originalEvent)))},C=P=>{m&&(m=!1,c.call(this,new Xo(f,this,P.originalEvent)))};return{layers:new Set(r),listener:c,delegates:{mousemove:b,mouseout:C}}}{const m=b=>{const C=r.filter(R=>this.getLayer(R)),P=C.length?this.queryRenderedFeatures(b.point,{layers:C}):[];P.length&&(b.features=P,c.call(this,b),delete b.features)};return{layers:new Set(r),listener:c,delegates:{[f]:m}}}}on(f,r,c){if(void 0===c)return super.on(f,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(f,r,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(m);for(const b in m.delegates)this.on(b,m.delegates[b]);return this}once(f,r,c){if(void 0===c)return super.once(f,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(f,r,c);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(f,r,c){if(void 0===c)return super.off(f,r);r=new Set(Array.isArray(r)?r:[r]);const m=(C,P)=>{if(C.size!==P.size)return!1;for(const R of C)if(!P.has(R))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[f]:void 0;return b&&(C=>{for(let P=0;P<C.length;P++){const R=C[P];if(R.listener===c&&m(R.layers,r)){for(const z in R.delegates)this.off(z,R.delegates[z]);return C.splice(P,1),this}}})(b),this}queryRenderedFeatures(f,r){return this.style?(void 0!==r||void 0===f||f instanceof l.Point||Array.isArray(f)||(r=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(f,r){return this.style.querySourceFeatures(f,r)}isPointOnSurface(f){const{name:r}=this.transform.projection;return"globe"!==r&&"mercator"!==r&&l.warnOnce(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(l.Point.convert(f))}setStyle(f,r){return!1!==(r=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(f,r))}_getUIString(f){const r=this._locale[f];if(null==r)throw new Error(`Missing UI string '${f}'`);return r}_updateStyle(f,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new bi(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new bi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,r){if("string"==typeof f){const c=this._requestManager.normalizeStyleURL(f),m=this._requestManager.transformRequest(c,l.ResourceType.Style);l.getJSON(m,(b,C)=>{b?this.fire(new l.ErrorEvent(b)):C&&this._updateDiff(C,r)})}else"object"==typeof f&&this._updateDiff(f,r)}_updateDiff(f,r){try{this.style.setState(f)&&this._update(!0)}catch(c){l.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(f,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(l.warnOnce("There is no style added to the map."),!1)}addSource(f,r){return this._lazyInitEmptyStyle(),this.style.addSource(f,r),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const r in f){const c=f[r]._tiles;for(const m in c){const b=c[m];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(f,r,c){this._lazyInitEmptyStyle(),this.style.addSourceType(f,r,c)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,r,{pixelRatio:c=1,sdf:m=!1,stretchX:b,stretchY:C,content:P}={}){if(this._lazyInitEmptyStyle(),r instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&r instanceof l.window.ImageBitmap){const{width:R,height:z,data:W}=l.exported.getImageData(r);this.style.addImage(f,{data:new l.RGBAImage({width:R,height:z},W),pixelRatio:c,stretchX:b,stretchY:C,content:P,sdf:m,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:R,height:z}=r,W=r;this.style.addImage(f,{data:new l.RGBAImage({width:R,height:z},new Uint8Array(W.data)),pixelRatio:c,stretchX:b,stretchY:C,content:P,sdf:m,version:0,userImage:W}),W.onAdd&&W.onAdd(this,f)}}updateImage(f,r){const c=this.style.getImage(f);if(!c)return void this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=r instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&r instanceof l.window.ImageBitmap?l.exported.getImageData(r):r,{width:b,height:C}=m;void 0!==b&&void 0!==C?b===c.data.width&&C===c.data.height?(c.data.replace(m.data,!(r instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&r instanceof l.window.ImageBitmap)),this.style.updateImage(f,c)):this.fire(new l.ErrorEvent(new Error(`The width and height of the updated image (${b}, ${C})\n                must be that same as the previous version of the image\n                (${c.data.width}, ${c.data.height})`))):this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,r){l.getImage(this._requestManager.transformRequest(f,l.ResourceType.Image),(c,m)=>{r(c,m instanceof l.window.HTMLImageElement?l.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(f,r){return this._lazyInitEmptyStyle(),this.style.addLayer(f,r),this._update(!0)}moveLayer(f,r){return this.style.moveLayer(f,r),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,r,c){return this.style.setLayerZoomRange(f,r,c),this._update(!0)}setFilter(f,r,c={}){return this.style.setFilter(f,r,c),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,r,c,m={}){return this.style.setPaintProperty(f,r,c,m),this._update(!0)}getPaintProperty(f,r){return this.style.getPaintProperty(f,r)}setLayoutProperty(f,r,c,m={}){return this.style.setLayoutProperty(f,r,c,m),this._update(!0)}getLayoutProperty(f,r){return this.style.getLayoutProperty(f,r)}setLight(f,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(l.LngLat.convert(f),this.transform):0}setFeatureState(f,r){return this.style.setFeatureState(f,r),this._update()}removeFeatureState(f,r){return this.style.removeFeatureState(f,r),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let c,m,b,C=this._container;for(;C&&(!m||!b);){const P=l.window.getComputedStyle(C).transform;P&&"none"!==P&&(c=P.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&"0"!==c[0]&&"1"!==c[0]&&(m=c[0]),c[3]&&"0"!==c[3]&&"1"!==c[3]&&(b=c[3])),C=C.parentElement}this._containerWidth=m?Math.abs(f/m):f,this._containerHeight=b?Math.abs(r/b):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==l.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&l.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ge("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=Ge("div","mapboxgl-canvas-container",f);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=Ge("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=Ge("div","mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{m[b]=Ge("div",`mapboxgl-ctrl-${b}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,r){const c=l.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(r),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${r}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const r=this._markers.indexOf(f);-1!==r&&this._markers.splice(r,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const r=this._popups.indexOf(f);-1!==r&&this._popups.splice(r,1)}_setupPainter(){const f=l.extend({},Ke.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",f),c=r||this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);c?(this._useWebGL2&&!r&&l.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),l.storeAuthState(c,!0),this.painter=new J(c,this.transform,!!r),this.on("data",m=>{"source"===m.dataType&&this.painter.setTileLoadedFlag(!0)}),l.exported$1.testSupport(c)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let r;const c=this.painter.context.extTimerQuery,m=l.exported.now();if(this.listens("gpu-timing-frame")&&(r=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],l.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],l.window.performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,z=this.transform.pitch,W=l.exported.now(),q=new l.EvaluationParameters(R,{now:W,fadeDuration:b,pitch:z,transition:this.style.getTransition()});this.style.update(q)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const R=l.exported.now()-m;c.endQueryEXT(c.TIME_ELAPSED_EXT,r),setTimeout(()=>{const z=c.getQueryObjectEXT(r,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(r),this.fire(new l.Event("gpu-timing-frame",{cpuTime:R,gpuTime:z})),l.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:z}})},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(R);this.fire(new l.Event("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(R);this.fire(new l.Event("gpu-timing-deferred-render",{gpuTime:z}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(P||this._repaint)this.triggerRepaint();else{const R=!this.isMoving()&&this.loaded();if(R&&(C=this._updateAverageElevation(m,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new l.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new l.Event("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,l.LivePerformanceUtils.mark(l.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&l.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const r of this._markers)f&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!f||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(f,r=!1){const c=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((r||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const m=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),C=!1;this.transform.elevation&&(C=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=f;const P=Math.abs(m-b);if(P>1){if(this._isInitialLoad||C)return this._averageElevation.jumpTo(b),c(b);this._averageElevation.easeTo(b,f,300)}else if(P>1e-4)return this._averageElevation.jumpTo(b),c(b)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){l.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===l.AUTH_ERR_MSG||401===f.status)){const r=this.painter.context.gl;l.storeAuthState(r,!1),this._logoControl instanceof Fc&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new l.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),l.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function b(C){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,C,0);const P=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,P),P}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(b(f),r.canvasCopies.map(b),r.timeStamps)}_canvasPixelComparison(f,r,c){let m=c[1]-c[0];const b=f.length/4;for(let C=0;C<r.length;C++){const P=r[C];let R=0;for(let z=0;z<P.length;z+=4)P[z]===f[z]&&P[z+1]===f[z+1]&&P[z+2]===f[z+2]&&P[z+3]===f[z+3]&&(R+=1);m+=(c[C+2]-c[C+1])*(1-R/b)}return m}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==l.window&&(l.window.removeEventListener("resize",this._onWindowResize,!1),l.window.removeEventListener("orientationchange",this._onWindowResize,!1),l.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.removeEventListener("online",this._onWindowOnline,!1),l.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),l.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=l.exported.frame(r=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(r)}))}_preloadTiles(f){const r=this.style?Object.values(this.style._sourceCaches):[];return l.asyncAll(r,(c,m)=>c._preloadTiles(f,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){"hidden"===l.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,r){l.setCacheLimits(f,r)}get version(){return l.version}},NavigationControl:class{constructor(f){this.options=l.extend({},ui,f),this._container=Ge("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),Ge("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),Ge("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:r}):c.resetNorth({},{originalEvent:r}))}),this._compassIcon=Ge("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const r=f.getZoom(),c=r===f.getMaxZoom(),m=r===f.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yi(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,r){const c=Ge("button",f,this._container);return c.type="button",c.addEventListener("click",r),c}_setButtonTitle(f,r){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${r}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends l.Evented{constructor(f){super(),this.options=l.extend({geolocation:l.window.navigator.geolocation},Rr,f),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=vs(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=Ge("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const r=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,f(c)};void 0!==this._supportsGeolocation?f(this._supportsGeolocation):void 0!==l.window.navigator.permissions?l.window.navigator.permissions.query({name:"geolocation"}).then(c=>r("denied"!==c.state)).catch(()=>r()):r()}_isOutOfMapMaxBounds(f){const r=this._map.getMaxBounds(),c=f.coords;return!!r&&(c.longitude<r.getWest()||c.longitude>r.getEast()||c.latitude<r.getSouth()||c.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",f)),this._finish()}}_updateCamera(f){const r=new l.LngLat(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,m=this._map.getBearing(),b=l.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(c),b,{geolocateSource:!0})}_updateMarker(f){if(f){const r=new l.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,r=l.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,c=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Ge("button","mapboxgl-ctrl-geolocate",this._container),Ge("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===f){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ge("div","mapboxgl-user-location"),this._dotElement.appendChild(Ge("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ge("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new O({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ge("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new O({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{l.window.addEventListener("ondeviceorientationabsolute"in l.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==l.window.DeviceMotionEvent&&"function"==typeof l.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),l.window.removeEventListener("deviceorientation",this._onDeviceOrientation),l.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Wn,ScaleControl:class{constructor(f){this.options=l.extend({},Tr,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),l.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,r=this._map,c=r._containerHeight/2,m=r._containerWidth/2-f/2,b=r.unproject([m,c]),C=r.unproject([m+f,c]),P=b.distanceTo(C);if("imperial"===this.options.unit){const R=3.2808*P;R>5280?this._setScale(f,R/5280,"mile"):this._setScale(f,R,"foot")}else"nautical"===this.options.unit?this._setScale(f,P/1852,"nautical-mile"):P>=1e3?this._setScale(f,P/1e3,"kilometer"):this._setScale(f,P,"meter")}_setScale(f,r,c){this._map._requestDomTask(()=>{const m=function(C){const P=Math.pow(10,`${Math.floor(C)}`.length-1);let R=C/P;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(z){const W=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*W)/W}(R),P*R}(r),b=m/r;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==c?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(m):`${m}&nbsp;${xs[c]}`,this._container.style.width=f*b+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=Ge("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof l.window.HTMLElement?this._container=f.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in l.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in l.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ge("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,l.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!l.window.document.fullscreenEnabled&&!l.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Ge("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ge("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),l.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(l.window.document.fullscreenElement||l.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?l.window.document.exitFullscreen?l.window.document.exitFullscreen():l.window.document.webkitCancelFullScreen&&l.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends l.Evented{constructor(f){super(),this.options=l.extend(Object.create(X),f),l.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=l.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(l.window.document.createTextNode(f))}setHTML(f){const r=l.window.document.createDocumentFragment(),c=l.window.document.createElement("body");let m;for(c.innerHTML=f;m=c.firstChild,m;)r.appendChild(m);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=Ge("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(f),this.options.closeButton){const c=this._closeButton=Ge("button","mapboxgl-popup-close-button",r);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let r;return this._classList.delete(f)?r=!1:(this._classList.add(f),r=!0),this._updateClassList(),r}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const r=this._map,c=this._container,m=this._pos;if(!r||!c||!m)return"bottom";const b=c.offsetWidth,C=c.offsetHeight,P=m.x<b/2,R=m.x>r.transform.width-b/2;if(m.y+f<C)return P?"top-left":R?"top-right":"top";if(m.y>r.transform.height-C){if(P)return"bottom-left";if(R)return"bottom-right"}return P?"left":R?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),f.className=r.join(" ")}_update(f){const r=this._map,c=this._content;if(!r||!this._lngLat&&!this._trackPointer||!c)return;let m=this._container;if(m||(m=this._container=Ge("div","mapboxgl-popup",r.getContainer()),this._tip=Ge("div","mapboxgl-popup-tip",m),m.appendChild(c)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=B(this._lngLat,this._pos,r.transform)),!this._trackPointer||f){const b=this._pos=this._trackPointer&&f?f:r.project(this._lngLat),C=Te(this.options.offset),P=this._anchor=this._getAnchor(C.y),R=Te(this.options.offset,P),z=b.add(R).round();r._requestDomTask(()=>{this._container&&P&&(this._container.style.transform=`${$[P]} translate(${z.x}px,${z.y}px)`)})}if(!this._marker&&r._showingGlobe()){const b=l.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(pe);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:O,Style:bi,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.Point,MercatorCoordinate:l.MercatorCoordinate,FreeCameraOptions:Wi,Evented:l.Evented,config:l.config,prewarm:function(){Be().acquire(Cr)},clearPrewarmedResources:function(){const f=lt;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(Cr),lt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return l.config.ACCESS_TOKEN},set accessToken(f){l.config.ACCESS_TOKEN=f},get baseApiUrl(){return l.config.API_URL},set baseApiUrl(f){l.config.API_URL=f},get workerCount(){return ur.workerCount},set workerCount(f){ur.workerCount=f},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){l.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){l.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:l.exported.setNow,restoreNow:l.exported.restoreNow};return Js}),S}()},5619:(ut,Ue,re)=>{"use strict";re.d(Ue,{X:()=>Re});var S=re(8645);class Re extends S.x{constructor(l){super(),this._value=l}get value(){return this.getValue()}_subscribe(l){const ge=super._subscribe(l);return!ge.closed&&l.next(this._value),ge}getValue(){const{hasError:l,thrownError:ge,_value:Ke}=this;if(l)throw ge;return this._throwIfClosed(),Ke}next(l){super.next(this._value=l)}}},5592:(ut,Ue,re)=>{"use strict";re.d(Ue,{y:()=>Ye});var S=re(305),Re=re(7394),K=re(4850),l=re(8407),ge=re(2653),Ke=re(4674),nt=re(1441);let Ye=(()=>{class ht{constructor(zt){zt&&(this._subscribe=zt)}lift(zt){const dn=new ht;return dn.source=this,dn.operator=zt,dn}subscribe(zt,dn,St){const Bn=function at(ht){return ht&&ht instanceof S.Lv||function Xe(ht){return ht&&(0,Ke.m)(ht.next)&&(0,Ke.m)(ht.error)&&(0,Ke.m)(ht.complete)}(ht)&&(0,Re.Nn)(ht)}(zt)?zt:new S.Hp(zt,dn,St);return(0,nt.x)(()=>{const{operator:Tn,source:kn}=this;Bn.add(Tn?Tn.call(Bn,kn):kn?this._subscribe(Bn):this._trySubscribe(Bn))}),Bn}_trySubscribe(zt){try{return this._subscribe(zt)}catch(dn){zt.error(dn)}}forEach(zt,dn){return new(dn=Ge(dn))((St,Bn)=>{const Tn=new S.Hp({next:kn=>{try{zt(kn)}catch(Dn){Bn(Dn),Tn.unsubscribe()}},error:Bn,complete:St});this.subscribe(Tn)})}_subscribe(zt){var dn;return null===(dn=this.source)||void 0===dn?void 0:dn.subscribe(zt)}[K.L](){return this}pipe(...zt){return(0,l.U)(zt)(this)}toPromise(zt){return new(zt=Ge(zt))((dn,St)=>{let Bn;this.subscribe(Tn=>Bn=Tn,Tn=>St(Tn),()=>dn(Bn))})}}return ht.create=Bt=>new ht(Bt),ht})();function Ge(ht){var Bt;return null!==(Bt=ht??ge.config.Promise)&&void 0!==Bt?Bt:Promise}},7328:(ut,Ue,re)=>{"use strict";re.d(Ue,{t:()=>K});var S=re(8645),Re=re(4552);class K extends S.x{constructor(ge=1/0,Ke=1/0,nt=Re.l){super(),this._bufferSize=ge,this._windowTime=Ke,this._timestampProvider=nt,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=Ke===1/0,this._bufferSize=Math.max(1,ge),this._windowTime=Math.max(1,Ke)}next(ge){const{isStopped:Ke,_buffer:nt,_infiniteTimeWindow:Ye,_timestampProvider:Ge,_windowTime:Xe}=this;Ke||(nt.push(ge),!Ye&&nt.push(Ge.now()+Xe)),this._trimBuffer(),super.next(ge)}_subscribe(ge){this._throwIfClosed(),this._trimBuffer();const Ke=this._innerSubscribe(ge),{_infiniteTimeWindow:nt,_buffer:Ye}=this,Ge=Ye.slice();for(let Xe=0;Xe<Ge.length&&!ge.closed;Xe+=nt?1:2)ge.next(Ge[Xe]);return this._checkFinalizedStatuses(ge),Ke}_trimBuffer(){const{_bufferSize:ge,_timestampProvider:Ke,_buffer:nt,_infiniteTimeWindow:Ye}=this,Ge=(Ye?1:2)*ge;if(ge<1/0&&Ge<nt.length&&nt.splice(0,nt.length-Ge),!Ye){const Xe=Ke.now();let at=0;for(let ht=1;ht<nt.length&&nt[ht]<=Xe;ht+=2)at=ht;at&&nt.splice(0,at+1)}}}},8645:(ut,Ue,re)=>{"use strict";re.d(Ue,{x:()=>nt});var S=re(5592),Re=re(7394);const l=(0,re(2306).d)(Ge=>function(){Ge(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var ge=re(9039),Ke=re(1441);let nt=(()=>{class Ge extends S.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(at){const ht=new Ye(this,this);return ht.operator=at,ht}_throwIfClosed(){if(this.closed)throw new l}next(at){(0,Ke.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const ht of this.currentObservers)ht.next(at)}})}error(at){(0,Ke.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=at;const{observers:ht}=this;for(;ht.length;)ht.shift().error(at)}})}complete(){(0,Ke.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:at}=this;for(;at.length;)at.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var at;return(null===(at=this.observers)||void 0===at?void 0:at.length)>0}_trySubscribe(at){return this._throwIfClosed(),super._trySubscribe(at)}_subscribe(at){return this._throwIfClosed(),this._checkFinalizedStatuses(at),this._innerSubscribe(at)}_innerSubscribe(at){const{hasError:ht,isStopped:Bt,observers:zt}=this;return ht||Bt?Re.Lc:(this.currentObservers=null,zt.push(at),new Re.w0(()=>{this.currentObservers=null,(0,ge.P)(zt,at)}))}_checkFinalizedStatuses(at){const{hasError:ht,thrownError:Bt,isStopped:zt}=this;ht?at.error(Bt):zt&&at.complete()}asObservable(){const at=new S.y;return at.source=this,at}}return Ge.create=(Xe,at)=>new Ye(Xe,at),Ge})();class Ye extends nt{constructor(Xe,at){super(),this.destination=Xe,this.source=at}next(Xe){var at,ht;null===(ht=null===(at=this.destination)||void 0===at?void 0:at.next)||void 0===ht||ht.call(at,Xe)}error(Xe){var at,ht;null===(ht=null===(at=this.destination)||void 0===at?void 0:at.error)||void 0===ht||ht.call(at,Xe)}complete(){var Xe,at;null===(at=null===(Xe=this.destination)||void 0===Xe?void 0:Xe.complete)||void 0===at||at.call(Xe)}_subscribe(Xe){var at,ht;return null!==(ht=null===(at=this.source)||void 0===at?void 0:at.subscribe(Xe))&&void 0!==ht?ht:Re.Lc}}},305:(ut,Ue,re)=>{"use strict";re.d(Ue,{Hp:()=>St,Lv:()=>ht});var S=re(4674),Re=re(7394),K=re(2653),l=re(3894),ge=re(2420);const Ke=Ge("C",void 0,void 0);function Ge(ft,Ze,Xt){return{kind:ft,value:Ze,error:Xt}}var Xe=re(7599),at=re(1441);class ht extends Re.w0{constructor(Ze){super(),this.isStopped=!1,Ze?(this.destination=Ze,(0,Re.Nn)(Ze)&&Ze.add(this)):this.destination=Dn}static create(Ze,Xt,Pt){return new St(Ze,Xt,Pt)}next(Ze){this.isStopped?kn(function Ye(ft){return Ge("N",ft,void 0)}(Ze),this):this._next(Ze)}error(Ze){this.isStopped?kn(function nt(ft){return Ge("E",void 0,ft)}(Ze),this):(this.isStopped=!0,this._error(Ze))}complete(){this.isStopped?kn(Ke,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Ze){this.destination.next(Ze)}_error(Ze){try{this.destination.error(Ze)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Bt=Function.prototype.bind;function zt(ft,Ze){return Bt.call(ft,Ze)}class dn{constructor(Ze){this.partialObserver=Ze}next(Ze){const{partialObserver:Xt}=this;if(Xt.next)try{Xt.next(Ze)}catch(Pt){Bn(Pt)}}error(Ze){const{partialObserver:Xt}=this;if(Xt.error)try{Xt.error(Ze)}catch(Pt){Bn(Pt)}else Bn(Ze)}complete(){const{partialObserver:Ze}=this;if(Ze.complete)try{Ze.complete()}catch(Xt){Bn(Xt)}}}class St extends ht{constructor(Ze,Xt,Pt){let qt;if(super(),(0,S.m)(Ze)||!Ze)qt={next:Ze??void 0,error:Xt??void 0,complete:Pt??void 0};else{let vn;this&&K.config.useDeprecatedNextContext?(vn=Object.create(Ze),vn.unsubscribe=()=>this.unsubscribe(),qt={next:Ze.next&&zt(Ze.next,vn),error:Ze.error&&zt(Ze.error,vn),complete:Ze.complete&&zt(Ze.complete,vn)}):qt=Ze}this.destination=new dn(qt)}}function Bn(ft){K.config.useDeprecatedSynchronousErrorHandling?(0,at.O)(ft):(0,l.h)(ft)}function kn(ft,Ze){const{onStoppedNotification:Xt}=K.config;Xt&&Xe.z.setTimeout(()=>Xt(ft,Ze))}const Dn={closed:!0,next:ge.Z,error:function Tn(ft){throw ft},complete:ge.Z}},7394:(ut,Ue,re)=>{"use strict";re.d(Ue,{Lc:()=>Ke,w0:()=>ge,Nn:()=>nt});var S=re(4674);const K=(0,re(2306).d)(Ge=>function(at){Ge(this),this.message=at?`${at.length} errors occurred during unsubscription:\n${at.map((ht,Bt)=>`${Bt+1}) ${ht.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=at});var l=re(9039);class ge{constructor(Xe){this.initialTeardown=Xe,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let Xe;if(!this.closed){this.closed=!0;const{_parentage:at}=this;if(at)if(this._parentage=null,Array.isArray(at))for(const zt of at)zt.remove(this);else at.remove(this);const{initialTeardown:ht}=this;if((0,S.m)(ht))try{ht()}catch(zt){Xe=zt instanceof K?zt.errors:[zt]}const{_finalizers:Bt}=this;if(Bt){this._finalizers=null;for(const zt of Bt)try{Ye(zt)}catch(dn){Xe=Xe??[],dn instanceof K?Xe=[...Xe,...dn.errors]:Xe.push(dn)}}if(Xe)throw new K(Xe)}}add(Xe){var at;if(Xe&&Xe!==this)if(this.closed)Ye(Xe);else{if(Xe instanceof ge){if(Xe.closed||Xe._hasParent(this))return;Xe._addParent(this)}(this._finalizers=null!==(at=this._finalizers)&&void 0!==at?at:[]).push(Xe)}}_hasParent(Xe){const{_parentage:at}=this;return at===Xe||Array.isArray(at)&&at.includes(Xe)}_addParent(Xe){const{_parentage:at}=this;this._parentage=Array.isArray(at)?(at.push(Xe),at):at?[at,Xe]:Xe}_removeParent(Xe){const{_parentage:at}=this;at===Xe?this._parentage=null:Array.isArray(at)&&(0,l.P)(at,Xe)}remove(Xe){const{_finalizers:at}=this;at&&(0,l.P)(at,Xe),Xe instanceof ge&&Xe._removeParent(this)}}ge.EMPTY=(()=>{const Ge=new ge;return Ge.closed=!0,Ge})();const Ke=ge.EMPTY;function nt(Ge){return Ge instanceof ge||Ge&&"closed"in Ge&&(0,S.m)(Ge.remove)&&(0,S.m)(Ge.add)&&(0,S.m)(Ge.unsubscribe)}function Ye(Ge){(0,S.m)(Ge)?Ge():Ge.unsubscribe()}},2653:(ut,Ue,re)=>{"use strict";re.d(Ue,{config:()=>S});const S={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},2572:(ut,Ue,re)=>{"use strict";re.d(Ue,{a:()=>Xe});var S=re(5592),Re=re(7453),K=re(9666),l=re(2737),ge=re(7400),Ke=re(9940),nt=re(2714),Ye=re(8251),Ge=re(7103);function Xe(...Bt){const zt=(0,Ke.yG)(Bt),dn=(0,Ke.jO)(Bt),{args:St,keys:Bn}=(0,Re.D)(Bt);if(0===St.length)return(0,K.D)([],zt);const Tn=new S.y(function at(Bt,zt,dn=l.y){return St=>{ht(zt,()=>{const{length:Bn}=Bt,Tn=new Array(Bn);let kn=Bn,Dn=Bn;for(let ft=0;ft<Bn;ft++)ht(zt,()=>{const Ze=(0,K.D)(Bt[ft],zt);let Xt=!1;Ze.subscribe((0,Ye.x)(St,Pt=>{Tn[ft]=Pt,Xt||(Xt=!0,Dn--),Dn||St.next(dn(Tn.slice()))},()=>{--kn||St.complete()}))},St)},St)}}(St,zt,Bn?kn=>(0,nt.n)(Bn,kn):l.y));return dn?Tn.pipe((0,ge.Z)(dn)):Tn}function ht(Bt,zt,dn){Bt?(0,Ge.f)(dn,Bt,zt):zt()}},5211:(ut,Ue,re)=>{"use strict";re.d(Ue,{z:()=>ge});var S=re(7537),K=re(9940),l=re(9666);function ge(...Ke){return function Re(){return(0,S.J)(1)}()((0,l.D)(Ke,(0,K.yG)(Ke)))}},6232:(ut,Ue,re)=>{"use strict";re.d(Ue,{E:()=>Re});const Re=new(re(5592).y)(ge=>ge.complete())},9666:(ut,Ue,re)=>{"use strict";re.d(Ue,{D:()=>Xt});var S=re(4829),Re=re(3093),K=re(9360);function l(Pt,qt=0){return(0,K.e)((vn,Ti)=>{Ti.add(Pt.schedule(()=>vn.subscribe(Ti),qt))})}var nt=re(5592),Ge=re(4971),Xe=re(4674),at=re(7103);function Bt(Pt,qt){if(!Pt)throw new Error("Iterable cannot be null");return new nt.y(vn=>{(0,at.f)(vn,qt,()=>{const Ti=Pt[Symbol.asyncIterator]();(0,at.f)(vn,qt,()=>{Ti.next().then(Ei=>{Ei.done?vn.complete():vn.next(Ei.value)})},0,!0)})})}var zt=re(8382),dn=re(4026),St=re(4266),Bn=re(3664),Tn=re(5726),kn=re(9853),Dn=re(541);function Xt(Pt,qt){return qt?function Ze(Pt,qt){if(null!=Pt){if((0,zt.c)(Pt))return function ge(Pt,qt){return(0,S.Xf)(Pt).pipe(l(qt),(0,Re.Q)(qt))}(Pt,qt);if((0,St.z)(Pt))return function Ye(Pt,qt){return new nt.y(vn=>{let Ti=0;return qt.schedule(function(){Ti===Pt.length?vn.complete():(vn.next(Pt[Ti++]),vn.closed||this.schedule())})})}(Pt,qt);if((0,dn.t)(Pt))return function Ke(Pt,qt){return(0,S.Xf)(Pt).pipe(l(qt),(0,Re.Q)(qt))}(Pt,qt);if((0,Tn.D)(Pt))return Bt(Pt,qt);if((0,Bn.T)(Pt))return function ht(Pt,qt){return new nt.y(vn=>{let Ti;return(0,at.f)(vn,qt,()=>{Ti=Pt[Ge.h](),(0,at.f)(vn,qt,()=>{let Ei,Li;try{({value:Ei,done:Li}=Ti.next())}catch(Mr){return void vn.error(Mr)}Li?vn.complete():vn.next(Ei)},0,!0)}),()=>(0,Xe.m)(Ti?.return)&&Ti.return()})}(Pt,qt);if((0,Dn.L)(Pt))return function ft(Pt,qt){return Bt((0,Dn.Q)(Pt),qt)}(Pt,qt)}throw(0,kn.z)(Pt)}(Pt,qt):(0,S.Xf)(Pt)}},4829:(ut,Ue,re)=>{"use strict";re.d(Ue,{Xf:()=>Bt});var S=re(7582),Re=re(4266),K=re(4026),l=re(5592),ge=re(8382),Ke=re(5726),nt=re(9853),Ye=re(3664),Ge=re(541),Xe=re(4674),at=re(3894),ht=re(4850);function Bt(ft){if(ft instanceof l.y)return ft;if(null!=ft){if((0,ge.c)(ft))return function zt(ft){return new l.y(Ze=>{const Xt=ft[ht.L]();if((0,Xe.m)(Xt.subscribe))return Xt.subscribe(Ze);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(ft);if((0,Re.z)(ft))return function dn(ft){return new l.y(Ze=>{for(let Xt=0;Xt<ft.length&&!Ze.closed;Xt++)Ze.next(ft[Xt]);Ze.complete()})}(ft);if((0,K.t)(ft))return function St(ft){return new l.y(Ze=>{ft.then(Xt=>{Ze.closed||(Ze.next(Xt),Ze.complete())},Xt=>Ze.error(Xt)).then(null,at.h)})}(ft);if((0,Ke.D)(ft))return Tn(ft);if((0,Ye.T)(ft))return function Bn(ft){return new l.y(Ze=>{for(const Xt of ft)if(Ze.next(Xt),Ze.closed)return;Ze.complete()})}(ft);if((0,Ge.L)(ft))return function kn(ft){return Tn((0,Ge.Q)(ft))}(ft)}throw(0,nt.z)(ft)}function Tn(ft){return new l.y(Ze=>{(function Dn(ft,Ze){var Xt,Pt,qt,vn;return(0,S.mG)(this,void 0,void 0,function*(){try{for(Xt=(0,S.KL)(ft);!(Pt=yield Xt.next()).done;)if(Ze.next(Pt.value),Ze.closed)return}catch(Ti){qt={error:Ti}}finally{try{Pt&&!Pt.done&&(vn=Xt.return)&&(yield vn.call(Xt))}finally{if(qt)throw qt.error}}Ze.complete()})})(ft,Ze).catch(Xt=>Ze.error(Xt))})}},3019:(ut,Ue,re)=>{"use strict";re.d(Ue,{T:()=>Ke});var S=re(7537),Re=re(4829),K=re(6232),l=re(9940),ge=re(9666);function Ke(...nt){const Ye=(0,l.yG)(nt),Ge=(0,l._6)(nt,1/0),Xe=nt;return Xe.length?1===Xe.length?(0,Re.Xf)(Xe[0]):(0,S.J)(Ge)((0,ge.D)(Xe,Ye)):K.E}},2096:(ut,Ue,re)=>{"use strict";re.d(Ue,{of:()=>K});var S=re(9940),Re=re(9666);function K(...l){const ge=(0,S.yG)(l);return(0,Re.D)(l,ge)}},8504:(ut,Ue,re)=>{"use strict";re.d(Ue,{_:()=>K});var S=re(5592),Re=re(4674);function K(l,ge){const Ke=(0,Re.m)(l)?l:()=>l,nt=Ye=>Ye.error(Ke());return new S.y(ge?Ye=>ge.schedule(nt,0,Ye):nt)}},8251:(ut,Ue,re)=>{"use strict";re.d(Ue,{Q:()=>K,x:()=>Re});var S=re(305);function Re(l,ge,Ke,nt,Ye){return new K(l,ge,Ke,nt,Ye)}class K extends S.Lv{constructor(ge,Ke,nt,Ye,Ge,Xe){super(ge),this.onFinalize=Ge,this.shouldUnsubscribe=Xe,this._next=Ke?function(at){try{Ke(at)}catch(ht){ge.error(ht)}}:super._next,this._error=Ye?function(at){try{Ye(at)}catch(ht){ge.error(ht)}finally{this.unsubscribe()}}:super._error,this._complete=nt?function(){try{nt()}catch(at){ge.error(at)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var ge;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Ke}=this;super.unsubscribe(),!Ke&&(null===(ge=this.onFinalize)||void 0===ge||ge.call(this))}}}},6306:(ut,Ue,re)=>{"use strict";re.d(Ue,{K:()=>l});var S=re(4829),Re=re(8251),K=re(9360);function l(ge){return(0,K.e)((Ke,nt)=>{let Xe,Ye=null,Ge=!1;Ye=Ke.subscribe((0,Re.x)(nt,void 0,void 0,at=>{Xe=(0,S.Xf)(ge(at,l(ge)(Ke))),Ye?(Ye.unsubscribe(),Ye=null,Xe.subscribe(nt)):Ge=!0})),Ge&&(Ye.unsubscribe(),Ye=null,Xe.subscribe(nt))})}},6328:(ut,Ue,re)=>{"use strict";re.d(Ue,{b:()=>K});var S=re(1631),Re=re(4674);function K(l,ge){return(0,Re.m)(ge)?(0,S.z)(l,ge,1):(0,S.z)(l,1)}},3620:(ut,Ue,re)=>{"use strict";re.d(Ue,{b:()=>l});var S=re(6321),Re=re(9360),K=re(8251);function l(ge,Ke=S.z){return(0,Re.e)((nt,Ye)=>{let Ge=null,Xe=null,at=null;const ht=()=>{if(Ge){Ge.unsubscribe(),Ge=null;const zt=Xe;Xe=null,Ye.next(zt)}};function Bt(){const zt=at+ge,dn=Ke.now();if(dn<zt)return Ge=this.schedule(void 0,zt-dn),void Ye.add(Ge);ht()}nt.subscribe((0,K.x)(Ye,zt=>{Xe=zt,at=Ke.now(),Ge||(Ge=Ke.schedule(Bt,ge),Ye.add(Ge))},()=>{ht(),Ye.complete()},void 0,()=>{Xe=Ge=null}))})}},3997:(ut,Ue,re)=>{"use strict";re.d(Ue,{x:()=>l});var S=re(2737),Re=re(9360),K=re(8251);function l(Ke,nt=S.y){return Ke=Ke??ge,(0,Re.e)((Ye,Ge)=>{let Xe,at=!0;Ye.subscribe((0,K.x)(Ge,ht=>{const Bt=nt(ht);(at||!Ke(Xe,Bt))&&(at=!1,Xe=Bt,Ge.next(ht))}))})}function ge(Ke,nt){return Ke===nt}},2181:(ut,Ue,re)=>{"use strict";re.d(Ue,{h:()=>K});var S=re(9360),Re=re(8251);function K(l,ge){return(0,S.e)((Ke,nt)=>{let Ye=0;Ke.subscribe((0,Re.x)(nt,Ge=>l.call(ge,Ge,Ye++)&&nt.next(Ge)))})}},4716:(ut,Ue,re)=>{"use strict";re.d(Ue,{x:()=>Re});var S=re(9360);function Re(K){return(0,S.e)((l,ge)=>{try{l.subscribe(ge)}finally{ge.add(K)}})}},7398:(ut,Ue,re)=>{"use strict";re.d(Ue,{U:()=>K});var S=re(9360),Re=re(8251);function K(l,ge){return(0,S.e)((Ke,nt)=>{let Ye=0;Ke.subscribe((0,Re.x)(nt,Ge=>{nt.next(l.call(ge,Ge,Ye++))}))})}},7537:(ut,Ue,re)=>{"use strict";re.d(Ue,{J:()=>K});var S=re(1631),Re=re(2737);function K(l=1/0){return(0,S.z)(Re.y,l)}},1631:(ut,Ue,re)=>{"use strict";re.d(Ue,{z:()=>Ye});var S=re(7398),Re=re(4829),K=re(9360),l=re(7103),ge=re(8251),nt=re(4674);function Ye(Ge,Xe,at=1/0){return(0,nt.m)(Xe)?Ye((ht,Bt)=>(0,S.U)((zt,dn)=>Xe(ht,zt,Bt,dn))((0,Re.Xf)(Ge(ht,Bt))),at):("number"==typeof Xe&&(at=Xe),(0,K.e)((ht,Bt)=>function Ke(Ge,Xe,at,ht,Bt,zt,dn,St){const Bn=[];let Tn=0,kn=0,Dn=!1;const ft=()=>{Dn&&!Bn.length&&!Tn&&Xe.complete()},Ze=Pt=>Tn<ht?Xt(Pt):Bn.push(Pt),Xt=Pt=>{zt&&Xe.next(Pt),Tn++;let qt=!1;(0,Re.Xf)(at(Pt,kn++)).subscribe((0,ge.x)(Xe,vn=>{Bt?.(vn),zt?Ze(vn):Xe.next(vn)},()=>{qt=!0},void 0,()=>{if(qt)try{for(Tn--;Bn.length&&Tn<ht;){const vn=Bn.shift();dn?(0,l.f)(Xe,dn,()=>Xt(vn)):Xt(vn)}ft()}catch(vn){Xe.error(vn)}}))};return Ge.subscribe((0,ge.x)(Xe,Ze,()=>{Dn=!0,ft()})),()=>{St?.()}}(ht,Bt,Ge,at)))}},3093:(ut,Ue,re)=>{"use strict";re.d(Ue,{Q:()=>l});var S=re(7103),Re=re(9360),K=re(8251);function l(ge,Ke=0){return(0,Re.e)((nt,Ye)=>{nt.subscribe((0,K.x)(Ye,Ge=>(0,S.f)(Ye,ge,()=>Ye.next(Ge),Ke),()=>(0,S.f)(Ye,ge,()=>Ye.complete(),Ke),Ge=>(0,S.f)(Ye,ge,()=>Ye.error(Ge),Ke)))})}},6699:(ut,Ue,re)=>{"use strict";re.d(Ue,{R:()=>l});var S=re(9360),Re=re(8251);function l(ge,Ke){return(0,S.e)(function K(ge,Ke,nt,Ye,Ge){return(Xe,at)=>{let ht=nt,Bt=Ke,zt=0;Xe.subscribe((0,Re.x)(at,dn=>{const St=zt++;Bt=ht?ge(Bt,dn,St):(ht=!0,dn),Ye&&at.next(Bt)},Ge&&(()=>{ht&&at.next(Bt),at.complete()})))}}(ge,Ke,arguments.length>=2,!0))}},3020:(ut,Ue,re)=>{"use strict";re.d(Ue,{B:()=>ge});var S=re(4829),Re=re(8645),K=re(305),l=re(9360);function ge(nt={}){const{connector:Ye=(()=>new Re.x),resetOnError:Ge=!0,resetOnComplete:Xe=!0,resetOnRefCountZero:at=!0}=nt;return ht=>{let Bt,zt,dn,St=0,Bn=!1,Tn=!1;const kn=()=>{zt?.unsubscribe(),zt=void 0},Dn=()=>{kn(),Bt=dn=void 0,Bn=Tn=!1},ft=()=>{const Ze=Bt;Dn(),Ze?.unsubscribe()};return(0,l.e)((Ze,Xt)=>{St++,!Tn&&!Bn&&kn();const Pt=dn=dn??Ye();Xt.add(()=>{St--,0===St&&!Tn&&!Bn&&(zt=Ke(ft,at))}),Pt.subscribe(Xt),!Bt&&St>0&&(Bt=new K.Hp({next:qt=>Pt.next(qt),error:qt=>{Tn=!0,kn(),zt=Ke(Dn,Ge,qt),Pt.error(qt)},complete:()=>{Bn=!0,kn(),zt=Ke(Dn,Xe),Pt.complete()}}),(0,S.Xf)(Ze).subscribe(Bt))})(ht)}}function Ke(nt,Ye,...Ge){if(!0===Ye)return void nt();if(!1===Ye)return;const Xe=new K.Hp({next:()=>{Xe.unsubscribe(),nt()}});return(0,S.Xf)(Ye(...Ge)).subscribe(Xe)}},836:(ut,Ue,re)=>{"use strict";re.d(Ue,{T:()=>Re});var S=re(2181);function Re(K){return(0,S.h)((l,ge)=>K<=ge)}},7921:(ut,Ue,re)=>{"use strict";re.d(Ue,{O:()=>l});var S=re(5211),Re=re(9940),K=re(9360);function l(...ge){const Ke=(0,Re.yG)(ge);return(0,K.e)((nt,Ye)=>{(Ke?(0,S.z)(ge,nt,Ke):(0,S.z)(ge,nt)).subscribe(Ye)})}},4664:(ut,Ue,re)=>{"use strict";re.d(Ue,{w:()=>l});var S=re(4829),Re=re(9360),K=re(8251);function l(ge,Ke){return(0,Re.e)((nt,Ye)=>{let Ge=null,Xe=0,at=!1;const ht=()=>at&&!Ge&&Ye.complete();nt.subscribe((0,K.x)(Ye,Bt=>{Ge?.unsubscribe();let zt=0;const dn=Xe++;(0,S.Xf)(ge(Bt,dn)).subscribe(Ge=(0,K.x)(Ye,St=>Ye.next(Ke?Ke(Bt,St,dn,zt++):St),()=>{Ge=null,ht()}))},()=>{at=!0,ht()}))})}},8180:(ut,Ue,re)=>{"use strict";re.d(Ue,{q:()=>l});var S=re(6232),Re=re(9360),K=re(8251);function l(ge){return ge<=0?()=>S.E:(0,Re.e)((Ke,nt)=>{let Ye=0;Ke.subscribe((0,K.x)(nt,Ge=>{++Ye<=ge&&(nt.next(Ge),ge<=Ye&&nt.complete())}))})}},9773:(ut,Ue,re)=>{"use strict";re.d(Ue,{R:()=>ge});var S=re(9360),Re=re(8251),K=re(4829),l=re(2420);function ge(Ke){return(0,S.e)((nt,Ye)=>{(0,K.Xf)(Ke).subscribe((0,Re.x)(Ye,()=>Ye.complete(),l.Z)),!Ye.closed&&nt.subscribe(Ye)})}},5178:(ut,Ue,re)=>{"use strict";re.d(Ue,{V:()=>Ge});var S=re(6321),Re=re(93),K=re(9360),l=re(4829),ge=re(2306),Ke=re(8251),nt=re(7103);const Ye=(0,ge.d)(at=>function(Bt=null){at(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=Bt});function Ge(at,ht){const{first:Bt,each:zt,with:dn=Xe,scheduler:St=ht??S.z,meta:Bn=null}=(0,Re.q)(at)?{first:at}:"number"==typeof at?{each:at}:at;if(null==Bt&&null==zt)throw new TypeError("No timeout provided.");return(0,K.e)((Tn,kn)=>{let Dn,ft,Ze=null,Xt=0;const Pt=qt=>{ft=(0,nt.f)(kn,St,()=>{try{Dn.unsubscribe(),(0,l.Xf)(dn({meta:Bn,lastValue:Ze,seen:Xt})).subscribe(kn)}catch(vn){kn.error(vn)}},qt)};Dn=Tn.subscribe((0,Ke.x)(kn,qt=>{ft?.unsubscribe(),Xt++,kn.next(Ze=qt),zt>0&&Pt(zt)},void 0,void 0,()=>{ft?.closed||ft?.unsubscribe(),Ze=null})),!Xt&&Pt(null!=Bt?"number"==typeof Bt?Bt:+Bt-St.now():zt)})}function Xe(at){throw new Ye(at)}},2460:(ut,Ue,re)=>{"use strict";re.d(Ue,{M:()=>nt});var S=re(9360),Re=re(8251),K=re(4829),l=re(2737),ge=re(2420),Ke=re(9940);function nt(...Ye){const Ge=(0,Ke.jO)(Ye);return(0,S.e)((Xe,at)=>{const ht=Ye.length,Bt=new Array(ht);let zt=Ye.map(()=>!1),dn=!1;for(let St=0;St<ht;St++)(0,K.Xf)(Ye[St]).subscribe((0,Re.x)(at,Bn=>{Bt[St]=Bn,!dn&&!zt[St]&&(zt[St]=!0,(dn=zt.every(l.y))&&(zt=null))},ge.Z));Xe.subscribe((0,Re.x)(at,St=>{if(dn){const Bn=[St,...Bt];at.next(Ge?Ge(...Bn):Bn)}}))})}},1954:(ut,Ue,re)=>{"use strict";re.d(Ue,{o:()=>ge});var S=re(7394);class Re extends S.w0{constructor(nt,Ye){super()}schedule(nt,Ye=0){return this}}const K={setInterval(Ke,nt,...Ye){const{delegate:Ge}=K;return Ge?.setInterval?Ge.setInterval(Ke,nt,...Ye):setInterval(Ke,nt,...Ye)},clearInterval(Ke){const{delegate:nt}=K;return(nt?.clearInterval||clearInterval)(Ke)},delegate:void 0};var l=re(9039);class ge extends Re{constructor(nt,Ye){super(nt,Ye),this.scheduler=nt,this.work=Ye,this.pending=!1}schedule(nt,Ye=0){var Ge;if(this.closed)return this;this.state=nt;const Xe=this.id,at=this.scheduler;return null!=Xe&&(this.id=this.recycleAsyncId(at,Xe,Ye)),this.pending=!0,this.delay=Ye,this.id=null!==(Ge=this.id)&&void 0!==Ge?Ge:this.requestAsyncId(at,this.id,Ye),this}requestAsyncId(nt,Ye,Ge=0){return K.setInterval(nt.flush.bind(nt,this),Ge)}recycleAsyncId(nt,Ye,Ge=0){if(null!=Ge&&this.delay===Ge&&!1===this.pending)return Ye;null!=Ye&&K.clearInterval(Ye)}execute(nt,Ye){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const Ge=this._execute(nt,Ye);if(Ge)return Ge;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(nt,Ye){let Xe,Ge=!1;try{this.work(nt)}catch(at){Ge=!0,Xe=at||new Error("Scheduled action threw falsy error")}if(Ge)return this.unsubscribe(),Xe}unsubscribe(){if(!this.closed){const{id:nt,scheduler:Ye}=this,{actions:Ge}=Ye;this.work=this.state=this.scheduler=null,this.pending=!1,(0,l.P)(Ge,this),null!=nt&&(this.id=this.recycleAsyncId(Ye,nt,null)),this.delay=null,super.unsubscribe()}}}},2631:(ut,Ue,re)=>{"use strict";re.d(Ue,{v:()=>K});var S=re(4552);class Re{constructor(ge,Ke=Re.now){this.schedulerActionCtor=ge,this.now=Ke}schedule(ge,Ke=0,nt){return new this.schedulerActionCtor(this,ge).schedule(nt,Ke)}}Re.now=S.l.now;class K extends Re{constructor(ge,Ke=Re.now){super(ge,Ke),this.actions=[],this._active=!1}flush(ge){const{actions:Ke}=this;if(this._active)return void Ke.push(ge);let nt;this._active=!0;do{if(nt=ge.execute(ge.state,ge.delay))break}while(ge=Ke.shift());if(this._active=!1,nt){for(;ge=Ke.shift();)ge.unsubscribe();throw nt}}}},6321:(ut,Ue,re)=>{"use strict";re.d(Ue,{P:()=>l,z:()=>K});var S=re(1954);const K=new(re(2631).v)(S.o),l=K},4552:(ut,Ue,re)=>{"use strict";re.d(Ue,{l:()=>S});const S={now:()=>(S.delegate||Date).now(),delegate:void 0}},2381:(ut,Ue,re)=>{"use strict";re.d(Ue,{N:()=>ge});var S=re(1954),K=re(2631);const ge=new class l extends K.v{}(class Re extends S.o{constructor(Ye,Ge){super(Ye,Ge),this.scheduler=Ye,this.work=Ge}schedule(Ye,Ge=0){return Ge>0?super.schedule(Ye,Ge):(this.delay=Ge,this.state=Ye,this.scheduler.flush(this),this)}execute(Ye,Ge){return Ge>0||this.closed?super.execute(Ye,Ge):this._execute(Ye,Ge)}requestAsyncId(Ye,Ge,Xe=0){return null!=Xe&&Xe>0||null==Xe&&this.delay>0?super.requestAsyncId(Ye,Ge,Xe):(Ye.flush(this),0)}})},7599:(ut,Ue,re)=>{"use strict";re.d(Ue,{z:()=>S});const S={setTimeout(Re,K,...l){const{delegate:ge}=S;return ge?.setTimeout?ge.setTimeout(Re,K,...l):setTimeout(Re,K,...l)},clearTimeout(Re){const{delegate:K}=S;return(K?.clearTimeout||clearTimeout)(Re)},delegate:void 0}},4971:(ut,Ue,re)=>{"use strict";re.d(Ue,{h:()=>Re});const Re=function S(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},4850:(ut,Ue,re)=>{"use strict";re.d(Ue,{L:()=>S});const S="function"==typeof Symbol&&Symbol.observable||"@@observable"},9940:(ut,Ue,re)=>{"use strict";re.d(Ue,{_6:()=>Ke,jO:()=>l,yG:()=>ge});var S=re(4674),Re=re(671);function K(nt){return nt[nt.length-1]}function l(nt){return(0,S.m)(K(nt))?nt.pop():void 0}function ge(nt){return(0,Re.K)(K(nt))?nt.pop():void 0}function Ke(nt,Ye){return"number"==typeof K(nt)?nt.pop():Ye}},7453:(ut,Ue,re)=>{"use strict";re.d(Ue,{D:()=>ge});const{isArray:S}=Array,{getPrototypeOf:Re,prototype:K,keys:l}=Object;function ge(nt){if(1===nt.length){const Ye=nt[0];if(S(Ye))return{args:Ye,keys:null};if(function Ke(nt){return nt&&"object"==typeof nt&&Re(nt)===K}(Ye)){const Ge=l(Ye);return{args:Ge.map(Xe=>Ye[Xe]),keys:Ge}}}return{args:nt,keys:null}}},9039:(ut,Ue,re)=>{"use strict";function S(Re,K){if(Re){const l=Re.indexOf(K);0<=l&&Re.splice(l,1)}}re.d(Ue,{P:()=>S})},2306:(ut,Ue,re)=>{"use strict";function S(Re){const l=Re(ge=>{Error.call(ge),ge.stack=(new Error).stack});return l.prototype=Object.create(Error.prototype),l.prototype.constructor=l,l}re.d(Ue,{d:()=>S})},2714:(ut,Ue,re)=>{"use strict";function S(Re,K){return Re.reduce((l,ge,Ke)=>(l[ge]=K[Ke],l),{})}re.d(Ue,{n:()=>S})},1441:(ut,Ue,re)=>{"use strict";re.d(Ue,{O:()=>l,x:()=>K});var S=re(2653);let Re=null;function K(ge){if(S.config.useDeprecatedSynchronousErrorHandling){const Ke=!Re;if(Ke&&(Re={errorThrown:!1,error:null}),ge(),Ke){const{errorThrown:nt,error:Ye}=Re;if(Re=null,nt)throw Ye}}else ge()}function l(ge){S.config.useDeprecatedSynchronousErrorHandling&&Re&&(Re.errorThrown=!0,Re.error=ge)}},7103:(ut,Ue,re)=>{"use strict";function S(Re,K,l,ge=0,Ke=!1){const nt=K.schedule(function(){l(),Ke?Re.add(this.schedule(null,ge)):this.unsubscribe()},ge);if(Re.add(nt),!Ke)return nt}re.d(Ue,{f:()=>S})},2737:(ut,Ue,re)=>{"use strict";function S(Re){return Re}re.d(Ue,{y:()=>S})},4266:(ut,Ue,re)=>{"use strict";re.d(Ue,{z:()=>S});const S=Re=>Re&&"number"==typeof Re.length&&"function"!=typeof Re},5726:(ut,Ue,re)=>{"use strict";re.d(Ue,{D:()=>Re});var S=re(4674);function Re(K){return Symbol.asyncIterator&&(0,S.m)(K?.[Symbol.asyncIterator])}},93:(ut,Ue,re)=>{"use strict";function S(Re){return Re instanceof Date&&!isNaN(Re)}re.d(Ue,{q:()=>S})},4674:(ut,Ue,re)=>{"use strict";function S(Re){return"function"==typeof Re}re.d(Ue,{m:()=>S})},8382:(ut,Ue,re)=>{"use strict";re.d(Ue,{c:()=>K});var S=re(4850),Re=re(4674);function K(l){return(0,Re.m)(l[S.L])}},3664:(ut,Ue,re)=>{"use strict";re.d(Ue,{T:()=>K});var S=re(4971),Re=re(4674);function K(l){return(0,Re.m)(l?.[S.h])}},4026:(ut,Ue,re)=>{"use strict";re.d(Ue,{t:()=>Re});var S=re(4674);function Re(K){return(0,S.m)(K?.then)}},541:(ut,Ue,re)=>{"use strict";re.d(Ue,{L:()=>l,Q:()=>K});var S=re(7582),Re=re(4674);function K(ge){return(0,S.FC)(this,arguments,function*(){const nt=ge.getReader();try{for(;;){const{value:Ye,done:Ge}=yield(0,S.qq)(nt.read());if(Ge)return yield(0,S.qq)(void 0);yield yield(0,S.qq)(Ye)}}finally{nt.releaseLock()}})}function l(ge){return(0,Re.m)(ge?.getReader)}},671:(ut,Ue,re)=>{"use strict";re.d(Ue,{K:()=>Re});var S=re(4674);function Re(K){return K&&(0,S.m)(K.schedule)}},9360:(ut,Ue,re)=>{"use strict";re.d(Ue,{A:()=>Re,e:()=>K});var S=re(4674);function Re(l){return(0,S.m)(l?.lift)}function K(l){return ge=>{if(Re(ge))return ge.lift(function(Ke){try{return l(Ke,this)}catch(nt){this.error(nt)}});throw new TypeError("Unable to lift unknown Observable type")}}},7400:(ut,Ue,re)=>{"use strict";re.d(Ue,{Z:()=>l});var S=re(7398);const{isArray:Re}=Array;function l(ge){return(0,S.U)(Ke=>function K(ge,Ke){return Re(Ke)?ge(...Ke):ge(Ke)}(ge,Ke))}},2420:(ut,Ue,re)=>{"use strict";function S(){}re.d(Ue,{Z:()=>S})},8407:(ut,Ue,re)=>{"use strict";re.d(Ue,{U:()=>K,z:()=>Re});var S=re(2737);function Re(...l){return K(l)}function K(l){return 0===l.length?S.y:1===l.length?l[0]:function(Ke){return l.reduce((nt,Ye)=>Ye(nt),Ke)}}},3894:(ut,Ue,re)=>{"use strict";re.d(Ue,{h:()=>K});var S=re(2653),Re=re(7599);function K(l){Re.z.setTimeout(()=>{const{onUnhandledError:ge}=S.config;if(!ge)throw l;ge(l)})}},9853:(ut,Ue,re)=>{"use strict";function S(Re){return new TypeError(`You provided ${null!==Re&&"object"==typeof Re?"an invalid object":`'${Re}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}re.d(Ue,{z:()=>S})},6814:(ut,Ue,re)=>{"use strict";re.d(Ue,{Do:()=>St,EM:()=>Ko,HT:()=>l,JF:()=>Ms,K0:()=>Ke,Mx:()=>Jr,NF:()=>Ls,O5:()=>Pr,Ov:()=>yn,PM:()=>ns,S$:()=>Bt,V_:()=>Ye,Ye:()=>Bn,b0:()=>dn,bD:()=>$o,ez:()=>go,q:()=>K,sg:()=>Wr,w_:()=>ge});var S=re(5879);let Re=null;function K(){return Re}function l(N){Re||(Re=N)}class ge{}const Ke=new S.OlP("DocumentToken");let nt=(()=>{var N;class ee{historyGo(J){throw new Error("Not implemented")}}return(N=ee).\u0275fac=function(J){return new(J||N)},N.\u0275prov=S.Yz7({token:N,factory:function(){return(0,S.f3M)(Ge)},providedIn:"platform"}),ee})();const Ye=new S.OlP("Location Initialized");let Ge=(()=>{var N;class ee extends nt{constructor(){super(),this._doc=(0,S.f3M)(Ke),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return K().getBaseHref(this._doc)}onPopState(J){const ve=K().getGlobalEventTarget(this._doc,"window");return ve.addEventListener("popstate",J,!1),()=>ve.removeEventListener("popstate",J)}onHashChange(J){const ve=K().getGlobalEventTarget(this._doc,"window");return ve.addEventListener("hashchange",J,!1),()=>ve.removeEventListener("hashchange",J)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(J){this._location.pathname=J}pushState(J,ve,rt){this._history.pushState(J,ve,rt)}replaceState(J,ve,rt){this._history.replaceState(J,ve,rt)}forward(){this._history.forward()}back(){this._history.back()}historyGo(J=0){this._history.go(J)}getState(){return this._history.state}}return(N=ee).\u0275fac=function(J){return new(J||N)},N.\u0275prov=S.Yz7({token:N,factory:function(){return new N},providedIn:"platform"}),ee})();function Xe(N,ee){if(0==N.length)return ee;if(0==ee.length)return N;let Me=0;return N.endsWith("/")&&Me++,ee.startsWith("/")&&Me++,2==Me?N+ee.substring(1):1==Me?N+ee:N+"/"+ee}function at(N){const ee=N.match(/#|\?|$/),Me=ee&&ee.index||N.length;return N.slice(0,Me-("/"===N[Me-1]?1:0))+N.slice(Me)}function ht(N){return N&&"?"!==N[0]?"?"+N:N}let Bt=(()=>{var N;class ee{historyGo(J){throw new Error("Not implemented")}}return(N=ee).\u0275fac=function(J){return new(J||N)},N.\u0275prov=S.Yz7({token:N,factory:function(){return(0,S.f3M)(dn)},providedIn:"root"}),ee})();const zt=new S.OlP("appBaseHref");let dn=(()=>{var N;class ee extends Bt{constructor(J,ve){super(),this._platformLocation=J,this._removeListenerFns=[],this._baseHref=ve??this._platformLocation.getBaseHrefFromDOM()??(0,S.f3M)(Ke).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(J){this._removeListenerFns.push(this._platformLocation.onPopState(J),this._platformLocation.onHashChange(J))}getBaseHref(){return this._baseHref}prepareExternalUrl(J){return Xe(this._baseHref,J)}path(J=!1){const ve=this._platformLocation.pathname+ht(this._platformLocation.search),rt=this._platformLocation.hash;return rt&&J?`${ve}${rt}`:ve}pushState(J,ve,rt,Tt){const on=this.prepareExternalUrl(rt+ht(Tt));this._platformLocation.pushState(J,ve,on)}replaceState(J,ve,rt,Tt){const on=this.prepareExternalUrl(rt+ht(Tt));this._platformLocation.replaceState(J,ve,on)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(J=0){this._platformLocation.historyGo?.(J)}}return(N=ee).\u0275fac=function(J){return new(J||N)(S.LFG(nt),S.LFG(zt,8))},N.\u0275prov=S.Yz7({token:N,factory:N.\u0275fac,providedIn:"root"}),ee})(),St=(()=>{var N;class ee extends Bt{constructor(J,ve){super(),this._platformLocation=J,this._baseHref="",this._removeListenerFns=[],null!=ve&&(this._baseHref=ve)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(J){this._removeListenerFns.push(this._platformLocation.onPopState(J),this._platformLocation.onHashChange(J))}getBaseHref(){return this._baseHref}path(J=!1){let ve=this._platformLocation.hash;return null==ve&&(ve="#"),ve.length>0?ve.substring(1):ve}prepareExternalUrl(J){const ve=Xe(this._baseHref,J);return ve.length>0?"#"+ve:ve}pushState(J,ve,rt,Tt){let on=this.prepareExternalUrl(rt+ht(Tt));0==on.length&&(on=this._platformLocation.pathname),this._platformLocation.pushState(J,ve,on)}replaceState(J,ve,rt,Tt){let on=this.prepareExternalUrl(rt+ht(Tt));0==on.length&&(on=this._platformLocation.pathname),this._platformLocation.replaceState(J,ve,on)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(J=0){this._platformLocation.historyGo?.(J)}}return(N=ee).\u0275fac=function(J){return new(J||N)(S.LFG(nt),S.LFG(zt,8))},N.\u0275prov=S.Yz7({token:N,factory:N.\u0275fac}),ee})(),Bn=(()=>{var N;class ee{constructor(J){this._subject=new S.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=J;const ve=this._locationStrategy.getBaseHref();this._basePath=function ft(N){if(new RegExp("^(https?:)?//").test(N)){const[,Me]=N.split(/\/\/[^\/]+/);return Me}return N}(at(Dn(ve))),this._locationStrategy.onPopState(rt=>{this._subject.emit({url:this.path(!0),pop:!0,state:rt.state,type:rt.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(J=!1){return this.normalize(this._locationStrategy.path(J))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(J,ve=""){return this.path()==this.normalize(J+ht(ve))}normalize(J){return ee.stripTrailingSlash(function kn(N,ee){if(!N||!ee.startsWith(N))return ee;const Me=ee.substring(N.length);return""===Me||["/",";","?","#"].includes(Me[0])?Me:ee}(this._basePath,Dn(J)))}prepareExternalUrl(J){return J&&"/"!==J[0]&&(J="/"+J),this._locationStrategy.prepareExternalUrl(J)}go(J,ve="",rt=null){this._locationStrategy.pushState(rt,"",J,ve),this._notifyUrlChangeListeners(this.prepareExternalUrl(J+ht(ve)),rt)}replaceState(J,ve="",rt=null){this._locationStrategy.replaceState(rt,"",J,ve),this._notifyUrlChangeListeners(this.prepareExternalUrl(J+ht(ve)),rt)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(J=0){this._locationStrategy.historyGo?.(J)}onUrlChange(J){return this._urlChangeListeners.push(J),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(ve=>{this._notifyUrlChangeListeners(ve.url,ve.state)})),()=>{const ve=this._urlChangeListeners.indexOf(J);this._urlChangeListeners.splice(ve,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(J="",ve){this._urlChangeListeners.forEach(rt=>rt(J,ve))}subscribe(J,ve,rt){return this._subject.subscribe({next:J,error:ve,complete:rt})}}return(N=ee).normalizeQueryParams=ht,N.joinWithSlash=Xe,N.stripTrailingSlash=at,N.\u0275fac=function(J){return new(J||N)(S.LFG(Bt))},N.\u0275prov=S.Yz7({token:N,factory:function(){return function Tn(){return new Bn((0,S.LFG)(Bt))}()},providedIn:"root"}),ee})();function Dn(N){return N.replace(/\/index.html$/,"")}function Jr(N,ee){ee=encodeURIComponent(ee);for(const Me of N.split(";")){const J=Me.indexOf("="),[ve,rt]=-1==J?[Me,""]:[Me.slice(0,J),Me.slice(J+1)];if(ve.trim()===ee)return decodeURIComponent(rt)}return null}class Lr{constructor(ee,Me,J,ve){this.$implicit=ee,this.ngForOf=Me,this.index=J,this.count=ve}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Wr=(()=>{var N;class ee{set ngForOf(J){this._ngForOf=J,this._ngForOfDirty=!0}set ngForTrackBy(J){this._trackByFn=J}get ngForTrackBy(){return this._trackByFn}constructor(J,ve,rt){this._viewContainer=J,this._template=ve,this._differs=rt,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(J){J&&(this._template=J)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const J=this._ngForOf;!this._differ&&J&&(this._differ=this._differs.find(J).create(this.ngForTrackBy))}if(this._differ){const J=this._differ.diff(this._ngForOf);J&&this._applyChanges(J)}}_applyChanges(J){const ve=this._viewContainer;J.forEachOperation((rt,Tt,on)=>{if(null==rt.previousIndex)ve.createEmbeddedView(this._template,new Lr(rt.item,this._ngForOf,-1,-1),null===on?void 0:on);else if(null==on)ve.remove(null===Tt?void 0:Tt);else if(null!==Tt){const Wi=ve.get(Tt);ve.move(Wi,on),ao(Wi,rt)}});for(let rt=0,Tt=ve.length;rt<Tt;rt++){const Wi=ve.get(rt).context;Wi.index=rt,Wi.count=Tt,Wi.ngForOf=this._ngForOf}J.forEachIdentityChange(rt=>{ao(ve.get(rt.currentIndex),rt)})}static ngTemplateContextGuard(J,ve){return!0}}return(N=ee).\u0275fac=function(J){return new(J||N)(S.Y36(S.s_b),S.Y36(S.Rgc),S.Y36(S.ZZ4))},N.\u0275dir=S.lG2({type:N,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),ee})();function ao(N,ee){N.context.$implicit=ee.item}let Pr=(()=>{var N;class ee{constructor(J,ve){this._viewContainer=J,this._context=new gs,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=ve}set ngIf(J){this._context.$implicit=this._context.ngIf=J,this._updateView()}set ngIfThen(J){Sn("ngIfThen",J),this._thenTemplateRef=J,this._thenViewRef=null,this._updateView()}set ngIfElse(J){Sn("ngIfElse",J),this._elseTemplateRef=J,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(J,ve){return!0}}return(N=ee).\u0275fac=function(J){return new(J||N)(S.Y36(S.s_b),S.Y36(S.Rgc))},N.\u0275dir=S.lG2({type:N,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),ee})();class gs{constructor(){this.$implicit=null,this.ngIf=null}}function Sn(N,ee){if(ee&&!ee.createEmbeddedView)throw new Error(`${N} must be a TemplateRef, but received '${(0,S.AaK)(ee)}'.`)}class Oe{createSubscription(ee,Me){return(0,S.rg0)(()=>ee.subscribe({next:Me,error:J=>{throw J}}))}dispose(ee){(0,S.rg0)(()=>ee.unsubscribe())}}class Ot{createSubscription(ee,Me){return ee.then(Me,J=>{throw J})}dispose(ee){}}const tn=new Ot,bt=new Oe;let yn=(()=>{var N;class ee{constructor(J){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=J}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(J){return this._obj?J!==this._obj?(this._dispose(),this.transform(J)):this._latestValue:(J&&this._subscribe(J),this._latestValue)}_subscribe(J){this._obj=J,this._strategy=this._selectStrategy(J),this._subscription=this._strategy.createSubscription(J,ve=>this._updateLatestValue(J,ve))}_selectStrategy(J){if((0,S.QGY)(J))return tn;if((0,S.F4k)(J))return bt;throw function ls(N,ee){return new S.vHH(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(J,ve){J===this._obj&&(this._latestValue=ve,this._ref.markForCheck())}}return(N=ee).\u0275fac=function(J){return new(J||N)(S.Y36(S.sBO,16))},N.\u0275pipe=S.Yjl({name:"async",type:N,pure:!1,standalone:!0}),ee})(),go=(()=>{var N;class ee{}return(N=ee).\u0275fac=function(J){return new(J||N)},N.\u0275mod=S.oAB({type:N}),N.\u0275inj=S.cJS({}),ee})();const $o="browser",cs="server";function Ls(N){return N===$o}function ns(N){return N===cs}let Ko=(()=>{var N;class ee{}return(N=ee).\u0275prov=(0,S.Yz7)({token:N,providedIn:"root",factory:()=>new _s((0,S.LFG)(Ke),window)}),ee})();class _s{constructor(ee,Me){this.document=ee,this.window=Me,this.offset=()=>[0,0]}setOffset(ee){this.offset=Array.isArray(ee)?()=>ee:ee}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(ee){this.supportsScrolling()&&this.window.scrollTo(ee[0],ee[1])}scrollToAnchor(ee){if(!this.supportsScrolling())return;const Me=function tl(N,ee){const Me=N.getElementById(ee)||N.getElementsByName(ee)[0];if(Me)return Me;if("function"==typeof N.createTreeWalker&&N.body&&"function"==typeof N.body.attachShadow){const J=N.createTreeWalker(N.body,NodeFilter.SHOW_ELEMENT);let ve=J.currentNode;for(;ve;){const rt=ve.shadowRoot;if(rt){const Tt=rt.getElementById(ee)||rt.querySelector(`[name="${ee}"]`);if(Tt)return Tt}ve=J.nextNode()}}return null}(this.document,ee);Me&&(this.scrollToElement(Me),Me.focus())}setHistoryScrollRestoration(ee){this.supportsScrolling()&&(this.window.history.scrollRestoration=ee)}scrollToElement(ee){const Me=ee.getBoundingClientRect(),J=Me.left+this.window.pageXOffset,ve=Me.top+this.window.pageYOffset,rt=this.offset();this.window.scrollTo(J-rt[0],ve-rt[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class Ms{}},9862:(ut,Ue,re)=>{"use strict";re.d(Ue,{JF:()=>Ve,TP:()=>ti,WM:()=>Bt,eN:()=>_t});var S=re(5879),Re=re(2096),K=re(9666),l=re(5592),ge=re(6328),Ke=re(2181),nt=re(7398),Ye=re(4716),Ge=re(4664),Xe=re(6814);class at{}class ht{}class Bt{constructor(Be){this.normalizedNames=new Map,this.lazyUpdate=null,Be?"string"==typeof Be?this.lazyInit=()=>{this.headers=new Map,Be.split("\n").forEach(Ft=>{const Rt=Ft.indexOf(":");if(Rt>0){const en=Ft.slice(0,Rt),wn=en.toLowerCase(),Kn=Ft.slice(Rt+1).trim();this.maybeSetNormalizedName(en,wn),this.headers.has(wn)?this.headers.get(wn).push(Kn):this.headers.set(wn,[Kn])}})}:typeof Headers<"u"&&Be instanceof Headers?(this.headers=new Map,Be.forEach((Ft,Rt)=>{this.setHeaderEntries(Rt,Ft)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(Be).forEach(([Ft,Rt])=>{this.setHeaderEntries(Ft,Rt)})}:this.headers=new Map}has(Be){return this.init(),this.headers.has(Be.toLowerCase())}get(Be){this.init();const Ft=this.headers.get(Be.toLowerCase());return Ft&&Ft.length>0?Ft[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(Be){return this.init(),this.headers.get(Be.toLowerCase())||null}append(Be,Ft){return this.clone({name:Be,value:Ft,op:"a"})}set(Be,Ft){return this.clone({name:Be,value:Ft,op:"s"})}delete(Be,Ft){return this.clone({name:Be,value:Ft,op:"d"})}maybeSetNormalizedName(Be,Ft){this.normalizedNames.has(Ft)||this.normalizedNames.set(Ft,Be)}init(){this.lazyInit&&(this.lazyInit instanceof Bt?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(Be=>this.applyUpdate(Be)),this.lazyUpdate=null))}copyFrom(Be){Be.init(),Array.from(Be.headers.keys()).forEach(Ft=>{this.headers.set(Ft,Be.headers.get(Ft)),this.normalizedNames.set(Ft,Be.normalizedNames.get(Ft))})}clone(Be){const Ft=new Bt;return Ft.lazyInit=this.lazyInit&&this.lazyInit instanceof Bt?this.lazyInit:this,Ft.lazyUpdate=(this.lazyUpdate||[]).concat([Be]),Ft}applyUpdate(Be){const Ft=Be.name.toLowerCase();switch(Be.op){case"a":case"s":let Rt=Be.value;if("string"==typeof Rt&&(Rt=[Rt]),0===Rt.length)return;this.maybeSetNormalizedName(Be.name,Ft);const en=("a"===Be.op?this.headers.get(Ft):void 0)||[];en.push(...Rt),this.headers.set(Ft,en);break;case"d":const wn=Be.value;if(wn){let Kn=this.headers.get(Ft);if(!Kn)return;Kn=Kn.filter(An=>-1===wn.indexOf(An)),0===Kn.length?(this.headers.delete(Ft),this.normalizedNames.delete(Ft)):this.headers.set(Ft,Kn)}else this.headers.delete(Ft),this.normalizedNames.delete(Ft)}}setHeaderEntries(Be,Ft){const Rt=(Array.isArray(Ft)?Ft:[Ft]).map(wn=>wn.toString()),en=Be.toLowerCase();this.headers.set(en,Rt),this.maybeSetNormalizedName(Be,en)}forEach(Be){this.init(),Array.from(this.normalizedNames.keys()).forEach(Ft=>Be(this.normalizedNames.get(Ft),this.headers.get(Ft)))}}class dn{encodeKey(Be){return kn(Be)}encodeValue(Be){return kn(Be)}decodeKey(Be){return decodeURIComponent(Be)}decodeValue(Be){return decodeURIComponent(Be)}}const Bn=/%(\d[a-f0-9])/gi,Tn={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function kn(lt){return encodeURIComponent(lt).replace(Bn,(Be,Ft)=>Tn[Ft]??Be)}function Dn(lt){return`${lt}`}class ft{constructor(Be={}){if(this.updates=null,this.cloneFrom=null,this.encoder=Be.encoder||new dn,Be.fromString){if(Be.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function St(lt,Be){const Ft=new Map;return lt.length>0&&lt.replace(/^\?/,"").split("&").forEach(en=>{const wn=en.indexOf("="),[Kn,An]=-1==wn?[Be.decodeKey(en),""]:[Be.decodeKey(en.slice(0,wn)),Be.decodeValue(en.slice(wn+1))],qi=Ft.get(Kn)||[];qi.push(An),Ft.set(Kn,qi)}),Ft}(Be.fromString,this.encoder)}else Be.fromObject?(this.map=new Map,Object.keys(Be.fromObject).forEach(Ft=>{const Rt=Be.fromObject[Ft],en=Array.isArray(Rt)?Rt.map(Dn):[Dn(Rt)];this.map.set(Ft,en)})):this.map=null}has(Be){return this.init(),this.map.has(Be)}get(Be){this.init();const Ft=this.map.get(Be);return Ft?Ft[0]:null}getAll(Be){return this.init(),this.map.get(Be)||null}keys(){return this.init(),Array.from(this.map.keys())}append(Be,Ft){return this.clone({param:Be,value:Ft,op:"a"})}appendAll(Be){const Ft=[];return Object.keys(Be).forEach(Rt=>{const en=Be[Rt];Array.isArray(en)?en.forEach(wn=>{Ft.push({param:Rt,value:wn,op:"a"})}):Ft.push({param:Rt,value:en,op:"a"})}),this.clone(Ft)}set(Be,Ft){return this.clone({param:Be,value:Ft,op:"s"})}delete(Be,Ft){return this.clone({param:Be,value:Ft,op:"d"})}toString(){return this.init(),this.keys().map(Be=>{const Ft=this.encoder.encodeKey(Be);return this.map.get(Be).map(Rt=>Ft+"="+this.encoder.encodeValue(Rt)).join("&")}).filter(Be=>""!==Be).join("&")}clone(Be){const Ft=new ft({encoder:this.encoder});return Ft.cloneFrom=this.cloneFrom||this,Ft.updates=(this.updates||[]).concat(Be),Ft}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(Be=>this.map.set(Be,this.cloneFrom.map.get(Be))),this.updates.forEach(Be=>{switch(Be.op){case"a":case"s":const Ft=("a"===Be.op?this.map.get(Be.param):void 0)||[];Ft.push(Dn(Be.value)),this.map.set(Be.param,Ft);break;case"d":if(void 0===Be.value){this.map.delete(Be.param);break}{let Rt=this.map.get(Be.param)||[];const en=Rt.indexOf(Dn(Be.value));-1!==en&&Rt.splice(en,1),Rt.length>0?this.map.set(Be.param,Rt):this.map.delete(Be.param)}}}),this.cloneFrom=this.updates=null)}}class Xt{constructor(){this.map=new Map}set(Be,Ft){return this.map.set(Be,Ft),this}get(Be){return this.map.has(Be)||this.map.set(Be,Be.defaultValue()),this.map.get(Be)}delete(Be){return this.map.delete(Be),this}has(Be){return this.map.has(Be)}keys(){return this.map.keys()}}function qt(lt){return typeof ArrayBuffer<"u"&&lt instanceof ArrayBuffer}function vn(lt){return typeof Blob<"u"&&lt instanceof Blob}function Ti(lt){return typeof FormData<"u"&&lt instanceof FormData}class Li{constructor(Be,Ft,Rt,en){let wn;if(this.url=Ft,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=Be.toUpperCase(),function Pt(lt){switch(lt){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||en?(this.body=void 0!==Rt?Rt:null,wn=en):wn=Rt,wn&&(this.reportProgress=!!wn.reportProgress,this.withCredentials=!!wn.withCredentials,wn.responseType&&(this.responseType=wn.responseType),wn.headers&&(this.headers=wn.headers),wn.context&&(this.context=wn.context),wn.params&&(this.params=wn.params)),this.headers||(this.headers=new Bt),this.context||(this.context=new Xt),this.params){const Kn=this.params.toString();if(0===Kn.length)this.urlWithParams=Ft;else{const An=Ft.indexOf("?");this.urlWithParams=Ft+(-1===An?"?":An<Ft.length-1?"&":"")+Kn}}else this.params=new ft,this.urlWithParams=Ft}serializeBody(){return null===this.body?null:qt(this.body)||vn(this.body)||Ti(this.body)||function Ei(lt){return typeof URLSearchParams<"u"&&lt instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof ft?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Ti(this.body)?null:vn(this.body)?this.body.type||null:qt(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof ft?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(Be={}){const Ft=Be.method||this.method,Rt=Be.url||this.url,en=Be.responseType||this.responseType,wn=void 0!==Be.body?Be.body:this.body,Kn=void 0!==Be.withCredentials?Be.withCredentials:this.withCredentials,An=void 0!==Be.reportProgress?Be.reportProgress:this.reportProgress;let qi=Be.headers||this.headers,Ci=Be.params||this.params;const dr=Be.context??this.context;return void 0!==Be.setHeaders&&(qi=Object.keys(Be.setHeaders).reduce((Mo,Ar)=>Mo.set(Ar,Be.setHeaders[Ar]),qi)),Be.setParams&&(Ci=Object.keys(Be.setParams).reduce((Mo,Ar)=>Mo.set(Ar,Be.setParams[Ar]),Ci)),new Li(Ft,Rt,wn,{params:Ci,headers:qi,context:dr,reportProgress:An,responseType:en,withCredentials:Kn})}}var Mr=function(lt){return lt[lt.Sent=0]="Sent",lt[lt.UploadProgress=1]="UploadProgress",lt[lt.ResponseHeader=2]="ResponseHeader",lt[lt.DownloadProgress=3]="DownloadProgress",lt[lt.Response=4]="Response",lt[lt.User=5]="User",lt}(Mr||{});class hi{constructor(Be,Ft=200,Rt="OK"){this.headers=Be.headers||new Bt,this.status=void 0!==Be.status?Be.status:Ft,this.statusText=Be.statusText||Rt,this.url=Be.url||null,this.ok=this.status>=200&&this.status<300}}class mr extends hi{constructor(Be={}){super(Be),this.type=Mr.ResponseHeader}clone(Be={}){return new mr({headers:Be.headers||this.headers,status:void 0!==Be.status?Be.status:this.status,statusText:Be.statusText||this.statusText,url:Be.url||this.url||void 0})}}class Oi extends hi{constructor(Be={}){super(Be),this.type=Mr.Response,this.body=void 0!==Be.body?Be.body:null}clone(Be={}){return new Oi({body:void 0!==Be.body?Be.body:this.body,headers:Be.headers||this.headers,status:void 0!==Be.status?Be.status:this.status,statusText:Be.statusText||this.statusText,url:Be.url||this.url||void 0})}}class ji extends hi{constructor(Be){super(Be,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${Be.url||"(unknown url)"}`:`Http failure response for ${Be.url||"(unknown url)"}: ${Be.status} ${Be.statusText}`,this.error=Be.error||null}}function so(lt,Be){return{body:Be,headers:lt.headers,context:lt.context,observe:lt.observe,params:lt.params,reportProgress:lt.reportProgress,responseType:lt.responseType,withCredentials:lt.withCredentials}}let _t=(()=>{var lt;class Be{constructor(Rt){this.handler=Rt}request(Rt,en,wn={}){let Kn;if(Rt instanceof Li)Kn=Rt;else{let Ci,dr;Ci=wn.headers instanceof Bt?wn.headers:new Bt(wn.headers),wn.params&&(dr=wn.params instanceof ft?wn.params:new ft({fromObject:wn.params})),Kn=new Li(Rt,en,void 0!==wn.body?wn.body:null,{headers:Ci,context:wn.context,params:dr,reportProgress:wn.reportProgress,responseType:wn.responseType||"json",withCredentials:wn.withCredentials})}const An=(0,Re.of)(Kn).pipe((0,ge.b)(Ci=>this.handler.handle(Ci)));if(Rt instanceof Li||"events"===wn.observe)return An;const qi=An.pipe((0,Ke.h)(Ci=>Ci instanceof Oi));switch(wn.observe||"body"){case"body":switch(Kn.responseType){case"arraybuffer":return qi.pipe((0,nt.U)(Ci=>{if(null!==Ci.body&&!(Ci.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return Ci.body}));case"blob":return qi.pipe((0,nt.U)(Ci=>{if(null!==Ci.body&&!(Ci.body instanceof Blob))throw new Error("Response is not a Blob.");return Ci.body}));case"text":return qi.pipe((0,nt.U)(Ci=>{if(null!==Ci.body&&"string"!=typeof Ci.body)throw new Error("Response is not a string.");return Ci.body}));default:return qi.pipe((0,nt.U)(Ci=>Ci.body))}case"response":return qi;default:throw new Error(`Unreachable: unhandled observe type ${wn.observe}}`)}}delete(Rt,en={}){return this.request("DELETE",Rt,en)}get(Rt,en={}){return this.request("GET",Rt,en)}head(Rt,en={}){return this.request("HEAD",Rt,en)}jsonp(Rt,en){return this.request("JSONP",Rt,{params:(new ft).append(en,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Rt,en={}){return this.request("OPTIONS",Rt,en)}patch(Rt,en,wn={}){return this.request("PATCH",Rt,so(wn,en))}post(Rt,en,wn={}){return this.request("POST",Rt,so(wn,en))}put(Rt,en,wn={}){return this.request("PUT",Rt,so(wn,en))}}return(lt=Be).\u0275fac=function(Rt){return new(Rt||lt)(S.LFG(at))},lt.\u0275prov=S.Yz7({token:lt,factory:lt.\u0275fac}),Be})();function zn(lt,Be){return Be(lt)}function Yn(lt,Be){return(Ft,Rt)=>Be.intercept(Ft,{handle:en=>lt(en,Rt)})}const ti=new S.OlP(""),fi=new S.OlP(""),$i=new S.OlP("");function Gr(){let lt=null;return(Be,Ft)=>{null===lt&&(lt=((0,S.f3M)(ti,{optional:!0})??[]).reduceRight(Yn,zn));const Rt=(0,S.f3M)(S.HDt),en=Rt.add();return lt(Be,Ft).pipe((0,Ye.x)(()=>Rt.remove(en)))}}let vi=(()=>{var lt;class Be extends at{constructor(Rt,en){super(),this.backend=Rt,this.injector=en,this.chain=null,this.pendingTasks=(0,S.f3M)(S.HDt)}handle(Rt){if(null===this.chain){const wn=Array.from(new Set([...this.injector.get(fi),...this.injector.get($i,[])]));this.chain=wn.reduceRight((Kn,An)=>function Ln(lt,Be,Ft){return(Rt,en)=>Ft.runInContext(()=>Be(Rt,wn=>lt(wn,en)))}(Kn,An,this.injector),zn)}const en=this.pendingTasks.add();return this.chain(Rt,wn=>this.backend.handle(wn)).pipe((0,Ye.x)(()=>this.pendingTasks.remove(en)))}}return(lt=Be).\u0275fac=function(Rt){return new(Rt||lt)(S.LFG(ht),S.LFG(S.lqb))},lt.\u0275prov=S.Yz7({token:lt,factory:lt.\u0275fac}),Be})();const fo=/^\)\]\}',?\n/;let Gi=(()=>{var lt;class Be{constructor(Rt){this.xhrFactory=Rt}handle(Rt){if("JSONP"===Rt.method)throw new S.vHH(-2800,!1);const en=this.xhrFactory;return(en.\u0275loadImpl?(0,K.D)(en.\u0275loadImpl()):(0,Re.of)(null)).pipe((0,Ge.w)(()=>new l.y(Kn=>{const An=en.build();if(An.open(Rt.method,Rt.urlWithParams),Rt.withCredentials&&(An.withCredentials=!0),Rt.headers.forEach((xt,Xi)=>An.setRequestHeader(xt,Xi.join(","))),Rt.headers.has("Accept")||An.setRequestHeader("Accept","application/json, text/plain, */*"),!Rt.headers.has("Content-Type")){const xt=Rt.detectContentTypeHeader();null!==xt&&An.setRequestHeader("Content-Type",xt)}if(Rt.responseType){const xt=Rt.responseType.toLowerCase();An.responseType="json"!==xt?xt:"text"}const qi=Rt.serializeBody();let Ci=null;const dr=()=>{if(null!==Ci)return Ci;const xt=An.statusText||"OK",Xi=new Bt(An.getAllResponseHeaders()),ar=function po(lt){return"responseURL"in lt&&lt.responseURL?lt.responseURL:/^X-Request-URL:/m.test(lt.getAllResponseHeaders())?lt.getResponseHeader("X-Request-URL"):null}(An)||Rt.url;return Ci=new mr({headers:Xi,status:An.status,statusText:xt,url:ar}),Ci},Mo=()=>{let{headers:xt,status:Xi,statusText:ar,url:Lr}=dr(),Wr=null;204!==Xi&&(Wr=typeof An.response>"u"?An.responseText:An.response),0===Xi&&(Xi=Wr?200:0);let ao=Xi>=200&&Xi<300;if("json"===Rt.responseType&&"string"==typeof Wr){const Vo=Wr;Wr=Wr.replace(fo,"");try{Wr=""!==Wr?JSON.parse(Wr):null}catch(Pr){Wr=Vo,ao&&(ao=!1,Wr={error:Pr,text:Wr})}}ao?(Kn.next(new Oi({body:Wr,headers:xt,status:Xi,statusText:ar,url:Lr||void 0})),Kn.complete()):Kn.error(new ji({error:Wr,headers:xt,status:Xi,statusText:ar,url:Lr||void 0}))},Ar=xt=>{const{url:Xi}=dr(),ar=new ji({error:xt,status:An.status||0,statusText:An.statusText||"Unknown Error",url:Xi||void 0});Kn.error(ar)};let Jr=!1;const So=xt=>{Jr||(Kn.next(dr()),Jr=!0);let Xi={type:Mr.DownloadProgress,loaded:xt.loaded};xt.lengthComputable&&(Xi.total=xt.total),"text"===Rt.responseType&&An.responseText&&(Xi.partialText=An.responseText),Kn.next(Xi)},qo=xt=>{let Xi={type:Mr.UploadProgress,loaded:xt.loaded};xt.lengthComputable&&(Xi.total=xt.total),Kn.next(Xi)};return An.addEventListener("load",Mo),An.addEventListener("error",Ar),An.addEventListener("timeout",Ar),An.addEventListener("abort",Ar),Rt.reportProgress&&(An.addEventListener("progress",So),null!==qi&&An.upload&&An.upload.addEventListener("progress",qo)),An.send(qi),Kn.next({type:Mr.Sent}),()=>{An.removeEventListener("error",Ar),An.removeEventListener("abort",Ar),An.removeEventListener("load",Mo),An.removeEventListener("timeout",Ar),Rt.reportProgress&&(An.removeEventListener("progress",So),null!==qi&&An.upload&&An.upload.removeEventListener("progress",qo)),An.readyState!==An.DONE&&An.abort()}})))}}return(lt=Be).\u0275fac=function(Rt){return new(Rt||lt)(S.LFG(Xe.JF))},lt.\u0275prov=S.Yz7({token:lt,factory:lt.\u0275fac}),Be})();const Si=new S.OlP("XSRF_ENABLED"),nr=new S.OlP("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),Hi=new S.OlP("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class Uo{}let Le=(()=>{var lt;class Be{constructor(Rt,en,wn){this.doc=Rt,this.platform=en,this.cookieName=wn,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Rt=this.doc.cookie||"";return Rt!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,Xe.Mx)(Rt,this.cookieName),this.lastCookieString=Rt),this.lastToken}}return(lt=Be).\u0275fac=function(Rt){return new(Rt||lt)(S.LFG(Xe.K0),S.LFG(S.Lbi),S.LFG(nr))},lt.\u0275prov=S.Yz7({token:lt,factory:lt.\u0275fac}),Be})();function ce(lt,Be){const Ft=lt.url.toLowerCase();if(!(0,S.f3M)(Si)||"GET"===lt.method||"HEAD"===lt.method||Ft.startsWith("http://")||Ft.startsWith("https://"))return Be(lt);const Rt=(0,S.f3M)(Uo).getToken(),en=(0,S.f3M)(Hi);return null!=Rt&&!lt.headers.has(en)&&(lt=lt.clone({headers:lt.headers.set(en,Rt)})),Be(lt)}var Se=function(lt){return lt[lt.Interceptors=0]="Interceptors",lt[lt.LegacyInterceptors=1]="LegacyInterceptors",lt[lt.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",lt[lt.NoXsrfProtection=3]="NoXsrfProtection",lt[lt.JsonpSupport=4]="JsonpSupport",lt[lt.RequestsMadeViaParent=5]="RequestsMadeViaParent",lt[lt.Fetch=6]="Fetch",lt}(Se||{});function $e(lt,Be){return{\u0275kind:lt,\u0275providers:Be}}function it(...lt){const Be=[_t,Gi,vi,{provide:at,useExisting:vi},{provide:ht,useExisting:Gi},{provide:fi,useValue:ce,multi:!0},{provide:Si,useValue:!0},{provide:Uo,useClass:Le}];for(const Ft of lt)Be.push(...Ft.\u0275providers);return(0,S.MR2)(Be)}const ct=new S.OlP("LEGACY_INTERCEPTOR_FN");let Ve=(()=>{var lt;class Be{}return(lt=Be).\u0275fac=function(Rt){return new(Rt||lt)},lt.\u0275mod=S.oAB({type:lt}),lt.\u0275inj=S.cJS({providers:[it($e(Se.LegacyInterceptors,[{provide:ct,useFactory:Gr},{provide:fi,useExisting:ct,multi:!0}]))]}),Be})()},5879:(ut,Ue,re)=>{"use strict";re.d(Ue,{$8M:()=>Vs,$WT:()=>Qr,$Z:()=>pp,AFp:()=>Ng,ALo:()=>Mb,AaK:()=>ht,CHM:()=>lc,CRH:()=>jb,EJc:()=>gC,EpF:()=>Uv,F4k:()=>Vv,FYo:()=>tp,FiY:()=>mh,Flj:()=>vl,GfV:()=>Mu,Gpc:()=>dn,HDt:()=>ux,JOm:()=>Sf,Jf7:()=>ef,KtG:()=>Al,LFG:()=>_n,LSH:()=>am,Lbi:()=>um,Lck:()=>Q1,MMx:()=>pb,MR2:()=>jd,NdJ:()=>Vy,Ojb:()=>zg,OlP:()=>no,Oqu:()=>Ky,P3R:()=>Ag,PXZ:()=>$C,Q6J:()=>Ly,QGY:()=>Uy,QbO:()=>W_,Qsj:()=>np,R0b:()=>fs,RDi:()=>bg,Rgc:()=>w_,SBq:()=>ad,Sil:()=>vC,Suo:()=>Vb,TTD:()=>Ga,TgZ:()=>sy,VuI:()=>DD,X6Q:()=>XC,XFs:()=>ii,Xpm:()=>Oe,Xq5:()=>yt,Xts:()=>Vh,Y36:()=>pd,YKP:()=>hb,YNc:()=>kv,Yjl:()=>gr,Yz7:()=>ti,Z0I:()=>vi,ZZ4:()=>Av,_Bn:()=>db,_UZ:()=>Ny,_Vd:()=>Xc,_c5:()=>fD,_uU:()=>g0,aQg:()=>Pv,c2e:()=>cx,cJS:()=>$i,cg1:()=>Xy,dDg:()=>zC,dqk:()=>Gi,eFA:()=>bx,eJc:()=>pv,ekj:()=>Zy,eoX:()=>gx,f3M:()=>qn,g9A:()=>Bg,gHi:()=>xc,h0i:()=>Op,hGG:()=>pD,iGM:()=>Ub,ifc:()=>wn,ip1:()=>lx,jDz:()=>mb,kL8:()=>N0,ktI:()=>Ja,lG2:()=>Sr,lcZ:()=>Sb,lqb:()=>$l,lri:()=>px,n5z:()=>$r,oAB:()=>yn,oxw:()=>Wv,qFp:()=>MD,qLn:()=>wc,qOj:()=>M,qZA:()=>ay,rWj:()=>mx,rg0:()=>pa,s9C:()=>jy,sBO:()=>JC,s_b:()=>gy,soG:()=>yy,tBr:()=>Np,tb:()=>Cv,tdS:()=>lu,tp0:()=>vf,uIk:()=>In,vHH:()=>ft,vpe:()=>Hl,wAp:()=>Zm,xp6:()=>sf,z2F:()=>Xm,zSh:()=>Gd,zs3:()=>cl});var S=re(8645),Re=re(7394),K=re(5592),l=re(3019),ge=re(5619),Ke=re(2096),nt=re(3020),Ye=re(4664),Ge=re(3997);function Xe(t){for(let o in t)if(t[o]===Xe)return o;throw Error("Could not find renamed property on target object.")}function at(t,o){for(const a in o)o.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(t[a]=o[a])}function ht(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(ht).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const o=t.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function Bt(t,o){return null==t||""===t?null===o?"":o:null==o||""===o?t:t+" "+o}const zt=Xe({__forward_ref__:Xe});function dn(t){return t.__forward_ref__=dn,t.toString=function(){return ht(this())},t}function St(t){return Bn(t)?t():t}function Bn(t){return"function"==typeof t&&t.hasOwnProperty(zt)&&t.__forward_ref__===dn}function Tn(t){return t&&!!t.\u0275providers}const Dn="https://g.co/ng/security#xss";class ft extends Error{constructor(o,a){super(function Ze(t,o){return`NG0${Math.abs(t)}${o?": "+o:""}`}(o,a)),this.code=o}}function Xt(t){return"string"==typeof t?t:null==t?"":String(t)}function Ei(t,o){throw new ft(-201,!1)}function Vt(t,o){null==t&&function Gt(t,o,a,d){throw new Error(`ASSERTION ERROR: ${t}`+(null==d?"":` [Expected=> ${a} ${d} ${o} <=Actual]`))}(o,t,null,"!=")}function ti(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function $i(t){return{providers:t.providers||[],imports:t.imports||[]}}function Gr(t){return Zi(t,sr)||Zi(t,bo)}function vi(t){return null!==Gr(t)}function Zi(t,o){return t.hasOwnProperty(o)?t[o]:null}function Yr(t){return t&&(t.hasOwnProperty(wr)||t.hasOwnProperty(To))?t[wr]:null}const sr=Xe({\u0275prov:Xe}),wr=Xe({\u0275inj:Xe}),bo=Xe({ngInjectableDef:Xe}),To=Xe({ngInjectorDef:Xe});var ii=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(ii||{});let gi;function Mi(){return gi}function Er(t){const o=gi;return gi=t,o}function fo(t,o,a){const d=Gr(t);return d&&"root"==d.providedIn?void 0===d.value?d.value=d.factory():d.value:a&ii.Optional?null:void 0!==o?o:void Ei(ht(t))}const Gi=globalThis,ct={},Je="__NG_DI_FLAG__",wt="ngTempTokenPath",fn=/\n/gm,He="__source";let pt;function mt(t){const o=pt;return pt=t,o}function Ut(t,o=ii.Default){if(void 0===pt)throw new ft(-203,!1);return null===pt?fo(t,void 0,o):pt.get(t,o&ii.Optional?null:void 0,o)}function _n(t,o=ii.Default){return(Mi()||Ut)(St(t),o)}function qn(t,o=ii.Default){return _n(t,_i(o))}function _i(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function Cr(t){const o=[];for(let a=0;a<t.length;a++){const d=St(t[a]);if(Array.isArray(d)){if(0===d.length)throw new ft(900,!1);let g,w=ii.Default;for(let I=0;I<d.length;I++){const k=d[I],j=lt(k);"number"==typeof j?-1===j?g=k.token:w|=j:g=k}o.push(_n(g,w))}else o.push(_n(d))}return o}function ur(t,o){return t[Je]=o,t.prototype[Je]=o,t}function lt(t){return t[Je]}function Rt(t){return{toString:t}.toString()}var en=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(en||{}),wn=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(wn||{});const Kn={},An=[],qi=Xe({\u0275cmp:Xe}),Ci=Xe({\u0275dir:Xe}),dr=Xe({\u0275pipe:Xe}),Mo=Xe({\u0275mod:Xe}),Ar=Xe({\u0275fac:Xe}),Jr=Xe({__NG_ELEMENT_ID__:Xe}),So=Xe({__NG_ENV_ID__:Xe});function qo(t,o,a){let d=t.length;for(;;){const g=t.indexOf(o,a);if(-1===g)return g;if(0===g||t.charCodeAt(g-1)<=32){const w=o.length;if(g+w===d||t.charCodeAt(g+w)<=32)return g}a=g+1}}function xt(t,o,a){let d=0;for(;d<a.length;){const g=a[d];if("number"==typeof g){if(0!==g)break;d++;const w=a[d++],I=a[d++],k=a[d++];t.setAttribute(o,I,k,w)}else{const w=g,I=a[++d];ar(w)?t.setProperty(o,w,I):t.setAttribute(o,w,I),d++}}return d}function Xi(t){return 3===t||4===t||6===t}function ar(t){return 64===t.charCodeAt(0)}function Lr(t,o){if(null!==o&&0!==o.length)if(null===t||0===t.length)t=o.slice();else{let a=-1;for(let d=0;d<o.length;d++){const g=o[d];"number"==typeof g?a=g:0===a||Wr(t,a,g,null,-1===a||2===a?o[++d]:null)}}return t}function Wr(t,o,a,d,g){let w=0,I=t.length;if(-1===o)I=-1;else for(;w<t.length;){const k=t[w++];if("number"==typeof k){if(k===o){I=-1;break}if(k>o){I=w-1;break}}}for(;w<t.length;){const k=t[w];if("number"==typeof k)break;if(k===a){if(null===d)return void(null!==g&&(t[w+1]=g));if(d===t[w+1])return void(t[w+2]=g)}w++,null!==d&&w++,null!==g&&w++}-1!==I&&(t.splice(I,0,o),w=I+1),t.splice(w++,0,a),null!==d&&t.splice(w++,0,d),null!==g&&t.splice(w++,0,g)}const ao="ng-template";function Vo(t,o,a){let d=0,g=!0;for(;d<t.length;){let w=t[d++];if("string"==typeof w&&g){const I=t[d++];if(a&&"class"===w&&-1!==qo(I.toLowerCase(),o,0))return!0}else{if(1===w){for(;d<t.length&&"string"==typeof(w=t[d++]);)if(w.toLowerCase()===o)return!0;return!1}"number"==typeof w&&(g=!1)}}return!1}function Pr(t){return 4===t.type&&t.value!==ao}function gs(t,o,a){return o===(4!==t.type||a?t.value:ao)}function Sn(t,o,a){let d=4;const g=t.attrs||[],w=function Bi(t){for(let o=0;o<t.length;o++)if(Xi(t[o]))return o;return t.length}(g);let I=!1;for(let k=0;k<o.length;k++){const j=o[k];if("number"!=typeof j){if(!I)if(4&d){if(d=2|1&d,""!==j&&!gs(t,j,a)||""===j&&1===o.length){if(ci(d))return!1;I=!0}}else{const se=8&d?j:o[++k];if(8&d&&null!==t.attrs){if(!Vo(t.attrs,se,a)){if(ci(d))return!1;I=!0}continue}const ke=mi(8&d?"class":j,g,Pr(t),a);if(-1===ke){if(ci(d))return!1;I=!0;continue}if(""!==se){let dt;dt=ke>w?"":g[ke+1].toLowerCase();const Dt=8&d?dt:null;if(Dt&&-1!==qo(Dt,se,0)||2&d&&se!==dt){if(ci(d))return!1;I=!0}}}}else{if(!I&&!ci(d)&&!ci(j))return!1;if(I&&ci(j))continue;I=!1,d=j|1&d}}return ci(d)||I}function ci(t){return 0==(1&t)}function mi(t,o,a,d){if(null===o)return-1;let g=0;if(d||!a){let w=!1;for(;g<o.length;){const I=o[g];if(I===t)return g;if(3===I||6===I)w=!0;else{if(1===I||2===I){let k=o[++g];for(;"string"==typeof k;)k=o[++g];continue}if(4===I)break;if(0===I){g+=4;continue}}g+=w?1:2}return-1}return function wo(t,o){let a=t.indexOf(4);if(a>-1)for(a++;a<t.length;){const d=t[a];if("number"==typeof d)return-1;if(d===o)return a;a++}return-1}(o,t)}function mo(t,o,a=!1){for(let d=0;d<o.length;d++)if(Sn(t,o[d],a))return!0;return!1}function ks(t,o){return t?":not("+o.trim()+")":o}function ts(t){let o=t[0],a=1,d=2,g="",w=!1;for(;a<t.length;){let I=t[a];if("string"==typeof I)if(2&d){const k=t[++a];g+="["+I+(k.length>0?'="'+k+'"':"")+"]"}else 8&d?g+="."+I:4&d&&(g+=" "+I);else""!==g&&!ci(I)&&(o+=ks(w,g),g=""),d=I,w=w||!ci(d);a++}return""!==g&&(o+=ks(w,g)),o}function Oe(t){return Rt(()=>{const o=Io(t),a={...o,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===en.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||wn.Emulated,styles:t.styles||An,_:null,schemas:t.schemas||null,tView:null,id:""};el(a);const d=t.dependencies;return a.directiveDefs=ea(d,!1),a.pipeDefs=ea(d,!0),a.id=function za(t){let o=0;const a=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(const g of a)o=Math.imul(31,o)+g.charCodeAt(0)<<0;return o+=2147483648,"c"+o}(a),a})}function tn(t){return ri(t)||Jn(t)}function bt(t){return null!==t}function yn(t){return Rt(()=>({type:t.type,bootstrap:t.bootstrap||An,declarations:t.declarations||An,imports:t.imports||An,exports:t.exports||An,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function xi(t,o){if(null==t)return Kn;const a={};for(const d in t)if(t.hasOwnProperty(d)){let g=t[d],w=g;Array.isArray(g)&&(w=g[1],g=g[0]),a[g]=d,o&&(o[g]=w)}return a}function Sr(t){return Rt(()=>{const o=Io(t);return el(o),o})}function gr(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,standalone:!0===t.standalone,onDestroy:t.type.prototype.ngOnDestroy||null}}function ri(t){return t[qi]||null}function Jn(t){return t[Ci]||null}function br(t){return t[dr]||null}function Qr(t){const o=ri(t)||Jn(t)||br(t);return null!==o&&o.standalone}function Ji(t,o){const a=t[Mo]||null;if(!a&&!0===o)throw new Error(`Type ${ht(t)} does not have '\u0275mod' property.`);return a}function Io(t){const o={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:o,inputTransforms:null,inputConfig:t.inputs||Kn,exportAs:t.exportAs||null,standalone:!0===t.standalone,signals:!0===t.signals,selectors:t.selectors||An,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:xi(t.inputs,o),outputs:xi(t.outputs)}}function el(t){t.features?.forEach(o=>o(t))}function ea(t,o){if(!t)return null;const a=o?br:tn;return()=>("function"==typeof t?t():t).map(d=>a(d)).filter(bt)}const Vr=0,$n=1,oi=2,xr=3,Po=4,Ro=5,jr=6,Ds=7,go=8,$o=9,cs=10,bi=11,Ts=12,Ls=13,ns=14,Fr=15,is=16,Ws=17,Ko=18,_s=19,tl=20,ys=21,Ms=22,Fs=23,Zs=24,Xn=25,Ua=1,pl=2,Yo=7,Oo=9,Zr=11;function lo(t){return Array.isArray(t)&&"object"==typeof t[Ua]}function Eo(t){return Array.isArray(t)&&!0===t[Ua]}function ta(t){return 0!=(4&t.flags)}function Ss(t){return t.componentOffset>-1}function na(t){return 1==(1&t.flags)}function Is(t){return!!t.template}function Ks(t){return 0!=(512&t[oi])}function ko(t,o){return t.hasOwnProperty(Ar)?t[Ar]:null}const Bs=Symbol("SIGNAL");function Nr(t,o,a={}){return o[Bs]=t,Object.assign(o,a)}function gl(t,o){return(null===t||"object"!=typeof t)&&Object.is(t,o)}let Ta=Gi.WeakRef??class _l{constructor(o){this.ref=o}deref(){return this.ref}},au=0,zs=null,ja=!1;function yo(t){const o=zs;return zs=t,o}class yl{constructor(){this.id=au++,this.ref=function Ma(t){return new Ta(t)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[o,a]of this.producers){const d=a.producerNode.deref();if(null!=d&&a.atTrackingVersion===this.trackingVersion){if(d.producerPollStatus(a.seenValueVersion))return!0}else this.producers.delete(o),d?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const o=ja;ja=!0;try{for(const[a,d]of this.consumers){const g=d.consumerNode.deref();null!=g&&g.trackingVersion===d.atTrackingVersion?g.onConsumerDependencyMayHaveChanged():(this.consumers.delete(a),g?.producers.delete(this.id))}}finally{ja=o}}producerAccessed(){if(ja)throw new Error("");if(null===zs)return;let o=zs.producers.get(this.id);void 0===o?(o={consumerNode:zs.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:zs.trackingVersion},zs.producers.set(this.id,o),this.consumers.set(zs.id,o)):(o.seenValueVersion=this.valueVersion,o.atTrackingVersion=zs.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==zs?.consumerAllowSignalWrites}producerPollStatus(o){return this.valueVersion!==o||(this.onProducerUpdateValueVersion(),this.valueVersion!==o)}}function vl(t,o){const a=new Sl(t,o?.equal??gl);return Nr(a,a.signal.bind(a))}const Mc=Symbol("UNSET"),bl=Symbol("COMPUTING"),il=Symbol("ERRORED");class Sl extends yl{constructor(o,a){super(),this.computation=o,this.equal=a,this.value=Mc,this.error=null,this.stale=!0,this.consumerAllowSignalWrites=!1}onConsumerDependencyMayHaveChanged(){this.stale||(this.stale=!0,this.producerMayHaveChanged())}onProducerUpdateValueVersion(){if(this.stale){if(this.value!==Mc&&this.value!==bl&&!this.consumerPollProducersForChange())return void(this.stale=!1);this.recomputeValue()}}recomputeValue(){if(this.value===bl)throw new Error("Detected cycle in computations.");const o=this.value;this.value=bl,this.trackingVersion++;const a=yo(this);let d;try{d=this.computation()}catch(g){d=il,this.error=g}finally{yo(a)}this.stale=!1,o!==Mc&&o!==il&&d!==il&&this.equal(o,d)?this.value=o:(this.value=d,this.valueVersion++)}signal(){if(this.onProducerUpdateValueVersion(),this.producerAccessed(),this.value===il)throw this.error;return this.value}}let Ia=function Sc(){throw new Error};function xl(){Ia()}class ec extends yl{constructor(o,a){super(),this.value=o,this.equal=a,this.consumerAllowSignalWrites=!1}onConsumerDependencyMayHaveChanged(){}onProducerUpdateValueVersion(){}set(o){this.producerUpdatesAllowed||xl(),this.equal(this.value,o)||(this.value=o,this.valueVersion++,this.producerMayHaveChanged())}update(o){this.producerUpdatesAllowed||xl(),this.set(o(this.value))}mutate(o){this.producerUpdatesAllowed||xl(),o(this.value),this.valueVersion++,this.producerMayHaveChanged()}asReadonly(){return void 0===this.readonlySignal&&(this.readonlySignal=Nr(this,()=>this.signal())),this.readonlySignal}signal(){return this.producerAccessed(),this.value}}function lu(t,o){const a=new ec(t,o?.equal??gl);return Nr(a,a.signal.bind(a),{set:a.set.bind(a),update:a.update.bind(a),mutate:a.mutate.bind(a),asReadonly:a.asReadonly.bind(a)})}function pa(t){const o=yo(null);try{return t()}finally{yo(o)}}const tc=()=>{};class Ha extends yl{constructor(o,a,d){super(),this.watch=o,this.schedule=a,this.dirty=!1,this.cleanupFn=tc,this.registerOnCleanup=g=>{this.cleanupFn=g},this.consumerAllowSignalWrites=d}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const o=yo(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=tc,this.watch(this.registerOnCleanup)}finally{yo(o)}}cleanup(){this.cleanupFn()}}class rl{constructor(o,a,d){this.previousValue=o,this.currentValue=a,this.firstChange=d}isFirstChange(){return this.firstChange}}function Ga(){return nc}function nc(t){return t.type.prototype.ngOnChanges&&(t.setInput=Pa),Aa}function Aa(){const t=N(this),o=t?.current;if(o){const a=t.previous;if(a===Kn)t.previous=o;else for(let d in o)a[d]=o[d];t.current=null,this.ngOnChanges(o)}}function Pa(t,o,a,d){const g=this.declaredInputs[a],w=N(t)||function ee(t,o){return t[Bo]=o}(t,{previous:Kn,current:null}),I=w.current||(w.current={}),k=w.previous,j=k[g];I[g]=new rl(j&&j.currentValue,o,k===Kn),t[d]=o}Ga.ngInherit=!0;const Bo="__ngSimpleChanges__";function N(t){return t[Bo]||null}const ve=function(t,o,a){};function on(t){for(;Array.isArray(t);)t=t[Vr];return t}function Qi(t,o){return on(o[t])}function zi(t,o){return on(o[t.index])}function eo(t,o){return t.data[o]}function _r(t,o){const a=o[t];return lo(a)?a:a[Vr]}function Lo(t,o){return null==o?null:t[o]}function Ys(t){t[Ws]=0}function oa(t){1024&t[oi]||(t[oi]|=1024,ic(t,1))}function Ps(t){1024&t[oi]&&(t[oi]&=-1025,ic(t,-1))}function ic(t,o){let a=t[xr];if(null===a)return;a[Ro]+=o;let d=a;for(a=a[xr];null!==a&&(1===o&&1===d[Ro]||-1===o&&0===d[Ro]);)a[Ro]+=o,d=a,a=a[xr]}function Fn(t,o){if(256==(256&t[oi]))throw new ft(911,!1);null===t[ys]&&(t[ys]=[]),t[ys].push(o)}const Ri={lFrame:wl(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Ic(){return Ri.bindingsEnabled}function hn(){return Ri.lFrame.lView}function lr(){return Ri.lFrame.tView}function lc(t){return Ri.lFrame.contextLView=t,t[go]}function Al(t){return Ri.lFrame.contextLView=null,t}function Go(){let t=Pl();for(;null!==t&&64===t.type;)t=t.parent;return t}function Pl(){return Ri.lFrame.currentTNode}function Us(t,o){const a=Ri.lFrame;a.currentTNode=t,a.isParent=o}function cc(){return Ri.lFrame.isParent}function Rl(){return Ri.lFrame.bindingIndex++}function bs(t,o){const a=Ri.lFrame;a.bindingIndex=a.bindingRootIndex=t,dc(o)}function dc(t){Ri.lFrame.currentDirectiveIndex=t}function du(){return Ri.lFrame.currentQueryIndex}function Xs(t){Ri.lFrame.currentQueryIndex=t}function hu(t){const o=t[$n];return 2===o.type?o.declTNode:1===o.type?t[jr]:null}function Uu(t,o,a){if(a&ii.SkipSelf){let g=o,w=t;for(;!(g=g.parent,null!==g||a&ii.Host||(g=hu(w),null===g||(w=w[ns],10&g.type))););if(null===g)return!1;o=g,t=w}const d=Ri.lFrame=Oa();return d.currentTNode=o,d.lView=t,!0}function aa(t){const o=Oa(),a=t[$n];Ri.lFrame=o,o.currentTNode=a.firstChild,o.lView=t,o.tView=a,o.contextLView=t,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function Oa(){const t=Ri.lFrame,o=null===t?null:t.child;return null===o?wl(t):o}function wl(t){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=o),o}function Lc(){const t=Ri.lFrame;return Ri.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const Wn=Lc;function Fc(){const t=Lc();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function $(){return Ri.lFrame.selectedIndex}function O(t){Ri.lFrame.selectedIndex=t}function X(){const t=Ri.lFrame;return eo(t.tView,t.selectedIndex)}let ui=!0;function Yi(){return ui}function Rr(t){ui=t}function xs(t,o){for(let a=o.directiveStart,d=o.directiveEnd;a<d;a++){const w=t.data[a].type.prototype,{ngAfterContentInit:I,ngAfterContentChecked:k,ngAfterViewInit:j,ngAfterViewChecked:se,ngOnDestroy:he}=w;I&&(t.contentHooks??=[]).push(-a,I),k&&((t.contentHooks??=[]).push(a,k),(t.contentCheckHooks??=[]).push(a,k)),j&&(t.viewHooks??=[]).push(-a,j),se&&((t.viewHooks??=[]).push(a,se),(t.viewCheckHooks??=[]).push(a,se)),null!=he&&(t.destroyHooks??=[]).push(a,he)}}function Js(t,o,a){c(t,o,3,a)}function f(t,o,a,d){(3&t[oi])===a&&c(t,o,a,d)}function r(t,o){let a=t[oi];(3&a)===o&&(a&=8191,a+=1,t[oi]=a)}function c(t,o,a,d){const w=d??-1,I=o.length-1;let k=0;for(let j=void 0!==d?65535&t[Ws]:0;j<I;j++)if("number"==typeof o[j+1]){if(k=o[j],null!=d&&k>=d)break}else o[j]<0&&(t[Ws]+=65536),(k<w||-1==w)&&(b(t,a,o,j),t[Ws]=(4294901760&t[Ws])+j+2),j++}function m(t,o){ve(4,t,o);const a=yo(null);try{o.call(t)}finally{yo(a),ve(5,t,o)}}function b(t,o,a,d){const g=a[d]<0,w=a[d+1],k=t[g?-a[d]:a[d]];g?t[oi]>>13<t[Ws]>>16&&(3&t[oi])===o&&(t[oi]+=8192,m(k,w)):m(k,w)}const C=-1;class P{constructor(o,a,d){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=d}}function xe(t){return t!==C}function De(t){return 32767&t}function _e(t,o){let a=function le(t){return t>>16}(t),d=o;for(;a>0;)d=d[ns],a--;return d}let Ie=!0;function Pe(t){const o=Ie;return Ie=t,o}const tt=255,et=5;let gt=0;const st={};function pn(t,o){const a=Qt(t,o);if(-1!==a)return a;const d=o[$n];d.firstCreatePass&&(t.injectorIndex=o.length,Ct(d.data,t),Ct(o,null),Ct(d.blueprint,null));const g=kt(t,o),w=t.injectorIndex;if(xe(g)){const I=De(g),k=_e(g,o),j=k[$n].data;for(let se=0;se<8;se++)o[w+se]=k[I+se]|j[I+se]}return o[w+8]=g,w}function Ct(t,o){t.push(0,0,0,0,0,0,0,0,o)}function Qt(t,o){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===o[t.injectorIndex+8]?-1:t.injectorIndex}function kt(t,o){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let a=0,d=null,g=o;for(;null!==g;){if(d=ya(g),null===d)return C;if(a++,g=g[ns],-1!==d.injectorIndex)return d.injectorIndex|a<<16}return C}function mn(t,o,a){!function Mt(t,o,a){let d;"string"==typeof a?d=a.charCodeAt(0)||0:a.hasOwnProperty(Jr)&&(d=a[Jr]),null==d&&(d=a[Jr]=gt++);const g=d&tt;o.data[t+(g>>et)]|=1<<g}(t,o,a)}function Jt(t,o,a){if(a&ii.Optional||void 0!==t)return t;Ei()}function En(t,o,a,d){if(a&ii.Optional&&void 0===d&&(d=null),!(a&(ii.Self|ii.Host))){const g=t[$o],w=Er(void 0);try{return g?g.get(o,d,a&ii.Optional):fo(o,d,a&ii.Optional)}finally{Er(w)}}return Jt(d,0,a)}function ln(t,o,a,d=ii.Default,g){if(null!==t){if(2048&o[oi]&&!(d&ii.Self)){const I=function Wo(t,o,a,d,g){let w=t,I=o;for(;null!==w&&null!==I&&2048&I[oi]&&!(512&I[oi]);){const k=Cn(w,I,a,d|ii.Self,st);if(k!==st)return k;let j=w.parent;if(!j){const se=I[tl];if(se){const he=se.get(a,st,d);if(he!==st)return he}j=ya(I),I=I[ns]}w=j}return g}(t,o,a,d,st);if(I!==st)return I}const w=Cn(t,o,a,d,st);if(w!==st)return w}return En(o,a,d,g)}function Cn(t,o,a,d,g){const w=function wi(t){if("string"==typeof t)return t.charCodeAt(0)||0;const o=t.hasOwnProperty(Jr)?t[Jr]:void 0;return"number"==typeof o?o>=0?o&tt:Ir:o}(a);if("function"==typeof w){if(!Uu(o,t,d))return d&ii.Host?Jt(g,0,d):En(o,a,d,g);try{let I;if(I=w(d),null!=I||d&ii.Optional)return I;Ei()}finally{Wn()}}else if("number"==typeof w){let I=null,k=Qt(t,o),j=C,se=d&ii.Host?o[Fr][jr]:null;for((-1===k||d&ii.SkipSelf)&&(j=-1===k?kt(t,o):o[k+8],j!==C&&er(d,!1)?(I=o[$n],k=De(j),o=_e(j,o)):k=-1);-1!==k;){const he=o[$n];if(rr(w,k,he.data)){const ke=ai(k,o,a,I,d,se);if(ke!==st)return ke}j=o[k+8],j!==C&&er(d,o[$n].data[k+8]===se)&&rr(w,k,o)?(I=he,k=De(j),o=_e(j,o)):k=-1}}return g}function ai(t,o,a,d,g,w){const I=o[$n],k=I.data[t+8],he=Ai(k,I,a,null==d?Ss(k)&&Ie:d!=I&&0!=(3&k.type),g&ii.Host&&w===k);return null!==he?Hn(o,I,he,k):st}function Ai(t,o,a,d,g){const w=t.providerIndexes,I=o.data,k=1048575&w,j=t.directiveStart,he=w>>20,dt=g?k+he:t.directiveEnd;for(let Dt=d?k:k+he;Dt<dt;Dt++){const un=I[Dt];if(Dt<j&&a===un||Dt>=j&&un.type===a)return Dt}if(g){const Dt=I[j];if(Dt&&Is(Dt)&&Dt.type===a)return j}return null}function Hn(t,o,a,d){let g=t[a];const w=o.data;if(function R(t){return t instanceof P}(g)){const I=g;I.resolving&&function qt(t,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${t}`:"";throw new ft(-200,`Circular dependency in DI detected for ${t}${a}`)}(function Pt(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():Xt(t)}(w[a]));const k=Pe(I.canSeeViewProviders);I.resolving=!0;const se=I.injectImpl?Er(I.injectImpl):null;Uu(t,d,ii.Default);try{g=t[a]=I.factory(void 0,w,t,d),o.firstCreatePass&&a>=d.directiveStart&&function Tr(t,o,a){const{ngOnChanges:d,ngOnInit:g,ngDoCheck:w}=o.type.prototype;if(d){const I=nc(o);(a.preOrderHooks??=[]).push(t,I),(a.preOrderCheckHooks??=[]).push(t,I)}g&&(a.preOrderHooks??=[]).push(0-t,g),w&&((a.preOrderHooks??=[]).push(t,w),(a.preOrderCheckHooks??=[]).push(t,w))}(a,w[a],o)}finally{null!==se&&Er(se),Pe(k),I.resolving=!1,Wn()}}return g}function rr(t,o,a){return!!(a[o+(t>>et)]&1<<t)}function er(t,o){return!(t&ii.Self||t&ii.Host&&o)}class or{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,d){return ln(this._tNode,this._lView,o,_i(d),a)}}function Ir(){return new or(Go(),hn())}function $r(t){return Rt(()=>{const o=t.prototype.constructor,a=o[Ar]||Rs(o),d=Object.prototype;let g=Object.getPrototypeOf(t.prototype).constructor;for(;g&&g!==d;){const w=g[Ar]||Rs(g);if(w&&w!==a)return w;g=Object.getPrototypeOf(g)}return w=>new w})}function Rs(t){return Bn(t)?()=>{const o=Rs(St(t));return o&&o()}:ko(t)}function ya(t){const o=t[$n],a=o.type;return 2===a?o.declTNode:1===a?t[jr]:null}function Vs(t){return function It(t,o){if("class"===o)return t.classes;if("style"===o)return t.styles;const a=t.attrs;if(a){const d=a.length;let g=0;for(;g<d;){const w=a[g];if(Xi(w))break;if(0===w)g+=2;else if("number"==typeof w)for(g++;g<d&&"string"==typeof a[g];)g++;else{if(w===o)return a[g+1];g+=2}}}return null}(Go(),t)}const hr="__parameters__";function Hr(t,o,a){return Rt(()=>{const d=function ds(t){return function(...a){if(t){const d=t(...a);for(const g in d)this[g]=d[g]}}}(o);function g(...w){if(this instanceof g)return d.apply(this,w),this;const I=new g(...w);return k.annotation=I,k;function k(j,se,he){const ke=j.hasOwnProperty(hr)?j[hr]:Object.defineProperty(j,hr,{value:[]})[hr];for(;ke.length<=he;)ke.push(null);return(ke[he]=ke[he]||[]).push(I),j}}return a&&(g.prototype=Object.create(a.prototype)),g.prototype.ngMetadataName=t,g.annotationCls=g,g})}function pu(t,o){t.forEach(a=>Array.isArray(a)?pu(a,o):o(a))}function hh(t,o,a){o>=t.length?t.push(a):t.splice(o,0,a)}function Cl(t,o){return o>=t.length-1?t.pop():t.splice(o,1)[0]}function sl(t,o,a){let d=pc(t,o);return d>=0?t[1|d]=a:(d=~d,function M_(t,o,a,d){let g=t.length;if(g==o)t.push(a,d);else if(1===g)t.push(d,t[0]),t[0]=a;else{for(g--,t.push(t[g-1],t[g]);g>o;)t[g]=t[g-2],g--;t[o]=a,t[o+1]=d}}(t,d,o,a)),d}function fh(t,o){const a=pc(t,o);if(a>=0)return t[1|a]}function pc(t,o){return function mc(t,o,a){let d=0,g=t.length>>a;for(;g!==d;){const w=d+(g-d>>1),I=t[w<<a];if(o===I)return w<<a;I>o?g=w:d=w+1}return~(g<<a)}(t,o,1)}const Np=ur(Hr("Inject",t=>({token:t})),-1),mh=ur(Hr("Optional"),8),vf=ur(Hr("SkipSelf"),4);function vh(t){return 128==(128&t.flags)}var Sf=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(Sf||{});const xh=new Map;let $p=0;const Ya="__ngContext__";function ba(t,o){lo(o)?(t[Ya]=o[_s],function Hp(t){xh.set(t[_s],t)}(o)):t[Ya]=o}let bu;function xu(t,o){return bu(t,o)}function wu(t){const o=t[xr];return Eo(o)?o[xr]:o}function Pf(t){return Ku(t[Ts])}function Rf(t){return Ku(t[Po])}function Ku(t){for(;null!==t&&!Eo(t);)t=t[Po];return t}function Yu(t,o,a,d,g){if(null!=d){let w,I=!1;Eo(d)?w=d:lo(d)&&(I=!0,d=d[Vr]);const k=on(d);0===t&&null!==a?null==g?Dh(o,a,k):yc(o,a,k,g||null,!0):1===t&&null!==a?yc(o,a,k,g||null,!0):2===t?function Pd(t,o,a){const d=Th(t,o);d&&function Yp(t,o,a,d){t.removeChild(o,a,d)}(t,d,o,a)}(o,k,I):3===t&&o.destroyNode(k),null!=w&&function em(t,o,a,d,g){const w=a[Yo];w!==on(a)&&Yu(o,t,d,w,g);for(let k=Zr;k<a.length;k++){const j=a[k];Rd(j[$n],j,t,o,d,w)}}(o,t,w,a,g)}}function es(t,o,a){return t.createElement(o,a)}function Dl(t,o){const a=t[Oo],d=a.indexOf(o);Ps(o),a.splice(d,1)}function xa(t,o){if(t.length<=Zr)return;const a=Zr+o,d=t[a];if(d){const g=d[is];null!==g&&g!==t&&Dl(g,d),o>0&&(t[a-1][Po]=d[Po]);const w=Cl(t,Zr+o);!function Eu(t,o){Rd(t,o,o[bi],2,null,null),o[Vr]=null,o[jr]=null}(d[$n],d);const I=w[Ko];null!==I&&I.detachView(w[$n]),d[xr]=null,d[Po]=null,d[oi]&=-129}return d}function Fa(t,o){if(!(256&o[oi])){const a=o[bi];o[Fs]?.destroy(),o[Zs]?.destroy(),a.destroyNode&&Rd(t,o,a,3,null,null),function Xr(t){let o=t[Ts];if(!o)return hs(t[$n],t);for(;o;){let a=null;if(lo(o))a=o[Ts];else{const d=o[Zr];d&&(a=d)}if(!a){for(;o&&!o[Po]&&o!==t;)lo(o)&&hs(o[$n],o),o=o[xr];null===o&&(o=t),lo(o)&&hs(o[$n],o),a=o&&o[Po]}o=a}}(o)}}function hs(t,o){if(!(256&o[oi])){o[oi]&=-129,o[oi]|=256,function js(t,o){let a;if(null!=t&&null!=(a=t.destroyHooks))for(let d=0;d<a.length;d+=2){const g=o[a[d]];if(!(g instanceof P)){const w=a[d+1];if(Array.isArray(w))for(let I=0;I<w.length;I+=2){const k=g[w[I]],j=w[I+1];ve(4,k,j);try{j.call(k)}finally{ve(5,k,j)}}else{ve(4,g,w);try{w.call(g)}finally{ve(5,g,w)}}}}}(t,o),function Uc(t,o){const a=t.cleanup,d=o[Ds];if(null!==a)for(let w=0;w<a.length-1;w+=2)if("string"==typeof a[w]){const I=a[w+3];I>=0?d[I]():d[-I].unsubscribe(),w+=2}else a[w].call(d[a[w+1]]);null!==d&&(o[Ds]=null);const g=o[ys];if(null!==g){o[ys]=null;for(let w=0;w<g.length;w++)(0,g[w])()}}(t,o),1===o[$n].type&&o[bi].destroy();const a=o[is];if(null!==a&&Eo(o[xr])){a!==o[xr]&&Dl(a,o);const d=o[Ko];null!==d&&d.detachView(t)}!function _c(t){xh.delete(t[_s])}(o)}}function Ch(t,o,a){return function Cu(t,o,a){let d=o;for(;null!==d&&40&d.type;)d=(o=d).parent;if(null===d)return a[Vr];{const{componentOffset:g}=d;if(g>-1){const{encapsulation:w}=t.data[d.directiveStart+g];if(w===wn.None||w===wn.Emulated)return null}return zi(d,a)}}(t,o.parent,a)}function yc(t,o,a,d,g){t.insertBefore(o,a,d,g)}function Dh(t,o,a){t.appendChild(o,a)}function Lf(t,o,a,d,g){null!==d?yc(t,o,a,d,g):Dh(t,o,a)}function Th(t,o){return t.parentNode(o)}let Ju,nm,Oh,Mh=function Vc(t,o,a){return 40&t.type?zi(t,a):null};function Sh(t,o,a,d){const g=Ch(t,d,o),w=o[bi],k=function vc(t,o,a){return Mh(t,o,a)}(d.parent||o[jr],d,o);if(null!=g)if(Array.isArray(a))for(let j=0;j<a.length;j++)Lf(w,g,a[j],k,!1);else Lf(w,g,a,k,!1);void 0!==Ju&&Ju(w,d,o,a,g)}function Ih(t,o){if(null!==o){const a=o.type;if(3&a)return zi(o,t);if(4&a)return Qp(-1,t[o.index]);if(8&a){const d=o.child;if(null!==d)return Ih(t,d);{const g=t[o.index];return Eo(g)?Qp(-1,g):on(g)}}if(32&a)return xu(o,t)()||on(t[o.index]);{const d=Jp(t,o);return null!==d?Array.isArray(d)?d[0]:Ih(wu(t[Fr]),d):Ih(t,o.next)}}return null}function Jp(t,o){return null!==o?t[Fr][jr].projection[o.projection]:null}function Qp(t,o){const a=Zr+t+1;if(a<o.length){const d=o[a],g=d[$n].firstChild;if(null!==g)return Ih(d,g)}return o[Yo]}function Ah(t,o,a,d,g,w,I){for(;null!=a;){const k=d[a.index],j=a.type;if(I&&0===o&&(k&&ba(on(k),d),a.flags|=2),32!=(32&a.flags))if(8&j)Ah(t,o,a.child,d,g,w,!1),Yu(o,t,g,k,w);else if(32&j){const se=xu(a,d);let he;for(;he=se();)Yu(o,t,g,he,w);Yu(o,t,g,k,w)}else 16&j?jc(t,o,d,a,g,w):Yu(o,t,g,k,w);a=I?a.projectionNext:a.next}}function Rd(t,o,a,d,g,w){Ah(a,d,t.firstChild,o,g,w,!1)}function jc(t,o,a,d,g,w){const I=a[Fr],j=I[jr].projection[d.projection];if(Array.isArray(j))for(let se=0;se<j.length;se++)Yu(o,t,g,j[se],w);else{let se=j;const he=I[xr];vh(d)&&(se.flags|=128),Ah(t,o,se,he,g,w,!0)}}function Od(t,o,a){""===a?t.removeAttribute(o,"class"):t.setAttribute(o,"class",a)}function Ph(t,o,a){const{mergedAttrs:d,classes:g,styles:w}=a;null!==d&&xt(t,o,d),null!==g&&Od(t,o,g),null!==w&&function Qu(t,o,a){t.setAttribute(o,"style",a)}(t,o,w)}function bg(t){nm=t}function xg(t){return function kh(){if(void 0===Oh&&(Oh=null,Gi.trustedTypes))try{Oh=Gi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return Oh}()?.createScriptURL(t)||t}class Nf{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Dn})`}}function $c(t){return t instanceof Nf?t.changingThisBreaksApplicationSecurity:t}function jl(t,o){const a=function Fh(t){return t instanceof Nf&&t.getTypeName()||null}(t);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see ${Dn})`)}return a===o}const Fd=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var zd=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(zd||{});function am(t){const o=Vd();return o?o.sanitize(zd.URL,t)||"":jl(t,"URL")?$c(t):function zf(t){return(t=String(t)).match(Fd)?t:"unsafe:"+t}(Xt(t))}function Sg(t){const o=Vd();if(o)return xg(o.sanitize(zd.RESOURCE_URL,t)||"");if(jl(t,"ResourceURL"))return xg($c(t));throw new ft(904,!1)}function Ag(t,o,a){return function Ud(t,o){return"src"===o&&("embed"===t||"frame"===t||"iframe"===t||"media"===t||"script"===t)||"href"===o&&("base"===t||"link"===t)?Sg:am}(o,a)(t)}function Vd(){const t=hn();return t&&t[cs].sanitizer}class no{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=ti({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Vh=new no("ENVIRONMENT_INITIALIZER"),Pg=new no("INJECTOR",-1),Rg=new no("INJECTOR_DEF_TYPES");class jh{get(o,a=ct){if(a===ct){const d=new Error(`NullInjectorError: No provider for ${ht(o)}!`);throw d.name="NullInjectorError",d}return a}}function jd(t){return{\u0275providers:t}}function $f(...t){return{\u0275providers:Og(0,t),\u0275fromNgModule:!0}}function Og(t,...o){const a=[],d=new Set;let g;const w=I=>{a.push(I)};return pu(o,I=>{const k=I;Du(k,w,[],d)&&(g||=[],g.push(k))}),void 0!==g&&kg(g,w),a}function kg(t,o){for(let a=0;a<t.length;a++){const{ngModule:d,providers:g}=t[a];Hf(g,w=>{o(w,d)})}}function Du(t,o,a,d){if(!(t=St(t)))return!1;let g=null,w=Yr(t);const I=!w&&ri(t);if(w||I){if(I&&!I.standalone)return!1;g=t}else{const j=t.ngModule;if(w=Yr(j),!w)return!1;g=j}const k=d.has(g);if(I){if(k)return!1;if(d.add(g),I.dependencies){const j="function"==typeof I.dependencies?I.dependencies():I.dependencies;for(const se of j)Du(se,o,a,d)}}else{if(!w)return!1;{if(null!=w.imports&&!k){let se;d.add(g);try{pu(w.imports,he=>{Du(he,o,a,d)&&(se||=[],se.push(he))})}finally{}void 0!==se&&kg(se,o)}if(!k){const se=ko(g)||(()=>new g);o({provide:g,useFactory:se,deps:An},g),o({provide:Rg,useValue:g,multi:!0},g),o({provide:Vh,useValue:()=>_n(g),multi:!0},g)}const j=w.providers;if(null!=j&&!k){const se=t;Hf(j,he=>{o(he,se)})}}}return g!==t&&void 0!==t.providers}function Hf(t,o){for(let a of t)Tn(a)&&(a=a.\u0275providers),Array.isArray(a)?Hf(a,o):o(a)}const $d=Xe({provide:String,useValue:Xe});function Hd(t){return null!==t&&"object"==typeof t&&$d in t}function Zc(t){return"function"==typeof t}const Gd=new no("Set Injector scope."),rd={},Wd={};let Wf;function Zf(){return void 0===Wf&&(Wf=new jh),Wf}class $l{}class qc extends $l{get destroyed(){return this._destroyed}constructor(o,a,d,g){super(),this.parent=a,this.source=d,this.scopes=g,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,cm(o,I=>this.processProvider(I)),this.records.set(Pg,bc(void 0,this)),g.has("environment")&&this.records.set($l,bc(void 0,this));const w=this.records.get(Gd);null!=w&&"string"==typeof w.value&&this.scopes.add(w.value),this.injectorDefTypes=new Set(this.get(Rg.multi,An,ii.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const a of this._ngOnDestroyHooks)a.ngOnDestroy();const o=this._onDestroyHooks;this._onDestroyHooks=[];for(const a of o)a()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(o){return this.assertNotDestroyed(),this._onDestroyHooks.push(o),()=>this.removeOnDestroy(o)}runInContext(o){this.assertNotDestroyed();const a=mt(this),d=Er(void 0);try{return o()}finally{mt(a),Er(d)}}get(o,a=ct,d=ii.Default){if(this.assertNotDestroyed(),o.hasOwnProperty(So))return o[So](this);d=_i(d);const w=mt(this),I=Er(void 0);try{if(!(d&ii.SkipSelf)){let j=this.records.get(o);if(void 0===j){const se=function H_(t){return"function"==typeof t||"object"==typeof t&&t instanceof no}(o)&&Gr(o);j=se&&this.injectableDefInScope(se)?bc(qf(o),rd):null,this.records.set(o,j)}if(null!=j)return this.hydrate(o,j)}return(d&ii.Self?Zf():this.parent).get(o,a=d&ii.Optional&&a===ct?null:a)}catch(k){if("NullInjectorError"===k.name){if((k[wt]=k[wt]||[]).unshift(ht(o)),w)throw k;return function Be(t,o,a,d){const g=t[wt];throw o[He]&&g.unshift(o[He]),t.message=function Ft(t,o,a,d=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let g=ht(o);if(Array.isArray(o))g=o.map(ht).join(" -> ");else if("object"==typeof o){let w=[];for(let I in o)if(o.hasOwnProperty(I)){let k=o[I];w.push(I+":"+("string"==typeof k?JSON.stringify(k):ht(k)))}g=`{${w.join(", ")}}`}return`${a}${d?"("+d+")":""}[${g}]: ${t.replace(fn,"\n  ")}`}("\n"+t.message,g,a,d),t.ngTokenPath=g,t[wt]=null,t}(k,o,"R3InjectorError",this.source)}throw k}finally{Er(I),mt(w)}}resolveInjectorInitializers(){const o=mt(this),a=Er(void 0);try{const g=this.get(Vh.multi,An,ii.Self);for(const w of g)w()}finally{mt(o),Er(a)}}toString(){const o=[],a=this.records;for(const d of a.keys())o.push(ht(d));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ft(205,!1)}processProvider(o){let a=Zc(o=St(o))?o:St(o&&o.provide);const d=function Hh(t){return Hd(t)?bc(void 0,t.useValue):bc(od(t),rd)}(o);if(Zc(o)||!0!==o.multi)this.records.get(a);else{let g=this.records.get(a);g||(g=bc(void 0,rd,!0),g.factory=()=>Cr(g.multi),this.records.set(a,g)),a=o,g.multi.push(o)}this.records.set(a,d)}hydrate(o,a){return a.value===rd&&(a.value=Wd,a.value=a.factory()),"object"==typeof a.value&&a.value&&function Fg(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=St(o.providedIn);return"string"==typeof a?"any"===a||this.scopes.has(a):this.injectorDefTypes.has(a)}removeOnDestroy(o){const a=this._onDestroyHooks.indexOf(o);-1!==a&&this._onDestroyHooks.splice(a,1)}}function qf(t){const o=Gr(t),a=null!==o?o.factory:ko(t);if(null!==a)return a;if(t instanceof no)throw new ft(204,!1);if(t instanceof Function)return function Ea(t){const o=t.length;if(o>0)throw function mu(t,o){const a=[];for(let d=0;d<t;d++)a.push(o);return a}(o,"?"),new ft(204,!1);const a=function Do(t){return t&&(t[sr]||t[bo])||null}(t);return null!==a?()=>a.factory(t):()=>new t}(t);throw new ft(204,!1)}function od(t,o,a){let d;if(Zc(t)){const g=St(t);return ko(g)||qf(g)}if(Hd(t))d=()=>St(t.useValue);else if(function $h(t){return!(!t||!t.useFactory)}(t))d=()=>t.useFactory(...Cr(t.deps||[]));else if(function lm(t){return!(!t||!t.useExisting)}(t))d=()=>_n(St(t.useExisting));else{const g=St(t&&(t.useClass||t.provide));if(!function Lg(t){return!!t.deps}(t))return ko(g)||qf(g);d=()=>new g(...Cr(t.deps))}return d}function bc(t,o,a=!1){return{factory:t,value:o,multi:a?[]:void 0}}function cm(t,o){for(const a of t)Array.isArray(a)?cm(a,o):a&&Tn(a)?cm(a.\u0275providers,o):o(a)}const Ng=new no("AppId",{providedIn:"root",factory:()=>G_}),G_="ng",Bg=new no("Platform Initializer"),um=new no("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),W_=new no("AnimationModuleType"),zg=new no("CSP nonce",{providedIn:"root",factory:()=>function ed(){if(void 0!==nm)return nm;if(typeof document<"u")return document;throw new ft(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let _m=(t,o,a)=>null;function Wh(t,o,a=!1){return _m(t,o,a)}class Y_{}class Gg{}class wm{resolveComponentFactory(o){throw function Wg(t){const o=Error(`No component factory found for ${ht(t)}.`);return o.ngComponent=t,o}(o)}}let Xc=(()=>{class o{}return o.NULL=new wm,o})();function ep(){return Jc(Go(),hn())}function Jc(t,o){return new ad(zi(t,o))}let ad=(()=>{class o{constructor(d){this.nativeElement=d}}return o.__NG_ELEMENT_ID__=ep,o})();function Zg(t){return t instanceof ad?t.nativeElement:t}class tp{}let np=(()=>{class o{constructor(){this.destroyNode=null}}return o.__NG_ELEMENT_ID__=()=>function la(){const t=hn(),a=_r(Go().index,t);return(lo(a)?a:t)[bi]}(),o})(),Yd=(()=>{var t;class o{}return(t=o).\u0275prov=ti({token:t,providedIn:"root",factory:()=>null}),o})();class Mu{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const Xa=new Mu("16.2.3"),Xd={};function xc(t){if(!Mi()&&!function Ve(){return pt}())throw new ft(-203,!1)}function cd(t,o=null,a=null,d){const g=Tm(t,o,a,d);return g.resolveInjectorInitializers(),g}function Tm(t,o=null,a=null,d,g=new Set){const w=[a||An,$f(t)];return d=d||("object"==typeof t?void 0:ht(t)),new qc(w,o||Zf(),d||null,g)}let cl=(()=>{var t;class o{static create(d,g){if(Array.isArray(d))return cd({name:""},g,d,"");{const w=d.name??"";return cd({name:w},d.parent,d.providers,w)}}}return(t=o).THROW_IF_NOT_FOUND=ct,t.NULL=new jh,t.\u0275prov=ti({token:t,providedIn:"any",factory:()=>_n(Pg)}),t.__NG_ELEMENT_ID__=-1,o})(),Ja=(()=>{var t;class o{}return(t=o).__NG_ELEMENT_ID__=sp,t.__NG_ENV_ID__=a=>a,o})();class Kg extends Ja{constructor(o){super(),this._lView=o}onDestroy(o){return Fn(this._lView,o),()=>function ma(t,o){if(null===t[ys])return;const a=t[ys].indexOf(o);-1!==a&&t[ys].splice(a,1)}(this._lView,o)}}function sp(){return new Kg(hn())}function Yh(t){return o=>{setTimeout(t,void 0,o)}}const Hl=class Mm extends S.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,d){let g=o,w=a||(()=>null),I=d;if(o&&"object"==typeof o){const j=o;g=j.next?.bind(j),w=j.error?.bind(j),I=j.complete?.bind(j)}this.__isAsync&&(w=Yh(w),g&&(g=Yh(g)),I&&(I=Yh(I)));const k=super.subscribe({next:g,error:w,complete:I});return o instanceof Re.w0&&o.add(k),k}};function Sm(...t){}class fs{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:d=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Hl(!1),this.onMicrotaskEmpty=new Hl(!1),this.onStable=new Hl(!1),this.onError=new Hl(!1),typeof Zone>"u")throw new ft(908,!1);Zone.assertZonePatched();const g=this;g._nesting=0,g._outer=g._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(g._inner=g._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(g._inner=g._inner.fork(Zone.longStackTraceZoneSpec)),g.shouldCoalesceEventChangeDetection=!d&&a,g.shouldCoalesceRunChangeDetection=d,g.lastRequestAnimationFrameId=-1,g.nativeRequestAnimationFrame=function ap(){const t="function"==typeof Gi.requestAnimationFrame;let o=Gi[t?"requestAnimationFrame":"setTimeout"],a=Gi[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&o&&a){const d=o[Zone.__symbol__("OriginalDelegate")];d&&(o=d);const g=a[Zone.__symbol__("OriginalDelegate")];g&&(a=g)}return{nativeRequestAnimationFrame:o,nativeCancelAnimationFrame:a}}().nativeRequestAnimationFrame,function Im(t){const o=()=>{!function Gl(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Gi,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Qc(t),t.isCheckStableRunning=!0,lp(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Qc(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,d,g,w,I,k)=>{try{return Su(t),a.invokeTask(g,w,I,k)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===w.type||t.shouldCoalesceRunChangeDetection)&&o(),Am(t)}},onInvoke:(a,d,g,w,I,k,j)=>{try{return Su(t),a.invoke(g,w,I,k,j)}finally{t.shouldCoalesceRunChangeDetection&&o(),Am(t)}},onHasTask:(a,d,g,w)=>{a.hasTask(g,w),d===g&&("microTask"==w.change?(t._hasPendingMicrotasks=w.microTask,Qc(t),lp(t)):"macroTask"==w.change&&(t.hasPendingMacrotasks=w.macroTask))},onHandleError:(a,d,g,w)=>(a.handleError(g,w),t.runOutsideAngular(()=>t.onError.emit(w)),!1)})}(g)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!fs.isInAngularZone())throw new ft(909,!1)}static assertNotInAngularZone(){if(fs.isInAngularZone())throw new ft(909,!1)}run(o,a,d){return this._inner.run(o,a,d)}runTask(o,a,d,g){const w=this._inner,I=w.scheduleEventTask("NgZoneEvent: "+g,o,Yg,Sm,Sm);try{return w.runTask(I,a,d)}finally{w.cancelTask(I)}}runGuarded(o,a,d){return this._inner.runGuarded(o,a,d)}runOutsideAngular(o){return this._outer.run(o)}}const Yg={};function lp(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Qc(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function Su(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Am(t){t._nesting--,lp(t)}class Xh{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Hl,this.onMicrotaskEmpty=new Hl,this.onStable=new Hl,this.onError=new Hl}run(o,a,d){return o.apply(a,d)}runGuarded(o,a,d){return o.apply(a,d)}runOutsideAngular(o){return o()}runTask(o,a,d,g){return o.apply(a,d)}}const Jh=new no("",{providedIn:"root",factory:Qh});function Qh(){const t=qn(fs);let o=!0;const a=new K.y(g=>{o=t.isStable&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks,t.runOutsideAngular(()=>{g.next(o),g.complete()})}),d=new K.y(g=>{let w;t.runOutsideAngular(()=>{w=t.onStable.subscribe(()=>{fs.assertNotInAngularZone(),queueMicrotask(()=>{!o&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks&&(o=!0,g.next(!0))})})});const I=t.onUnstable.subscribe(()=>{fs.assertInAngularZone(),o&&(o=!1,t.runOutsideAngular(()=>{g.next(!1)}))});return()=>{w.unsubscribe(),I.unsubscribe()}});return(0,l.T)(a,d.pipe((0,nt.B)()))}function ef(t){return t.ownerDocument.defaultView}function eu(t){return t instanceof Function?t():t}let tf=(()=>{var t;class o{constructor(){this.callbacks=new Set,this.deferredCallbacks=new Set,this.renderDepth=0,this.runningCallbacks=!1}begin(){if(this.runningCallbacks)throw new ft(102,!1);this.renderDepth++}end(){if(this.renderDepth--,0===this.renderDepth)try{this.runningCallbacks=!0;for(const d of this.callbacks)d.invoke()}finally{this.runningCallbacks=!1;for(const d of this.deferredCallbacks)this.callbacks.add(d);this.deferredCallbacks.clear()}}register(d){(this.runningCallbacks?this.deferredCallbacks:this.callbacks).add(d)}unregister(d){this.callbacks.delete(d),this.deferredCallbacks.delete(d)}ngOnDestroy(){this.callbacks.clear(),this.deferredCallbacks.clear()}}return(t=o).\u0275prov=ti({token:t,providedIn:"root",factory:()=>new t}),o})();function nh(t){for(;t;){t[oi]|=64;const o=wu(t);if(Ks(t)&&!o)return t;t=o}return null}function Pm(t){return t.ngOriginalError}class wc{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o);this._console.error("ERROR",o),a&&this._console.error("ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&Pm(o);for(;a&&Pm(a);)a=Pm(a);return a||null}}const cp=new no("",{providedIn:"root",factory:()=>!1});class hd extends yl{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(o){this._lView=o}onConsumerDependencyMayHaveChanged(){nh(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(o,a,d){const g=yo(this);this.trackingVersion++;try{o(a,d)}finally{yo(g)}}destroy(){this.trackingVersion++}}let rf=null;function n_(){return rf??=new hd,rf}function Au(t,o){return t[o]??n_()}function fd(t,o){const a=n_();a.hasReadASignal&&(t[o]=rf,a.lView=t,rf=new hd)}const tr={};function sf(t){fp(lr(),hn(),$()+t,!1)}function fp(t,o,a,d){if(!d)if(3==(3&o[oi])){const w=t.preOrderCheckHooks;null!==w&&Js(o,w,a)}else{const w=t.preOrderHooks;null!==w&&f(o,w,0,a)}O(a)}function pd(t,o=ii.Default){const a=hn();return null===a?_n(t,o):ln(Go(),a,St(t),o)}function pp(){throw new Error("invalid")}function af(t,o,a,d,g,w,I,k,j,se,he){const ke=o.blueprint.slice();return ke[Vr]=g,ke[oi]=140|d,(null!==se||t&&2048&t[oi])&&(ke[oi]|=2048),Ys(ke),ke[xr]=ke[ns]=t,ke[go]=a,ke[cs]=I||t&&t[cs],ke[bi]=k||t&&t[bi],ke[$o]=j||t&&t[$o]||null,ke[jr]=w,ke[_s]=function va(){return $p++}(),ke[Ms]=he,ke[tl]=se,ke[Fr]=2==o.type?t[Fr]:ke,ke}function md(t,o,a,d,g){let w=t.data[o];if(null===w)w=function mp(t,o,a,d,g){const w=Pl(),I=cc(),j=t.data[o]=function Om(t,o,a,d,g,w){let I=o?o.injectorIndex:-1,k=0;return function Wa(){return null!==Ri.skipHydrationRootTNode}()&&(k|=128),{type:a,index:d,insertBeforeIndex:null,injectorIndex:I,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:k,providerIndexes:0,value:g,attrs:w,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,I?w:w&&w.parent,a,o,d,g);return null===t.firstChild&&(t.firstChild=j),null!==w&&(I?null==w.child&&null!==j.parent&&(w.child=j):null===w.next&&(w.next=j,j.prev=w)),j}(t,o,a,d,g),function kc(){return Ri.lFrame.inI18n}()&&(w.flags|=32);else if(64&w.type){w.type=a,w.value=d,w.attrs=g;const I=function ga(){const t=Ri.lFrame,o=t.currentTNode;return t.isParent?o:o.parent}();w.injectorIndex=null===I?-1:I.injectorIndex}return Us(w,!0),w}function lf(t,o,a,d){if(0===a)return-1;const g=o.length;for(let w=0;w<a;w++)o.push(d),t.blueprint.push(d),t.data.push(null);return g}function gp(t,o,a,d,g){const w=Au(o,Fs),I=$(),k=2&d;try{if(O(-1),k&&o.length>Xn&&fp(t,o,Xn,!1),ve(k?2:0,g),k)w.runInContext(a,d,g);else{const se=yo(null);try{a(d,g)}finally{yo(se)}}}finally{k&&null===o[Fs]&&fd(o,Fs),O(I),ve(k?3:1,g)}}function gd(t,o,a){if(ta(o)){const d=yo(null);try{const w=o.directiveEnd;for(let I=o.directiveStart;I<w;I++){const k=t.data[I];k.contentQueries&&k.contentQueries(1,a[I],I)}}finally{yo(d)}}}function _d(t,o,a){Ic()&&(function Ou(t,o,a,d){const g=a.directiveStart,w=a.directiveEnd;Ss(a)&&function s_(t,o,a){const d=zi(o,t),g=Rm(a);let I=16;a.signals?I=4096:a.onPush&&(I=64);const k=uf(t,af(t,g,null,I,d,o,null,t[cs].rendererFactory.createRenderer(d,a),null,null,null));t[o.index]=k}(o,a,t.data[g+a.componentOffset]),t.firstCreatePass||pn(a,o),ba(d,o);const I=a.initialInputs;for(let k=g;k<w;k++){const j=t.data[k],se=Hn(o,t,k,a);ba(se,o),null!==I&&a_(0,k-g,se,j,0,I),Is(j)&&(_r(a.index,o)[go]=Hn(o,t,k,a))}}(t,o,a,zi(a,o)),64==(64&a.flags)&&Zl(t,o,a))}function Pu(t,o,a=zi){const d=o.localNames;if(null!==d){let g=o.index+1;for(let w=0;w<d.length;w+=2){const I=d[w+1],k=-1===I?a(o,t):t[I];t[g++]=k}}}function Rm(t){const o=t.tView;return null===o||o.incompleteFirstPass?t.tView=yd(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):o}function yd(t,o,a,d,g,w,I,k,j,se,he){const ke=Xn+d,dt=ke+g,Dt=function _p(t,o){const a=[];for(let d=0;d<o;d++)a.push(d<t?null:tr);return a}(ke,dt),un="function"==typeof se?se():se;return Dt[$n]={type:t,blueprint:Dt,template:a,queries:null,viewQuery:k,declTNode:o,data:Dt.slice().fill(null,ke),bindingStartIndex:ke,expandoStartIndex:dt,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof w?w():w,pipeRegistry:"function"==typeof I?I():I,firstChild:null,schemas:j,consts:un,incompleteFirstPass:!1,ssrId:he}}let oh=t=>null;function km(t,o,a,d){for(let g in t)if(t.hasOwnProperty(g)){a=null===a?{}:a;const w=t[g];null===d?Lm(a,o,g,w):d.hasOwnProperty(g)&&Lm(a,o,d[g],w)}return a}function Lm(t,o,a,d){t.hasOwnProperty(a)?t[a].push(o,d):t[a]=[o,d]}function ca(t,o,a,d,g,w,I,k){const j=zi(o,a);let he,se=o.inputs;!k&&null!=se&&(he=se[d])?(ah(t,a,he,d,g),Ss(o)&&function i_(t,o){const a=_r(o,t);16&a[oi]||(a[oi]|=64)}(a,o.index)):3&o.type&&(d=function xp(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(d),g=null!=I?I(g,o.value||"",d):g,w.setProperty(j,d,g))}function wp(t,o,a,d){if(Ic()){const g=null===d?null:{"":-1},w=function Cp(t,o){const a=t.directiveRegistry;let d=null,g=null;if(a)for(let w=0;w<a.length;w++){const I=a[w];if(mo(o,I.selectors,!1))if(d||(d=[]),Is(I))if(null!==I.findHostDirectiveDefs){const k=[];g=g||new Map,I.findHostDirectiveDefs(I,k,g),d.unshift(...k,I),Dp(t,o,k.length)}else d.unshift(I),Dp(t,o,0);else g=g||new Map,I.findHostDirectiveDefs?.(I,d,g),d.push(I)}return null===d?null:[d,g]}(t,a);let I,k;null===w?I=k=null:[I,k]=w,null!==I&&Ep(t,o,a,I,g,k),g&&function r_(t,o,a){if(o){const d=t.localNames=[];for(let g=0;g<o.length;g+=2){const w=a[o[g+1]];if(null==w)throw new ft(-301,!1);d.push(o[g],w)}}}(a,d,g)}a.mergedAttrs=Lr(a.mergedAttrs,a.attrs)}function Ep(t,o,a,d,g,w){for(let se=0;se<d.length;se++)mn(pn(a,o),t,d[se].type);!function Fm(t,o,a){t.flags|=1,t.directiveStart=o,t.directiveEnd=o+a,t.providerIndexes=o}(a,t.data.length,d.length);for(let se=0;se<d.length;se++){const he=d[se];he.providersResolver&&he.providersResolver(he)}let I=!1,k=!1,j=lf(t,o,d.length,null);for(let se=0;se<d.length;se++){const he=d[se];a.mergedAttrs=Lr(a.mergedAttrs,he.hostAttrs),iy(t,a,o,j,he),o_(j,he,g),null!==he.contentQueries&&(a.flags|=4),(null!==he.hostBindings||null!==he.hostAttrs||0!==he.hostVars)&&(a.flags|=64);const ke=he.type.prototype;!I&&(ke.ngOnChanges||ke.ngOnInit||ke.ngDoCheck)&&((t.preOrderHooks??=[]).push(a.index),I=!0),!k&&(ke.ngOnChanges||ke.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(a.index),k=!0),j++}!function bp(t,o,a){const g=o.directiveEnd,w=t.data,I=o.attrs,k=[];let j=null,se=null;for(let he=o.directiveStart;he<g;he++){const ke=w[he],dt=a?a.get(ke):null,un=dt?dt.outputs:null;j=km(ke.inputs,he,j,dt?dt.inputs:null),se=km(ke.outputs,he,se,un);const Vn=null===j||null===I||Pr(o)?null:l_(j,he,I);k.push(Vn)}null!==j&&(j.hasOwnProperty("class")&&(o.flags|=8),j.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=k,o.inputs=j,o.outputs=se}(t,a,w)}function Zl(t,o,a){const d=a.directiveStart,g=a.directiveEnd,w=a.index,I=function Cd(){return Ri.lFrame.currentDirectiveIndex}();try{O(w);for(let k=d;k<g;k++){const j=t.data[k],se=o[k];dc(k),(null!==j.hostBindings||0!==j.hostVars||null!==j.hostAttrs)&&ku(j,se)}}finally{O(-1),dc(I)}}function ku(t,o){null!==t.hostBindings&&t.hostBindings(1,o)}function Dp(t,o,a){o.componentOffset=a,(t.components??=[]).push(o.index)}function o_(t,o,a){if(a){if(o.exportAs)for(let d=0;d<o.exportAs.length;d++)a[o.exportAs[d]]=t;Is(o)&&(a[""]=t)}}function iy(t,o,a,d,g){t.data[d]=g;const w=g.factory||(g.factory=ko(g.type)),I=new P(w,Is(g),pd);t.blueprint[d]=I,a[d]=I,function ul(t,o,a,d,g){const w=g.hostBindings;if(w){let I=t.hostBindingOpCodes;null===I&&(I=t.hostBindingOpCodes=[]);const k=~o.index;(function Ec(t){let o=t.length;for(;o>0;){const a=t[--o];if("number"==typeof a&&a<0)return a}return 0})(I)!=k&&I.push(k),I.push(a,d,w)}}(t,o,d,lf(t,a,g.hostVars,tr),g)}function ql(t,o,a,d,g,w){const I=zi(t,o);!function Tp(t,o,a,d,g,w,I){if(null==w)t.removeAttribute(o,g,a);else{const k=null==I?Xt(w):I(w,d||"",g);t.setAttribute(o,g,k,a)}}(o[bi],I,w,t.value,a,d,g)}function a_(t,o,a,d,g,w){const I=w[o];if(null!==I)for(let k=0;k<I.length;)Nm(d,a,I[k++],I[k++],I[k++])}function Nm(t,o,a,d,g){const w=yo(null);try{const I=t.inputTransforms;null!==I&&I.hasOwnProperty(d)&&(g=I[d].call(o,g)),null!==t.setInput?t.setInput(o,g,a,d):o[d]=g}finally{yo(w)}}function l_(t,o,a){let d=null,g=0;for(;g<a.length;){const w=a[g];if(0!==w)if(5!==w){if("number"==typeof w)break;if(t.hasOwnProperty(w)){null===d&&(d=[]);const I=t[w];for(let k=0;k<I.length;k+=2)if(I[k]===o){d.push(w,I[k+1],a[g+1]);break}}g+=2}else g+=2;else g+=4}return d}function cf(t,o,a,d){return[t,!0,!1,o,null,0,d,a,null,null,null]}function iu(t,o){const a=t.contentQueries;if(null!==a)for(let d=0;d<a.length;d+=2){const w=a[d+1];if(-1!==w){const I=t.data[w];Xs(a[d]),I.contentQueries(2,o[w],w)}}}function uf(t,o){return t[Ts]?t[Ls][Po]=o:t[Ts]=o,t[Ls]=o,o}function Bm(t,o,a){Xs(0);const d=yo(null);try{o(t,a)}finally{yo(d)}}function sh(t){return t[Ds]||(t[Ds]=[])}function c_(t){return t.cleanup||(t.cleanup=[])}function df(t,o){const a=t[$o],d=a?a.get(wc,null):null;d&&d.handleError(o)}function ah(t,o,a,d,g){for(let w=0;w<a.length;){const I=a[w++],k=a[w++];Nm(t.data[I],o[I],d,k,g)}}function zm(t,o){const a=_r(o,t),d=a[$n];!function Um(t,o){for(let a=o.length;a<t.blueprint.length;a++)o.push(t.blueprint[a])}(d,a);const g=a[Vr];null!==g&&null===a[Ms]&&(a[Ms]=Wh(g,a[$o])),dl(d,a,a[go])}function dl(t,o,a){aa(o);try{const d=t.viewQuery;null!==d&&Bm(1,d,a);const g=t.template;null!==g&&gp(t,o,g,1,a),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&iu(t,o),t.staticViewQueries&&Bm(2,t.viewQuery,a);const w=t.components;null!==w&&function bd(t,o){for(let a=0;a<o.length;a++)zm(t,o[a])}(o,w)}catch(d){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),d}finally{o[oi]&=-5,Fc()}}let Mp=(()=>{var t;class o{constructor(){this.all=new Set,this.queue=new Map}create(d,g,w){const I=typeof Zone>"u"?null:Zone.current,k=new Ha(d,he=>{this.all.has(he)&&this.queue.set(he,I)},w);let j;this.all.add(k),k.notify();const se=()=>{k.cleanup(),j?.(),this.all.delete(k),this.queue.delete(k)};return j=g?.onDestroy(se),{destroy:se}}flush(){if(0!==this.queue.size)for(const[d,g]of this.queue)this.queue.delete(d),g?g.run(()=>d.run()):d.run()}get isQueueEmpty(){return 0===this.queue.size}}return(t=o).\u0275prov=ti({token:t,providedIn:"root",factory:()=>new t}),o})();function E(t,o,a){let d=a?t.styles:null,g=a?t.classes:null,w=0;if(null!==o)for(let I=0;I<o.length;I++){const k=o[I];"number"==typeof k?w=k:1==w?g=Bt(g,k):2==w&&(d=Bt(d,k+": "+o[++I]+";"))}a?t.styles=d:t.stylesWithoutHost=d,a?t.classes=g:t.classesWithoutHost=g}function h(t,o,a,d,g=!1){for(;null!==a;){const w=o[a.index];null!==w&&d.push(on(w)),Eo(w)&&v(w,d);const I=a.type;if(8&I)h(t,o,a.child,d);else if(32&I){const k=xu(a,o);let j;for(;j=k();)d.push(j)}else if(16&I){const k=Jp(o,a);if(Array.isArray(k))d.push(...k);else{const j=wu(o[Fr]);h(j[$n],j,k,d,!0)}}a=g?a.projectionNext:a.next}return d}function v(t,o){for(let a=Zr;a<t.length;a++){const d=t[a],g=d[$n].firstChild;null!==g&&h(d[$n],d,g,o)}t[Yo]!==t[Vr]&&o.push(t[Yo])}function _(t,o,a,d=!0){const g=o[cs],w=g.rendererFactory,I=g.afterRenderEventManager;w.begin?.(),I?.begin();try{te(t,o,t.template,a)}catch(j){throw d&&df(o,j),j}finally{w.end?.(),g.effectManager?.flush(),I?.end()}}function te(t,o,a,d){const g=o[oi];if(256!=(256&g)){o[cs].effectManager?.flush(),aa(o);try{Ys(o),function uu(t){return Ri.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==a&&gp(t,o,a,2,d);const I=3==(3&g);if(I){const se=t.preOrderCheckHooks;null!==se&&Js(o,se,null)}else{const se=t.preOrderHooks;null!==se&&f(o,se,0,null),r(o,0)}if(function je(t){for(let o=Pf(t);null!==o;o=Rf(o)){if(!o[pl])continue;const a=o[Oo];for(let d=0;d<a.length;d++){oa(a[d])}}}(o),me(o,2),null!==t.contentQueries&&iu(t,o),I){const se=t.contentCheckHooks;null!==se&&Js(o,se)}else{const se=t.contentHooks;null!==se&&f(o,se,1),r(o,1)}!function Q_(t,o){const a=t.hostBindingOpCodes;if(null===a)return;const d=Au(o,Zs);try{for(let g=0;g<a.length;g++){const w=a[g];if(w<0)O(~w);else{const I=w,k=a[++g],j=a[++g];bs(k,I),d.runInContext(j,2,o[I])}}}finally{null===o[Zs]&&fd(o,Zs),O(-1)}}(t,o);const k=t.components;null!==k&&cn(o,k,0);const j=t.viewQuery;if(null!==j&&Bm(2,j,d),I){const se=t.viewCheckHooks;null!==se&&Js(o,se)}else{const se=t.viewHooks;null!==se&&f(o,se,2),r(o,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),o[oi]&=-73,Ps(o)}finally{Fc()}}}function me(t,o){for(let a=Pf(t);null!==a;a=Rf(a))for(let d=Zr;d<a.length;d++)Zt(a[d],o)}function ot(t,o,a){Zt(_r(o,t),a)}function Zt(t,o){if(!function As(t){return 128==(128&t[oi])}(t))return;const a=t[$n];if(80&t[oi]&&0===o||1024&t[oi]||2===o)te(a,t,a.template,t[go]);else if(t[Ro]>0){me(t,1);const g=t[$n].components;null!==g&&cn(t,g,1)}}function cn(t,o,a){for(let d=0;d<o.length;d++)ot(t,o[d],a)}class di{get rootNodes(){const o=this._lView,a=o[$n];return h(a,o,a.firstChild,[])}constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[go]}set context(o){this._lView[go]=o}get destroyed(){return 256==(256&this._lView[oi])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[xr];if(Eo(o)){const a=o[8],d=a?a.indexOf(this):-1;d>-1&&(xa(o,d),Cl(a,d))}this._attachedToViewContainer=!1}Fa(this._lView[$n],this._lView)}onDestroy(o){Fn(this._lView,o)}markForCheck(){nh(this._cdRefInjectingView||this._lView)}detach(){this._lView[oi]&=-129}reattach(){this._lView[oi]|=128}detectChanges(){_(this._lView[$n],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ft(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function zc(t,o){Rd(t,o,o[bi],2,null,null)}(this._lView[$n],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new ft(902,!1);this._appRef=o}}class si extends di{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;_(o[$n],o,o[go],!1)}checkNoChanges(){}get context(){return null}}class Un extends Xc{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=ri(o);return new qr(a,this.ngModule)}}function ei(t){const o=[];for(let a in t)t.hasOwnProperty(a)&&o.push({propName:t[a],templateName:a});return o}class vo{constructor(o,a){this.injector=o,this.parentInjector=a}get(o,a,d){d=_i(d);const g=this.injector.get(o,Xd,d);return g!==Xd||a===Xd?g:this.parentInjector.get(o,a,d)}}class qr extends Gg{get inputs(){const o=this.componentDef,a=o.inputTransforms,d=ei(o.inputs);if(null!==a)for(const g of d)a.hasOwnProperty(g.propName)&&(g.transform=a[g.propName]);return d}get outputs(){return ei(this.componentDef.outputs)}constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function Ur(t){return t.map(ts).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}create(o,a,d,g){let w=(g=g||this.ngModule)instanceof $l?g:g?.injector;w&&null!==this.componentDef.getStandaloneInjector&&(w=this.componentDef.getStandaloneInjector(w)||w);const I=w?new vo(o,w):o,k=I.get(tp,null);if(null===k)throw new ft(407,!1);const ke={rendererFactory:k,sanitizer:I.get(Yd,null),effectManager:I.get(Mp,null),afterRenderEventManager:I.get(tf,null)},dt=k.createRenderer(null,this.componentDef),Dt=this.componentDef.selectors[0][0]||"div",un=d?function nu(t,o,a,d){const w=d.get(cp,!1)||a===wn.ShadowDom,I=t.selectRootElement(o,w);return function Ru(t){oh(t)}(I),I}(dt,d,this.componentDef.encapsulation,I):es(dt,Dt,function cr(t){const o=t.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(Dt)),ki=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let Rn=null;null!==un&&(Rn=Wh(un,I,!0));const fr=yd(0,null,null,1,0,null,null,null,null,null,null),kr=af(null,fr,null,ki,null,null,ke,dt,I,null,Rn);let zo,Xl;aa(kr);try{const uh=this.componentDef;let Jm,Ov=null;uh.findHostDirectiveDefs?(Jm=[],Ov=new Map,uh.findHostDirectiveDefs(uh,Jm,Ov),Jm.push(uh)):Jm=[uh];const SD=function e(t,o){const a=t[$n],d=Xn;return t[d]=o,md(a,d,2,"#host",null)}(kr,un),ID=function i(t,o,a,d,g,w,I){const k=g[$n];!function s(t,o,a,d){for(const g of t)o.mergedAttrs=Lr(o.mergedAttrs,g.hostAttrs);null!==o.mergedAttrs&&(E(o,o.mergedAttrs,!0),null!==a&&Ph(d,a,o))}(d,t,o,I);let j=null;null!==o&&(j=Wh(o,g[$o]));const se=w.rendererFactory.createRenderer(o,a);let he=16;a.signals?he=4096:a.onPush&&(he=64);const ke=af(g,Rm(a),null,he,g[t.index],t,w,se,null,null,j);return k.firstCreatePass&&Dp(k,t,d.length-1),uf(g,ke),g[t.index]=ke}(SD,un,uh,Jm,kr,ke,dt);Xl=eo(fr,Xn),un&&function p(t,o,a,d){if(d)xt(t,a,["ng-version",Xa.full]);else{const{attrs:g,classes:w}=function ls(t){const o=[],a=[];let d=1,g=2;for(;d<t.length;){let w=t[d];if("string"==typeof w)2===g?""!==w&&o.push(w,t[++d]):8===g&&a.push(w);else{if(!ci(g))break;g=w}d++}return{attrs:o,classes:a}}(o.selectors[0]);g&&xt(t,a,g),w&&w.length>0&&Od(t,a,w.join(" "))}}(dt,uh,un,d),void 0!==a&&function y(t,o,a){const d=t.projection=[];for(let g=0;g<o.length;g++){const w=a[g];d.push(null!=w?Array.from(w):null)}}(Xl,this.ngContentSelectors,a),zo=function u(t,o,a,d,g,w){const I=Go(),k=g[$n],j=zi(I,g);Ep(k,g,I,a,null,d);for(let he=0;he<a.length;he++)ba(Hn(g,k,I.directiveStart+he,I),g);Zl(k,g,I),j&&ba(j,g);const se=Hn(g,k,I.directiveStart+I.componentOffset,I);if(t[go]=g[go]=se,null!==w)for(const he of w)he(se,o);return gd(k,I,t),se}(ID,uh,Jm,Ov,kr,[x]),dl(fr,kr,null)}finally{Fc()}return new n(this.componentType,zo,Jc(Xl,kr),kr,Xl)}}class n extends Y_{constructor(o,a,d,g,w){super(),this.location=d,this._rootLView=g,this._tNode=w,this.previousInputValues=null,this.instance=a,this.hostView=this.changeDetectorRef=new si(g),this.componentType=o}setInput(o,a){const d=this._tNode.inputs;let g;if(null!==d&&(g=d[o])){if(this.previousInputValues??=new Map,this.previousInputValues.has(o)&&Object.is(this.previousInputValues.get(o),a))return;const w=this._rootLView;ah(w[$n],w,g,o,a),this.previousInputValues.set(o,a),nh(_r(this._tNode.index,w))}}get injector(){return new or(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function x(){const t=Go();xs(hn()[$n],t)}function M(t){let o=function D(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),a=!0;const d=[t];for(;o;){let g;if(Is(t))g=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new ft(903,!1);g=o.\u0275dir}if(g){if(a){d.push(g);const I=t;I.inputs=U(t.inputs),I.inputTransforms=U(t.inputTransforms),I.declaredInputs=U(t.declaredInputs),I.outputs=U(t.outputs);const k=g.hostBindings;k&&Y(t,k);const j=g.viewQuery,se=g.contentQueries;if(j&&H(t,j),se&&G(t,se),at(t.inputs,g.inputs),at(t.declaredInputs,g.declaredInputs),at(t.outputs,g.outputs),null!==g.inputTransforms&&(null===I.inputTransforms&&(I.inputTransforms={}),at(I.inputTransforms,g.inputTransforms)),Is(g)&&g.data.animation){const he=t.data;he.animation=(he.animation||[]).concat(g.data.animation)}}const w=g.features;if(w)for(let I=0;I<w.length;I++){const k=w[I];k&&k.ngInherit&&k(t),k===M&&(a=!1)}}o=Object.getPrototypeOf(o)}!function F(t){let o=0,a=null;for(let d=t.length-1;d>=0;d--){const g=t[d];g.hostVars=o+=g.hostVars,g.hostAttrs=Lr(g.hostAttrs,a=Lr(a,g.hostAttrs))}}(d)}function U(t){return t===Kn?{}:t===An?[]:t}function H(t,o){const a=t.viewQuery;t.viewQuery=a?(d,g)=>{o(d,g),a(d,g)}:o}function G(t,o){const a=t.contentQueries;t.contentQueries=a?(d,g,w)=>{o(d,g,w),a(d,g,w)}:o}function Y(t,o){const a=t.hostBindings;t.hostBindings=a?(d,g)=>{o(d,g),a(d,g)}:o}function yt(t){const o=t.inputConfig,a={};for(const d in o)if(o.hasOwnProperty(d)){const g=o[d];Array.isArray(g)&&g[2]&&(a[d]=g[2])}t.inputTransforms=a}function sn(t){return!!rn(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function rn(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function On(t,o,a){return!Object.is(t[o],a)&&(t[o]=a,!0)}function In(t,o,a,d){const g=hn();return On(g,Rl(),o)&&(lr(),ql(X(),g,t,o,a,d)),In}function Fi(t,o,a,d){return On(t,Rl(),a)?o+Xt(a)+d:tr}function kv(t,o,a,d,g,w,I,k){const j=hn(),se=lr(),he=t+Xn,ke=se.firstCreatePass?function qx(t,o,a,d,g,w,I,k,j){const se=o.consts,he=md(o,t,4,I||null,Lo(se,k));wp(o,a,he,Lo(se,j)),xs(o,he);const ke=he.tView=yd(2,he,d,g,w,o.directiveRegistry,o.pipeRegistry,null,o.schemas,se,null);return null!==o.queries&&(o.queries.template(o,he),ke.queries=o.queries.embeddedTView(he)),he}(he,se,j,o,a,d,g,w,I):se.data[he];Us(ke,!1);const dt=Lv(se,j,ke,t);Yi()&&Sh(se,j,dt,ke),ba(dt,j),uf(j,j[he]=cf(dt,j,dt,ke)),na(ke)&&_d(se,j,ke),null!=I&&Pu(j,ke,k)}let Lv=function Fv(t,o,a,d){return Rr(!0),o[bi].createComment("")};function Ly(t,o,a){const d=hn();return On(d,Rl(),o)&&ca(lr(),X(),d,t,o,d[bi],a,!1),Ly}function Fy(t,o,a,d,g){const I=g?"class":"style";ah(t,a,o.inputs[I],I,d)}function sy(t,o,a,d){const g=hn(),w=lr(),I=Xn+t,k=g[bi],j=w.firstCreatePass?function Qx(t,o,a,d,g,w){const I=o.consts,j=md(o,t,2,d,Lo(I,g));return wp(o,a,j,Lo(I,w)),null!==j.attrs&&E(j,j.attrs,!1),null!==j.mergedAttrs&&E(j,j.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,j),j}(I,w,g,o,a,d):w.data[I],se=Nv(w,g,j,k,o,t);g[I]=se;const he=na(j);return Us(j,!0),Ph(k,se,j),32!=(32&j.flags)&&Yi()&&Sh(w,g,se,j),0===function Xo(){return Ri.lFrame.elementDepthCount}()&&ba(se,g),function Il(){Ri.lFrame.elementDepthCount++}(),he&&(_d(w,g,j),gd(w,j,g)),null!==d&&Pu(g,j),sy}function ay(){let t=Go();cc()?function uc(){Ri.lFrame.isParent=!1}():(t=t.parent,Us(t,!1));const o=t;(function Ac(t){return Ri.skipHydrationRootTNode===t})(o)&&function Za(){Ri.skipHydrationRootTNode=null}(),function oc(){Ri.lFrame.elementDepthCount--}();const a=lr();return a.firstCreatePass&&(xs(a,t),ta(t)&&a.queries.elementEnd(t)),null!=o.classesWithoutHost&&function ae(t){return 0!=(8&t.flags)}(o)&&Fy(a,o,hn(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function fe(t){return 0!=(16&t.flags)}(o)&&Fy(a,o,hn(),o.stylesWithoutHost,!1),ay}function Ny(t,o,a,d){return sy(t,o,a,d),ay(),Ny}let Nv=(t,o,a,d,g,w)=>(Rr(!0),es(d,g,function jt(){return Ri.lFrame.currentNamespace}()));function Uv(){return hn()}function Uy(t){return!!t&&"function"==typeof t.then}function Vv(t){return!!t&&"function"==typeof t.subscribe}function Vy(t,o,a,d){const g=hn(),w=lr(),I=Go();return function $v(t,o,a,d,g,w,I){const k=na(d),se=t.firstCreatePass&&c_(t),he=o[go],ke=sh(o);let dt=!0;if(3&d.type||I){const Vn=zi(d,o),ni=I?I(Vn):Vn,ki=ke.length,Rn=I?kr=>I(on(kr[d.index])):d.index;let fr=null;if(!I&&k&&(fr=function ow(t,o,a,d){const g=t.cleanup;if(null!=g)for(let w=0;w<g.length-1;w+=2){const I=g[w];if(I===a&&g[w+1]===d){const k=o[Ds],j=g[w+2];return k.length>j?k[j]:null}"string"==typeof I&&(w+=2)}return null}(t,o,g,d.index)),null!==fr)(fr.__ngLastListenerFn__||fr).__ngNextListenerFn__=w,fr.__ngLastListenerFn__=w,dt=!1;else{w=Gv(d,o,he,w,!1);const kr=a.listen(ni,g,w);ke.push(w,kr),se&&se.push(g,Rn,ki,ki+1)}}else w=Gv(d,o,he,w,!1);const Dt=d.outputs;let un;if(dt&&null!==Dt&&(un=Dt[g])){const Vn=un.length;if(Vn)for(let ni=0;ni<Vn;ni+=2){const zo=o[un[ni]][un[ni+1]].subscribe(w),Xl=ke.length;ke.push(w,zo),se&&se.push(g,d.index,Xl,-(Xl+1))}}}(w,g,g[bi],I,t,o,d),Vy}function Hv(t,o,a,d){try{return ve(6,o,a),!1!==a(d)}catch(g){return df(t,g),!1}finally{ve(7,o,a)}}function Gv(t,o,a,d,g){return function w(I){if(I===Function)return d;nh(t.componentOffset>-1?_r(t.index,o):o);let j=Hv(o,a,d,I),se=w.__ngNextListenerFn__;for(;se;)j=Hv(o,a,se,I)&&j,se=se.__ngNextListenerFn__;return g&&!1===j&&I.preventDefault(),j}}function Wv(t=1){return function L(t){return(Ri.lFrame.contextLView=function B(t,o){for(;t>0;)o=o[ns],t--;return o}(t,Ri.lFrame.contextLView))[go]}(t)}function jy(t,o,a){return $y(t,"",o,"",a),jy}function $y(t,o,a,d,g){const w=hn(),I=Fi(w,o,a,d);return I!==tr&&ca(lr(),X(),w,t,I,w[bi],g,!1),$y}function ly(t,o){return t<<17|o<<2}function mf(t){return t>>17&32767}function Hy(t){return 2|t}function Pp(t){return(131068&t)>>2}function Gy(t,o){return-131069&t|o<<2}function Wy(t){return 1|t}function t0(t,o,a,d,g){const w=t[a+1],I=null===o;let k=d?mf(w):Pp(w),j=!1;for(;0!==k&&(!1===j||I);){const he=t[k+1];pw(t[k],o)&&(j=!0,t[k+1]=d?Wy(he):Hy(he)),k=d?mf(he):Pp(he)}j&&(t[a+1]=d?Hy(w):Wy(w))}function pw(t,o){return null===t||null==o||(Array.isArray(t)?t[1]:t)===o||!(!Array.isArray(t)||"string"!=typeof o)&&pc(t,o)>=0}function Zy(t,o){return function Fu(t,o,a,d){const g=hn(),w=lr(),I=function _a(t){const o=Ri.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+t,a}(2);w.firstUpdatePass&&function d0(t,o,a,d){const g=t.data;if(null===g[a+1]){const w=g[$()],I=function u0(t,o){return o>=t.expandoStartIndex}(t,a);(function m0(t,o){return 0!=(t.flags&(o?8:16))})(w,d)&&null===o&&!I&&(o=!1),o=function Ew(t,o,a,d){const g=function hc(t){const o=Ri.lFrame.currentDirectiveIndex;return-1===o?null:t[o]}(t);let w=d?o.residualClasses:o.residualStyles;if(null===g)0===(d?o.classBindings:o.styleBindings)&&(a=p_(a=qy(null,t,o,a,d),o.attrs,d),w=null);else{const I=o.directiveStylingLast;if(-1===I||t[I]!==g)if(a=qy(g,t,o,a,d),null===w){let j=function Cw(t,o,a){const d=a?o.classBindings:o.styleBindings;if(0!==Pp(d))return t[mf(d)]}(t,o,d);void 0!==j&&Array.isArray(j)&&(j=qy(null,t,o,j[1],d),j=p_(j,o.attrs,d),function Dw(t,o,a,d){t[mf(a?o.classBindings:o.styleBindings)]=d}(t,o,d,j))}else w=function Tw(t,o,a){let d;const g=o.directiveEnd;for(let w=1+o.directiveStylingLast;w<g;w++)d=p_(d,t[w].hostAttrs,a);return p_(d,o.attrs,a)}(t,o,d)}return void 0!==w&&(d?o.residualClasses=w:o.residualStyles=w),a}(g,w,o,d),function hw(t,o,a,d,g,w){let I=w?o.classBindings:o.styleBindings,k=mf(I),j=Pp(I);t[d]=a;let he,se=!1;if(Array.isArray(a)?(he=a[1],(null===he||pc(a,he)>0)&&(se=!0)):he=a,g)if(0!==j){const dt=mf(t[k+1]);t[d+1]=ly(dt,k),0!==dt&&(t[dt+1]=Gy(t[dt+1],d)),t[k+1]=function uw(t,o){return 131071&t|o<<17}(t[k+1],d)}else t[d+1]=ly(k,0),0!==k&&(t[k+1]=Gy(t[k+1],d)),k=d;else t[d+1]=ly(j,0),0===k?k=d:t[j+1]=Gy(t[j+1],d),j=d;se&&(t[d+1]=Hy(t[d+1])),t0(t,he,d,!0),t0(t,he,d,!1),function fw(t,o,a,d,g){const w=g?t.residualClasses:t.residualStyles;null!=w&&"string"==typeof o&&pc(w,o)>=0&&(a[d+1]=Wy(a[d+1]))}(o,he,t,d,w),I=ly(k,j),w?o.classBindings=I:o.styleBindings=I}(g,w,o,a,I,d)}}(w,t,I,d),o!==tr&&On(g,I,o)&&function f0(t,o,a,d,g,w,I,k){if(!(3&o.type))return;const j=t.data,se=j[k+1],he=function dw(t){return 1==(1&t)}(se)?p0(j,o,a,g,Pp(se),I):void 0;cy(he)||(cy(w)||function cw(t){return 2==(2&t)}(se)&&(w=p0(j,null,a,g,k,I)),function yg(t,o,a,d,g){if(o)g?t.addClass(a,d):t.removeClass(a,d);else{let w=-1===d.indexOf("-")?void 0:Sf.DashCase;null==g?t.removeStyle(a,d,w):("string"==typeof g&&g.endsWith("!important")&&(g=g.slice(0,-10),w|=Sf.Important),t.setStyle(a,d,g,w))}}(d,I,Qi($(),a),g,w))}(w,w.data[$()],g,g[bi],t,g[I+1]=function Aw(t,o){return null==t||""===t||("string"==typeof o?t+=o:"object"==typeof t&&(t=ht($c(t)))),t}(o,a),d,I)}(t,o,null,!0),Zy}function qy(t,o,a,d,g){let w=null;const I=a.directiveEnd;let k=a.directiveStylingLast;for(-1===k?k=a.directiveStart:k++;k<I&&(w=o[k],d=p_(d,w.hostAttrs,g),w!==t);)k++;return null!==t&&(a.directiveStylingLast=k),d}function p_(t,o,a){const d=a?1:2;let g=-1;if(null!==o)for(let w=0;w<o.length;w++){const I=o[w];"number"==typeof I?g=I:g===d&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),sl(t,I,!!a||o[++w]))}return void 0===t?null:t}function p0(t,o,a,d,g,w){const I=null===o;let k;for(;g>0;){const j=t[g],se=Array.isArray(j),he=se?j[1]:j,ke=null===he;let dt=a[g+1];dt===tr&&(dt=ke?An:void 0);let Dt=ke?fh(dt,d):he===d?dt:void 0;if(se&&!cy(Dt)&&(Dt=fh(j,d)),cy(Dt)&&(k=Dt,I))return k;const un=t[g+1];g=I?mf(un):Pp(un)}if(null!==o){let j=w?o.residualClasses:o.residualStyles;null!=j&&(k=fh(j,d))}return k}function cy(t){return void 0!==t}function g0(t,o=""){const a=hn(),d=lr(),g=t+Xn,w=d.firstCreatePass?md(d,g,1,o,null):d.data[g],I=_0(d,a,w,o,t);a[g]=I,Yi()&&Sh(d,a,I,w),Us(w,!1)}let _0=(t,o,a,d,g)=>(Rr(!0),function Ad(t,o){return t.createText(o)}(o[bi],d));function Ky(t){return Yy("",t,""),Ky}function Yy(t,o,a){const d=hn(),g=Fi(d,t,o,a);return g!==tr&&function $s(t,o,a){const d=Qi(o,t);!function Of(t,o,a){t.setValue(o,a)}(t[bi],d,a)}(d,$(),g),Yy}const Rp=void 0;var Jw=["en",[["a","p"],["AM","PM"],Rp],[["AM","PM"],Rp,Rp],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Rp,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Rp,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Rp,"{1} 'at' {0}",Rp],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Xw(t){const a=Math.floor(Math.abs(t)),d=t.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===d?1:5}];let Wm={};function Xy(t){const o=function Qw(t){return t.toLowerCase().replace(/_/g,"-")}(t);let a=B0(o);if(a)return a;const d=o.split("-")[0];if(a=B0(d),a)return a;if("en"===d)return Jw;throw new ft(701,!1)}function N0(t){return Xy(t)[Zm.PluralCase]}function B0(t){return t in Wm||(Wm[t]=Gi.ng&&Gi.ng.common&&Gi.ng.common.locales&&Gi.ng.common.locales[t]),Wm[t]}var Zm=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(Zm||{});const qm="en-US";let z0=qm;function ev(t,o,a,d,g){if(t=St(t),Array.isArray(t))for(let w=0;w<t.length;w++)ev(t[w],o,a,d,g);else{const w=lr(),I=hn(),k=Go();let j=Zc(t)?t:St(t.provide);const se=od(t),he=1048575&k.providerIndexes,ke=k.directiveStart,dt=k.providerIndexes>>20;if(Zc(t)||!t.multi){const Dt=new P(se,g,pd),un=nv(j,o,g?he:he+dt,ke);-1===un?(mn(pn(k,I),w,j),tv(w,t,o.length),o.push(j),k.directiveStart++,k.directiveEnd++,g&&(k.providerIndexes+=1048576),a.push(Dt),I.push(Dt)):(a[un]=Dt,I[un]=Dt)}else{const Dt=nv(j,o,he+dt,ke),un=nv(j,o,he,he+dt),ni=un>=0&&a[un];if(g&&!ni||!g&&!(Dt>=0&&a[Dt])){mn(pn(k,I),w,j);const ki=function J1(t,o,a,d,g){const w=new P(t,a,pd);return w.multi=[],w.index=o,w.componentProviders=0,ub(w,g,d&&!a),w}(g?X1:Y1,a.length,g,d,se);!g&&ni&&(a[un].providerFactory=ki),tv(w,t,o.length,0),o.push(j),k.directiveStart++,k.directiveEnd++,g&&(k.providerIndexes+=1048576),a.push(ki),I.push(ki)}else tv(w,t,Dt>-1?Dt:un,ub(a[g?un:Dt],se,!g&&d));!g&&d&&ni&&a[un].componentProviders++}}}function tv(t,o,a,d){const g=Zc(o),w=function Gf(t){return!!t.useClass}(o);if(g||w){const j=(w?St(o.useClass):o).prototype.ngOnDestroy;if(j){const se=t.destroyHooks||(t.destroyHooks=[]);if(!g&&o.multi){const he=se.indexOf(a);-1===he?se.push(a,[d,j]):se[he+1].push(d,j)}else se.push(a,j)}}}function ub(t,o,a){return a&&t.componentProviders++,t.multi.push(o)-1}function nv(t,o,a,d){for(let g=a;g<d;g++)if(o[g]===t)return g;return-1}function Y1(t,o,a,d){return iv(this.multi,[])}function X1(t,o,a,d){const g=this.multi;let w;if(this.providerFactory){const I=this.providerFactory.componentProviders,k=Hn(a,a[$n],this.providerFactory.index,d);w=k.slice(0,I),iv(g,w);for(let j=I;j<k.length;j++)w.push(k[j])}else w=[],iv(g,w);return w}function iv(t,o){for(let a=0;a<t.length;a++)o.push((0,t[a])());return o}function db(t,o=[]){return a=>{a.providersResolver=(d,g)=>function K1(t,o,a){const d=lr();if(d.firstCreatePass){const g=Is(t);ev(a,d.data,d.blueprint,g,!0),ev(o,d.data,d.blueprint,g,!1)}}(d,g?g(t):t,o)}}class Op{}class hb{}function Q1(t,o){return new rv(t,o??null,[])}class rv extends Op{constructor(o,a,d){super(),this._parent=a,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Un(this);const g=Ji(o);this._bootstrapComponents=eu(g.bootstrap),this._r3Injector=Tm(o,a,[{provide:Op,useValue:this},{provide:Xc,useValue:this.componentFactoryResolver},...d],ht(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class ov extends hb{constructor(o){super(),this.moduleType=o}create(o){return new rv(this.moduleType,o,[])}}class fb extends Op{constructor(o){super(),this.componentFactoryResolver=new Un(this),this.instance=null;const a=new qc([...o.providers,{provide:Op,useValue:this},{provide:Xc,useValue:this.componentFactoryResolver}],o.parent||Zf(),o.debugName,new Set(["environment"]));this.injector=a,o.runEnvironmentInitializers&&a.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function pb(t,o,a=null){return new fb({providers:t,parent:o,debugName:a,runEnvironmentInitializers:!0}).injector}let tE=(()=>{var t;class o{constructor(d){this._injector=d,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(d){if(!d.standalone)return null;if(!this.cachedInjectors.has(d)){const g=Og(0,d.type),w=g.length>0?pb([g],this._injector,`Standalone[${d.type.name}]`):null;this.cachedInjectors.set(d,w)}return this.cachedInjectors.get(d)}ngOnDestroy(){try{for(const d of this.cachedInjectors.values())null!==d&&d.destroy()}finally{this.cachedInjectors.clear()}}}return(t=o).\u0275prov=ti({token:t,providedIn:"environment",factory:()=>new t(_n($l))}),o})();function mb(t){t.getStandaloneInjector=o=>o.get(tE).getOrCreateStandaloneInjector(t)}function wb(t,o,a,d,g,w){const I=o+a;return On(t,I,g)?function xn(t,o,a){return t[o]=a}(t,I+1,w?d.call(w,g):d(g)):function b_(t,o){const a=t[o];return a===tr?void 0:a}(t,I+1)}function Mb(t,o){const a=lr();let d;const g=t+Xn;a.firstCreatePass?(d=function bE(t,o){if(o)for(let a=o.length-1;a>=0;a--){const d=o[a];if(t===d.name)return d}}(o,a.pipeRegistry),a.data[g]=d,d.onDestroy&&(a.destroyHooks??=[]).push(g,d.onDestroy)):d=a.data[g];const w=d.factory||(d.factory=ko(d.type)),k=Er(pd);try{const j=Pe(!1),se=w();return Pe(j),function Xx(t,o,a,d){a>=t.data.length&&(t.data[a]=null,t.blueprint[a]=null),o[a]=d}(a,hn(),g,se),se}finally{Er(k)}}function Sb(t,o,a){const d=t+Xn,g=hn(),w=function Pi(t,o){return t[o]}(g,d);return function x_(t,o){return t[$n].data[o].pure}(g,d)?wb(g,function rs(){const t=Ri.lFrame;let o=t.bindingRootIndex;return-1===o&&(o=t.bindingRootIndex=t.tView.bindingStartIndex),o}(),o,w.transform,a,w):w.transform(a)}function DE(){return this._results[Symbol.iterator]()}class av{get changes(){return this._changes||(this._changes=new Hl)}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=av.prototype;a[Symbol.iterator]||(a[Symbol.iterator]=DE)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const d=this;d.dirty=!1;const g=function ol(t){return t.flat(Number.POSITIVE_INFINITY)}(o);(this._changesDetected=!function _f(t,o,a){if(t.length!==o.length)return!1;for(let d=0;d<t.length;d++){let g=t[d],w=o[d];if(a&&(g=a(g),w=a(w)),w!==g)return!1}return!0}(d._results,g,a))&&(d._results=g,d.length=g.length,d.last=g[this.length-1],d.first=g[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function ME(t,o,a,d=!0){const g=o[$n];if(function kf(t,o,a,d){const g=Zr+d,w=a.length;d>0&&(a[g-1][Po]=o),d<w-Zr?(o[Po]=a[g],hh(a,Zr+d,o)):(a.push(o),o[Po]=null),o[xr]=a;const I=o[is];null!==I&&a!==I&&function Ul(t,o){const a=t[Oo];o[Fr]!==o[xr][xr][Fr]&&(t[pl]=!0),null===a?t[Oo]=[o]:a.push(o)}(I,o);const k=o[Ko];null!==k&&k.insertView(t),o[oi]|=128}(g,o,t,a),d){const w=Qp(a,t),I=o[bi],k=Th(I,t[Yo]);null!==k&&function pg(t,o,a,d,g,w){d[Vr]=g,d[jr]=o,Rd(t,d,a,1,g,w)}(g,t[jr],I,o,k,w)}}let w_=(()=>{class o{}return o.__NG_ELEMENT_ID__=AE,o})();const SE=w_,IE=class extends SE{constructor(o,a,d){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=d}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(o,a){return this.createEmbeddedViewImpl(o,a)}createEmbeddedViewImpl(o,a,d){const g=function TE(t,o,a,d){const g=o.tView,k=af(t,g,a,4096&t[oi]?4096:16,null,o,null,null,null,d?.injector??null,d?.hydrationInfo??null);k[is]=t[o.index];const se=t[Ko];return null!==se&&(k[Ko]=se.createEmbeddedView(g)),dl(g,k,a),k}(this._declarationLView,this._declarationTContainer,o,{injector:a,hydrationInfo:d});return new di(g)}};function AE(){return py(Go(),hn())}function py(t,o){return 4&t.type?new IE(o,t,Jc(t,o)):null}let gy=(()=>{class o{}return o.__NG_ELEMENT_ID__=FE,o})();function FE(){return Lb(Go(),hn())}const NE=gy,Ob=class extends NE{constructor(o,a,d){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=d}get element(){return Jc(this._hostTNode,this._hostLView)}get injector(){return new or(this._hostTNode,this._hostLView)}get parentInjector(){const o=kt(this._hostTNode,this._hostLView);if(xe(o)){const a=_e(o,this._hostLView),d=De(o);return new or(a[$n].data[d+8],a)}return new or(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=kb(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-Zr}createEmbeddedView(o,a,d){let g,w;"number"==typeof d?g=d:null!=d&&(g=d.index,w=d.injector);const k=o.createEmbeddedViewImpl(a||{},w,null);return this.insertImpl(k,g,false),k}createComponent(o,a,d,g,w){const I=o&&!function Vu(t){return"function"==typeof t}(o);let k;if(I)k=a;else{const Vn=a||{};k=Vn.index,d=Vn.injector,g=Vn.projectableNodes,w=Vn.environmentInjector||Vn.ngModuleRef}const j=I?o:new qr(ri(o)),se=d||this.parentInjector;if(!w&&null==j.ngModule){const ni=(I?se:this.parentInjector).get($l,null);ni&&(w=ni)}ri(j.componentType??{});const Dt=j.create(se,g,null,w);return this.insertImpl(Dt.hostView,k,false),Dt}insert(o,a){return this.insertImpl(o,a,!1)}insertImpl(o,a,d){const g=o._lView;if(function vs(t){return Eo(t[xr])}(g)){const j=this.indexOf(o);if(-1!==j)this.detach(j);else{const se=g[xr],he=new Ob(se,se[jr],se[xr]);he.detach(he.indexOf(o))}}const I=this._adjustIndex(a),k=this._lContainer;return ME(k,g,I,!d),o.attachToViewContainerRef(),hh(lv(k),I,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=kb(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),d=xa(this._lContainer,a);d&&(Cl(lv(this._lContainer),a),Fa(d[$n],d))}detach(o){const a=this._adjustIndex(o,-1),d=xa(this._lContainer,a);return d&&null!=Cl(lv(this._lContainer),a)?new di(d):null}_adjustIndex(o,a=0){return o??this.length+a}};function kb(t){return t[8]}function lv(t){return t[8]||(t[8]=[])}function Lb(t,o){let a;const d=o[t.index];return Eo(d)?a=d:(a=cf(d,o,null,t),o[t.index]=a,uf(o,a)),Fb(a,o,t,d),new Ob(a,t,o)}let Fb=function Nb(t,o,a,d){if(t[Yo])return;let g;g=8&a.type?on(d):function BE(t,o){const a=t[bi],d=a.createComment(""),g=zi(o,t);return yc(a,Th(a,g),d,function Xp(t,o){return t.nextSibling(o)}(a,g),!1),d}(o,a),t[Yo]=g};class cv{constructor(o){this.queryList=o,this.matches=null}clone(){return new cv(this.queryList)}setDirty(){this.queryList.setDirty()}}class uv{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const d=null!==o.contentQueries?o.contentQueries[0]:a.length,g=[];for(let w=0;w<d;w++){const I=a.getByIndex(w);g.push(this.queries[I.indexInDeclarationView].clone())}return new uv(g)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==Gb(o,a).matches&&this.queries[a].setDirty()}}class Bb{constructor(o,a,d=null){this.predicate=o,this.flags=a,this.read=d}}class dv{constructor(o=[]){this.queries=o}elementStart(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let d=0;d<this.length;d++){const g=null!==a?a.length:0,w=this.getByIndex(d).embeddedTView(o,g);w&&(w.indexInDeclarationView=d,null!==a?a.push(w):a=[w])}return null!==a?new dv(a):null}template(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class hv{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new hv(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let d=o.parent;for(;null!==d&&8&d.type&&d.index!==a;)d=d.parent;return a===(null!==d?d.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const d=this.metadata.predicate;if(Array.isArray(d))for(let g=0;g<d.length;g++){const w=d[g];this.matchTNodeWithReadOption(o,a,VE(a,w)),this.matchTNodeWithReadOption(o,a,Ai(a,o,w,!1,!1))}else d===w_?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,Ai(a,o,d,!1,!1))}matchTNodeWithReadOption(o,a,d){if(null!==d){const g=this.metadata.read;if(null!==g)if(g===ad||g===gy||g===w_&&4&a.type)this.addMatch(a.index,-2);else{const w=Ai(a,o,g,!1,!1);null!==w&&this.addMatch(a.index,w)}else this.addMatch(a.index,d)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function VE(t,o){const a=t.localNames;if(null!==a)for(let d=0;d<a.length;d+=2)if(a[d]===o)return a[d+1];return null}function $E(t,o,a,d){return-1===a?function jE(t,o){return 11&t.type?Jc(t,o):4&t.type?py(t,o):null}(o,t):-2===a?function HE(t,o,a){return a===ad?Jc(o,t):a===w_?py(o,t):a===gy?Lb(o,t):void 0}(t,o,d):Hn(t,t[$n],a,o)}function zb(t,o,a,d){const g=o[Ko].queries[d];if(null===g.matches){const w=t.data,I=a.matches,k=[];for(let j=0;j<I.length;j+=2){const se=I[j];k.push(se<0?null:$E(o,w[se],I[j+1],a.metadata.read))}g.matches=k}return g.matches}function fv(t,o,a,d){const g=t.queries.getByIndex(a),w=g.matches;if(null!==w){const I=zb(t,o,g,a);for(let k=0;k<w.length;k+=2){const j=w[k];if(j>0)d.push(I[k/2]);else{const se=w[k+1],he=o[-j];for(let ke=Zr;ke<he.length;ke++){const dt=he[ke];dt[is]===dt[xr]&&fv(dt[$n],dt,se,d)}if(null!==he[Oo]){const ke=he[Oo];for(let dt=0;dt<ke.length;dt++){const Dt=ke[dt];fv(Dt[$n],Dt,se,d)}}}}}return d}function Ub(t){const o=hn(),a=lr(),d=du();Xs(d+1);const g=Gb(a,d);if(t.dirty&&function ra(t){return 4==(4&t[oi])}(o)===(2==(2&g.metadata.flags))){if(null===g.matches)t.reset([]);else{const w=g.crossesNgTemplate?fv(a,o,d,[]):zb(a,o,g,d);t.reset(w,Zg),t.notifyOnChanges()}return!0}return!1}function Vb(t,o,a,d){const g=lr();if(g.firstCreatePass){const w=Go();(function Hb(t,o,a){null===t.queries&&(t.queries=new dv),t.queries.track(new hv(o,a))})(g,new Bb(o,a,d),w.index),function ZE(t,o){const a=t.contentQueries||(t.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(t.queries.length-1,o)}(g,t),2==(2&a)&&(g.staticContentQueries=!0)}!function $b(t,o,a){const d=new av(4==(4&a));(function ey(t,o,a,d){const g=sh(o);g.push(a),t.firstCreatePass&&c_(t).push(d,g.length-1)})(t,o,d,d.destroy),null===o[Ko]&&(o[Ko]=new uv),o[Ko].queries.push(new cv(d))}(g,hn(),a)}function jb(){return function WE(t,o){return t[Ko].queries[o].queryList}(hn(),du())}function Gb(t,o){return t.queries.getByIndex(o)}function pv(t){return!!Ji(t)}const lx=new no("Application Initializer");let vv=(()=>{var t;class o{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((d,g)=>{this.resolve=d,this.reject=g}),this.appInits=qn(lx,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const d=[];for(const w of this.appInits){const I=w();if(Uy(I))d.push(I);else if(Vv(I)){const k=new Promise((j,se)=>{I.subscribe({complete:j,error:se})});d.push(k)}}const g=()=>{this.done=!0,this.resolve()};Promise.all(d).then(()=>{g()}).catch(w=>{this.reject(w)}),0===d.length&&g(),this.initialized=!0}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=ti({token:t,factory:t.\u0275fac,providedIn:"root"}),o})(),cx=(()=>{var t;class o{log(d){console.log(d)}warn(d){console.warn(d)}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=ti({token:t,factory:t.\u0275fac,providedIn:"platform"}),o})();const yy=new no("LocaleId",{providedIn:"root",factory:()=>qn(yy,ii.Optional|ii.SkipSelf)||function mC(){return typeof $localize<"u"&&$localize.locale||qm}()}),gC=new no("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});let ux=(()=>{var t;class o{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ge.X(!1)}add(){this.hasPendingTasks.next(!0);const d=this.taskId++;return this.pendingTasks.add(d),d}remove(d){this.pendingTasks.delete(d),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=ti({token:t,factory:t.\u0275fac,providedIn:"root"}),o})();class yC{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let vC=(()=>{var t;class o{compileModuleSync(d){return new ov(d)}compileModuleAsync(d){return Promise.resolve(this.compileModuleSync(d))}compileModuleAndAllComponentsSync(d){const g=this.compileModuleSync(d),I=eu(Ji(d).declarations).reduce((k,j)=>{const se=ri(j);return se&&k.push(new qr(se)),k},[]);return new yC(g,I)}compileModuleAndAllComponentsAsync(d){return Promise.resolve(this.compileModuleAndAllComponentsSync(d))}clearCache(){}clearCacheFor(d){}getModuleId(d){}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=ti({token:t,factory:t.\u0275fac,providedIn:"root"}),o})();const px=new no(""),mx=new no("");let wv,zC=(()=>{var t;class o{constructor(d,g,w){this._ngZone=d,this.registry=g,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,wv||(function UC(t){wv=t}(w),w.addToWindow(g)),this._watchAngularEvents(),d.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{fs.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let d=this._callbacks.pop();clearTimeout(d.timeoutId),d.doneCb(this._didWork)}this._didWork=!1});else{let d=this.getPendingTasks();this._callbacks=this._callbacks.filter(g=>!g.updateCb||!g.updateCb(d)||(clearTimeout(g.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(d=>({source:d.source,creationLocation:d.creationLocation,data:d.data})):[]}addCallback(d,g,w){let I=-1;g&&g>0&&(I=setTimeout(()=>{this._callbacks=this._callbacks.filter(k=>k.timeoutId!==I),d(this._didWork,this.getPendingTasks())},g)),this._callbacks.push({doneCb:d,timeoutId:I,updateCb:w})}whenStable(d,g,w){if(w&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(d,g,w),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(d){this.registry.registerApplication(d,this)}unregisterApplication(d){this.registry.unregisterApplication(d)}findProviders(d,g,w){return[]}}return(t=o).\u0275fac=function(d){return new(d||t)(_n(fs),_n(gx),_n(mx))},t.\u0275prov=ti({token:t,factory:t.\u0275fac}),o})(),gx=(()=>{var t;class o{constructor(){this._applications=new Map}registerApplication(d,g){this._applications.set(d,g)}unregisterApplication(d){this._applications.delete(d)}unregisterAllApplications(){this._applications.clear()}getTestability(d){return this._applications.get(d)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(d,g=!0){return wv?.findTestabilityInTree(this,d,g)??null}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=ti({token:t,factory:t.\u0275fac,providedIn:"platform"}),o})(),gf=null;const _x=new no("AllowMultipleToken"),Ev=new no("PlatformDestroyListeners"),Cv=new no("appBootstrapListener");class $C{constructor(o,a){this.name=o,this.token=a}}function bx(t,o,a=[]){const d=`Platform: ${o}`,g=new no(d);return(w=[])=>{let I=Dv();if(!I||I.injector.get(_x,!1)){const k=[...a,...w,{provide:g,useValue:!0}];t?t(k):function HC(t){if(gf&&!gf.get(_x,!1))throw new ft(400,!1);(function yx(){!function fa(t){Ia=t}(()=>{throw new ft(600,!1)})})(),gf=t;const o=t.get(wx);(function vx(t){t.get(Bg,null)?.forEach(a=>a())})(t)}(function xx(t=[],o){return cl.create({name:o,providers:[{provide:Gd,useValue:"platform"},{provide:Ev,useValue:new Set([()=>gf=null])},...t]})}(k,d))}return function WC(t){const o=Dv();if(!o)throw new ft(401,!1);return o}()}}function Dv(){return gf?.get(wx)??null}let wx=(()=>{var t;class o{constructor(d){this._injector=d,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(d,g){const w=function ZC(t="zone.js",o){return"noop"===t?new Xh:"zone.js"===t?new fs(o):t}(g?.ngZone,function Ex(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}({eventCoalescing:g?.ngZoneEventCoalescing,runCoalescing:g?.ngZoneRunCoalescing}));return w.run(()=>{const I=function eE(t,o,a){return new rv(t,o,a)}(d.moduleType,this.injector,function Sx(t){return[{provide:fs,useFactory:t},{provide:Vh,multi:!0,useFactory:()=>{const o=qn(KC,{optional:!0});return()=>o.initialize()}},{provide:Mx,useFactory:qC},{provide:Jh,useFactory:Qh}]}(()=>w)),k=I.injector.get(wc,null);return w.runOutsideAngular(()=>{const j=w.onError.subscribe({next:se=>{k.handleError(se)}});I.onDestroy(()=>{by(this._modules,I),j.unsubscribe()})}),function Cx(t,o,a){try{const d=a();return Uy(d)?d.catch(g=>{throw o.runOutsideAngular(()=>t.handleError(g)),g}):d}catch(d){throw o.runOutsideAngular(()=>t.handleError(d)),d}}(k,w,()=>{const j=I.injector.get(vv);return j.runInitializers(),j.donePromise.then(()=>(function U0(t){Vt(t,"Expected localeId to be defined"),"string"==typeof t&&(z0=t.toLowerCase().replace(/_/g,"-"))}(I.injector.get(yy,qm)||qm),this._moduleDoBootstrap(I),I))})})}bootstrapModule(d,g=[]){const w=Dx({},g);return function VC(t,o,a){const d=new ov(a);return Promise.resolve(d)}(0,0,d).then(I=>this.bootstrapModuleFactory(I,w))}_moduleDoBootstrap(d){const g=d.injector.get(Xm);if(d._bootstrapComponents.length>0)d._bootstrapComponents.forEach(w=>g.bootstrap(w));else{if(!d.instance.ngDoBootstrap)throw new ft(-403,!1);d.instance.ngDoBootstrap(g)}this._modules.push(d)}onDestroy(d){this._destroyListeners.push(d)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ft(404,!1);this._modules.slice().forEach(g=>g.destroy()),this._destroyListeners.forEach(g=>g());const d=this._injector.get(Ev,null);d&&(d.forEach(g=>g()),d.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return(t=o).\u0275fac=function(d){return new(d||t)(_n(cl))},t.\u0275prov=ti({token:t,factory:t.\u0275fac,providedIn:"platform"}),o})();function Dx(t,o){return Array.isArray(o)?o.reduce(Dx,t):{...t,...o}}let Xm=(()=>{var t;class o{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=qn(Mx),this.zoneIsStable=qn(Jh),this.componentTypes=[],this.components=[],this.isStable=qn(ux).hasPendingTasks.pipe((0,Ye.w)(d=>d?(0,Ke.of)(!1):this.zoneIsStable),(0,Ge.x)(),(0,nt.B)()),this._injector=qn($l)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(d,g){const w=d instanceof Gg;if(!this._injector.get(vv).done)throw!w&&Qr(d),new ft(405,!1);let k;k=w?d:this._injector.get(Xc).resolveComponentFactory(d),this.componentTypes.push(k.componentType);const j=function jC(t){return t.isBoundToModule}(k)?void 0:this._injector.get(Op),he=k.create(cl.NULL,[],g||k.selector,j),ke=he.location.nativeElement,dt=he.injector.get(px,null);return dt?.registerApplication(ke),he.onDestroy(()=>{this.detachView(he.hostView),by(this.components,he),dt?.unregisterApplication(ke)}),this._loadComponent(he),he}tick(){if(this._runningTick)throw new ft(101,!1);try{this._runningTick=!0;for(let d of this._views)d.detectChanges()}catch(d){this.internalErrorHandler(d)}finally{this._runningTick=!1}}attachView(d){const g=d;this._views.push(g),g.attachToAppRef(this)}detachView(d){const g=d;by(this._views,g),g.detachFromAppRef()}_loadComponent(d){this.attachView(d.hostView),this.tick(),this.components.push(d);const g=this._injector.get(Cv,[]);g.push(...this._bootstrapListeners),g.forEach(w=>w(d))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(d=>d()),this._views.slice().forEach(d=>d.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(d){return this._destroyListeners.push(d),()=>by(this._destroyListeners,d)}destroy(){if(this._destroyed)throw new ft(406,!1);const d=this._injector;d.destroy&&!d.destroyed&&d.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=ti({token:t,factory:t.\u0275fac,providedIn:"root"}),o})();function by(t,o){const a=t.indexOf(o);a>-1&&t.splice(a,1)}const Mx=new no("",{providedIn:"root",factory:()=>qn(wc).handleError.bind(void 0)});function qC(){const t=qn(fs),o=qn(wc);return a=>t.runOutsideAngular(()=>o.handleError(a))}let KC=(()=>{var t;class o{constructor(){this.zone=qn(fs),this.applicationRef=qn(Xm)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=ti({token:t,factory:t.\u0275fac,providedIn:"root"}),o})();function XC(){return!1}let JC=(()=>{class o{}return o.__NG_ELEMENT_ID__=QC,o})();function QC(t){return function eD(t,o,a){if(Ss(t)&&!a){const d=_r(t.index,o);return new di(d,d)}return 47&t.type?new di(o[Fr],o):null}(Go(),hn(),16==(16&t))}class Rx{constructor(){}supports(o){return sn(o)}create(o){return new sD(o)}}const oD=(t,o)=>o;class sD{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||oD}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,d=this._removalsHead,g=0,w=null;for(;a||d;){const I=!d||a&&a.currentIndex<kx(d,g,w)?a:d,k=kx(I,g,w),j=I.currentIndex;if(I===d)g--,d=d._nextRemoved;else if(a=a._next,null==I.previousIndex)g++;else{w||(w=[]);const se=k-g,he=j-g;if(se!=he){for(let dt=0;dt<se;dt++){const Dt=dt<w.length?w[dt]:w[dt]=0,un=Dt+dt;he<=un&&un<se&&(w[dt]=Dt+1)}w[I.previousIndex]=he-se}}k!==j&&o(I,k,j)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!sn(o))throw new ft(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let g,w,I,a=this._itHead,d=!1;if(Array.isArray(o)){this.length=o.length;for(let k=0;k<this.length;k++)w=o[k],I=this._trackByFn(k,w),null!==a&&Object.is(a.trackById,I)?(d&&(a=this._verifyReinsertion(a,w,I,k)),Object.is(a.item,w)||this._addIdentityChange(a,w)):(a=this._mismatch(a,w,I,k),d=!0),a=a._next}else g=0,function nn(t,o){if(Array.isArray(t))for(let a=0;a<t.length;a++)o(t[a]);else{const a=t[Symbol.iterator]();let d;for(;!(d=a.next()).done;)o(d.value)}}(o,k=>{I=this._trackByFn(g,k),null!==a&&Object.is(a.trackById,I)?(d&&(a=this._verifyReinsertion(a,k,I,g)),Object.is(a.item,k)||this._addIdentityChange(a,k)):(a=this._mismatch(a,k,I,g),d=!0),a=a._next,g++}),this.length=g;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,d,g){let w;return null===o?w=this._itTail:(w=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,w,g)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(d,g))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,w,g)):o=this._addAfter(new aD(a,d),w,g),o}_verifyReinsertion(o,a,d,g){let w=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null);return null!==w?o=this._reinsertAfter(w,o._prev,g):o.currentIndex!=g&&(o.currentIndex=g,this._addToMoves(o,g)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,d){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const g=o._prevRemoved,w=o._nextRemoved;return null===g?this._removalsHead=w:g._nextRemoved=w,null===w?this._removalsTail=g:w._prevRemoved=g,this._insertAfter(o,a,d),this._addToMoves(o,d),o}_moveAfter(o,a,d){return this._unlink(o),this._insertAfter(o,a,d),this._addToMoves(o,d),o}_addAfter(o,a,d){return this._insertAfter(o,a,d),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,d){const g=null===a?this._itHead:a._next;return o._next=g,o._prev=a,null===g?this._itTail=o:g._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new Ox),this._linkedRecords.put(o),o.currentIndex=d,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,d=o._next;return null===a?this._itHead=d:a._next=d,null===d?this._itTail=a:d._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Ox),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class aD{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class lD{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let d;for(d=this._head;null!==d;d=d._nextDup)if((null===a||a<=d.currentIndex)&&Object.is(d.trackById,o))return d;return null}remove(o){const a=o._prevDup,d=o._nextDup;return null===a?this._head=d:a._nextDup=d,null===d?this._tail=a:d._prevDup=a,null===this._head}}class Ox{constructor(){this.map=new Map}put(o){const a=o.trackById;let d=this.map.get(a);d||(d=new lD,this.map.set(a,d)),d.add(o)}get(o,a){const g=this.map.get(o);return g?g.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function kx(t,o,a){const d=t.previousIndex;if(null===d)return d;let g=0;return a&&d<a.length&&(g=a[d]),d+o+g}class Lx{constructor(){}supports(o){return o instanceof Map||rn(o)}create(){return new cD}}class cD{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||rn(o)))throw new ft(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(d,g)=>{if(a&&a.key===g)this._maybeAddToChanges(a,d),this._appendAfter=a,a=a._next;else{const w=this._getOrCreateRecordForKey(g,d);a=this._insertBeforeOrAppend(a,w)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let d=a;null!==d;d=d._nextRemoved)d===this._mapHead&&(this._mapHead=null),this._records.delete(d.key),d._nextRemoved=d._next,d.previousValue=d.currentValue,d.currentValue=null,d._prev=null,d._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const d=o._prev;return a._next=o,a._prev=d,o._prev=a,d&&(d._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const g=this._records.get(o);this._maybeAddToChanges(g,a);const w=g._prev,I=g._next;return w&&(w._next=I),I&&(I._prev=w),g._next=null,g._prev=null,g}const d=new uD(o);return this._records.set(o,d),d.currentValue=a,this._addToAdditions(d),d}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(d=>a(o[d],d))}}class uD{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Fx(){return new Av([new Rx])}let Av=(()=>{var t;class o{constructor(d){this.factories=d}static create(d,g){if(null!=g){const w=g.factories.slice();d=d.concat(w)}return new o(d)}static extend(d){return{provide:o,useFactory:g=>o.create(d,g||Fx()),deps:[[o,new vf,new mh]]}}find(d){const g=this.factories.find(w=>w.supports(d));if(null!=g)return g;throw new ft(901,!1)}}return(t=o).\u0275prov=ti({token:t,providedIn:"root",factory:Fx}),o})();function Nx(){return new Pv([new Lx])}let Pv=(()=>{var t;class o{constructor(d){this.factories=d}static create(d,g){if(g){const w=g.factories.slice();d=d.concat(w)}return new o(d)}static extend(d){return{provide:o,useFactory:g=>o.create(d,g||Nx()),deps:[[o,new vf,new mh]]}}find(d){const g=this.factories.find(w=>w.supports(d));if(g)return g;throw new ft(901,!1)}}return(t=o).\u0275prov=ti({token:t,providedIn:"root",factory:Nx}),o})();const fD=bx(null,"core",[]);let pD=(()=>{var t;class o{constructor(d){}}return(t=o).\u0275fac=function(d){return new(d||t)(_n(Xm))},t.\u0275mod=yn({type:t}),t.\u0275inj=$i({}),o})();function DD(t){return"boolean"==typeof t?t:null!=t&&"false"!==t}function MD(t){const o=ri(t);if(!o)return null;const a=new qr(o);return{get selector(){return a.selector},get type(){return a.componentType},get inputs(){return a.inputs},get outputs(){return a.outputs},get ngContentSelectors(){return a.ngContentSelectors},get isStandalone(){return o.standalone},get isSignal(){return o.signals}}}},1993:(ut,Ue,re)=>{"use strict";re.d(Ue,{O4:()=>bn});var S=re(5879);class Ke extends Error{constructor(Vt,Gt){super(function nt($t,Vt){return`NG0${Math.abs($t)}${Vt?": "+Vt:""}`}(Vt,Gt)),this.code=Vt}}function bn($t,Vt){const Gt=!Vt?.manualCleanup;Gt&&!Vt?.injector&&(0,S.gHi)(bn);const zn=Gt?Vt?.injector?.get(S.ktI)??(0,S.f3M)(S.ktI):null;let Yn;Yn=(0,S.tdS)(Vt?.requireSync?{kind:0}:{kind:1,value:Vt?.initialValue});const Ln=$t.subscribe({next:ti=>Yn.set({kind:1,value:ti}),error:ti=>Yn.set({kind:2,error:ti})});return zn?.onDestroy(Ln.unsubscribe.bind(Ln)),(0,S.Flj)(()=>{const ti=Yn();switch(ti.kind){case 1:return ti.value;case 2:throw ti.error;case 0:throw new Ke(601,"`toSignal()` called with `requireSync` but `Observable` did not emit synchronously.")}})}globalThis},95:(ut,Ue,re)=>{"use strict";re.d(Ue,{Fj:()=>ft,NI:()=>wo,u:()=>$o,cw:()=>Gn,sg:()=>oi,u5:()=>su,JJ:()=>gi,JL:()=>Mi,UX:()=>Bu,kI:()=>Ti,_Y:()=>Sr});var S=re(5879),Re=re(6814),K=re(9666),l=re(5592),ge=re(7453),Ke=re(4829),nt=re(9940),Ye=re(8251),Ge=re(7400),Xe=re(2714),ht=re(7398);let Bt=(()=>{var ne;class Q{constructor(ie,Ae){this._renderer=ie,this._elementRef=Ae,this.onChange=Pn=>{},this.onTouched=()=>{}}setProperty(ie,Ae){this._renderer.setProperty(this._elementRef.nativeElement,ie,Ae)}registerOnTouched(ie){this.onTouched=ie}registerOnChange(ie){this.onChange=ie}setDisabledState(ie){this.setProperty("disabled",ie)}}return(ne=Q).\u0275fac=function(ie){return new(ie||ne)(S.Y36(S.Qsj),S.Y36(S.SBq))},ne.\u0275dir=S.lG2({type:ne}),Q})(),zt=(()=>{var ne;class Q extends Bt{}return(ne=Q).\u0275fac=function(){let ye;return function(Ae){return(ye||(ye=S.n5z(ne)))(Ae||ne)}}(),ne.\u0275dir=S.lG2({type:ne,features:[S.qOj]}),Q})();const dn=new S.OlP("NgValueAccessor"),Tn={provide:dn,useExisting:(0,S.Gpc)(()=>ft),multi:!0},Dn=new S.OlP("CompositionEventMode");let ft=(()=>{var ne;class Q extends Bt{constructor(ie,Ae,Pn){super(ie,Ae),this._compositionMode=Pn,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function kn(){const ne=(0,Re.q)()?(0,Re.q)().getUserAgent():"";return/android (\d+)/.test(ne.toLowerCase())}())}writeValue(ie){this.setProperty("value",ie??"")}_handleInput(ie){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(ie)}_compositionStart(){this._composing=!0}_compositionEnd(ie){this._composing=!1,this._compositionMode&&this.onChange(ie)}}return(ne=Q).\u0275fac=function(ie){return new(ie||ne)(S.Y36(S.Qsj),S.Y36(S.SBq),S.Y36(Dn,8))},ne.\u0275dir=S.lG2({type:ne,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(ie,Ae){1&ie&&S.NdJ("input",function(Ii){return Ae._handleInput(Ii.target.value)})("blur",function(){return Ae.onTouched()})("compositionstart",function(){return Ae._compositionStart()})("compositionend",function(Ii){return Ae._compositionEnd(Ii.target.value)})},features:[S._Bn([Tn]),S.qOj]}),Q})();function Ze(ne){return null==ne||("string"==typeof ne||Array.isArray(ne))&&0===ne.length}function Xt(ne){return null!=ne&&"number"==typeof ne.length}const Pt=new S.OlP("NgValidators"),qt=new S.OlP("NgAsyncValidators"),vn=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Ti{static min(Q){return function Ei(ne){return Q=>{if(Ze(Q.value)||Ze(ne))return null;const ye=parseFloat(Q.value);return!isNaN(ye)&&ye<ne?{min:{min:ne,actual:Q.value}}:null}}(Q)}static max(Q){return function Li(ne){return Q=>{if(Ze(Q.value)||Ze(ne))return null;const ye=parseFloat(Q.value);return!isNaN(ye)&&ye>ne?{max:{max:ne,actual:Q.value}}:null}}(Q)}static required(Q){return function Mr(ne){return Ze(ne.value)?{required:!0}:null}(Q)}static requiredTrue(Q){return function hi(ne){return!0===ne.value?null:{required:!0}}(Q)}static email(Q){return function mr(ne){return Ze(ne.value)||vn.test(ne.value)?null:{email:!0}}(Q)}static minLength(Q){return function Oi(ne){return Q=>Ze(Q.value)||!Xt(Q.value)?null:Q.value.length<ne?{minlength:{requiredLength:ne,actualLength:Q.value.length}}:null}(Q)}static maxLength(Q){return function ji(ne){return Q=>Xt(Q.value)&&Q.value.length>ne?{maxlength:{requiredLength:ne,actualLength:Q.value.length}}:null}(Q)}static pattern(Q){return function so(ne){if(!ne)return _t;let Q,ye;return"string"==typeof ne?(ye="","^"!==ne.charAt(0)&&(ye+="^"),ye+=ne,"$"!==ne.charAt(ne.length-1)&&(ye+="$"),Q=new RegExp(ye)):(ye=ne.toString(),Q=ne),ie=>{if(Ze(ie.value))return null;const Ae=ie.value;return Q.test(Ae)?null:{pattern:{requiredPattern:ye,actualValue:Ae}}}}(Q)}static nullValidator(Q){return null}static compose(Q){return Gt(Q)}static composeAsync(Q){return Yn(Q)}}function _t(ne){return null}function Nt(ne){return null!=ne}function Yt(ne){return(0,S.QGY)(ne)?(0,K.D)(ne):ne}function Kt(ne){let Q={};return ne.forEach(ye=>{Q=null!=ye?{...Q,...ye}:Q}),0===Object.keys(Q).length?null:Q}function bn(ne,Q){return Q.map(ye=>ye(ne))}function Vt(ne){return ne.map(Q=>function $t(ne){return!ne.validate}(Q)?Q:ye=>Q.validate(ye))}function Gt(ne){if(!ne)return null;const Q=ne.filter(Nt);return 0==Q.length?null:function(ye){return Kt(bn(ye,Q))}}function zn(ne){return null!=ne?Gt(Vt(ne)):null}function Yn(ne){if(!ne)return null;const Q=ne.filter(Nt);return 0==Q.length?null:function(ye){return function at(...ne){const Q=(0,nt.jO)(ne),{args:ye,keys:ie}=(0,ge.D)(ne),Ae=new l.y(Pn=>{const{length:Ii}=ye;if(!Ii)return void Pn.complete();const Ho=new Array(Ii);let _o=Ii,us=Ii;for(let ko=0;ko<Ii;ko++){let Bs=!1;(0,Ke.Xf)(ye[ko]).subscribe((0,Ye.x)(Pn,Da=>{Bs||(Bs=!0,us--),Ho[ko]=Da},()=>_o--,void 0,()=>{(!_o||!Bs)&&(us||Pn.next(ie?(0,Xe.n)(ie,Ho):Ho),Pn.complete())}))}});return Q?Ae.pipe((0,Ge.Z)(Q)):Ae}(bn(ye,Q).map(Yt)).pipe((0,ht.U)(Kt))}}function Ln(ne){return null!=ne?Yn(Vt(ne)):null}function ti(ne,Q){return null===ne?[Q]:Array.isArray(ne)?[...ne,Q]:[ne,Q]}function fi(ne){return ne._rawValidators}function $i(ne){return ne._rawAsyncValidators}function Gr(ne){return ne?Array.isArray(ne)?ne:[ne]:[]}function vi(ne,Q){return Array.isArray(ne)?ne.includes(Q):ne===Q}function Zi(ne,Q){const ye=Gr(Q);return Gr(ne).forEach(Ae=>{vi(ye,Ae)||ye.push(Ae)}),ye}function Do(ne,Q){return Gr(Q).filter(ye=>!vi(ne,ye))}class Yr{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(Q){this._rawValidators=Q||[],this._composedValidatorFn=zn(this._rawValidators)}_setAsyncValidators(Q){this._rawAsyncValidators=Q||[],this._composedAsyncValidatorFn=Ln(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(Q){this._onDestroyCallbacks.push(Q)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(Q=>Q()),this._onDestroyCallbacks=[]}reset(Q=void 0){this.control&&this.control.reset(Q)}hasError(Q,ye){return!!this.control&&this.control.hasError(Q,ye)}getError(Q,ye){return this.control?this.control.getError(Q,ye):null}}class sr extends Yr{get formDirective(){return null}get path(){return null}}class wr extends Yr{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class bo{constructor(Q){this._cd=Q}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let gi=(()=>{var ne;class Q extends bo{constructor(ie){super(ie)}}return(ne=Q).\u0275fac=function(ie){return new(ie||ne)(S.Y36(wr,2))},ne.\u0275dir=S.lG2({type:ne,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(ie,Ae){2&ie&&S.ekj("ng-untouched",Ae.isUntouched)("ng-touched",Ae.isTouched)("ng-pristine",Ae.isPristine)("ng-dirty",Ae.isDirty)("ng-valid",Ae.isValid)("ng-invalid",Ae.isInvalid)("ng-pending",Ae.isPending)},features:[S.qOj]}),Q})(),Mi=(()=>{var ne;class Q extends bo{constructor(ie){super(ie)}}return(ne=Q).\u0275fac=function(ie){return new(ie||ne)(S.Y36(sr,10))},ne.\u0275dir=S.lG2({type:ne,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(ie,Ae){2&ie&&S.ekj("ng-untouched",Ae.isUntouched)("ng-touched",Ae.isTouched)("ng-pristine",Ae.isPristine)("ng-dirty",Ae.isDirty)("ng-valid",Ae.isValid)("ng-invalid",Ae.isInvalid)("ng-pending",Ae.isPending)("ng-submitted",Ae.isSubmitted)},features:[S.qOj]}),Q})();const ct="VALID",Je="INVALID",wt="PENDING",an="DISABLED";function fn(ne){return(Ve(ne)?ne.validators:ne)||null}function He(ne,Q){return(Ve(Q)?Q.asyncValidators:ne)||null}function Ve(ne){return null!=ne&&!Array.isArray(ne)&&"object"==typeof ne}class _n{constructor(Q,ye){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(Q),this._assignAsyncValidators(ye)}get validator(){return this._composedValidatorFn}set validator(Q){this._rawValidators=this._composedValidatorFn=Q}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(Q){this._rawAsyncValidators=this._composedAsyncValidatorFn=Q}get parent(){return this._parent}get valid(){return this.status===ct}get invalid(){return this.status===Je}get pending(){return this.status==wt}get disabled(){return this.status===an}get enabled(){return this.status!==an}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(Q){this._assignValidators(Q)}setAsyncValidators(Q){this._assignAsyncValidators(Q)}addValidators(Q){this.setValidators(Zi(Q,this._rawValidators))}addAsyncValidators(Q){this.setAsyncValidators(Zi(Q,this._rawAsyncValidators))}removeValidators(Q){this.setValidators(Do(Q,this._rawValidators))}removeAsyncValidators(Q){this.setAsyncValidators(Do(Q,this._rawAsyncValidators))}hasValidator(Q){return vi(this._rawValidators,Q)}hasAsyncValidator(Q){return vi(this._rawAsyncValidators,Q)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(Q={}){this.touched=!0,this._parent&&!Q.onlySelf&&this._parent.markAsTouched(Q)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(Q=>Q.markAllAsTouched())}markAsUntouched(Q={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(ye=>{ye.markAsUntouched({onlySelf:!0})}),this._parent&&!Q.onlySelf&&this._parent._updateTouched(Q)}markAsDirty(Q={}){this.pristine=!1,this._parent&&!Q.onlySelf&&this._parent.markAsDirty(Q)}markAsPristine(Q={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(ye=>{ye.markAsPristine({onlySelf:!0})}),this._parent&&!Q.onlySelf&&this._parent._updatePristine(Q)}markAsPending(Q={}){this.status=wt,!1!==Q.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!Q.onlySelf&&this._parent.markAsPending(Q)}disable(Q={}){const ye=this._parentMarkedDirty(Q.onlySelf);this.status=an,this.errors=null,this._forEachChild(ie=>{ie.disable({...Q,onlySelf:!0})}),this._updateValue(),!1!==Q.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...Q,skipPristineCheck:ye}),this._onDisabledChange.forEach(ie=>ie(!0))}enable(Q={}){const ye=this._parentMarkedDirty(Q.onlySelf);this.status=ct,this._forEachChild(ie=>{ie.enable({...Q,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:Q.emitEvent}),this._updateAncestors({...Q,skipPristineCheck:ye}),this._onDisabledChange.forEach(ie=>ie(!1))}_updateAncestors(Q){this._parent&&!Q.onlySelf&&(this._parent.updateValueAndValidity(Q),Q.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(Q){this._parent=Q}getRawValue(){return this.value}updateValueAndValidity(Q={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ct||this.status===wt)&&this._runAsyncValidator(Q.emitEvent)),!1!==Q.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!Q.onlySelf&&this._parent.updateValueAndValidity(Q)}_updateTreeValidity(Q={emitEvent:!0}){this._forEachChild(ye=>ye._updateTreeValidity(Q)),this.updateValueAndValidity({onlySelf:!0,emitEvent:Q.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?an:ct}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(Q){if(this.asyncValidator){this.status=wt,this._hasOwnPendingAsyncValidator=!0;const ye=Yt(this.asyncValidator(this));this._asyncValidationSubscription=ye.subscribe(ie=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(ie,{emitEvent:Q})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(Q,ye={}){this.errors=Q,this._updateControlsErrors(!1!==ye.emitEvent)}get(Q){let ye=Q;return null==ye||(Array.isArray(ye)||(ye=ye.split(".")),0===ye.length)?null:ye.reduce((ie,Ae)=>ie&&ie._find(Ae),this)}getError(Q,ye){const ie=ye?this.get(ye):this;return ie&&ie.errors?ie.errors[Q]:null}hasError(Q,ye){return!!this.getError(Q,ye)}get root(){let Q=this;for(;Q._parent;)Q=Q._parent;return Q}_updateControlsErrors(Q){this.status=this._calculateStatus(),Q&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(Q)}_initObservables(){this.valueChanges=new S.vpe,this.statusChanges=new S.vpe}_calculateStatus(){return this._allControlsDisabled()?an:this.errors?Je:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(wt)?wt:this._anyControlsHaveStatus(Je)?Je:ct}_anyControlsHaveStatus(Q){return this._anyControls(ye=>ye.status===Q)}_anyControlsDirty(){return this._anyControls(Q=>Q.dirty)}_anyControlsTouched(){return this._anyControls(Q=>Q.touched)}_updatePristine(Q={}){this.pristine=!this._anyControlsDirty(),this._parent&&!Q.onlySelf&&this._parent._updatePristine(Q)}_updateTouched(Q={}){this.touched=this._anyControlsTouched(),this._parent&&!Q.onlySelf&&this._parent._updateTouched(Q)}_registerOnCollectionChange(Q){this._onCollectionChange=Q}_setUpdateStrategy(Q){Ve(Q)&&null!=Q.updateOn&&(this._updateOn=Q.updateOn)}_parentMarkedDirty(Q){return!Q&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(Q){return null}_assignValidators(Q){this._rawValidators=Array.isArray(Q)?Q.slice():Q,this._composedValidatorFn=function qe(ne){return Array.isArray(ne)?zn(ne):ne||null}(this._rawValidators)}_assignAsyncValidators(Q){this._rawAsyncValidators=Array.isArray(Q)?Q.slice():Q,this._composedAsyncValidatorFn=function pt(ne){return Array.isArray(ne)?Ln(ne):ne||null}(this._rawAsyncValidators)}}class Gn extends _n{constructor(Q,ye,ie){super(fn(ye),He(ie,ye)),this.controls=Q,this._initObservables(),this._setUpdateStrategy(ye),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(Q,ye){return this.controls[Q]?this.controls[Q]:(this.controls[Q]=ye,ye.setParent(this),ye._registerOnCollectionChange(this._onCollectionChange),ye)}addControl(Q,ye,ie={}){this.registerControl(Q,ye),this.updateValueAndValidity({emitEvent:ie.emitEvent}),this._onCollectionChange()}removeControl(Q,ye={}){this.controls[Q]&&this.controls[Q]._registerOnCollectionChange(()=>{}),delete this.controls[Q],this.updateValueAndValidity({emitEvent:ye.emitEvent}),this._onCollectionChange()}setControl(Q,ye,ie={}){this.controls[Q]&&this.controls[Q]._registerOnCollectionChange(()=>{}),delete this.controls[Q],ye&&this.registerControl(Q,ye),this.updateValueAndValidity({emitEvent:ie.emitEvent}),this._onCollectionChange()}contains(Q){return this.controls.hasOwnProperty(Q)&&this.controls[Q].enabled}setValue(Q,ye={}){(function Ut(ne,Q,ye){ne._forEachChild((ie,Ae)=>{if(void 0===ye[Ae])throw new S.vHH(1002,"")})})(this,0,Q),Object.keys(Q).forEach(ie=>{(function mt(ne,Q,ye){const ie=ne.controls;if(!(Q?Object.keys(ie):ie).length)throw new S.vHH(1e3,"");if(!ie[ye])throw new S.vHH(1001,"")})(this,!0,ie),this.controls[ie].setValue(Q[ie],{onlySelf:!0,emitEvent:ye.emitEvent})}),this.updateValueAndValidity(ye)}patchValue(Q,ye={}){null!=Q&&(Object.keys(Q).forEach(ie=>{const Ae=this.controls[ie];Ae&&Ae.patchValue(Q[ie],{onlySelf:!0,emitEvent:ye.emitEvent})}),this.updateValueAndValidity(ye))}reset(Q={},ye={}){this._forEachChild((ie,Ae)=>{ie.reset(Q[Ae],{onlySelf:!0,emitEvent:ye.emitEvent})}),this._updatePristine(ye),this._updateTouched(ye),this.updateValueAndValidity(ye)}getRawValue(){return this._reduceChildren({},(Q,ye,ie)=>(Q[ie]=ye.getRawValue(),Q))}_syncPendingControls(){let Q=this._reduceChildren(!1,(ye,ie)=>!!ie._syncPendingControls()||ye);return Q&&this.updateValueAndValidity({onlySelf:!0}),Q}_forEachChild(Q){Object.keys(this.controls).forEach(ye=>{const ie=this.controls[ye];ie&&Q(ie,ye)})}_setUpControls(){this._forEachChild(Q=>{Q.setParent(this),Q._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(Q){for(const[ye,ie]of Object.entries(this.controls))if(this.contains(ye)&&Q(ie))return!0;return!1}_reduceValue(){return this._reduceChildren({},(ye,ie,Ae)=>((ie.enabled||this.disabled)&&(ye[Ae]=ie.value),ye))}_reduceChildren(Q,ye){let ie=Q;return this._forEachChild((Ae,Pn)=>{ie=ye(ie,Ae,Pn)}),ie}_allControlsDisabled(){for(const Q of Object.keys(this.controls))if(this.controls[Q].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(Q){return this.controls.hasOwnProperty(Q)?this.controls[Q]:null}}const lt=new S.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>Be}),Be="always";function Rt(ne,Q,ye=Be){An(ne,Q),Q.valueAccessor.writeValue(ne.value),(ne.disabled||"always"===ye)&&Q.valueAccessor.setDisabledState?.(ne.disabled),function Ci(ne,Q){Q.valueAccessor.registerOnChange(ye=>{ne._pendingValue=ye,ne._pendingChange=!0,ne._pendingDirty=!0,"change"===ne.updateOn&&Mo(ne,Q)})}(ne,Q),function Ar(ne,Q){const ye=(ie,Ae)=>{Q.valueAccessor.writeValue(ie),Ae&&Q.viewToModelUpdate(ie)};ne.registerOnChange(ye),Q._registerOnDestroy(()=>{ne._unregisterOnChange(ye)})}(ne,Q),function dr(ne,Q){Q.valueAccessor.registerOnTouched(()=>{ne._pendingTouched=!0,"blur"===ne.updateOn&&ne._pendingChange&&Mo(ne,Q),"submit"!==ne.updateOn&&ne.markAsTouched()})}(ne,Q),function Kn(ne,Q){if(Q.valueAccessor.setDisabledState){const ye=ie=>{Q.valueAccessor.setDisabledState(ie)};ne.registerOnDisabledChange(ye),Q._registerOnDestroy(()=>{ne._unregisterOnDisabledChange(ye)})}}(ne,Q)}function en(ne,Q,ye=!0){const ie=()=>{};Q.valueAccessor&&(Q.valueAccessor.registerOnChange(ie),Q.valueAccessor.registerOnTouched(ie)),qi(ne,Q),ne&&(Q._invokeOnDestroyCallbacks(),ne._registerOnCollectionChange(()=>{}))}function wn(ne,Q){ne.forEach(ye=>{ye.registerOnValidatorChange&&ye.registerOnValidatorChange(Q)})}function An(ne,Q){const ye=fi(ne);null!==Q.validator?ne.setValidators(ti(ye,Q.validator)):"function"==typeof ye&&ne.setValidators([ye]);const ie=$i(ne);null!==Q.asyncValidator?ne.setAsyncValidators(ti(ie,Q.asyncValidator)):"function"==typeof ie&&ne.setAsyncValidators([ie]);const Ae=()=>ne.updateValueAndValidity();wn(Q._rawValidators,Ae),wn(Q._rawAsyncValidators,Ae)}function qi(ne,Q){let ye=!1;if(null!==ne){if(null!==Q.validator){const Ae=fi(ne);if(Array.isArray(Ae)&&Ae.length>0){const Pn=Ae.filter(Ii=>Ii!==Q.validator);Pn.length!==Ae.length&&(ye=!0,ne.setValidators(Pn))}}if(null!==Q.asyncValidator){const Ae=$i(ne);if(Array.isArray(Ae)&&Ae.length>0){const Pn=Ae.filter(Ii=>Ii!==Q.asyncValidator);Pn.length!==Ae.length&&(ye=!0,ne.setAsyncValidators(Pn))}}}const ie=()=>{};return wn(Q._rawValidators,ie),wn(Q._rawAsyncValidators,ie),ye}function Mo(ne,Q){ne._pendingDirty&&ne.markAsDirty(),ne.setValue(ne._pendingValue,{emitModelToViewChange:!1}),Q.viewToModelUpdate(ne._pendingValue),ne._pendingChange=!1}function jo(ne,Q){const ye=ne.indexOf(Q);ye>-1&&ne.splice(ye,1)}function Bi(ne){return"object"==typeof ne&&null!==ne&&2===Object.keys(ne).length&&"value"in ne&&"disabled"in ne}const wo=class extends _n{constructor(Q=null,ye,ie){super(fn(ye),He(ie,ye)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(Q),this._setUpdateStrategy(ye),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Ve(ye)&&(ye.nonNullable||ye.initialValueIsDefault)&&(this.defaultValue=Bi(Q)?Q.value:Q)}setValue(Q,ye={}){this.value=this._pendingValue=Q,this._onChange.length&&!1!==ye.emitModelToViewChange&&this._onChange.forEach(ie=>ie(this.value,!1!==ye.emitViewToModelChange)),this.updateValueAndValidity(ye)}patchValue(Q,ye={}){this.setValue(Q,ye)}reset(Q=this.defaultValue,ye={}){this._applyFormState(Q),this.markAsPristine(ye),this.markAsUntouched(ye),this.setValue(this.value,ye),this._pendingChange=!1}_updateValue(){}_anyControls(Q){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(Q){this._onChange.push(Q)}_unregisterOnChange(Q){jo(this._onChange,Q)}registerOnDisabledChange(Q){this._onDisabledChange.push(Q)}_unregisterOnDisabledChange(Q){jo(this._onDisabledChange,Q)}_forEachChild(Q){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(Q){Bi(Q)?(this.value=this._pendingValue=Q.value,Q.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=Q}};let Sr=(()=>{var ne;class Q{}return(ne=Q).\u0275fac=function(ie){return new(ie||ne)},ne.\u0275dir=S.lG2({type:ne,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),Q})(),Qr=(()=>{var ne;class Q{}return(ne=Q).\u0275fac=function(ie){return new(ie||ne)},ne.\u0275mod=S.oAB({type:ne}),ne.\u0275inj=S.cJS({}),Q})();const Dr=new S.OlP("NgModelWithFormControlWarning"),$n={provide:sr,useExisting:(0,S.Gpc)(()=>oi)};let oi=(()=>{var ne;class Q extends sr{constructor(ie,Ae,Pn){super(),this.callSetDisabledState=Pn,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new S.vpe,this._setValidators(ie),this._setAsyncValidators(Ae)}ngOnChanges(ie){this._checkFormPresent(),ie.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(qi(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(ie){const Ae=this.form.get(ie.path);return Rt(Ae,ie,this.callSetDisabledState),Ae.updateValueAndValidity({emitEvent:!1}),this.directives.push(ie),Ae}getControl(ie){return this.form.get(ie.path)}removeControl(ie){en(ie.control||null,ie,!1),function gs(ne,Q){const ye=ne.indexOf(Q);ye>-1&&ne.splice(ye,1)}(this.directives,ie)}addFormGroup(ie){this._setUpFormContainer(ie)}removeFormGroup(ie){this._cleanUpFormContainer(ie)}getFormGroup(ie){return this.form.get(ie.path)}addFormArray(ie){this._setUpFormContainer(ie)}removeFormArray(ie){this._cleanUpFormContainer(ie)}getFormArray(ie){return this.form.get(ie.path)}updateModel(ie,Ae){this.form.get(ie.path).setValue(Ae)}onSubmit(ie){return this.submitted=!0,function Vo(ne,Q){ne._syncPendingControls(),Q.forEach(ye=>{const ie=ye.control;"submit"===ie.updateOn&&ie._pendingChange&&(ye.viewToModelUpdate(ie._pendingValue),ie._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(ie),"dialog"===ie?.target?.method}onReset(){this.resetForm()}resetForm(ie=void 0){this.form.reset(ie),this.submitted=!1}_updateDomValue(){this.directives.forEach(ie=>{const Ae=ie.control,Pn=this.form.get(ie.path);Ae!==Pn&&(en(Ae||null,ie),(ne=>ne instanceof wo)(Pn)&&(Rt(Pn,ie,this.callSetDisabledState),ie.control=Pn))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(ie){const Ae=this.form.get(ie.path);(function Jr(ne,Q){An(ne,Q)})(Ae,ie),Ae.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(ie){if(this.form){const Ae=this.form.get(ie.path);Ae&&function So(ne,Q){return qi(ne,Q)}(Ae,ie)&&Ae.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){An(this.form,this),this._oldForm&&qi(this._oldForm,this)}_checkFormPresent(){}}return(ne=Q).\u0275fac=function(ie){return new(ie||ne)(S.Y36(Pt,10),S.Y36(qt,10),S.Y36(lt,8))},ne.\u0275dir=S.lG2({type:ne,selectors:[["","formGroup",""]],hostBindings:function(ie,Ae){1&ie&&S.NdJ("submit",function(Ii){return Ae.onSubmit(Ii)})("reset",function(){return Ae.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[S._Bn([$n]),S.qOj,S.TTD]}),Q})();const go={provide:wr,useExisting:(0,S.Gpc)(()=>$o)};let $o=(()=>{var ne;class Q extends wr{set isDisabled(ie){}constructor(ie,Ae,Pn,Ii,Ho){super(),this._ngModelWarningConfig=Ho,this._added=!1,this.name=null,this.update=new S.vpe,this._ngModelWarningSent=!1,this._parent=ie,this._setValidators(Ae),this._setAsyncValidators(Pn),this.valueAccessor=function Pr(ne,Q){if(!Q)return null;let ye,ie,Ae;return Array.isArray(Q),Q.forEach(Pn=>{Pn.constructor===ft?ye=Pn:function ao(ne){return Object.getPrototypeOf(ne.constructor)===zt}(Pn)?ie=Pn:Ae=Pn}),Ae||ie||ye||null}(0,Ii)}ngOnChanges(ie){this._added||this._setUpControl(),function Wr(ne,Q){if(!ne.hasOwnProperty("model"))return!1;const ye=ne.model;return!!ye.isFirstChange()||!Object.is(Q,ye.currentValue)}(ie,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(ie){this.viewModel=ie,this.update.emit(ie)}get path(){return function Ft(ne,Q){return[...Q.path,ne]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return(ne=Q)._ngModelWarningSentOnce=!1,ne.\u0275fac=function(ie){return new(ie||ne)(S.Y36(sr,13),S.Y36(Pt,10),S.Y36(qt,10),S.Y36(dn,10),S.Y36(Dr,8))},ne.\u0275dir=S.lG2({type:ne,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[S._Bn([go]),S.qOj,S.TTD]}),Q})(),Va=(()=>{var ne;class Q{}return(ne=Q).\u0275fac=function(ie){return new(ie||ne)},ne.\u0275mod=S.oAB({type:ne}),ne.\u0275inj=S.cJS({imports:[Qr]}),Q})(),su=(()=>{var ne;class Q{static withConfig(ie){return{ngModule:Q,providers:[{provide:lt,useValue:ie.callSetDisabledState??Be}]}}}return(ne=Q).\u0275fac=function(ie){return new(ie||ne)},ne.\u0275mod=S.oAB({type:ne}),ne.\u0275inj=S.cJS({imports:[Va]}),Q})(),Bu=(()=>{var ne;class Q{static withConfig(ie){return{ngModule:Q,providers:[{provide:Dr,useValue:ie.warnOnNgModelWithFormControl??"always"},{provide:lt,useValue:ie.callSetDisabledState??Be}]}}}return(ne=Q).\u0275fac=function(ie){return new(ie||ne)},ne.\u0275mod=S.oAB({type:ne}),ne.\u0275inj=S.cJS({imports:[Va]}),Q})()},6593:(ut,Ue,re)=>{"use strict";re.d(Ue,{Dx:()=>wr,b2:()=>vi,q6:()=>ti,se:()=>vn});var S=re(5879),Re=re(6814);class K extends Re.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class l extends K{static makeCurrent(){(0,Re.HT)(new l)}onAndCancel(He,pt,Ve){return He.addEventListener(pt,Ve),()=>{He.removeEventListener(pt,Ve)}}dispatchEvent(He,pt){He.dispatchEvent(pt)}remove(He){He.parentNode&&He.parentNode.removeChild(He)}createElement(He,pt){return(pt=pt||this.getDefaultDocument()).createElement(He)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(He){return He.nodeType===Node.ELEMENT_NODE}isShadowRoot(He){return He instanceof DocumentFragment}getGlobalEventTarget(He,pt){return"window"===pt?window:"document"===pt?He:"body"===pt?He.body:null}getBaseHref(He){const pt=function Ke(){return ge=ge||document.querySelector("base"),ge?ge.getAttribute("href"):null}();return null==pt?null:function Ye(qe){nt=nt||document.createElement("a"),nt.setAttribute("href",qe);const He=nt.pathname;return"/"===He.charAt(0)?He:`/${He}`}(pt)}resetBaseElement(){ge=null}getUserAgent(){return window.navigator.userAgent}getCookie(He){return(0,Re.Mx)(document.cookie,He)}}let nt,ge=null,Xe=(()=>{var qe;class He{build(){return new XMLHttpRequest}}return(qe=He).\u0275fac=function(Ve){return new(Ve||qe)},qe.\u0275prov=S.Yz7({token:qe,factory:qe.\u0275fac}),He})();const at=new S.OlP("EventManagerPlugins");let ht=(()=>{var qe;class He{constructor(Ve,mt){this._zone=mt,this._eventNameToPlugin=new Map,Ve.forEach(Ut=>{Ut.manager=this}),this._plugins=Ve.slice().reverse()}addEventListener(Ve,mt,Ut){return this._findPluginFor(mt).addEventListener(Ve,mt,Ut)}getZone(){return this._zone}_findPluginFor(Ve){let mt=this._eventNameToPlugin.get(Ve);if(mt)return mt;if(mt=this._plugins.find(_n=>_n.supports(Ve)),!mt)throw new S.vHH(5101,!1);return this._eventNameToPlugin.set(Ve,mt),mt}}return(qe=He).\u0275fac=function(Ve){return new(Ve||qe)(S.LFG(at),S.LFG(S.R0b))},qe.\u0275prov=S.Yz7({token:qe,factory:qe.\u0275fac}),He})();class Bt{constructor(He){this._doc=He}}const zt="ng-app-id";let dn=(()=>{var qe;class He{constructor(Ve,mt,Ut,_n={}){this.doc=Ve,this.appId=mt,this.nonce=Ut,this.platformId=_n,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=(0,Re.PM)(_n),this.resetHostNodes()}addStyles(Ve){for(const mt of Ve)1===this.changeUsageCount(mt,1)&&this.onStyleAdded(mt)}removeStyles(Ve){for(const mt of Ve)this.changeUsageCount(mt,-1)<=0&&this.onStyleRemoved(mt)}ngOnDestroy(){const Ve=this.styleNodesInDOM;Ve&&(Ve.forEach(mt=>mt.remove()),Ve.clear());for(const mt of this.getAllStyles())this.onStyleRemoved(mt);this.resetHostNodes()}addHost(Ve){this.hostNodes.add(Ve);for(const mt of this.getAllStyles())this.addStyleToHost(Ve,mt)}removeHost(Ve){this.hostNodes.delete(Ve)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(Ve){for(const mt of this.hostNodes)this.addStyleToHost(mt,Ve)}onStyleRemoved(Ve){const mt=this.styleRef;mt.get(Ve)?.elements?.forEach(Ut=>Ut.remove()),mt.delete(Ve)}collectServerRenderedStyles(){const Ve=this.doc.head?.querySelectorAll(`style[${zt}="${this.appId}"]`);if(Ve?.length){const mt=new Map;return Ve.forEach(Ut=>{null!=Ut.textContent&&mt.set(Ut.textContent,Ut)}),mt}return null}changeUsageCount(Ve,mt){const Ut=this.styleRef;if(Ut.has(Ve)){const _n=Ut.get(Ve);return _n.usage+=mt,_n.usage}return Ut.set(Ve,{usage:mt,elements:[]}),mt}getStyleElement(Ve,mt){const Ut=this.styleNodesInDOM,_n=Ut?.get(mt);if(_n?.parentNode===Ve)return Ut.delete(mt),_n.removeAttribute(zt),_n;{const Gn=this.doc.createElement("style");return this.nonce&&Gn.setAttribute("nonce",this.nonce),Gn.textContent=mt,this.platformIsServer&&Gn.setAttribute(zt,this.appId),Gn}}addStyleToHost(Ve,mt){const Ut=this.getStyleElement(Ve,mt);Ve.appendChild(Ut);const _n=this.styleRef,Gn=_n.get(mt)?.elements;Gn?Gn.push(Ut):_n.set(mt,{elements:[Ut],usage:1})}resetHostNodes(){const Ve=this.hostNodes;Ve.clear(),Ve.add(this.doc.head)}}return(qe=He).\u0275fac=function(Ve){return new(Ve||qe)(S.LFG(Re.K0),S.LFG(S.AFp),S.LFG(S.Ojb,8),S.LFG(S.Lbi))},qe.\u0275prov=S.Yz7({token:qe,factory:qe.\u0275fac}),He})();const St={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Bn=/%COMP%/g,Ze=new S.OlP("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function qt(qe,He){return He.map(pt=>pt.replace(Bn,qe))}let vn=(()=>{var qe;class He{constructor(Ve,mt,Ut,_n,Gn,qn,_i,Cr=null){this.eventManager=Ve,this.sharedStylesHost=mt,this.appId=Ut,this.removeStylesOnCompDestroy=_n,this.doc=Gn,this.platformId=qn,this.ngZone=_i,this.nonce=Cr,this.rendererByCompId=new Map,this.platformIsServer=(0,Re.PM)(qn),this.defaultRenderer=new Ti(Ve,Gn,_i,this.platformIsServer)}createRenderer(Ve,mt){if(!Ve||!mt)return this.defaultRenderer;this.platformIsServer&&mt.encapsulation===S.ifc.ShadowDom&&(mt={...mt,encapsulation:S.ifc.Emulated});const Ut=this.getOrCreateRenderer(Ve,mt);return Ut instanceof Oi?Ut.applyToHost(Ve):Ut instanceof mr&&Ut.applyStyles(),Ut}getOrCreateRenderer(Ve,mt){const Ut=this.rendererByCompId;let _n=Ut.get(mt.id);if(!_n){const Gn=this.doc,qn=this.ngZone,_i=this.eventManager,Cr=this.sharedStylesHost,ur=this.removeStylesOnCompDestroy,lt=this.platformIsServer;switch(mt.encapsulation){case S.ifc.Emulated:_n=new Oi(_i,Cr,mt,this.appId,ur,Gn,qn,lt);break;case S.ifc.ShadowDom:return new hi(_i,Cr,Ve,mt,Gn,qn,this.nonce,lt);default:_n=new mr(_i,Cr,mt,ur,Gn,qn,lt)}Ut.set(mt.id,_n)}return _n}ngOnDestroy(){this.rendererByCompId.clear()}}return(qe=He).\u0275fac=function(Ve){return new(Ve||qe)(S.LFG(ht),S.LFG(dn),S.LFG(S.AFp),S.LFG(Ze),S.LFG(Re.K0),S.LFG(S.Lbi),S.LFG(S.R0b),S.LFG(S.Ojb))},qe.\u0275prov=S.Yz7({token:qe,factory:qe.\u0275fac}),He})();class Ti{constructor(He,pt,Ve,mt){this.eventManager=He,this.doc=pt,this.ngZone=Ve,this.platformIsServer=mt,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(He,pt){return pt?this.doc.createElementNS(St[pt]||pt,He):this.doc.createElement(He)}createComment(He){return this.doc.createComment(He)}createText(He){return this.doc.createTextNode(He)}appendChild(He,pt){(Mr(He)?He.content:He).appendChild(pt)}insertBefore(He,pt,Ve){He&&(Mr(He)?He.content:He).insertBefore(pt,Ve)}removeChild(He,pt){He&&He.removeChild(pt)}selectRootElement(He,pt){let Ve="string"==typeof He?this.doc.querySelector(He):He;if(!Ve)throw new S.vHH(-5104,!1);return pt||(Ve.textContent=""),Ve}parentNode(He){return He.parentNode}nextSibling(He){return He.nextSibling}setAttribute(He,pt,Ve,mt){if(mt){pt=mt+":"+pt;const Ut=St[mt];Ut?He.setAttributeNS(Ut,pt,Ve):He.setAttribute(pt,Ve)}else He.setAttribute(pt,Ve)}removeAttribute(He,pt,Ve){if(Ve){const mt=St[Ve];mt?He.removeAttributeNS(mt,pt):He.removeAttribute(`${Ve}:${pt}`)}else He.removeAttribute(pt)}addClass(He,pt){He.classList.add(pt)}removeClass(He,pt){He.classList.remove(pt)}setStyle(He,pt,Ve,mt){mt&(S.JOm.DashCase|S.JOm.Important)?He.style.setProperty(pt,Ve,mt&S.JOm.Important?"important":""):He.style[pt]=Ve}removeStyle(He,pt,Ve){Ve&S.JOm.DashCase?He.style.removeProperty(pt):He.style[pt]=""}setProperty(He,pt,Ve){He[pt]=Ve}setValue(He,pt){He.nodeValue=pt}listen(He,pt,Ve){if("string"==typeof He&&!(He=(0,Re.q)().getGlobalEventTarget(this.doc,He)))throw new Error(`Unsupported event target ${He} for event ${pt}`);return this.eventManager.addEventListener(He,pt,this.decoratePreventDefault(Ve))}decoratePreventDefault(He){return pt=>{if("__ngUnwrap__"===pt)return He;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>He(pt)):He(pt))&&pt.preventDefault()}}}function Mr(qe){return"TEMPLATE"===qe.tagName&&void 0!==qe.content}class hi extends Ti{constructor(He,pt,Ve,mt,Ut,_n,Gn,qn){super(He,Ut,_n,qn),this.sharedStylesHost=pt,this.hostEl=Ve,this.shadowRoot=Ve.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const _i=qt(mt.id,mt.styles);for(const Cr of _i){const ur=document.createElement("style");Gn&&ur.setAttribute("nonce",Gn),ur.textContent=Cr,this.shadowRoot.appendChild(ur)}}nodeOrShadowRoot(He){return He===this.hostEl?this.shadowRoot:He}appendChild(He,pt){return super.appendChild(this.nodeOrShadowRoot(He),pt)}insertBefore(He,pt,Ve){return super.insertBefore(this.nodeOrShadowRoot(He),pt,Ve)}removeChild(He,pt){return super.removeChild(this.nodeOrShadowRoot(He),pt)}parentNode(He){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(He)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class mr extends Ti{constructor(He,pt,Ve,mt,Ut,_n,Gn,qn){super(He,Ut,_n,Gn),this.sharedStylesHost=pt,this.removeStylesOnCompDestroy=mt,this.styles=qn?qt(qn,Ve.styles):Ve.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class Oi extends mr{constructor(He,pt,Ve,mt,Ut,_n,Gn,qn){const _i=mt+"-"+Ve.id;super(He,pt,Ve,Ut,_n,Gn,qn,_i),this.contentAttr=function Xt(qe){return"_ngcontent-%COMP%".replace(Bn,qe)}(_i),this.hostAttr=function Pt(qe){return"_nghost-%COMP%".replace(Bn,qe)}(_i)}applyToHost(He){this.applyStyles(),this.setAttribute(He,this.hostAttr,"")}createElement(He,pt){const Ve=super.createElement(He,pt);return super.setAttribute(Ve,this.contentAttr,""),Ve}}let ji=(()=>{var qe;class He extends Bt{constructor(Ve){super(Ve)}supports(Ve){return!0}addEventListener(Ve,mt,Ut){return Ve.addEventListener(mt,Ut,!1),()=>this.removeEventListener(Ve,mt,Ut)}removeEventListener(Ve,mt,Ut){return Ve.removeEventListener(mt,Ut)}}return(qe=He).\u0275fac=function(Ve){return new(Ve||qe)(S.LFG(Re.K0))},qe.\u0275prov=S.Yz7({token:qe,factory:qe.\u0275fac}),He})();const so=["alt","control","meta","shift"],_t={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Nt={alt:qe=>qe.altKey,control:qe=>qe.ctrlKey,meta:qe=>qe.metaKey,shift:qe=>qe.shiftKey};let Yt=(()=>{var qe;class He extends Bt{constructor(Ve){super(Ve)}supports(Ve){return null!=He.parseEventName(Ve)}addEventListener(Ve,mt,Ut){const _n=He.parseEventName(mt),Gn=He.eventCallback(_n.fullKey,Ut,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,Re.q)().onAndCancel(Ve,_n.domEventName,Gn))}static parseEventName(Ve){const mt=Ve.toLowerCase().split("."),Ut=mt.shift();if(0===mt.length||"keydown"!==Ut&&"keyup"!==Ut)return null;const _n=He._normalizeKey(mt.pop());let Gn="",qn=mt.indexOf("code");if(qn>-1&&(mt.splice(qn,1),Gn="code."),so.forEach(Cr=>{const ur=mt.indexOf(Cr);ur>-1&&(mt.splice(ur,1),Gn+=Cr+".")}),Gn+=_n,0!=mt.length||0===_n.length)return null;const _i={};return _i.domEventName=Ut,_i.fullKey=Gn,_i}static matchEventFullKeyCode(Ve,mt){let Ut=_t[Ve.key]||Ve.key,_n="";return mt.indexOf("code.")>-1&&(Ut=Ve.code,_n="code."),!(null==Ut||!Ut)&&(Ut=Ut.toLowerCase()," "===Ut?Ut="space":"."===Ut&&(Ut="dot"),so.forEach(Gn=>{Gn!==Ut&&(0,Nt[Gn])(Ve)&&(_n+=Gn+".")}),_n+=Ut,_n===mt)}static eventCallback(Ve,mt,Ut){return _n=>{He.matchEventFullKeyCode(_n,Ve)&&Ut.runGuarded(()=>mt(_n))}}static _normalizeKey(Ve){return"esc"===Ve?"escape":Ve}}return(qe=He).\u0275fac=function(Ve){return new(Ve||qe)(S.LFG(Re.K0))},qe.\u0275prov=S.Yz7({token:qe,factory:qe.\u0275fac}),He})();const ti=(0,S.eFA)(S._c5,"browser",[{provide:S.Lbi,useValue:Re.bD},{provide:S.g9A,useValue:function Gt(){l.makeCurrent()},multi:!0},{provide:Re.K0,useFactory:function Yn(){return(0,S.RDi)(document),document},deps:[]}]),fi=new S.OlP(""),$i=[{provide:S.rWj,useClass:class Ge{addToWindow(He){S.dqk.getAngularTestability=(Ve,mt=!0)=>{const Ut=He.findTestabilityInTree(Ve,mt);if(null==Ut)throw new S.vHH(5103,!1);return Ut},S.dqk.getAllAngularTestabilities=()=>He.getAllTestabilities(),S.dqk.getAllAngularRootElements=()=>He.getAllRootElements(),S.dqk.frameworkStabilizers||(S.dqk.frameworkStabilizers=[]),S.dqk.frameworkStabilizers.push(Ve=>{const mt=S.dqk.getAllAngularTestabilities();let Ut=mt.length,_n=!1;const Gn=function(qn){_n=_n||qn,Ut--,0==Ut&&Ve(_n)};mt.forEach(qn=>{qn.whenStable(Gn)})})}findTestabilityInTree(He,pt,Ve){return null==pt?null:He.getTestability(pt)??(Ve?(0,Re.q)().isShadowRoot(pt)?this.findTestabilityInTree(He,pt.host,!0):this.findTestabilityInTree(He,pt.parentElement,!0):null)}},deps:[]},{provide:S.lri,useClass:S.dDg,deps:[S.R0b,S.eoX,S.rWj]},{provide:S.dDg,useClass:S.dDg,deps:[S.R0b,S.eoX,S.rWj]}],Gr=[{provide:S.zSh,useValue:"root"},{provide:S.qLn,useFactory:function zn(){return new S.qLn},deps:[]},{provide:at,useClass:ji,multi:!0,deps:[Re.K0,S.R0b,S.Lbi]},{provide:at,useClass:Yt,multi:!0,deps:[Re.K0]},vn,dn,ht,{provide:S.FYo,useExisting:vn},{provide:Re.JF,useClass:Xe,deps:[]},[]];let vi=(()=>{var qe;class He{constructor(Ve){}static withServerTransition(Ve){return{ngModule:He,providers:[{provide:S.AFp,useValue:Ve.appId}]}}}return(qe=He).\u0275fac=function(Ve){return new(Ve||qe)(S.LFG(fi,12))},qe.\u0275mod=S.oAB({type:qe}),qe.\u0275inj=S.cJS({providers:[...Gr,...$i],imports:[Re.ez,S.hGG]}),He})(),wr=(()=>{var qe;class He{constructor(Ve){this._doc=Ve}getTitle(){return this._doc.title}setTitle(Ve){this._doc.title=Ve||""}}return(qe=He).\u0275fac=function(Ve){return new(Ve||qe)(S.LFG(Re.K0))},qe.\u0275prov=S.Yz7({token:qe,factory:function(Ve){let mt=null;return mt=Ve?new Ve:function sr(){return new wr((0,S.LFG)(Re.K0))}(),mt},providedIn:"root"}),He})();typeof window<"u"&&window},4382:(ut,Ue,re)=>{"use strict";re.d(Ue,{gz:()=>Dr,F0:()=>Fn,rH:()=>sa,Bz:()=>bs,lC:()=>Ds});var S=re(5879),Re=re(5592),K=re(4674),ge=re(9666),Ke=re(2096),nt=re(5619),Ye=re(2572);const Xe=(0,re(2306).d)(L=>function(){L(this),this.name="EmptyError",this.message="no elements in sequence"});var at=re(5211),ht=re(4829);function Bt(L){return new Re.y(B=>{(0,ht.Xf)(L()).subscribe(B)})}var zt=re(8407),dn=re(8504),St=re(6232),Bn=re(7394),Tn=re(9360),kn=re(8251);function Dn(){return(0,Tn.e)((L,B)=>{let $=null;L._refCount++;const O=(0,kn.x)(B,void 0,void 0,void 0,()=>{if(!L||L._refCount<=0||0<--L._refCount)return void($=null);const X=L._connection,pe=$;$=null,X&&(!pe||X===pe)&&X.unsubscribe(),B.unsubscribe()});L.subscribe(O),O.closed||($=L.connect())})}class ft extends Re.y{constructor(B,$){super(),this.source=B,this.subjectFactory=$,this._subject=null,this._refCount=0,this._connection=null,(0,Tn.A)(B)&&(this.lift=B.lift)}_subscribe(B){return this.getSubject().subscribe(B)}getSubject(){const B=this._subject;return(!B||B.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:B}=this;this._subject=this._connection=null,B?.unsubscribe()}connect(){let B=this._connection;if(!B){B=this._connection=new Bn.w0;const $=this.getSubject();B.add(this.source.subscribe((0,kn.x)($,void 0,()=>{this._teardown(),$.complete()},O=>{this._teardown(),$.error(O)},()=>this._teardown()))),B.closed&&(this._connection=null,B=Bn.w0.EMPTY)}return B}refCount(){return Dn()(this)}}var Ze=re(8645),Xt=re(6814),Pt=re(7398),qt=re(4664),vn=re(8180),Ti=re(7921),Ei=re(2181),Li=re(1631);function Mr(L){return(0,Tn.e)((B,$)=>{let O=!1;B.subscribe((0,kn.x)($,X=>{O=!0,$.next(X)},()=>{O||$.next(L),$.complete()}))})}function hi(L=mr){return(0,Tn.e)((B,$)=>{let O=!1;B.subscribe((0,kn.x)($,X=>{O=!0,$.next(X)},()=>O?$.complete():$.error(L())))})}function mr(){return new Xe}var Oi=re(2737);function ji(L,B){const $=arguments.length>=2;return O=>O.pipe(L?(0,Ei.h)((X,pe)=>L(X,pe,O)):Oi.y,(0,vn.q)(1),$?Mr(B):hi(()=>new Xe))}var so=re(6328);function _t(L,B,$){const O=(0,K.m)(L)||B||$?{next:L,error:B,complete:$}:L;return O?(0,Tn.e)((X,pe)=>{var Te;null===(Te=O.subscribe)||void 0===Te||Te.call(O);let Et=!0;X.subscribe((0,kn.x)(pe,Mn=>{var jt;null===(jt=O.next)||void 0===jt||jt.call(O,Mn),pe.next(Mn)},()=>{var Mn;Et=!1,null===(Mn=O.complete)||void 0===Mn||Mn.call(O),pe.complete()},Mn=>{var jt;Et=!1,null===(jt=O.error)||void 0===jt||jt.call(O,Mn),pe.error(Mn)},()=>{var Mn,jt;Et&&(null===(Mn=O.unsubscribe)||void 0===Mn||Mn.call(O)),null===(jt=O.finalize)||void 0===jt||jt.call(O)}))}):Oi.y}var Nt=re(6306),Yt=re(6699);function Kt(L){return L<=0?()=>St.E:(0,Tn.e)((B,$)=>{let O=[];B.subscribe((0,kn.x)($,X=>{O.push(X),L<O.length&&O.shift()},()=>{for(const X of O)$.next(X);$.complete()},void 0,()=>{O=null}))})}var Vt=re(4716),Gt=re(9773),zn=re(7537),Yn=re(6593);const Ln="primary",ti=Symbol("RouteTitle");class fi{constructor(B){this.params=B||{}}has(B){return Object.prototype.hasOwnProperty.call(this.params,B)}get(B){if(this.has(B)){const $=this.params[B];return Array.isArray($)?$[0]:$}return null}getAll(B){if(this.has(B)){const $=this.params[B];return Array.isArray($)?$:[$]}return[]}get keys(){return Object.keys(this.params)}}function $i(L){return new fi(L)}function Gr(L,B,$){const O=$.path.split("/");if(O.length>L.length||"full"===$.pathMatch&&(B.hasChildren()||O.length<L.length))return null;const X={};for(let pe=0;pe<O.length;pe++){const Te=O[pe],Et=L[pe];if(Te.startsWith(":"))X[Te.substring(1)]=Et;else if(Te!==Et.path)return null}return{consumed:L.slice(0,O.length),posParams:X}}function Zi(L,B){const $=L?Object.keys(L):void 0,O=B?Object.keys(B):void 0;if(!$||!O||$.length!=O.length)return!1;let X;for(let pe=0;pe<$.length;pe++)if(X=$[pe],!Do(L[X],B[X]))return!1;return!0}function Do(L,B){if(Array.isArray(L)&&Array.isArray(B)){if(L.length!==B.length)return!1;const $=[...L].sort(),O=[...B].sort();return $.every((X,pe)=>O[pe]===X)}return L===B}function Yr(L){return L.length>0?L[L.length-1]:null}function sr(L){return function l(L){return!!L&&(L instanceof Re.y||(0,K.m)(L.lift)&&(0,K.m)(L.subscribe))}(L)?L:(0,S.QGY)(L)?(0,ge.D)(Promise.resolve(L)):(0,Ke.of)(L)}const wr={exact:function gi(L,B,$){if(!xo(L.segments,B.segments)||!po(L.segments,B.segments,$)||L.numberOfChildren!==B.numberOfChildren)return!1;for(const O in B.children)if(!L.children[O]||!gi(L.children[O],B.children[O],$))return!1;return!0},subset:Er},bo={exact:function ii(L,B){return Zi(L,B)},subset:function Mi(L,B){return Object.keys(B).length<=Object.keys(L).length&&Object.keys(B).every($=>Do(L[$],B[$]))},ignored:()=>!0};function To(L,B,$){return wr[$.paths](L.root,B.root,$.matrixParams)&&bo[$.queryParams](L.queryParams,B.queryParams)&&!("exact"===$.fragment&&L.fragment!==B.fragment)}function Er(L,B,$){return fo(L,B,B.segments,$)}function fo(L,B,$,O){if(L.segments.length>$.length){const X=L.segments.slice(0,$.length);return!(!xo(X,$)||B.hasChildren()||!po(X,$,O))}if(L.segments.length===$.length){if(!xo(L.segments,$)||!po(L.segments,$,O))return!1;for(const X in B.children)if(!L.children[X]||!Er(L.children[X],B.children[X],O))return!1;return!0}{const X=$.slice(0,L.segments.length),pe=$.slice(L.segments.length);return!!(xo(L.segments,X)&&po(L.segments,X,O)&&L.children[Ln])&&fo(L.children[Ln],B,pe,O)}}function po(L,B,$){return B.every((O,X)=>bo[$](L[X].parameters,O.parameters))}class Gi{constructor(B=new Si([],{}),$={},O=null){this.root=B,this.queryParams=$,this.fragment=O}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=$i(this.queryParams)),this._queryParamMap}toString(){return ce.serialize(this)}}class Si{constructor(B,$){this.segments=B,this.children=$,this.parent=null,Object.values($).forEach(O=>O.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ue(this)}}class Ao{constructor(B,$){this.path=B,this.parameters=$}get parameterMap(){return this._parameterMap||(this._parameterMap=$i(this.parameters)),this._parameterMap}toString(){return an(this)}}function xo(L,B){return L.length===B.length&&L.every(($,O)=>$.path===B[O].path)}let Uo=(()=>{var L;class B{}return(L=B).\u0275fac=function(O){return new(O||L)},L.\u0275prov=S.Yz7({token:L,factory:function(){return new Le},providedIn:"root"}),B})();class Le{parse(B){const $=new _i(B);return new Gi($.parseRootSegment(),$.parseQueryParams(),$.parseFragment())}serialize(B){const $=`/${Se(B.root,!0)}`,O=function qe(L){const B=Object.keys(L).map($=>{const O=L[$];return Array.isArray(O)?O.map(X=>`${it($)}=${it(X)}`).join("&"):`${it($)}=${it(O)}`}).filter($=>!!$);return B.length?`?${B.join("&")}`:""}(B.queryParams);return`${$}${O}${"string"==typeof B.fragment?`#${function vt(L){return encodeURI(L)}(B.fragment)}`:""}`}}const ce=new Le;function ue(L){return L.segments.map(B=>an(B)).join("/")}function Se(L,B){if(!L.hasChildren())return ue(L);if(B){const $=L.children[Ln]?Se(L.children[Ln],!1):"",O=[];return Object.entries(L.children).forEach(([X,pe])=>{X!==Ln&&O.push(`${X}:${Se(pe,!1)}`)}),O.length>0?`${$}(${O.join("//")})`:$}{const $=function Hi(L,B){let $=[];return Object.entries(L.children).forEach(([O,X])=>{O===Ln&&($=$.concat(B(X,O)))}),Object.entries(L.children).forEach(([O,X])=>{O!==Ln&&($=$.concat(B(X,O)))}),$}(L,(O,X)=>X===Ln?[Se(L.children[Ln],!1)]:[`${X}:${Se(O,!1)}`]);return 1===Object.keys(L.children).length&&null!=L.children[Ln]?`${ue(L)}/${$[0]}`:`${ue(L)}/(${$.join("//")})`}}function $e(L){return encodeURIComponent(L).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function it(L){return $e(L).replace(/%3B/gi,";")}function ct(L){return $e(L).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Je(L){return decodeURIComponent(L)}function wt(L){return Je(L.replace(/\+/g,"%20"))}function an(L){return`${ct(L.path)}${function fn(L){return Object.keys(L).map(B=>`;${ct(B)}=${ct(L[B])}`).join("")}(L.parameters)}`}const He=/^[^\/()?;#]+/;function pt(L){const B=L.match(He);return B?B[0]:""}const Ve=/^[^\/()?;=#]+/,Ut=/^[^=?&#]+/,Gn=/^[^&#]+/;class _i{constructor(B){this.url=B,this.remaining=B}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Si([],{}):new Si([],this.parseChildren())}parseQueryParams(){const B={};if(this.consumeOptional("?"))do{this.parseQueryParam(B)}while(this.consumeOptional("&"));return B}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const B=[];for(this.peekStartsWith("(")||B.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),B.push(this.parseSegment());let $={};this.peekStartsWith("/(")&&(this.capture("/"),$=this.parseParens(!0));let O={};return this.peekStartsWith("(")&&(O=this.parseParens(!1)),(B.length>0||Object.keys($).length>0)&&(O[Ln]=new Si(B,$)),O}parseSegment(){const B=pt(this.remaining);if(""===B&&this.peekStartsWith(";"))throw new S.vHH(4009,!1);return this.capture(B),new Ao(Je(B),this.parseMatrixParams())}parseMatrixParams(){const B={};for(;this.consumeOptional(";");)this.parseParam(B);return B}parseParam(B){const $=function mt(L){const B=L.match(Ve);return B?B[0]:""}(this.remaining);if(!$)return;this.capture($);let O="";if(this.consumeOptional("=")){const X=pt(this.remaining);X&&(O=X,this.capture(O))}B[Je($)]=Je(O)}parseQueryParam(B){const $=function _n(L){const B=L.match(Ut);return B?B[0]:""}(this.remaining);if(!$)return;this.capture($);let O="";if(this.consumeOptional("=")){const Te=function qn(L){const B=L.match(Gn);return B?B[0]:""}(this.remaining);Te&&(O=Te,this.capture(O))}const X=wt($),pe=wt(O);if(B.hasOwnProperty(X)){let Te=B[X];Array.isArray(Te)||(Te=[Te],B[X]=Te),Te.push(pe)}else B[X]=pe}parseParens(B){const $={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const O=pt(this.remaining),X=this.remaining[O.length];if("/"!==X&&")"!==X&&";"!==X)throw new S.vHH(4010,!1);let pe;O.indexOf(":")>-1?(pe=O.slice(0,O.indexOf(":")),this.capture(pe),this.capture(":")):B&&(pe=Ln);const Te=this.parseChildren();$[pe]=1===Object.keys(Te).length?Te[Ln]:new Si([],Te),this.consumeOptional("//")}return $}peekStartsWith(B){return this.remaining.startsWith(B)}consumeOptional(B){return!!this.peekStartsWith(B)&&(this.remaining=this.remaining.substring(B.length),!0)}capture(B){if(!this.consumeOptional(B))throw new S.vHH(4011,!1)}}function Cr(L){return L.segments.length>0?new Si([],{[Ln]:L}):L}function ur(L){const B={};for(const O of Object.keys(L.children)){const pe=ur(L.children[O]);if(O===Ln&&0===pe.segments.length&&pe.hasChildren())for(const[Te,Et]of Object.entries(pe.children))B[Te]=Et;else(pe.segments.length>0||pe.hasChildren())&&(B[O]=pe)}return function lt(L){if(1===L.numberOfChildren&&L.children[Ln]){const B=L.children[Ln];return new Si(L.segments.concat(B.segments),B.children)}return L}(new Si(L.segments,B))}function Be(L){return L instanceof Gi}function Rt(L){let B;const X=Cr(function $(pe){const Te={};for(const Mn of pe.children){const jt=$(Mn);Te[Mn.outlet]=jt}const Et=new Si(pe.url,Te);return pe===L&&(B=Et),Et}(L.root));return B??X}function en(L,B,$,O){let X=L;for(;X.parent;)X=X.parent;if(0===B.length)return An(X,X,X,$,O);const pe=function dr(L){if("string"==typeof L[0]&&1===L.length&&"/"===L[0])return new Ci(!0,0,L);let B=0,$=!1;const O=L.reduce((X,pe,Te)=>{if("object"==typeof pe&&null!=pe){if(pe.outlets){const Et={};return Object.entries(pe.outlets).forEach(([Mn,jt])=>{Et[Mn]="string"==typeof jt?jt.split("/"):jt}),[...X,{outlets:Et}]}if(pe.segmentPath)return[...X,pe.segmentPath]}return"string"!=typeof pe?[...X,pe]:0===Te?(pe.split("/").forEach((Et,Mn)=>{0==Mn&&"."===Et||(0==Mn&&""===Et?$=!0:".."===Et?B++:""!=Et&&X.push(Et))}),X):[...X,pe]},[]);return new Ci($,B,O)}(B);if(pe.toRoot())return An(X,X,new Si([],{}),$,O);const Te=function Ar(L,B,$){if(L.isAbsolute)return new Mo(B,!0,0);if(!$)return new Mo(B,!1,NaN);if(null===$.parent)return new Mo($,!0,0);const O=wn(L.commands[0])?0:1;return function Jr(L,B,$){let O=L,X=B,pe=$;for(;pe>X;){if(pe-=X,O=O.parent,!O)throw new S.vHH(4005,!1);X=O.segments.length}return new Mo(O,!1,X-pe)}($,$.segments.length-1+O,L.numberOfDoubleDots)}(pe,X,L),Et=Te.processChildren?xt(Te.segmentGroup,Te.index,pe.commands):qo(Te.segmentGroup,Te.index,pe.commands);return An(X,Te.segmentGroup,Et,$,O)}function wn(L){return"object"==typeof L&&null!=L&&!L.outlets&&!L.segmentPath}function Kn(L){return"object"==typeof L&&null!=L&&L.outlets}function An(L,B,$,O,X){let Te,pe={};O&&Object.entries(O).forEach(([Mn,jt])=>{pe[Mn]=Array.isArray(jt)?jt.map(ui=>`${ui}`):`${jt}`}),Te=L===B?$:qi(L,B,$);const Et=Cr(ur(Te));return new Gi(Et,pe,X)}function qi(L,B,$){const O={};return Object.entries(L.children).forEach(([X,pe])=>{O[X]=pe===B?$:qi(pe,B,$)}),new Si(L.segments,O)}class Ci{constructor(B,$,O){if(this.isAbsolute=B,this.numberOfDoubleDots=$,this.commands=O,B&&O.length>0&&wn(O[0]))throw new S.vHH(4003,!1);const X=O.find(Kn);if(X&&X!==Yr(O))throw new S.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Mo{constructor(B,$,O){this.segmentGroup=B,this.processChildren=$,this.index=O}}function qo(L,B,$){if(L||(L=new Si([],{})),0===L.segments.length&&L.hasChildren())return xt(L,B,$);const O=function Xi(L,B,$){let O=0,X=B;const pe={match:!1,pathIndex:0,commandIndex:0};for(;X<L.segments.length;){if(O>=$.length)return pe;const Te=L.segments[X],Et=$[O];if(Kn(Et))break;const Mn=`${Et}`,jt=O<$.length-1?$[O+1]:null;if(X>0&&void 0===Mn)break;if(Mn&&jt&&"object"==typeof jt&&void 0===jt.outlets){if(!ao(Mn,jt,Te))return pe;O+=2}else{if(!ao(Mn,{},Te))return pe;O++}X++}return{match:!0,pathIndex:X,commandIndex:O}}(L,B,$),X=$.slice(O.commandIndex);if(O.match&&O.pathIndex<L.segments.length){const pe=new Si(L.segments.slice(0,O.pathIndex),{});return pe.children[Ln]=new Si(L.segments.slice(O.pathIndex),L.children),xt(pe,0,X)}return O.match&&0===X.length?new Si(L.segments,{}):O.match&&!L.hasChildren()?ar(L,B,$):O.match?xt(L,0,X):ar(L,B,$)}function xt(L,B,$){if(0===$.length)return new Si(L.segments,{});{const O=function So(L){return Kn(L[0])?L[0].outlets:{[Ln]:L}}($),X={};if(Object.keys(O).some(pe=>pe!==Ln)&&L.children[Ln]&&1===L.numberOfChildren&&0===L.children[Ln].segments.length){const pe=xt(L.children[Ln],B,$);return new Si(L.segments,pe.children)}return Object.entries(O).forEach(([pe,Te])=>{"string"==typeof Te&&(Te=[Te]),null!==Te&&(X[pe]=qo(L.children[pe],B,Te))}),Object.entries(L.children).forEach(([pe,Te])=>{void 0===O[pe]&&(X[pe]=Te)}),new Si(L.segments,X)}}function ar(L,B,$){const O=L.segments.slice(0,B);let X=0;for(;X<$.length;){const pe=$[X];if(Kn(pe)){const Mn=Lr(pe.outlets);return new Si(O,Mn)}if(0===X&&wn($[0])){O.push(new Ao(L.segments[B].path,Wr($[0]))),X++;continue}const Te=Kn(pe)?pe.outlets[Ln]:`${pe}`,Et=X<$.length-1?$[X+1]:null;Te&&Et&&wn(Et)?(O.push(new Ao(Te,Wr(Et))),X+=2):(O.push(new Ao(Te,{})),X++)}return new Si(O,{})}function Lr(L){const B={};return Object.entries(L).forEach(([$,O])=>{"string"==typeof O&&(O=[O]),null!==O&&(B[$]=ar(new Si([],{}),0,O))}),B}function Wr(L){const B={};return Object.entries(L).forEach(([$,O])=>B[$]=`${O}`),B}function ao(L,B,$){return L==$.path&&Zi(B,$.parameters)}const Vo="imperative";class Pr{constructor(B,$){this.id=B,this.url=$}}class gs extends Pr{constructor(B,$,O="imperative",X=null){super(B,$),this.type=0,this.navigationTrigger=O,this.restoredState=X}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Sn extends Pr{constructor(B,$,O){super(B,$),this.urlAfterRedirects=O,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ci extends Pr{constructor(B,$,O,X){super(B,$),this.reason=O,this.code=X,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class mi extends Pr{constructor(B,$,O,X){super(B,$),this.reason=O,this.code=X,this.type=16}}class mo extends Pr{constructor(B,$,O,X){super(B,$),this.error=O,this.target=X,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class jo extends Pr{constructor(B,$,O,X){super(B,$),this.urlAfterRedirects=O,this.state=X,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Bi extends Pr{constructor(B,$,O,X){super(B,$),this.urlAfterRedirects=O,this.state=X,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class wo extends Pr{constructor(B,$,O,X,pe){super(B,$),this.urlAfterRedirects=O,this.state=X,this.shouldActivate=pe,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class da extends Pr{constructor(B,$,O,X){super(B,$),this.urlAfterRedirects=O,this.state=X,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ks extends Pr{constructor(B,$,O,X){super(B,$),this.urlAfterRedirects=O,this.state=X,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ts{constructor(B){this.route=B,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Ur{constructor(B){this.route=B,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class ls{constructor(B){this.snapshot=B,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Oe{constructor(B){this.snapshot=B,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ot{constructor(B){this.snapshot=B,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class tn{constructor(B){this.snapshot=B,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bt{constructor(B,$,O){this.routerEvent=B,this.position=$,this.anchor=O,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class yn{}class Nn{constructor(B){this.url=B}}class Sr{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new gr,this.attachRef=null}}let gr=(()=>{var L;class B{constructor(){this.contexts=new Map}onChildOutletCreated(O,X){const pe=this.getOrCreateContext(O);pe.outlet=X,this.contexts.set(O,pe)}onChildOutletDestroyed(O){const X=this.getContext(O);X&&(X.outlet=null,X.attachRef=null)}onOutletDeactivated(){const O=this.contexts;return this.contexts=new Map,O}onOutletReAttached(O){this.contexts=O}getOrCreateContext(O){let X=this.getContext(O);return X||(X=new Sr,this.contexts.set(O,X)),X}getContext(O){return this.contexts.get(O)||null}}return(L=B).\u0275fac=function(O){return new(O||L)},L.\u0275prov=S.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),B})();class ri{constructor(B){this._root=B}get root(){return this._root.value}parent(B){const $=this.pathFromRoot(B);return $.length>1?$[$.length-2]:null}children(B){const $=Jn(B,this._root);return $?$.children.map(O=>O.value):[]}firstChild(B){const $=Jn(B,this._root);return $&&$.children.length>0?$.children[0].value:null}siblings(B){const $=br(B,this._root);return $.length<2?[]:$[$.length-2].children.map(X=>X.value).filter(X=>X!==B)}pathFromRoot(B){return br(B,this._root).map($=>$.value)}}function Jn(L,B){if(L===B.value)return B;for(const $ of B.children){const O=Jn(L,$);if(O)return O}return null}function br(L,B){if(L===B.value)return[B];for(const $ of B.children){const O=br(L,$);if(O.length)return O.unshift(B),O}return[]}class Qr{constructor(B,$){this.value=B,this.children=$}toString(){return`TreeNode(${this.value})`}}function Ji(L){const B={};return L&&L.children.forEach($=>B[$.value.outlet]=$),B}class Io extends ri{constructor(B,$){super(B),this.snapshot=$,xr(this,B)}toString(){return this.snapshot.toString()}}function el(L,B){const $=function ea(L,B){const Te=new $n([],{},{},"",{},Ln,B,null,{});return new oi("",new Qr(Te,[]))}(0,B),O=new nt.X([new Ao("",{})]),X=new nt.X({}),pe=new nt.X({}),Te=new nt.X({}),Et=new nt.X(""),Mn=new Dr(O,X,Te,Et,pe,Ln,B,$.root);return Mn.snapshot=$.root,new Io(new Qr(Mn,[]),$)}class Dr{constructor(B,$,O,X,pe,Te,Et,Mn){this.urlSubject=B,this.paramsSubject=$,this.queryParamsSubject=O,this.fragmentSubject=X,this.dataSubject=pe,this.outlet=Te,this.component=Et,this._futureSnapshot=Mn,this.title=this.dataSubject?.pipe((0,Pt.U)(jt=>jt[ti]))??(0,Ke.of)(void 0),this.url=B,this.params=$,this.queryParams=O,this.fragment=X,this.data=pe}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Pt.U)(B=>$i(B)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Pt.U)(B=>$i(B)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function za(L,B="emptyOnly"){const $=L.pathFromRoot;let O=0;if("always"!==B)for(O=$.length-1;O>=1;){const X=$[O],pe=$[O-1];if(X.routeConfig&&""===X.routeConfig.path)O--;else{if(pe.component)break;O--}}return function Vr(L){return L.reduce((B,$)=>({params:{...B.params,...$.params},data:{...B.data,...$.data},resolve:{...$.data,...B.resolve,...$.routeConfig?.data,...$._resolvedData}}),{params:{},data:{},resolve:{}})}($.slice(O))}class $n{get title(){return this.data?.[ti]}constructor(B,$,O,X,pe,Te,Et,Mn,jt){this.url=B,this.params=$,this.queryParams=O,this.fragment=X,this.data=pe,this.outlet=Te,this.component=Et,this.routeConfig=Mn,this._resolve=jt}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=$i(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=$i(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(O=>O.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class oi extends ri{constructor(B,$){super($),this.url=B,xr(this,$)}toString(){return Po(this._root)}}function xr(L,B){B.value._routerState=L,B.children.forEach($=>xr(L,$))}function Po(L){const B=L.children.length>0?` { ${L.children.map(Po).join(", ")} } `:"";return`${L.value}${B}`}function Ro(L){if(L.snapshot){const B=L.snapshot,$=L._futureSnapshot;L.snapshot=$,Zi(B.queryParams,$.queryParams)||L.queryParamsSubject.next($.queryParams),B.fragment!==$.fragment&&L.fragmentSubject.next($.fragment),Zi(B.params,$.params)||L.paramsSubject.next($.params),function vi(L,B){if(L.length!==B.length)return!1;for(let $=0;$<L.length;++$)if(!Zi(L[$],B[$]))return!1;return!0}(B.url,$.url)||L.urlSubject.next($.url),Zi(B.data,$.data)||L.dataSubject.next($.data)}else L.snapshot=L._futureSnapshot,L.dataSubject.next(L._futureSnapshot.data)}function jr(L,B){const $=Zi(L.params,B.params)&&function nr(L,B){return xo(L,B)&&L.every(($,O)=>Zi($.parameters,B[O].parameters))}(L.url,B.url);return $&&!(!L.parent!=!B.parent)&&(!L.parent||jr(L.parent,B.parent))}let Ds=(()=>{var L;class B{constructor(){this.activated=null,this._activatedRoute=null,this.name=Ln,this.activateEvents=new S.vpe,this.deactivateEvents=new S.vpe,this.attachEvents=new S.vpe,this.detachEvents=new S.vpe,this.parentContexts=(0,S.f3M)(gr),this.location=(0,S.f3M)(S.s_b),this.changeDetector=(0,S.f3M)(S.sBO),this.environmentInjector=(0,S.f3M)(S.lqb),this.inputBinder=(0,S.f3M)($o,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(O){if(O.name){const{firstChange:X,previousValue:pe}=O.name;if(X)return;this.isTrackedInParentContexts(pe)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(pe)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(O){return this.parentContexts.getContext(O)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const O=this.parentContexts.getContext(this.name);O?.route&&(O.attachRef?this.attach(O.attachRef,O.route):this.activateWith(O.route,O.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new S.vHH(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new S.vHH(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new S.vHH(4012,!1);this.location.detach();const O=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(O.instance),O}attach(O,X){this.activated=O,this._activatedRoute=X,this.location.insert(O.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(O.instance)}deactivate(){if(this.activated){const O=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(O)}}activateWith(O,X){if(this.isActivated)throw new S.vHH(4013,!1);this._activatedRoute=O;const pe=this.location,Et=O.snapshot.component,Mn=this.parentContexts.getOrCreateContext(this.name).children,jt=new go(O,Mn,pe.injector);this.activated=pe.createComponent(Et,{index:pe.length,injector:jt,environmentInjector:X??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return(L=B).\u0275fac=function(O){return new(O||L)},L.\u0275dir=S.lG2({type:L,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[S.TTD]}),B})();class go{constructor(B,$,O){this.route=B,this.childContexts=$,this.parent=O}get(B,$){return B===Dr?this.route:B===gr?this.childContexts:this.parent.get(B,$)}}const $o=new S.OlP("");let cs=(()=>{var L;class B{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(O){this.unsubscribeFromRouteData(O),this.subscribeToRouteData(O)}unsubscribeFromRouteData(O){this.outletDataSubscriptions.get(O)?.unsubscribe(),this.outletDataSubscriptions.delete(O)}subscribeToRouteData(O){const{activatedRoute:X}=O,pe=(0,Ye.a)([X.queryParams,X.params,X.data]).pipe((0,qt.w)(([Te,Et,Mn],jt)=>(Mn={...Te,...Et,...Mn},0===jt?(0,Ke.of)(Mn):Promise.resolve(Mn)))).subscribe(Te=>{if(!O.isActivated||!O.activatedComponentRef||O.activatedRoute!==X||null===X.component)return void this.unsubscribeFromRouteData(O);const Et=(0,S.qFp)(X.component);if(Et)for(const{templateName:Mn}of Et.inputs)O.activatedComponentRef.setInput(Mn,Te[Mn]);else this.unsubscribeFromRouteData(O)});this.outletDataSubscriptions.set(O,pe)}}return(L=B).\u0275fac=function(O){return new(O||L)},L.\u0275prov=S.Yz7({token:L,factory:L.\u0275fac}),B})();function Ts(L,B,$){if($&&L.shouldReuseRoute(B.value,$.value.snapshot)){const O=$.value;O._futureSnapshot=B.value;const X=function Ls(L,B,$){return B.children.map(O=>{for(const X of $.children)if(L.shouldReuseRoute(O.value,X.value.snapshot))return Ts(L,O,X);return Ts(L,O)})}(L,B,$);return new Qr(O,X)}{if(L.shouldAttach(B.value)){const pe=L.retrieve(B.value);if(null!==pe){const Te=pe.route;return Te.value._futureSnapshot=B.value,Te.children=B.children.map(Et=>Ts(L,Et)),Te}}const O=function ns(L){return new Dr(new nt.X(L.url),new nt.X(L.params),new nt.X(L.queryParams),new nt.X(L.fragment),new nt.X(L.data),L.outlet,L.component,L)}(B.value),X=B.children.map(pe=>Ts(L,pe));return new Qr(O,X)}}const Fr="ngNavigationCancelingError";function is(L,B){const{redirectTo:$,navigationBehaviorOptions:O}=Be(B)?{redirectTo:B,navigationBehaviorOptions:void 0}:B,X=Ws(!1,0,B);return X.url=$,X.navigationBehaviorOptions=O,X}function Ws(L,B,$){const O=new Error("NavigationCancelingError: "+(L||""));return O[Fr]=!0,O.cancellationCode=B,$&&(O.url=$),O}function _s(L){return L&&L[Fr]}let tl=(()=>{var L;class B{}return(L=B).\u0275fac=function(O){return new(O||L)},L.\u0275cmp=S.Xpm({type:L,selectors:[["ng-component"]],standalone:!0,features:[S.jDz],decls:1,vars:0,template:function(O,X){1&O&&S._UZ(0,"router-outlet")},dependencies:[Ds],encapsulation:2}),B})();function qs(L){const B=L.children&&L.children.map(qs),$=B?{...L,children:B}:{...L};return!$.component&&!$.loadComponent&&(B||$.loadChildren)&&$.outlet&&$.outlet!==Ln&&($.component=tl),$}function Oo(L){return L.outlet||Ln}function Zr(L){if(!L)return null;if(L.routeConfig?._injector)return L.routeConfig._injector;for(let B=L.parent;B;B=B.parent){const $=B.routeConfig;if($?._loadedInjector)return $._loadedInjector;if($?._injector)return $._injector}return null}class Eo{constructor(B,$,O,X,pe){this.routeReuseStrategy=B,this.futureState=$,this.currState=O,this.forwardEvent=X,this.inputBindingEnabled=pe}activate(B){const $=this.futureState._root,O=this.currState?this.currState._root:null;this.deactivateChildRoutes($,O,B),Ro(this.futureState.root),this.activateChildRoutes($,O,B)}deactivateChildRoutes(B,$,O){const X=Ji($);B.children.forEach(pe=>{const Te=pe.value.outlet;this.deactivateRoutes(pe,X[Te],O),delete X[Te]}),Object.values(X).forEach(pe=>{this.deactivateRouteAndItsChildren(pe,O)})}deactivateRoutes(B,$,O){const X=B.value,pe=$?$.value:null;if(X===pe)if(X.component){const Te=O.getContext(X.outlet);Te&&this.deactivateChildRoutes(B,$,Te.children)}else this.deactivateChildRoutes(B,$,O);else pe&&this.deactivateRouteAndItsChildren($,O)}deactivateRouteAndItsChildren(B,$){B.value.component&&this.routeReuseStrategy.shouldDetach(B.value.snapshot)?this.detachAndStoreRouteSubtree(B,$):this.deactivateRouteAndOutlet(B,$)}detachAndStoreRouteSubtree(B,$){const O=$.getContext(B.value.outlet),X=O&&B.value.component?O.children:$,pe=Ji(B);for(const Te of Object.keys(pe))this.deactivateRouteAndItsChildren(pe[Te],X);if(O&&O.outlet){const Te=O.outlet.detach(),Et=O.children.onOutletDeactivated();this.routeReuseStrategy.store(B.value.snapshot,{componentRef:Te,route:B,contexts:Et})}}deactivateRouteAndOutlet(B,$){const O=$.getContext(B.value.outlet),X=O&&B.value.component?O.children:$,pe=Ji(B);for(const Te of Object.keys(pe))this.deactivateRouteAndItsChildren(pe[Te],X);O&&(O.outlet&&(O.outlet.deactivate(),O.children.onOutletDeactivated()),O.attachRef=null,O.route=null)}activateChildRoutes(B,$,O){const X=Ji($);B.children.forEach(pe=>{this.activateRoutes(pe,X[pe.value.outlet],O),this.forwardEvent(new tn(pe.value.snapshot))}),B.children.length&&this.forwardEvent(new Oe(B.value.snapshot))}activateRoutes(B,$,O){const X=B.value,pe=$?$.value:null;if(Ro(X),X===pe)if(X.component){const Te=O.getOrCreateContext(X.outlet);this.activateChildRoutes(B,$,Te.children)}else this.activateChildRoutes(B,$,O);else if(X.component){const Te=O.getOrCreateContext(X.outlet);if(this.routeReuseStrategy.shouldAttach(X.snapshot)){const Et=this.routeReuseStrategy.retrieve(X.snapshot);this.routeReuseStrategy.store(X.snapshot,null),Te.children.onOutletReAttached(Et.contexts),Te.attachRef=Et.componentRef,Te.route=Et.route.value,Te.outlet&&Te.outlet.attach(Et.componentRef,Et.route.value),Ro(Et.route.value),this.activateChildRoutes(B,null,Te.children)}else{const Et=Zr(X.snapshot);Te.attachRef=null,Te.route=X,Te.injector=Et,Te.outlet&&Te.outlet.activateWith(X,Te.injector),this.activateChildRoutes(B,null,Te.children)}}else this.activateChildRoutes(B,null,O)}}class ta{constructor(B){this.path=B,this.route=this.path[this.path.length-1]}}class Ss{constructor(B,$){this.component=B,this.route=$}}function na(L,B,$){const O=L._root;return ha(O,B?B._root:null,$,[O.value])}function Ks(L,B){const $=Symbol(),O=B.get(L,$);return O===$?"function"!=typeof L||(0,S.Z0I)(L)?B.get(L):L:O}function ha(L,B,$,O,X={canDeactivateChecks:[],canActivateChecks:[]}){const pe=Ji(B);return L.children.forEach(Te=>{(function Va(L,B,$,O,X={canDeactivateChecks:[],canActivateChecks:[]}){const pe=L.value,Te=B?B.value:null,Et=$?$.getContext(L.value.outlet):null;if(Te&&pe.routeConfig===Te.routeConfig){const Mn=function Jl(L,B,$){if("function"==typeof $)return $(L,B);switch($){case"pathParamsChange":return!xo(L.url,B.url);case"pathParamsOrQueryParamsChange":return!xo(L.url,B.url)||!Zi(L.queryParams,B.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!jr(L,B)||!Zi(L.queryParams,B.queryParams);default:return!jr(L,B)}}(Te,pe,pe.routeConfig.runGuardsAndResolvers);Mn?X.canActivateChecks.push(new ta(O)):(pe.data=Te.data,pe._resolvedData=Te._resolvedData),ha(L,B,pe.component?Et?Et.children:null:$,O,X),Mn&&Et&&Et.outlet&&Et.outlet.isActivated&&X.canDeactivateChecks.push(new Ss(Et.outlet.component,Te))}else Te&&Ki(B,Et,X),X.canActivateChecks.push(new ta(O)),ha(L,null,pe.component?Et?Et.children:null:$,O,X)})(Te,pe[Te.value.outlet],$,O.concat([Te.value]),X),delete pe[Te.value.outlet]}),Object.entries(pe).forEach(([Te,Et])=>Ki(Et,$.getContext(Te),X)),X}function Ki(L,B,$){const O=Ji(L),X=L.value;Object.entries(O).forEach(([pe,Te])=>{Ki(Te,X.component?B?B.children.getContext(pe):null:B,$)}),$.canDeactivateChecks.push(new Ss(X.component&&B&&B.outlet&&B.outlet.isActivated?B.outlet.component:null,X))}function ia(L){return"function"==typeof L}function Q(L){return L instanceof Xe||"EmptyError"===L?.name}const ye=Symbol("INITIAL_VALUE");function ie(){return(0,qt.w)(L=>(0,Ye.a)(L.map(B=>B.pipe((0,vn.q)(1),(0,Ti.O)(ye)))).pipe((0,Pt.U)(B=>{for(const $ of B)if(!0!==$){if($===ye)return ye;if(!1===$||$ instanceof Gi)return $}return!0}),(0,Ei.h)(B=>B!==ye),(0,vn.q)(1)))}function Nr(L){return(0,zt.z)(_t(B=>{if(Be(B))throw is(0,B)}),(0,Pt.U)(B=>!0===B))}class _l{constructor(B){this.segmentGroup=B||null}}class Ta{constructor(B){this.urlTree=B}}function Ma(L){return(0,dn._)(new _l(L))}function Sa(L){return(0,dn._)(new Ta(L))}class ja{constructor(B,$){this.urlSerializer=B,this.urlTree=$}noMatchError(B){return new S.vHH(4002,!1)}lineralizeSegments(B,$){let O=[],X=$.root;for(;;){if(O=O.concat(X.segments),0===X.numberOfChildren)return(0,Ke.of)(O);if(X.numberOfChildren>1||!X.children[Ln])return(0,dn._)(new S.vHH(4e3,!1));X=X.children[Ln]}}applyRedirectCommands(B,$,O){return this.applyRedirectCreateUrlTree($,this.urlSerializer.parse($),B,O)}applyRedirectCreateUrlTree(B,$,O,X){const pe=this.createSegmentGroup(B,$.root,O,X);return new Gi(pe,this.createQueryParams($.queryParams,this.urlTree.queryParams),$.fragment)}createQueryParams(B,$){const O={};return Object.entries(B).forEach(([X,pe])=>{if("string"==typeof pe&&pe.startsWith(":")){const Et=pe.substring(1);O[X]=$[Et]}else O[X]=pe}),O}createSegmentGroup(B,$,O,X){const pe=this.createSegments(B,$.segments,O,X);let Te={};return Object.entries($.children).forEach(([Et,Mn])=>{Te[Et]=this.createSegmentGroup(B,Mn,O,X)}),new Si(pe,Te)}createSegments(B,$,O,X){return $.map(pe=>pe.path.startsWith(":")?this.findPosParam(B,pe,X):this.findOrReturn(pe,O))}findPosParam(B,$,O){const X=O[$.path.substring(1)];if(!X)throw new S.vHH(4001,!1);return X}findOrReturn(B,$){let O=0;for(const X of $){if(X.path===B.path)return $.splice(O),X;O++}return B}}const yo={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function yl(L,B,$,O,X){const pe=vl(L,B,$);return pe.matched?(O=function ys(L,B){return L.providers&&!L._injector&&(L._injector=(0,S.MMx)(L.providers,B,`Route: ${L.path}`)),L._injector??B}(B,O),function gl(L,B,$,O){const X=B.canMatch;if(!X||0===X.length)return(0,Ke.of)(!0);const pe=X.map(Te=>{const Et=Ks(Te,L);return sr(function su(L){return L&&ia(L.canMatch)}(Et)?Et.canMatch(B,$):L.runInContext(()=>Et(B,$)))});return(0,Ke.of)(pe).pipe(ie(),Nr())}(O,B,$).pipe((0,Pt.U)(Te=>!0===Te?pe:{...yo}))):(0,Ke.of)(pe)}function vl(L,B,$){if(""===B.path)return"full"===B.pathMatch&&(L.hasChildren()||$.length>0)?{...yo}:{matched:!0,consumedSegments:[],remainingSegments:$,parameters:{},positionalParamSegments:{}};const X=(B.matcher||Gr)($,L,B);if(!X)return{...yo};const pe={};Object.entries(X.posParams??{}).forEach(([Et,Mn])=>{pe[Et]=Mn.path});const Te=X.consumed.length>0?{...pe,...X.consumed[X.consumed.length-1].parameters}:pe;return{matched:!0,consumedSegments:X.consumed,remainingSegments:$.slice(X.consumed.length),parameters:Te,positionalParamSegments:X.posParams??{}}}function Mc(L,B,$,O){return $.length>0&&function Sl(L,B,$){return $.some(O=>Ia(L,B,O)&&Oo(O)!==Ln)}(L,$,O)?{segmentGroup:new Si(B,il(O,new Si($,L.children))),slicedSegments:[]}:0===$.length&&function Sc(L,B,$){return $.some(O=>Ia(L,B,O))}(L,$,O)?{segmentGroup:new Si(L.segments,bl(L,0,$,O,L.children)),slicedSegments:$}:{segmentGroup:new Si(L.segments,L.children),slicedSegments:$}}function bl(L,B,$,O,X){const pe={};for(const Te of O)if(Ia(L,$,Te)&&!X[Oo(Te)]){const Et=new Si([],{});pe[Oo(Te)]=Et}return{...X,...pe}}function il(L,B){const $={};$[Ln]=B;for(const O of L)if(""===O.path&&Oo(O)!==Ln){const X=new Si([],{});$[Oo(O)]=X}return $}function Ia(L,B,$){return(!(L.hasChildren()||B.length>0)||"full"!==$.pathMatch)&&""===$.path}class ec{constructor(B,$,O,X,pe,Te,Et){this.injector=B,this.configLoader=$,this.rootComponentType=O,this.config=X,this.urlTree=pe,this.paramsInheritanceStrategy=Te,this.urlSerializer=Et,this.allowRedirects=!0,this.applyRedirects=new ja(this.urlSerializer,this.urlTree)}noMatchError(B){return new S.vHH(4002,!1)}recognize(){const B=Mc(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,B,Ln).pipe((0,Nt.K)($=>{if($ instanceof Ta)return this.allowRedirects=!1,this.urlTree=$.urlTree,this.match($.urlTree);throw $ instanceof _l?this.noMatchError($):$}),(0,Pt.U)($=>{const O=new $n([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Ln,this.rootComponentType,null,{}),X=new Qr(O,$),pe=new oi("",X),Te=function Ft(L,B,$=null,O=null){return en(Rt(L),B,$,O)}(O,[],this.urlTree.queryParams,this.urlTree.fragment);return Te.queryParams=this.urlTree.queryParams,pe.url=this.urlSerializer.serialize(Te),this.inheritParamsAndData(pe._root),{state:pe,tree:Te}}))}match(B){return this.processSegmentGroup(this.injector,this.config,B.root,Ln).pipe((0,Nt.K)(O=>{throw O instanceof _l?this.noMatchError(O):O}))}inheritParamsAndData(B){const $=B.value,O=za($,this.paramsInheritanceStrategy);$.params=Object.freeze(O.params),$.data=Object.freeze(O.data),B.children.forEach(X=>this.inheritParamsAndData(X))}processSegmentGroup(B,$,O,X){return 0===O.segments.length&&O.hasChildren()?this.processChildren(B,$,O):this.processSegment(B,$,O,O.segments,X,!0)}processChildren(B,$,O){const X=[];for(const pe of Object.keys(O.children))"primary"===pe?X.unshift(pe):X.push(pe);return(0,ge.D)(X).pipe((0,so.b)(pe=>{const Te=O.children[pe],Et=function Ns(L,B){const $=L.filter(O=>Oo(O)===B);return $.push(...L.filter(O=>Oo(O)!==B)),$}($,pe);return this.processSegmentGroup(B,Et,Te,pe)}),(0,Yt.R)((pe,Te)=>(pe.push(...Te),pe)),Mr(null),function bn(L,B){const $=arguments.length>=2;return O=>O.pipe(L?(0,Ei.h)((X,pe)=>L(X,pe,O)):Oi.y,Kt(1),$?Mr(B):hi(()=>new Xe))}(),(0,Li.z)(pe=>{if(null===pe)return Ma(O);const Te=pa(pe);return function lu(L){L.sort((B,$)=>B.value.outlet===Ln?-1:$.value.outlet===Ln?1:B.value.outlet.localeCompare($.value.outlet))}(Te),(0,Ke.of)(Te)}))}processSegment(B,$,O,X,pe,Te){return(0,ge.D)($).pipe((0,so.b)(Et=>this.processSegmentAgainstRoute(Et._injector??B,$,Et,O,X,pe,Te).pipe((0,Nt.K)(Mn=>{if(Mn instanceof _l)return(0,Ke.of)(null);throw Mn}))),ji(Et=>!!Et),(0,Nt.K)(Et=>{if(Q(Et))return function fa(L,B,$){return 0===B.length&&!L.children[$]}(O,X,pe)?(0,Ke.of)([]):Ma(O);throw Et}))}processSegmentAgainstRoute(B,$,O,X,pe,Te,Et){return function xl(L,B,$,O){return!!(Oo(L)===O||O!==Ln&&Ia(B,$,L))&&("**"===L.path||vl(B,L,$).matched)}(O,X,pe,Te)?void 0===O.redirectTo?this.matchSegmentAgainstRoute(B,X,O,pe,Te,Et):Et&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(B,X,$,O,pe,Te):Ma(X):Ma(X)}expandSegmentAgainstRouteUsingRedirect(B,$,O,X,pe,Te){return"**"===X.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(B,O,X,Te):this.expandRegularSegmentAgainstRouteUsingRedirect(B,$,O,X,pe,Te)}expandWildCardWithParamsAgainstRouteUsingRedirect(B,$,O,X){const pe=this.applyRedirects.applyRedirectCommands([],O.redirectTo,{});return O.redirectTo.startsWith("/")?Sa(pe):this.applyRedirects.lineralizeSegments(O,pe).pipe((0,Li.z)(Te=>{const Et=new Si(Te,{});return this.processSegment(B,$,Et,Te,X,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(B,$,O,X,pe,Te){const{matched:Et,consumedSegments:Mn,remainingSegments:jt,positionalParamSegments:ui}=vl($,X,pe);if(!Et)return Ma($);const Yi=this.applyRedirects.applyRedirectCommands(Mn,X.redirectTo,ui);return X.redirectTo.startsWith("/")?Sa(Yi):this.applyRedirects.lineralizeSegments(X,Yi).pipe((0,Li.z)(Rr=>this.processSegment(B,O,$,Rr.concat(jt),Te,!1)))}matchSegmentAgainstRoute(B,$,O,X,pe,Te){let Et;if("**"===O.path){const Mn=X.length>0?Yr(X).parameters:{},jt=new $n(X,Mn,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Ha(O),Oo(O),O.component??O._loadedComponent??null,O,rl(O));Et=(0,Ke.of)({snapshot:jt,consumedSegments:[],remainingSegments:[]}),$.children={}}else Et=yl($,O,X,B).pipe((0,Pt.U)(({matched:Mn,consumedSegments:jt,remainingSegments:ui,parameters:Yi})=>Mn?{snapshot:new $n(jt,Yi,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Ha(O),Oo(O),O.component??O._loadedComponent??null,O,rl(O)),consumedSegments:jt,remainingSegments:ui}:null));return Et.pipe((0,qt.w)(Mn=>null===Mn?Ma($):this.getChildConfig(B=O._injector??B,O,X).pipe((0,qt.w)(({routes:jt})=>{const ui=O._loadedInjector??B,{snapshot:Yi,consumedSegments:Rr,remainingSegments:Tr}=Mn,{segmentGroup:xs,slicedSegments:Js}=Mc($,Rr,Tr,jt);if(0===Js.length&&xs.hasChildren())return this.processChildren(ui,jt,xs).pipe((0,Pt.U)(r=>null===r?null:[new Qr(Yi,r)]));if(0===jt.length&&0===Js.length)return(0,Ke.of)([new Qr(Yi,[])]);const f=Oo(O)===pe;return this.processSegment(ui,jt,xs,Js,f?Ln:pe,!0).pipe((0,Pt.U)(r=>[new Qr(Yi,r)]))}))))}getChildConfig(B,$,O){return $.children?(0,Ke.of)({routes:$.children,injector:B}):$.loadChildren?void 0!==$._loadedRoutes?(0,Ke.of)({routes:$._loadedRoutes,injector:$._loadedInjector}):function Da(L,B,$,O){const X=B.canLoad;if(void 0===X||0===X.length)return(0,Ke.of)(!0);const pe=X.map(Te=>{const Et=Ks(Te,L);return sr(function Ql(L){return L&&ia(L.canLoad)}(Et)?Et.canLoad(B,$):L.runInContext(()=>Et(B,$)))});return(0,Ke.of)(pe).pipe(ie(),Nr())}(B,$,O).pipe((0,Li.z)(X=>X?this.configLoader.loadChildren(B,$).pipe(_t(pe=>{$._loadedRoutes=pe.routes,$._loadedInjector=pe.injector})):function zs(L){return(0,dn._)(Ws(!1,3))}())):(0,Ke.of)({routes:[],injector:B})}}function cu(L){const B=L.value.routeConfig;return B&&""===B.path}function pa(L){const B=[],$=new Set;for(const O of L){if(!cu(O)){B.push(O);continue}const X=B.find(pe=>O.value.routeConfig===pe.value.routeConfig);void 0!==X?(X.children.push(...O.children),$.add(X)):B.push(O)}for(const O of $){const X=pa(O.children);B.push(new Qr(O.value,X))}return B.filter(O=>!$.has(O))}function Ha(L){return L.data||{}}function rl(L){return L.resolve||{}}function ee(L){return"string"==typeof L.title||null===L.title}function Me(L){return(0,qt.w)(B=>{const $=L(B);return $?(0,ge.D)($).pipe((0,Pt.U)(()=>B)):(0,Ke.of)(B)})}const J=new S.OlP("ROUTES");let ve=(()=>{var L;class B{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,S.f3M)(S.Sil)}loadComponent(O){if(this.componentLoaders.get(O))return this.componentLoaders.get(O);if(O._loadedComponent)return(0,Ke.of)(O._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(O);const X=sr(O.loadComponent()).pipe((0,Pt.U)(Tt),_t(Te=>{this.onLoadEndListener&&this.onLoadEndListener(O),O._loadedComponent=Te}),(0,Vt.x)(()=>{this.componentLoaders.delete(O)})),pe=new ft(X,()=>new Ze.x).pipe(Dn());return this.componentLoaders.set(O,pe),pe}loadChildren(O,X){if(this.childrenLoaders.get(X))return this.childrenLoaders.get(X);if(X._loadedRoutes)return(0,Ke.of)({routes:X._loadedRoutes,injector:X._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(X);const Te=this.loadModuleFactoryOrRoutes(X.loadChildren).pipe((0,Pt.U)(Mn=>{this.onLoadEndListener&&this.onLoadEndListener(X);let jt,ui;return Array.isArray(Mn)?ui=Mn:(jt=Mn.create(O).injector,ui=jt.get(J,[],S.XFs.Self|S.XFs.Optional).flat()),{routes:ui.map(qs),injector:jt}}),(0,Vt.x)(()=>{this.childrenLoaders.delete(X)})),Et=new ft(Te,()=>new Ze.x).pipe(Dn());return this.childrenLoaders.set(X,Et),Et}loadModuleFactoryOrRoutes(O){return sr(O()).pipe((0,Pt.U)(Tt),(0,Li.z)(X=>X instanceof S.YKP||Array.isArray(X)?(0,Ke.of)(X):(0,ge.D)(this.compiler.compileModuleAsync(X))))}}return(L=B).\u0275fac=function(O){return new(O||L)},L.\u0275prov=S.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),B})();function Tt(L){return function rt(L){return L&&"object"==typeof L&&"default"in L}(L)?L.default:L}let on=(()=>{var L;class B{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ze.x,this.transitionAbortSubject=new Ze.x,this.configLoader=(0,S.f3M)(ve),this.environmentInjector=(0,S.f3M)(S.lqb),this.urlSerializer=(0,S.f3M)(Uo),this.rootContexts=(0,S.f3M)(gr),this.inputBindingEnabled=null!==(0,S.f3M)($o,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>(0,Ke.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=pe=>this.events.next(new Ur(pe)),this.configLoader.onLoadStartListener=pe=>this.events.next(new ts(pe))}complete(){this.transitions?.complete()}handleNavigationRequest(O){const X=++this.navigationId;this.transitions?.next({...this.transitions.value,...O,id:X})}setupNavigations(O,X,pe){return this.transitions=new nt.X({id:0,currentUrlTree:X,currentRawUrl:X,currentBrowserUrl:X,extractedUrl:O.urlHandlingStrategy.extract(X),urlAfterRedirects:O.urlHandlingStrategy.extract(X),rawUrl:X,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Vo,restoredState:null,currentSnapshot:pe.snapshot,targetSnapshot:null,currentRouterState:pe,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,Ei.h)(Te=>0!==Te.id),(0,Pt.U)(Te=>({...Te,extractedUrl:O.urlHandlingStrategy.extract(Te.rawUrl)})),(0,qt.w)(Te=>{this.currentTransition=Te;let Et=!1,Mn=!1;return(0,Ke.of)(Te).pipe(_t(jt=>{this.currentNavigation={id:jt.id,initialUrl:jt.rawUrl,extractedUrl:jt.extractedUrl,trigger:jt.source,extras:jt.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,qt.w)(jt=>{const ui=jt.currentBrowserUrl.toString(),Yi=!O.navigated||jt.extractedUrl.toString()!==ui||ui!==jt.currentUrlTree.toString();if(!Yi&&"reload"!==(jt.extras.onSameUrlNavigation??O.onSameUrlNavigation)){const Tr="";return this.events.next(new mi(jt.id,this.urlSerializer.serialize(jt.rawUrl),Tr,0)),jt.resolve(null),St.E}if(O.urlHandlingStrategy.shouldProcessUrl(jt.rawUrl))return(0,Ke.of)(jt).pipe((0,qt.w)(Tr=>{const xs=this.transitions?.getValue();return this.events.next(new gs(Tr.id,this.urlSerializer.serialize(Tr.extractedUrl),Tr.source,Tr.restoredState)),xs!==this.transitions?.getValue()?St.E:Promise.resolve(Tr)}),function Ga(L,B,$,O,X,pe){return(0,Li.z)(Te=>function $a(L,B,$,O,X,pe,Te="emptyOnly"){return new ec(L,B,$,O,X,Te,pe).recognize()}(L,B,$,O,Te.extractedUrl,X,pe).pipe((0,Pt.U)(({state:Et,tree:Mn})=>({...Te,targetSnapshot:Et,urlAfterRedirects:Mn}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,O.config,this.urlSerializer,O.paramsInheritanceStrategy),_t(Tr=>{Te.targetSnapshot=Tr.targetSnapshot,Te.urlAfterRedirects=Tr.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:Tr.urlAfterRedirects};const xs=new jo(Tr.id,this.urlSerializer.serialize(Tr.extractedUrl),this.urlSerializer.serialize(Tr.urlAfterRedirects),Tr.targetSnapshot);this.events.next(xs)}));if(Yi&&O.urlHandlingStrategy.shouldProcessUrl(jt.currentRawUrl)){const{id:Tr,extractedUrl:xs,source:Js,restoredState:f,extras:r}=jt,c=new gs(Tr,this.urlSerializer.serialize(xs),Js,f);this.events.next(c);const m=el(0,this.rootComponentType).snapshot;return this.currentTransition=Te={...jt,targetSnapshot:m,urlAfterRedirects:xs,extras:{...r,skipLocationChange:!1,replaceUrl:!1}},(0,Ke.of)(Te)}{const Tr="";return this.events.next(new mi(jt.id,this.urlSerializer.serialize(jt.extractedUrl),Tr,1)),jt.resolve(null),St.E}}),_t(jt=>{const ui=new Bi(jt.id,this.urlSerializer.serialize(jt.extractedUrl),this.urlSerializer.serialize(jt.urlAfterRedirects),jt.targetSnapshot);this.events.next(ui)}),(0,Pt.U)(jt=>(this.currentTransition=Te={...jt,guards:na(jt.targetSnapshot,jt.currentSnapshot,this.rootContexts)},Te)),function Ae(L,B){return(0,Li.z)($=>{const{targetSnapshot:O,currentSnapshot:X,guards:{canActivateChecks:pe,canDeactivateChecks:Te}}=$;return 0===Te.length&&0===pe.length?(0,Ke.of)({...$,guardsResult:!0}):function Pn(L,B,$,O){return(0,ge.D)(L).pipe((0,Li.z)(X=>function Bs(L,B,$,O,X){const pe=B&&B.routeConfig?B.routeConfig.canDeactivate:null;if(!pe||0===pe.length)return(0,Ke.of)(!0);const Te=pe.map(Et=>{const Mn=Zr(B)??X,jt=Ks(Et,Mn);return sr(function co(L){return L&&ia(L.canDeactivate)}(jt)?jt.canDeactivate(L,B,$,O):Mn.runInContext(()=>jt(L,B,$,O))).pipe(ji())});return(0,Ke.of)(Te).pipe(ie())}(X.component,X.route,$,B,O)),ji(X=>!0!==X,!0))}(Te,O,X,L).pipe((0,Li.z)(Et=>Et&&function Tc(L){return"boolean"==typeof L}(Et)?function Ii(L,B,$,O){return(0,ge.D)(B).pipe((0,so.b)(X=>(0,at.z)(function _o(L,B){return null!==L&&B&&B(new ls(L)),(0,Ke.of)(!0)}(X.route.parent,O),function Ho(L,B){return null!==L&&B&&B(new Ot(L)),(0,Ke.of)(!0)}(X.route,O),function ko(L,B,$){const O=B[B.length-1],pe=B.slice(0,B.length-1).reverse().map(Te=>function Is(L){const B=L.routeConfig?L.routeConfig.canActivateChild:null;return B&&0!==B.length?{node:L,guards:B}:null}(Te)).filter(Te=>null!==Te).map(Te=>Bt(()=>{const Et=Te.guards.map(Mn=>{const jt=Zr(Te.node)??$,ui=Ks(Mn,jt);return sr(function nl(L){return L&&ia(L.canActivateChild)}(ui)?ui.canActivateChild(O,L):jt.runInContext(()=>ui(O,L))).pipe(ji())});return(0,Ke.of)(Et).pipe(ie())}));return(0,Ke.of)(pe).pipe(ie())}(L,X.path,$),function us(L,B,$){const O=B.routeConfig?B.routeConfig.canActivate:null;if(!O||0===O.length)return(0,Ke.of)(!0);const X=O.map(pe=>Bt(()=>{const Te=Zr(B)??$,Et=Ks(pe,Te);return sr(function ou(L){return L&&ia(L.canActivate)}(Et)?Et.canActivate(B,L):Te.runInContext(()=>Et(B,L))).pipe(ji())}));return(0,Ke.of)(X).pipe(ie())}(L,X.route,$))),ji(X=>!0!==X,!0))}(O,pe,L,B):(0,Ke.of)(Et)),(0,Pt.U)(Et=>({...$,guardsResult:Et})))})}(this.environmentInjector,jt=>this.events.next(jt)),_t(jt=>{if(Te.guardsResult=jt.guardsResult,Be(jt.guardsResult))throw is(0,jt.guardsResult);const ui=new wo(jt.id,this.urlSerializer.serialize(jt.extractedUrl),this.urlSerializer.serialize(jt.urlAfterRedirects),jt.targetSnapshot,!!jt.guardsResult);this.events.next(ui)}),(0,Ei.h)(jt=>!!jt.guardsResult||(this.cancelNavigationTransition(jt,"",3),!1)),Me(jt=>{if(jt.guards.canActivateChecks.length)return(0,Ke.of)(jt).pipe(_t(ui=>{const Yi=new da(ui.id,this.urlSerializer.serialize(ui.extractedUrl),this.urlSerializer.serialize(ui.urlAfterRedirects),ui.targetSnapshot);this.events.next(Yi)}),(0,qt.w)(ui=>{let Yi=!1;return(0,Ke.of)(ui).pipe(function nc(L,B){return(0,Li.z)($=>{const{targetSnapshot:O,guards:{canActivateChecks:X}}=$;if(!X.length)return(0,Ke.of)($);let pe=0;return(0,ge.D)(X).pipe((0,so.b)(Te=>function Aa(L,B,$,O){const X=L.routeConfig,pe=L._resolve;return void 0!==X?.title&&!ee(X)&&(pe[ti]=X.title),function Pa(L,B,$,O){const X=function Bo(L){return[...Object.keys(L),...Object.getOwnPropertySymbols(L)]}(L);if(0===X.length)return(0,Ke.of)({});const pe={};return(0,ge.D)(X).pipe((0,Li.z)(Te=>function N(L,B,$,O){const X=Zr(B)??O,pe=Ks(L,X);return sr(pe.resolve?pe.resolve(B,$):X.runInContext(()=>pe(B,$)))}(L[Te],B,$,O).pipe(ji(),_t(Et=>{pe[Te]=Et}))),Kt(1),function $t(L){return(0,Pt.U)(()=>L)}(pe),(0,Nt.K)(Te=>Q(Te)?St.E:(0,dn._)(Te)))}(pe,L,B,O).pipe((0,Pt.U)(Te=>(L._resolvedData=Te,L.data=za(L,$).resolve,X&&ee(X)&&(L.data[ti]=X.title),null)))}(Te.route,O,L,B)),_t(()=>pe++),Kt(1),(0,Li.z)(Te=>pe===X.length?(0,Ke.of)($):St.E))})}(O.paramsInheritanceStrategy,this.environmentInjector),_t({next:()=>Yi=!0,complete:()=>{Yi||this.cancelNavigationTransition(ui,"",2)}}))}),_t(ui=>{const Yi=new ks(ui.id,this.urlSerializer.serialize(ui.extractedUrl),this.urlSerializer.serialize(ui.urlAfterRedirects),ui.targetSnapshot);this.events.next(Yi)}))}),Me(jt=>{const ui=Yi=>{const Rr=[];Yi.routeConfig?.loadComponent&&!Yi.routeConfig._loadedComponent&&Rr.push(this.configLoader.loadComponent(Yi.routeConfig).pipe(_t(Tr=>{Yi.component=Tr}),(0,Pt.U)(()=>{})));for(const Tr of Yi.children)Rr.push(...ui(Tr));return Rr};return(0,Ye.a)(ui(jt.targetSnapshot.root)).pipe(Mr(),(0,vn.q)(1))}),Me(()=>this.afterPreactivation()),(0,Pt.U)(jt=>{const ui=function bi(L,B,$){const O=Ts(L,B._root,$?$._root:void 0);return new Io(O,B)}(O.routeReuseStrategy,jt.targetSnapshot,jt.currentRouterState);return this.currentTransition=Te={...jt,targetRouterState:ui},Te}),_t(()=>{this.events.next(new yn)}),((L,B,$,O)=>(0,Pt.U)(X=>(new Eo(B,X.targetRouterState,X.currentRouterState,$,O).activate(L),X)))(this.rootContexts,O.routeReuseStrategy,jt=>this.events.next(jt),this.inputBindingEnabled),(0,vn.q)(1),_t({next:jt=>{Et=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Sn(jt.id,this.urlSerializer.serialize(jt.extractedUrl),this.urlSerializer.serialize(jt.urlAfterRedirects))),O.titleStrategy?.updateTitle(jt.targetRouterState.snapshot),jt.resolve(!0)},complete:()=>{Et=!0}}),(0,Gt.R)(this.transitionAbortSubject.pipe(_t(jt=>{throw jt}))),(0,Vt.x)(()=>{Et||Mn||this.cancelNavigationTransition(Te,"",1),this.currentNavigation?.id===Te.id&&(this.currentNavigation=null)}),(0,Nt.K)(jt=>{if(Mn=!0,_s(jt))this.events.next(new ci(Te.id,this.urlSerializer.serialize(Te.extractedUrl),jt.message,jt.cancellationCode)),function Ko(L){return _s(L)&&Be(L.url)}(jt)?this.events.next(new Nn(jt.url)):Te.resolve(!1);else{this.events.next(new mo(Te.id,this.urlSerializer.serialize(Te.extractedUrl),jt,Te.targetSnapshot??void 0));try{Te.resolve(O.errorHandler(jt))}catch(ui){Te.reject(ui)}}return St.E}))}))}cancelNavigationTransition(O,X,pe){const Te=new ci(O.id,this.urlSerializer.serialize(O.extractedUrl),X,pe);this.events.next(Te),O.resolve(!1)}}return(L=B).\u0275fac=function(O){return new(O||L)},L.\u0275prov=S.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),B})();function Wi(L){return L!==Vo}let Qi=(()=>{var L;class B{buildTitle(O){let X,pe=O.root;for(;void 0!==pe;)X=this.getResolvedTitleForRoute(pe)??X,pe=pe.children.find(Te=>Te.outlet===Ln);return X}getResolvedTitleForRoute(O){return O.data[ti]}}return(L=B).\u0275fac=function(O){return new(O||L)},L.\u0275prov=S.Yz7({token:L,factory:function(){return(0,S.f3M)(zi)},providedIn:"root"}),B})(),zi=(()=>{var L;class B extends Qi{constructor(O){super(),this.title=O}updateTitle(O){const X=this.buildTitle(O);void 0!==X&&this.title.setTitle(X)}}return(L=B).\u0275fac=function(O){return new(O||L)(S.LFG(Yn.Dx))},L.\u0275prov=S.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),B})(),ir=(()=>{var L;class B{}return(L=B).\u0275fac=function(O){return new(O||L)},L.\u0275prov=S.Yz7({token:L,factory:function(){return(0,S.f3M)(Pi)},providedIn:"root"}),B})();class eo{shouldDetach(B){return!1}store(B,$){}shouldAttach(B){return!1}retrieve(B){return null}shouldReuseRoute(B,$){return B.routeConfig===$.routeConfig}}let Pi=(()=>{var L;class B extends eo{}return(L=B).\u0275fac=function(){let $;return function(X){return($||($=S.n5z(L)))(X||L)}}(),L.\u0275prov=S.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),B})();const _r=new S.OlP("",{providedIn:"root",factory:()=>({})});let ra=(()=>{var L;class B{}return(L=B).\u0275fac=function(O){return new(O||L)},L.\u0275prov=S.Yz7({token:L,factory:function(){return(0,S.f3M)(As)},providedIn:"root"}),B})(),As=(()=>{var L;class B{shouldProcessUrl(O){return!0}extract(O){return O}merge(O,X){return O}}return(L=B).\u0275fac=function(O){return new(O||L)},L.\u0275prov=S.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),B})();var vs=function(L){return L[L.COMPLETE=0]="COMPLETE",L[L.FAILED=1]="FAILED",L[L.REDIRECTING=2]="REDIRECTING",L}(vs||{});function Lo(L,B){L.events.pipe((0,Ei.h)($=>$ instanceof Sn||$ instanceof ci||$ instanceof mo||$ instanceof mi),(0,Pt.U)($=>$ instanceof Sn||$ instanceof mi?vs.COMPLETE:$ instanceof ci&&(0===$.code||1===$.code)?vs.REDIRECTING:vs.FAILED),(0,Ei.h)($=>$!==vs.REDIRECTING),(0,vn.q)(1)).subscribe(()=>{B()})}function Ys(L){throw L}function oa(L,B,$){return B.parse("/")}const Ps={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ic={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Fn=(()=>{var L;class B{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,S.f3M)(S.c2e),this.isNgZoneEnabled=!1,this._events=new Ze.x,this.options=(0,S.f3M)(_r,{optional:!0})||{},this.pendingTasks=(0,S.f3M)(S.HDt),this.errorHandler=this.options.errorHandler||Ys,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||oa,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,S.f3M)(ra),this.routeReuseStrategy=(0,S.f3M)(ir),this.titleStrategy=(0,S.f3M)(Qi),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=(0,S.f3M)(J,{optional:!0})?.flat()??[],this.navigationTransitions=(0,S.f3M)(on),this.urlSerializer=(0,S.f3M)(Uo),this.location=(0,S.f3M)(Xt.Ye),this.componentInputBindingEnabled=!!(0,S.f3M)($o,{optional:!0}),this.eventsSubscription=new Bn.w0,this.isNgZoneEnabled=(0,S.f3M)(S.R0b)instanceof S.R0b&&S.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Gi,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=el(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(O=>{this.lastSuccessfulId=O.id,this.currentPageId=this.browserPageId},O=>{this.console.warn(`Unhandled Navigation Error: ${O}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const O=this.navigationTransitions.events.subscribe(X=>{try{const{currentTransition:pe}=this.navigationTransitions;if(null===pe)return void(Ri(X)&&this._events.next(X));if(X instanceof gs)Wi(pe.source)&&(this.browserUrlTree=pe.extractedUrl);else if(X instanceof mi)this.rawUrlTree=pe.rawUrl;else if(X instanceof jo){if("eager"===this.urlUpdateStrategy){if(!pe.extras.skipLocationChange){const Te=this.urlHandlingStrategy.merge(pe.urlAfterRedirects,pe.rawUrl);this.setBrowserUrl(Te,pe)}this.browserUrlTree=pe.urlAfterRedirects}}else if(X instanceof yn)this.currentUrlTree=pe.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(pe.urlAfterRedirects,pe.rawUrl),this.routerState=pe.targetRouterState,"deferred"===this.urlUpdateStrategy&&(pe.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,pe),this.browserUrlTree=pe.urlAfterRedirects);else if(X instanceof ci)0!==X.code&&1!==X.code&&(this.navigated=!0),(3===X.code||2===X.code)&&this.restoreHistory(pe);else if(X instanceof Nn){const Te=this.urlHandlingStrategy.merge(X.url,pe.currentRawUrl),Et={skipLocationChange:pe.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Wi(pe.source)};this.scheduleNavigation(Te,Vo,null,Et,{resolve:pe.resolve,reject:pe.reject,promise:pe.promise})}X instanceof mo&&this.restoreHistory(pe,!0),X instanceof Sn&&(this.navigated=!0),Ri(X)&&this._events.next(X)}catch(pe){this.navigationTransitions.transitionAbortSubject.next(pe)}});this.eventsSubscription.add(O)}resetRootComponentType(O){this.routerState.root.component=O,this.navigationTransitions.rootComponentType=O}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const O=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Vo,O)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(O=>{const X="popstate"===O.type?"popstate":"hashchange";"popstate"===X&&setTimeout(()=>{this.navigateToSyncWithBrowser(O.url,X,O.state)},0)}))}navigateToSyncWithBrowser(O,X,pe){const Te={replaceUrl:!0},Et=pe?.navigationId?pe:null;if(pe){const jt={...pe};delete jt.navigationId,delete jt.\u0275routerPageId,0!==Object.keys(jt).length&&(Te.state=jt)}const Mn=this.parseUrl(O);this.scheduleNavigation(Mn,X,Et,Te)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(O){this.config=O.map(qs),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(O,X={}){const{relativeTo:pe,queryParams:Te,fragment:Et,queryParamsHandling:Mn,preserveFragment:jt}=X,ui=jt?this.currentUrlTree.fragment:Et;let Rr,Yi=null;switch(Mn){case"merge":Yi={...this.currentUrlTree.queryParams,...Te};break;case"preserve":Yi=this.currentUrlTree.queryParams;break;default:Yi=Te||null}null!==Yi&&(Yi=this.removeEmptyProps(Yi));try{Rr=Rt(pe?pe.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof O[0]||!O[0].startsWith("/"))&&(O=[]),Rr=this.currentUrlTree.root}return en(Rr,O,Yi,ui??null)}navigateByUrl(O,X={skipLocationChange:!1}){const pe=Be(O)?O:this.parseUrl(O),Te=this.urlHandlingStrategy.merge(pe,this.rawUrlTree);return this.scheduleNavigation(Te,Vo,null,X)}navigate(O,X={skipLocationChange:!1}){return function ma(L){for(let B=0;B<L.length;B++)if(null==L[B])throw new S.vHH(4008,!1)}(O),this.navigateByUrl(this.createUrlTree(O,X),X)}serializeUrl(O){return this.urlSerializer.serialize(O)}parseUrl(O){let X;try{X=this.urlSerializer.parse(O)}catch(pe){X=this.malformedUriErrorHandler(pe,this.urlSerializer,O)}return X}isActive(O,X){let pe;if(pe=!0===X?{...Ps}:!1===X?{...ic}:X,Be(O))return To(this.currentUrlTree,O,pe);const Te=this.parseUrl(O);return To(this.currentUrlTree,Te,pe)}removeEmptyProps(O){return Object.keys(O).reduce((X,pe)=>{const Te=O[pe];return null!=Te&&(X[pe]=Te),X},{})}scheduleNavigation(O,X,pe,Te,Et){if(this.disposed)return Promise.resolve(!1);let Mn,jt,ui;Et?(Mn=Et.resolve,jt=Et.reject,ui=Et.promise):ui=new Promise((Rr,Tr)=>{Mn=Rr,jt=Tr});const Yi=this.pendingTasks.add();return Lo(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Yi))}),this.navigationTransitions.handleNavigationRequest({source:X,restoredState:pe,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:O,extras:Te,resolve:Mn,reject:jt,promise:ui,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ui.catch(Rr=>Promise.reject(Rr))}setBrowserUrl(O,X){const pe=this.urlSerializer.serialize(O);if(this.location.isCurrentPathEqualTo(pe)||X.extras.replaceUrl){const Et={...X.extras.state,...this.generateNgRouterState(X.id,this.browserPageId)};this.location.replaceState(pe,"",Et)}else{const Te={...X.extras.state,...this.generateNgRouterState(X.id,this.browserPageId+1)};this.location.go(pe,"",Te)}}restoreHistory(O,X=!1){if("computed"===this.canceledNavigationResolution){const Te=this.currentPageId-this.browserPageId;0!==Te?this.location.historyGo(Te):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===Te&&(this.resetState(O),this.browserUrlTree=O.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(X&&this.resetState(O),this.resetUrlToCurrentUrlTree())}resetState(O){this.routerState=O.currentRouterState,this.currentUrlTree=O.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,O.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(O,X){return"computed"===this.canceledNavigationResolution?{navigationId:O,\u0275routerPageId:X}:{navigationId:O}}}return(L=B).\u0275fac=function(O){return new(O||L)},L.\u0275prov=S.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),B})();function Ri(L){return!(L instanceof yn||L instanceof Nn)}let sa=(()=>{var L;class B{constructor(O,X,pe,Te,Et,Mn){this.router=O,this.route=X,this.tabIndexAttribute=pe,this.renderer=Te,this.el=Et,this.locationStrategy=Mn,this.href=null,this.commands=null,this.onChanges=new Ze.x,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const jt=Et.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===jt||"area"===jt,this.isAnchorElement?this.subscription=O.events.subscribe(ui=>{ui instanceof Sn&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(O){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",O)}ngOnChanges(O){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(O){null!=O?(this.commands=Array.isArray(O)?O:[O],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(O,X,pe,Te,Et){return!!(null===this.urlTree||this.isAnchorElement&&(0!==O||X||pe||Te||Et||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const O=null===this.href?null:(0,S.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",O)}applyAttributeValue(O,X){const pe=this.renderer,Te=this.el.nativeElement;null!==X?pe.setAttribute(Te,O,X):pe.removeAttribute(Te,O)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return(L=B).\u0275fac=function(O){return new(O||L)(S.Y36(Fn),S.Y36(Dr),S.$8M("tabindex"),S.Y36(S.Qsj),S.Y36(S.SBq),S.Y36(Xt.S$))},L.\u0275dir=S.lG2({type:L,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(O,X){1&O&&S.NdJ("click",function(Te){return X.onClick(Te.button,Te.ctrlKey,Te.shiftKey,Te.altKey,Te.metaKey)}),2&O&&S.uIk("target",X.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",S.VuI],skipLocationChange:["skipLocationChange","skipLocationChange",S.VuI],replaceUrl:["replaceUrl","replaceUrl",S.VuI],routerLink:"routerLink"},standalone:!0,features:[S.Xq5,S.TTD]}),B})();class Il{}let Wa=(()=>{var L;class B{constructor(O,X,pe,Te,Et){this.router=O,this.injector=pe,this.preloadingStrategy=Te,this.loader=Et}setUpPreloading(){this.subscription=this.router.events.pipe((0,Ei.h)(O=>O instanceof Sn),(0,so.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(O,X){const pe=[];for(const Te of X){Te.providers&&!Te._injector&&(Te._injector=(0,S.MMx)(Te.providers,O,`Route: ${Te.path}`));const Et=Te._injector??O,Mn=Te._loadedInjector??Et;(Te.loadChildren&&!Te._loadedRoutes&&void 0===Te.canLoad||Te.loadComponent&&!Te._loadedComponent)&&pe.push(this.preloadConfig(Et,Te)),(Te.children||Te._loadedRoutes)&&pe.push(this.processRoutes(Mn,Te.children??Te._loadedRoutes))}return(0,ge.D)(pe).pipe((0,zn.J)())}preloadConfig(O,X){return this.preloadingStrategy.preload(X,()=>{let pe;pe=X.loadChildren&&void 0===X.canLoad?this.loader.loadChildren(O,X):(0,Ke.of)(null);const Te=pe.pipe((0,Li.z)(Et=>null===Et?(0,Ke.of)(void 0):(X._loadedRoutes=Et.routes,X._loadedInjector=Et.injector,this.processRoutes(Et.injector??O,Et.routes))));if(X.loadComponent&&!X._loadedComponent){const Et=this.loader.loadComponent(X);return(0,ge.D)([Te,Et]).pipe((0,zn.J)())}return Te})}}return(L=B).\u0275fac=function(O){return new(O||L)(S.LFG(Fn),S.LFG(S.Sil),S.LFG(S.lqb),S.LFG(Il),S.LFG(ve))},L.\u0275prov=S.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),B})();const Ac=new S.OlP("");let sc=(()=>{var L;class B{constructor(O,X,pe,Te,Et={}){this.urlSerializer=O,this.transitions=X,this.viewportScroller=pe,this.zone=Te,this.options=Et,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},Et.scrollPositionRestoration=Et.scrollPositionRestoration||"disabled",Et.anchorScrolling=Et.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(O=>{O instanceof gs?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=O.navigationTrigger,this.restoredId=O.restoredState?O.restoredState.navigationId:0):O instanceof Sn?(this.lastId=O.id,this.scheduleScrollEvent(O,this.urlSerializer.parse(O.urlAfterRedirects).fragment)):O instanceof mi&&0===O.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(O,this.urlSerializer.parse(O.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(O=>{O instanceof bt&&(O.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(O.position):O.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(O.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(O,X){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new bt(O,"popstate"===this.lastSource?this.store[this.restoredId]:null,X))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return(L=B).\u0275fac=function(O){S.$Z()},L.\u0275prov=S.Yz7({token:L,factory:L.\u0275fac}),B})();function Za(L,B){return{\u0275kind:L,\u0275providers:B}}function Go(){const L=(0,S.f3M)(S.zs3);return B=>{const $=L.get(S.z2F);if(B!==$.components[0])return;const O=L.get(Fn),X=L.get(Pl);1===L.get(ga)&&O.initialNavigation(),L.get(Rc,null,S.XFs.Optional)?.setUpPreloading(),L.get(Ac,null,S.XFs.Optional)?.init(),O.resetRootComponentType($.componentTypes[0]),X.closed||(X.next(),X.complete(),X.unsubscribe())}}const Pl=new S.OlP("",{factory:()=>new Ze.x}),ga=new S.OlP("",{providedIn:"root",factory:()=>1}),Rc=new S.OlP("");function Oc(L){return Za(0,[{provide:Rc,useExisting:Wa},{provide:Il,useExisting:L}])}const _a=new S.OlP("ROUTER_FORROOT_GUARD"),kc=[Xt.Ye,{provide:Uo,useClass:Le},Fn,gr,{provide:Dr,useFactory:function Pc(L){return L.routerState.root},deps:[Fn]},ve,[]];function zu(){return new S.PXZ("Router",Fn)}let bs=(()=>{var L;class B{constructor(O){}static forRoot(O,X){return{ngModule:B,providers:[kc,[],{provide:J,multi:!0,useValue:O},{provide:_a,useFactory:du,deps:[[Fn,new S.FiY,new S.tp0]]},{provide:_r,useValue:X||{}},X?.useHash?{provide:Xt.S$,useClass:Xt.Do}:{provide:Xt.S$,useClass:Xt.b0},{provide:Ac,useFactory:()=>{const L=(0,S.f3M)(Xt.EM),B=(0,S.f3M)(S.R0b),$=(0,S.f3M)(_r),O=(0,S.f3M)(on),X=(0,S.f3M)(Uo);return $.scrollOffset&&L.setOffset($.scrollOffset),new sc(X,O,L,B,$)}},X?.preloadingStrategy?Oc(X.preloadingStrategy).\u0275providers:[],{provide:S.PXZ,multi:!0,useFactory:zu},X?.initialNavigation?Xs(X):[],X?.bindToComponentInputs?Za(8,[cs,{provide:$o,useExisting:cs}]).\u0275providers:[],[{provide:hu,useFactory:Go},{provide:S.tb,multi:!0,useExisting:hu}]]}}static forChild(O){return{ngModule:B,providers:[{provide:J,multi:!0,useValue:O}]}}}return(L=B).\u0275fac=function(O){return new(O||L)(S.LFG(_a,8))},L.\u0275mod=S.oAB({type:L}),L.\u0275inj=S.cJS({}),B})();function du(L){return"guarded"}function Xs(L){return["disabled"===L.initialNavigation?Za(3,[{provide:S.ip1,multi:!0,useFactory:()=>{const B=(0,S.f3M)(Fn);return()=>{B.setUpLocationChangeListener()}}},{provide:ga,useValue:2}]).\u0275providers:[],"enabledBlocking"===L.initialNavigation?Za(2,[{provide:ga,useValue:0},{provide:S.ip1,multi:!0,deps:[S.zs3],useFactory:B=>{const $=B.get(Xt.V_,Promise.resolve());return()=>$.then(()=>new Promise(O=>{const X=B.get(Fn),pe=B.get(Pl);Lo(X,()=>{O(!0)}),B.get(on).afterPreactivation=()=>(O(!0),pe.closed?(0,Ke.of)(void 0):pe),X.initialNavigation()}))}}]).\u0275providers:[]]}const hu=new S.OlP("")},7632:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{FT:()=>StoreDevtoolsModule});var _angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5879),_ngrx_store__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4221),rxjs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6232),rxjs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5592),rxjs__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(2096),rxjs__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(3019),rxjs__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(2381),rxjs__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(7328),rxjs_operators__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3020),rxjs_operators__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2181),rxjs_operators__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(7398),rxjs_operators__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(6328),rxjs_operators__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(5178),rxjs_operators__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(3620),rxjs_operators__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(6306),rxjs_operators__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(8180),rxjs_operators__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(9773),rxjs_operators__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(4664),rxjs_operators__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(836),rxjs_operators__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(3093),rxjs_operators__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(2460),rxjs_operators__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(6699),_angular_core_rxjs_interop__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(1993);const PERFORM_ACTION="PERFORM_ACTION",REFRESH="REFRESH",RESET="RESET",ROLLBACK="ROLLBACK",COMMIT="COMMIT",SWEEP="SWEEP",TOGGLE_ACTION="TOGGLE_ACTION",SET_ACTIONS_ACTIVE="SET_ACTIONS_ACTIVE",JUMP_TO_STATE="JUMP_TO_STATE",JUMP_TO_ACTION="JUMP_TO_ACTION",IMPORT_STATE="IMPORT_STATE",LOCK_CHANGES="LOCK_CHANGES",PAUSE_RECORDING="PAUSE_RECORDING";class PerformAction{constructor(Ue,re){if(this.action=Ue,this.timestamp=re,this.type=PERFORM_ACTION,typeof Ue.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')}}class Refresh{constructor(){this.type=REFRESH}}class Reset{constructor(Ue){this.timestamp=Ue,this.type=RESET}}class Rollback{constructor(Ue){this.timestamp=Ue,this.type=ROLLBACK}}class Commit{constructor(Ue){this.timestamp=Ue,this.type=COMMIT}}class Sweep{constructor(){this.type=SWEEP}}class ToggleAction{constructor(Ue){this.id=Ue,this.type=TOGGLE_ACTION}}class SetActionsActive{constructor(Ue,re,S=!0){this.start=Ue,this.end=re,this.active=S,this.type=SET_ACTIONS_ACTIVE}}class JumpToState{constructor(Ue){this.index=Ue,this.type=JUMP_TO_STATE}}class JumpToAction{constructor(Ue){this.actionId=Ue,this.type=JUMP_TO_ACTION}}class ImportState{constructor(Ue){this.nextLiftedState=Ue,this.type=IMPORT_STATE}}class LockChanges{constructor(Ue){this.status=Ue,this.type=LOCK_CHANGES}}class PauseRecording{constructor(Ue){this.status=Ue,this.type=PAUSE_RECORDING}}class StoreDevtoolsConfig{constructor(){this.maxAge=!1}}const STORE_DEVTOOLS_CONFIG=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.OlP("@ngrx/store-devtools Options"),INITIAL_OPTIONS=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.OlP("@ngrx/store-devtools Initial Config");function noMonitor(){return null}const DEFAULT_NAME="NgRx Store DevTools";function createConfig(ut){const Ue={maxAge:!1,monitor:noMonitor,actionSanitizer:void 0,stateSanitizer:void 0,name:DEFAULT_NAME,serialize:!1,logOnly:!1,autoPause:!1,trace:!1,traceLimit:75,features:{pause:!0,lock:!0,persist:!0,export:!0,import:"custom",jump:!0,skip:!0,reorder:!0,dispatch:!0,test:!0},connectOutsideZone:!1},re="function"==typeof ut?ut():ut,Re=re.features||!!re.logOnly&&{pause:!0,export:!0,test:!0}||Ue.features;!0===Re.import&&(Re.import="custom");const K=Object.assign({},Ue,{features:Re},re);if(K.maxAge&&K.maxAge<2)throw new Error(`Devtools 'maxAge' cannot be less than 2, got ${K.maxAge}`);return K}function difference(ut,Ue){return ut.filter(re=>Ue.indexOf(re)<0)}function unliftState(ut){const{computedStates:Ue,currentStateIndex:re}=ut;if(re>=Ue.length){const{state:Re}=Ue[Ue.length-1];return Re}const{state:S}=Ue[re];return S}function unliftAction(ut){return ut.actionsById[ut.nextActionId-1]}function liftAction(ut){return new PerformAction(ut,+Date.now())}function sanitizeActions(ut,Ue){return Object.keys(Ue).reduce((re,S)=>{const Re=Number(S);return re[Re]=sanitizeAction(ut,Ue[Re],Re),re},{})}function sanitizeAction(ut,Ue,re){return{...Ue,action:ut(Ue.action,re)}}function sanitizeStates(ut,Ue){return Ue.map((re,S)=>({state:sanitizeState(ut,re.state,S),error:re.error}))}function sanitizeState(ut,Ue,re){return ut(Ue,re)}function shouldFilterActions(ut){return ut.predicate||ut.actionsSafelist||ut.actionsBlocklist}function filterLiftedState(ut,Ue,re,S){const Re=[],K={},l=[];return ut.stagedActionIds.forEach((ge,Ke)=>{const nt=ut.actionsById[ge];nt&&(Ke&&isActionFiltered(ut.computedStates[Ke],nt,Ue,re,S)||(K[ge]=nt,Re.push(ge),l.push(ut.computedStates[Ke])))}),{...ut,stagedActionIds:Re,actionsById:K,computedStates:l}}function isActionFiltered(ut,Ue,re,S,Re){const K=re&&!re(ut,Ue.action),l=S&&!Ue.action.type.match(S.map(Ke=>escapeRegExp(Ke)).join("|")),ge=Re&&Ue.action.type.match(Re.map(Ke=>escapeRegExp(Ke)).join("|"));return K||l||ge}function escapeRegExp(ut){return ut.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function injectZoneConfig(ut){return{ngZone:ut?(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.f3M)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.R0b):null,connectOutsideZone:ut}}let DevtoolsDispatcher=(()=>{var ut;class Ue extends _ngrx_store__WEBPACK_IMPORTED_MODULE_1__.UO{}return(ut=Ue).\u0275fac=function(){let re;return function(Re){return(re||(re=_angular_core__WEBPACK_IMPORTED_MODULE_0__.n5z(ut)))(Re||ut)}}(),ut.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yz7({token:ut,factory:ut.\u0275fac}),Ue})();const ExtensionActionTypes={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},REDUX_DEVTOOLS_EXTENSION=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.OlP("@ngrx/store-devtools Redux Devtools Extension");let DevtoolsExtension=(()=>{var _class2;class DevtoolsExtension{constructor(ut,Ue,re){this.config=Ue,this.dispatcher=re,this.zoneConfig=injectZoneConfig(this.config.connectOutsideZone),this.devtoolsExtension=ut,this.createActionStreams()}notify(ut,Ue){if(this.devtoolsExtension)if(ut.type===PERFORM_ACTION){if(Ue.isLocked||Ue.isPaused)return;const re=unliftState(Ue);if(shouldFilterActions(this.config)&&isActionFiltered(re,ut,this.config.predicate,this.config.actionsSafelist,this.config.actionsBlocklist))return;const S=this.config.stateSanitizer?sanitizeState(this.config.stateSanitizer,re,Ue.currentStateIndex):re,Re=this.config.actionSanitizer?sanitizeAction(this.config.actionSanitizer,ut,Ue.nextActionId):ut;this.sendToReduxDevtools(()=>this.extensionConnection.send(Re,S))}else{const re={...Ue,stagedActionIds:Ue.stagedActionIds,actionsById:this.config.actionSanitizer?sanitizeActions(this.config.actionSanitizer,Ue.actionsById):Ue.actionsById,computedStates:this.config.stateSanitizer?sanitizeStates(this.config.stateSanitizer,Ue.computedStates):Ue.computedStates};this.sendToReduxDevtools(()=>this.devtoolsExtension.send(null,re,this.getExtensionConfig(this.config)))}}createChangesObservable(){return this.devtoolsExtension?new rxjs__WEBPACK_IMPORTED_MODULE_3__.y(ut=>{const Ue=this.zoneConfig.connectOutsideZone?this.zoneConfig.ngZone.runOutsideAngular(()=>this.devtoolsExtension.connect(this.getExtensionConfig(this.config))):this.devtoolsExtension.connect(this.getExtensionConfig(this.config));return this.extensionConnection=Ue,Ue.init(),Ue.subscribe(re=>ut.next(re)),Ue.unsubscribe}):rxjs__WEBPACK_IMPORTED_MODULE_2__.E}createActionStreams(){const ut=this.createChangesObservable().pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_4__.B)()),Ue=ut.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(ge=>ge.type===ExtensionActionTypes.START)),re=ut.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(ge=>ge.type===ExtensionActionTypes.STOP)),S=ut.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(ge=>ge.type===ExtensionActionTypes.DISPATCH),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(ge=>this.unwrapAction(ge.payload)),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_7__.b)(ge=>ge.type===IMPORT_STATE?this.dispatcher.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(Ke=>Ke.type===_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.wb),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_8__.V)(1e3),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_9__.b)(1e3),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(()=>ge),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_10__.K)(()=>(0,rxjs__WEBPACK_IMPORTED_MODULE_11__.of)(ge)),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_12__.q)(1)):(0,rxjs__WEBPACK_IMPORTED_MODULE_11__.of)(ge))),K=ut.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(ge=>ge.type===ExtensionActionTypes.ACTION),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(ge=>this.unwrapAction(ge.payload))).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_13__.R)(re)),l=S.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_13__.R)(re));this.start$=Ue.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_13__.R)(re)),this.actions$=this.start$.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_14__.w)(()=>K)),this.liftedActions$=this.start$.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_14__.w)(()=>l))}unwrapAction(action){return"string"==typeof action?eval(`(${action})`):action}getExtensionConfig(ut){const Ue={name:ut.name,features:ut.features,serialize:ut.serialize,autoPause:ut.autoPause??!1,trace:ut.trace??!1,traceLimit:ut.traceLimit??75};return!1!==ut.maxAge&&(Ue.maxAge=ut.maxAge),Ue}sendToReduxDevtools(ut){try{ut()}catch(Ue){console.warn("@ngrx/store-devtools: something went wrong inside the redux devtools",Ue)}}}return _class2=DevtoolsExtension,_class2.\u0275fac=function ut(Ue){return new(Ue||_class2)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(REDUX_DEVTOOLS_EXTENSION),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(STORE_DEVTOOLS_CONFIG),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(DevtoolsDispatcher))},_class2.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yz7({token:_class2,factory:_class2.\u0275fac}),DevtoolsExtension})();const INIT_ACTION={type:_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.qg},RECOMPUTE="@ngrx/store-devtools/recompute",RECOMPUTE_ACTION={type:RECOMPUTE};function computeNextEntry(ut,Ue,re,S,Re){if(S)return{state:re,error:"Interrupted by an error up the chain"};let l,K=re;try{K=ut(re,Ue)}catch(ge){l=ge.toString(),Re.handleError(ge)}return{state:K,error:l}}function recomputeStates(ut,Ue,re,S,Re,K,l,ge,Ke){if(Ue>=ut.length&&ut.length===K.length)return ut;const nt=ut.slice(0,Ue),Ye=K.length-(Ke?1:0);for(let Ge=Ue;Ge<Ye;Ge++){const Xe=K[Ge],at=Re[Xe].action,ht=nt[Ge-1],Bt=ht?ht.state:S,zt=ht?ht.error:void 0,St=l.indexOf(Xe)>-1?ht:computeNextEntry(re,at,Bt,zt,ge);nt.push(St)}return Ke&&nt.push(ut[ut.length-1]),nt}function liftInitialState(ut,Ue){return{monitorState:Ue(void 0,{}),nextActionId:1,actionsById:{0:liftAction(INIT_ACTION)},stagedActionIds:[0],skippedActionIds:[],committedState:ut,currentStateIndex:0,computedStates:[],isLocked:!1,isPaused:!1}}function liftReducerWith(ut,Ue,re,S,Re={}){return K=>(l,ge)=>{let{monitorState:Ke,actionsById:nt,nextActionId:Ye,stagedActionIds:Ge,skippedActionIds:Xe,committedState:at,currentStateIndex:ht,computedStates:Bt,isLocked:zt,isPaused:dn}=l||Ue;function St(kn){let Dn=kn,ft=Ge.slice(1,Dn+1);for(let Ze=0;Ze<ft.length;Ze++){if(Bt[Ze+1].error){Dn=Ze,ft=Ge.slice(1,Dn+1);break}delete nt[ft[Ze]]}Xe=Xe.filter(Ze=>-1===ft.indexOf(Ze)),Ge=[0,...Ge.slice(Dn+1)],at=Bt[Dn].state,Bt=Bt.slice(Dn),ht=ht>Dn?ht-Dn:0}function Bn(){nt={0:liftAction(INIT_ACTION)},Ye=1,Ge=[0],Xe=[],at=Bt[ht].state,ht=0,Bt=[]}l||(nt=Object.create(nt));let Tn=0;switch(ge.type){case LOCK_CHANGES:zt=ge.status,Tn=1/0;break;case PAUSE_RECORDING:dn=ge.status,dn?(Ge=[...Ge,Ye],nt[Ye]=new PerformAction({type:"@ngrx/devtools/pause"},+Date.now()),Ye++,Tn=Ge.length-1,Bt=Bt.concat(Bt[Bt.length-1]),ht===Ge.length-2&&ht++,Tn=1/0):Bn();break;case RESET:nt={0:liftAction(INIT_ACTION)},Ye=1,Ge=[0],Xe=[],at=ut,ht=0,Bt=[];break;case COMMIT:Bn();break;case ROLLBACK:nt={0:liftAction(INIT_ACTION)},Ye=1,Ge=[0],Xe=[],ht=0,Bt=[];break;case TOGGLE_ACTION:{const{id:kn}=ge;Xe=-1===Xe.indexOf(kn)?[kn,...Xe]:Xe.filter(ft=>ft!==kn),Tn=Ge.indexOf(kn);break}case SET_ACTIONS_ACTIVE:{const{start:kn,end:Dn,active:ft}=ge,Ze=[];for(let Xt=kn;Xt<Dn;Xt++)Ze.push(Xt);Xe=ft?difference(Xe,Ze):[...Xe,...Ze],Tn=Ge.indexOf(kn);break}case JUMP_TO_STATE:ht=ge.index,Tn=1/0;break;case JUMP_TO_ACTION:{const kn=Ge.indexOf(ge.actionId);-1!==kn&&(ht=kn),Tn=1/0;break}case SWEEP:Ge=difference(Ge,Xe),Xe=[],ht=Math.min(ht,Ge.length-1);break;case PERFORM_ACTION:{if(zt)return l||Ue;if(dn||l&&isActionFiltered(l.computedStates[ht],ge,Re.predicate,Re.actionsSafelist,Re.actionsBlocklist)){const Dn=Bt[Bt.length-1];Bt=[...Bt.slice(0,-1),computeNextEntry(K,ge.action,Dn.state,Dn.error,re)],Tn=1/0;break}Re.maxAge&&Ge.length===Re.maxAge&&St(1),ht===Ge.length-1&&ht++;const kn=Ye++;nt[kn]=ge,Ge=[...Ge,kn],Tn=Ge.length-1;break}case IMPORT_STATE:({monitorState:Ke,actionsById:nt,nextActionId:Ye,stagedActionIds:Ge,skippedActionIds:Xe,committedState:at,currentStateIndex:ht,computedStates:Bt,isLocked:zt,isPaused:dn}=ge.nextLiftedState);break;case _ngrx_store__WEBPACK_IMPORTED_MODULE_1__.qg:Tn=0,Re.maxAge&&Ge.length>Re.maxAge&&(Bt=recomputeStates(Bt,Tn,K,at,nt,Ge,Xe,re,dn),St(Ge.length-Re.maxAge),Tn=1/0);break;case _ngrx_store__WEBPACK_IMPORTED_MODULE_1__.wb:if(Bt.filter(Dn=>Dn.error).length>0)Tn=0,Re.maxAge&&Ge.length>Re.maxAge&&(Bt=recomputeStates(Bt,Tn,K,at,nt,Ge,Xe,re,dn),St(Ge.length-Re.maxAge),Tn=1/0);else{if(!dn&&!zt){ht===Ge.length-1&&ht++;const Dn=Ye++;nt[Dn]=new PerformAction(ge,+Date.now()),Ge=[...Ge,Dn],Tn=Ge.length-1,Bt=recomputeStates(Bt,Tn,K,at,nt,Ge,Xe,re,dn)}Bt=Bt.map(Dn=>({...Dn,state:K(Dn.state,RECOMPUTE_ACTION)})),ht=Ge.length-1,Re.maxAge&&Ge.length>Re.maxAge&&St(Ge.length-Re.maxAge),Tn=1/0}break;default:Tn=1/0}return Bt=recomputeStates(Bt,Tn,K,at,nt,Ge,Xe,re,dn),Ke=S(Ke,ge),{monitorState:Ke,actionsById:nt,nextActionId:Ye,stagedActionIds:Ge,skippedActionIds:Xe,committedState:at,currentStateIndex:ht,computedStates:Bt,isLocked:zt,isPaused:dn}}}let StoreDevtools=(()=>{var ut;class Ue{constructor(S,Re,K,l,ge,Ke,nt,Ye){const Ge=liftInitialState(nt,Ye.monitor),Xe=liftReducerWith(nt,Ge,Ke,Ye.monitor,Ye),at=(0,rxjs__WEBPACK_IMPORTED_MODULE_15__.T)((0,rxjs__WEBPACK_IMPORTED_MODULE_15__.T)(Re.asObservable().pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_16__.T)(1)),l.actions$).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(liftAction)),S,l.liftedActions$).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_17__.Q)(rxjs__WEBPACK_IMPORTED_MODULE_18__.N)),ht=K.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(Xe)),Bt=injectZoneConfig(Ye.connectOutsideZone),zt=new rxjs__WEBPACK_IMPORTED_MODULE_19__.t(1);this.liftedStateSubscription=at.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_20__.M)(ht),emitInZone(Bt),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_21__.R)(({state:Bn},[Tn,kn])=>{let Dn=kn(Bn,Tn);return Tn.type!==PERFORM_ACTION&&shouldFilterActions(Ye)&&(Dn=filterLiftedState(Dn,Ye.predicate,Ye.actionsSafelist,Ye.actionsBlocklist)),l.notify(Tn,Dn),{state:Dn,action:Tn}},{state:Ge,action:null})).subscribe(({state:Bn,action:Tn})=>{zt.next(Bn),Tn.type===PERFORM_ACTION&&ge.next(Tn.action)}),this.extensionStartSubscription=l.start$.pipe(emitInZone(Bt)).subscribe(()=>{this.refresh()});const dn=zt.asObservable(),St=dn.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(unliftState));Object.defineProperty(St,"state",{value:(0,_angular_core_rxjs_interop__WEBPACK_IMPORTED_MODULE_22__.O4)(St,{manualCleanup:!0,requireSync:!0})}),this.dispatcher=S,this.liftedState=dn,this.state=St}ngOnDestroy(){this.liftedStateSubscription.unsubscribe(),this.extensionStartSubscription.unsubscribe()}dispatch(S){this.dispatcher.next(S)}next(S){this.dispatcher.next(S)}error(S){}complete(){}performAction(S){this.dispatch(new PerformAction(S,+Date.now()))}refresh(){this.dispatch(new Refresh)}reset(){this.dispatch(new Reset(+Date.now()))}rollback(){this.dispatch(new Rollback(+Date.now()))}commit(){this.dispatch(new Commit(+Date.now()))}sweep(){this.dispatch(new Sweep)}toggleAction(S){this.dispatch(new ToggleAction(S))}jumpToAction(S){this.dispatch(new JumpToAction(S))}jumpToState(S){this.dispatch(new JumpToState(S))}importState(S){this.dispatch(new ImportState(S))}lockChanges(S){this.dispatch(new LockChanges(S))}pauseRecording(S){this.dispatch(new PauseRecording(S))}}return(ut=Ue).\u0275fac=function(S){return new(S||ut)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(DevtoolsDispatcher),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.UO),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.n$),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(DevtoolsExtension),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.Y$),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_angular_core__WEBPACK_IMPORTED_MODULE_0__.qLn),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.Y6),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(STORE_DEVTOOLS_CONFIG))},ut.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yz7({token:ut,factory:ut.\u0275fac}),Ue})();function emitInZone({ngZone:ut,connectOutsideZone:Ue}){return re=>Ue?new rxjs__WEBPACK_IMPORTED_MODULE_3__.y(S=>re.subscribe({next:Re=>ut.run(()=>S.next(Re)),error:Re=>ut.run(()=>S.error(Re)),complete:()=>ut.run(()=>S.complete())})):re}const IS_EXTENSION_OR_MONITOR_PRESENT=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.OlP("@ngrx/store-devtools Is Devtools Extension or Monitor Present");function createIsExtensionOrMonitorPresent(ut,Ue){return!!ut||Ue.monitor!==noMonitor}function createReduxDevtoolsExtension(){const ut="__REDUX_DEVTOOLS_EXTENSION__";return"object"==typeof window&&typeof window[ut]<"u"?window[ut]:null}function provideStoreDevtools(ut={}){return(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.MR2)([DevtoolsExtension,DevtoolsDispatcher,StoreDevtools,{provide:INITIAL_OPTIONS,useValue:ut},{provide:IS_EXTENSION_OR_MONITOR_PRESENT,deps:[REDUX_DEVTOOLS_EXTENSION,STORE_DEVTOOLS_CONFIG],useFactory:createIsExtensionOrMonitorPresent},{provide:REDUX_DEVTOOLS_EXTENSION,useFactory:createReduxDevtoolsExtension},{provide:STORE_DEVTOOLS_CONFIG,deps:[INITIAL_OPTIONS],useFactory:createConfig},{provide:_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.FR,deps:[StoreDevtools],useFactory:createStateObservable},{provide:_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.mK,useExisting:DevtoolsDispatcher}])}function createStateObservable(ut){return ut.state}let StoreDevtoolsModule=(()=>{var ut;class Ue{static instrument(S={}){return{ngModule:Ue,providers:[provideStoreDevtools(S)]}}}return(ut=Ue).\u0275fac=function(S){return new(S||ut)},ut.\u0275mod=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oAB({type:ut}),ut.\u0275inj=_angular_core__WEBPACK_IMPORTED_MODULE_0__.cJS({}),Ue})()},4221:(ut,Ue,re)=>{"use strict";re.d(Ue,{UO:()=>vn,qg:()=>qt,Y6:()=>Mr,mK:()=>bo,n$:()=>wr,Y$:()=>Mi,FR:()=>fo,yh:()=>Ao,CK:()=>ks,Aw:()=>ts,cr:()=>da,wb:()=>To,PH:()=>dn,ZF:()=>_i,Lq:()=>ls,P1:()=>_n,on:()=>Ur,Ky:()=>St});var S=re(5879),Re=re(5619),K=re(5592),l=re(8645),ge=re(2381),Ke=re(3093),nt=re(2460),Ye=re(6699),Ge=re(7398),at=re(3997),ht=re(1993);const Bt={};function dn(Oe,Ot){if(Bt[Oe]=(Bt[Oe]||0)+1,"function"==typeof Ot)return Tn(Oe,(...bt)=>({...Ot(...bt),type:Oe}));switch(Ot?Ot._as:"empty"){case"empty":return Tn(Oe,()=>({type:Oe}));case"props":return Tn(Oe,bt=>({...bt,type:Oe}));default:throw new Error("Unexpected config.")}}function St(){return{_as:"props",_p:void 0}}function Tn(Oe,Ot){return Object.defineProperty(Ot,"type",{value:Oe,writable:!1})}const qt="@ngrx/store/init";let vn=(()=>{var Oe;class Ot extends Re.X{constructor(){super({type:qt})}next(bt){if("function"==typeof bt)throw new TypeError("\n        Dispatch expected an object, instead it received a function.\n        If you're using the createAction function, make sure to invoke the function\n        before dispatching the action. For example, someAction should be someAction().");if(typeof bt>"u")throw new TypeError("Actions must be objects");if(typeof bt.type>"u")throw new TypeError("Actions must have a type property");super.next(bt)}complete(){}ngOnDestroy(){super.complete()}}return(Oe=Ot).\u0275fac=function(bt){return new(bt||Oe)},Oe.\u0275prov=S.Yz7({token:Oe,factory:Oe.\u0275fac}),Ot})();const Ti=[vn],Ei=new S.OlP("@ngrx/store Internal Root Guard"),Li=new S.OlP("@ngrx/store Internal Initial State"),Mr=new S.OlP("@ngrx/store Initial State"),hi=new S.OlP("@ngrx/store Reducer Factory"),mr=new S.OlP("@ngrx/store Internal Reducer Factory Provider"),Oi=new S.OlP("@ngrx/store Initial Reducers"),ji=new S.OlP("@ngrx/store Internal Initial Reducers"),so=new S.OlP("@ngrx/store Store Features"),_t=new S.OlP("@ngrx/store Internal Store Reducers"),Nt=new S.OlP("@ngrx/store Internal Feature Reducers"),Yt=new S.OlP("@ngrx/store Internal Feature Configs"),Kt=new S.OlP("@ngrx/store Internal Store Features"),bn=new S.OlP("@ngrx/store Internal Feature Reducers Token"),$t=new S.OlP("@ngrx/store Feature Reducers"),Vt=new S.OlP("@ngrx/store User Provided Meta Reducers"),Gt=new S.OlP("@ngrx/store Meta Reducers"),zn=new S.OlP("@ngrx/store Internal Resolved Meta Reducers"),Yn=new S.OlP("@ngrx/store User Runtime Checks Config"),Ln=new S.OlP("@ngrx/store Internal User Runtime Checks Config"),ti=new S.OlP("@ngrx/store Internal Runtime Checks"),fi=new S.OlP("@ngrx/store Check if Action types are unique");function vi(Oe,Ot={}){const tn=Object.keys(Oe),bt={};for(let Nn=0;Nn<tn.length;Nn++){const xi=tn[Nn];"function"==typeof Oe[xi]&&(bt[xi]=Oe[xi])}const yn=Object.keys(bt);return function(xi,Sr){xi=void 0===xi?Ot:xi;let gr=!1;const ri={};for(let Jn=0;Jn<yn.length;Jn++){const br=yn[Jn],Ji=xi[br],Io=(0,bt[br])(Ji,Sr);ri[br]=Io,gr=gr||Io!==Ji}return gr?ri:xi}}function Do(...Oe){return function(Ot){if(0===Oe.length)return Ot;const tn=Oe[Oe.length-1];return Oe.slice(0,-1).reduceRight((yn,Nn)=>Nn(yn),tn(Ot))}}function Yr(Oe,Ot){return Array.isArray(Ot)&&Ot.length>0&&(Oe=Do.apply(null,[...Ot,Oe])),(tn,bt)=>{const yn=Oe(tn);return(Nn,xi)=>yn(Nn=void 0===Nn?bt:Nn,xi)}}new S.OlP("@ngrx/store Root Store Provider"),new S.OlP("@ngrx/store Feature State Provider");class wr extends K.y{}class bo extends vn{}const To="@ngrx/store/update-reducers";let ii=(()=>{var Oe;class Ot extends Re.X{get currentReducers(){return this.reducers}constructor(bt,yn,Nn,xi){super(xi(Nn,yn)),this.dispatcher=bt,this.initialState=yn,this.reducers=Nn,this.reducerFactory=xi}addFeature(bt){this.addFeatures([bt])}addFeatures(bt){const yn=bt.reduce((Nn,{reducers:xi,reducerFactory:Sr,metaReducers:gr,initialState:ri,key:Jn})=>{const br="function"==typeof xi?function sr(Oe){const Ot=Array.isArray(Oe)&&Oe.length>0?Do(...Oe):tn=>tn;return(tn,bt)=>(tn=Ot(tn),(yn,Nn)=>tn(yn=void 0===yn?bt:yn,Nn))}(gr)(xi,ri):Yr(Sr,gr)(xi,ri);return Nn[Jn]=br,Nn},{});this.addReducers(yn)}removeFeature(bt){this.removeFeatures([bt])}removeFeatures(bt){this.removeReducers(bt.map(yn=>yn.key))}addReducer(bt,yn){this.addReducers({[bt]:yn})}addReducers(bt){this.reducers={...this.reducers,...bt},this.updateReducers(Object.keys(bt))}removeReducer(bt){this.removeReducers([bt])}removeReducers(bt){bt.forEach(yn=>{this.reducers=function Zi(Oe,Ot){return Object.keys(Oe).filter(tn=>tn!==Ot).reduce((tn,bt)=>Object.assign(tn,{[bt]:Oe[bt]}),{})}(this.reducers,yn)}),this.updateReducers(bt)}updateReducers(bt){this.next(this.reducerFactory(this.reducers,this.initialState)),this.dispatcher.next({type:To,features:bt})}ngOnDestroy(){this.complete()}}return(Oe=Ot).\u0275fac=function(bt){return new(bt||Oe)(S.LFG(bo),S.LFG(Mr),S.LFG(Oi),S.LFG(hi))},Oe.\u0275prov=S.Yz7({token:Oe,factory:Oe.\u0275fac}),Ot})();const gi=[ii,{provide:wr,useExisting:ii},{provide:bo,useExisting:vn}];let Mi=(()=>{var Oe;class Ot extends l.x{ngOnDestroy(){this.complete()}}return(Oe=Ot).\u0275fac=function(){let tn;return function(yn){return(tn||(tn=S.n5z(Oe)))(yn||Oe)}}(),Oe.\u0275prov=S.Yz7({token:Oe,factory:Oe.\u0275fac}),Ot})();const Er=[Mi];class fo extends K.y{}let po=(()=>{var Oe;class Ot extends Re.X{constructor(bt,yn,Nn,xi){super(xi);const Jn=bt.pipe((0,Ke.Q)(ge.N)).pipe((0,nt.M)(yn)).pipe((0,Ye.R)(Gi,{state:xi}));this.stateSubscription=Jn.subscribe(({state:br,action:Qr})=>{this.next(br),Nn.next(Qr)}),this.state=(0,ht.O4)(this,{manualCleanup:!0,requireSync:!0})}ngOnDestroy(){this.stateSubscription.unsubscribe(),this.complete()}}return(Oe=Ot).INIT=qt,Oe.\u0275fac=function(bt){return new(bt||Oe)(S.LFG(vn),S.LFG(wr),S.LFG(Mi),S.LFG(Mr))},Oe.\u0275prov=S.Yz7({token:Oe,factory:Oe.\u0275fac}),Ot})();function Gi(Oe={state:void 0},[Ot,tn]){const{state:bt}=Oe;return{state:tn(bt,Ot),action:Ot}}const Si=[po,{provide:fo,useExisting:po}];let Ao=(()=>{var Oe;class Ot extends K.y{constructor(bt,yn,Nn){super(),this.actionsObserver=yn,this.reducerManager=Nn,this.source=bt,this.state=bt.state}select(bt,...yn){return xo.call(null,bt,...yn)(this)}selectSignal(bt,yn){return(0,S.Flj)(()=>bt(this.state()),{equal:yn?.equal||((Nn,xi)=>Nn===xi)})}lift(bt){const yn=new Ot(this,this.actionsObserver,this.reducerManager);return yn.operator=bt,yn}dispatch(bt){this.actionsObserver.next(bt)}next(bt){this.actionsObserver.next(bt)}error(bt){this.actionsObserver.error(bt)}complete(){this.actionsObserver.complete()}addReducer(bt,yn){this.reducerManager.addReducer(bt,yn)}removeReducer(bt){this.reducerManager.removeReducer(bt)}}return(Oe=Ot).\u0275fac=function(bt){return new(bt||Oe)(S.LFG(fo),S.LFG(vn),S.LFG(ii))},Oe.\u0275prov=S.Yz7({token:Oe,factory:Oe.\u0275fac}),Ot})();const nr=[Ao];function xo(Oe,Ot,...tn){return function(yn){let Nn;if("string"==typeof Oe){const xi=[Ot,...tn].filter(Boolean);Nn=yn.pipe(function Xe(...Oe){const Ot=Oe.length;if(0===Ot)throw new Error("list of properties cannot be empty.");return(0,Ge.U)(tn=>{let bt=tn;for(let yn=0;yn<Ot;yn++){const Nn=bt?.[Oe[yn]];if(!(typeof Nn<"u"))return;bt=Nn}return bt})}(Oe,...xi))}else{if("function"!=typeof Oe)throw new TypeError(`Unexpected type '${typeof Oe}' in select operator, expected 'string' or 'function'`);Nn=yn.pipe((0,Ge.U)(xi=>Oe(xi,Ot)))}return Nn.pipe((0,at.x)())}}const Hi="https://ngrx.io/guide/store/configuration/runtime-checks";function Uo(Oe){return void 0===Oe}function Le(Oe){return null===Oe}function ce(Oe){return Array.isArray(Oe)}function it(Oe){return"object"==typeof Oe&&null!==Oe}function Je(Oe){return"function"==typeof Oe}let fn=!1;function pt(Oe,Ot){return Oe===Ot}function Ut(Oe,Ot=pt,tn=pt){let Nn,bt=null,yn=null;return{memoized:function ri(){if(void 0!==Nn)return Nn.result;if(!bt)return yn=Oe.apply(null,arguments),bt=arguments,yn;if(!function Ve(Oe,Ot,tn){for(let bt=0;bt<Oe.length;bt++)if(!tn(Oe[bt],Ot[bt]))return!0;return!1}(arguments,bt,Ot))return yn;const Jn=Oe.apply(null,arguments);return bt=arguments,tn(yn,Jn)?yn:(yn=Jn,Jn)},reset:function xi(){bt=null,yn=null},setResult:function Sr(Jn=void 0){Nn={result:Jn}},clearResult:function gr(){Nn=void 0}}}function _n(...Oe){return function qn(Oe,Ot={stateFn:Gn}){return function(...tn){let bt=tn;if(Array.isArray(bt[0])){const[Jn,...br]=bt;bt=[...Jn,...br]}else 1===bt.length&&function Cr(Oe){return!!Oe&&"object"==typeof Oe&&Object.values(Oe).every(Ot=>"function"==typeof Ot)}(bt[0])&&(bt=function ur(Oe){const Ot=Object.values(Oe),tn=Object.keys(Oe);return[...Ot,(...yn)=>tn.reduce((Nn,xi,Sr)=>({...Nn,[xi]:yn[Sr]}),{})]}(bt[0]));const yn=bt.slice(0,bt.length-1),Nn=bt[bt.length-1],xi=yn.filter(Jn=>Jn.release&&"function"==typeof Jn.release),Sr=Oe(function(...Jn){return Nn.apply(null,Jn)}),gr=Ut(function(Jn,br){return Ot.stateFn.apply(null,[Jn,yn,br,Sr])});return Object.assign(gr.memoized,{release:function ri(){gr.reset(),Sr.reset(),xi.forEach(Jn=>Jn.release())},projector:Sr.memoized,setResult:gr.setResult,clearResult:gr.clearResult})}}(Ut)(...Oe)}function Gn(Oe,Ot,tn,bt){if(void 0===tn){const Nn=Ot.map(xi=>xi(Oe));return bt.memoized.apply(null,Nn)}const yn=Ot.map(Nn=>Nn(Oe,tn));return bt.memoized.apply(null,[...yn,tn])}function _i(Oe){return _n(Ot=>{const tn=Ot[Oe];return!function He(){return fn}()&&(0,S.X6Q)()&&!(Oe in Ot)&&console.warn(`@ngrx/store: The feature name "${Oe}" does not exist in the state, therefore createFeatureSelector cannot access it.  Be sure it is imported in a loaded module using StoreModule.forRoot('${Oe}', ...) or StoreModule.forFeature('${Oe}', ...).  If the default state is intended to be undefined, as is the case with router state, this development-only warning message can be ignored.`),tn},Ot=>Ot)}function Rt(Oe){return Oe instanceof S.OlP?(0,S.f3M)(Oe):Oe}function en(Oe,Ot){return Ot.map((tn,bt)=>{if(Oe[bt]instanceof S.OlP){const yn=(0,S.f3M)(Oe[bt]);return{key:tn.key,reducerFactory:yn.reducerFactory?yn.reducerFactory:vi,metaReducers:yn.metaReducers?yn.metaReducers:[],initialState:yn.initialState}}return tn})}function wn(Oe){return Oe.map(Ot=>Ot instanceof S.OlP?(0,S.f3M)(Ot):Ot)}function Kn(Oe){return"function"==typeof Oe?Oe():Oe}function An(Oe,Ot){return Oe.concat(Ot)}function qi(){if((0,S.f3M)(Ao,{optional:!0,skipSelf:!0}))throw new TypeError("The root Store has been provided more than once. Feature modules should provide feature states instead.");return"guarded"}function dr(Oe){Object.freeze(Oe);const Ot=Je(Oe);return Object.getOwnPropertyNames(Oe).forEach(tn=>{if(!tn.startsWith("\u0275")&&function an(Oe,Ot){return Object.prototype.hasOwnProperty.call(Oe,Ot)}(Oe,tn)&&(!Ot||"caller"!==tn&&"callee"!==tn&&"arguments"!==tn)){const bt=Oe[tn];(it(bt)||Je(bt))&&!Object.isFrozen(bt)&&dr(bt)}}),Oe}function Ar(Oe,Ot=[]){return(Uo(Oe)||Le(Oe))&&0===Ot.length?{path:["root"],value:Oe}:Object.keys(Oe).reduce((bt,yn)=>{if(bt)return bt;const Nn=Oe[yn];return function wt(Oe){return Je(Oe)&&Oe.hasOwnProperty("\u0275cmp")}(Nn)?bt:!(Uo(Nn)||Le(Nn)||function $e(Oe){return"number"==typeof Oe}(Nn)||function Se(Oe){return"boolean"==typeof Oe}(Nn)||function ue(Oe){return"string"==typeof Oe}(Nn)||ce(Nn))&&(function ct(Oe){if(!function vt(Oe){return it(Oe)&&!ce(Oe)}(Oe))return!1;const Ot=Object.getPrototypeOf(Oe);return Ot===Object.prototype||null===Ot}(Nn)?Ar(Nn,[...Ot,yn]):{path:[...Ot,yn],value:Nn})},!1)}function Jr(Oe,Ot){if(!1===Oe)return;const tn=Oe.path.join("."),bt=new Error(`Detected unserializable ${Ot} at "${tn}". ${Hi}#strict${Ot}serializability`);throw bt.value=Oe.value,bt.unserializablePath=tn,bt}function qo(Oe){return(0,S.X6Q)()?{strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!0,strictActionImmutability:!0,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1,...Oe}:{strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!1,strictActionImmutability:!1,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1}}function xt({strictActionSerializability:Oe,strictStateSerializability:Ot}){return tn=>Oe||Ot?function Mo(Oe,Ot){return function(tn,bt){Ot.action(bt)&&Jr(Ar(bt),"action");const yn=Oe(tn,bt);return Ot.state()&&Jr(Ar(yn),"state"),yn}}(tn,{action:bt=>Oe&&!ar(bt),state:()=>Ot}):tn}function Xi({strictActionImmutability:Oe,strictStateImmutability:Ot}){return tn=>Oe||Ot?function Ci(Oe,Ot){return function(tn,bt){const yn=Ot.action(bt)?dr(bt):bt,Nn=Oe(tn,yn);return Ot.state()?dr(Nn):Nn}}(tn,{action:bt=>Oe&&!ar(bt),state:()=>Ot}):tn}function ar(Oe){return Oe.type.startsWith("@ngrx")}function Lr({strictActionWithinNgZone:Oe}){return Ot=>Oe?function So(Oe,Ot){return function(tn,bt){if(Ot.action(bt)&&!S.R0b.isInAngularZone())throw new Error(`Action '${bt.type}' running outside NgZone. ${Hi}#strictactionwithinngzone`);return Oe(tn,bt)}}(Ot,{action:tn=>Oe&&!ar(tn)}):Ot}function Wr(Oe){return[{provide:Ln,useValue:Oe},{provide:Yn,useFactory:Vo,deps:[Ln]},{provide:ti,deps:[Yn],useFactory:qo},{provide:Gt,multi:!0,deps:[ti],useFactory:Xi},{provide:Gt,multi:!0,deps:[ti],useFactory:xt},{provide:Gt,multi:!0,deps:[ti],useFactory:Lr}]}function ao(){return[{provide:fi,multi:!0,deps:[ti],useFactory:Pr}]}function Vo(Oe){return Oe}function Pr(Oe){if(!Oe.strictActionTypeUniqueness)return;const Ot=Object.entries(Bt).filter(([,tn])=>tn>1).map(([tn])=>tn);if(Ot.length)throw new Error(`Action types are registered more than once, ${Ot.map(tn=>`"${tn}"`).join(", ")}. ${Hi}#strictactiontypeuniqueness`)}function Sn(Oe={},Ot={}){return[{provide:Ei,useFactory:qi},{provide:Li,useValue:Ot.initialState},{provide:Mr,useFactory:Kn,deps:[Li]},{provide:ji,useValue:Oe},{provide:_t,useExisting:Oe instanceof S.OlP?Oe:ji},{provide:Oi,deps:[ji,[new S.tBr(_t)]],useFactory:Rt},{provide:Vt,useValue:Ot.metaReducers?Ot.metaReducers:[]},{provide:zn,deps:[Gt,Vt],useFactory:An},{provide:mr,useValue:Ot.reducerFactory?Ot.reducerFactory:vi},{provide:hi,deps:[mr,zn],useFactory:Yr},Ti,gi,Er,Si,nr,Wr(Ot.runtimeChecks),ao()]}function wo(Oe,Ot,tn={}){return[{provide:Yt,multi:!0,useValue:Oe instanceof Object?{}:tn},{provide:so,multi:!0,useValue:{key:Oe instanceof Object?Oe.name:Oe,reducerFactory:tn instanceof S.OlP||!tn.reducerFactory?vi:tn.reducerFactory,metaReducers:tn instanceof S.OlP||!tn.metaReducers?[]:tn.metaReducers,initialState:tn instanceof S.OlP||!tn.initialState?void 0:tn.initialState}},{provide:Kt,deps:[Yt,so],useFactory:en},{provide:Nt,multi:!0,useValue:Oe instanceof Object?Oe.reducer:Ot},{provide:bn,multi:!0,useExisting:Ot instanceof S.OlP?Ot:Nt},{provide:$t,multi:!0,deps:[Nt,[new S.tBr(bn)]],useFactory:wn},ao()]}let da=(()=>{var Oe;class Ot{constructor(bt,yn,Nn,xi,Sr,gr){}}return(Oe=Ot).\u0275fac=function(bt){return new(bt||Oe)(S.LFG(vn),S.LFG(wr),S.LFG(Mi),S.LFG(Ao),S.LFG(Ei,8),S.LFG(fi,8))},Oe.\u0275mod=S.oAB({type:Oe}),Oe.\u0275inj=S.cJS({}),Ot})(),ks=(()=>{var Oe;class Ot{constructor(bt,yn,Nn,xi,Sr){this.features=bt,this.featureReducers=yn,this.reducerManager=Nn;const gr=bt.map((ri,Jn)=>{const Qr=yn.shift()[Jn];return{...ri,reducers:Qr,initialState:Kn(ri.initialState)}});Nn.addFeatures(gr)}ngOnDestroy(){this.reducerManager.removeFeatures(this.features)}}return(Oe=Ot).\u0275fac=function(bt){return new(bt||Oe)(S.LFG(Kt),S.LFG($t),S.LFG(ii),S.LFG(da),S.LFG(fi,8))},Oe.\u0275mod=S.oAB({type:Oe}),Oe.\u0275inj=S.cJS({}),Ot})(),ts=(()=>{var Oe;class Ot{static forRoot(bt,yn){return{ngModule:da,providers:[...Sn(bt,yn)]}}static forFeature(bt,yn,Nn={}){return{ngModule:ks,providers:[...wo(bt,yn,Nn)]}}}return(Oe=Ot).\u0275fac=function(bt){return new(bt||Oe)},Oe.\u0275mod=S.oAB({type:Oe}),Oe.\u0275inj=S.cJS({}),Ot})();function Ur(...Oe){return{reducer:Oe.pop(),types:Oe.map(bt=>bt.type)}}function ls(Oe,...Ot){const tn=new Map;for(const bt of Ot)for(const yn of bt.types){const Nn=tn.get(yn);tn.set(yn,Nn?(Sr,gr)=>bt.reducer(Nn(Sr,gr),gr):bt.reducer)}return function(bt=Oe,yn){const Nn=tn.get(yn.type);return Nn?Nn(bt,yn):bt}}},7582:(ut,Ue,re)=>{"use strict";function ht(_t,Nt,Yt,Kt){return new(Yt||(Yt=Promise))(function($t,Vt){function Gt(Ln){try{Yn(Kt.next(Ln))}catch(ti){Vt(ti)}}function zn(Ln){try{Yn(Kt.throw(Ln))}catch(ti){Vt(ti)}}function Yn(Ln){Ln.done?$t(Ln.value):function bn($t){return $t instanceof Yt?$t:new Yt(function(Vt){Vt($t)})}(Ln.value).then(Gt,zn)}Yn((Kt=Kt.apply(_t,Nt||[])).next())})}function ft(_t){return this instanceof ft?(this.v=_t,this):new ft(_t)}function Ze(_t,Nt,Yt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var bn,Kt=Yt.apply(_t,Nt||[]),$t=[];return bn={},Vt("next"),Vt("throw"),Vt("return"),bn[Symbol.asyncIterator]=function(){return this},bn;function Vt(fi){Kt[fi]&&(bn[fi]=function($i){return new Promise(function(Gr,vi){$t.push([fi,$i,Gr,vi])>1||Gt(fi,$i)})})}function Gt(fi,$i){try{!function zn(fi){fi.value instanceof ft?Promise.resolve(fi.value.v).then(Yn,Ln):ti($t[0][2],fi)}(Kt[fi]($i))}catch(Gr){ti($t[0][3],Gr)}}function Yn(fi){Gt("next",fi)}function Ln(fi){Gt("throw",fi)}function ti(fi,$i){fi($i),$t.shift(),$t.length&&Gt($t[0][0],$t[0][1])}}function Pt(_t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Yt,Nt=_t[Symbol.asyncIterator];return Nt?Nt.call(_t):(_t=function St(_t){var Nt="function"==typeof Symbol&&Symbol.iterator,Yt=Nt&&_t[Nt],Kt=0;if(Yt)return Yt.call(_t);if(_t&&"number"==typeof _t.length)return{next:function(){return _t&&Kt>=_t.length&&(_t=void 0),{value:_t&&_t[Kt++],done:!_t}}};throw new TypeError(Nt?"Object is not iterable.":"Symbol.iterator is not defined.")}(_t),Yt={},Kt("next"),Kt("throw"),Kt("return"),Yt[Symbol.asyncIterator]=function(){return this},Yt);function Kt($t){Yt[$t]=_t[$t]&&function(Vt){return new Promise(function(Gt,zn){!function bn($t,Vt,Gt,zn){Promise.resolve(zn).then(function(Yn){$t({value:Yn,done:Gt})},Vt)}(Gt,zn,(Vt=_t[$t](Vt)).done,Vt.value)})}}}re.d(Ue,{FC:()=>Ze,KL:()=>Pt,mG:()=>ht,qq:()=>ft}),"function"==typeof SuppressedError&&SuppressedError}},ut=>{ut(ut.s=2101)}]);