(self.webpackChunkfe_blog=self.webpackChunkfe_blog||[]).push([[179],{7344:(Ue,Se,te)=>{"use strict";var E=te(5879);let Be=null;function it(){return Be}class ue{}const Ye=new E.OlP("DocumentToken");let Ge=(()=>{var o;class t{historyGo(i){throw new Error("Not implemented")}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:function(){return(0,E.f3M)(Ie)},providedIn:"platform"}),t})();const Le=new E.OlP("Location Initialized");let Ie=(()=>{var o;class t extends Ge{constructor(){super(),this._doc=(0,E.f3M)(Ye),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return it().getBaseHref(this._doc)}onPopState(i){const h=it().getGlobalEventTarget(this._doc,"window");return h.addEventListener("popstate",i,!1),()=>h.removeEventListener("popstate",i)}onHashChange(i){const h=it().getGlobalEventTarget(this._doc,"window");return h.addEventListener("hashchange",i,!1),()=>h.removeEventListener("hashchange",i)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(i){this._location.pathname=i}pushState(i,h,w){this._history.pushState(i,h,w)}replaceState(i,h,w){this._history.replaceState(i,h,w)}forward(){this._history.forward()}back(){this._history.back()}historyGo(i=0){this._history.go(i)}getState(){return this._history.state}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:function(){return new o},providedIn:"platform"}),t})();function ke(o,t){if(0==o.length)return t;if(0==t.length)return o;let c=0;return o.endsWith("/")&&c++,t.startsWith("/")&&c++,2==c?o+t.substring(1):1==c?o+t:o+"/"+t}function $e(o){const t=o.match(/#|\?|$/),c=t&&t.index||o.length;return o.slice(0,c-("/"===o[c-1]?1:0))+o.slice(c)}function Qe(o){return o&&"?"!==o[0]?"?"+o:o}let Tt=(()=>{var o;class t{historyGo(i){throw new Error("Not implemented")}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:function(){return(0,E.f3M)(nn)},providedIn:"root"}),t})();const Wt=new E.OlP("appBaseHref");let nn=(()=>{var o;class t extends Tt{constructor(i,h){super(),this._platformLocation=i,this._removeListenerFns=[],this._baseHref=h??this._platformLocation.getBaseHrefFromDOM()??(0,E.f3M)(Ye).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}prepareExternalUrl(i){return ke(this._baseHref,i)}path(i=!1){const h=this._platformLocation.pathname+Qe(this._platformLocation.search),w=this._platformLocation.hash;return w&&i?`${h}${w}`:h}pushState(i,h,w,I){const N=this.prepareExternalUrl(w+Qe(I));this._platformLocation.pushState(i,h,N)}replaceState(i,h,w,I){const N=this.prepareExternalUrl(w+Qe(I));this._platformLocation.replaceState(i,h,N)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ge),E.LFG(Wt,8))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),Pt=(()=>{var o;class t extends Tt{constructor(i,h){super(),this._platformLocation=i,this._baseHref="",this._removeListenerFns=[],null!=h&&(this._baseHref=h)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}path(i=!1){let h=this._platformLocation.hash;return null==h&&(h="#"),h.length>0?h.substring(1):h}prepareExternalUrl(i){const h=ke(this._baseHref,i);return h.length>0?"#"+h:h}pushState(i,h,w,I){let N=this.prepareExternalUrl(w+Qe(I));0==N.length&&(N=this._platformLocation.pathname),this._platformLocation.pushState(i,h,N)}replaceState(i,h,w,I){let N=this.prepareExternalUrl(w+Qe(I));0==N.length&&(N=this._platformLocation.pathname),this._platformLocation.replaceState(i,h,N)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ge),E.LFG(Wt,8))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})(),En=(()=>{var o;class t{constructor(i){this._subject=new E.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=i;const h=this._locationStrategy.getBaseHref();this._basePath=function nt(o){if(new RegExp("^(https?:)?//").test(o)){const[,c]=o.split(/\/\/[^\/]+/);return c}return o}($e(pn(h))),this._locationStrategy.onPopState(w=>{this._subject.emit({url:this.path(!0),pop:!0,state:w.state,type:w.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(i=!1){return this.normalize(this._locationStrategy.path(i))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(i,h=""){return this.path()==this.normalize(i+Qe(h))}normalize(i){return t.stripTrailingSlash(function Dn(o,t){if(!o||!t.startsWith(o))return t;const c=t.substring(o.length);return""===c||["/",";","?","#"].includes(c[0])?c:t}(this._basePath,pn(i)))}prepareExternalUrl(i){return i&&"/"!==i[0]&&(i="/"+i),this._locationStrategy.prepareExternalUrl(i)}go(i,h="",w=null){this._locationStrategy.pushState(w,"",i,h),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Qe(h)),w)}replaceState(i,h="",w=null){this._locationStrategy.replaceState(w,"",i,h),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Qe(h)),w)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(i=0){this._locationStrategy.historyGo?.(i)}onUrlChange(i){return this._urlChangeListeners.push(i),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(h=>{this._notifyUrlChangeListeners(h.url,h.state)})),()=>{const h=this._urlChangeListeners.indexOf(i);this._urlChangeListeners.splice(h,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(i="",h){this._urlChangeListeners.forEach(w=>w(i,h))}subscribe(i,h,w){return this._subject.subscribe({next:i,error:h,complete:w})}}return(o=t).normalizeQueryParams=Qe,o.joinWithSlash=ke,o.stripTrailingSlash=$e,o.\u0275fac=function(i){return new(i||o)(E.LFG(Tt))},o.\u0275prov=E.Yz7({token:o,factory:function(){return function cn(){return new En((0,E.LFG)(Tt))}()},providedIn:"root"}),t})();function pn(o){return o.replace(/\/index.html$/,"")}function Po(o,t){t=encodeURIComponent(t);for(const c of o.split(";")){const i=c.indexOf("="),[h,w]=-1==i?[c,""]:[c.slice(0,i),c.slice(i+1)];if(h.trim()===t)return decodeURIComponent(w)}return null}class mr{constructor(t,c,i,h){this.$implicit=t,this.ngForOf=c,this.index=i,this.count=h}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let _c=(()=>{var o;class t{set ngForOf(i){this._ngForOf=i,this._ngForOfDirty=!0}set ngForTrackBy(i){this._trackByFn=i}get ngForTrackBy(){return this._trackByFn}constructor(i,h,w){this._viewContainer=i,this._template=h,this._differs=w,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(i){i&&(this._template=i)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const i=this._ngForOf;!this._differ&&i&&(this._differ=this._differs.find(i).create(this.ngForTrackBy))}if(this._differ){const i=this._differ.diff(this._ngForOf);i&&this._applyChanges(i)}}_applyChanges(i){const h=this._viewContainer;i.forEachOperation((w,I,N)=>{if(null==w.previousIndex)h.createEmbeddedView(this._template,new mr(w.item,this._ngForOf,-1,-1),null===N?void 0:N);else if(null==N)h.remove(null===I?void 0:I);else if(null!==I){const Y=h.get(I);h.move(Y,N),Ro(Y,w)}});for(let w=0,I=h.length;w<I;w++){const Y=h.get(w).context;Y.index=w,Y.count=I,Y.ngForOf=this._ngForOf}i.forEachIdentityChange(w=>{Ro(h.get(w.currentIndex),w)})}static ngTemplateContextGuard(i,h){return!0}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(E.s_b),E.Y36(E.Rgc),E.Y36(E.ZZ4))},o.\u0275dir=E.lG2({type:o,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),t})();function Ro(o,t){o.context.$implicit=t.item}let La=(()=>{var o;class t{constructor(i,h){this._viewContainer=i,this._context=new zl,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=h}set ngIf(i){this._context.$implicit=this._context.ngIf=i,this._updateView()}set ngIfThen(i){Jt("ngIfThen",i),this._thenTemplateRef=i,this._thenViewRef=null,this._updateView()}set ngIfElse(i){Jt("ngIfElse",i),this._elseTemplateRef=i,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(i,h){return!0}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(E.s_b),E.Y36(E.Rgc))},o.\u0275dir=E.lG2({type:o,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),t})();class zl{constructor(){this.$implicit=null,this.ngIf=null}}function Jt(o,t){if(t&&!t.createEmbeddedView)throw new Error(`${o} must be a TemplateRef, but received '${(0,E.AaK)(t)}'.`)}class _e{createSubscription(t,c){return(0,E.rg0)(()=>t.subscribe({next:c,error:i=>{throw i}}))}dispose(t){(0,E.rg0)(()=>t.unsubscribe())}}class st{createSubscription(t,c){return t.then(c,i=>{throw i})}dispose(t){}}const Et=new st,qe=new _e;let Vt=(()=>{var o;class t{constructor(i){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=i}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(i){return this._obj?i!==this._obj?(this._dispose(),this.transform(i)):this._latestValue:(i&&this._subscribe(i),this._latestValue)}_subscribe(i){this._obj=i,this._strategy=this._selectStrategy(i),this._subscription=this._strategy.createSubscription(i,h=>this._updateLatestValue(i,h))}_selectStrategy(i){if((0,E.QGY)(i))return Et;if((0,E.F4k)(i))return qe;throw function Yo(o,t){return new E.vHH(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(i,h){i===this._obj&&(this._latestValue=h,this._ref.markForCheck())}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(E.sBO,16))},o.\u0275pipe=E.Yjl({name:"async",type:o,pure:!1,standalone:!0}),t})(),gr=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({}),t})();const Zs="browser";function Fo(o){return"server"===o}let No=(()=>{var o;class t{}return(o=t).\u0275prov=(0,E.Yz7)({token:o,providedIn:"root",factory:()=>new Fa((0,E.LFG)(Ye),window)}),t})();class Fa{constructor(t,c){this.document=t,this.window=c,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const c=function kh(o,t){const c=o.getElementById(t)||o.getElementsByName(t)[0];if(c)return c;if("function"==typeof o.createTreeWalker&&o.body&&"function"==typeof o.body.attachShadow){const i=o.createTreeWalker(o.body,NodeFilter.SHOW_ELEMENT);let h=i.currentNode;for(;h;){const w=h.shadowRoot;if(w){const I=w.getElementById(t)||w.querySelector(`[name="${t}"]`);if(I)return I}h=i.nextNode()}}return null}(this.document,t);c&&(this.scrollToElement(c),c.focus())}setHistoryScrollRestoration(t){this.supportsScrolling()&&(this.window.history.scrollRestoration=t)}scrollToElement(t){const c=t.getBoundingClientRect(),i=c.left+this.window.pageXOffset,h=c.top+this.window.pageYOffset,w=this.offset();this.window.scrollTo(i-w[0],h-w[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class Ms{}class wc extends ue{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Cd extends wc{static makeCurrent(){!function p(o){Be||(Be=o)}(new Cd)}onAndCancel(t,c,i){return t.addEventListener(c,i),()=>{t.removeEventListener(c,i)}}dispatchEvent(t,c){t.dispatchEvent(c)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,c){return(c=c||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,c){return"window"===c?window:"document"===c?t:"body"===c?t.body:null}getBaseHref(t){const c=function Ec(){return ls=ls||document.querySelector("base"),ls?ls.getAttribute("href"):null}();return null==c?null:function bu(o){bo=bo||document.createElement("a"),bo.setAttribute("href",o);const t=bo.pathname;return"/"===t.charAt(0)?t:`/${t}`}(c)}resetBaseElement(){ls=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Po(document.cookie,t)}}let bo,ls=null,Hi=(()=>{var o;class t{build(){return new XMLHttpRequest}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();const Cc=new E.OlP("EventManagerPlugins");let _l=(()=>{var o;class t{constructor(i,h){this._zone=h,this._eventNameToPlugin=new Map,i.forEach(w=>{w.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,h,w){return this._findPluginFor(h).addEventListener(i,h,w)}getZone(){return this._zone}_findPluginFor(i){let h=this._eventNameToPlugin.get(i);if(h)return h;if(h=this._plugins.find(I=>I.supports(i)),!h)throw new E.vHH(5101,!1);return this._eventNameToPlugin.set(i,h),h}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Cc),E.LFG(E.R0b))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();class Ur{constructor(t){this._doc=t}}const Dd="ng-app-id";let Dc=(()=>{var o;class t{constructor(i,h,w,I={}){this.doc=i,this.appId=h,this.nonce=w,this.platformId=I,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Fo(I),this.resetHostNodes()}addStyles(i){for(const h of i)1===this.changeUsageCount(h,1)&&this.onStyleAdded(h)}removeStyles(i){for(const h of i)this.changeUsageCount(h,-1)<=0&&this.onStyleRemoved(h)}ngOnDestroy(){const i=this.styleNodesInDOM;i&&(i.forEach(h=>h.remove()),i.clear());for(const h of this.getAllStyles())this.onStyleRemoved(h);this.resetHostNodes()}addHost(i){this.hostNodes.add(i);for(const h of this.getAllStyles())this.addStyleToHost(i,h)}removeHost(i){this.hostNodes.delete(i)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(i){for(const h of this.hostNodes)this.addStyleToHost(h,i)}onStyleRemoved(i){const h=this.styleRef;h.get(i)?.elements?.forEach(w=>w.remove()),h.delete(i)}collectServerRenderedStyles(){const i=this.doc.head?.querySelectorAll(`style[${Dd}="${this.appId}"]`);if(i?.length){const h=new Map;return i.forEach(w=>{null!=w.textContent&&h.set(w.textContent,w)}),h}return null}changeUsageCount(i,h){const w=this.styleRef;if(w.has(i)){const I=w.get(i);return I.usage+=h,I.usage}return w.set(i,{usage:h,elements:[]}),h}getStyleElement(i,h){const w=this.styleNodesInDOM,I=w?.get(h);if(I?.parentNode===i)return w.delete(h),I.removeAttribute(Dd),I;{const N=this.doc.createElement("style");return this.nonce&&N.setAttribute("nonce",this.nonce),N.textContent=h,this.platformIsServer&&N.setAttribute(Dd,this.appId),N}}addStyleToHost(i,h){const w=this.getStyleElement(i,h);i.appendChild(w);const I=this.styleRef,N=I.get(h)?.elements;N?N.push(w):I.set(h,{elements:[w],usage:1})}resetHostNodes(){const i=this.hostNodes;i.clear(),i.add(this.doc.head)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ye),E.LFG(E.AFp),E.LFG(E.Ojb,8),E.LFG(E.Lbi))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();const xo={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},wo=/%COMP%/g,Sc=new E.OlP("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function Ic(o,t){return t.map(c=>c.replace(wo,o))}let tn=(()=>{var o;class t{constructor(i,h,w,I,N,Y,J,xe=null){this.eventManager=i,this.sharedStylesHost=h,this.appId=w,this.removeStylesOnCompDestroy=I,this.doc=N,this.platformId=Y,this.ngZone=J,this.nonce=xe,this.rendererByCompId=new Map,this.platformIsServer=Fo(Y),this.defaultRenderer=new cs(i,N,J,this.platformIsServer)}createRenderer(i,h){if(!i||!h)return this.defaultRenderer;this.platformIsServer&&h.encapsulation===E.ifc.ShadowDom&&(h={...h,encapsulation:E.ifc.Emulated});const w=this.getOrCreateRenderer(i,h);return w instanceof Tu?w.applyToHost(i):w instanceof Hl&&w.applyStyles(),w}getOrCreateRenderer(i,h){const w=this.rendererByCompId;let I=w.get(h.id);if(!I){const N=this.doc,Y=this.ngZone,J=this.eventManager,xe=this.sharedStylesHost,Ae=this.removeStylesOnCompDestroy,It=this.platformIsServer;switch(h.encapsulation){case E.ifc.Emulated:I=new Tu(J,xe,h,this.appId,Ae,N,Y,It);break;case E.ifc.ShadowDom:return new eo(J,xe,i,h,N,Y,this.nonce,It);default:I=new Hl(J,xe,h,Ae,N,Y,It)}w.set(h.id,I)}return I}ngOnDestroy(){this.rendererByCompId.clear()}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(_l),E.LFG(Dc),E.LFG(E.AFp),E.LFG(Sc),E.LFG(Ye),E.LFG(E.Lbi),E.LFG(E.R0b),E.LFG(E.Ojb))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();class cs{constructor(t,c,i,h){this.eventManager=t,this.doc=c,this.ngZone=i,this.platformIsServer=h,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,c){return c?this.doc.createElementNS(xo[c]||c,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,c){(Du(t)?t.content:t).appendChild(c)}insertBefore(t,c,i){t&&(Du(t)?t.content:t).insertBefore(c,i)}removeChild(t,c){t&&t.removeChild(c)}selectRootElement(t,c){let i="string"==typeof t?this.doc.querySelector(t):t;if(!i)throw new E.vHH(-5104,!1);return c||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,c,i,h){if(h){c=h+":"+c;const w=xo[h];w?t.setAttributeNS(w,c,i):t.setAttribute(c,i)}else t.setAttribute(c,i)}removeAttribute(t,c,i){if(i){const h=xo[i];h?t.removeAttributeNS(h,c):t.removeAttribute(`${i}:${c}`)}else t.removeAttribute(c)}addClass(t,c){t.classList.add(c)}removeClass(t,c){t.classList.remove(c)}setStyle(t,c,i,h){h&(E.JOm.DashCase|E.JOm.Important)?t.style.setProperty(c,i,h&E.JOm.Important?"important":""):t.style[c]=i}removeStyle(t,c,i){i&E.JOm.DashCase?t.style.removeProperty(c):t.style[c]=""}setProperty(t,c,i){t[c]=i}setValue(t,c){t.nodeValue=c}listen(t,c,i){if("string"==typeof t&&!(t=it().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${c}`);return this.eventManager.addEventListener(t,c,this.decoratePreventDefault(i))}decoratePreventDefault(t){return c=>{if("__ngUnwrap__"===c)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(c)):t(c))&&c.preventDefault()}}}function Du(o){return"TEMPLATE"===o.tagName&&void 0!==o.content}class eo extends cs{constructor(t,c,i,h,w,I,N,Y){super(t,w,I,Y),this.sharedStylesHost=c,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const J=Ic(h.id,h.styles);for(const xe of J){const Ae=document.createElement("style");N&&Ae.setAttribute("nonce",N),Ae.textContent=xe,this.shadowRoot.appendChild(Ae)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,c){return super.appendChild(this.nodeOrShadowRoot(t),c)}insertBefore(t,c,i){return super.insertBefore(this.nodeOrShadowRoot(t),c,i)}removeChild(t,c){return super.removeChild(this.nodeOrShadowRoot(t),c)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Hl extends cs{constructor(t,c,i,h,w,I,N,Y){super(t,w,I,N),this.sharedStylesHost=c,this.removeStylesOnCompDestroy=h,this.styles=Y?Ic(Y,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class Tu extends Hl{constructor(t,c,i,h,w,I,N,Y){const J=h+"-"+i.id;super(t,c,i,w,I,N,Y,J),this.contentAttr=function wu(o){return"_ngcontent-%COMP%".replace(wo,o)}(J),this.hostAttr=function Eu(o){return"_nghost-%COMP%".replace(wo,o)}(J)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,c){const i=super.createElement(t,c);return super.setAttribute(i,this.contentAttr,""),i}}let Td=(()=>{var o;class t extends Ur{constructor(i){super(i)}supports(i){return!0}addEventListener(i,h,w){return i.addEventListener(h,w,!1),()=>this.removeEventListener(i,h,w)}removeEventListener(i,h,w){return i.removeEventListener(h,w)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ye))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();const ha=["alt","control","meta","shift"],ap={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Md={alt:o=>o.altKey,control:o=>o.ctrlKey,meta:o=>o.metaKey,shift:o=>o.shiftKey};let Ac=(()=>{var o;class t extends Ur{constructor(i){super(i)}supports(i){return null!=t.parseEventName(i)}addEventListener(i,h,w){const I=t.parseEventName(h),N=t.eventCallback(I.fullKey,w,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>it().onAndCancel(i,I.domEventName,N))}static parseEventName(i){const h=i.toLowerCase().split("."),w=h.shift();if(0===h.length||"keydown"!==w&&"keyup"!==w)return null;const I=t._normalizeKey(h.pop());let N="",Y=h.indexOf("code");if(Y>-1&&(h.splice(Y,1),N="code."),ha.forEach(xe=>{const Ae=h.indexOf(xe);Ae>-1&&(h.splice(Ae,1),N+=xe+".")}),N+=I,0!=h.length||0===I.length)return null;const J={};return J.domEventName=w,J.fullKey=N,J}static matchEventFullKeyCode(i,h){let w=ap[i.key]||i.key,I="";return h.indexOf("code.")>-1&&(w=i.code,I="code."),!(null==w||!w)&&(w=w.toLowerCase()," "===w?w="space":"."===w&&(w="dot"),ha.forEach(N=>{N!==w&&(0,Md[N])(i)&&(I+=N+".")}),I+=w,I===h)}static eventCallback(i,h,w){return I=>{t.matchEventFullKeyCode(I,i)&&w.runGuarded(()=>h(I))}}static _normalizeKey(i){return"esc"===i?"escape":i}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ye))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();const Ba=(0,E.eFA)(E._c5,"browser",[{provide:E.Lbi,useValue:Zs},{provide:E.g9A,useValue:function Sd(){Cd.makeCurrent()},multi:!0},{provide:Ye,useFactory:function Zr(){return(0,E.RDi)(document),document},deps:[]}]),Ko=new E.OlP(""),Rc=[{provide:E.rWj,useClass:class vi{addToWindow(t){E.dqk.getAngularTestability=(i,h=!0)=>{const w=t.findTestabilityInTree(i,h);if(null==w)throw new E.vHH(5103,!1);return w},E.dqk.getAllAngularTestabilities=()=>t.getAllTestabilities(),E.dqk.getAllAngularRootElements=()=>t.getAllRootElements(),E.dqk.frameworkStabilizers||(E.dqk.frameworkStabilizers=[]),E.dqk.frameworkStabilizers.push(i=>{const h=E.dqk.getAllAngularTestabilities();let w=h.length,I=!1;const N=function(Y){I=I||Y,w--,0==w&&i(I)};h.forEach(Y=>{Y.whenStable(N)})})}findTestabilityInTree(t,c,i){return null==c?null:t.getTestability(c)??(i?it().isShadowRoot(c)?this.findTestabilityInTree(t,c.host,!0):this.findTestabilityInTree(t,c.parentElement,!0):null)}},deps:[]},{provide:E.lri,useClass:E.dDg,deps:[E.R0b,E.eoX,E.rWj]},{provide:E.dDg,useClass:E.dDg,deps:[E.R0b,E.eoX,E.rWj]}],Mu=[{provide:E.zSh,useValue:"root"},{provide:E.qLn,useFactory:function Id(){return new E.qLn},deps:[]},{provide:Cc,useClass:Td,multi:!0,deps:[Ye,E.R0b,E.Lbi]},{provide:Cc,useClass:Ac,multi:!0,deps:[Ye]},tn,Dc,_l,{provide:E.FYo,useExisting:tn},{provide:Ms,useClass:Hi,deps:[]},[]];let Ad=(()=>{var o;class t{constructor(i){}static withServerTransition(i){return{ngModule:t,providers:[{provide:E.AFp,useValue:i.appId}]}}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ko,12))},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({providers:[...Mu,...Rc],imports:[gr,E.hGG]}),t})(),jh=(()=>{var o;class t{constructor(i){this._doc=i}getTitle(){return this._doc.title}setTitle(i){this._doc.title=i||""}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ye))},o.\u0275prov=E.Yz7({token:o,factory:function(i){let h=null;return h=i?new i:function fa(){return new jh((0,E.LFG)(Ye))}(),h},providedIn:"root"}),t})();typeof window<"u"&&window;var Vo=te(5592),us=te(4674),ar=te(9666),Fn=te(2096),Eo=te(5619);const{isArray:Va}=Array,{getPrototypeOf:_,prototype:a,keys:f}=Object;function v(o){if(1===o.length){const t=o[0];if(Va(t))return{args:t,keys:null};if(function C(o){return o&&"object"==typeof o&&_(o)===a}(t)){const c=f(t);return{args:c.map(i=>t[i]),keys:c}}}return{args:o,keys:null}}var M=te(2737),O=te(7398);const{isArray:k}=Array;function $(o){return(0,O.U)(t=>function B(o,t){return k(t)?o(...t):o(t)}(o,t))}var j=te(9940);function q(o,t){return o.reduce((c,i,h)=>(c[i]=t[h],c),{})}var ee=te(8251),se=te(7103);function le(...o){const t=(0,j.yG)(o),c=(0,j.jO)(o),{args:i,keys:h}=v(o);if(0===i.length)return(0,ar.D)([],t);const w=new Vo.y(function ae(o,t,c=M.y){return i=>{ce(t,()=>{const{length:h}=o,w=new Array(h);let I=h,N=h;for(let Y=0;Y<h;Y++)ce(t,()=>{const J=(0,ar.D)(o[Y],t);let xe=!1;J.subscribe((0,ee.x)(i,Ae=>{w[Y]=Ae,xe||(xe=!0,N--),N||i.next(c(w.slice()))},()=>{--I||i.complete()}))},i)},i)}}(i,t,h?I=>q(h,I):M.y));return c?w.pipe($(c)):w}function ce(o,t,c){o?(0,se.f)(c,o,t):t()}const oe=(0,te(2306).d)(o=>function(){o(this),this.name="EmptyError",this.message="no elements in sequence"});var fe=te(7537);function Te(...o){return function pe(){return(0,fe.J)(1)}()((0,ar.D)(o,(0,j.yG)(o)))}var De=te(4829);function Me(o){return new Vo.y(t=>{(0,De.Xf)(o()).subscribe(t)})}var ze=te(8407);function Oe(o,t){const c=(0,us.m)(o)?o:()=>o,i=h=>h.error(c());return new Vo.y(t?h=>t.schedule(i,0,h):i)}var Xe=te(6232),At=te(7394),Ve=te(9360);function ht(){return(0,Ve.e)((o,t)=>{let c=null;o._refCount++;const i=(0,ee.x)(t,void 0,void 0,void 0,()=>{if(!o||o._refCount<=0||0<--o._refCount)return void(c=null);const h=o._connection,w=c;c=null,h&&(!w||h===w)&&h.unsubscribe(),t.unsubscribe()});o.subscribe(i),i.closed||(c=o.connect())})}class tt extends Vo.y{constructor(t,c){super(),this.source=t,this.subjectFactory=c,this._subject=null,this._refCount=0,this._connection=null,(0,Ve.A)(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new At.w0;const c=this.getSubject();t.add(this.source.subscribe((0,ee.x)(c,void 0,()=>{this._teardown(),c.complete()},i=>{this._teardown(),c.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=At.w0.EMPTY)}return t}refCount(){return ht()(this)}}var _t=te(8645),He=te(4664),ct=te(8180);function Lt(...o){const t=(0,j.yG)(o);return(0,Ve.e)((c,i)=>{(t?Te(o,c,t):Te(o,c)).subscribe(i)})}var ft=te(2181),Ct=te(1631);function vn(o){return(0,Ve.e)((t,c)=>{let i=!1;t.subscribe((0,ee.x)(c,h=>{i=!0,c.next(h)},()=>{i||c.next(o),c.complete()}))})}function Rn(o=sn){return(0,Ve.e)((t,c)=>{let i=!1;t.subscribe((0,ee.x)(c,h=>{i=!0,c.next(h)},()=>i?c.complete():c.error(o())))})}function sn(){return new oe}function bn(o,t){const c=arguments.length>=2;return i=>i.pipe(o?(0,ft.h)((h,w)=>o(h,w,i)):M.y,(0,ct.q)(1),c?vn(t):Rn(()=>new oe))}var Kn=te(6328);function Mn(o,t,c){const i=(0,us.m)(o)||t||c?{next:o,error:t,complete:c}:o;return i?(0,Ve.e)((h,w)=>{var I;null===(I=i.subscribe)||void 0===I||I.call(i);let N=!0;h.subscribe((0,ee.x)(w,Y=>{var J;null===(J=i.next)||void 0===J||J.call(i,Y),w.next(Y)},()=>{var Y;N=!1,null===(Y=i.complete)||void 0===Y||Y.call(i),w.complete()},Y=>{var J;N=!1,null===(J=i.error)||void 0===J||J.call(i,Y),w.error(Y)},()=>{var Y,J;N&&(null===(Y=i.unsubscribe)||void 0===Y||Y.call(i)),null===(J=i.finalize)||void 0===J||J.call(i)}))}):M.y}var an=te(6306),Ai=te(6699);function ii(o){return o<=0?()=>Xe.E:(0,Ve.e)((t,c)=>{let i=[];t.subscribe((0,ee.x)(c,h=>{i.push(h),o<i.length&&i.shift()},()=>{for(const h of i)c.next(h);c.complete()},void 0,()=>{i=null}))})}function Sr(o){return(0,Ve.e)((t,c)=>{try{t.subscribe(c)}finally{c.add(o)}})}var $r=te(9773);const zn="primary",Co=Symbol("RouteTitle");class Li{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const c=this.params[t];return Array.isArray(c)?c[0]:c}return null}getAll(t){if(this.has(t)){const c=this.params[t];return Array.isArray(c)?c:[c]}return[]}get keys(){return Object.keys(this.params)}}function gi(o){return new Li(o)}function _i(o,t,c){const i=c.path.split("/");if(i.length>o.length||"full"===c.pathMatch&&(t.hasChildren()||i.length<o.length))return null;const h={};for(let w=0;w<i.length;w++){const I=i[w],N=o[w];if(I.startsWith(":"))h[I.substring(1)]=N;else if(I!==N.path)return null}return{consumed:o.slice(0,i.length),posParams:h}}function lr(o,t){const c=o?Object.keys(o):void 0,i=t?Object.keys(t):void 0;if(!c||!i||c.length!=i.length)return!1;let h;for(let w=0;w<c.length;w++)if(h=c[w],!Pi(o[h],t[h]))return!1;return!0}function Pi(o,t){if(Array.isArray(o)&&Array.isArray(t)){if(o.length!==t.length)return!1;const c=[...o].sort(),i=[...t].sort();return c.every((h,w)=>i[w]===h)}return o===t}function Qo(o){return o.length>0?o[o.length-1]:null}function Xs(o){return function Od(o){return!!o&&(o instanceof Vo.y||(0,us.m)(o.lift)&&(0,us.m)(o.subscribe))}(o)?o:(0,E.QGY)(o)?(0,ar.D)(Promise.resolve(o)):(0,Fn.of)(o)}const Oc={exact:function ql(o,t,c){if(!ao(o.segments,t.segments)||!Zh(o.segments,t.segments,c)||o.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!o.children[i]||!ql(o.children[i],t.children[i],c))return!1;return!0},subset:Ks},Su={exact:function Zl(o,t){return lr(o,t)},subset:function Wh(o,t){return Object.keys(t).length<=Object.keys(o).length&&Object.keys(t).every(c=>Pi(o[c],t[c]))},ignored:()=>!0};function Ua(o,t,c){return Oc[c.paths](o.root,t.root,c.matrixParams)&&Su[c.queryParams](o.queryParams,t.queryParams)&&!("exact"===c.fragment&&o.fragment!==t.fragment)}function Ks(o,t,c){return kd(o,t,t.segments,c)}function kd(o,t,c,i){if(o.segments.length>c.length){const h=o.segments.slice(0,c.length);return!(!ao(h,c)||t.hasChildren()||!Zh(h,c,i))}if(o.segments.length===c.length){if(!ao(o.segments,c)||!Zh(o.segments,c,i))return!1;for(const h in t.children)if(!o.children[h]||!Ks(o.children[h],t.children[h],i))return!1;return!0}{const h=c.slice(0,o.segments.length),w=c.slice(o.segments.length);return!!(ao(o.segments,h)&&Zh(o.segments,h,i)&&o.children[zn])&&kd(o.children[zn],t,w,i)}}function Zh(o,t,c){return t.every((i,h)=>Su[c](o[h].parameters,i.parameters))}class Er{constructor(t=new er([],{}),c={},i=null){this.root=t,this.queryParams=c,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=gi(this.queryParams)),this._queryParamMap}toString(){return Lc.serialize(this)}}class er{constructor(t,c){this.segments=t,this.children=c,this.parent=null,Object.values(c).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return qh(this)}}class ja{constructor(t,c){this.path=t,this.parameters=c}get parameterMap(){return this._parameterMap||(this._parameterMap=gi(this.parameters)),this._parameterMap}toString(){return $a(this)}}function ao(o,t){return o.length===t.length&&o.every((c,i)=>c.path===t[i].path)}let Yl=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:function(){return new Rs},providedIn:"root"}),t})();class Rs{parse(t){const c=new Ga(t);return new Er(c.parseRootSegment(),c.parseQueryParams(),c.parseFragment())}serialize(t){const c=`/${Yh(t.root,!0)}`,i=function Fc(o){const t=Object.keys(o).map(c=>{const i=o[c];return Array.isArray(i)?i.map(h=>`${Ym(c)}=${Ym(h)}`).join("&"):`${Ym(c)}=${Ym(i)}`}).filter(c=>!!c);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${c}${i}${"string"==typeof t.fragment?`#${function Js(o){return encodeURI(o)}(t.fragment)}`:""}`}}const Lc=new Rs;function qh(o){return o.segments.map(t=>$a(t)).join("/")}function Yh(o,t){if(!o.hasChildren())return qh(o);if(t){const c=o.children[zn]?Yh(o.children[zn],!1):"",i=[];return Object.entries(o.children).forEach(([h,w])=>{h!==zn&&i.push(`${h}:${Yh(w,!1)}`)}),i.length>0?`${c}(${i.join("//")})`:c}{const c=function kc(o,t){let c=[];return Object.entries(o.children).forEach(([i,h])=>{i===zn&&(c=c.concat(t(h,i)))}),Object.entries(o.children).forEach(([i,h])=>{i!==zn&&(c=c.concat(t(h,i)))}),c}(o,(i,h)=>h===zn?[Yh(o.children[zn],!1)]:[`${h}:${Yh(i,!1)}`]);return 1===Object.keys(o.children).length&&null!=o.children[zn]?`${qh(o)}/${c[0]}`:`${qh(o)}/(${c.join("//")})`}}function O_(o){return encodeURIComponent(o).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ym(o){return O_(o).replace(/%3B/gi,";")}function Iu(o){return O_(o).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Qs(o){return decodeURIComponent(o)}function Ld(o){return Qs(o.replace(/\+/g,"%20"))}function $a(o){return`${Iu(o.path)}${function Ha(o){return Object.keys(o).map(t=>`;${Iu(t)}=${Iu(o[t])}`).join("")}(o.parameters)}`}const Nc=/^[^\/()?;#]+/;function Xl(o){const t=o.match(Nc);return t?t[0]:""}const Nv=/^[^\/()?;=#]+/,Xm=/^[^=?&#]+/,Km=/^[^&#]+/;class Ga{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new er([],{}):new er([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let c={};this.peekStartsWith("/(")&&(this.capture("/"),c=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(c).length>0)&&(i[zn]=new er(t,c)),i}parseSegment(){const t=Xl(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new E.vHH(4009,!1);return this.capture(t),new ja(Qs(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const c=function Bv(o){const t=o.match(Nv);return t?t[0]:""}(this.remaining);if(!c)return;this.capture(c);let i="";if(this.consumeOptional("=")){const h=Xl(this.remaining);h&&(i=h,this.capture(i))}t[Qs(c)]=Qs(i)}parseQueryParam(t){const c=function pp(o){const t=o.match(Xm);return t?t[0]:""}(this.remaining);if(!c)return;this.capture(c);let i="";if(this.consumeOptional("=")){const I=function Xh(o){const t=o.match(Km);return t?t[0]:""}(this.remaining);I&&(i=I,this.capture(i))}const h=Ld(c),w=Ld(i);if(t.hasOwnProperty(h)){let I=t[h];Array.isArray(I)||(I=[I],t[h]=I),I.push(w)}else t[h]=w}parseParens(t){const c={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=Xl(this.remaining),h=this.remaining[i.length];if("/"!==h&&")"!==h&&";"!==h)throw new E.vHH(4010,!1);let w;i.indexOf(":")>-1?(w=i.slice(0,i.indexOf(":")),this.capture(w),this.capture(":")):t&&(w=zn);const I=this.parseChildren();c[w]=1===Object.keys(I).length?I[zn]:new er([],I),this.consumeOptional("//")}return c}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new E.vHH(4011,!1)}}function Kh(o){return o.segments.length>0?new er([],{[zn]:o}):o}function k_(o){const t={};for(const i of Object.keys(o.children)){const w=k_(o.children[i]);if(i===zn&&0===w.segments.length&&w.hasChildren())for(const[I,N]of Object.entries(w.children))t[I]=N;else(w.segments.length>0||w.hasChildren())&&(t[i]=w)}return function Ar(o){if(1===o.numberOfChildren&&o.children[zn]){const t=o.children[zn];return new er(o.segments.concat(t.segments),t.children)}return o}(new er(o.segments,t))}function mn(o){return o instanceof Er}function Fd(o){let t;const h=Kh(function c(w){const I={};for(const Y of w.children){const J=c(Y);I[Y.outlet]=J}const N=new er(w.url,I);return w===o&&(t=N),N}(o.root));return t??h}function ds(o,t,c,i){let h=o;for(;h.parent;)h=h.parent;if(0===t.length)return Uo(h,h,h,c,i);const w=function Nd(o){if("string"==typeof o[0]&&1===o.length&&"/"===o[0])return new Au(!0,0,o);let t=0,c=!1;const i=o.reduce((h,w,I)=>{if("object"==typeof w&&null!=w){if(w.outlets){const N={};return Object.entries(w.outlets).forEach(([Y,J])=>{N[Y]="string"==typeof J?J.split("/"):J}),[...h,{outlets:N}]}if(w.segmentPath)return[...h,w.segmentPath]}return"string"!=typeof w?[...h,w]:0===I?(w.split("/").forEach((N,Y)=>{0==Y&&"."===N||(0==Y&&""===N?c=!0:".."===N?t++:""!=N&&h.push(N))}),h):[...h,w]},[]);return new Au(c,t,i)}(t);if(w.toRoot())return Uo(h,h,new er([],{}),c,i);const I=function L_(o,t,c){if(o.isAbsolute)return new vl(t,!0,0);if(!c)return new vl(t,!1,NaN);if(null===c.parent)return new vl(c,!0,0);const i=Jh(o.commands[0])?0:1;return function gp(o,t,c){let i=o,h=t,w=c;for(;w>h;){if(w-=h,i=i.parent,!i)throw new E.vHH(4005,!1);h=i.segments.length}return new vl(i,!1,h-w)}(c,c.segments.length-1+i,o.numberOfDoubleDots)}(w,h,o),N=I.processChildren?Bc(I.segmentGroup,I.index,w.commands):Jm(I.segmentGroup,I.index,w.commands);return Uo(h,I.segmentGroup,N,c,i)}function Jh(o){return"object"==typeof o&&null!=o&&!o.outlets&&!o.segmentPath}function Za(o){return"object"==typeof o&&null!=o&&o.outlets}function Uo(o,t,c,i,h){let I,w={};i&&Object.entries(i).forEach(([Y,J])=>{w[Y]=Array.isArray(J)?J.map(xe=>`${xe}`):`${J}`}),I=o===t?c:mp(o,t,c);const N=Kh(k_(I));return new Er(N,w,h)}function mp(o,t,c){const i={};return Object.entries(o.children).forEach(([h,w])=>{i[h]=w===t?c:mp(w,t,c)}),new er(o.segments,i)}class Au{constructor(t,c,i){if(this.isAbsolute=t,this.numberOfDoubleDots=c,this.commands=i,t&&i.length>0&&Jh(i[0]))throw new E.vHH(4003,!1);const h=i.find(Za);if(h&&h!==Qo(i))throw new E.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class vl{constructor(t,c,i){this.segmentGroup=t,this.processChildren=c,this.index=i}}function Jm(o,t,c){if(o||(o=new er([],{})),0===o.segments.length&&o.hasChildren())return Bc(o,t,c);const i=function _p(o,t,c){let i=0,h=t;const w={match:!1,pathIndex:0,commandIndex:0};for(;h<o.segments.length;){if(i>=c.length)return w;const I=o.segments[h],N=c[i];if(Za(N))break;const Y=`${N}`,J=i<c.length-1?c[i+1]:null;if(h>0&&void 0===Y)break;if(Y&&J&&"object"==typeof J&&void 0===J.outlets){if(!qa(Y,J,I))return w;i+=2}else{if(!qa(Y,{},I))return w;i++}h++}return{match:!0,pathIndex:h,commandIndex:i}}(o,t,c),h=c.slice(i.commandIndex);if(i.match&&i.pathIndex<o.segments.length){const w=new er(o.segments.slice(0,i.pathIndex),{});return w.children[zn]=new er(o.segments.slice(i.pathIndex),o.children),Bc(w,0,h)}return i.match&&0===h.length?new er(o.segments,{}):i.match&&!o.hasChildren()?yp(o,t,c):i.match?Bc(o,0,h):yp(o,t,c)}function Bc(o,t,c){if(0===c.length)return new er(o.segments,{});{const i=function F_(o){return Za(o[0])?o[0].outlets:{[zn]:o}}(c),h={};if(Object.keys(i).some(w=>w!==zn)&&o.children[zn]&&1===o.numberOfChildren&&0===o.children[zn].segments.length){const w=Bc(o.children[zn],t,c);return new er(o.segments,w.children)}return Object.entries(i).forEach(([w,I])=>{"string"==typeof I&&(I=[I]),null!==I&&(h[w]=Jm(o.children[w],t,I))}),Object.entries(o.children).forEach(([w,I])=>{void 0===i[w]&&(h[w]=I)}),new er(o.segments,h)}}function yp(o,t,c){const i=o.segments.slice(0,t);let h=0;for(;h<c.length;){const w=c[h];if(Za(w)){const Y=Bd(w.outlets);return new er(i,Y)}if(0===h&&Jh(c[0])){i.push(new ja(o.segments[t].path,zd(c[0]))),h++;continue}const I=Za(w)?w.outlets[zn]:`${w}`,N=h<c.length-1?c[h+1]:null;I&&N&&Jh(N)?(i.push(new ja(I,zd(N))),h+=2):(i.push(new ja(I,{})),h++)}return new er(i,{})}function Bd(o){const t={};return Object.entries(o).forEach(([c,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(t[c]=yp(new er([],{}),0,i))}),t}function zd(o){const t={};return Object.entries(o).forEach(([c,i])=>t[c]=`${i}`),t}function qa(o,t,c){return o==c.path&&lr(t,c.parameters)}const Vd="imperative";class Ya{constructor(t,c){this.id=t,this.url=c}}class zc extends Ya{constructor(t,c,i="imperative",h=null){super(t,c),this.type=0,this.navigationTrigger=i,this.restoredState=h}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Os extends Ya{constructor(t,c,i){super(t,c),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class es extends Ya{constructor(t,c,i,h){super(t,c),this.reason=i,this.code=h,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Kl extends Ya{constructor(t,c,i,h){super(t,c),this.reason=i,this.code=h,this.type=16}}class qr extends Ya{constructor(t,c,i,h){super(t,c),this.error=i,this.target=h,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class ma extends Ya{constructor(t,c,i,h){super(t,c),this.urlAfterRedirects=i,this.state=h,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class N_ extends Ya{constructor(t,c,i,h){super(t,c),this.urlAfterRedirects=i,this.state=h,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Fr extends Ya{constructor(t,c,i,h,w){super(t,c),this.urlAfterRedirects=i,this.state=h,this.shouldActivate=w,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class zv extends Ya{constructor(t,c,i,h){super(t,c),this.urlAfterRedirects=i,this.state=h,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class vp extends Ya{constructor(t,c,i,h){super(t,c),this.urlAfterRedirects=i,this.state=h,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Xa{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class bp{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class xp{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Qm{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class eg{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Vc{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Uc{constructor(t,c,i){this.routerEvent=t,this.position=c,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Qh{}class ef{constructor(t){this.url=t}}class Ep{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new jc,this.attachRef=null}}let jc=(()=>{var o;class t{constructor(){this.contexts=new Map}onChildOutletCreated(i,h){const w=this.getOrCreateContext(i);w.outlet=h,this.contexts.set(i,w)}onChildOutletDestroyed(i){const h=this.getContext(i);h&&(h.outlet=null,h.attachRef=null)}onOutletDeactivated(){const i=this.contexts;return this.contexts=new Map,i}onOutletReAttached(i){this.contexts=i}getOrCreateContext(i){let h=this.getContext(i);return h||(h=new Ep,this.contexts.set(i,h)),h}getContext(i){return this.contexts.get(i)||null}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();class tg{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const c=this.pathFromRoot(t);return c.length>1?c[c.length-2]:null}children(t){const c=Cp(t,this._root);return c?c.children.map(i=>i.value):[]}firstChild(t){const c=Cp(t,this._root);return c&&c.children.length>0?c.children[0].value:null}siblings(t){const c=Pu(t,this._root);return c.length<2?[]:c[c.length-2].children.map(h=>h.value).filter(h=>h!==t)}pathFromRoot(t){return Pu(t,this._root).map(c=>c.value)}}function Cp(o,t){if(o===t.value)return t;for(const c of t.children){const i=Cp(o,c);if(i)return i}return null}function Pu(o,t){if(o===t.value)return[t];for(const c of t.children){const i=Pu(o,c);if(i.length)return i.unshift(t),i}return[]}class ga{constructor(t,c){this.value=t,this.children=c}toString(){return`TreeNode(${this.value})`}}function bl(o){const t={};return o&&o.children.forEach(c=>t[c.value.outlet]=c),t}class Dp extends tg{constructor(t,c){super(t),this.snapshot=c,hs(this,t)}toString(){return this.snapshot.toString()}}function jo(o,t){const c=function ng(o,t){const I=new Nr([],{},{},"",{},zn,t,null,{});return new $c("",new ga(I,[]))}(0,t),i=new Eo.X([new ja("",{})]),h=new Eo.X({}),w=new Eo.X({}),I=new Eo.X({}),N=new Eo.X(""),Y=new Jl(i,h,I,N,w,zn,t,c.root);return Y.snapshot=c.root,new Dp(new ga(Y,[]),c)}class Jl{constructor(t,c,i,h,w,I,N,Y){this.urlSubject=t,this.paramsSubject=c,this.queryParamsSubject=i,this.fragmentSubject=h,this.dataSubject=w,this.outlet=I,this.component=N,this._futureSnapshot=Y,this.title=this.dataSubject?.pipe((0,O.U)(J=>J[Co]))??(0,Fn.of)(void 0),this.url=t,this.params=c,this.queryParams=i,this.fragment=h,this.data=w}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,O.U)(t=>gi(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,O.U)(t=>gi(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Ka(o,t="emptyOnly"){const c=o.pathFromRoot;let i=0;if("always"!==t)for(i=c.length-1;i>=1;){const h=c[i],w=c[i-1];if(h.routeConfig&&""===h.routeConfig.path)i--;else{if(w.component)break;i--}}return function Vv(o){return o.reduce((t,c)=>({params:{...t.params,...c.params},data:{...t.data,...c.data},resolve:{...c.data,...t.resolve,...c.routeConfig?.data,...c._resolvedData}}),{params:{},data:{},resolve:{}})}(c.slice(i))}class Nr{get title(){return this.data?.[Co]}constructor(t,c,i,h,w,I,N,Y,J){this.url=t,this.params=c,this.queryParams=i,this.fragment=h,this.data=w,this.outlet=I,this.component=N,this.routeConfig=Y,this._resolve=J}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=gi(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=gi(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class $c extends tg{constructor(t,c){super(c),this.url=t,hs(this,c)}toString(){return fs(this._root)}}function hs(o,t){t.value._routerState=o,t.children.forEach(c=>hs(o,c))}function fs(o){const t=o.children.length>0?` { ${o.children.map(fs).join(", ")} } `:"";return`${o.value}${t}`}function Do(o){if(o.snapshot){const t=o.snapshot,c=o._futureSnapshot;o.snapshot=c,lr(t.queryParams,c.queryParams)||o.queryParamsSubject.next(c.queryParams),t.fragment!==c.fragment&&o.fragmentSubject.next(c.fragment),lr(t.params,c.params)||o.paramsSubject.next(c.params),function Ir(o,t){if(o.length!==t.length)return!1;for(let c=0;c<o.length;++c)if(!lr(o[c],t[c]))return!1;return!0}(t.url,c.url)||o.urlSubject.next(c.url),lr(t.data,c.data)||o.dataSubject.next(c.data)}else o.snapshot=o._futureSnapshot,o.dataSubject.next(o._futureSnapshot.data)}function xl(o,t){const c=lr(o.params,t.params)&&function fp(o,t){return ao(o,t)&&o.every((c,i)=>lr(c.parameters,t[i].parameters))}(o.url,t.url);return c&&!(!o.parent!=!t.parent)&&(!o.parent||xl(o.parent,t.parent))}let tf=(()=>{var o;class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=zn,this.activateEvents=new E.vpe,this.deactivateEvents=new E.vpe,this.attachEvents=new E.vpe,this.detachEvents=new E.vpe,this.parentContexts=(0,E.f3M)(jc),this.location=(0,E.f3M)(E.s_b),this.changeDetector=(0,E.f3M)(E.sBO),this.environmentInjector=(0,E.f3M)(E.lqb),this.inputBinder=(0,E.f3M)(Ud,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(i){if(i.name){const{firstChange:h,previousValue:w}=i.name;if(h)return;this.isTrackedInParentContexts(w)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(w)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(i){return this.parentContexts.getContext(i)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const i=this.parentContexts.getContext(this.name);i?.route&&(i.attachRef?this.attach(i.attachRef,i.route):this.activateWith(i.route,i.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new E.vHH(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new E.vHH(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new E.vHH(4012,!1);this.location.detach();const i=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(i.instance),i}attach(i,h){this.activated=i,this._activatedRoute=h,this.location.insert(i.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(i.instance)}deactivate(){if(this.activated){const i=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(i)}}activateWith(i,h){if(this.isActivated)throw new E.vHH(4013,!1);this._activatedRoute=i;const w=this.location,N=i.snapshot.component,Y=this.parentContexts.getOrCreateContext(this.name).children,J=new B_(i,Y,w.injector);this.activated=w.createComponent(N,{index:w.length,injector:J,environmentInjector:h??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275dir=E.lG2({type:o,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[E.TTD]}),t})();class B_{constructor(t,c,i){this.route=t,this.childContexts=c,this.parent=i}get(t,c){return t===Jl?this.route:t===jc?this.childContexts:this.parent.get(t,c)}}const Ud=new E.OlP("");let _a=(()=>{var o;class t{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(i){this.unsubscribeFromRouteData(i),this.subscribeToRouteData(i)}unsubscribeFromRouteData(i){this.outletDataSubscriptions.get(i)?.unsubscribe(),this.outletDataSubscriptions.delete(i)}subscribeToRouteData(i){const{activatedRoute:h}=i,w=le([h.queryParams,h.params,h.data]).pipe((0,He.w)(([I,N,Y],J)=>(Y={...I,...N,...Y},0===J?(0,Fn.of)(Y):Promise.resolve(Y)))).subscribe(I=>{if(!i.isActivated||!i.activatedComponentRef||i.activatedRoute!==h||null===h.component)return void this.unsubscribeFromRouteData(i);const N=(0,E.qFp)(h.component);if(N)for(const{templateName:Y}of N.inputs)i.activatedComponentRef.setInput(Y,I[Y]);else this.unsubscribeFromRouteData(i)});this.outletDataSubscriptions.set(i,w)}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();function Ou(o,t,c){if(c&&o.shouldReuseRoute(t.value,c.value.snapshot)){const i=c.value;i._futureSnapshot=t.value;const h=function z_(o,t,c){return t.children.map(i=>{for(const h of c.children)if(o.shouldReuseRoute(i.value,h.value.snapshot))return Ou(o,i,h);return Ou(o,i)})}(o,t,c);return new ga(i,h)}{if(o.shouldAttach(t.value)){const w=o.retrieve(t.value);if(null!==w){const I=w.route;return I.value._futureSnapshot=t.value,I.children=t.children.map(N=>Ou(o,N)),I}}const i=function V_(o){return new Jl(new Eo.X(o.url),new Eo.X(o.params),new Eo.X(o.queryParams),new Eo.X(o.fragment),new Eo.X(o.data),o.outlet,o.component,o)}(t.value),h=t.children.map(w=>Ou(o,w));return new ga(i,h)}}const jd="ngNavigationCancelingError";function Tp(o,t){const{redirectTo:c,navigationBehaviorOptions:i}=mn(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,h=Ql(!1,0,t);return h.url=c,h.navigationBehaviorOptions=i,h}function Ql(o,t,c){const i=new Error("NavigationCancelingError: "+(o||""));return i[jd]=!0,i.cancellationCode=t,c&&(i.url=c),i}function $d(o){return o&&o[jd]}let ec=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275cmp=E.Xpm({type:o,selectors:[["ng-component"]],standalone:!0,features:[E.jDz],decls:1,vars:0,template:function(i,h){1&i&&E._UZ(0,"router-outlet")},dependencies:[tf],encapsulation:2}),t})();function Gd(o){const t=o.children&&o.children.map(Gd),c=t?{...o,children:t}:{...o};return!c.component&&!c.loadComponent&&(t||c.loadChildren)&&c.outlet&&c.outlet!==zn&&(c.component=ec),c}function ps(o){return o.outlet||zn}function ya(o){if(!o)return null;if(o.routeConfig?._injector)return o.routeConfig._injector;for(let t=o.parent;t;t=t.parent){const c=t.routeConfig;if(c?._loadedInjector)return c._loadedInjector;if(c?._injector)return c._injector}return null}class wl{constructor(t,c,i,h,w){this.routeReuseStrategy=t,this.futureState=c,this.currState=i,this.forwardEvent=h,this.inputBindingEnabled=w}activate(t){const c=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(c,i,t),Do(this.futureState.root),this.activateChildRoutes(c,i,t)}deactivateChildRoutes(t,c,i){const h=bl(c);t.children.forEach(w=>{const I=w.value.outlet;this.deactivateRoutes(w,h[I],i),delete h[I]}),Object.values(h).forEach(w=>{this.deactivateRouteAndItsChildren(w,i)})}deactivateRoutes(t,c,i){const h=t.value,w=c?c.value:null;if(h===w)if(h.component){const I=i.getContext(h.outlet);I&&this.deactivateChildRoutes(t,c,I.children)}else this.deactivateChildRoutes(t,c,i);else w&&this.deactivateRouteAndItsChildren(c,i)}deactivateRouteAndItsChildren(t,c){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,c):this.deactivateRouteAndOutlet(t,c)}detachAndStoreRouteSubtree(t,c){const i=c.getContext(t.value.outlet),h=i&&t.value.component?i.children:c,w=bl(t);for(const I of Object.keys(w))this.deactivateRouteAndItsChildren(w[I],h);if(i&&i.outlet){const I=i.outlet.detach(),N=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:I,route:t,contexts:N})}}deactivateRouteAndOutlet(t,c){const i=c.getContext(t.value.outlet),h=i&&t.value.component?i.children:c,w=bl(t);for(const I of Object.keys(w))this.deactivateRouteAndItsChildren(w[I],h);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(t,c,i){const h=bl(c);t.children.forEach(w=>{this.activateRoutes(w,h[w.value.outlet],i),this.forwardEvent(new Vc(w.value.snapshot))}),t.children.length&&this.forwardEvent(new Qm(t.value.snapshot))}activateRoutes(t,c,i){const h=t.value,w=c?c.value:null;if(Do(h),h===w)if(h.component){const I=i.getOrCreateContext(h.outlet);this.activateChildRoutes(t,c,I.children)}else this.activateChildRoutes(t,c,i);else if(h.component){const I=i.getOrCreateContext(h.outlet);if(this.routeReuseStrategy.shouldAttach(h.snapshot)){const N=this.routeReuseStrategy.retrieve(h.snapshot);this.routeReuseStrategy.store(h.snapshot,null),I.children.onOutletReAttached(N.contexts),I.attachRef=N.componentRef,I.route=N.route.value,I.outlet&&I.outlet.attach(N.componentRef,N.route.value),Do(N.route.value),this.activateChildRoutes(t,null,I.children)}else{const N=ya(h.snapshot);I.attachRef=null,I.route=h,I.injector=N,I.outlet&&I.outlet.activateWith(h,I.injector),this.activateChildRoutes(t,null,I.children)}}else this.activateChildRoutes(t,null,i)}}class va{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class $o{constructor(t,c){this.component=t,this.route=c}}function ms(o,t,c){const i=o._root;return Hr(i,t?t._root:null,c,[i.value])}function Lu(o,t){const c=Symbol(),i=t.get(o,c);return i===c?"function"!=typeof o||(0,E.Z0I)(o)?t.get(o):o:i}function Hr(o,t,c,i,h={canDeactivateChecks:[],canActivateChecks:[]}){const w=bl(t);return o.children.forEach(I=>{(function Sp(o,t,c,i,h={canDeactivateChecks:[],canActivateChecks:[]}){const w=o.value,I=t?t.value:null,N=c?c.getContext(o.value.outlet):null;if(I&&w.routeConfig===I.routeConfig){const Y=function Fu(o,t,c){if("function"==typeof c)return c(o,t);switch(c){case"pathParamsChange":return!ao(o.url,t.url);case"pathParamsOrQueryParamsChange":return!ao(o.url,t.url)||!lr(o.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!xl(o,t)||!lr(o.queryParams,t.queryParams);default:return!xl(o,t)}}(I,w,w.routeConfig.runGuardsAndResolvers);Y?h.canActivateChecks.push(new va(i)):(w.data=I.data,w._resolvedData=I._resolvedData),Hr(o,t,w.component?N?N.children:null:c,i,h),Y&&N&&N.outlet&&N.outlet.isActivated&&h.canDeactivateChecks.push(new $o(N.outlet.component,I))}else I&&ea(t,N,h),h.canActivateChecks.push(new va(i)),Hr(o,null,w.component?N?N.children:null:c,i,h)})(I,w[I.value.outlet],c,i.concat([I.value]),h),delete w[I.value.outlet]}),Object.entries(w).forEach(([I,N])=>ea(N,c.getContext(I),h)),h}function ea(o,t,c){const i=bl(o),h=o.value;Object.entries(i).forEach(([w,I])=>{ea(I,h.component?t?t.children.getContext(w):null:t,c)}),c.canDeactivateChecks.push(new $o(h.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,h))}function Nu(o){return"function"==typeof o}function zu(o){return o instanceof oe||"EmptyError"===o?.name}const Vu=Symbol("INITIAL_VALUE");function Cl(){return(0,He.w)(o=>le(o.map(t=>t.pipe((0,ct.q)(1),Lt(Vu)))).pipe((0,O.U)(t=>{for(const c of t)if(!0!==c){if(c===Vu)return Vu;if(!1===c||c instanceof Er)return c}return!0}),(0,ft.h)(t=>t!==Vu),(0,ct.q)(1)))}function cg(o){return(0,ze.z)(Mn(t=>{if(mn(t))throw Tp(0,t)}),(0,O.U)(t=>!0===t))}class tc{constructor(t){this.segmentGroup=t||null}}class qd{constructor(t){this.urlTree=t}}function Wc(o){return Oe(new tc(o))}function Yd(o){return Oe(new qd(o))}class Z_{constructor(t,c){this.urlSerializer=t,this.urlTree=c}noMatchError(t){return new E.vHH(4002,!1)}lineralizeSegments(t,c){let i=[],h=c.root;for(;;){if(i=i.concat(h.segments),0===h.numberOfChildren)return(0,Fn.of)(i);if(h.numberOfChildren>1||!h.children[zn])return Oe(new E.vHH(4e3,!1));h=h.children[zn]}}applyRedirectCommands(t,c,i){return this.applyRedirectCreateUrlTree(c,this.urlSerializer.parse(c),t,i)}applyRedirectCreateUrlTree(t,c,i,h){const w=this.createSegmentGroup(t,c.root,i,h);return new Er(w,this.createQueryParams(c.queryParams,this.urlTree.queryParams),c.fragment)}createQueryParams(t,c){const i={};return Object.entries(t).forEach(([h,w])=>{if("string"==typeof w&&w.startsWith(":")){const N=w.substring(1);i[h]=c[N]}else i[h]=w}),i}createSegmentGroup(t,c,i,h){const w=this.createSegments(t,c.segments,i,h);let I={};return Object.entries(c.children).forEach(([N,Y])=>{I[N]=this.createSegmentGroup(t,Y,i,h)}),new er(w,I)}createSegments(t,c,i,h){return c.map(w=>w.path.startsWith(":")?this.findPosParam(t,w,h):this.findOrReturn(w,i))}findPosParam(t,c,i){const h=i[c.path.substring(1)];if(!h)throw new E.vHH(4001,!1);return h}findOrReturn(t,c){let i=0;for(const h of c){if(h.path===t.path)return c.splice(i),h;i++}return t}}const dg={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Hv(o,t,c,i,h){const w=hg(o,t,c);return w.matched?(i=function U_(o,t){return o.providers&&!o._injector&&(o._injector=(0,E.MMx)(o.providers,t,`Route: ${o.path}`)),o._injector??t}(t,i),function $v(o,t,c,i){const h=t.canMatch;if(!h||0===h.length)return(0,Fn.of)(!0);const w=h.map(I=>{const N=Lu(I,o);return Xs(function El(o){return o&&Nu(o.canMatch)}(N)?N.canMatch(t,c):o.runInContext(()=>N(t,c)))});return(0,Fn.of)(w).pipe(Cl(),cg())}(i,t,c).pipe((0,O.U)(I=>!0===I?w:{...dg}))):(0,Fn.of)(w)}function hg(o,t,c){if(""===t.path)return"full"===t.pathMatch&&(o.hasChildren()||c.length>0)?{...dg}:{matched:!0,consumedSegments:[],remainingSegments:c,parameters:{},positionalParamSegments:{}};const h=(t.matcher||_i)(c,o,t);if(!h)return{...dg};const w={};Object.entries(h.posParams??{}).forEach(([N,Y])=>{w[N]=Y.path});const I=h.consumed.length>0?{...w,...h.consumed[h.consumed.length-1].parameters}:w;return{matched:!0,consumedSegments:h.consumed,remainingSegments:c.slice(h.consumed.length),parameters:I,positionalParamSegments:h.posParams??{}}}function Ap(o,t,c,i){return c.length>0&&function cf(o,t,c){return c.some(i=>ta(o,t,i)&&ps(i)!==zn)}(o,c,i)?{segmentGroup:new er(t,Uu(i,new er(c,o.children))),slicedSegments:[]}:0===c.length&&function uf(o,t,c){return c.some(i=>ta(o,t,i))}(o,c,i)?{segmentGroup:new er(o.segments,q_(o,0,c,i,o.children)),slicedSegments:c}:{segmentGroup:new er(o.segments,o.children),slicedSegments:c}}function q_(o,t,c,i,h){const w={};for(const I of i)if(ta(o,c,I)&&!h[ps(I)]){const N=new er([],{});w[ps(I)]=N}return{...h,...w}}function Uu(o,t){const c={};c[zn]=t;for(const i of o)if(""===i.path&&ps(i)!==zn){const h=new er([],{});c[ps(i)]=h}return c}function ta(o,t,c){return(!(o.hasChildren()||t.length>0)||"full"!==c.pathMatch)&&""===c.path}class Gv{constructor(t,c,i,h,w,I,N){this.injector=t,this.configLoader=c,this.rootComponentType=i,this.config=h,this.urlTree=w,this.paramsInheritanceStrategy=I,this.urlSerializer=N,this.allowRedirects=!0,this.applyRedirects=new Z_(this.urlSerializer,this.urlTree)}noMatchError(t){return new E.vHH(4002,!1)}recognize(){const t=Ap(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,zn).pipe((0,an.K)(c=>{if(c instanceof qd)return this.allowRedirects=!1,this.urlTree=c.urlTree,this.match(c.urlTree);throw c instanceof tc?this.noMatchError(c):c}),(0,O.U)(c=>{const i=new Nr([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},zn,this.rootComponentType,null,{}),h=new ga(i,c),w=new $c("",h),I=function Wa(o,t,c=null,i=null){return ds(Fd(o),t,c,i)}(i,[],this.urlTree.queryParams,this.urlTree.fragment);return I.queryParams=this.urlTree.queryParams,w.url=this.urlSerializer.serialize(I),this.inheritParamsAndData(w._root),{state:w,tree:I}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t.root,zn).pipe((0,an.K)(i=>{throw i instanceof tc?this.noMatchError(i):i}))}inheritParamsAndData(t){const c=t.value,i=Ka(c,this.paramsInheritanceStrategy);c.params=Object.freeze(i.params),c.data=Object.freeze(i.data),t.children.forEach(h=>this.inheritParamsAndData(h))}processSegmentGroup(t,c,i,h){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,c,i):this.processSegment(t,c,i,i.segments,h,!0)}processChildren(t,c,i){const h=[];for(const w of Object.keys(i.children))"primary"===w?h.unshift(w):h.push(w);return(0,ar.D)(h).pipe((0,Kn.b)(w=>{const I=i.children[w],N=function $_(o,t){const c=o.filter(i=>ps(i)===t);return c.push(...o.filter(i=>ps(i)!==t)),c}(c,w);return this.processSegmentGroup(t,N,I,w)}),(0,Ai.R)((w,I)=>(w.push(...I),w)),vn(null),function Gi(o,t){const c=arguments.length>=2;return i=>i.pipe(o?(0,ft.h)((h,w)=>o(h,w,i)):M.y,ii(1),c?vn(t):Rn(()=>new oe))}(),(0,Ct.z)(w=>{if(null===w)return Wc(i);const I=Rp(w);return function Wv(o){o.sort((t,c)=>t.value.outlet===zn?-1:c.value.outlet===zn?1:t.value.outlet.localeCompare(c.value.outlet))}(I),(0,Fn.of)(I)}))}processSegment(t,c,i,h,w,I){return(0,ar.D)(c).pipe((0,Kn.b)(N=>this.processSegmentAgainstRoute(N._injector??t,c,N,i,h,w,I).pipe((0,an.K)(Y=>{if(Y instanceof tc)return(0,Fn.of)(null);throw Y}))),bn(N=>!!N),(0,an.K)(N=>{if(zu(N))return function Y_(o,t,c){return 0===t.length&&!o.children[c]}(i,h,w)?(0,Fn.of)([]):Wc(i);throw N}))}processSegmentAgainstRoute(t,c,i,h,w,I,N){return function gs(o,t,c,i){return!!(ps(o)===i||i!==zn&&ta(t,c,o))&&("**"===o.path||hg(t,o,c).matched)}(i,h,w,I)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(t,h,i,w,I,N):N&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,h,c,i,w,I):Wc(h):Wc(h)}expandSegmentAgainstRouteUsingRedirect(t,c,i,h,w,I){return"**"===h.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,h,I):this.expandRegularSegmentAgainstRouteUsingRedirect(t,c,i,h,w,I)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,c,i,h){const w=this.applyRedirects.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?Yd(w):this.applyRedirects.lineralizeSegments(i,w).pipe((0,Ct.z)(I=>{const N=new er(I,{});return this.processSegment(t,c,N,I,h,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,c,i,h,w,I){const{matched:N,consumedSegments:Y,remainingSegments:J,positionalParamSegments:xe}=hg(c,h,w);if(!N)return Wc(c);const Ae=this.applyRedirects.applyRedirectCommands(Y,h.redirectTo,xe);return h.redirectTo.startsWith("/")?Yd(Ae):this.applyRedirects.lineralizeSegments(h,Ae).pipe((0,Ct.z)(It=>this.processSegment(t,i,c,It.concat(J),I,!1)))}matchSegmentAgainstRoute(t,c,i,h,w,I){let N;if("**"===i.path){const Y=h.length>0?Qo(h).parameters:{},J=new Nr(h,Y,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Dl(i),ps(i),i.component??i._loadedComponent??null,i,ba(i));N=(0,Fn.of)({snapshot:J,consumedSegments:[],remainingSegments:[]}),c.children={}}else N=Hv(c,i,h,t).pipe((0,O.U)(({matched:Y,consumedSegments:J,remainingSegments:xe,parameters:Ae})=>Y?{snapshot:new Nr(J,Ae,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Dl(i),ps(i),i.component??i._loadedComponent??null,i,ba(i)),consumedSegments:J,remainingSegments:xe}:null));return N.pipe((0,He.w)(Y=>null===Y?Wc(c):this.getChildConfig(t=i._injector??t,i,h).pipe((0,He.w)(({routes:J})=>{const xe=i._loadedInjector??t,{snapshot:Ae,consumedSegments:It,remainingSegments:wt}=Y,{segmentGroup:St,slicedSegments:Qt}=Ap(c,It,wt,J);if(0===Qt.length&&St.hasChildren())return this.processChildren(xe,J,St).pipe((0,O.U)(Pn=>null===Pn?null:[new ga(Ae,Pn)]));if(0===J.length&&0===Qt.length)return(0,Fn.of)([new ga(Ae,[])]);const fn=ps(i)===w;return this.processSegment(xe,J,St,Qt,fn?zn:w,!0).pipe((0,O.U)(Pn=>[new ga(Ae,Pn)]))}))))}getChildConfig(t,c,i){return c.children?(0,Fn.of)({routes:c.children,injector:t}):c.loadChildren?void 0!==c._loadedRoutes?(0,Fn.of)({routes:c._loadedRoutes,injector:c._loadedInjector}):function Gc(o,t,c,i){const h=t.canLoad;if(void 0===h||0===h.length)return(0,Fn.of)(!0);const w=h.map(I=>{const N=Lu(I,o);return Xs(function Uv(o){return o&&Nu(o.canLoad)}(N)?N.canLoad(t,c):o.runInContext(()=>N(t,c)))});return(0,Fn.of)(w).pipe(Cl(),cg())}(t,c,i).pipe((0,Ct.z)(h=>h?this.configLoader.loadChildren(t,c).pipe(Mn(w=>{c._loadedRoutes=w.routes,c._loadedInjector=w.injector})):function Xd(o){return Oe(Ql(!1,3))}())):(0,Fn.of)({routes:[],injector:t})}}function Zv(o){const t=o.value.routeConfig;return t&&""===t.path}function Rp(o){const t=[],c=new Set;for(const i of o){if(!Zv(i)){t.push(i);continue}const h=t.find(w=>i.value.routeConfig===w.value.routeConfig);void 0!==h?(h.children.push(...i.children),c.add(h)):t.push(i)}for(const i of c){const h=Rp(i.children);t.push(new ga(i.value,h))}return t.filter(i=>!c.has(i))}function Dl(o){return o.data||{}}function ba(o){return o.resolve||{}}function pg(o){return"string"==typeof o.title||null===o.title}function mg(o){return(0,He.w)(t=>{const c=o(t);return c?(0,ar.D)(c).pipe((0,O.U)(()=>t)):(0,Fn.of)(t)})}const Zc=new E.OlP("ROUTES");let gg=(()=>{var o;class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,E.f3M)(E.Sil)}loadComponent(i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return(0,Fn.of)(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);const h=Xs(i.loadComponent()).pipe((0,O.U)(Op),Mn(I=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=I}),Sr(()=>{this.componentLoaders.delete(i)})),w=new tt(h,()=>new _t.x).pipe(ht());return this.componentLoaders.set(i,w),w}loadChildren(i,h){if(this.childrenLoaders.get(h))return this.childrenLoaders.get(h);if(h._loadedRoutes)return(0,Fn.of)({routes:h._loadedRoutes,injector:h._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(h);const I=this.loadModuleFactoryOrRoutes(h.loadChildren).pipe((0,O.U)(Y=>{this.onLoadEndListener&&this.onLoadEndListener(h);let J,xe;return Array.isArray(Y)?xe=Y:(J=Y.create(i).injector,xe=J.get(Zc,[],E.XFs.Self|E.XFs.Optional).flat()),{routes:xe.map(Gd),injector:J}}),Sr(()=>{this.childrenLoaders.delete(h)})),N=new tt(I,()=>new _t.x).pipe(ht());return this.childrenLoaders.set(h,N),N}loadModuleFactoryOrRoutes(i){return Xs(i()).pipe((0,O.U)(Op),(0,Ct.z)(h=>h instanceof E.YKP||Array.isArray(h)?(0,Fn.of)(h):(0,ar.D)(this.compiler.compileModuleAsync(h))))}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();function Op(o){return function Kd(o){return o&&"object"==typeof o&&"default"in o}(o)?o.default:o}let Oi=(()=>{var o;class t{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new _t.x,this.transitionAbortSubject=new _t.x,this.configLoader=(0,E.f3M)(gg),this.environmentInjector=(0,E.f3M)(E.lqb),this.urlSerializer=(0,E.f3M)(Yl),this.rootContexts=(0,E.f3M)(jc),this.inputBindingEnabled=null!==(0,E.f3M)(Ud,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>(0,Fn.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=w=>this.events.next(new bp(w)),this.configLoader.onLoadStartListener=w=>this.events.next(new Xa(w))}complete(){this.transitions?.complete()}handleNavigationRequest(i){const h=++this.navigationId;this.transitions?.next({...this.transitions.value,...i,id:h})}setupNavigations(i,h,w){return this.transitions=new Eo.X({id:0,currentUrlTree:h,currentRawUrl:h,currentBrowserUrl:h,extractedUrl:i.urlHandlingStrategy.extract(h),urlAfterRedirects:i.urlHandlingStrategy.extract(h),rawUrl:h,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Vd,restoredState:null,currentSnapshot:w.snapshot,targetSnapshot:null,currentRouterState:w,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,ft.h)(I=>0!==I.id),(0,O.U)(I=>({...I,extractedUrl:i.urlHandlingStrategy.extract(I.rawUrl)})),(0,He.w)(I=>{this.currentTransition=I;let N=!1,Y=!1;return(0,Fn.of)(I).pipe(Mn(J=>{this.currentNavigation={id:J.id,initialUrl:J.rawUrl,extractedUrl:J.extractedUrl,trigger:J.source,extras:J.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,He.w)(J=>{const xe=J.currentBrowserUrl.toString(),Ae=!i.navigated||J.extractedUrl.toString()!==xe||xe!==J.currentUrlTree.toString();if(!Ae&&"reload"!==(J.extras.onSameUrlNavigation??i.onSameUrlNavigation)){const wt="";return this.events.next(new Kl(J.id,this.urlSerializer.serialize(J.rawUrl),wt,0)),J.resolve(null),Xe.E}if(i.urlHandlingStrategy.shouldProcessUrl(J.rawUrl))return(0,Fn.of)(J).pipe((0,He.w)(wt=>{const St=this.transitions?.getValue();return this.events.next(new zc(wt.id,this.urlSerializer.serialize(wt.extractedUrl),wt.source,wt.restoredState)),St!==this.transitions?.getValue()?Xe.E:Promise.resolve(wt)}),function df(o,t,c,i,h,w){return(0,Ct.z)(I=>function Pp(o,t,c,i,h,w,I="emptyOnly"){return new Gv(o,t,c,i,h,I,w).recognize()}(o,t,c,i,I.extractedUrl,h,w).pipe((0,O.U)(({state:N,tree:Y})=>({...I,targetSnapshot:N,urlAfterRedirects:Y}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,i.config,this.urlSerializer,i.paramsInheritanceStrategy),Mn(wt=>{I.targetSnapshot=wt.targetSnapshot,I.urlAfterRedirects=wt.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:wt.urlAfterRedirects};const St=new ma(wt.id,this.urlSerializer.serialize(wt.extractedUrl),this.urlSerializer.serialize(wt.urlAfterRedirects),wt.targetSnapshot);this.events.next(St)}));if(Ae&&i.urlHandlingStrategy.shouldProcessUrl(J.currentRawUrl)){const{id:wt,extractedUrl:St,source:Qt,restoredState:fn,extras:Pn}=J,ci=new zc(wt,this.urlSerializer.serialize(St),Qt,fn);this.events.next(ci);const Tr=jo(0,this.rootComponentType).snapshot;return this.currentTransition=I={...J,targetSnapshot:Tr,urlAfterRedirects:St,extras:{...Pn,skipLocationChange:!1,replaceUrl:!1}},(0,Fn.of)(I)}{const wt="";return this.events.next(new Kl(J.id,this.urlSerializer.serialize(J.extractedUrl),wt,1)),J.resolve(null),Xe.E}}),Mn(J=>{const xe=new N_(J.id,this.urlSerializer.serialize(J.extractedUrl),this.urlSerializer.serialize(J.urlAfterRedirects),J.targetSnapshot);this.events.next(xe)}),(0,O.U)(J=>(this.currentTransition=I={...J,guards:ms(J.targetSnapshot,J.currentSnapshot,this.rootContexts)},I)),function af(o,t){return(0,Ct.z)(c=>{const{targetSnapshot:i,currentSnapshot:h,guards:{canActivateChecks:w,canDeactivateChecks:I}}=c;return 0===I.length&&0===w.length?(0,Fn.of)({...c,guardsResult:!0}):function ag(o,t,c,i){return(0,ar.D)(o).pipe((0,Ct.z)(h=>function W_(o,t,c,i,h){const w=t&&t.routeConfig?t.routeConfig.canDeactivate:null;if(!w||0===w.length)return(0,Fn.of)(!0);const I=w.map(N=>{const Y=ya(t)??h,J=Lu(N,Y);return Xs(function jv(o){return o&&Nu(o.canDeactivate)}(J)?J.canDeactivate(o,t,c,i):Y.runInContext(()=>J(o,t,c,i))).pipe(bn())});return(0,Fn.of)(I).pipe(Cl())}(h.component,h.route,c,t,i)),bn(h=>!0!==h,!0))}(I,i,h,o).pipe((0,Ct.z)(N=>N&&function Ip(o){return"boolean"==typeof o}(N)?function lg(o,t,c,i){return(0,ar.D)(t).pipe((0,Kn.b)(h=>Te(function G_(o,t){return null!==o&&t&&t(new xp(o)),(0,Fn.of)(!0)}(h.route.parent,i),function Wd(o,t){return null!==o&&t&&t(new eg(o)),(0,Fn.of)(!0)}(h.route,i),function Zd(o,t,c){const i=t[t.length-1],w=t.slice(0,t.length-1).reverse().map(I=>function io(o){const t=o.routeConfig?o.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:o,guards:t}:null}(I)).filter(I=>null!==I).map(I=>Me(()=>{const N=I.guards.map(Y=>{const J=ya(I.node)??c,xe=Lu(Y,J);return Xs(function rf(o){return o&&Nu(o.canActivateChild)}(xe)?xe.canActivateChild(i,o):J.runInContext(()=>xe(i,o))).pipe(bn())});return(0,Fn.of)(N).pipe(Cl())}));return(0,Fn.of)(w).pipe(Cl())}(o,h.path,c),function lf(o,t,c){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return(0,Fn.of)(!0);const h=i.map(w=>Me(()=>{const I=ya(t)??c,N=Lu(w,I);return Xs(function H_(o){return o&&Nu(o.canActivate)}(N)?N.canActivate(t,o):I.runInContext(()=>N(t,o))).pipe(bn())}));return(0,Fn.of)(h).pipe(Cl())}(o,h.route,c))),bn(h=>!0!==h,!0))}(i,w,o,t):(0,Fn.of)(N)),(0,O.U)(N=>({...c,guardsResult:N})))})}(this.environmentInjector,J=>this.events.next(J)),Mn(J=>{if(I.guardsResult=J.guardsResult,mn(J.guardsResult))throw Tp(0,J.guardsResult);const xe=new Fr(J.id,this.urlSerializer.serialize(J.extractedUrl),this.urlSerializer.serialize(J.urlAfterRedirects),J.targetSnapshot,!!J.guardsResult);this.events.next(xe)}),(0,ft.h)(J=>!!J.guardsResult||(this.cancelNavigationTransition(J,"",3),!1)),mg(J=>{if(J.guards.canActivateChecks.length)return(0,Fn.of)(J).pipe(Mn(xe=>{const Ae=new zv(xe.id,this.urlSerializer.serialize(xe.extractedUrl),this.urlSerializer.serialize(xe.urlAfterRedirects),xe.targetSnapshot);this.events.next(Ae)}),(0,He.w)(xe=>{let Ae=!1;return(0,Fn.of)(xe).pipe(function vb(o,t){return(0,Ct.z)(c=>{const{targetSnapshot:i,guards:{canActivateChecks:h}}=c;if(!h.length)return(0,Fn.of)(c);let w=0;return(0,ar.D)(h).pipe((0,Kn.b)(I=>function bb(o,t,c,i){const h=o.routeConfig,w=o._resolve;return void 0!==h?.title&&!pg(h)&&(w[Co]=h.title),function xb(o,t,c,i){const h=function wb(o){return[...Object.keys(o),...Object.getOwnPropertySymbols(o)]}(o);if(0===h.length)return(0,Fn.of)({});const w={};return(0,ar.D)(h).pipe((0,Ct.z)(I=>function Eb(o,t,c,i){const h=ya(t)??i,w=Lu(o,h);return Xs(w.resolve?w.resolve(t,c):h.runInContext(()=>w(t,c)))}(o[I],t,c,i).pipe(bn(),Mn(N=>{w[I]=N}))),ii(1),function ki(o){return(0,O.U)(()=>o)}(w),(0,an.K)(I=>zu(I)?Xe.E:Oe(I)))}(w,o,t,i).pipe((0,O.U)(I=>(o._resolvedData=I,o.data=Ka(o,c).resolve,h&&pg(h)&&(o.data[Co]=h.title),null)))}(I.route,i,o,t)),Mn(()=>w++),ii(1),(0,Ct.z)(I=>w===h.length?(0,Fn.of)(c):Xe.E))})}(i.paramsInheritanceStrategy,this.environmentInjector),Mn({next:()=>Ae=!0,complete:()=>{Ae||this.cancelNavigationTransition(xe,"",2)}}))}),Mn(xe=>{const Ae=new vp(xe.id,this.urlSerializer.serialize(xe.extractedUrl),this.urlSerializer.serialize(xe.urlAfterRedirects),xe.targetSnapshot);this.events.next(Ae)}))}),mg(J=>{const xe=Ae=>{const It=[];Ae.routeConfig?.loadComponent&&!Ae.routeConfig._loadedComponent&&It.push(this.configLoader.loadComponent(Ae.routeConfig).pipe(Mn(wt=>{Ae.component=wt}),(0,O.U)(()=>{})));for(const wt of Ae.children)It.push(...xe(wt));return It};return le(xe(J.targetSnapshot.root)).pipe(vn(),(0,ct.q)(1))}),mg(()=>this.afterPreactivation()),(0,O.U)(J=>{const xe=function Ru(o,t,c){const i=Ou(o,t._root,c?c._root:void 0);return new Dp(i,t)}(i.routeReuseStrategy,J.targetSnapshot,J.currentRouterState);return this.currentTransition=I={...J,targetRouterState:xe},I}),Mn(()=>{this.events.next(new Qh)}),((o,t,c,i)=>(0,O.U)(h=>(new wl(t,h.targetRouterState,h.currentRouterState,c,i).activate(o),h)))(this.rootContexts,i.routeReuseStrategy,J=>this.events.next(J),this.inputBindingEnabled),(0,ct.q)(1),Mn({next:J=>{N=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Os(J.id,this.urlSerializer.serialize(J.extractedUrl),this.urlSerializer.serialize(J.urlAfterRedirects))),i.titleStrategy?.updateTitle(J.targetRouterState.snapshot),J.resolve(!0)},complete:()=>{N=!0}}),(0,$r.R)(this.transitionAbortSubject.pipe(Mn(J=>{throw J}))),Sr(()=>{N||Y||this.cancelNavigationTransition(I,"",1),this.currentNavigation?.id===I.id&&(this.currentNavigation=null)}),(0,an.K)(J=>{if(Y=!0,$d(J))this.events.next(new es(I.id,this.urlSerializer.serialize(I.extractedUrl),J.message,J.cancellationCode)),function Hc(o){return $d(o)&&mn(o.url)}(J)?this.events.next(new ef(J.url)):I.resolve(!1);else{this.events.next(new qr(I.id,this.urlSerializer.serialize(I.extractedUrl),J,I.targetSnapshot??void 0));try{I.resolve(i.errorHandler(J))}catch(xe){I.reject(xe)}}return Xe.E}))}))}cancelNavigationTransition(i,h,w){const I=new es(i.id,this.urlSerializer.serialize(i.extractedUrl),h,w);this.events.next(I),i.resolve(!1)}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();function nc(o){return o!==Vd}let kp=(()=>{var o;class t{buildTitle(i){let h,w=i.root;for(;void 0!==w;)h=this.getResolvedTitleForRoute(w)??h,w=w.children.find(I=>I.outlet===zn);return h}getResolvedTitleForRoute(i){return i.data[Co]}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:function(){return(0,E.f3M)(hf)},providedIn:"root"}),t})(),hf=(()=>{var o;class t extends kp{constructor(i){super(),this.title=i}updateTitle(i){const h=this.buildTitle(i);void 0!==h&&this.title.setTitle(h)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(jh))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),ff=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:function(){return(0,E.f3M)(qv)},providedIn:"root"}),t})();class Lp{shouldDetach(t){return!1}store(t,c){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,c){return t.routeConfig===c.routeConfig}}let qv=(()=>{var o;class t extends Lp{}return(o=t).\u0275fac=function(){let c;return function(h){return(c||(c=E.n5z(o)))(h||o)}}(),o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();const Fp=new E.OlP("",{providedIn:"root",factory:()=>({})});let ju=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:function(){return(0,E.f3M)(pf)},providedIn:"root"}),t})(),pf=(()=>{var o;class t{shouldProcessUrl(i){return!0}extract(i){return i}merge(i,h){return i}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();var Jd=function(o){return o[o.COMPLETE=0]="COMPLETE",o[o.FAILED=1]="FAILED",o[o.REDIRECTING=2]="REDIRECTING",o}(Jd||{});function _g(o,t){o.events.pipe((0,ft.h)(c=>c instanceof Os||c instanceof es||c instanceof qr||c instanceof Kl),(0,O.U)(c=>c instanceof Os||c instanceof Kl?Jd.COMPLETE:c instanceof es&&(0===c.code||1===c.code)?Jd.REDIRECTING:Jd.FAILED),(0,ft.h)(c=>c!==Jd.REDIRECTING),(0,ct.q)(1)).subscribe(()=>{t()})}function X_(o){throw o}function K_(o,t,c){return t.parse("/")}const mf={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Yv={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let lo=(()=>{var o;class t{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,E.f3M)(E.c2e),this.isNgZoneEnabled=!1,this._events=new _t.x,this.options=(0,E.f3M)(Fp,{optional:!0})||{},this.pendingTasks=(0,E.f3M)(E.HDt),this.errorHandler=this.options.errorHandler||X_,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||K_,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,E.f3M)(ju),this.routeReuseStrategy=(0,E.f3M)(ff),this.titleStrategy=(0,E.f3M)(kp),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=(0,E.f3M)(Zc,{optional:!0})?.flat()??[],this.navigationTransitions=(0,E.f3M)(Oi),this.urlSerializer=(0,E.f3M)(Yl),this.location=(0,E.f3M)(En),this.componentInputBindingEnabled=!!(0,E.f3M)(Ud,{optional:!0}),this.eventsSubscription=new At.w0,this.isNgZoneEnabled=(0,E.f3M)(E.R0b)instanceof E.R0b&&E.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Er,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=jo(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(i=>{this.lastSuccessfulId=i.id,this.currentPageId=this.browserPageId},i=>{this.console.warn(`Unhandled Navigation Error: ${i}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const i=this.navigationTransitions.events.subscribe(h=>{try{const{currentTransition:w}=this.navigationTransitions;if(null===w)return void($u(h)&&this._events.next(h));if(h instanceof zc)nc(w.source)&&(this.browserUrlTree=w.extractedUrl);else if(h instanceof Kl)this.rawUrlTree=w.rawUrl;else if(h instanceof ma){if("eager"===this.urlUpdateStrategy){if(!w.extras.skipLocationChange){const I=this.urlHandlingStrategy.merge(w.urlAfterRedirects,w.rawUrl);this.setBrowserUrl(I,w)}this.browserUrlTree=w.urlAfterRedirects}}else if(h instanceof Qh)this.currentUrlTree=w.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(w.urlAfterRedirects,w.rawUrl),this.routerState=w.targetRouterState,"deferred"===this.urlUpdateStrategy&&(w.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,w),this.browserUrlTree=w.urlAfterRedirects);else if(h instanceof es)0!==h.code&&1!==h.code&&(this.navigated=!0),(3===h.code||2===h.code)&&this.restoreHistory(w);else if(h instanceof ef){const I=this.urlHandlingStrategy.merge(h.url,w.currentRawUrl),N={skipLocationChange:w.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||nc(w.source)};this.scheduleNavigation(I,Vd,null,N,{resolve:w.resolve,reject:w.reject,promise:w.promise})}h instanceof qr&&this.restoreHistory(w,!0),h instanceof Os&&(this.navigated=!0),$u(h)&&this._events.next(h)}catch(w){this.navigationTransitions.transitionAbortSubject.next(w)}});this.eventsSubscription.add(i)}resetRootComponentType(i){this.routerState.root.component=i,this.navigationTransitions.rootComponentType=i}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const i=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Vd,i)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(i=>{const h="popstate"===i.type?"popstate":"hashchange";"popstate"===h&&setTimeout(()=>{this.navigateToSyncWithBrowser(i.url,h,i.state)},0)}))}navigateToSyncWithBrowser(i,h,w){const I={replaceUrl:!0},N=w?.navigationId?w:null;if(w){const J={...w};delete J.navigationId,delete J.\u0275routerPageId,0!==Object.keys(J).length&&(I.state=J)}const Y=this.parseUrl(i);this.scheduleNavigation(Y,h,N,I)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(i){this.config=i.map(Gd),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(i,h={}){const{relativeTo:w,queryParams:I,fragment:N,queryParamsHandling:Y,preserveFragment:J}=h,xe=J?this.currentUrlTree.fragment:N;let It,Ae=null;switch(Y){case"merge":Ae={...this.currentUrlTree.queryParams,...I};break;case"preserve":Ae=this.currentUrlTree.queryParams;break;default:Ae=I||null}null!==Ae&&(Ae=this.removeEmptyProps(Ae));try{It=Fd(w?w.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof i[0]||!i[0].startsWith("/"))&&(i=[]),It=this.currentUrlTree.root}return ds(It,i,Ae,xe??null)}navigateByUrl(i,h={skipLocationChange:!1}){const w=mn(i)?i:this.parseUrl(i),I=this.urlHandlingStrategy.merge(w,this.rawUrlTree);return this.scheduleNavigation(I,Vd,null,h)}navigate(i,h={skipLocationChange:!1}){return function J_(o){for(let t=0;t<o.length;t++)if(null==o[t])throw new E.vHH(4008,!1)}(i),this.navigateByUrl(this.createUrlTree(i,h),h)}serializeUrl(i){return this.urlSerializer.serialize(i)}parseUrl(i){let h;try{h=this.urlSerializer.parse(i)}catch(w){h=this.malformedUriErrorHandler(w,this.urlSerializer,i)}return h}isActive(i,h){let w;if(w=!0===h?{...mf}:!1===h?{...Yv}:h,mn(i))return Ua(this.currentUrlTree,i,w);const I=this.parseUrl(i);return Ua(this.currentUrlTree,I,w)}removeEmptyProps(i){return Object.keys(i).reduce((h,w)=>{const I=i[w];return null!=I&&(h[w]=I),h},{})}scheduleNavigation(i,h,w,I,N){if(this.disposed)return Promise.resolve(!1);let Y,J,xe;N?(Y=N.resolve,J=N.reject,xe=N.promise):xe=new Promise((It,wt)=>{Y=It,J=wt});const Ae=this.pendingTasks.add();return _g(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Ae))}),this.navigationTransitions.handleNavigationRequest({source:h,restoredState:w,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:i,extras:I,resolve:Y,reject:J,promise:xe,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),xe.catch(It=>Promise.reject(It))}setBrowserUrl(i,h){const w=this.urlSerializer.serialize(i);if(this.location.isCurrentPathEqualTo(w)||h.extras.replaceUrl){const N={...h.extras.state,...this.generateNgRouterState(h.id,this.browserPageId)};this.location.replaceState(w,"",N)}else{const I={...h.extras.state,...this.generateNgRouterState(h.id,this.browserPageId+1)};this.location.go(w,"",I)}}restoreHistory(i,h=!1){if("computed"===this.canceledNavigationResolution){const I=this.currentPageId-this.browserPageId;0!==I?this.location.historyGo(I):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===I&&(this.resetState(i),this.browserUrlTree=i.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(h&&this.resetState(i),this.resetUrlToCurrentUrlTree())}resetState(i){this.routerState=i.currentRouterState,this.currentUrlTree=i.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,i.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(i,h){return"computed"===this.canceledNavigationResolution?{navigationId:i,\u0275routerPageId:h}:{navigationId:i}}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();function $u(o){return!(o instanceof Qh||o instanceof ef)}let Qd=(()=>{var o;class t{constructor(i,h,w,I,N,Y){this.router=i,this.route=h,this.tabIndexAttribute=w,this.renderer=I,this.el=N,this.locationStrategy=Y,this.href=null,this.commands=null,this.onChanges=new _t.x,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const J=N.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===J||"area"===J,this.isAnchorElement?this.subscription=i.events.subscribe(xe=>{xe instanceof Os&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(i){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",i)}ngOnChanges(i){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(i){null!=i?(this.commands=Array.isArray(i)?i:[i],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(i,h,w,I,N){return!!(null===this.urlTree||this.isAnchorElement&&(0!==i||h||w||I||N||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const i=null===this.href?null:(0,E.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(i,h){const w=this.renderer,I=this.el.nativeElement;null!==h?w.setAttribute(I,i,h):w.removeAttribute(I,i)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(lo),E.Y36(Jl),E.$8M("tabindex"),E.Y36(E.Qsj),E.Y36(E.SBq),E.Y36(Tt))},o.\u0275dir=E.lG2({type:o,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,h){1&i&&E.NdJ("click",function(I){return h.onClick(I.button,I.ctrlKey,I.shiftKey,I.altKey,I.metaKey)}),2&i&&E.uIk("target",h.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",E.VuI],skipLocationChange:["skipLocationChange","skipLocationChange",E.VuI],replaceUrl:["replaceUrl","replaceUrl",E.VuI],routerLink:"routerLink"},standalone:!0,features:[E.Xq5,E.TTD]}),t})();class Hu{}let yg=(()=>{var o;class t{constructor(i,h,w,I,N){this.router=i,this.injector=w,this.preloadingStrategy=I,this.loader=N}setUpPreloading(){this.subscription=this.router.events.pipe((0,ft.h)(i=>i instanceof Os),(0,Kn.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(i,h){const w=[];for(const I of h){I.providers&&!I._injector&&(I._injector=(0,E.MMx)(I.providers,i,`Route: ${I.path}`));const N=I._injector??i,Y=I._loadedInjector??N;(I.loadChildren&&!I._loadedRoutes&&void 0===I.canLoad||I.loadComponent&&!I._loadedComponent)&&w.push(this.preloadConfig(N,I)),(I.children||I._loadedRoutes)&&w.push(this.processRoutes(Y,I.children??I._loadedRoutes))}return(0,ar.D)(w).pipe((0,fe.J)())}preloadConfig(i,h){return this.preloadingStrategy.preload(h,()=>{let w;w=h.loadChildren&&void 0===h.canLoad?this.loader.loadChildren(i,h):(0,Fn.of)(null);const I=w.pipe((0,Ct.z)(N=>null===N?(0,Fn.of)(void 0):(h._loadedRoutes=N.routes,h._loadedInjector=N.injector,this.processRoutes(N.injector??i,N.routes))));if(h.loadComponent&&!h._loadedComponent){const N=this.loader.loadComponent(h);return(0,ar.D)([I,N]).pipe((0,fe.J)())}return I})}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(lo),E.LFG(E.Sil),E.LFG(E.lqb),E.LFG(Hu),E.LFG(gg))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();const Np=new E.OlP("");let gf=(()=>{var o;class t{constructor(i,h,w,I,N={}){this.urlSerializer=i,this.transitions=h,this.viewportScroller=w,this.zone=I,this.options=N,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},N.scrollPositionRestoration=N.scrollPositionRestoration||"disabled",N.anchorScrolling=N.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof zc?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=i.navigationTrigger,this.restoredId=i.restoredState?i.restoredState.navigationId:0):i instanceof Os?(this.lastId=i.id,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.urlAfterRedirects).fragment)):i instanceof Kl&&0===i.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof Uc&&(i.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(i.position):i.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(i.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(i,h){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Uc(i,"popstate"===this.lastSource?this.store[this.restoredId]:null,h))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return(o=t).\u0275fac=function(i){E.$Z()},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();function ks(o,t){return{\u0275kind:o,\u0275providers:t}}function Fi(){const o=(0,E.f3M)(E.zs3);return t=>{const c=o.get(E.z2F);if(t!==c.components[0])return;const i=o.get(lo),h=o.get(th);1===o.get(Bp)&&i.initialNavigation(),o.get(bf,null,E.XFs.Optional)?.setUpPreloading(),o.get(Np,null,E.XFs.Optional)?.init(),i.resetRootComponentType(c.componentTypes[0]),h.closed||(h.next(),h.complete(),h.unsubscribe())}}const th=new E.OlP("",{factory:()=>new _t.x}),Bp=new E.OlP("",{providedIn:"root",factory:()=>1}),bf=new E.OlP("");function ty(o){return ks(0,[{provide:bf,useExisting:yg},{provide:Hu,useExisting:o}])}const xf=new E.OlP("ROUTER_FORROOT_GUARD"),ny=[En,{provide:Yl,useClass:Rs},lo,jc,{provide:Jl,useFactory:function vg(o){return o.routerState.root},deps:[lo]},gg,[]];function xg(){return new E.PXZ("Router",lo)}let Tl=(()=>{var o;class t{constructor(i){}static forRoot(i,h){return{ngModule:t,providers:[ny,[],{provide:Zc,multi:!0,useValue:i},{provide:xf,useFactory:ry,deps:[[lo,new E.FiY,new E.tp0]]},{provide:Fp,useValue:h||{}},h?.useHash?{provide:Tt,useClass:Pt}:{provide:Tt,useClass:nn},{provide:Np,useFactory:()=>{const o=(0,E.f3M)(No),t=(0,E.f3M)(E.R0b),c=(0,E.f3M)(Fp),i=(0,E.f3M)(Oi),h=(0,E.f3M)(Yl);return c.scrollOffset&&o.setOffset(c.scrollOffset),new gf(h,i,o,t,c)}},h?.preloadingStrategy?ty(h.preloadingStrategy).\u0275providers:[],{provide:E.PXZ,multi:!0,useFactory:xg},h?.initialNavigation?wg(h):[],h?.bindToComponentInputs?ks(8,[_a,{provide:Ud,useExisting:_a}]).\u0275providers:[],[{provide:Ef,useFactory:Fi},{provide:E.tb,multi:!0,useExisting:Ef}]]}}static forChild(i){return{ngModule:t,providers:[{provide:Zc,multi:!0,useValue:i}]}}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(xf,8))},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({}),t})();function ry(o){return"guarded"}function wg(o){return["disabled"===o.initialNavigation?ks(3,[{provide:E.ip1,multi:!0,useFactory:()=>{const t=(0,E.f3M)(lo);return()=>{t.setUpLocationChangeListener()}}},{provide:Bp,useValue:2}]).\u0275providers:[],"enabledBlocking"===o.initialNavigation?ks(2,[{provide:Bp,useValue:0},{provide:E.ip1,multi:!0,deps:[E.zs3],useFactory:t=>{const c=t.get(Le,Promise.resolve());return()=>c.then(()=>new Promise(i=>{const h=t.get(lo),w=t.get(th);_g(h,()=>{i(!0)}),t.get(Oi).afterPreactivation=()=>(i(!0),w.closed?(0,Fn.of)(void 0):w),h.initialNavigation()}))}}]).\u0275providers:[]]}const Ef=new E.OlP("");var on=te(4221);const $p=(0,on.ZF)("blogs"),oy=(0,on.P1)($p,o=>o.blogs),Cg=(0,on.P1)($p,o=>o.loading),sy=(0,on.P1)($p,o=>o.error),Cf_apiUrl=((0,on.P1)(oy,o=>{const t=localStorage.getItem("userId");return t?o.filter(c=>c.userId===t):[]}),"https://erin-awful-turkey.cyclic.cloud");class Hp{constructor(t,c,i,h){this.username=t,this.token=c,this.userId=i,this.expiresIn=h}get expireDate(){return this.expiresIn}get userToken(){return this.token}}class rh{}class Gp{}class na{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?"string"==typeof t?this.lazyInit=()=>{this.headers=new Map,t.split("\n").forEach(c=>{const i=c.indexOf(":");if(i>0){const h=c.slice(0,i),w=h.toLowerCase(),I=c.slice(i+1).trim();this.maybeSetNormalizedName(h,w),this.headers.has(w)?this.headers.get(w).push(I):this.headers.set(w,[I])}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((c,i)=>{this.setHeaderEntries(i,c)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([c,i])=>{this.setHeaderEntries(c,i)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const c=this.headers.get(t.toLowerCase());return c&&c.length>0?c[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,c){return this.clone({name:t,value:c,op:"a"})}set(t,c){return this.clone({name:t,value:c,op:"s"})}delete(t,c){return this.clone({name:t,value:c,op:"d"})}maybeSetNormalizedName(t,c){this.normalizedNames.has(c)||this.normalizedNames.set(c,t)}init(){this.lazyInit&&(this.lazyInit instanceof na?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(c=>{this.headers.set(c,t.headers.get(c)),this.normalizedNames.set(c,t.normalizedNames.get(c))})}clone(t){const c=new na;return c.lazyInit=this.lazyInit&&this.lazyInit instanceof na?this.lazyInit:this,c.lazyUpdate=(this.lazyUpdate||[]).concat([t]),c}applyUpdate(t){const c=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,c);const h=("a"===t.op?this.headers.get(c):void 0)||[];h.push(...i),this.headers.set(c,h);break;case"d":const w=t.value;if(w){let I=this.headers.get(c);if(!I)return;I=I.filter(N=>-1===w.indexOf(N)),0===I.length?(this.headers.delete(c),this.normalizedNames.delete(c)):this.headers.set(c,I)}else this.headers.delete(c),this.normalizedNames.delete(c)}}setHeaderEntries(t,c){const i=(Array.isArray(c)?c:[c]).map(w=>w.toString()),h=t.toLowerCase();this.headers.set(h,i),this.maybeSetNormalizedName(t,h)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(c=>t(this.normalizedNames.get(c),this.headers.get(c)))}}class Qv{encodeKey(t){return Zp(t)}encodeValue(t){return Zp(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const Wp=/%(\d[a-f0-9])/gi,e0={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Zp(o){return encodeURIComponent(o).replace(Wp,(t,c)=>e0[c]??t)}function oh(o){return`${o}`}class Ls{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new Qv,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Sb(o,t){const c=new Map;return o.length>0&&o.replace(/^\?/,"").split("&").forEach(h=>{const w=h.indexOf("="),[I,N]=-1==w?[t.decodeKey(h),""]:[t.decodeKey(h.slice(0,w)),t.decodeValue(h.slice(w+1))],Y=c.get(I)||[];Y.push(N),c.set(I,Y)}),c}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(c=>{const i=t.fromObject[c],h=Array.isArray(i)?i.map(oh):[oh(i)];this.map.set(c,h)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const c=this.map.get(t);return c?c[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,c){return this.clone({param:t,value:c,op:"a"})}appendAll(t){const c=[];return Object.keys(t).forEach(i=>{const h=t[i];Array.isArray(h)?h.forEach(w=>{c.push({param:i,value:w,op:"a"})}):c.push({param:i,value:h,op:"a"})}),this.clone(c)}set(t,c){return this.clone({param:t,value:c,op:"s"})}delete(t,c){return this.clone({param:t,value:c,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const c=this.encoder.encodeKey(t);return this.map.get(t).map(i=>c+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const c=new Ls({encoder:this.encoder});return c.cloneFrom=this.cloneFrom||this,c.updates=(this.updates||[]).concat(t),c}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const c=("a"===t.op?this.map.get(t.param):void 0)||[];c.push(oh(t.value)),this.map.set(t.param,c);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const h=i.indexOf(oh(t.value));-1!==h&&i.splice(h,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class Yr{constructor(){this.map=new Map}set(t,c){return this.map.set(t,c),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function Wu(o){return typeof ArrayBuffer<"u"&&o instanceof ArrayBuffer}function Ml(o){return typeof Blob<"u"&&o instanceof Blob}function rc(o){return typeof FormData<"u"&&o instanceof FormData}class qc{constructor(t,c,i,h){let w;if(this.url=c,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function ys(o){switch(o){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||h?(this.body=void 0!==i?i:null,w=h):w=i,w&&(this.reportProgress=!!w.reportProgress,this.withCredentials=!!w.withCredentials,w.responseType&&(this.responseType=w.responseType),w.headers&&(this.headers=w.headers),w.context&&(this.context=w.context),w.params&&(this.params=w.params)),this.headers||(this.headers=new na),this.context||(this.context=new Yr),this.params){const I=this.params.toString();if(0===I.length)this.urlWithParams=c;else{const N=c.indexOf("?");this.urlWithParams=c+(-1===N?"?":N<c.length-1?"&":"")+I}}else this.params=new Ls,this.urlWithParams=c}serializeBody(){return null===this.body?null:Wu(this.body)||Ml(this.body)||rc(this.body)||function Dg(o){return typeof URLSearchParams<"u"&&o instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Ls?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||rc(this.body)?null:Ml(this.body)?this.body.type||null:Wu(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Ls?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const c=t.method||this.method,i=t.url||this.url,h=t.responseType||this.responseType,w=void 0!==t.body?t.body:this.body,I=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,N=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let Y=t.headers||this.headers,J=t.params||this.params;const xe=t.context??this.context;return void 0!==t.setHeaders&&(Y=Object.keys(t.setHeaders).reduce((Ae,It)=>Ae.set(It,t.setHeaders[It]),Y)),t.setParams&&(J=Object.keys(t.setParams).reduce((Ae,It)=>Ae.set(It,t.setParams[It]),J)),new qc(c,i,w,{params:J,headers:Y,context:xe,reportProgress:N,responseType:h,withCredentials:I})}}var oc=function(o){return o[o.Sent=0]="Sent",o[o.UploadProgress=1]="UploadProgress",o[o.ResponseHeader=2]="ResponseHeader",o[o.DownloadProgress=3]="DownloadProgress",o[o.Response=4]="Response",o[o.User=5]="User",o}(oc||{});class Df{constructor(t,c=200,i="OK"){this.headers=t.headers||new na,this.status=void 0!==t.status?t.status:c,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class Zu extends Df{constructor(t={}){super(t),this.type=oc.ResponseHeader}clone(t={}){return new Zu({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class qu extends Df{constructor(t={}){super(t),this.type=oc.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new qu({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class qp extends Df{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function Yp(o,t){return{body:t,headers:o.headers,context:o.context,observe:o.observe,params:o.params,reportProgress:o.reportProgress,responseType:o.responseType,withCredentials:o.withCredentials}}let Ri=(()=>{var o;class t{constructor(i){this.handler=i}request(i,h,w={}){let I;if(i instanceof qc)I=i;else{let J,xe;J=w.headers instanceof na?w.headers:new na(w.headers),w.params&&(xe=w.params instanceof Ls?w.params:new Ls({fromObject:w.params})),I=new qc(i,h,void 0!==w.body?w.body:null,{headers:J,context:w.context,params:xe,reportProgress:w.reportProgress,responseType:w.responseType||"json",withCredentials:w.withCredentials})}const N=(0,Fn.of)(I).pipe((0,Kn.b)(J=>this.handler.handle(J)));if(i instanceof qc||"events"===w.observe)return N;const Y=N.pipe((0,ft.h)(J=>J instanceof qu));switch(w.observe||"body"){case"body":switch(I.responseType){case"arraybuffer":return Y.pipe((0,O.U)(J=>{if(null!==J.body&&!(J.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return J.body}));case"blob":return Y.pipe((0,O.U)(J=>{if(null!==J.body&&!(J.body instanceof Blob))throw new Error("Response is not a Blob.");return J.body}));case"text":return Y.pipe((0,O.U)(J=>{if(null!==J.body&&"string"!=typeof J.body)throw new Error("Response is not a string.");return J.body}));default:return Y.pipe((0,O.U)(J=>J.body))}case"response":return Y;default:throw new Error(`Unreachable: unhandled observe type ${w.observe}}`)}}delete(i,h={}){return this.request("DELETE",i,h)}get(i,h={}){return this.request("GET",i,h)}head(i,h={}){return this.request("HEAD",i,h)}jsonp(i,h){return this.request("JSONP",i,{params:(new Ls).append(h,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(i,h={}){return this.request("OPTIONS",i,h)}patch(i,h,w={}){return this.request("PATCH",i,Yp(w,h))}post(i,h,w={}){return this.request("POST",i,Yp(w,h))}put(i,h,w={}){return this.request("PUT",i,Yp(w,h))}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(rh))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();function Jp(o,t){return t(o)}function n0(o,t){return(c,i)=>t.intercept(c,{handle:h=>o(h,i)})}const Qp=new E.OlP(""),Yc=new E.OlP(""),cy=new E.OlP("");function uy(){let o=null;return(t,c)=>{null===o&&(o=((0,E.f3M)(Qp,{optional:!0})??[]).reduceRight(n0,Jp));const i=(0,E.f3M)(E.HDt),h=i.add();return o(t,c).pipe(Sr(()=>i.remove(h)))}}let dy=(()=>{var o;class t extends rh{constructor(i,h){super(),this.backend=i,this.injector=h,this.chain=null,this.pendingTasks=(0,E.f3M)(E.HDt)}handle(i){if(null===this.chain){const w=Array.from(new Set([...this.injector.get(Yc),...this.injector.get(cy,[])]));this.chain=w.reduceRight((I,N)=>function ly(o,t,c){return(i,h)=>c.runInContext(()=>t(i,w=>o(w,h)))}(I,N,this.injector),Jp)}const h=this.pendingTasks.add();return this.chain(i,w=>this.backend.handle(w)).pipe(Sr(()=>this.pendingTasks.remove(h)))}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Gp),E.LFG(E.lqb))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();const Ag=/^\)\]\}',?\n/;let Ns=(()=>{var o;class t{constructor(i){this.xhrFactory=i}handle(i){if("JSONP"===i.method)throw new E.vHH(-2800,!1);const h=this.xhrFactory;return(h.\u0275loadImpl?(0,ar.D)(h.\u0275loadImpl()):(0,Fn.of)(null)).pipe((0,He.w)(()=>new Vo.y(I=>{const N=h.build();if(N.open(i.method,i.urlWithParams),i.withCredentials&&(N.withCredentials=!0),i.headers.forEach((fn,Pn)=>N.setRequestHeader(fn,Pn.join(","))),i.headers.has("Accept")||N.setRequestHeader("Accept","application/json, text/plain, */*"),!i.headers.has("Content-Type")){const fn=i.detectContentTypeHeader();null!==fn&&N.setRequestHeader("Content-Type",fn)}if(i.responseType){const fn=i.responseType.toLowerCase();N.responseType="json"!==fn?fn:"text"}const Y=i.serializeBody();let J=null;const xe=()=>{if(null!==J)return J;const fn=N.statusText||"OK",Pn=new na(N.getAllResponseHeaders()),ci=function Pg(o){return"responseURL"in o&&o.responseURL?o.responseURL:/^X-Request-URL:/m.test(o.getAllResponseHeaders())?o.getResponseHeader("X-Request-URL"):null}(N)||i.url;return J=new Zu({headers:Pn,status:N.status,statusText:fn,url:ci}),J},Ae=()=>{let{headers:fn,status:Pn,statusText:ci,url:Tr}=xe(),Mi=null;204!==Pn&&(Mi=typeof N.response>"u"?N.responseText:N.response),0===Pn&&(Pn=Mi?200:0);let Us=Pn>=200&&Pn<300;if("json"===i.responseType&&"string"==typeof Mi){const pc=Mi;Mi=Mi.replace(Ag,"");try{Mi=""!==Mi?JSON.parse(Mi):null}catch(xs){Mi=pc,Us&&(Us=!1,Mi={error:xs,text:Mi})}}Us?(I.next(new qu({body:Mi,headers:fn,status:Pn,statusText:ci,url:Tr||void 0})),I.complete()):I.error(new qp({error:Mi,headers:fn,status:Pn,statusText:ci,url:Tr||void 0}))},It=fn=>{const{url:Pn}=xe(),ci=new qp({error:fn,status:N.status||0,statusText:N.statusText||"Unknown Error",url:Pn||void 0});I.error(ci)};let wt=!1;const St=fn=>{wt||(I.next(xe()),wt=!0);let Pn={type:oc.DownloadProgress,loaded:fn.loaded};fn.lengthComputable&&(Pn.total=fn.total),"text"===i.responseType&&N.responseText&&(Pn.partialText=N.responseText),I.next(Pn)},Qt=fn=>{let Pn={type:oc.UploadProgress,loaded:fn.loaded};fn.lengthComputable&&(Pn.total=fn.total),I.next(Pn)};return N.addEventListener("load",Ae),N.addEventListener("error",It),N.addEventListener("timeout",It),N.addEventListener("abort",It),i.reportProgress&&(N.addEventListener("progress",St),null!==Y&&N.upload&&N.upload.addEventListener("progress",Qt)),N.send(Y),I.next({type:oc.Sent}),()=>{N.removeEventListener("error",It),N.removeEventListener("abort",It),N.removeEventListener("load",Ae),N.removeEventListener("timeout",It),i.reportProgress&&(N.removeEventListener("progress",St),null!==Y&&N.upload&&N.upload.removeEventListener("progress",Qt)),N.readyState!==N.DONE&&N.abort()}})))}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ms))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();const sh=new E.OlP("XSRF_ENABLED"),Il=new E.OlP("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),Sf=new E.OlP("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class fy{}let Rg=(()=>{var o;class t{constructor(i,h,w){this.doc=i,this.platform=h,this.cookieName=w,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const i=this.doc.cookie||"";return i!==this.lastCookieString&&(this.parseCount++,this.lastToken=Po(i,this.cookieName),this.lastCookieString=i),this.lastToken}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ye),E.LFG(E.Lbi),E.LFG(Il))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();function py(o,t){const c=o.url.toLowerCase();if(!(0,E.f3M)(sh)||"GET"===o.method||"HEAD"===o.method||c.startsWith("http://")||c.startsWith("https://"))return t(o);const i=(0,E.f3M)(fy).getToken(),h=(0,E.f3M)(Sf);return null!=i&&!o.headers.has(h)&&(o=o.clone({headers:o.headers.set(h,i)})),t(o)}var sc=function(o){return o[o.Interceptors=0]="Interceptors",o[o.LegacyInterceptors=1]="LegacyInterceptors",o[o.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",o[o.NoXsrfProtection=3]="NoXsrfProtection",o[o.JsonpSupport=4]="JsonpSupport",o[o.RequestsMadeViaParent=5]="RequestsMadeViaParent",o[o.Fetch=6]="Fetch",o}(sc||{});function Xc(o,t){return{\u0275kind:o,\u0275providers:t}}function my(...o){const t=[Ri,Ns,dy,{provide:rh,useExisting:dy},{provide:Gp,useExisting:Ns},{provide:Yc,useValue:py,multi:!0},{provide:sh,useValue:!0},{provide:fy,useClass:Rg}];for(const c of o)t.push(...c.\u0275providers);return(0,E.MR2)(t)}const Og=new E.OlP("LEGACY_INTERCEPTOR_FN");let Lg=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({providers:[my(Xc(sc.LegacyInterceptors,[{provide:Og,useFactory:uy},{provide:Yc,useExisting:Og,multi:!0}]))]}),t})(),Kc=(()=>{var o;class t{constructor(i){this.http=i,this.apiUrl=Cf_apiUrl}login(i,h){return this.http.post(`${this.apiUrl}/login`,{email:i,password:h})}register(i){return this.http.post(`${this.apiUrl}/register`,i)}formatUser(i){const h=new Date((new Date).getTime()+1e3*+i.expiresIn);return new Hp(i.username,i.token,i.userId,h)}runTimeoutInterval(i){const h=(new Date).getTime(),I=i.expireDate.getTime()-h;this.timeoutInterval=setTimeout(()=>{},I)}setUserInLocalStorage(i){localStorage.setItem("userData",JSON.stringify(i)),this.runTimeoutInterval(i)}getUserFromLocalStorage(){const i=localStorage.getItem("userData");if(i){const h=JSON.parse(i),w=new Date(h.expirationDate),I=new Hp(h.username,h.token,h.userId,w);return this.runTimeoutInterval(I),I}return null}getUserId(){const i=localStorage.getItem("userData");return i?JSON.parse(i).userId:null}logout(){localStorage.removeItem("userData"),this.timeoutInterval&&(clearTimeout(this.timeoutInterval),this.timeoutInterval=null)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ri))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();function Ng(o,t){if(1&o){const c=E.EpF();E.TgZ(0,"div")(1,"button",9),E.NdJ("click",function(){E.CHM(c);const h=E.oxw().$implicit,w=E.oxw();return E.KtG(w.goToEditPage(h._id))}),E._uU(2," Edit "),E.qZA()()}}function am(o,t){if(1&o&&(E.TgZ(0,"div",4)(1,"div",5)(2,"h5",6),E._uU(3),E.qZA(),E.TgZ(4,"p",7),E._uU(5),E.qZA()(),E.YNc(6,Ng,3,0,"div",8),E.qZA()),2&o){const c=t.$implicit,i=E.oxw();E.xp6(3),E.Oqu(c.title),E.xp6(2),E.Oqu(c.content),E.xp6(1),E.Q6J("ngIf",c.userId==i.userId)}}let Bg=(()=>{var o;class t{constructor(i,h,w){this.store=i,this.router=h,this.userService=w,this.blogs$=this.store.select(oy),this.loading$=this.store.select(Cg),this.error$=this.store.select(sy),this.userId=this.userService.getUserId()}ngOnInit(){}goToEditPage(i){console.log(i),this.router.navigate(["/posts/"+i])}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(on.yh),E.Y36(lo),E.Y36(Kc))},o.\u0275cmp=E.Xpm({type:o,selectors:[["app-blogs"]],decls:5,vars:3,consts:[[1,"container"],[1,"row"],[1,"col","d-flex","justify-content-center","flex-wrap"],["class","card m-2","style","width: 18rem",4,"ngFor","ngForOf"],[1,"card","m-2",2,"width","18rem"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(i,h){1&i&&(E.TgZ(0,"div",0)(1,"div",1)(2,"div",2),E.YNc(3,am,7,3,"div",3),E.ALo(4,"async"),E.qZA()()()),2&i&&(E.xp6(3),E.Q6J("ngForOf",E.lcZ(4,1,h.blogs$)))},dependencies:[_c,La,Vt]}),t})(),If=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275cmp=E.Xpm({type:o,selectors:[["app-home"]],decls:1,vars:0,template:function(i,h){1&i&&E._UZ(0,"app-blogs")},dependencies:[Bg]}),t})();const ah=(0,on.PH)("[Blog] Add Blog",(0,on.Ky)()),yy=(0,on.PH)("[Blog] Add Blog Success",(0,on.Ky)()),zg=(0,on.PH)("[Blog] Add Blog Failure",(0,on.Ky)());let Al=(()=>{var o;class t{constructor(i,h){this._renderer=i,this._elementRef=h,this.onChange=w=>{},this.onTouched=()=>{}}setProperty(i,h){this._renderer.setProperty(this._elementRef.nativeElement,i,h)}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}setDisabledState(i){this.setProperty("disabled",i)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(E.Qsj),E.Y36(E.SBq))},o.\u0275dir=E.lG2({type:o}),t})(),Ea=(()=>{var o;class t extends Al{}return(o=t).\u0275fac=function(){let c;return function(h){return(c||(c=E.n5z(o)))(h||o)}}(),o.\u0275dir=E.lG2({type:o,features:[E.qOj]}),t})();const vs=new E.OlP("NgValueAccessor"),Vg={provide:vs,useExisting:(0,E.Gpc)(()=>Ku),multi:!0},vy=new E.OlP("CompositionEventMode");let Ku=(()=>{var o;class t extends Al{constructor(i,h,w){super(i,h),this._compositionMode=w,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function uh(){const o=it()?it().getUserAgent():"";return/android (\d+)/.test(o.toLowerCase())}())}writeValue(i){this.setProperty("value",i??"")}_handleInput(i){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(i)}_compositionStart(){this._composing=!0}_compositionEnd(i){this._composing=!1,this._compositionMode&&this.onChange(i)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(E.Qsj),E.Y36(E.SBq),E.Y36(vy,8))},o.\u0275dir=E.lG2({type:o,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,h){1&i&&E.NdJ("input",function(I){return h._handleInput(I.target.value)})("blur",function(){return h.onTouched()})("compositionstart",function(){return h._compositionStart()})("compositionend",function(I){return h._compositionEnd(I.target.value)})},features:[E._Bn([Vg]),E.qOj]}),t})();function Pl(o){return null==o||("string"==typeof o||Array.isArray(o))&&0===o.length}function el(o){return null!=o&&"number"==typeof o.length}const vr=new E.OlP("NgValidators"),Rl=new E.OlP("NgAsyncValidators"),Ug=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Bs{static min(t){return function lm(o){return t=>{if(Pl(t.value)||Pl(o))return null;const c=parseFloat(t.value);return!isNaN(c)&&c<o?{min:{min:o,actual:t.value}}:null}}(t)}static max(t){return function by(o){return t=>{if(Pl(t.value)||Pl(o))return null;const c=parseFloat(t.value);return!isNaN(c)&&c>o?{max:{max:o,actual:t.value}}:null}}(t)}static required(t){return function jg(o){return Pl(o.value)?{required:!0}:null}(t)}static requiredTrue(t){return function lc(o){return!0===o.value?null:{required:!0}}(t)}static email(t){return function d0(o){return Pl(o.value)||Ug.test(o.value)?null:{email:!0}}(t)}static minLength(t){return function cc(o){return t=>Pl(t.value)||!el(t.value)?null:t.value.length<o?{minlength:{requiredLength:o,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function h0(o){return t=>el(t.value)&&t.value.length>o?{maxlength:{requiredLength:o,actualLength:t.value.length}}:null}(t)}static pattern(t){return function Pf(o){if(!o)return uc;let t,c;return"string"==typeof o?(c="","^"!==o.charAt(0)&&(c+="^"),c+=o,"$"!==o.charAt(o.length-1)&&(c+="$"),t=new RegExp(c)):(c=o.toString(),t=o),i=>{if(Pl(i.value))return null;const h=i.value;return t.test(h)?null:{pattern:{requiredPattern:c,actualValue:h}}}}(t)}static nullValidator(t){return null}static compose(t){return hh(t)}static composeAsync(t){return cm(t)}}function uc(o){return null}function Ju(o){return null!=o}function Rf(o){return(0,E.QGY)(o)?(0,ar.D)(o):o}function dh(o){let t={};return o.forEach(c=>{t=null!=c?{...t,...c}:t}),0===Object.keys(t).length?null:t}function Of(o,t){return t.map(c=>c(o))}function Jc(o){return o.map(t=>function xy(o){return!o.validate}(t)?t:c=>t.validate(c))}function hh(o){if(!o)return null;const t=o.filter(Ju);return 0==t.length?null:function(c){return dh(Of(c,t))}}function li(o){return null!=o?hh(Jc(o)):null}function cm(o){if(!o)return null;const t=o.filter(Ju);return 0==t.length?null:function(c){return function lh(...o){const t=(0,j.jO)(o),{args:c,keys:i}=v(o),h=new Vo.y(w=>{const{length:I}=c;if(!I)return void w.complete();const N=new Array(I);let Y=I,J=I;for(let xe=0;xe<I;xe++){let Ae=!1;(0,De.Xf)(c[xe]).subscribe((0,ee.x)(w,It=>{Ae||(Ae=!0,J--),N[xe]=It},()=>Y--,void 0,()=>{(!Y||!Ae)&&(J||w.next(i?q(i,N):N),w.complete())}))}});return t?h.pipe($(t)):h}(Of(c,t).map(Rf)).pipe((0,O.U)(dh))}}function kf(o){return null!=o?cm(Jc(o)):null}function Qu(o,t){return null===o?[t]:Array.isArray(o)?[...o,t]:[o,t]}function um(o){return o._rawValidators}function wy(o){return o._rawAsyncValidators}function ed(o){return o?Array.isArray(o)?o:[o]:[]}function dc(o,t){return Array.isArray(o)?o.includes(t):o===t}function Lf(o,t){const c=ed(t);return ed(o).forEach(h=>{dc(c,h)||c.push(h)}),c}function fh(o,t){return ed(t).filter(c=>!dc(o,c))}class $g{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=li(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=kf(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,c){return!!this.control&&this.control.hasError(t,c)}getError(t,c){return this.control?this.control.getError(t,c):null}}class ro extends $g{get formDirective(){return null}get path(){return null}}class ia extends $g{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class td{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let ph=(()=>{var o;class t extends td{constructor(i){super(i)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(ia,2))},o.\u0275dir=E.lG2({type:o,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,h){2&i&&E.ekj("ng-untouched",h.isUntouched)("ng-touched",h.isTouched)("ng-pristine",h.isPristine)("ng-dirty",h.isDirty)("ng-valid",h.isValid)("ng-invalid",h.isInvalid)("ng-pending",h.isPending)},features:[E.qOj]}),t})(),tl=(()=>{var o;class t extends td{constructor(i){super(i)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(ro,10))},o.\u0275dir=E.lG2({type:o,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,h){2&i&&E.ekj("ng-untouched",h.isUntouched)("ng-touched",h.isTouched)("ng-pristine",h.isPristine)("ng-dirty",h.isDirty)("ng-valid",h.isValid)("ng-invalid",h.isInvalid)("ng-pending",h.isPending)("ng-submitted",h.isSubmitted)},features:[E.qOj]}),t})();const zs="VALID",il="INVALID",ns="PENDING",Ca="DISABLED";function gh(o){return(_h(o)?o.validators:o)||null}function fm(o,t){return(_h(t)?t.asyncValidators:o)||null}function _h(o){return null!=o&&!Array.isArray(o)&&"object"==typeof o}class Da{constructor(t,c){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(c)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===zs}get invalid(){return this.status===il}get pending(){return this.status==ns}get disabled(){return this.status===Ca}get enabled(){return this.status!==Ca}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(Lf(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(Lf(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(fh(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(fh(t,this._rawAsyncValidators))}hasValidator(t){return dc(this._rawValidators,t)}hasAsyncValidator(t){return dc(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(c=>{c.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(c=>{c.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=ns,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const c=this._parentMarkedDirty(t.onlySelf);this.status=Ca,this.errors=null,this._forEachChild(i=>{i.disable({...t,onlySelf:!0})}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:c}),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const c=this._parentMarkedDirty(t.onlySelf);this.status=zs,this._forEachChild(i=>{i.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:c}),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===zs||this.status===ns)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(c=>c._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ca:zs}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=ns,this._hasOwnPendingAsyncValidator=!0;const c=Rf(this.asyncValidator(this));this._asyncValidationSubscription=c.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,c={}){this.errors=t,this._updateControlsErrors(!1!==c.emitEvent)}get(t){let c=t;return null==c||(Array.isArray(c)||(c=c.split(".")),0===c.length)?null:c.reduce((i,h)=>i&&i._find(h),this)}getError(t,c){const i=c?this.get(c):this;return i&&i.errors?i.errors[t]:null}hasError(t,c){return!!this.getError(t,c)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new E.vpe,this.statusChanges=new E.vpe}_calculateStatus(){return this._allControlsDisabled()?Ca:this.errors?il:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ns)?ns:this._anyControlsHaveStatus(il)?il:zs}_anyControlsHaveStatus(t){return this._anyControls(c=>c.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){_h(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=function hm(o){return Array.isArray(o)?li(o):o||null}(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=function Sy(o){return Array.isArray(o)?kf(o):o||null}(this._rawAsyncValidators)}}class hc extends Da{constructor(t,c,i){super(gh(c),fm(i,c)),this.controls=t,this._initObservables(),this._setUpdateStrategy(c),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,c){return this.controls[t]?this.controls[t]:(this.controls[t]=c,c.setParent(this),c._registerOnCollectionChange(this._onCollectionChange),c)}addControl(t,c,i={}){this.registerControl(t,c),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,c={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:c.emitEvent}),this._onCollectionChange()}setControl(t,c,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],c&&this.registerControl(t,c),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,c={}){(function Gg(o,t,c){o._forEachChild((i,h)=>{if(void 0===c[h])throw new E.vHH(1002,"")})})(this,0,t),Object.keys(t).forEach(i=>{(function Iy(o,t,c){const i=o.controls;if(!(t?Object.keys(i):i).length)throw new E.vHH(1e3,"");if(!i[c])throw new E.vHH(1001,"")})(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:c.emitEvent})}),this.updateValueAndValidity(c)}patchValue(t,c={}){null!=t&&(Object.keys(t).forEach(i=>{const h=this.controls[i];h&&h.patchValue(t[i],{onlySelf:!0,emitEvent:c.emitEvent})}),this.updateValueAndValidity(c))}reset(t={},c={}){this._forEachChild((i,h)=>{i.reset(t[h],{onlySelf:!0,emitEvent:c.emitEvent})}),this._updatePristine(c),this._updateTouched(c),this.updateValueAndValidity(c)}getRawValue(){return this._reduceChildren({},(t,c,i)=>(t[i]=c.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(c,i)=>!!i._syncPendingControls()||c);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(c=>{const i=this.controls[c];i&&t(i,c)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[c,i]of Object.entries(this.controls))if(this.contains(c)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(c,i,h)=>((i.enabled||this.disabled)&&(c[h]=i.value),c))}_reduceChildren(t,c){let i=t;return this._forEachChild((h,w)=>{i=c(i,h,w)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}const bs=new E.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>fc}),fc="always";function pm(o,t,c=fc){vh(o,t),t.valueAccessor.writeValue(o.value),(o.disabled||"always"===c)&&t.valueAccessor.setDisabledState?.(o.disabled),function To(o,t){t.valueAccessor.registerOnChange(c=>{o._pendingValue=c,o._pendingChange=!0,o._pendingDirty=!0,"change"===o.updateOn&&mm(o,t)})}(o,t),function ra(o,t){const c=(i,h)=>{t.valueAccessor.writeValue(i),h&&t.viewToModelUpdate(i)};o.registerOnChange(c),t._registerOnDestroy(()=>{o._unregisterOnChange(c)})}(o,t),function Wg(o,t){t.valueAccessor.registerOnTouched(()=>{o._pendingTouched=!0,"blur"===o.updateOn&&o._pendingChange&&mm(o,t),"submit"!==o.updateOn&&o.markAsTouched()})}(o,t),function id(o,t){if(t.valueAccessor.setDisabledState){const c=i=>{t.valueAccessor.setDisabledState(i)};o.registerOnDisabledChange(c),t._registerOnDestroy(()=>{o._unregisterOnDisabledChange(c)})}}(o,t)}function Qc(o,t,c=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),eu(o,t),o&&(t._invokeOnDestroyCallbacks(),o._registerOnCollectionChange(()=>{}))}function Ff(o,t){o.forEach(c=>{c.registerOnValidatorChange&&c.registerOnValidatorChange(t)})}function vh(o,t){const c=um(o);null!==t.validator?o.setValidators(Qu(c,t.validator)):"function"==typeof c&&o.setValidators([c]);const i=wy(o);null!==t.asyncValidator?o.setAsyncValidators(Qu(i,t.asyncValidator)):"function"==typeof i&&o.setAsyncValidators([i]);const h=()=>o.updateValueAndValidity();Ff(t._rawValidators,h),Ff(t._rawAsyncValidators,h)}function eu(o,t){let c=!1;if(null!==o){if(null!==t.validator){const h=um(o);if(Array.isArray(h)&&h.length>0){const w=h.filter(I=>I!==t.validator);w.length!==h.length&&(c=!0,o.setValidators(w))}}if(null!==t.asyncValidator){const h=wy(o);if(Array.isArray(h)&&h.length>0){const w=h.filter(I=>I!==t.asyncValidator);w.length!==h.length&&(c=!0,o.setAsyncValidators(w))}}}const i=()=>{};return Ff(t._rawValidators,i),Ff(t._rawAsyncValidators,i),c}function mm(o,t){o._pendingDirty&&o.markAsDirty(),o.setValue(o._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(o._pendingValue),o._pendingChange=!1}function ym(o,t){const c=o.indexOf(t);c>-1&&o.splice(c,1)}function Bf(o){return"object"==typeof o&&null!==o&&2===Object.keys(o).length&&"value"in o&&"disabled"in o}const rl=class extends Da{constructor(t=null,c,i){super(gh(c),fm(i,c)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(c),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),_h(c)&&(c.nonNullable||c.initialValueIsDefault)&&(this.defaultValue=Bf(t)?t.value:t)}setValue(t,c={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==c.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==c.emitViewToModelChange)),this.updateValueAndValidity(c)}patchValue(t,c={}){this.setValue(t,c)}reset(t=this.defaultValue,c={}){this._applyFormState(t),this.markAsPristine(c),this.markAsUntouched(c),this.setValue(this.value,c),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){ym(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){ym(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){Bf(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};let P=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275dir=E.lG2({type:o,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),t})(),G=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({}),t})();const de=new E.OlP("NgModelWithFormControlWarning"),Ee={provide:ro,useExisting:(0,E.Gpc)(()=>Je)};let Je=(()=>{var o;class t extends ro{constructor(i,h,w){super(),this.callSetDisabledState=w,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new E.vpe,this._setValidators(i),this._setAsyncValidators(h)}ngOnChanges(i){this._checkFormPresent(),i.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(eu(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(i){const h=this.form.get(i.path);return pm(h,i,this.callSetDisabledState),h.updateValueAndValidity({emitEvent:!1}),this.directives.push(i),h}getControl(i){return this.form.get(i.path)}removeControl(i){Qc(i.control||null,i,!1),function b0(o,t){const c=o.indexOf(t);c>-1&&o.splice(c,1)}(this.directives,i)}addFormGroup(i){this._setUpFormContainer(i)}removeFormGroup(i){this._cleanUpFormContainer(i)}getFormGroup(i){return this.form.get(i.path)}addFormArray(i){this._setUpFormContainer(i)}removeFormArray(i){this._cleanUpFormContainer(i)}getFormArray(i){return this.form.get(i.path)}updateModel(i,h){this.form.get(i.path).setValue(h)}onSubmit(i){return this.submitted=!0,function _m(o,t){o._syncPendingControls(),t.forEach(c=>{const i=c.control;"submit"===i.updateOn&&i._pendingChange&&(c.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(i),"dialog"===i?.target?.method}onReset(){this.resetForm()}resetForm(i=void 0){this.form.reset(i),this.submitted=!1}_updateDomValue(){this.directives.forEach(i=>{const h=i.control,w=this.form.get(i.path);h!==w&&(Qc(h||null,i),(o=>o instanceof rl)(w)&&(pm(w,i,this.callSetDisabledState),i.control=w))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(i){const h=this.form.get(i.path);(function tu(o,t){vh(o,t)})(h,i),h.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(i){if(this.form){const h=this.form.get(i.path);h&&function Zg(o,t){return eu(o,t)}(h,i)&&h.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){vh(this.form,this),this._oldForm&&eu(this._oldForm,this)}_checkFormPresent(){}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(vr,10),E.Y36(Rl,10),E.Y36(bs,8))},o.\u0275dir=E.lG2({type:o,selectors:[["","formGroup",""]],hostBindings:function(i,h){1&i&&E.NdJ("submit",function(I){return h.onSubmit(I)})("reset",function(){return h.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[E._Bn([Ee]),E.qOj,E.TTD]}),t})();const yt={provide:ia,useExisting:(0,E.Gpc)(()=>Mt)};let Mt=(()=>{var o;class t extends ia{set isDisabled(i){}constructor(i,h,w,I,N){super(),this._ngModelWarningConfig=N,this._added=!1,this.name=null,this.update=new E.vpe,this._ngModelWarningSent=!1,this._parent=i,this._setValidators(h),this._setAsyncValidators(w),this.valueAccessor=function Nf(o,t){if(!t)return null;let c,i,h;return Array.isArray(t),t.forEach(w=>{w.constructor===Ku?c=w:function Ly(o){return Object.getPrototypeOf(o.constructor)===Ea}(w)?i=w:h=w}),h||i||c||null}(0,I)}ngOnChanges(i){this._added||this._setUpControl(),function ky(o,t){if(!o.hasOwnProperty("model"))return!1;const c=o.model;return!!c.isFirstChange()||!Object.is(t,c.currentValue)}(i,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(i){this.viewModel=i,this.update.emit(i)}get path(){return function yh(o,t){return[...t.path,o]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return(o=t)._ngModelWarningSentOnce=!1,o.\u0275fac=function(i){return new(i||o)(E.Y36(ro,13),E.Y36(vr,10),E.Y36(Rl,10),E.Y36(vs,10),E.Y36(de,8))},o.\u0275dir=E.lG2({type:o,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[E._Bn([yt]),E.qOj,E.TTD]}),t})(),is=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[G]}),t})(),sd=(()=>{var o;class t{static withConfig(i){return{ngModule:t,providers:[{provide:bs,useValue:i.callSetDisabledState??fc}]}}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[is]}),t})(),Vf=(()=>{var o;class t{static withConfig(i){return{ngModule:t,providers:[{provide:de,useValue:i.warnOnNgModelWithFormControl??"always"},{provide:bs,useValue:i.callSetDisabledState??fc}]}}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[is]}),t})(),Kg=(()=>{var o;class t{constructor(i,h){this.store=i,this.router=h,this.addPost=new hc({title:new rl("",[Bs.minLength(4)]),content:new rl("",[Bs.minLength(4)])})}onSubmit(){if(this.addPost.valid){const i=this.addPost.get("title")?.value||"",h=this.addPost.get("content")?.value||"";this.store.dispatch(ah({title:i,content:h}))}else console.log("Form is not valid")}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(on.yh),E.Y36(lo))},o.\u0275cmp=E.Xpm({type:o,selectors:[["app-add-blog"]],decls:14,vars:1,consts:[[1,"container","center-form"],[1,"row"],[1,"col-md-12"],[1,"custom-form",3,"formGroup"],[1,"mb-3"],[1,"form-label"],["type","email","id","exampleInputEmail1","formControlName","title",1,"form-control"],["type","text","id","exampleInputPassword1","formControlName","content",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(i,h){1&i&&(E.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3)(4,"div",4)(5,"label",5),E._uU(6,"Title"),E.qZA(),E._UZ(7,"input",6),E.qZA(),E.TgZ(8,"div",4)(9,"label",5),E._uU(10,"Content"),E.qZA(),E._UZ(11,"input",7),E.qZA(),E.TgZ(12,"button",8),E.NdJ("click",function(){return h.onSubmit()}),E._uU(13," Submit "),E.qZA()()()()()),2&i&&(E.xp6(3),E.Q6J("formGroup",h.addPost))},dependencies:[P,Ku,ph,tl,Je,Mt]}),t})();const Vs=(0,on.ZF)("getBlog"),By=(0,on.P1)(Vs,o=>o),ou=(0,on.PH)("[Get Post] Get Post",(0,on.Ky)()),xm=(0,on.PH)("[Get Post Success] Get Post Success",(0,on.Ky)()),wm=(0,on.PH)("[Edit Post] Edit Post",(0,on.Ky)()),Ll=(0,on.PH)("[Edit Post] Edit Post",(0,on.Ky)());function xh(o,t){if(1&o){const c=E.EpF();E.TgZ(0,"div",2),E._UZ(1,"img",3),E.TgZ(2,"div",4)(3,"h5",5),E._uU(4),E.qZA(),E.TgZ(5,"p",6),E._uU(6),E.qZA(),E._UZ(7,"input",7),E.TgZ(8,"button",8),E.NdJ("click",function(){E.CHM(c);const h=E.oxw();return E.KtG(h.saveBlog())}),E._uU(9,"Save"),E.qZA()()()}if(2&o){const c=t.ngIf;E.xp6(1),E.Q6J("src","http://localhost:3000"+c.imageUrl,E.LSH),E.xp6(3),E.Oqu(c.title),E.xp6(2),E.Oqu(c.content),E.xp6(1),E.s9C("value",c.title)}}let Em=(()=>{var o;class t{constructor(i,h){this.store=i,this.route=h,this.blog$=this.store.select(By)}ngOnInit(){const i=this.route.snapshot.paramMap.get("id");null!==i&&this.store.dispatch(ou({blogId:i}))}saveBlog(){this.store.dispatch(wm({_id:"test",title:"test",content:"",imageUrl:""}))}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(on.yh),E.Y36(Jl))},o.\u0275cmp=E.Xpm({type:o,selectors:[["app-edit-blog"]],decls:3,vars:3,consts:[[1,"container","d-flex","justify-content-center"],["class","card","style","width: 18rem",4,"ngIf"],[1,"card",2,"width","18rem"],["alt","Blog Image",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["type","text",3,"value"],[1,"btn","btn-primary",3,"click"]],template:function(i,h){1&i&&(E.TgZ(0,"div",0),E.YNc(1,xh,10,4,"div",1),E.ALo(2,"async"),E.qZA()),2&i&&(E.xp6(1),E.Q6J("ngIf",E.lcZ(2,1,h.blog$)))},dependencies:[La,Vt]}),t})();const uo=(0,on.ZF)("auth"),wh=((0,on.P1)(uo,o=>o),(0,on.P1)(uo,o=>!!o.user)),h1=((0,on.P1)(uo,o=>o),(0,on.P1)(uo,o=>o),(0,on.P1)(uo,o=>o),(0,on.P1)(uo,o=>o.user?o.user.userToken:null));let w0=(()=>{var o;class t{constructor(i,h){this.store=i,this.router=h}canActivate(){return this.store.select(wh).pipe((0,O.U)(i=>!!i))}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(on.yh),E.LFG(lo))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();const zy=(0,on.PH)("[Blog] Load Blogs"),Vy=(0,on.PH)("[Blog] Load Blogs Success",(0,on.Ky)()),Rb=(0,on.PH)("[Blog] Load Blogs Failure",(0,on.Ky)());(0,on.PH)("[Blog] Load Blogs By User Id",(0,on.Ky)());let Ob=(()=>{var o;class t{constructor(i){this.store=i}resolve(){const i=localStorage.getItem("blogs");if(i){const h=JSON.parse(i);this.store.dispatch(Vy({blogs:h}))}else this.store.dispatch(zy())}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(on.yh))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();var f1=te(2574);const E0=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"home",component:If,canActivate:[w0],resolve:{blogs:Ob}},{path:"new-post",component:Kg,canActivate:[w0]},{path:"posts/:id",component:Em},{path:"map",component:(()=>{var o;class t{constructor(){}ngOnInit(){this.initializeMap()}initializeMap(){this.map=new f1.Map({accessToken:"pk.eyJ1IjoiZ29sZGd1biIsImEiOiJjbG0wbmN1djIxYnVvM2RwNjBjY2ZqdTJoIn0.IRn0RbczCcxZL0RKkO2Z2g",container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-74.5,40],zoom:9}),this.map.on("load",()=>{this.map.addLayer({id:"maptiler-layer",type:"raster",source:{type:"raster",tileSize:256},minzoom:0,maxzoom:22})})}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275cmp=E.Xpm({type:o,selectors:[["app-map"]],decls:1,vars:0,consts:[["id","map",1,"match-parent"]],template:function(i,h){1&i&&E._UZ(0,"div",0)},styles:[".map_box_container[_ngcontent-%COMP%]{position:relative;height:100%!important;width:100%!important}#map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%}"]}),t})()}];let p1=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[Tl.forRoot(E0),Tl]}),t})();const Fb=(0,on.PH)("[auth page] login start",(0,on.Ky)()),D0=(0,on.PH)("[auth page] login Success",(0,on.Ky)()),T0=(0,on.PH)("[Registration] Register",(0,on.Ky)()),$y=(0,on.PH)("[Registration] Register Success",(0,on.Ky)()),Hy=(0,on.PH)("[Registration] Register Failure",(0,on.Ky)()),M0=(0,on.PH)("[auth page] auto login"),Gy=(0,on.PH)("[auth page] logout");class Nb{}class m1{}const su="*";function S0(o,t=null){return{type:2,steps:o,options:t}}function ld(o){return{type:6,styles:o,offset:null}}function e_(o,t,c){return{type:0,name:o,styles:t,options:c}}class Uf{constructor(t=0,c=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+c}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const c="start"==t?this._onStartFns:this._onDoneFns;c.forEach(i=>i()),c.length=0}}class I0{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let c=0,i=0,h=0;const w=this.players.length;0==w?queueMicrotask(()=>this._onFinish()):this.players.forEach(I=>{I.onDone(()=>{++c==w&&this._onFinish()}),I.onDestroy(()=>{++i==w&&this._onDestroy()}),I.onStart(()=>{++h==w&&this._onStart()})}),this.totalTime=this.players.reduce((I,N)=>Math.max(I,N.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const c=t*this.totalTime;this.players.forEach(i=>{const h=i.totalTime?Math.min(1,c/i.totalTime):1;i.setPosition(h)})}getPosition(){const t=this.players.reduce((c,i)=>null===c||i.totalTime>c.totalTime?i:c,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const c="start"==t?this._onStartFns:this._onDoneFns;c.forEach(i=>i()),c.length=0}}const Vb=function Jg(o,t){return{type:7,name:o,definitions:t,options:{}}}("navbarAnimation",[e_("collapsed",ld({height:"0",opacity:"0"})),e_("expanded",ld({height:"*",opacity:"1"})),function t_(o,t,c=null){return{type:1,expr:o,animation:t,options:c}}("collapsed <=> expanded",function Qg(o,t=null){return{type:4,styles:t,timings:o}}("300ms ease-in-out"))]);function Ub(o,t){1&o&&(E.TgZ(0,"a",13),E._uU(1,"Blogs"),E.qZA())}function jb(o,t){1&o&&(E.TgZ(0,"a",14),E._uU(1,"New Post"),E.qZA())}function $b(o,t){1&o&&(E.TgZ(0,"li",7)(1,"a",15),E._uU(2,"Register"),E.qZA()())}function Hb(o,t){1&o&&(E.TgZ(0,"li",7)(1,"a",16),E._uU(2,"Login"),E.qZA()())}function Gb(o,t){1&o&&E._UZ(0,"li",7)}let Zy=(()=>{var o;class t{constructor(i){this.store=i,this.navbarState="expanded",this.lastScrollTop=0}ngOnInit(){this.isAuthenticated=this.store.select(wh)}onScroll(i){const h=window.pageYOffset||document.documentElement.scrollTop;this.navbarState=h>this.lastScrollTop?"collapsed":"expanded",this.lastScrollTop=h}logout(i){i.preventDefault(),this.store.dispatch(Gy())}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(on.yh))},o.\u0275cmp=E.Xpm({type:o,selectors:[["app-navbar"]],hostBindings:function(i,h){1&i&&E.NdJ("scroll",function(I){return h.onScroll(I)},!1,E.Jf7)},decls:26,vars:16,consts:[[1,"navbar","navbar-expand-md","navbar-light","bg-light","fixed-top"],[1,"container-fluid"],["href","#",1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarNav","aria-controls","navbarNav","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarNav",1,"collapse","navbar-collapse"],[1,"navbar-nav"],[1,"nav-item"],["class","nav-link","routerLink","/home",4,"ngIf"],["class","nav-link","routerLink","/new-post",4,"ngIf"],["routerLink","/map",1,"nav-link"],["class","nav-item",4,"ngIf"],["routerLink","/login",1,"nav-link",3,"click"],["routerLink","/home",1,"nav-link"],["routerLink","/new-post",1,"nav-link"],["routerLink","/register",1,"nav-link"],["routerLink","/login",1,"nav-link"]],template:function(i,h){1&i&&(E.TgZ(0,"nav",0)(1,"div",1)(2,"a",2),E._uU(3,"Navbar"),E.qZA(),E.TgZ(4,"button",3),E._UZ(5,"span",4),E.qZA(),E.TgZ(6,"div",5)(7,"ul",6),E._UZ(8,"li",7),E.TgZ(9,"li",7),E.YNc(10,Ub,2,0,"a",8),E.ALo(11,"async"),E.qZA(),E.TgZ(12,"li",7),E.YNc(13,jb,2,0,"a",9),E.ALo(14,"async"),E.qZA(),E.TgZ(15,"li",7)(16,"a",10),E._uU(17,"Map"),E.qZA()(),E.YNc(18,$b,3,0,"li",11),E.ALo(19,"async"),E.YNc(20,Hb,3,0,"li",11),E.ALo(21,"async"),E.YNc(22,Gb,1,0,"li",11),E.ALo(23,"async"),E.TgZ(24,"a",12),E.NdJ("click",function(I){return h.logout(I)}),E._uU(25,"Logout"),E.qZA()()()()()),2&i&&(E.Q6J("@navbarAnimation",h.navbarState),E.xp6(10),E.Q6J("ngIf",E.lcZ(11,6,h.isAuthenticated)),E.xp6(3),E.Q6J("ngIf",E.lcZ(14,8,h.isAuthenticated)),E.xp6(5),E.Q6J("ngIf",!E.lcZ(19,10,h.isAuthenticated)),E.xp6(2),E.Q6J("ngIf",!E.lcZ(21,12,h.isAuthenticated)),E.xp6(2),E.Q6J("ngIf",E.lcZ(23,14,h.isAuthenticated)))},dependencies:[La,Qd,Vt],styles:[".navbar[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;transition:top .3s}.navbar.navbar-hidden[_ngcontent-%COMP%]{top:-100px}"],data:{animation:[Vb]}}),t})(),Eh=(()=>{var o;class t{constructor(i){this.store=i}ngOnInit(){this.store.dispatch(M0())}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(on.yh))},o.\u0275cmp=E.Xpm({type:o,selectors:[["app-root"]],decls:2,vars:0,template:function(i,h){1&i&&E._UZ(0,"app-navbar")(1,"router-outlet")},dependencies:[tf,Zy]}),t})();function y1(o,t){1&o&&(E.TgZ(0,"span",12),E._uU(1," Email is required."),E.qZA())}function v1(o,t){1&o&&(E.TgZ(0,"span",12),E._uU(1," Email not valid."),E.qZA())}function A0(o,t){1&o&&(E.TgZ(0,"span",12),E._uU(1," Username is required."),E.qZA())}function jf(o,t){1&o&&(E.TgZ(0,"div",12),E._uU(1," Username must be at least 4 characters long. "),E.qZA())}const P0=[{path:"",children:[{path:"login",component:(()=>{var o;class t{constructor(i){this.store=i,this.loginForm=new hc({email:new rl("",[Bs.required,Bs.email]),password:new rl("",[Bs.required])})}onSubmit(){this.loginForm.valid&&(this.store.dispatch(Fb({email:this.loginForm.value.email||"",password:this.loginForm.value.password||""})),this.loginForm.reset())}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(on.yh))},o.\u0275cmp=E.Xpm({type:o,selectors:[["app-login"]],decls:14,vars:1,consts:[[1,"container","center-form"],[1,"row"],[1,"col-md-12"],[1,"custom-form",3,"formGroup"],[1,"mb-3"],["for","exampleInputEmail1",1,"form-label"],["type","email","id","exampleInputEmail1","formControlName","email",1,"form-control"],["for","exampleInputPassword1",1,"form-label"],["type","password","id","exampleInputPassword1","formControlName","password",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(i,h){1&i&&(E.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3)(4,"div",4)(5,"label",5),E._uU(6,"Email address"),E.qZA(),E._UZ(7,"input",6),E.qZA(),E.TgZ(8,"div",4)(9,"label",7),E._uU(10,"Password"),E.qZA(),E._UZ(11,"input",8),E.qZA(),E.TgZ(12,"button",9),E.NdJ("click",function(){return h.onSubmit()}),E._uU(13," Submit "),E.qZA()()()()()),2&i&&(E.xp6(3),E.Q6J("formGroup",h.loginForm))},dependencies:[P,Ku,ph,tl,Je,Mt],styles:[".btn-primary[_ngcontent-%COMP%], .custom-form[_ngcontent-%COMP%]   .custom-btn-primary[_ngcontent-%COMP%]{background-color:#333d51;border:none;font-size:13px;width:80px;line-height:24px}.center-form[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh}.custom-form[_ngcontent-%COMP%]{border:1px solid #cbd0d8;padding:20px;background:#cbd0d8;border-radius:10px;width:320px}.custom-form[_ngcontent-%COMP%]   .invalid-feedback[_ngcontent-%COMP%]{display:block}"]}),t})()},{path:"register",component:(()=>{var o;class t{constructor(i,h){this.store=i,this.router=h,this.emailForm=new hc({username:new rl("",[Bs.required,Bs.minLength(4)]),email:new rl("",[Bs.required,Bs.email]),password:new rl("",[Bs.required,Bs.minLength(4)])})}OnInit(){}onSubmit(){this.emailForm.valid&&(this.store.dispatch(T0({userData:{username:this.emailForm.value.username,email:this.emailForm.value.email,password:this.emailForm.value.password}})),this.router.navigate(["/login"]),this.emailForm.reset())}}return(o=t).\u0275fac=function(i){return new(i||o)(E.Y36(on.yh),E.Y36(lo))},o.\u0275cmp=E.Xpm({type:o,selectors:[["app-register"]],decls:22,vars:6,consts:[[1,"container","center-form"],[1,"row"],[1,"col-md-12"],[1,"custom-form",3,"formGroup","ngSubmit"],[1,"mb-3"],["for","exampleInputEmail1",1,"form-label"],["type","email","id","exampleInputEmail1","aria-describedby","emailHelp","formControlName","email",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["type","username","aria-describedby","username","formControlName","username",1,"form-control"],["for","exampleInputPassword1",1,"form-label"],["type","password","id","exampleInputPassword1","formControlName","password",1,"form-control"],["type","submit",1,"btn","btn-primary","custom-btn-primary",3,"disabled"],[1,"invalid-feedback"]],template:function(i,h){if(1&i&&(E.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),E.NdJ("ngSubmit",function(){return h.onSubmit()}),E.TgZ(4,"div",4)(5,"label",5),E._uU(6,"Email address"),E.qZA(),E._UZ(7,"input",6),E.YNc(8,y1,2,0,"span",7),E.YNc(9,v1,2,0,"span",7),E.qZA(),E.TgZ(10,"div",4)(11,"label",5),E._uU(12,"Username "),E.qZA(),E._UZ(13,"input",8),E.YNc(14,A0,2,0,"span",7),E.YNc(15,jf,2,0,"div",7),E.qZA(),E.TgZ(16,"div",4)(17,"label",9),E._uU(18,"Password"),E.qZA(),E._UZ(19,"input",10),E.qZA(),E.TgZ(20,"button",11),E._uU(21," Submit "),E.qZA()()()()()),2&i){let w,I,N,Y;E.xp6(3),E.Q6J("formGroup",h.emailForm),E.xp6(5),E.Q6J("ngIf",(null==(w=h.emailForm.get("email"))?null:w.hasError("required"))&&(null==(w=h.emailForm.get("email"))?null:w.touched)),E.xp6(1),E.Q6J("ngIf",(null==(I=h.emailForm.get("email"))?null:I.hasError("email"))&&(null==(I=h.emailForm.get("email"))?null:I.touched)),E.xp6(5),E.Q6J("ngIf",(null==(N=h.emailForm.get("username"))?null:N.hasError("required"))&&(null==(N=h.emailForm.get("username"))?null:N.touched)),E.xp6(1),E.Q6J("ngIf",((null==(Y=h.emailForm.get("username"))?null:Y.hasError("minlength"))||(null==(Y=h.emailForm.get("username"))?null:Y.hasError("required")))&&(null==(Y=h.emailForm.get("username"))?null:Y.touched)),E.xp6(5),E.Q6J("disabled",!h.emailForm.valid)}},dependencies:[La,P,Ku,ph,tl,Je,Mt],styles:[".btn-primary[_ngcontent-%COMP%], .custom-form[_ngcontent-%COMP%]   .custom-btn-primary[_ngcontent-%COMP%]{background-color:#333d51;border:none;font-size:13px;width:80px;line-height:24px}.center-form[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh}.custom-form[_ngcontent-%COMP%]{border:1px solid #cbd0d8;padding:20px;background:#cbd0d8;border-radius:10px;width:320px}.custom-form[_ngcontent-%COMP%]   .invalid-feedback[_ngcontent-%COMP%]{display:block}"]}),t})()}]}];let cD=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[gr,sd,Vf,Lg,Tl.forChild(P0)]}),t})();var uD=te(7632),R0=te(3019),b1=te(2420);class Dr{constructor(t,c,i){this.kind=t,this.value=c,this.error=i,this.hasValue="N"===t}observe(t){return O0(this,t)}do(t,c,i){const{kind:h,value:w,error:I}=this;return"N"===h?t?.(w):"E"===h?c?.(I):i?.()}accept(t,c,i){var h;return(0,us.m)(null===(h=t)||void 0===h?void 0:h.next)?this.observe(t):this.do(t,c,i)}toObservable(){const{kind:t,value:c,error:i}=this,h="N"===t?(0,Fn.of)(c):"E"===t?Oe(()=>i):"C"===t?Xe.E:0;if(!h)throw new TypeError(`Unexpected notification kind ${t}`);return h}static createNext(t){return new Dr("N",t)}static createError(t){return new Dr("E",void 0,t)}static createComplete(){return Dr.completeNotification}}function O0(o,t){var c,i,h;const{kind:w,value:I,error:N}=o;if("string"!=typeof w)throw new TypeError('Invalid notification, missing "kind"');"N"===w?null===(c=t.next)||void 0===c||c.call(t,I):"E"===w?null===(i=t.error)||void 0===i||i.call(t,N):null===(h=t.complete)||void 0===h||h.call(t)}function qb(o,t,c,i){return(0,Ve.e)((h,w)=>{let I;t&&"function"!=typeof t?({duration:c,element:I,connector:i}=t):I=t;const N=new Map,Y=St=>{N.forEach(St),St(w)},J=St=>Y(Qt=>Qt.error(St));let xe=0,Ae=!1;const It=new ee.Q(w,St=>{try{const Qt=o(St);let fn=N.get(Qt);if(!fn){N.set(Qt,fn=i?i():new _t.x);const Pn=function wt(St,Qt){const fn=new Vo.y(Pn=>{xe++;const ci=Qt.subscribe(Pn);return()=>{ci.unsubscribe(),0==--xe&&Ae&&It.unsubscribe()}});return fn.key=St,fn}(Qt,fn);if(w.next(Pn),c){const ci=(0,ee.x)(fn,()=>{fn.complete(),ci?.unsubscribe()},void 0,void 0,()=>N.delete(Qt));It.add((0,De.Xf)(c(Pn)).subscribe(ci))}}fn.next(I?I(St):St)}catch(Qt){J(Qt)}},()=>Y(St=>St.complete()),J,()=>N.clear(),()=>(Ae=!0,0===xe));h.subscribe(It)})}function n_(o,t){return t?c=>c.pipe(n_((i,h)=>(0,De.Xf)(o(i,h)).pipe((0,O.U)((w,I)=>t(i,w,h,I))))):(0,Ve.e)((c,i)=>{let h=0,w=null,I=!1;c.subscribe((0,ee.x)(i,N=>{w||(w=(0,ee.x)(i,void 0,()=>{w=null,I&&i.complete()}),(0,De.Xf)(o(N,h++)).subscribe(w))},()=>{I=!0,!w&&i.complete()}))})}Dr.completeNotification=new Dr("C");const Yb={dispatch:!0,functional:!1,useEffectsErrorHandler:!0},i_="__@ngrx/effects_create__";function ol(o,t={}){const c=t.functional?o:o(),i={...Yb,...t};return Object.defineProperty(c,i_,{value:i}),c}function Xb(o){return Object.getPrototypeOf(o)}function Jb(o){return"function"==typeof o}function qy(o){return o.filter(Jb)}function au(o,t,c){const i=Xb(o),w=i&&"Object"!==i.constructor.name?i.constructor.name:null,I=function k0(o){return function C1(o){return Object.getOwnPropertyNames(o).filter(i=>!(!o[i]||!o[i].hasOwnProperty(i_))&&o[i][i_].hasOwnProperty("dispatch")).map(i=>({propertyName:i,...o[i][i_]}))}(o)}(o).map(({propertyName:N,dispatch:Y,useEffectsErrorHandler:J})=>{const xe="function"==typeof o[N]?o[N]():o[N],Ae=J?c(xe,t):xe;return!1===Y?Ae.pipe(function Zb(){return(0,Ve.e)((o,t)=>{o.subscribe((0,ee.x)(t,b1.Z))})}()):Ae.pipe(function w1(){return(0,Ve.e)((o,t)=>{o.subscribe((0,ee.x)(t,c=>{t.next(Dr.createNext(c))},()=>{t.next(Dr.createComplete()),t.complete()},c=>{t.next(Dr.createError(c)),t.complete()}))})}()).pipe((0,O.U)(wt=>({effect:o[N],notification:wt,propertyName:N,sourceName:w,sourceInstance:o})))});return(0,R0.T)(...I)}function Qb(o,t,c=10){return o.pipe((0,an.K)(i=>(t&&t.handleError(i),c<=1?o:Qb(o,t,c-1))))}let Ma=(()=>{var o;class t extends Vo.y{constructor(i){super(),i&&(this.source=i)}lift(i){const h=new t;return h.source=this,h.operator=i,h}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(on.Y$))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();function rs(...o){return(0,ft.h)(t=>o.some(c=>"string"==typeof c?c===t.type:c.type===t.type))}const Fl=new E.OlP("@ngrx/effects Internal Root Guard"),r_=new E.OlP("@ngrx/effects User Provided Effects"),Yy=new E.OlP("@ngrx/effects Internal Root Effects"),ex=new E.OlP("@ngrx/effects Internal Root Effects Instances"),tx=new E.OlP("@ngrx/effects Internal Feature Effects"),nx=new E.OlP("@ngrx/effects Internal Feature Effects Instance Groups"),T1=new E.OlP("@ngrx/effects Effects Error Handler",{providedIn:"root",factory:()=>Qb}),Xy="@ngrx/effects/init";(0,on.PH)(Xy);function ax(o){return Jy(o,"ngrxOnInitEffects")}function Jy(o,t){return o&&t in o&&"function"==typeof o[t]}let F0=(()=>{var o;class t extends _t.x{constructor(i,h){super(),this.errorHandler=i,this.effectsErrorHandler=h}addEffects(i){this.next(i)}toActions(){return this.pipe(qb(i=>function Kb(o){return!!o.constructor&&"Object"!==o.constructor.name&&"Function"!==o.constructor.name}(i)?Xb(i):i),(0,Ct.z)(i=>i.pipe(qb(P1))),(0,Ct.z)(i=>{const h=i.pipe(n_(I=>function N0(o,t){return c=>{const i=au(c,o,t);return function A1(o){return Jy(o,"ngrxOnRunEffects")}(c)?c.ngrxOnRunEffects(i):i}}(this.errorHandler,this.effectsErrorHandler)(I)),(0,O.U)(I=>(function M1(o,t){if("N"===o.notification.kind){const c=o.notification.value;!function ix(o){return"function"!=typeof o&&o&&o.type&&"string"==typeof o.type}(c)&&t.handleError(new Error(`Effect ${function S1({propertyName:o,sourceInstance:t,sourceName:c}){const i="function"==typeof t[o];return c?`"${c}.${String(o)}${i?"()":""}"`:`"${String(o)}()"`}(o)} dispatched an invalid action: ${function I1(o){try{return JSON.stringify(o)}catch{return o}}(c)}`))}}(I,this.errorHandler),I.notification)),(0,ft.h)(I=>"N"===I.kind&&null!=I.value),function E1(){return(0,Ve.e)((o,t)=>{o.subscribe((0,ee.x)(t,c=>O0(c,t)))})}()),w=i.pipe((0,ct.q)(1),(0,ft.h)(ax),(0,O.U)(I=>I.ngrxOnInitEffects()));return(0,R0.T)(h,w)}))}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(E.qLn),E.LFG(T1))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();function P1(o){return function ox(o){return Jy(o,"ngrxOnIdentifyEffects")}(o)?o.ngrxOnIdentifyEffects():""}let s_=(()=>{var o;class t{get isStarted(){return!!this.effectsSubscription}constructor(i,h){this.effectSources=i,this.store=h,this.effectsSubscription=null}start(){this.effectsSubscription||(this.effectsSubscription=this.effectSources.toActions().subscribe(this.store))}ngOnDestroy(){this.effectsSubscription&&(this.effectsSubscription.unsubscribe(),this.effectsSubscription=null)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(F0),E.LFG(on.yh))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),B0=(()=>{var o;class t{constructor(i,h,w,I,N,Y,J){this.sources=i,h.start();for(const xe of I)i.addEffects(xe);w.dispatch({type:Xy})}addEffects(i){this.sources.addEffects(i)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(F0),E.LFG(s_),E.LFG(on.yh),E.LFG(ex),E.LFG(on.cr,8),E.LFG(on.CK,8),E.LFG(Fl,8))},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({}),t})(),lx=(()=>{var o;class t{constructor(i,h,w,I){const N=h.flat();for(const Y of N)i.addEffects(Y)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(B0),E.LFG(nx),E.LFG(on.cr,8),E.LFG(on.CK,8))},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({}),t})(),Dm=(()=>{var o;class t{static forFeature(...i){const h=i.flat(),w=qy(h);return{ngModule:lx,providers:[w,{provide:tx,multi:!0,useValue:h},{provide:r_,multi:!0,useValue:[]},{provide:nx,multi:!0,useFactory:z0,deps:[tx,r_]}]}}static forRoot(...i){const h=i.flat(),w=qy(h);return{ngModule:B0,providers:[w,{provide:Yy,useValue:[h]},{provide:Fl,useFactory:cx},{provide:r_,multi:!0,useValue:[]},{provide:ex,useFactory:z0,deps:[Yy,r_]}]}}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({}),t})();function z0(o,t){const c=[];for(const i of o)c.push(...i);for(const i of t)c.push(...i);return c.map(i=>function L0(o){return o instanceof E.OlP||Jb(o)}(i)?(0,E.f3M)(i):i)}function cx(){const o=(0,E.f3M)(s_,{optional:!0,skipSelf:!0}),t=(0,E.f3M)(Yy,{self:!0});if((1!==t.length||0!==t[0].length)&&o)throw new TypeError("EffectsModule.forRoot() called twice. Feature modules should use EffectsModule.forFeature() instead.");return"guarded"}const F1=(0,on.Lq)({email:null,password:"",token:null,loading:!1,error:null,success:!1},(0,on.on)(D0,(o,t)=>({...o,user:t.user})),(0,on.on)(Gy,o=>({...o,user:null})),(0,on.on)(T0,o=>({...o,loading:!0,error:null,success:!1})),(0,on.on)($y,o=>({...o,loading:!1,success:!0})),(0,on.on)(Hy,(o,{error:t})=>({...o,loading:!1,error:t,success:!1})));let N1=(()=>{var o;class t{constructor(i,h,w){this.actions$=i,this.loginService=h,this.router=w,this.login$=ol(()=>this.actions$.pipe(rs(Fb),n_(I=>this.loginService.login(I.email,I.password).pipe((0,O.U)(N=>{const Y=this.loginService.formatUser(N);return this.loginService.setUserInLocalStorage(Y),this.router.navigate(["home"]),D0({user:Y,redirect:!0})}))))),this.register$=ol(()=>this.actions$.pipe(rs(T0),(0,He.w)(({userData:I})=>this.loginService.register(I).pipe((0,O.U)(N=>$y({user:N})),(0,an.K)(N=>(console.error("HTTP Error:",N),(0,Fn.of)(Hy({error:N})))))))),this.autoLogin$=ol(()=>this.actions$.pipe(rs(M0),(0,Ct.z)(()=>{const I=this.loginService.getUserFromLocalStorage();return(0,Fn.of)(D0({user:I,redirect:!1}))}))),this.logout$=ol(()=>this.actions$.pipe(rs(Gy),(0,O.U)(I=>{this.loginService.logout(),this.router.navigate(["login"])})),{dispatch:!1})}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ma),E.LFG(Kc),E.LFG(lo))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})(),ux=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[on.Aw.forFeature("auth",F1),Dm.forFeature([N1])]}),t})();const z1=(0,on.Lq)({blogs:[],loading:!1,error:null},(0,on.on)(zy,o=>({...o,loading:!0})),(0,on.on)(Vy,(o,{blogs:t})=>({...o,blogs:t,loading:!1})),(0,on.on)(Rb,(o,{error:t})=>({...o,error:t,loading:!1})));let V1=(()=>{var o;class t{constructor(i){this.http=i,this.apiUrl=Cf_apiUrl}getBlogs(){return this.http.get(`${this.apiUrl}/posts`)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ri))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),U1=(()=>{var o;class t{constructor(i,h){this.actions$=i,this.blogService=h,this.loadBlogs$=ol(()=>this.actions$.pipe(rs(zy),(0,Ct.z)(()=>this.blogService.getBlogs().pipe((0,O.U)(w=>(localStorage.setItem("blogs",JSON.stringify(w)),Vy({blogs:w}))),(0,an.K)(w=>(0,Fn.of)(Rb({error:w.message})))))))}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ma),E.LFG(V1))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})(),dx=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({providers:[Ob],imports:[on.Aw.forFeature("blogs",z1),Dm.forFeature([U1])]}),t})(),j1=(()=>{var o;class t{constructor(i){this.http=i,this.apiUrl=Cf_apiUrl}createBlog(i,h){const w=new na({Authorization:`${h}`}),I=new FormData;return I.append("title",i.title),I.append("content",i.content),this.http.post(`${this.apiUrl}/posts`,i,{headers:w})}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ri))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),$1=(()=>{var o;class t{constructor(i,h){this.actions$=i,this.addBlogService=h,this.addBlog$=ol(()=>this.actions$.pipe(rs(ah),(0,He.w)(w=>this.addBlogService.createBlog(w,"asdas").pipe((0,O.U)(I=>(localStorage.removeItem("blogs"),yy({message:I.message,postId:I.postId}))),(0,an.K)(I=>(0,Fn.of)(zg({error:I.message})))))))}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ma),E.LFG(j1))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();const G1=(0,on.Lq)({message:null,postId:null,error:null},(0,on.on)(yy,(o,{message:t,postId:c})=>({...o,message:t,postId:c,error:null})),(0,on.on)(zg,(o,{error:t})=>({...o,message:null,postId:null,error:t})));let hx=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[on.Aw.forFeature("newBlog",G1),Dm.forFeature([$1])]}),t})();const Z1=(0,on.Lq)({_id:"",title:"",content:"",imageUrl:"",userId:""},(0,on.on)(xm,(o,{response:t})=>({...o,_id:t._id,title:t.title,content:t.content,imageUrl:t.imageUrl,userId:t.userId})));let fx=(()=>{var o;class t{constructor(i){this.http=i,this.apiUrl=Cf_apiUrl}getBlog(i){return this.http.get(`${this.apiUrl}/post/${i}`)}editBlog(i){const h=localStorage.getItem("token"),w=new na({Authorization:h});return this.http.put(`${this.apiUrl}/posts/64fc929e18e4d343a4e1fdb7`,i,{headers:w})}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ri))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),px=(()=>{var o;class t{constructor(i,h){this.actions$=i,this.blogService=h,this.getPostId$=ol(()=>this.actions$.pipe(rs(ou),(0,He.w)(w=>this.blogService.getBlog(w.blogId).pipe((0,O.U)(I=>xm({response:I}))))))}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ma),E.LFG(fx))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})(),mx=(()=>{var o;class t{constructor(i,h){this.actions$=i,this.blogService=h,this.editPost$=ol(()=>this.actions$.pipe(rs(wm),(0,He.w)(({_id:w,title:I,content:N,imageUrl:Y})=>this.blogService.editBlog({_id:w,title:I,content:N,imageUrl:Y}).pipe((0,O.U)(J=>(console.log(J),Ll({response:J})))))))}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ma),E.LFG(fx))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})(),V0=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[on.Aw.forFeature("getBlog",Z1),Dm.forFeature([mx,px])]}),t})(),gx=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[dx,hx,ux,V0,dx,hx,ux,V0]}),t})(),_x=(()=>{var o;class t{constructor(i){this.store=i}intercept(i,h){return this.store.select(h1).pipe((0,ct.q)(1),n_(w=>{if(!w)return h.handle(i);let I=i.clone({setHeaders:{Authorization:`${w}`}});return h.handle(I)}))}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(on.yh))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();function U0(o){return new E.vHH(3e3,!1)}function Ch(o){switch(o.length){case 0:return new Uf;case 1:return o[0];default:return new I0(o)}}function Ax(o,t,c=new Map,i=new Map){const h=[],w=[];let I=-1,N=null;if(t.forEach(Y=>{const J=Y.get("offset"),xe=J==I,Ae=xe&&N||new Map;Y.forEach((It,wt)=>{let St=wt,Qt=It;if("offset"!==wt)switch(St=o.normalizePropertyName(St,h),Qt){case"!":Qt=c.get(wt);break;case su:Qt=i.get(wt);break;default:Qt=o.normalizeStyleValue(wt,St,Qt,h)}Ae.set(St,Qt)}),xe||w.push(Ae),N=Ae,I=J}),h.length)throw function mD(o){return new E.vHH(3502,!1)}();return w}function Im(o,t,c,i){switch(t){case"start":o.onStart(()=>i(c&&tv(c,"start",o)));break;case"done":o.onDone(()=>i(c&&tv(c,"done",o)));break;case"destroy":o.onDestroy(()=>i(c&&tv(c,"destroy",o)))}}function tv(o,t,c){const w=nv(o.element,o.triggerName,o.fromState,o.toState,t||o.phaseName,c.totalTime??o.totalTime,!!c.disabled),I=o._data;return null!=I&&(w._data=I),w}function nv(o,t,c,i,h="",w=0,I){return{element:o,triggerName:t,fromState:c,toState:i,phaseName:h,totalTime:w,disabled:!!I}}function Ia(o,t,c){let i=o.get(t);return i||o.set(t,i=c),i}function Px(o){const t=o.indexOf(":");return[o.substring(1,t),o.slice(t+1)]}const l_=(()=>typeof document>"u"?null:document.documentElement)();function Hf(o){const t=o.parentNode||o.host||null;return t===l_?null:t}let Gf=null,Rx=!1;function Lx(o,t){for(;t;){if(t===o)return!0;t=Hf(t)}return!1}function $0(o,t,c){if(c)return Array.from(o.querySelectorAll(t));const i=o.querySelector(t);return i?[i]:[]}let Fx=(()=>{var o;class t{validateStyleProperty(i){return function Ox(o){Gf||(Gf=function kx(){return typeof document<"u"?document.body:null}()||{},Rx=!!Gf.style&&"WebkitAppearance"in Gf.style);let t=!0;return Gf.style&&!function oE(o){return"ebkit"==o.substring(1,6)}(o)&&(t=o in Gf.style,!t&&Rx&&(t="Webkit"+o.charAt(0).toUpperCase()+o.slice(1)in Gf.style)),t}(i)}matchesElement(i,h){return!1}containsElement(i,h){return Lx(i,h)}getParentElement(i){return Hf(i)}query(i,h,w){return $0(i,h,w)}computeStyle(i,h,w){return w||""}animate(i,h,w,I,N,Y=[],J){return new Uf(w,I)}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})(),Nx=(()=>{class t{}return t.NOOP=new Fx,t})();const yD=1e3,iv="ng-enter",Wf="ng-leave",rv="ng-trigger",ov=".ng-trigger",H0="ng-animating",Zf=".ng-animating";function cd(o){if("number"==typeof o)return o;const t=o.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:G0(parseFloat(t[1]),t[2])}function G0(o,t){return"s"===t?o*yD:o}function sv(o,t,c){return o.hasOwnProperty("duration")?o:function lE(o,t,c){let h,w=0,I="";if("string"==typeof o){const N=o.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===N)return t.push(U0()),{duration:0,delay:0,easing:""};h=G0(parseFloat(N[1]),N[2]);const Y=N[3];null!=Y&&(w=G0(parseFloat(Y),N[4]));const J=N[5];J&&(I=J)}else h=o;if(!c){let N=!1,Y=t.length;h<0&&(t.push(function yx(){return new E.vHH(3100,!1)}()),N=!0),w<0&&(t.push(function vx(){return new E.vHH(3101,!1)}()),N=!0),N&&t.splice(Y,0,U0())}return{duration:h,delay:w,easing:I}}(o,t,c)}function av(o,t={}){return Object.keys(o).forEach(c=>{t[c]=o[c]}),t}function Bx(o){const t=new Map;return Object.keys(o).forEach(c=>{t.set(c,o[c])}),t}function Dh(o,t=new Map,c){if(c)for(let[i,h]of c)t.set(i,h);for(let[i,h]of o)t.set(i,h);return t}function Aa(o,t,c){t.forEach((i,h)=>{const w=Z0(h);c&&!c.has(h)&&c.set(h,o.style[w]),o.style[w]=i})}function qf(o,t){t.forEach((c,i)=>{const h=Z0(i);o.style[h]=""})}function Am(o){return Array.isArray(o)?1==o.length?o[0]:S0(o):o}const lv=new RegExp("{{\\s*(.+?)\\s*}}","g");function Ux(o){let t=[];if("string"==typeof o){let c;for(;c=lv.exec(o);)t.push(c[1]);lv.lastIndex=0}return t}function Pm(o,t,c){const i=o.toString(),h=i.replace(lv,(w,I)=>{let N=t[I];return null==N&&(c.push(function xx(o){return new E.vHH(3003,!1)}()),N=""),N.toString()});return h==i?o:h}function cv(o){const t=[];let c=o.next();for(;!c.done;)t.push(c.value),c=o.next();return t}const W0=/-+([a-z0-9])/g;function Z0(o){return o.replace(W0,(...t)=>t[1].toUpperCase())}function sl(o,t,c){switch(t.type){case 7:return o.visitTrigger(t,c);case 0:return o.visitState(t,c);case 1:return o.visitTransition(t,c);case 2:return o.visitSequence(t,c);case 3:return o.visitGroup(t,c);case 4:return o.visitAnimate(t,c);case 5:return o.visitKeyframes(t,c);case 6:return o.visitStyle(t,c);case 8:return o.visitReference(t,c);case 9:return o.visitAnimateChild(t,c);case 10:return o.visitAnimateRef(t,c);case 11:return o.visitQuery(t,c);case 12:return o.visitStagger(t,c);default:throw function $f(o){return new E.vHH(3004,!1)}()}}function $x(o,t){return window.getComputedStyle(o)[t]}const uv="*";function fE(o,t){const c=[];return"string"==typeof o?o.split(/\s*,\s*/).forEach(i=>function pE(o,t,c){if(":"==o[0]){const Y=function mE(o,t){switch(o){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(c,i)=>parseFloat(i)>parseFloat(c);case":decrement":return(c,i)=>parseFloat(i)<parseFloat(c);default:return t.push(function eE(o){return new E.vHH(3016,!1)}()),"* => *"}}(o,c);if("function"==typeof Y)return void t.push(Y);o=Y}const i=o.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return c.push(function Sm(o){return new E.vHH(3015,!1)}()),t;const h=i[1],w=i[2],I=i[3];t.push(q0(h,I));"<"==w[0]&&!(h==uv&&I==uv)&&t.push(q0(I,h))}(i,c,t)):c.push(o),c}const dv=new Set(["true","1"]),c_=new Set(["false","0"]);function q0(o,t){const c=dv.has(o)||c_.has(o),i=dv.has(t)||c_.has(t);return(h,w)=>{let I=o==uv||o==h,N=t==uv||t==w;return!I&&c&&"boolean"==typeof h&&(I=h?dv.has(o):c_.has(o)),!N&&i&&"boolean"==typeof w&&(N=w?dv.has(t):c_.has(t)),I&&N}}const gE=new RegExp("s*:selfs*,?","g");function hv(o,t,c,i){return new _E(o).build(t,c,i)}class _E{constructor(t){this._driver=t}build(t,c,i){const h=new Y0(c);return this._resetContextStyleTimingState(h),sl(this,Am(t),h)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,c){let i=c.queryCount=0,h=c.depCount=0;const w=[],I=[];return"@"==t.name.charAt(0)&&c.errors.push(function X1(){return new E.vHH(3006,!1)}()),t.definitions.forEach(N=>{if(this._resetContextStyleTimingState(c),0==N.type){const Y=N,J=Y.name;J.toString().split(/\s*,\s*/).forEach(xe=>{Y.name=xe,w.push(this.visitState(Y,c))}),Y.name=J}else if(1==N.type){const Y=this.visitTransition(N,c);i+=Y.queryCount,h+=Y.depCount,I.push(Y)}else c.errors.push(function Tm(){return new E.vHH(3007,!1)}())}),{type:7,name:t.name,states:w,transitions:I,queryCount:i,depCount:h,options:null}}visitState(t,c){const i=this.visitStyle(t.styles,c),h=t.options&&t.options.params||null;if(i.containsDynamicStyles){const w=new Set,I=h||{};i.styles.forEach(N=>{N instanceof Map&&N.forEach(Y=>{Ux(Y).forEach(J=>{I.hasOwnProperty(J)||w.add(J)})})}),w.size&&(cv(w.values()),c.errors.push(function fD(o,t){return new E.vHH(3008,!1)}()))}return{type:0,name:t.name,style:i,options:h?{params:h}:null}}visitTransition(t,c){c.queryCount=0,c.depCount=0;const i=sl(this,Am(t.animation),c);return{type:1,matchers:fE(t.expr,c.errors),animation:i,queryCount:c.queryCount,depCount:c.depCount,options:ud(t.options)}}visitSequence(t,c){return{type:2,steps:t.steps.map(i=>sl(this,i,c)),options:ud(t.options)}}visitGroup(t,c){const i=c.currentTime;let h=0;const w=t.steps.map(I=>{c.currentTime=i;const N=sl(this,I,c);return h=Math.max(h,c.currentTime),N});return c.currentTime=h,{type:3,steps:w,options:ud(t.options)}}visitAnimate(t,c){const i=function Zx(o,t){if(o.hasOwnProperty("duration"))return o;if("number"==typeof o)return K0(sv(o,t).duration,0,"");const c=o;if(c.split(/\s+/).some(w=>"{"==w.charAt(0)&&"{"==w.charAt(1))){const w=K0(0,0,"");return w.dynamic=!0,w.strValue=c,w}const h=sv(c,t);return K0(h.duration,h.delay,h.easing)}(t.timings,c.errors);c.currentAnimateTimings=i;let h,w=t.styles?t.styles:ld({});if(5==w.type)h=this.visitKeyframes(w,c);else{let I=t.styles,N=!1;if(!I){N=!0;const J={};i.easing&&(J.easing=i.easing),I=ld(J)}c.currentTime+=i.duration+i.delay;const Y=this.visitStyle(I,c);Y.isEmptyStep=N,h=Y}return c.currentAnimateTimings=null,{type:4,timings:i,style:h,options:null}}visitStyle(t,c){const i=this._makeStyleAst(t,c);return this._validateStyleAst(i,c),i}_makeStyleAst(t,c){const i=[],h=Array.isArray(t.styles)?t.styles:[t.styles];for(let N of h)"string"==typeof N?N===su?i.push(N):c.errors.push(new E.vHH(3002,!1)):i.push(Bx(N));let w=!1,I=null;return i.forEach(N=>{if(N instanceof Map&&(N.has("easing")&&(I=N.get("easing"),N.delete("easing")),!w))for(let Y of N.values())if(Y.toString().indexOf("{{")>=0){w=!0;break}}),{type:6,styles:i,easing:I,offset:t.offset,containsDynamicStyles:w,options:null}}_validateStyleAst(t,c){const i=c.currentAnimateTimings;let h=c.currentTime,w=c.currentTime;i&&w>0&&(w-=i.duration+i.delay),t.styles.forEach(I=>{"string"!=typeof I&&I.forEach((N,Y)=>{const J=c.collectedStyles.get(c.currentQuerySelector),xe=J.get(Y);let Ae=!0;xe&&(w!=h&&w>=xe.startTime&&h<=xe.endTime&&(c.errors.push(function wx(o,t,c,i,h){return new E.vHH(3010,!1)}()),Ae=!1),w=xe.startTime),Ae&&J.set(Y,{startTime:w,endTime:h}),c.options&&function cE(o,t,c){const i=t.params||{},h=Ux(o);h.length&&h.forEach(w=>{i.hasOwnProperty(w)||c.push(function bx(o){return new E.vHH(3001,!1)}())})}(N,c.options,c.errors)})})}visitKeyframes(t,c){const i={type:5,styles:[],options:null};if(!c.currentAnimateTimings)return c.errors.push(function Ex(){return new E.vHH(3011,!1)}()),i;let w=0;const I=[];let N=!1,Y=!1,J=0;const xe=t.steps.map(Pn=>{const ci=this._makeStyleAst(Pn,c);let Tr=null!=ci.offset?ci.offset:function X0(o){if("string"==typeof o)return null;let t=null;if(Array.isArray(o))o.forEach(c=>{if(c instanceof Map&&c.has("offset")){const i=c;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(o instanceof Map&&o.has("offset")){const c=o;t=parseFloat(c.get("offset")),c.delete("offset")}return t}(ci.styles),Mi=0;return null!=Tr&&(w++,Mi=ci.offset=Tr),Y=Y||Mi<0||Mi>1,N=N||Mi<J,J=Mi,I.push(Mi),ci});Y&&c.errors.push(function pD(){return new E.vHH(3012,!1)}()),N&&c.errors.push(function Mm(){return new E.vHH(3200,!1)}());const Ae=t.steps.length;let It=0;w>0&&w<Ae?c.errors.push(function K1(){return new E.vHH(3202,!1)}()):0==w&&(It=1/(Ae-1));const wt=Ae-1,St=c.currentTime,Qt=c.currentAnimateTimings,fn=Qt.duration;return xe.forEach((Pn,ci)=>{const Tr=It>0?ci==wt?1:It*ci:I[ci],Mi=Tr*fn;c.currentTime=St+Qt.delay+Mi,Qt.duration=Mi,this._validateStyleAst(Pn,c),Pn.offset=Tr,i.styles.push(Pn)}),i}visitReference(t,c){return{type:8,animation:sl(this,Am(t.animation),c),options:ud(t.options)}}visitAnimateChild(t,c){return c.depCount++,{type:9,options:ud(t.options)}}visitAnimateRef(t,c){return{type:10,animation:this.visitReference(t.animation,c),options:ud(t.options)}}visitQuery(t,c){const i=c.currentQuerySelector,h=t.options||{};c.queryCount++,c.currentQuery=t;const[w,I]=function yE(o){const t=!!o.split(/\s*,\s*/).find(c=>":self"==c);return t&&(o=o.replace(gE,"")),o=o.replace(/@\*/g,ov).replace(/@\w+/g,c=>ov+"-"+c.slice(1)).replace(/:animating/g,Zf),[o,t]}(t.selector);c.currentQuerySelector=i.length?i+" "+w:w,Ia(c.collectedStyles,c.currentQuerySelector,new Map);const N=sl(this,Am(t.animation),c);return c.currentQuery=null,c.currentQuerySelector=i,{type:11,selector:w,limit:h.limit||0,optional:!!h.optional,includeSelf:I,animation:N,originalSelector:t.selector,options:ud(t.options)}}visitStagger(t,c){c.currentQuery||c.errors.push(function J1(){return new E.vHH(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:sv(t.timings,c.errors,!0);return{type:12,animation:sl(this,Am(t.animation),c),timings:i,options:null}}}class Y0{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function ud(o){return o?(o=av(o)).params&&(o.params=function vE(o){return o?av(o):null}(o.params)):o={},o}function K0(o,t,c){return{duration:o,delay:t,easing:c}}function J0(o,t,c,i,h,w,I=null,N=!1){return{type:1,element:o,keyframes:t,preStyleProps:c,postStyleProps:i,duration:h,delay:w,totalTime:h+w,easing:I,subTimeline:N}}class Rm{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,c){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...c)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const Yf=new RegExp(":enter","g"),xE=new RegExp(":leave","g");function Xx(o,t,c,i,h,w=new Map,I=new Map,N,Y,J=[]){return(new Q0).buildKeyframes(o,t,c,i,h,w,I,N,Y,J)}class Q0{buildKeyframes(t,c,i,h,w,I,N,Y,J,xe=[]){J=J||new Rm;const Ae=new eb(t,c,J,h,w,xe,[]);Ae.options=Y;const It=Y.delay?cd(Y.delay):0;Ae.currentTimeline.delayNextStep(It),Ae.currentTimeline.setStyles([I],null,Ae.errors,Y),sl(this,i,Ae);const wt=Ae.timelines.filter(St=>St.containsAnimation());if(wt.length&&N.size){let St;for(let Qt=wt.length-1;Qt>=0;Qt--){const fn=wt[Qt];if(fn.element===c){St=fn;break}}St&&!St.allowOnlyTimelineStyles()&&St.setStyles([N],null,Ae.errors,Y)}return wt.length?wt.map(St=>St.buildKeyframes()):[J0(c,[],[],[],0,It,"",!1)]}visitTrigger(t,c){}visitState(t,c){}visitTransition(t,c){}visitAnimateChild(t,c){const i=c.subInstructions.get(c.element);if(i){const h=c.createSubContext(t.options),w=c.currentTimeline.currentTime,I=this._visitSubInstructions(i,h,h.options);w!=I&&c.transformIntoNewTimeline(I)}c.previousNode=t}visitAnimateRef(t,c){const i=c.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],c,i),this.visitReference(t.animation,i),c.transformIntoNewTimeline(i.currentTimeline.currentTime),c.previousNode=t}_applyAnimationRefDelays(t,c,i){for(const h of t){const w=h?.delay;if(w){const I="number"==typeof w?w:cd(Pm(w,h?.params??{},c.errors));i.delayNextStep(I)}}}_visitSubInstructions(t,c,i){let w=c.currentTimeline.currentTime;const I=null!=i.duration?cd(i.duration):null,N=null!=i.delay?cd(i.delay):null;return 0!==I&&t.forEach(Y=>{const J=c.appendInstructionToTimeline(Y,I,N);w=Math.max(w,J.duration+J.delay)}),w}visitReference(t,c){c.updateOptions(t.options,!0),sl(this,t.animation,c),c.previousNode=t}visitSequence(t,c){const i=c.subContextCount;let h=c;const w=t.options;if(w&&(w.params||w.delay)&&(h=c.createSubContext(w),h.transformIntoNewTimeline(),null!=w.delay)){6==h.previousNode.type&&(h.currentTimeline.snapshotCurrentStyles(),h.previousNode=Om);const I=cd(w.delay);h.delayNextStep(I)}t.steps.length&&(t.steps.forEach(I=>sl(this,I,h)),h.currentTimeline.applyStylesToKeyframe(),h.subContextCount>i&&h.transformIntoNewTimeline()),c.previousNode=t}visitGroup(t,c){const i=[];let h=c.currentTimeline.currentTime;const w=t.options&&t.options.delay?cd(t.options.delay):0;t.steps.forEach(I=>{const N=c.createSubContext(t.options);w&&N.delayNextStep(w),sl(this,I,N),h=Math.max(h,N.currentTimeline.currentTime),i.push(N.currentTimeline)}),i.forEach(I=>c.currentTimeline.mergeTimelineCollectedStyles(I)),c.transformIntoNewTimeline(h),c.previousNode=t}_visitTiming(t,c){if(t.dynamic){const i=t.strValue;return sv(c.params?Pm(i,c.params,c.errors):i,c.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,c){const i=c.currentAnimateTimings=this._visitTiming(t.timings,c),h=c.currentTimeline;i.delay&&(c.incrementTime(i.delay),h.snapshotCurrentStyles());const w=t.style;5==w.type?this.visitKeyframes(w,c):(c.incrementTime(i.duration),this.visitStyle(w,c),h.applyStylesToKeyframe()),c.currentAnimateTimings=null,c.previousNode=t}visitStyle(t,c){const i=c.currentTimeline,h=c.currentAnimateTimings;!h&&i.hasCurrentStyleProperties()&&i.forwardFrame();const w=h&&h.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(w):i.setStyles(t.styles,w,c.errors,c.options),c.previousNode=t}visitKeyframes(t,c){const i=c.currentAnimateTimings,h=c.currentTimeline.duration,w=i.duration,N=c.createSubContext().currentTimeline;N.easing=i.easing,t.styles.forEach(Y=>{N.forwardTime((Y.offset||0)*w),N.setStyles(Y.styles,Y.easing,c.errors,c.options),N.applyStylesToKeyframe()}),c.currentTimeline.mergeTimelineCollectedStyles(N),c.transformIntoNewTimeline(h+w),c.previousNode=t}visitQuery(t,c){const i=c.currentTimeline.currentTime,h=t.options||{},w=h.delay?cd(h.delay):0;w&&(6===c.previousNode.type||0==i&&c.currentTimeline.hasCurrentStyleProperties())&&(c.currentTimeline.snapshotCurrentStyles(),c.previousNode=Om);let I=i;const N=c.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!h.optional,c.errors);c.currentQueryTotal=N.length;let Y=null;N.forEach((J,xe)=>{c.currentQueryIndex=xe;const Ae=c.createSubContext(t.options,J);w&&Ae.delayNextStep(w),J===c.element&&(Y=Ae.currentTimeline),sl(this,t.animation,Ae),Ae.currentTimeline.applyStylesToKeyframe(),I=Math.max(I,Ae.currentTimeline.currentTime)}),c.currentQueryIndex=0,c.currentQueryTotal=0,c.transformIntoNewTimeline(I),Y&&(c.currentTimeline.mergeTimelineCollectedStyles(Y),c.currentTimeline.snapshotCurrentStyles()),c.previousNode=t}visitStagger(t,c){const i=c.parentContext,h=c.currentTimeline,w=t.timings,I=Math.abs(w.duration),N=I*(c.currentQueryTotal-1);let Y=I*c.currentQueryIndex;switch(w.duration<0?"reverse":w.easing){case"reverse":Y=N-Y;break;case"full":Y=i.currentStaggerTime}const xe=c.currentTimeline;Y&&xe.delayNextStep(Y);const Ae=xe.currentTime;sl(this,t.animation,c),c.previousNode=t,i.currentStaggerTime=h.currentTime-Ae+(h.startTime-i.currentTimeline.startTime)}}const Om={};class eb{constructor(t,c,i,h,w,I,N,Y){this._driver=t,this.element=c,this.subInstructions=i,this._enterClassName=h,this._leaveClassName=w,this.errors=I,this.timelines=N,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Om,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=Y||new u_(this._driver,c,0),N.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,c){if(!t)return;const i=t;let h=this.options;null!=i.duration&&(h.duration=cd(i.duration)),null!=i.delay&&(h.delay=cd(i.delay));const w=i.params;if(w){let I=h.params;I||(I=this.options.params={}),Object.keys(w).forEach(N=>{(!c||!I.hasOwnProperty(N))&&(I[N]=Pm(w[N],I,this.errors))})}}_copyOptions(){const t={};if(this.options){const c=this.options.params;if(c){const i=t.params={};Object.keys(c).forEach(h=>{i[h]=c[h]})}}return t}createSubContext(t=null,c,i){const h=c||this.element,w=new eb(this._driver,h,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(h,i||0));return w.previousNode=this.previousNode,w.currentAnimateTimings=this.currentAnimateTimings,w.options=this._copyOptions(),w.updateOptions(t),w.currentQueryIndex=this.currentQueryIndex,w.currentQueryTotal=this.currentQueryTotal,w.parentContext=this,this.subContextCount++,w}transformIntoNewTimeline(t){return this.previousNode=Om,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,c,i){const h={duration:c??t.duration,delay:this.currentTimeline.currentTime+(i??0)+t.delay,easing:""},w=new Kx(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,h,t.stretchStartingKeyframe);return this.timelines.push(w),h}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,c,i,h,w,I){let N=[];if(h&&N.push(this.element),t.length>0){t=(t=t.replace(Yf,"."+this._enterClassName)).replace(xE,"."+this._leaveClassName);let J=this._driver.query(this.element,t,1!=i);0!==i&&(J=i<0?J.slice(J.length+i,J.length):J.slice(0,i)),N.push(...J)}return!w&&0==N.length&&I.push(function Q1(o){return new E.vHH(3014,!1)}()),N}}class u_{constructor(t,c,i,h){this._driver=t,this.element=c,this.startTime=i,this._elementTimelineStylesLookup=h,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(c),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(c,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const c=1===this._keyframes.size&&this._pendingStyles.size;this.duration||c?(this.forwardTime(this.currentTime+t),c&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,c){return this.applyStylesToKeyframe(),new u_(this._driver,t,c||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,c){this._localTimelineStyles.set(t,c),this._globalTimelineStyles.set(t,c),this._styleSummary.set(t,{time:this.currentTime,value:c})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[c,i]of this._globalTimelineStyles)this._backFill.set(c,i||su),this._currentKeyframe.set(c,su);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,c,i,h){c&&this._previousKeyframe.set("easing",c);const w=h&&h.params||{},I=function Qx(o,t){const c=new Map;let i;return o.forEach(h=>{if("*"===h){i=i||t.keys();for(let w of i)c.set(w,su)}else Dh(h,c)}),c}(t,this._globalTimelineStyles);for(let[N,Y]of I){const J=Pm(Y,w,i);this._pendingStyles.set(N,J),this._localTimelineStyles.has(N)||this._backFill.set(N,this._globalTimelineStyles.get(N)??su),this._updateStyle(N,J)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,c)=>{this._currentKeyframe.set(c,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,c)=>{this._currentKeyframe.has(c)||this._currentKeyframe.set(c,t)}))}snapshotCurrentStyles(){for(let[t,c]of this._localTimelineStyles)this._pendingStyles.set(t,c),this._updateStyle(t,c)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let c in this._currentKeyframe)t.push(c);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((c,i)=>{const h=this._styleSummary.get(i);(!h||c.time>h.time)&&this._updateStyle(i,c.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,c=new Set,i=1===this._keyframes.size&&0===this.duration;let h=[];this._keyframes.forEach((N,Y)=>{const J=Dh(N,new Map,this._backFill);J.forEach((xe,Ae)=>{"!"===xe?t.add(Ae):xe===su&&c.add(Ae)}),i||J.set("offset",Y/this.duration),h.push(J)});const w=t.size?cv(t.values()):[],I=c.size?cv(c.values()):[];if(i){const N=h[0],Y=new Map(N);N.set("offset",0),Y.set("offset",1),h=[N,Y]}return J0(this.element,h,w,I,this.duration,this.startTime,this.easing,!1)}}class Kx extends u_{constructor(t,c,i,h,w,I,N=!1){super(t,c,I.delay),this.keyframes=i,this.preStyleProps=h,this.postStyleProps=w,this._stretchStartingKeyframe=N,this.timings={duration:I.duration,delay:I.delay,easing:I.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:c,duration:i,easing:h}=this.timings;if(this._stretchStartingKeyframe&&c){const w=[],I=i+c,N=c/I,Y=Dh(t[0]);Y.set("offset",0),w.push(Y);const J=Dh(t[0]);J.set("offset",Jx(N)),w.push(J);const xe=t.length-1;for(let Ae=1;Ae<=xe;Ae++){let It=Dh(t[Ae]);const wt=It.get("offset");It.set("offset",Jx((c+wt*i)/I)),w.push(It)}i=I,c=0,h="",t=w}return J0(this.element,t,this.preStyleProps,this.postStyleProps,i,c,h,!0)}}function Jx(o,t=3){const c=Math.pow(10,t-1);return Math.round(o*c)/c}class fv{}const tw=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class nw extends fv{normalizePropertyName(t,c){return Z0(t)}normalizeStyleValue(t,c,i,h){let w="";const I=i.toString().trim();if(tw.has(c)&&0!==i&&"0"!==i)if("number"==typeof i)w="px";else{const N=i.match(/^[+-]?[\d\.]+([a-z]*)$/);N&&0==N[1].length&&h.push(function Y1(o,t){return new E.vHH(3005,!1)}())}return I+w}}function iw(o,t,c,i,h,w,I,N,Y,J,xe,Ae,It){return{type:0,element:o,triggerName:t,isRemovalTransition:h,fromState:c,fromStyles:w,toState:i,toStyles:I,timelines:N,queriedElements:Y,preStyleProps:J,postStyleProps:xe,totalTime:Ae,errors:It}}const tb={};class rw{constructor(t,c,i){this._triggerName=t,this.ast=c,this._stateStyles=i}match(t,c,i,h){return function ow(o,t,c,i,h){return o.some(w=>w(t,c,i,h))}(this.ast.matchers,t,c,i,h)}buildStyles(t,c,i){let h=this._stateStyles.get("*");return void 0!==t&&(h=this._stateStyles.get(t?.toString())||h),h?h.buildStyles(c,i):new Map}build(t,c,i,h,w,I,N,Y,J,xe){const Ae=[],It=this.ast.options&&this.ast.options.params||tb,St=this.buildStyles(i,N&&N.params||tb,Ae),Qt=Y&&Y.params||tb,fn=this.buildStyles(h,Qt,Ae),Pn=new Set,ci=new Map,Tr=new Map,Mi="void"===h,Us={params:DD(Qt,It),delay:this.ast.options?.delay},pc=xe?[]:Xx(t,c,this.ast.animation,w,I,St,fn,Us,J,Ae);let xs=0;if(pc.forEach(Ah=>{xs=Math.max(Ah.duration+Ah.delay,xs)}),Ae.length)return iw(c,this._triggerName,i,h,Mi,St,fn,[],[],ci,Tr,xs,Ae);pc.forEach(Ah=>{const Jf=Ah.element,CM=Ia(ci,Jf,new Set);Ah.preStyleProps.forEach(w_=>CM.add(w_));const yb=Ia(Tr,Jf,new Set);Ah.postStyleProps.forEach(w_=>yb.add(w_)),Jf!==c&&Pn.add(Jf)});const Ih=cv(Pn.values());return iw(c,this._triggerName,i,h,Mi,St,fn,pc,Ih,ci,Tr,xs)}}function DD(o,t){const c=av(t);for(const i in o)o.hasOwnProperty(i)&&null!=o[i]&&(c[i]=o[i]);return c}class sw{constructor(t,c,i){this.styles=t,this.defaultParams=c,this.normalizer=i}buildStyles(t,c){const i=new Map,h=av(this.defaultParams);return Object.keys(t).forEach(w=>{const I=t[w];null!==I&&(h[w]=I)}),this.styles.styles.forEach(w=>{"string"!=typeof w&&w.forEach((I,N)=>{I&&(I=Pm(I,h,c));const Y=this.normalizer.normalizePropertyName(N,c);I=this.normalizer.normalizeStyleValue(N,Y,I,c),i.set(N,I)})}),i}}class CE{constructor(t,c,i){this.name=t,this.ast=c,this._normalizer=i,this.transitionFactories=[],this.states=new Map,c.states.forEach(h=>{this.states.set(h.name,new sw(h.style,h.options&&h.options.params||{},i))}),aw(this.states,"true","1"),aw(this.states,"false","0"),c.transitions.forEach(h=>{this.transitionFactories.push(new rw(t,h,this.states))}),this.fallbackTransition=function TD(o,t,c){return new rw(o,{type:1,animation:{type:2,steps:[],options:null},matchers:[(I,N)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,c,i,h){return this.transitionFactories.find(I=>I.match(t,c,i,h))||null}matchStyles(t,c,i){return this.fallbackTransition.buildStyles(t,c,i)}}function aw(o,t,c){o.has(t)?o.has(c)||o.set(c,o.get(t)):o.has(c)&&o.set(t,o.get(c))}const DE=new Rm;class TE{constructor(t,c,i){this.bodyNode=t,this._driver=c,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,c){const i=[],w=hv(this._driver,c,i,[]);if(i.length)throw function Cx(o){return new E.vHH(3503,!1)}();this._animations.set(t,w)}_buildPlayer(t,c,i){const h=t.element,w=Ax(this._normalizer,t.keyframes,c,i);return this._driver.animate(h,w,t.duration,t.delay,t.easing,[],!0)}create(t,c,i={}){const h=[],w=this._animations.get(t);let I;const N=new Map;if(w?(I=Xx(this._driver,c,w,iv,Wf,new Map,new Map,i,DE,h),I.forEach(xe=>{const Ae=Ia(N,xe.element,new Map);xe.postStyleProps.forEach(It=>Ae.set(It,null))})):(h.push(function Dx(){return new E.vHH(3300,!1)}()),I=[]),h.length)throw function tE(o){return new E.vHH(3504,!1)}();N.forEach((xe,Ae)=>{xe.forEach((It,wt)=>{xe.set(wt,this._driver.computeStyle(Ae,wt,su))})});const J=Ch(I.map(xe=>{const Ae=N.get(xe.element);return this._buildPlayer(xe,new Map,Ae)}));return this._playersById.set(t,J),J.onDestroy(()=>this.destroy(t)),this.players.push(J),J}destroy(t){const c=this._getPlayer(t);c.destroy(),this._playersById.delete(t);const i=this.players.indexOf(c);i>=0&&this.players.splice(i,1)}_getPlayer(t){const c=this._playersById.get(t);if(!c)throw function Tx(o){return new E.vHH(3301,!1)}();return c}listen(t,c,i,h){const w=nv(c,"","","");return Im(this._getPlayer(t),i,w,h),()=>{}}command(t,c,i,h){if("register"==i)return void this.register(t,h[0]);if("create"==i)return void this.create(t,c,h[0]||{});const w=this._getPlayer(t);switch(i){case"play":w.play();break;case"pause":w.pause();break;case"reset":w.reset();break;case"restart":w.restart();break;case"finish":w.finish();break;case"init":w.init();break;case"setPosition":w.setPosition(parseFloat(h[0]));break;case"destroy":this.destroy(t)}}}const lw="ng-animate-queued",nb="ng-animate-disabled",PE=[],cw={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},RE={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},oa="__ng_removed";class pv{get params(){return this.options.params}constructor(t,c=""){this.namespaceId=c;const i=t&&t.hasOwnProperty("value");if(this.value=function MD(o){return o??null}(i?t.value:t),i){const w=av(t);delete w.value,this.options=w}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){const c=t.params;if(c){const i=this.options.params;Object.keys(c).forEach(h=>{null==i[h]&&(i[h]=c[h])})}}}const km="void",mv=new pv(km);class uw{constructor(t,c,i){this.id=t,this.hostElement=c,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Nl(c,this._hostClassName)}listen(t,c,i,h){if(!this._triggers.has(c))throw function Mx(o,t){return new E.vHH(3302,!1)}();if(null==i||0==i.length)throw function Sx(o){return new E.vHH(3303,!1)}();if(!function hw(o){return"start"==o||"done"==o}(i))throw function Ix(o,t){return new E.vHH(3400,!1)}();const w=Ia(this._elementListeners,t,[]),I={name:c,phase:i,callback:h};w.push(I);const N=Ia(this._engine.statesByElement,t,new Map);return N.has(c)||(Nl(t,rv),Nl(t,rv+"-"+c),N.set(c,mv)),()=>{this._engine.afterFlush(()=>{const Y=w.indexOf(I);Y>=0&&w.splice(Y,1),this._triggers.has(c)||N.delete(c)})}}register(t,c){return!this._triggers.has(t)&&(this._triggers.set(t,c),!0)}_getTrigger(t){const c=this._triggers.get(t);if(!c)throw function nE(o){return new E.vHH(3401,!1)}();return c}trigger(t,c,i,h=!0){const w=this._getTrigger(c),I=new gv(this.id,c,t);let N=this._engine.statesByElement.get(t);N||(Nl(t,rv),Nl(t,rv+"-"+c),this._engine.statesByElement.set(t,N=new Map));let Y=N.get(c);const J=new pv(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&Y&&J.absorbOptions(Y.options),N.set(c,J),Y||(Y=mv),J.value!==km&&Y.value===J.value){if(!function SD(o,t){const c=Object.keys(o),i=Object.keys(t);if(c.length!=i.length)return!1;for(let h=0;h<c.length;h++){const w=c[h];if(!t.hasOwnProperty(w)||o[w]!==t[w])return!1}return!0}(Y.params,J.params)){const Qt=[],fn=w.matchStyles(Y.value,Y.params,Qt),Pn=w.matchStyles(J.value,J.params,Qt);Qt.length?this._engine.reportError(Qt):this._engine.afterFlush(()=>{qf(t,fn),Aa(t,Pn)})}return}const It=Ia(this._engine.playersByElement,t,[]);It.forEach(Qt=>{Qt.namespaceId==this.id&&Qt.triggerName==c&&Qt.queued&&Qt.destroy()});let wt=w.matchTransition(Y.value,J.value,t,J.params),St=!1;if(!wt){if(!h)return;wt=w.fallbackTransition,St=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:c,transition:wt,fromState:Y,toState:J,player:I,isFallbackTransition:St}),St||(Nl(t,lw),I.onStart(()=>{lu(t,lw)})),I.onDone(()=>{let Qt=this.players.indexOf(I);Qt>=0&&this.players.splice(Qt,1);const fn=this._engine.playersByElement.get(t);if(fn){let Pn=fn.indexOf(I);Pn>=0&&fn.splice(Pn,1)}}),this.players.push(I),It.push(I),I}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(c=>c.delete(t)),this._elementListeners.forEach((c,i)=>{this._elementListeners.set(i,c.filter(h=>h.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const c=this._engine.playersByElement.get(t);c&&(c.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,c){const i=this._engine.driver.query(t,ov,!0);i.forEach(h=>{if(h[oa])return;const w=this._engine.fetchNamespacesByElement(h);w.size?w.forEach(I=>I.triggerLeaveAnimation(h,c,!1,!0)):this.clearElementCache(h)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(h=>this.clearElementCache(h)))}triggerLeaveAnimation(t,c,i,h){const w=this._engine.statesByElement.get(t),I=new Map;if(w){const N=[];if(w.forEach((Y,J)=>{if(I.set(J,Y.value),this._triggers.has(J)){const xe=this.trigger(t,J,km,h);xe&&N.push(xe)}}),N.length)return this._engine.markElementAsRemoved(this.id,t,!0,c,I),i&&Ch(N).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const c=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(c&&i){const h=new Set;c.forEach(w=>{const I=w.name;if(h.has(I))return;h.add(I);const Y=this._triggers.get(I).fallbackTransition,J=i.get(I)||mv,xe=new pv(km),Ae=new gv(this.id,I,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:I,transition:Y,fromState:J,toState:xe,player:Ae,isFallbackTransition:!0})})}}removeNode(t,c){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,c),this.triggerLeaveAnimation(t,c,!0))return;let h=!1;if(i.totalAnimations){const w=i.players.length?i.playersByQueriedElement.get(t):[];if(w&&w.length)h=!0;else{let I=t;for(;I=I.parentNode;)if(i.statesByElement.get(I)){h=!0;break}}}if(this.prepareLeaveAnimationListeners(t),h)i.markElementAsRemoved(this.id,t,!1,c);else{const w=t[oa];(!w||w===cw)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,c))}}insertNode(t,c){Nl(t,this._hostClassName)}drainQueuedTransitions(t){const c=[];return this._queue.forEach(i=>{const h=i.player;if(h.destroyed)return;const w=i.element,I=this._elementListeners.get(w);I&&I.forEach(N=>{if(N.name==i.triggerName){const Y=nv(w,i.triggerName,i.fromState.value,i.toState.value);Y._data=t,Im(i.player,N.phase,Y,N.callback)}}),h.markedForDestroy?this._engine.afterFlush(()=>{h.destroy()}):c.push(i)}),this._queue=[],c.sort((i,h)=>{const w=i.transition.ast.depCount,I=h.transition.ast.depCount;return 0==w||0==I?w-I:this._engine.driver.containsElement(i.element,h.element)?1:-1})}destroy(t){this.players.forEach(c=>c.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}}class dw{_onRemovalComplete(t,c){this.onRemovalComplete(t,c)}constructor(t,c,i){this.bodyNode=t,this.driver=c,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(h,w)=>{}}get queuedPlayers(){const t=[];return this._namespaceList.forEach(c=>{c.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,c){const i=new uw(t,c,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,c)?this._balanceNamespaceList(i,c):(this.newHostElements.set(c,i),this.collectEnterElement(c)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,c){const i=this._namespaceList,h=this.namespacesByHostElement;if(i.length-1>=0){let I=!1,N=this.driver.getParentElement(c);for(;N;){const Y=h.get(N);if(Y){const J=i.indexOf(Y);i.splice(J+1,0,t),I=!0;break}N=this.driver.getParentElement(N)}I||i.unshift(t)}else i.push(t);return h.set(c,t),t}register(t,c){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,c)),i}registerTrigger(t,c,i){let h=this._namespaceLookup[t];h&&h.register(c,i)&&this.totalAnimations++}destroy(t,c){t&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const i=this._fetchNamespace(t);this.namespacesByHostElement.delete(i.hostElement);const h=this._namespaceList.indexOf(i);h>=0&&this._namespaceList.splice(h,1),i.destroy(c),delete this._namespaceLookup[t]}))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const c=new Set,i=this.statesByElement.get(t);if(i)for(let h of i.values())if(h.namespaceId){const w=this._fetchNamespace(h.namespaceId);w&&c.add(w)}return c}trigger(t,c,i,h){if(ib(c)){const w=this._fetchNamespace(t);if(w)return w.trigger(c,i,h),!0}return!1}insertNode(t,c,i,h){if(!ib(c))return;const w=c[oa];if(w&&w.setForRemoval){w.setForRemoval=!1,w.setForMove=!0;const I=this.collectedLeaveElements.indexOf(c);I>=0&&this.collectedLeaveElements.splice(I,1)}if(t){const I=this._fetchNamespace(t);I&&I.insertNode(c,i)}h&&this.collectEnterElement(c)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,c){c?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Nl(t,nb)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),lu(t,nb))}removeNode(t,c,i){if(ib(c)){const h=t?this._fetchNamespace(t):null;h?h.removeNode(c,i):this.markElementAsRemoved(t,c,!1,i);const w=this.namespacesByHostElement.get(c);w&&w.id!==t&&w.removeNode(c,i)}else this._onRemovalComplete(c,i)}markElementAsRemoved(t,c,i,h,w){this.collectedLeaveElements.push(c),c[oa]={namespaceId:t,setForRemoval:h,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:w}}listen(t,c,i,h,w){return ib(c)?this._fetchNamespace(t).listen(c,i,h,w):()=>{}}_buildInstruction(t,c,i,h,w){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,h,t.fromState.options,t.toState.options,c,w)}destroyInnerAnimations(t){let c=this.driver.query(t,ov,!0);c.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(c=this.driver.query(t,Zf,!0),c.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const c=this.playersByElement.get(t);c&&c.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const c=this.playersByQueriedElement.get(t);c&&c.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Ch(this.players).onDone(()=>t());t()})}processLeaveNode(t){const c=t[oa];if(c&&c.setForRemoval){if(t[oa]=cw,c.namespaceId){this.destroyInnerAnimations(t);const i=this._fetchNamespace(c.namespaceId);i&&i.clearElementCache(t)}this._onRemovalComplete(t,c.setForRemoval)}t.classList?.contains(nb)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(t=-1){let c=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,h)=>this._balanceNamespaceList(i,h)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Nl(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{c=this._flushAnimations(i,t)}finally{for(let h=0;h<i.length;h++)i[h]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],c.length?Ch(c).onDone(()=>{i.forEach(h=>h())}):i.forEach(h=>h())}}reportError(t){throw function iE(o){return new E.vHH(3402,!1)}()}_flushAnimations(t,c){const i=new Rm,h=[],w=new Map,I=[],N=new Map,Y=new Map,J=new Map,xe=new Set;this.disabledNodes.forEach(kn=>{xe.add(kn);const ti=this.driver.query(kn,".ng-animate-queued",!0);for(let fi=0;fi<ti.length;fi++)xe.add(ti[fi])});const Ae=this.bodyNode,It=Array.from(this.statesByElement.keys()),wt=mw(It,this.collectedEnterElements),St=new Map;let Qt=0;wt.forEach((kn,ti)=>{const fi=iv+Qt++;St.set(ti,fi),kn.forEach(nr=>Nl(nr,fi))});const fn=[],Pn=new Set,ci=new Set;for(let kn=0;kn<this.collectedLeaveElements.length;kn++){const ti=this.collectedLeaveElements[kn],fi=ti[oa];fi&&fi.setForRemoval&&(fn.push(ti),Pn.add(ti),fi.hasAnimation?this.driver.query(ti,".ng-star-inserted",!0).forEach(nr=>Pn.add(nr)):ci.add(ti))}const Tr=new Map,Mi=mw(It,Array.from(Pn));Mi.forEach((kn,ti)=>{const fi=Wf+Qt++;Tr.set(ti,fi),kn.forEach(nr=>Nl(nr,fi))}),t.push(()=>{wt.forEach((kn,ti)=>{const fi=St.get(ti);kn.forEach(nr=>lu(nr,fi))}),Mi.forEach((kn,ti)=>{const fi=Tr.get(ti);kn.forEach(nr=>lu(nr,fi))}),fn.forEach(kn=>{this.processLeaveNode(kn)})});const Us=[],pc=[];for(let kn=this._namespaceList.length-1;kn>=0;kn--)this._namespaceList[kn].drainQueuedTransitions(c).forEach(fi=>{const nr=fi.player,js=fi.element;if(Us.push(nr),this.collectedEnterElements.length){const Ra=js[oa];if(Ra&&Ra.setForMove){if(Ra.previousTriggersValues&&Ra.previousTriggersValues.has(fi.triggerName)){const E_=Ra.previousTriggersValues.get(fi.triggerName),cu=this.statesByElement.get(fi.element);if(cu&&cu.has(fi.triggerName)){const c1=cu.get(fi.triggerName);c1.value=E_,cu.set(fi.triggerName,c1)}}return void nr.destroy()}}const Ph=!Ae||!this.driver.containsElement(Ae,js),mc=Tr.get(js),Fm=St.get(js),fo=this._buildInstruction(fi,i,Fm,mc,Ph);if(fo.errors&&fo.errors.length)return void pc.push(fo);if(Ph)return nr.onStart(()=>qf(js,fo.fromStyles)),nr.onDestroy(()=>Aa(js,fo.toStyles)),void h.push(nr);if(fi.isFallbackTransition)return nr.onStart(()=>qf(js,fo.fromStyles)),nr.onDestroy(()=>Aa(js,fo.toStyles)),void h.push(nr);const MM=[];fo.timelines.forEach(Ra=>{Ra.stretchStartingKeyframe=!0,this.disabledNodes.has(Ra.element)||MM.push(Ra)}),fo.timelines=MM,i.append(js,fo.timelines),I.push({instruction:fo,player:nr,element:js}),fo.queriedElements.forEach(Ra=>Ia(N,Ra,[]).push(nr)),fo.preStyleProps.forEach((Ra,E_)=>{if(Ra.size){let cu=Y.get(E_);cu||Y.set(E_,cu=new Set),Ra.forEach((c1,nD)=>cu.add(nD))}}),fo.postStyleProps.forEach((Ra,E_)=>{let cu=J.get(E_);cu||J.set(E_,cu=new Set),Ra.forEach((c1,nD)=>cu.add(nD))})});if(pc.length){const kn=[];pc.forEach(ti=>{kn.push(function a_(o,t){return new E.vHH(3505,!1)}())}),Us.forEach(ti=>ti.destroy()),this.reportError(kn)}const xs=new Map,Ih=new Map;I.forEach(kn=>{const ti=kn.element;i.has(ti)&&(Ih.set(ti,ti),this._beforeAnimationBuild(kn.player.namespaceId,kn.instruction,xs))}),h.forEach(kn=>{const ti=kn.element;this._getPreviousPlayers(ti,!1,kn.namespaceId,kn.triggerName,null).forEach(nr=>{Ia(xs,ti,[]).push(nr),nr.destroy()})});const Ah=fn.filter(kn=>_w(kn,Y,J)),Jf=new Map;pw(Jf,this.driver,ci,J,su).forEach(kn=>{_w(kn,Y,J)&&Ah.push(kn)});const yb=new Map;wt.forEach((kn,ti)=>{pw(yb,this.driver,new Set(kn),Y,"!")}),Ah.forEach(kn=>{const ti=Jf.get(kn),fi=yb.get(kn);Jf.set(kn,new Map([...ti?.entries()??[],...fi?.entries()??[]]))});const w_=[],DM=[],TM={};I.forEach(kn=>{const{element:ti,player:fi,instruction:nr}=kn;if(i.has(ti)){if(xe.has(ti))return fi.onDestroy(()=>Aa(ti,nr.toStyles)),fi.disabled=!0,fi.overrideTotalTime(nr.totalTime),void h.push(fi);let js=TM;if(Ih.size>1){let mc=ti;const Fm=[];for(;mc=mc.parentNode;){const fo=Ih.get(mc);if(fo){js=fo;break}Fm.push(mc)}Fm.forEach(fo=>Ih.set(fo,js))}const Ph=this._buildAnimation(fi.namespaceId,nr,xs,w,yb,Jf);if(fi.setRealPlayer(Ph),js===TM)w_.push(fi);else{const mc=this.playersByElement.get(js);mc&&mc.length&&(fi.parentPlayer=Ch(mc)),h.push(fi)}}else qf(ti,nr.fromStyles),fi.onDestroy(()=>Aa(ti,nr.toStyles)),DM.push(fi),xe.has(ti)&&h.push(fi)}),DM.forEach(kn=>{const ti=w.get(kn.element);if(ti&&ti.length){const fi=Ch(ti);kn.setRealPlayer(fi)}}),h.forEach(kn=>{kn.parentPlayer?kn.syncPlayerEvents(kn.parentPlayer):kn.destroy()});for(let kn=0;kn<fn.length;kn++){const ti=fn[kn],fi=ti[oa];if(lu(ti,Wf),fi&&fi.hasAnimation)continue;let nr=[];if(N.size){let Ph=N.get(ti);Ph&&Ph.length&&nr.push(...Ph);let mc=this.driver.query(ti,Zf,!0);for(let Fm=0;Fm<mc.length;Fm++){let fo=N.get(mc[Fm]);fo&&fo.length&&nr.push(...fo)}}const js=nr.filter(Ph=>!Ph.destroyed);js.length?kE(this,ti,js):this.processLeaveNode(ti)}return fn.length=0,w_.forEach(kn=>{this.players.push(kn),kn.onDone(()=>{kn.destroy();const ti=this.players.indexOf(kn);this.players.splice(ti,1)}),kn.play()}),w_}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,c,i,h,w){let I=[];if(c){const N=this.playersByQueriedElement.get(t);N&&(I=N)}else{const N=this.playersByElement.get(t);if(N){const Y=!w||w==km;N.forEach(J=>{J.queued||!Y&&J.triggerName!=h||I.push(J)})}}return(i||h)&&(I=I.filter(N=>!(i&&i!=N.namespaceId||h&&h!=N.triggerName))),I}_beforeAnimationBuild(t,c,i){const w=c.element,I=c.isRemovalTransition?void 0:t,N=c.isRemovalTransition?void 0:c.triggerName;for(const Y of c.timelines){const J=Y.element,xe=J!==w,Ae=Ia(i,J,[]);this._getPreviousPlayers(J,xe,I,N,c.toState).forEach(wt=>{const St=wt.getRealPlayer();St.beforeDestroy&&St.beforeDestroy(),wt.destroy(),Ae.push(wt)})}qf(w,c.fromStyles)}_buildAnimation(t,c,i,h,w,I){const N=c.triggerName,Y=c.element,J=[],xe=new Set,Ae=new Set,It=c.timelines.map(St=>{const Qt=St.element;xe.add(Qt);const fn=Qt[oa];if(fn&&fn.removedBeforeQueried)return new Uf(St.duration,St.delay);const Pn=Qt!==Y,ci=function rb(o){const t=[];return gw(o,t),t}((i.get(Qt)||PE).map(xs=>xs.getRealPlayer())).filter(xs=>!!xs.element&&xs.element===Qt),Tr=w.get(Qt),Mi=I.get(Qt),Us=Ax(this._normalizer,St.keyframes,Tr,Mi),pc=this._buildPlayer(St,Us,ci);if(St.subTimeline&&h&&Ae.add(Qt),Pn){const xs=new gv(t,N,Qt);xs.setRealPlayer(pc),J.push(xs)}return pc});J.forEach(St=>{Ia(this.playersByQueriedElement,St.element,[]).push(St),St.onDone(()=>function OE(o,t,c){let i=o.get(t);if(i){if(i.length){const h=i.indexOf(c);i.splice(h,1)}0==i.length&&o.delete(t)}return i}(this.playersByQueriedElement,St.element,St))}),xe.forEach(St=>Nl(St,H0));const wt=Ch(It);return wt.onDestroy(()=>{xe.forEach(St=>lu(St,H0)),Aa(Y,c.toStyles)}),Ae.forEach(St=>{Ia(h,St,[]).push(wt)}),wt}_buildPlayer(t,c,i){return c.length>0?this.driver.animate(t.element,c,t.duration,t.delay,t.easing,i):new Uf(t.duration,t.delay)}}class gv{constructor(t,c,i){this.namespaceId=t,this.triggerName=c,this.element=i,this._player=new Uf,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((c,i)=>{c.forEach(h=>Im(t,i,void 0,h))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const c=this._player;c.triggerCallback&&t.onStart(()=>c.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,c){Ia(this._queuedCallbacks,t,[]).push(c)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const c=this._player;c.triggerCallback&&c.triggerCallback(t)}}function ib(o){return o&&1===o.nodeType}function fw(o,t){const c=o.style.display;return o.style.display=t??"none",c}function pw(o,t,c,i,h){const w=[];c.forEach(Y=>w.push(fw(Y)));const I=[];i.forEach((Y,J)=>{const xe=new Map;Y.forEach(Ae=>{const It=t.computeStyle(J,Ae,h);xe.set(Ae,It),(!It||0==It.length)&&(J[oa]=RE,I.push(J))}),o.set(J,xe)});let N=0;return c.forEach(Y=>fw(Y,w[N++])),I}function mw(o,t){const c=new Map;if(o.forEach(N=>c.set(N,[])),0==t.length)return c;const h=new Set(t),w=new Map;function I(N){if(!N)return 1;let Y=w.get(N);if(Y)return Y;const J=N.parentNode;return Y=c.has(J)?J:h.has(J)?1:I(J),w.set(N,Y),Y}return t.forEach(N=>{const Y=I(N);1!==Y&&c.get(Y).push(N)}),c}function Nl(o,t){o.classList?.add(t)}function lu(o,t){o.classList?.remove(t)}function kE(o,t,c){Ch(c).onDone(()=>o.processLeaveNode(t))}function gw(o,t){for(let c=0;c<o.length;c++){const i=o[c];i instanceof I0?gw(i.players,t):t.push(i)}}function _w(o,t,c){const i=c.get(o);if(!i)return!1;let h=t.get(o);return h?i.forEach(w=>h.add(w)):t.set(o,i),c.delete(o),!0}class ob{constructor(t,c,i){this.bodyNode=t,this._driver=c,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(h,w)=>{},this._transitionEngine=new dw(t,c,i),this._timelineEngine=new TE(t,c,i),this._transitionEngine.onRemovalComplete=(h,w)=>this.onRemovalComplete(h,w)}registerTrigger(t,c,i,h,w){const I=t+"-"+h;let N=this._triggerCache[I];if(!N){const Y=[],xe=hv(this._driver,w,Y,[]);if(Y.length)throw function Sa(o,t){return new E.vHH(3404,!1)}();N=function EE(o,t,c){return new CE(o,t,c)}(h,xe,this._normalizer),this._triggerCache[I]=N}this._transitionEngine.registerTrigger(c,h,N)}register(t,c){this._transitionEngine.register(t,c)}destroy(t,c){this._transitionEngine.destroy(t,c)}onInsert(t,c,i,h){this._transitionEngine.insertNode(t,c,i,h)}onRemove(t,c,i){this._transitionEngine.removeNode(t,c,i)}disableAnimations(t,c){this._transitionEngine.markElementAsDisabled(t,c)}process(t,c,i,h){if("@"==i.charAt(0)){const[w,I]=Px(i);this._timelineEngine.command(w,c,I,h)}else this._transitionEngine.trigger(t,c,i,h)}listen(t,c,i,h,w){if("@"==i.charAt(0)){const[I,N]=Px(i);return this._timelineEngine.listen(I,c,N,w)}return this._transitionEngine.listen(t,c,i,h,w)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(t){this._transitionEngine.afterFlushAnimationsDone(t)}}let LE=(()=>{class t{constructor(i,h,w){this._element=i,this._startStyles=h,this._endStyles=w,this._state=0;let I=t.initialStylesByElement.get(i);I||t.initialStylesByElement.set(i,I=new Map),this._initialStyles=I}start(){this._state<1&&(this._startStyles&&Aa(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Aa(this._element,this._initialStyles),this._endStyles&&(Aa(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(t.initialStylesByElement.delete(this._element),this._startStyles&&(qf(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(qf(this._element,this._endStyles),this._endStyles=null),Aa(this._element,this._initialStyles),this._state=3)}}return t.initialStylesByElement=new WeakMap,t})();function sb(o){let t=null;return o.forEach((c,i)=>{(function FE(o){return"display"===o||"position"===o})(i)&&(t=t||new Map,t.set(i,c))}),t}class h_{constructor(t,c,i,h){this.element=t,this.keyframes=c,this.options=i,this._specialStyles=h,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const c=[];return t.forEach(i=>{c.push(Object.fromEntries(i))}),c}_triggerWebAnimation(t,c,i){return t.animate(this._convertKeyframesToObject(c),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,h)=>{"offset"!==h&&t.set(h,this._finished?i:$x(this.element,h))}),this.currentSnapshot=t}triggerCallback(t){const c="start"===t?this._onStartFns:this._onDoneFns;c.forEach(i=>i()),c.length=0}}class yw{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,c){return!1}containsElement(t,c){return Lx(t,c)}getParentElement(t){return Hf(t)}query(t,c,i){return $0(t,c,i)}computeStyle(t,c,i){return window.getComputedStyle(t)[c]}animate(t,c,i,h,w,I=[]){const Y={duration:i,delay:h,fill:0==h?"both":"forwards"};w&&(Y.easing=w);const J=new Map,xe=I.filter(wt=>wt instanceof h_);(function jx(o,t){return 0===o||0===t})(i,h)&&xe.forEach(wt=>{wt.currentSnapshot.forEach((St,Qt)=>J.set(Qt,St))});let Ae=function zx(o){return o.length?o[0]instanceof Map?o:o.map(t=>Bx(t)):[]}(c).map(wt=>Dh(wt));Ae=function dE(o,t,c){if(c.size&&t.length){let i=t[0],h=[];if(c.forEach((w,I)=>{i.has(I)||h.push(I),i.set(I,w)}),h.length)for(let w=1;w<t.length;w++){let I=t[w];h.forEach(N=>I.set(N,$x(o,N)))}}return t}(t,Ae,J);const It=function d_(o,t){let c=null,i=null;return Array.isArray(t)&&t.length?(c=sb(t[0]),t.length>1&&(i=sb(t[t.length-1]))):t instanceof Map&&(c=sb(t)),c||i?new LE(o,c,i):null}(t,Ae);return new h_(t,Ae,Y,It)}}let NE=(()=>{var o;class t extends Nb{constructor(i,h){super(),this._nextAnimationId=0,this._renderer=i.createRenderer(h.body,{id:"0",encapsulation:E.ifc.None,styles:[],data:{animation:[]}})}build(i){const h=this._nextAnimationId.toString();this._nextAnimationId++;const w=Array.isArray(i)?S0(i):i;return bw(this._renderer,null,h,"register",[w]),new vw(h,this._renderer)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(E.FYo),E.LFG(Ye))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();class vw extends m1{constructor(t,c){super(),this._id=t,this._renderer=c}create(t,c){return new _v(this._id,t,c||{},this._renderer)}}class _v{constructor(t,c,i,h){this.id=t,this.element=c,this._renderer=h,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,c){return this._renderer.listen(this.element,`@@${this.id}:${t}`,c)}_command(t,...c){return bw(this._renderer,this.element,this.id,t,c)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function bw(o,t,c,i,h){return o.setProperty(t,`@@${c}:${i}`,h)}const ab="@.disabled";let BE=(()=>{var o;class t{constructor(i,h,w){this.delegate=i,this.engine=h,this._zone=w,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,h.onRemovalComplete=(I,N)=>{const Y=N?.parentNode(I);Y&&N.removeChild(Y,I)}}createRenderer(i,h){const I=this.delegate.createRenderer(i,h);if(!(i&&h&&h.data&&h.data.animation)){let Ae=this._rendererCache.get(I);return Ae||(Ae=new xw("",I,this.engine,()=>this._rendererCache.delete(I)),this._rendererCache.set(I,Ae)),Ae}const N=h.id,Y=h.id+"-"+this._currentId;this._currentId++,this.engine.register(Y,i);const J=Ae=>{Array.isArray(Ae)?Ae.forEach(J):this.engine.registerTrigger(N,Y,i,Ae.name,Ae)};return h.data.animation.forEach(J),new ww(this,Y,I,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(i,h,w){i>=0&&i<this._microtaskId?this._zone.run(()=>h(w)):(0==this._animationCallbacksBuffer.length&&queueMicrotask(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(I=>{const[N,Y]=I;N(Y)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([h,w]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(E.FYo),E.LFG(ob),E.LFG(E.R0b))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})();class xw{constructor(t,c,i,h){this.namespaceId=t,this.delegate=c,this.engine=i,this._onDestroy=h}get data(){return this.delegate.data}destroyNode(t){this.delegate.destroyNode?.(t)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(t,c){return this.delegate.createElement(t,c)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,c){this.delegate.appendChild(t,c),this.engine.onInsert(this.namespaceId,c,t,!1)}insertBefore(t,c,i,h=!0){this.delegate.insertBefore(t,c,i),this.engine.onInsert(this.namespaceId,c,t,h)}removeChild(t,c,i){this.engine.onRemove(this.namespaceId,c,this.delegate)}selectRootElement(t,c){return this.delegate.selectRootElement(t,c)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,c,i,h){this.delegate.setAttribute(t,c,i,h)}removeAttribute(t,c,i){this.delegate.removeAttribute(t,c,i)}addClass(t,c){this.delegate.addClass(t,c)}removeClass(t,c){this.delegate.removeClass(t,c)}setStyle(t,c,i,h){this.delegate.setStyle(t,c,i,h)}removeStyle(t,c,i){this.delegate.removeStyle(t,c,i)}setProperty(t,c,i){"@"==c.charAt(0)&&c==ab?this.disableAnimations(t,!!i):this.delegate.setProperty(t,c,i)}setValue(t,c){this.delegate.setValue(t,c)}listen(t,c,i){return this.delegate.listen(t,c,i)}disableAnimations(t,c){this.engine.disableAnimations(t,c)}}class ww extends xw{constructor(t,c,i,h,w){super(c,i,h,w),this.factory=t,this.namespaceId=c}setProperty(t,c,i){"@"==c.charAt(0)?"."==c.charAt(1)&&c==ab?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,c.slice(1),i):this.delegate.setProperty(t,c,i)}listen(t,c,i){if("@"==c.charAt(0)){const h=function vv(o){switch(o){case"body":return document.body;case"document":return document;case"window":return window;default:return o}}(t);let w=c.slice(1),I="";return"@"!=w.charAt(0)&&([w,I]=function zE(o){const t=o.indexOf(".");return[o.substring(0,t),o.slice(t+1)]}(w)),this.engine.listen(this.namespaceId,h,w,I,N=>{this.factory.scheduleListenerCallback(N._data||-1,i,N)})}return this.delegate.listen(t,c,i)}}const bv=[{provide:Nb,useClass:NE},{provide:fv,useFactory:function Ew(){return new nw}},{provide:ob,useClass:(()=>{var o;class t extends ob{constructor(i,h,w,I){super(i.body,h,w)}ngOnDestroy(){this.flush()}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ye),E.LFG(Nx),E.LFG(fv),E.LFG(E.z2F))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac}),t})()},{provide:E.FYo,useFactory:function Cw(o,t,c){return new BE(o,t,c)},deps:[tn,ob,E.R0b]}],xv=[{provide:Nx,useFactory:()=>new yw},{provide:E.QbO,useValue:"BrowserAnimations"},...bv],Dw=[{provide:Nx,useClass:Fx},{provide:E.QbO,useValue:"NoopAnimations"},...bv];let f_,Tw=(()=>{var o;class t{static withConfig(i){return{ngModule:t,providers:i.disableAnimations?Dw:xv}}}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({providers:xv,imports:[Ad]}),t})();try{f_=typeof Intl<"u"&&Intl.v8BreakIterator}catch{f_=!1}let p_,hd,dd=(()=>{var o;class t{constructor(i){this._platformId=i,this.isBrowser=this._platformId?function hl(o){return o===Zs}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!f_)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(E.Lbi))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();function m_(o){return function $E(){if(null==p_&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>p_=!0}))}finally{p_=p_||!1}return p_}()?o:!!o.capture}function Mw(){if(null==hd){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return hd=!1,hd;if("scrollBehavior"in document.documentElement.style)hd=!0;else{const o=Element.prototype.scrollTo;hd=!!o&&!/\{\s*\[native code\]\s*\}/.test(o.toString())}}return hd}function Cv(o){return o.composedPath?o.composedPath()[0]:o.target}function lb(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Mv(o){return Array.isArray(o)?o:[o]}function ho(o){return null==o?"":"string"==typeof o?o:`${o}px`}function Vw(o){return o instanceof E.SBq?o.nativeElement:o}var wC=te(836),Uw=te(3620);const Sv=new Set;let Mh,jw=(()=>{var o;class t{constructor(i,h){this._platform=i,this._nonce=h,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):$w}matchMedia(i){return(this._platform.WEBKIT||this._platform.BLINK)&&function EC(o,t){if(!Sv.has(o))try{Mh||(Mh=document.createElement("style"),t&&(Mh.nonce=t),Mh.setAttribute("type","text/css"),document.head.appendChild(Mh)),Mh.sheet&&(Mh.sheet.insertRule(`@media ${o} {body{ }}`,0),Sv.add(o))}catch(c){console.error(c)}}(i,this._nonce),this._matchMedia(i)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(dd),E.LFG(E.Ojb,8))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();function $w(o){return{matches:"all"===o||""===o,media:o,addListener:()=>{},removeListener:()=>{}}}let Hw=(()=>{var o;class t{constructor(i,h){this._mediaMatcher=i,this._zone=h,this._queries=new Map,this._destroySubject=new _t.x}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(i){return Kf(Mv(i)).some(w=>this._registerQuery(w).mql.matches)}observe(i){let I=le(Kf(Mv(i)).map(N=>this._registerQuery(N).observable));return I=Te(I.pipe((0,ct.q)(1)),I.pipe((0,wC.T)(1),(0,Uw.b)(0))),I.pipe((0,O.U)(N=>{const Y={matches:!1,breakpoints:{}};return N.forEach(({matches:J,query:xe})=>{Y.matches=Y.matches||J,Y.breakpoints[xe]=J}),Y}))}_registerQuery(i){if(this._queries.has(i))return this._queries.get(i);const h=this._mediaMatcher.matchMedia(i),I={observable:new Vo.y(N=>{const Y=J=>this._zone.run(()=>N.next(J));return h.addListener(Y),()=>{h.removeListener(Y)}}).pipe(Lt(h),(0,O.U)(({matches:N})=>({query:i,matches:N})),(0,$r.R)(this._destroySubject)),mql:h};return this._queries.set(i,I),I}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(jw),E.LFG(E.R0b))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();function Kf(o){return o.map(t=>t.split(",")).reduce((t,c)=>t.concat(c)).map(t=>t.trim())}const BC="cdk-high-contrast-black-on-white",zC="cdk-high-contrast-white-on-black",mb="cdk-high-contrast-active";let VC=(()=>{var o;class t{constructor(i,h){this._platform=i,this._document=h,this._breakpointSubscription=(0,E.f3M)(Hw).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const i=this._document.createElement("div");i.style.backgroundColor="rgb(1,2,3)",i.style.position="absolute",this._document.body.appendChild(i);const h=this._document.defaultView||window,w=h&&h.getComputedStyle?h.getComputedStyle(i):null,I=(w&&w.backgroundColor||"").replace(/ /g,"");switch(i.remove(),I){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const i=this._document.body.classList;i.remove(mb,BC,zC),this._hasCheckedHighContrastMode=!0;const h=this.getHighContrastMode();1===h?i.add(mb,BC):2===h&&i.add(mb,zC)}}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(dd),E.LFG(Ye))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();const UC=new E.OlP("cdk-dir-doc",{providedIn:"root",factory:function t1(){return(0,E.f3M)(Ye)}}),n1=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let r1=(()=>{var o;class t{constructor(i){this.value="ltr",this.change=new E.vpe,i&&(this.value=function jC(o){const t=o?.toLowerCase()||"";return"auto"===t&&typeof navigator<"u"&&navigator?.language?n1.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((i.body?i.body.dir:null)||(i.documentElement?i.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(UC,8))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),Av=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({}),t})();const JT=new E.OlP("mat-sanity-checks",{providedIn:"root",factory:function YC(){return!0}});let v_=(()=>{var o;class t{constructor(i,h,w){this._sanityChecks=h,this._document=w,this._hasDoneGlobalChecks=!1,i._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(i){return!lb()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[i])}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(VC),E.LFG(JT,8),E.LFG(Ye))},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[Av,Av]}),t})();class ne{constructor(t,c,i,h=!1){this._renderer=t,this.element=c,this.config=i,this._animationForciblyDisabledThroughCss=h,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const me=m_({passive:!0,capture:!0});class Fe{constructor(){this._events=new Map,this._delegateEventHandler=t=>{const c=Cv(t);c&&this._events.get(t.type)?.forEach((i,h)=>{(h===c||h.contains(c))&&i.forEach(w=>w.handleEvent(t))})}}addHandler(t,c,i,h){const w=this._events.get(c);if(w){const I=w.get(i);I?I.add(h):w.set(i,new Set([h]))}else this._events.set(c,new Map([[i,new Set([h])]])),t.runOutsideAngular(()=>{document.addEventListener(c,this._delegateEventHandler,me)})}removeHandler(t,c,i){const h=this._events.get(t);if(!h)return;const w=h.get(c);w&&(w.delete(i),0===w.size&&h.delete(c),0===h.size&&(this._events.delete(t),document.removeEventListener(t,this._delegateEventHandler,me)))}}const Ze={enterDuration:225,exitDuration:150},qt=m_({passive:!0,capture:!0}),hn=["mousedown","touchstart"],On=["mouseup","mouseleave","touchend","touchcancel"];class Bt{constructor(t,c,i,h){this._target=t,this._ngZone=c,this._platform=h,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,h.isBrowser&&(this._containerElement=Vw(i))}fadeInRipple(t,c,i={}){const h=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),w={...Ze,...i.animation};i.centered&&(t=h.left+h.width/2,c=h.top+h.height/2);const I=i.radius||function hi(o,t,c){const i=Math.max(Math.abs(o-c.left),Math.abs(o-c.right)),h=Math.max(Math.abs(t-c.top),Math.abs(t-c.bottom));return Math.sqrt(i*i+h*h)}(t,c,h),N=t-h.left,Y=c-h.top,J=w.enterDuration,xe=document.createElement("div");xe.classList.add("mat-ripple-element"),xe.style.left=N-I+"px",xe.style.top=Y-I+"px",xe.style.height=2*I+"px",xe.style.width=2*I+"px",null!=i.color&&(xe.style.backgroundColor=i.color),xe.style.transitionDuration=`${J}ms`,this._containerElement.appendChild(xe);const Ae=window.getComputedStyle(xe),wt=Ae.transitionDuration,St="none"===Ae.transitionProperty||"0s"===wt||"0s, 0s"===wt||0===h.width&&0===h.height,Qt=new ne(this,xe,i,St);xe.style.transform="scale3d(1, 1, 1)",Qt.state=0,i.persistent||(this._mostRecentTransientRipple=Qt);let fn=null;return!St&&(J||w.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const Pn=()=>this._finishRippleTransition(Qt),ci=()=>this._destroyRipple(Qt);xe.addEventListener("transitionend",Pn),xe.addEventListener("transitioncancel",ci),fn={onTransitionEnd:Pn,onTransitionCancel:ci}}),this._activeRipples.set(Qt,fn),(St||!J)&&this._finishRippleTransition(Qt),Qt}fadeOutRipple(t){if(2===t.state||3===t.state)return;const c=t.element,i={...Ze,...t.config.animation};c.style.transitionDuration=`${i.exitDuration}ms`,c.style.opacity="0",t.state=2,(t._animationForciblyDisabledThroughCss||!i.exitDuration)&&this._finishRippleTransition(t)}fadeOutAll(){this._getActiveRipples().forEach(t=>t.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(t=>{t.config.persistent||t.fadeOut()})}setupTriggerEvents(t){const c=Vw(t);!this._platform.isBrowser||!c||c===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=c,hn.forEach(i=>{Bt._eventManager.addHandler(this._ngZone,i,c,this)}))}handleEvent(t){"mousedown"===t.type?this._onMousedown(t):"touchstart"===t.type?this._onTouchStart(t):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{On.forEach(c=>{this._triggerElement.addEventListener(c,this,qt)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(t){0===t.state?this._startFadeOutTransition(t):2===t.state&&this._destroyRipple(t)}_startFadeOutTransition(t){const c=t===this._mostRecentTransientRipple,{persistent:i}=t.config;t.state=1,!i&&(!c||!this._isPointerDown)&&t.fadeOut()}_destroyRipple(t){const c=this._activeRipples.get(t)??null;this._activeRipples.delete(t),this._activeRipples.size||(this._containerRect=null),t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),t.state=3,null!==c&&(t.element.removeEventListener("transitionend",c.onTransitionEnd),t.element.removeEventListener("transitioncancel",c.onTransitionCancel)),t.element.remove()}_onMousedown(t){const c=function Jw(o){return 0===o.buttons||0===o.offsetX&&0===o.offsetY}(t),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!c&&!i&&(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))}_onTouchStart(t){if(!this._target.rippleDisabled&&!function PC(o){const t=o.touches&&o.touches[0]||o.changedTouches&&o.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(t)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const c=t.changedTouches;if(c)for(let i=0;i<c.length;i++)this.fadeInRipple(c[i].clientX,c[i].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(t=>{!t.config.persistent&&(1===t.state||t.config.terminateOnPointerUp&&0===t.state)&&t.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const t=this._triggerElement;t&&(hn.forEach(c=>Bt._eventManager.removeHandler(c,t,this)),this._pointerUpEventsRegistered&&On.forEach(c=>t.removeEventListener(c,this,qt)))}}Bt._eventManager=new Fe;let sa=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[v_,v_]}),t})(),bS=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[v_,sa,v_]}),t})();var xS=te(4266);const wS=["addListener","removeListener"],ES=["addEventListener","removeEventListener"],CS=["on","off"];function XC(o,t,c,i){if((0,us.m)(c)&&(i=c,c=void 0),i)return XC(o,t,c).pipe($(i));const[h,w]=function MS(o){return(0,us.m)(o.addEventListener)&&(0,us.m)(o.removeEventListener)}(o)?ES.map(I=>N=>o[I](t,N,c)):function DS(o){return(0,us.m)(o.addListener)&&(0,us.m)(o.removeListener)}(o)?wS.map(sM(o,t)):function TS(o){return(0,us.m)(o.on)&&(0,us.m)(o.off)}(o)?CS.map(sM(o,t)):[];if(!h&&(0,xS.z)(o))return(0,Ct.z)(I=>XC(I,t,c))((0,De.Xf)(o));if(!h)throw new TypeError("Invalid event target");return new Vo.y(I=>{const N=(...Y)=>I.next(1<Y.length?Y:Y[0]);return h(N),()=>w(N)})}function sM(o,t){return c=>i=>o[c](t,i)}var aM=te(1954);const _b={schedule(o){let t=requestAnimationFrame,c=cancelAnimationFrame;const{delegate:i}=_b;i&&(t=i.requestAnimationFrame,c=i.cancelAnimationFrame);const h=t(w=>{c=void 0,o(w)});return new At.w0(()=>c?.(h))},requestAnimationFrame(...o){const{delegate:t}=_b;return(t?.requestAnimationFrame||requestAnimationFrame)(...o)},cancelAnimationFrame(...o){const{delegate:t}=_b;return(t?.cancelAnimationFrame||cancelAnimationFrame)(...o)},delegate:void 0};var lM=te(2631);new class IS extends lM.v{flush(t){this._active=!0;const c=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let h;t=t||i.shift();do{if(h=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===c&&i.shift());if(this._active=!1,h){for(;(t=i[0])&&t.id===c&&i.shift();)t.unsubscribe();throw h}}}(class SS extends aM.o{constructor(t,c){super(t,c),this.scheduler=t,this.work=c}requestAsyncId(t,c,i=0){return null!==i&&i>0?super.requestAsyncId(t,c,i):(t.actions.push(this),t._scheduled||(t._scheduled=_b.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,c,i=0){var h;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,c,i);const{actions:w}=t;null!=c&&(null===(h=w[w.length-1])||void 0===h?void 0:h.id)!==c&&(_b.cancelAnimationFrame(c),t._scheduled=void 0)}});let KC,PS=1;const a1={};function cM(o){return o in a1&&(delete a1[o],!0)}const RS={setImmediate(o){const t=PS++;return a1[t]=!0,KC||(KC=Promise.resolve()),KC.then(()=>cM(t)&&o()),t},clearImmediate(o){cM(o)}},{setImmediate:OS,clearImmediate:kS}=RS,l1={setImmediate(...o){const{delegate:t}=l1;return(t?.setImmediate||OS)(...o)},clearImmediate(o){const{delegate:t}=l1;return(t?.clearImmediate||kS)(o)},delegate:void 0};new class FS extends lM.v{flush(t){this._active=!0;const c=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let h;t=t||i.shift();do{if(h=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===c&&i.shift());if(this._active=!1,h){for(;(t=i[0])&&t.id===c&&i.shift();)t.unsubscribe();throw h}}}(class LS extends aM.o{constructor(t,c){super(t,c),this.scheduler=t,this.work=c}requestAsyncId(t,c,i=0){return null!==i&&i>0?super.requestAsyncId(t,c,i):(t.actions.push(this),t._scheduled||(t._scheduled=l1.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,c,i=0){var h;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,c,i);const{actions:w}=t;null!=c&&(null===(h=w[w.length-1])||void 0===h?void 0:h.id)!==c&&(l1.clearImmediate(c),t._scheduled===c&&(t._scheduled=void 0))}});var uM=te(6321),zS=te(671),VS=te(93);function dM(o,t=uM.z){return function BS(o){return(0,Ve.e)((t,c)=>{let i=!1,h=null,w=null,I=!1;const N=()=>{if(w?.unsubscribe(),w=null,i){i=!1;const J=h;h=null,c.next(J)}I&&c.complete()},Y=()=>{w=null,I&&c.complete()};t.subscribe((0,ee.x)(c,J=>{i=!0,h=J,w||(0,De.Xf)(o(J)).subscribe(w=(0,ee.x)(c,N,Y))},()=>{I=!0,(!i||!w||w.closed)&&c.complete()}))})}(()=>function US(o=0,t,c=uM.P){let i=-1;return null!=t&&((0,zS.K)(t)?c=t:i=t),new Vo.y(h=>{let w=(0,VS.q)(o)?+o-c.now():o;w<0&&(w=0);let I=0;return c.schedule(function(){h.closed||(h.next(I++),0<=i?this.schedule(void 0,i):h.complete())},w)})}(o,t))}let $S=(()=>{var o;class t{constructor(i,h,w){this._ngZone=i,this._platform=h,this._scrolled=new _t.x,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=w}register(i){this.scrollContainers.has(i)||this.scrollContainers.set(i,i.elementScrolled().subscribe(()=>this._scrolled.next(i)))}deregister(i){const h=this.scrollContainers.get(i);h&&(h.unsubscribe(),this.scrollContainers.delete(i))}scrolled(i=20){return this._platform.isBrowser?new Vo.y(h=>{this._globalSubscription||this._addGlobalListener();const w=i>0?this._scrolled.pipe(dM(i)).subscribe(h):this._scrolled.subscribe(h);return this._scrolledCount++,()=>{w.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):(0,Fn.of)()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((i,h)=>this.deregister(h)),this._scrolled.complete()}ancestorScrolled(i,h){const w=this.getAncestorScrollContainers(i);return this.scrolled(h).pipe((0,ft.h)(I=>!I||w.indexOf(I)>-1))}getAncestorScrollContainers(i){const h=[];return this.scrollContainers.forEach((w,I)=>{this._scrollableContainsElement(I,i)&&h.push(I)}),h}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(i,h){let w=Vw(h),I=i.getElementRef().nativeElement;do{if(w==I)return!0}while(w=w.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>XC(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(E.R0b),E.LFG(dd),E.LFG(Ye,8))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),hM=(()=>{var o;class t{constructor(i,h,w){this._platform=i,this._change=new _t.x,this._changeListener=I=>{this._change.next(I)},this._document=w,h.runOutsideAngular(()=>{if(i.isBrowser){const I=this._getWindow();I.addEventListener("resize",this._changeListener),I.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const i=this._getWindow();i.removeEventListener("resize",this._changeListener),i.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const i={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),i}getViewportRect(){const i=this.getViewportScrollPosition(),{width:h,height:w}=this.getViewportSize();return{top:i.top,left:i.left,bottom:i.top+w,right:i.left+h,height:w,width:h}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const i=this._document,h=this._getWindow(),w=i.documentElement,I=w.getBoundingClientRect();return{top:-I.top||i.body.scrollTop||h.scrollY||w.scrollTop||0,left:-I.left||i.body.scrollLeft||h.scrollX||w.scrollLeft||0}}change(i=20){return i>0?this._change.pipe(dM(i)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const i=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:i.innerWidth,height:i.innerHeight}:{width:0,height:0}}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(dd),E.LFG(E.R0b),E.LFG(Ye,8))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),JC=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({}),t})(),fM=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({imports:[Av,JC,Av,JC]}),t})();class QC{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class GS extends QC{constructor(t,c,i,h,w){super(),this.component=t,this.viewContainerRef=c,this.injector=i,this.componentFactoryResolver=h,this.projectableNodes=w}}class WS extends QC{constructor(t,c,i,h){super(),this.templateRef=t,this.viewContainerRef=c,this.context=i,this.injector=h}get origin(){return this.templateRef.elementRef}attach(t,c=this.context){return this.context=c,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class ZS extends QC{constructor(t){super(),this.element=t instanceof E.SBq?t.nativeElement:t}}class qS{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof GS?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof WS?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof ZS?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class YS extends qS{constructor(t,c,i,h,w){super(),this.outletElement=t,this._componentFactoryResolver=c,this._appRef=i,this._defaultInjector=h,this.attachDomPortal=I=>{const N=I.element,Y=this._document.createComment("dom-portal");N.parentNode.insertBefore(Y,N),this.outletElement.appendChild(N),this._attachedPortal=I,super.setDisposeFn(()=>{Y.parentNode&&Y.parentNode.replaceChild(N,Y)})},this._document=w}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let h;return t.viewContainerRef?(h=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector,t.projectableNodes||void 0),this.setDisposeFn(()=>h.destroy())):(h=i.create(t.injector||this._defaultInjector||E.zs3.NULL),this._appRef.attachView(h.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(h.hostView),h.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(h)),this._attachedPortal=t,h}attachTemplatePortal(t){let c=t.viewContainerRef,i=c.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(h=>this.outletElement.appendChild(h)),i.detectChanges(),this.setDisposeFn(()=>{let h=c.indexOf(i);-1!==h&&c.remove(h)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let XS=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({}),t})();const pM=Mw();class KS{constructor(t,c){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=c}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=ho(-this._previousScrollPosition.left),t.style.top=ho(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,h=this._document.body.style,w=i.scrollBehavior||"",I=h.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),pM&&(i.scrollBehavior=h.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),pM&&(i.scrollBehavior=w,h.scrollBehavior=I)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const c=this._document.body,i=this._viewportRuler.getViewportSize();return c.scrollHeight>i.height||c.scrollWidth>i.width}}class JS{constructor(t,c,i,h){this._scrollDispatcher=t,this._ngZone=c,this._viewportRuler=i,this._config=h,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0).pipe((0,ft.h)(c=>!c||!this._overlayRef.overlayElement.contains(c.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const c=this._viewportRuler.getViewportScrollPosition().top;Math.abs(c-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class mM{enable(){}disable(){}attach(){}}function eD(o,t){return t.some(c=>o.bottom<c.top||o.top>c.bottom||o.right<c.left||o.left>c.right)}function gM(o,t){return t.some(c=>o.top<c.top||o.bottom>c.bottom||o.left<c.left||o.right>c.right)}class QS{constructor(t,c,i,h){this._scrollDispatcher=t,this._viewportRuler=c,this._ngZone=i,this._config=h,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const c=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:h}=this._viewportRuler.getViewportSize();eD(c,[{width:i,height:h,bottom:h,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let eI=(()=>{var o;class t{constructor(i,h,w,I){this._scrollDispatcher=i,this._viewportRuler=h,this._ngZone=w,this.noop=()=>new mM,this.close=N=>new JS(this._scrollDispatcher,this._ngZone,this._viewportRuler,N),this.block=()=>new KS(this._viewportRuler,this._document),this.reposition=N=>new QS(this._scrollDispatcher,this._viewportRuler,this._ngZone,N),this._document=I}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG($S),E.LFG(hM),E.LFG(E.R0b),E.LFG(Ye))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();class tI{constructor(t){if(this.scrollStrategy=new mM,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const c=Object.keys(t);for(const i of c)void 0!==t[i]&&(this[i]=t[i])}}}class nI{constructor(t,c){this.connectionPair=t,this.scrollableViewProperties=c}}let _M=(()=>{var o;class t{constructor(i){this._attachedOverlays=[],this._document=i}ngOnDestroy(){this.detach()}add(i){this.remove(i),this._attachedOverlays.push(i)}remove(i){const h=this._attachedOverlays.indexOf(i);h>-1&&this._attachedOverlays.splice(h,1),0===this._attachedOverlays.length&&this.detach()}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ye))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),iI=(()=>{var o;class t extends _M{constructor(i,h){super(i),this._ngZone=h,this._keydownListener=w=>{const I=this._attachedOverlays;for(let N=I.length-1;N>-1;N--)if(I[N]._keydownEvents.observers.length>0){const Y=I[N]._keydownEvents;this._ngZone?this._ngZone.run(()=>Y.next(w)):Y.next(w);break}}}add(i){super.add(i),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ye),E.LFG(E.R0b,8))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),rI=(()=>{var o;class t extends _M{constructor(i,h,w){super(i),this._platform=h,this._ngZone=w,this._cursorStyleIsSet=!1,this._pointerDownListener=I=>{this._pointerDownEventTarget=Cv(I)},this._clickListener=I=>{const N=Cv(I),Y="click"===I.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:N;this._pointerDownEventTarget=null;const J=this._attachedOverlays.slice();for(let xe=J.length-1;xe>-1;xe--){const Ae=J[xe];if(Ae._outsidePointerEvents.observers.length<1||!Ae.hasAttached())continue;if(Ae.overlayElement.contains(N)||Ae.overlayElement.contains(Y))break;const It=Ae._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>It.next(I)):It.next(I)}}}add(i){if(super.add(i),!this._isAttached){const h=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(h)):this._addEventListeners(h),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=h.style.cursor,h.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const i=this._document.body;i.removeEventListener("pointerdown",this._pointerDownListener,!0),i.removeEventListener("click",this._clickListener,!0),i.removeEventListener("auxclick",this._clickListener,!0),i.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(i.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(i){i.addEventListener("pointerdown",this._pointerDownListener,!0),i.addEventListener("click",this._clickListener,!0),i.addEventListener("auxclick",this._clickListener,!0),i.addEventListener("contextmenu",this._clickListener,!0)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ye),E.LFG(dd),E.LFG(E.R0b,8))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),yM=(()=>{var o;class t{constructor(i,h){this._platform=h,this._document=i}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const i="cdk-overlay-container";if(this._platform.isBrowser||lb()){const w=this._document.querySelectorAll(`.${i}[platform="server"], .${i}[platform="test"]`);for(let I=0;I<w.length;I++)w[I].remove()}const h=this._document.createElement("div");h.classList.add(i),lb()?h.setAttribute("platform","test"):this._platform.isBrowser||h.setAttribute("platform","server"),this._document.body.appendChild(h),this._containerElement=h}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(Ye),E.LFG(dd))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();class oI{constructor(t,c,i,h,w,I,N,Y,J,xe=!1){this._portalOutlet=t,this._host=c,this._pane=i,this._config=h,this._ngZone=w,this._keyboardDispatcher=I,this._document=N,this._location=Y,this._outsideClickDispatcher=J,this._animationsDisabled=xe,this._backdropElement=null,this._backdropClick=new _t.x,this._attachments=new _t.x,this._detachments=new _t.x,this._locationChanges=At.w0.EMPTY,this._backdropClickHandler=Ae=>this._backdropClick.next(Ae),this._backdropTransitionendHandler=Ae=>{this._disposeBackdrop(Ae.target)},this._keydownEvents=new _t.x,this._outsidePointerEvents=new _t.x,h.scrollStrategy&&(this._scrollStrategy=h.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=h.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const c=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe((0,ct.q)(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof c?.onDestroy&&c.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),c}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config={...this._config,...t},this._updateElementSize()}setDirection(t){this._config={...this._config,direction:t},this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=ho(this._config.width),t.height=ho(this._config.height),t.minWidth=ho(this._config.minWidth),t.minHeight=ho(this._config.minHeight),t.maxWidth=ho(this._config.maxWidth),t.maxHeight=ho(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,c,i){const h=Mv(c||[]).filter(w=>!!w);h.length&&(i?t.classList.add(...h):t.classList.remove(...h))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe((0,$r.R)((0,R0.T)(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const vM="cdk-overlay-connected-position-bounding-box",sI=/([A-Za-z%]+)$/;class aI{get positions(){return this._preferredPositions}constructor(t,c,i,h,w){this._viewportRuler=c,this._document=i,this._platform=h,this._overlayContainer=w,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new _t.x,this._resizeSubscription=At.w0.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}attach(t){this._validatePositions(),t.hostElement.classList.add(vM),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,c=this._overlayRect,i=this._viewportRect,h=this._containerRect,w=[];let I;for(let N of this._preferredPositions){let Y=this._getOriginPoint(t,h,N),J=this._getOverlayPoint(Y,c,N),xe=this._getOverlayFit(J,c,i,N);if(xe.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(N,Y);this._canFitWithFlexibleDimensions(xe,J,i)?w.push({position:N,origin:Y,overlayRect:c,boundingBoxRect:this._calculateBoundingBoxRect(Y,N)}):(!I||I.overlayFit.visibleArea<xe.visibleArea)&&(I={overlayFit:xe,overlayPoint:J,originPoint:Y,position:N,overlayRect:c})}if(w.length){let N=null,Y=-1;for(const J of w){const xe=J.boundingBoxRect.width*J.boundingBoxRect.height*(J.position.weight||1);xe>Y&&(Y=xe,N=J)}return this._isPushed=!1,void this._applyPosition(N.position,N.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(I.position,I.originPoint);this._applyPosition(I.position,I.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&x_(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(vM),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const c=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,c)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,c,i){let h,w;if("center"==i.originX)h=t.left+t.width/2;else{const I=this._isRtl()?t.right:t.left,N=this._isRtl()?t.left:t.right;h="start"==i.originX?I:N}return c.left<0&&(h-=c.left),w="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,c.top<0&&(w-=c.top),{x:h,y:w}}_getOverlayPoint(t,c,i){let h,w;return h="center"==i.overlayX?-c.width/2:"start"===i.overlayX?this._isRtl()?-c.width:0:this._isRtl()?0:-c.width,w="center"==i.overlayY?-c.height/2:"top"==i.overlayY?0:-c.height,{x:t.x+h,y:t.y+w}}_getOverlayFit(t,c,i,h){const w=xM(c);let{x:I,y:N}=t,Y=this._getOffset(h,"x"),J=this._getOffset(h,"y");Y&&(I+=Y),J&&(N+=J);let It=0-N,wt=N+w.height-i.height,St=this._subtractOverflows(w.width,0-I,I+w.width-i.width),Qt=this._subtractOverflows(w.height,It,wt),fn=St*Qt;return{visibleArea:fn,isCompletelyWithinViewport:w.width*w.height===fn,fitsInViewportVertically:Qt===w.height,fitsInViewportHorizontally:St==w.width}}_canFitWithFlexibleDimensions(t,c,i){if(this._hasFlexibleDimensions){const h=i.bottom-c.y,w=i.right-c.x,I=bM(this._overlayRef.getConfig().minHeight),N=bM(this._overlayRef.getConfig().minWidth);return(t.fitsInViewportVertically||null!=I&&I<=h)&&(t.fitsInViewportHorizontally||null!=N&&N<=w)}return!1}_pushOverlayOnScreen(t,c,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const h=xM(c),w=this._viewportRect,I=Math.max(t.x+h.width-w.width,0),N=Math.max(t.y+h.height-w.height,0),Y=Math.max(w.top-i.top-t.y,0),J=Math.max(w.left-i.left-t.x,0);let xe=0,Ae=0;return xe=h.width<=w.width?J||-I:t.x<this._viewportMargin?w.left-i.left-t.x:0,Ae=h.height<=w.height?Y||-N:t.y<this._viewportMargin?w.top-i.top-t.y:0,this._previousPushAmount={x:xe,y:Ae},{x:t.x+xe,y:t.y+Ae}}_applyPosition(t,c){if(this._setTransformOrigin(t),this._setOverlayElementStyles(c,t),this._setBoundingBoxStyles(c,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),h=new nI(t,i);this._positionChanges.next(h)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const c=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,h=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let w=0;w<c.length;w++)c[w].style.transformOrigin=`${i} ${h}`}_calculateBoundingBoxRect(t,c){const i=this._viewportRect,h=this._isRtl();let w,I,N,xe,Ae,It;if("top"===c.overlayY)I=t.y,w=i.height-I+this._viewportMargin;else if("bottom"===c.overlayY)N=i.height-t.y+2*this._viewportMargin,w=i.height-N+this._viewportMargin;else{const wt=Math.min(i.bottom-t.y+i.top,t.y),St=this._lastBoundingBoxSize.height;w=2*wt,I=t.y-wt,w>St&&!this._isInitialRender&&!this._growAfterOpen&&(I=t.y-St/2)}if("end"===c.overlayX&&!h||"start"===c.overlayX&&h)It=i.width-t.x+this._viewportMargin,xe=t.x-this._viewportMargin;else if("start"===c.overlayX&&!h||"end"===c.overlayX&&h)Ae=t.x,xe=i.right-t.x;else{const wt=Math.min(i.right-t.x+i.left,t.x),St=this._lastBoundingBoxSize.width;xe=2*wt,Ae=t.x-wt,xe>St&&!this._isInitialRender&&!this._growAfterOpen&&(Ae=t.x-St/2)}return{top:I,left:Ae,bottom:N,right:It,width:xe,height:w}}_setBoundingBoxStyles(t,c){const i=this._calculateBoundingBoxRect(t,c);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const h={};if(this._hasExactPosition())h.top=h.left="0",h.bottom=h.right=h.maxHeight=h.maxWidth="",h.width=h.height="100%";else{const w=this._overlayRef.getConfig().maxHeight,I=this._overlayRef.getConfig().maxWidth;h.height=ho(i.height),h.top=ho(i.top),h.bottom=ho(i.bottom),h.width=ho(i.width),h.left=ho(i.left),h.right=ho(i.right),h.alignItems="center"===c.overlayX?"center":"end"===c.overlayX?"flex-end":"flex-start",h.justifyContent="center"===c.overlayY?"center":"bottom"===c.overlayY?"flex-end":"flex-start",w&&(h.maxHeight=ho(w)),I&&(h.maxWidth=ho(I))}this._lastBoundingBoxSize=i,x_(this._boundingBox.style,h)}_resetBoundingBoxStyles(){x_(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){x_(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,c){const i={},h=this._hasExactPosition(),w=this._hasFlexibleDimensions,I=this._overlayRef.getConfig();if(h){const xe=this._viewportRuler.getViewportScrollPosition();x_(i,this._getExactOverlayY(c,t,xe)),x_(i,this._getExactOverlayX(c,t,xe))}else i.position="static";let N="",Y=this._getOffset(c,"x"),J=this._getOffset(c,"y");Y&&(N+=`translateX(${Y}px) `),J&&(N+=`translateY(${J}px)`),i.transform=N.trim(),I.maxHeight&&(h?i.maxHeight=ho(I.maxHeight):w&&(i.maxHeight="")),I.maxWidth&&(h?i.maxWidth=ho(I.maxWidth):w&&(i.maxWidth="")),x_(this._pane.style,i)}_getExactOverlayY(t,c,i){let h={top:"",bottom:""},w=this._getOverlayPoint(c,this._overlayRect,t);return this._isPushed&&(w=this._pushOverlayOnScreen(w,this._overlayRect,i)),"bottom"===t.overlayY?h.bottom=this._document.documentElement.clientHeight-(w.y+this._overlayRect.height)+"px":h.top=ho(w.y),h}_getExactOverlayX(t,c,i){let I,h={left:"",right:""},w=this._getOverlayPoint(c,this._overlayRect,t);return this._isPushed&&(w=this._pushOverlayOnScreen(w,this._overlayRect,i)),I=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===I?h.right=this._document.documentElement.clientWidth-(w.x+this._overlayRect.width)+"px":h.left=ho(w.x),h}_getScrollVisibility(){const t=this._getOriginRect(),c=this._pane.getBoundingClientRect(),i=this._scrollables.map(h=>h.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:gM(t,i),isOriginOutsideView:eD(t,i),isOverlayClipped:gM(c,i),isOverlayOutsideView:eD(c,i)}}_subtractOverflows(t,...c){return c.reduce((i,h)=>i-Math.max(h,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,c=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+c-this._viewportMargin,width:t-2*this._viewportMargin,height:c-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,c){return"x"===c?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&Mv(t).forEach(c=>{""!==c&&-1===this._appliedPanelClasses.indexOf(c)&&(this._appliedPanelClasses.push(c),this._pane.classList.add(c))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof E.SBq)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const c=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+c,height:i,width:c}}}function x_(o,t){for(let c in t)t.hasOwnProperty(c)&&(o[c]=t[c]);return o}function bM(o){if("number"!=typeof o&&null!=o){const[t,c]=o.split(sI);return c&&"px"!==c?null:parseFloat(t)}return o||null}function xM(o){return{top:Math.floor(o.top),right:Math.floor(o.right),bottom:Math.floor(o.bottom),left:Math.floor(o.left),width:Math.floor(o.width),height:Math.floor(o.height)}}const wM="cdk-global-overlay-wrapper";class lI{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const c=t.getConfig();this._overlayRef=t,this._width&&!c.width&&t.updateSize({width:this._width}),this._height&&!c.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(wM),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,c=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:h,height:w,maxWidth:I,maxHeight:N}=i,Y=!("100%"!==h&&"100vw"!==h||I&&"100%"!==I&&"100vw"!==I),J=!("100%"!==w&&"100vh"!==w||N&&"100%"!==N&&"100vh"!==N),xe=this._xPosition,Ae=this._xOffset,It="rtl"===this._overlayRef.getConfig().direction;let wt="",St="",Qt="";Y?Qt="flex-start":"center"===xe?(Qt="center",It?St=Ae:wt=Ae):It?"left"===xe||"end"===xe?(Qt="flex-end",wt=Ae):("right"===xe||"start"===xe)&&(Qt="flex-start",St=Ae):"left"===xe||"start"===xe?(Qt="flex-start",wt=Ae):("right"===xe||"end"===xe)&&(Qt="flex-end",St=Ae),t.position=this._cssPosition,t.marginLeft=Y?"0":wt,t.marginTop=J?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=Y?"0":St,c.justifyContent=Qt,c.alignItems=J?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,c=this._overlayRef.hostElement,i=c.style;c.classList.remove(wM),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let cI=(()=>{var o;class t{constructor(i,h,w,I){this._viewportRuler=i,this._document=h,this._platform=w,this._overlayContainer=I}global(){return new lI}flexibleConnectedTo(i){return new aI(i,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(hM),E.LFG(Ye),E.LFG(dd),E.LFG(yM))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})(),uI=0,tD=(()=>{var o;class t{constructor(i,h,w,I,N,Y,J,xe,Ae,It,wt,St){this.scrollStrategies=i,this._overlayContainer=h,this._componentFactoryResolver=w,this._positionBuilder=I,this._keyboardDispatcher=N,this._injector=Y,this._ngZone=J,this._document=xe,this._directionality=Ae,this._location=It,this._outsideClickDispatcher=wt,this._animationsModuleType=St}create(i){const h=this._createHostElement(),w=this._createPaneElement(h),I=this._createPortalOutlet(w),N=new tI(i);return N.direction=N.direction||this._directionality.value,new oI(I,h,w,N,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(i){const h=this._document.createElement("div");return h.id="cdk-overlay-"+uI++,h.classList.add("cdk-overlay-pane"),i.appendChild(h),h}_createHostElement(){const i=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(i),i}_createPortalOutlet(i){return this._appRef||(this._appRef=this._injector.get(E.z2F)),new YS(i,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return(o=t).\u0275fac=function(i){return new(i||o)(E.LFG(eI),E.LFG(yM),E.LFG(E._Vd),E.LFG(cI),E.LFG(iI),E.LFG(E.zs3),E.LFG(E.R0b),E.LFG(Ye),E.LFG(r1),E.LFG(En),E.LFG(rI),E.LFG(E.QbO,8))},o.\u0275prov=E.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),t})();const fI={provide:new E.OlP("cdk-connected-overlay-scroll-strategy"),deps:[tD],useFactory:function hI(o){return()=>o.scrollStrategies.reposition()}};let pI=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({providers:[tD,fI],imports:[Av,XS,fM,fM]}),t})();const yI={provide:new E.OlP("mat-menu-scroll-strategy"),deps:[tD],useFactory:function _I(o){return()=>o.scrollStrategies.reposition()}};let vI=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o}),o.\u0275inj=E.cJS({providers:[yI],imports:[gr,sa,v_,pI,JC,v_]}),t})(),bI=(()=>{var o;class t{}return(o=t).\u0275fac=function(i){return new(i||o)},o.\u0275mod=E.oAB({type:o,bootstrap:[Eh]}),o.\u0275inj=E.cJS({providers:[{provide:Qp,useClass:_x,multi:!0}],imports:[Ad,p1,cD,sd,gr,Lg,Vf,Tw,on.Aw.forRoot({}),Dm.forRoot([]),gx,uD.FT.instrument({maxAge:25}),bS,vI]}),t})();Ba().bootstrapModule(bI).catch(o=>console.error(o))},2574:function(Ue){Ue.exports=function(){"use strict";var Se,te,E;function Be(p,ue){if(Se)if(te){var Ye="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Se+")(sharedChunk); ("+te+")(sharedChunk); self.onerror = null;",Ge={};Se(Ge),E=ue(Ge),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(E.workerUrl=window.URL.createObjectURL(new Blob([Ye],{type:"text/javascript"})))}else te=ue;else Se=ue}return Be(0,function(p){var ue=typeof self<"u"?self:{},Ye="2.15.0";let Ge;const Le={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Ge){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ge=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):r}catch{Ge=r}}return Ge},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Le.API_URL)return null;try{const r=new URL(Le.API_URL);return"api.mapbox.cn"===r.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===r.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ie={supported:!1,testSupport:function(r){!Qe&&$e&&(Tt?Wt(r):ke=r)}};let ke,$e,Qe=!1,Tt=!1;function Wt(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,$e),r.isContextLost())return;Ie.supported=!0}catch{}r.deleteTexture(e),Qe=!0}ue.document&&($e=ue.document.createElement("img"),$e.onload=function(){ke&&Wt(ke),ke=null,Tt=!0},$e.onerror=function(){Qe=!0,ke=null},$e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const nn="01";function Pt(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var En=cn;function cn(r,e,s,u){this.cx=3*r,this.bx=3*(s-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(u-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=s,this.p2y=u}cn.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(void 0===e&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var s=r,u=0;u<8;u++){var m=this.sampleCurveX(s)-r;if(Math.abs(m)<e)return s;var y=this.sampleCurveDerivativeX(s);if(Math.abs(y)<1e-6)break;s-=m/y}var x=0,D=1;for(s=r,u=0;u<20&&(m=this.sampleCurveX(s),!(Math.abs(m-r)<e));u++)r>m?x=s:D=s,s=.5*(D-x)+x;return s},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var Dn=Pt(En),pn=nt;function nt(r,e){this.x=r,this.y=e}nt.prototype={clone:function(){return new nt(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,s=r.y-this.y;return e*e+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),s=Math.sin(r),u=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=u,this},_rotateAround:function(r,e){var s=Math.cos(r),u=Math.sin(r),m=e.y+u*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-u*(this.y-e.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},nt.convert=function(r){return r instanceof nt?r:Array.isArray(r)?new nt(r[0],r[1]):r};var Ne=Pt(pn);const Ft=Math.PI/180,jt=180/Math.PI;function kt(r){return r*Ft}function Yt(r){return r*jt}const ui=[[0,0],[1,0],[1,1],[0,1]];function mi(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,s=e*r;return 4*(r<.5?s:3*(r-e)+s-.75)}function ir(r,e,s,u){const m=new Dn(r,e,s,u);return function(y){return m.solve(y)}}const Mo=ir(.25,.1,.25,1);function Wn(r,e,s){return Math.min(s,Math.max(e,r))}function $s(r,e,s){return(s=Wn((s-r)/(e-r),0,1))*s*(3-2*s)}function Ci(r,e,s){const u=s-e,m=((r-e)%u+u)%u+e;return m===e?s:m}function dr(r,e,s){if(!r.length)return s(null,[]);let u=r.length;const m=new Array(r.length);let y=null;r.forEach((x,D)=>{e(x,(S,P)=>{S&&(y=S),m[D]=P,0==--u&&s(y,m)})})}function Hs(r){const e=[];for(const s in r)e.push(r[s]);return e}function ot(r,...e){for(const s of e)for(const u in s)r[u]=s[u];return r}let ut=1;function xt(){return ut++}function bt(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function Gt(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function pt(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function mt(r,e){r.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function gt(r,e){return-1!==r.indexOf(e,r.length-e.length)}function un(r,e,s){const u={};for(const m in r)u[m]=e.call(s||this,r[m],m,r);return u}function _n(r,e,s){const u={};for(const m in r)e.call(s||this,r[m],m,r)&&(u[m]=r[m]);return u}function oi(r){return Array.isArray(r)?r.map(oi):"object"==typeof r&&r?un(r,oi):r}const An={};function qn(r){An[r]||(typeof console<"u"&&console.warn(r),An[r]=!0)}function Vi(r,e,s){return(s.y-r.y)*(e.x-r.x)>(e.y-r.y)*(s.x-r.x)}function Xr(r){let e=0;for(let s,u,m=0,y=r.length,x=y-1;m<y;x=m++)s=r[m],u=r[x],e+=(u.x-s.x)*(s.y+u.y);return e}function Ii(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function rr(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,m,y)=>{const x=m||y;return e[u]=!x||x.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let Wo=null;function ws(r){if(null==Wo){const e=r.navigator?r.navigator.userAgent:null;Wo=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Wo}function aa(r){try{const e=ue[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function po(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}const So="mapbox-tiles";let ni,ri,Bl=500,Un=50;function zr(){try{return ue.caches}catch{}}function Io(){zr()&&!ni&&(ni=ue.caches.open(So))}function mo(r){const e=r.indexOf("?");if(e<0)return r;const u=function(m){const y=m.indexOf("?");return y>0?m.slice(y+1).split("&"):[]}(r).filter(m=>{const y=m.split("=");return"language"===y[0]||"worldview"===y[0]});return u.length?`${r.slice(0,e)}?${u.join("&")}`:r.slice(0,e)}let Ui=1/0;const Kr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Kr);class os extends Error{constructor(e,s,u){401===s&&We(u)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=s,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ji=Ii()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ue.location.protocol?ue.parent:ue).location.href,Gs=function(r,e){if(!(/^file:/.test(s=r.url)||/^file:/.test(ji())&&!/^\w+:/.test(s))){if(ue.fetch&&ue.Request&&ue.AbortController&&ue.Request.prototype.hasOwnProperty("signal"))return function(u,m){const y=new ue.AbortController,x=new ue.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:ji(),referrerPolicy:u.referrerPolicy,signal:y.signal});let D=!1,S=!1;const P=(F=x.url).indexOf("sku=")>0&&We(F);var F;"json"===u.type&&x.headers.set("Accept","application/json");const z=(H,G,K)=>{if(S)return;if(H&&"SecurityError"!==H.message&&qn(H.toString()),G&&K)return U(G);const re=Date.now();ue.fetch(x).then(he=>{if(he.ok){const be=P?he.clone():null;return U(he,be,re)}return m(new os(he.statusText,he.status,u.url))}).catch(he=>{"AbortError"!==he.name&&m(new Error(`${he.message} ${u.url}`))})},U=(H,G,K)=>{("arrayBuffer"===u.type?H.arrayBuffer():"json"===u.type?H.json():H.text()).then(re=>{S||(G&&K&&function(he,be,de){if(Io(),!ni)return;const ve={status:be.status,statusText:be.statusText,headers:new ue.Headers};be.headers.forEach((Je,Ke)=>ve.headers.set(Ke,Je));const we=rr(be.headers.get("Cache-Control")||"");if(we["no-store"])return;we["max-age"]&&ve.headers.set("Expires",new Date(de+1e3*we["max-age"]).toUTCString());const Ee=ve.headers.get("Expires");Ee&&(new Date(Ee).getTime()-de<42e4||function(Je,Ke){if(void 0===ri)try{new Response(new ReadableStream),ri=!0}catch{ri=!1}ri?Ke(Je.body):Je.blob().then(Ke)}(be,Je=>{const Ke=new ue.Response(Je,ve);Io(),ni&&ni.then(dt=>dt.put(mo(he.url),Ke)).catch(dt=>qn(dt.message))}))}(x,G,K),D=!0,m(null,re,H.headers.get("Cache-Control"),H.headers.get("Expires")))}).catch(re=>{S||m(new Error(re.message))})};return P?function(H,G){if(Io(),!ni)return G(null);const K=mo(H.url);ni.then(re=>{re.match(K).then(he=>{const be=function(de){if(!de)return!1;const ve=new Date(de.headers.get("Expires")||0),we=rr(de.headers.get("Cache-Control")||"");return ve>Date.now()&&!we["no-cache"]}(he);re.delete(K),be&&re.put(K,he.clone()),G(null,he,be)}).catch(G)}).catch(G)}(x,z):z(null,null),{cancel:()=>{S=!0,D||y.abort()}}}(r,e);if(Ii()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var s;return function(u,m){const y=new ue.XMLHttpRequest;y.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(y.responseType="arraybuffer");for(const x in u.headers)y.setRequestHeader(x,u.headers[x]);return"json"===u.type&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials="include"===u.credentials,y.onerror=()=>{m(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||0===y.status)&&null!==y.response){let x=y.response;if("json"===u.type)try{x=JSON.parse(y.response)}catch(D){return m(D)}m(null,x,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else m(new os(y.statusText,y.status,u.url))},y.send(u.body),{cancel:()=>y.abort()}}(r,e)},bi=function(r,e){return Gs(ot(r,{type:"arrayBuffer"}),e)};function Oa(r){const e=ue.document.createElement("a");return e.href=r,e.protocol===ue.document.location.protocol&&e.host===ue.document.location.host}const ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Q,ie;Q=[],ie=0;const ge=function(r,e){if(Ie.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),ie>=Le.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Q.push(y),y}ie++;let s=!1;const u=()=>{if(!s)for(s=!0,ie--;Q.length&&ie<Le.MAX_PARALLEL_IMAGE_REQUESTS;){const y=Q.shift(),{requestParameters:x,callback:D,cancelled:S}=y;S||(y.cancel=ge(x,D).cancel)}},m=bi(r,(y,x,D,S)=>{u(),y?e(y):x&&(ue.createImageBitmap?function(P,F){const z=new ue.Blob([new Uint8Array(P)],{type:"image/png"});ue.createImageBitmap(z).then(U=>{F(null,U)}).catch(U=>{F(new Error(`Could not load image because of ${U.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(P,F)=>e(P,F,D,S)):function(P,F){const z=new ue.Image,U=ue.URL;z.onload=()=>{F(null,z),U.revokeObjectURL(z.src),z.onload=null,ue.requestAnimationFrame(()=>{z.src=ye})},z.onerror=()=>F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new ue.Blob([new Uint8Array(P)],{type:"image/png"});z.src=P.byteLength?U.createObjectURL(H):ye}(x,(P,F)=>e(P,F,D,S)))});return{cancel:()=>{m.cancel(),u()}}},Ce="NO_ACCESS_TOKEN";function Re(r){return 0===r.indexOf("mapbox:")}function We(r){return Le.API_URL_REGEX.test(r)}function je(r){return Le.API_CDN_URL_REGEX.test(r)}function Pe(r){return Le.API_STYLE_REGEX.test(r)&&!et(r)}function et(r){return Le.API_SPRITE_REGEX.test(r)}const $t=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Zt(r){const e=r.match($t);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function zt(r){const e=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${e}`}const Zn="mapbox.eventData";function Nn(r){if(!r)return null;const e=r.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(ue.atob(e[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Yn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const s=Nn(Le.ACCESS_TOKEN);let u="";return u=s&&s.u?ue.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(m,y)=>String.fromCharCode(+("0x"+y)))):Le.ACCESS_TOKEN||"",e?`${Zn}.${e}:${u}`:`${Zn}:${u}`}fetchEventData(){const e=aa("localStorage"),s=this.getStorageKey(),u=this.getStorageKey("uuid");if(e)try{const m=ue.localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));const y=ue.localStorage.getItem(u);y&&(this.anonId=y)}catch{qn("Unable to read from LocalStorage")}}saveEventData(){const e=aa("localStorage"),s=this.getStorageKey(),u=this.getStorageKey("uuid");if(e)try{ue.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ue.localStorage.setItem(s,JSON.stringify(this.eventData))}catch{qn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,s,u,m){if(!Le.EVENTS_URL)return;const y=Zt(Le.EVENTS_URL);y.params.push(`access_token=${m||Le.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(e).toISOString()},D=s?ot(x,s):x,S={url:zt(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([D])};var F;this.pendingRequest=(F=P=>{this.pendingRequest=null,u(P),this.saveEventData(),this.processRequests(m)},Gs(ot(S,{method:"POST"}),F))}queueRequest(e,s){this.queue.push(e),this.processRequests(s)}}const jn=new class extends Yn{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,e){Le.EVENTS_URL&&Le.ACCESS_TOKEN&&Array.isArray(r)&&r.some(s=>Re(s)||We(s))&&this.queueRequest(Date.now(),e)}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Nn(Le.ACCESS_TOKEN),s=e?e.u:Le.ACCESS_TOKEN;let u=s!==this.eventData.tokenU;pt(this.anonId)||(this.anonId=bt(),u=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),x=new Date(m),D=(m-this.eventData.lastSuccess)/864e5;u=u||D>=1||D<-1||y.getDate()!==x.getDate()}else u=!0;u?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ye,skuId:nn,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=m,this.eventData.tokenU=s)},r):this.processRequests()}},Qn=jn.postTurnstileEvent.bind(jn),Jn=new class extends Yn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,e,s,u){this.skuToken=e,this.errorCb=u,Le.EVENTS_URL&&(s||Le.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},s):this.errorCb(new Error(Ce)))}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),pt(this.anonId)||(this.anonId=bt()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ye,skuId:nn,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):e&&(this.success[e]=!0)},r))}},fr=Jn.postMapLoadEvent.bind(Jn),si=new class extends Yn{constructor(){super("gljs.performance")}postPerformanceEvent(r,e){Le.EVENTS_URL&&(r||Le.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},r)}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:s}=this.queue.shift(),u=function(m){const y=ue.performance.getEntriesByType("resource"),x=ue.performance.getEntriesByType("mark"),D=function(U){const H={};if(U)for(const G in U)if("other"!==G)for(const K of U[G]){const re=`${G}ResolveRangeMin`,he=`${G}ResolveRangeMax`,be=`${G}RequestCount`,de=`${G}RequestCachedCount`;H[re]=Math.min(H[re]||1/0,K.startTime),H[he]=Math.max(H[he]||-1/0,K.responseEnd);const ve=we=>{void 0===H[we]&&(H[we]=0),++H[we]};void 0!==K.transferSize&&0===K.transferSize&&ve(de),ve(be)}return H}(function(U,H){const G={};if(U)for(const K of U){const re=H(K);void 0===G[re]&&(G[re]=[]),G[re].push(K)}return G}(y,Es)),S=ue.devicePixelRatio,P=ue.navigator.connection||ue.navigator.mozConnection||ue.navigator.webkitConnection,F={counters:[],metadata:[],attributes:[]},z=(U,H,G)=>{null!=G&&U.push({name:H,value:G.toString()})};for(const U in D)z(F.counters,U,D[U]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(z(F.counters,"interactionRangeMin",m.interactionRange[0]),z(F.counters,"interactionRangeMax",m.interactionRange[1])),x)for(const U of Object.keys(ll)){const H=ll[U],G=x.find(K=>K.name===H);G&&z(F.counters,H,G.startTime)}return z(F.counters,"visibilityHidden",m.visibilityHidden),z(F.attributes,"style",function(U){if(U)for(const H of U){const G=H.name.split("?")[0];if(Pe(G)){const K=G.split("/").slice(-2);if(2===K.length)return`mapbox://styles/${K[0]}/${K[1]}`}}}(y)),z(F.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),z(F.attributes,"fogEnabled",m.fogEnabled?"true":"false"),z(F.attributes,"projection",m.projection),z(F.attributes,"zoom",m.zoom),z(F.metadata,"devicePixelRatio",S),z(F.metadata,"connectionEffectiveType",P?P.effectiveType:void 0),z(F.metadata,"navigatorUserAgent",ue.navigator.userAgent),z(F.metadata,"screenWidth",ue.screen.width),z(F.metadata,"screenHeight",ue.screen.height),z(F.metadata,"windowWidth",ue.innerWidth),z(F.metadata,"windowHeight",ue.innerHeight),z(F.metadata,"mapWidth",m.width/S),z(F.metadata,"mapHeight",m.height/S),z(F.metadata,"webglRenderer",m.renderer),z(F.metadata,"webglVendor",m.vendor),z(F.metadata,"sdkVersion",Ye),z(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(s);for(const m of u.metadata);for(const m of u.counters);for(const m of u.attributes);this.postEvent(e,u,()=>{},r)}},Xi=si.postPerformanceEvent.bind(si),Ao=new class extends Yn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,e,s,u){if(!Le.API_URL||!Le.SESSION_PATH)return;const m=Zt(Le.API_URL+Le.SESSION_PATH);m.params.push(`sku=${e||""}`),m.params.push(`access_token=${u||Le.ACCESS_TOKEN||""}`);const y={url:zt(m),headers:{"Content-Type":"text/plain"}};var D;this.pendingRequest=(D=x=>{this.pendingRequest=null,s(x),this.saveEventData(),this.processRequests(u)},Gs(ot(y,{method:"GET"}),D))}getSessionAPI(r,e,s,u){this.skuToken=e,this.errorCb=u,Le.SESSION_PATH&&Le.API_URL&&(s||Le.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},s):this.errorCb(new Error(Ce)))}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||this.getSession(s,this.skuToken,u=>{u?this.errorCb(u):e&&(this.success[e]=!0)},r)}},pr=Ao.getSessionAPI.bind(Ao),Jr=new Set,ll={create:"create",load:"load",fullLoad:"fullLoad"},Rh={mark(r){ue.performance.mark(r)},measure(r,e,s){ue.performance.measure(r,e,s)}};function Es(r){const e=r.name.split("?")[0];return je(e)&&e.includes("mapbox-gl.js")?"javascript":je(e)&&e.includes("mapbox-gl.css")?"css":Le.API_FONTS_REGEX.test(e)?"fontRange":et(e)?"sprite":Pe(e)?"style":Le.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const pi=ue.performance;function Cs(r){const e=r?r.url.toString():void 0;return pi.getEntriesByName(e)}let Qr,xi,Ws,go;const _o={now:()=>void 0!==Ws?Ws:ue.performance.now(),setNow(r){Ws=r},restoreNow(){Ws=void 0},frame(r){const e=ue.requestAnimationFrame(r);return{cancel:()=>ue.cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:s,height:u}=r;go||(go=ue.document.createElement("canvas"));const m=go.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(s>go.width||u>go.height)&&(go.width=s,go.height=u),m.clearRect(-e,-e,s+2*e,u+2*e),m.drawImage(r,0,0,s,u),m.getImageData(-e,-e,s+2*e,u+2*e)},resolveURL:r=>(Qr||(Qr=ue.document.createElement("a")),Qr.href=r,Qr.href),get devicePixelRatio(){return ue.devicePixelRatio},get prefersReducedMotion(){return!!ue.matchMedia&&(null==xi&&(xi=ue.matchMedia("(prefers-reduced-motion: reduce)")),xi.matches)}};function gc(r,e,s){s[r]&&-1!==s[r].indexOf(e)||(s[r]=s[r]||[],s[r].push(e))}function Zo(r,e,s){if(s&&s[r]){const u=s[r].indexOf(e);-1!==u&&s[r].splice(u,1)}}class Po{constructor(e,s={}){ot(this,s),this.type=e}}class qo extends Po{constructor(e,s={}){super("error",ot({error:e},s))}}class ka{on(e,s){return this._listeners=this._listeners||{},gc(e,s,this._listeners),this}off(e,s){return Zo(e,s,this._listeners),Zo(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},gc(e,s,this._oneTimeListeners),this):new Promise(u=>this.once(e,u))}fire(e,s){"string"==typeof e&&(e=new Po(e,s||{}));const u=e.type;if(this.listens(u)){e.target=this;const m=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const D of m)D.call(this,e);const y=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const D of y)Zo(u,D,this._oneTimeListeners),D.call(this,e);const x=this._eventedParent;x&&(ot(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),x.fire(e))}else e instanceof qo&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var lt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ds(r,...e){for(const s of e)for(const u in s)r[u]=s[u];return r}function Ji(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function mr(r){if(Array.isArray(r))return r.map(mr);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const s in r)e[s]=mr(r[s]);return e}return Ji(r)}class _c extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}var Ro=_c;class fd{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[u,m]of s)this.bindings[u]=m}concat(e){return new fd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var La=fd;const zl={kind:"null"},Jt={kind:"number"},Ln={kind:"string"},ei={kind:"boolean"},Oo={kind:"color"},ss={kind:"object"},ai={kind:"value"},so={kind:"collator"},cl={kind:"formatted"},la={kind:"resolvedImage"};function as(r,e){return{kind:"array",itemType:r,N:e}}function Qi(r){if("array"===r.kind){const e=Qi(r.itemType);return"number"==typeof r.N?`array<${e}, ${r.N}>`:"value"===r.itemType.kind?"array":`array<${e}>`}return r.kind}const Yo=[zl,Jt,Ln,ei,Oo,cl,ss,as(ai),la];function _e(r,e){if("error"===e.kind)return null;if("array"===r.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!_e(r.itemType,e.itemType))&&("number"!=typeof r.N||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if("value"===r.kind)for(const s of Yo)if(!_e(s,e))return null}return`Expected ${Qi(r)} but found ${Qi(e)} instead.`}function st(r,e){return e.some(s=>s.kind===r.kind)}function Et(r,e){return e.some(s=>"null"===s?null===r:"array"===s?Array.isArray(r):"object"===s?r&&!Array.isArray(r)&&"object"==typeof r:s===typeof r)}var qe,Vt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function en(r){return(r=Math.round(r))<0?0:r>255?255:r}function Gn(r){return en("%"===r[r.length-1]?parseFloat(r)/100*255:parseInt(r))}function or(r){return(e="%"===r[r.length-1]?parseFloat(r)/100:parseFloat(r))<0?0:e>1?1:e;var e}function Zi(r,e,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?r+(e-r)*s*6:2*s<1?e:3*s<2?r+(e-r)*(2/3-s)*6:r}try{qe={}.parseCSSColor=function(r){var e,s=r.replace(/ /g,"").toLowerCase();if(s in Vt)return Vt[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=s.indexOf("("),m=s.indexOf(")");if(-1!==u&&m+1===s.length){var y=s.substr(0,u),x=s.substr(u+1,m-(u+1)).split(","),D=1;switch(y){case"rgba":if(4!==x.length)return null;D=or(x.pop());case"rgb":return 3!==x.length?null:[Gn(x[0]),Gn(x[1]),Gn(x[2]),D];case"hsla":if(4!==x.length)return null;D=or(x.pop());case"hsl":if(3!==x.length)return null;var S=(parseFloat(x[0])%360+360)%360/360,P=or(x[1]),F=or(x[2]),z=F<=.5?F*(P+1):F+P-F*P,U=2*F-z;return[en(255*Zi(U,z,S+1/3)),en(255*Zi(U,z,S)),en(255*Zi(U,z,S-1/3)),D];default:return null}}return null}}catch{}class Cn{constructor(e,s,u,m=1){this.r=e,this.g=s,this.b=u,this.a=m}static parse(e){if(!e)return;if(e instanceof Cn)return e;if("string"!=typeof e)return;const s=qe(e);return s?new Cn(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[e,s,u,m]=this.toArray();return`rgba(${Math.round(e)},${Math.round(s)},${Math.round(u)},${m})`}toArray(){const{r:e,g:s,b:u,a:m}=this;return 0===m?[0,0,0,0]:[255*e/m,255*s/m,255*u/m,m]}toArray01(){const{r:e,g:s,b:u,a:m}=this;return 0===m?[0,0,0,0]:[e/m,s/m,u/m,m]}toArray01PremultipliedAlpha(){const{r:e,g:s,b:u,a:m}=this;return[e,s,u,m]}}Cn.black=new Cn(0,0,0,1),Cn.white=new Cn(1,1,1,1),Cn.transparent=new Cn(0,0,0,0),Cn.red=new Cn(1,0,0,1),Cn.blue=new Cn(0,0,1,1);var xn=Cn;class $i{constructor(e,s,u){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xo{constructor(e,s,u,m,y){this.text=e.normalize?e.normalize():e,this.image=s,this.scale=u,this.fontStack=m,this.textColor=y}}class qi{constructor(e){this.sections=e}static fromString(e){return new qi([new Xo(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof qi?e:qi.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const s of this.sections){if(s.image){e.push(["image",s.image.name]);continue}e.push(s.text);const u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toArray())),e.push(u)}return e}}class yo{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new yo({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Oh(r,e,s,u){return"number"==typeof r&&r>=0&&r<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[r,e,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[r,e,s,u]:[r,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ul(r){if(null===r||"string"==typeof r||"boolean"==typeof r||"number"==typeof r||r instanceof xn||r instanceof $i||r instanceof qi||r instanceof yo)return!0;if(Array.isArray(r)){for(const e of r)if(!ul(e))return!1;return!0}if("object"==typeof r){for(const e in r)if(!ul(r[e]))return!1;return!0}return!1}function xr(r){if(null===r)return zl;if("string"==typeof r)return Ln;if("boolean"==typeof r)return ei;if("number"==typeof r)return Jt;if(r instanceof xn)return Oo;if(r instanceof $i)return so;if(r instanceof qi)return cl;if(r instanceof yo)return la;if(Array.isArray(r)){const e=r.length;let s;for(const u of r){const m=xr(u);if(s){if(s===m)continue;s=ai;break}s=m}return as(s||ai,e)}return ss}function uu(r){const e=typeof r;return null===r?"":"string"===e||"number"===e||"boolean"===e?String(r):r instanceof xn||r instanceof qi||r instanceof yo?r.toString():JSON.stringify(r)}class hr{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(2!==e.length)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ul(e[1]))return s.error("invalid value");const u=e[1];let m=xr(u);const y=s.expectedType;return"array"!==m.kind||0!==m.N||!y||"array"!==y.kind||"number"==typeof y.N&&0!==y.N||(m=y),new hr(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof xn?["rgba"].concat(this.value.toArray()):this.value instanceof qi?this.value.serialize():this.value}}var ln=hr,Tn=class{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}};const sr={string:Ln,number:Jt,boolean:ei,object:ss};class ko{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let u,m=1;const y=e[0];if("array"===y){let D,S;if(e.length>2){const P=e[1];if("string"!=typeof P||!(P in sr)||"object"===P)return s.error('The item type argument of "array" must be one of string, number, boolean',1);D=sr[P],m++}else D=ai;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);S=e[2],m++}u=as(D,S)}else u=sr[y];const x=[];for(;m<e.length;m++){const D=s.parse(e[m],m,ai);if(!D)return null;x.push(D)}return new ko(u,x)}evaluate(e){for(let s=0;s<this.args.length;s++){const u=this.args[s].evaluate(e);if(!_e(this.type,xr(u)))return u;if(s===this.args.length-1)throw new Tn(`Expected value to be of type ${Qi(this.type)}, but found ${Qi(xr(u))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,s=[e.kind];if("array"===e.kind){const u=e.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){s.push(u.kind);const m=e.N;("number"==typeof m||this.args.length>1)&&s.push(m)}}return s.concat(this.args.map(u=>u.serialize()))}}var Lo=ko;class Mr{constructor(e){this.type=cl,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const u=e[1];if(!Array.isArray(u)&&"object"==typeof u)return s.error("First argument must be an image or text section.");const m=[];let y=!1;for(let x=1;x<=e.length-1;++x){const D=e[x];if(y&&"object"==typeof D&&!Array.isArray(D)){y=!1;let S=null;if(D["font-scale"]&&(S=s.parse(D["font-scale"],1,Jt),!S))return null;let P=null;if(D["text-font"]&&(P=s.parse(D["text-font"],1,as(Ln)),!P))return null;let F=null;if(D["text-color"]&&(F=s.parse(D["text-color"],1,Oo),!F))return null;const z=m[m.length-1];z.scale=S,z.font=P,z.textColor=F}else{const S=s.parse(e[x],1,ai);if(!S)return null;const P=S.type.kind;if("string"!==P&&"value"!==P&&"null"!==P&&"resolvedImage"!==P)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,m.push({content:S,scale:null,font:null,textColor:null})}}return new Mr(m)}evaluate(e){return new qi(this.sections.map(s=>{const u=s.content.evaluate(e);return xr(u)===la?new Xo("",u,null,null,null):new Xo(uu(u),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const s of this.sections){e.push(s.content.serialize());const u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),e.push(u)}return e}}class dl{constructor(e){this.type=la,this.input=e}static parse(e,s){if(2!==e.length)return s.error("Expected two arguments.");const u=s.parse(e[1],1,Ln);return u?new dl(u):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),u=yo.fromString(s);return u&&e.availableImages&&(u.available=e.availableImages.indexOf(s)>-1),u}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const gr={"to-boolean":ei,"to-color":Oo,"to-number":Jt,"to-string":Ln};class Zs{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const u=e[0];if(("to-boolean"===u||"to-string"===u)&&2!==e.length)return s.error("Expected one argument.");const m=gr[u],y=[];for(let x=1;x<e.length;x++){const D=s.parse(e[x],x,ai);if(!D)return null;y.push(D)}return new Zs(m,y)}evaluate(e){if("boolean"===this.type.kind)return!!this.args[0].evaluate(e);if("color"===this.type.kind){let s,u;for(const m of this.args){if(s=m.evaluate(e),u=null,s instanceof xn)return s;if("string"==typeof s){const y=e.parseColor(s);if(y)return y}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Oh(s[0],s[1],s[2],s[3]),!u))return new xn(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Tn(u||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const u of this.args){if(s=u.evaluate(e),null===s)return 0;const m=Number(s);if(!isNaN(m))return m}throw new Tn(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?qi.fromString(uu(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?yo.fromString(uu(this.args[0].evaluate(e))):uu(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Mr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new dl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(s=>{e.push(s.serialize())}),e}}var qs=Zs;const Bn=["Unknown","Point","LineString","Polygon"];var Vl=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Bn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:s,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*e-r[0])+this.featureDistanceData.bearing[1]*(u*e-r[1])}return 0}parseColor(r){let e=this._parseColorCache[r];return e||(e=this._parseColorCache[r]=xn.parse(r)),e}};class hl{constructor(e,s,u,m){this.name=e,this.type=s,this._evaluate=u,this.args=m}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,s){const u=e[0],m=hl.definitions[u];if(!m)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(m)?m[0]:m.type,x=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,D=x.filter(([P])=>!Array.isArray(P)||P.length===e.length-1);let S=null;for(const[P,F]of D){S=new Ss(s.registry,s.path,null,s.scope);const z=[];let U=!1;for(let H=1;H<e.length;H++){const G=e[H],K=Array.isArray(P)?P[H-1]:P.type,re=S.parse(G,1+z.length,K);if(!re){U=!0;break}z.push(re)}if(!U)if(Array.isArray(P)&&P.length!==z.length)S.error(`Expected ${P.length} arguments, but found ${z.length} instead.`);else{for(let H=0;H<z.length;H++){const G=Array.isArray(P)?P[H]:P.type,K=z[H];S.concat(H+1).checkSubtype(G,K.type)}if(0===S.errors.length)return new hl(u,y,F,z)}}if(1===D.length)s.errors.push(...S.errors);else{const P=(D.length?D:x).map(([z])=>{return U=z,Array.isArray(U)?`(${U.map(Qi).join(", ")})`:`(${Qi(U.type)}...)`;var U}).join(" | "),F=[];for(let z=1;z<e.length;z++){const U=s.parse(e[z],1+F.length);if(!U)return null;F.push(Qi(U.type))}s.error(`Expected arguments of type ${P}, but found (${F.join(", ")}) instead.`)}return null}static register(e,s){hl.definitions=s;for(const u in s)e[u]=hl}}var Fo=hl;class _r{constructor(e,s,u){this.type=so,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(2!==e.length)return s.error("Expected one argument.");const u=e[1];if("object"!=typeof u||Array.isArray(u))return s.error("Collator options argument must be an object.");const m=s.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,ei);if(!m)return null;const y=s.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,ei);if(!y)return null;let x=null;return u.locale&&(x=s.parse(u.locale,1,Ln),!x)?null:new _r(m,y,x)}evaluate(e){return new $i(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Ts=8192;function fl(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function No(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Fa(r,e){const s=(180+r[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,m=Math.pow(2,e.z);return[Math.round(s*m*Ts),Math.round(u*m*Ts)]}function kh(r,e,s){const u=r[0]-e[0],m=r[1]-e[1],y=r[0]-s[0],x=r[1]-s[1];return u*x-y*m==0&&u*y<=0&&m*x<=0}function ca(r,e){let s=!1;for(let x=0,D=e.length;x<D;x++){const S=e[x];for(let P=0,F=S.length;P<F-1;P++){if(kh(r,S[P],S[P+1]))return!1;(m=S[P])[1]>(u=r)[1]!=(y=S[P+1])[1]>u[1]&&u[0]<(y[0]-m[0])*(u[1]-m[1])/(y[1]-m[1])+m[0]&&(s=!s)}}var u,m,y;return s}function Ms(r,e){for(let s=0;s<e.length;s++)if(ca(r,e[s]))return!0;return!1}function du(r,e,s,u){const m=u[0]-s[0],y=u[1]-s[1],x=(r[0]-s[0])*y-m*(r[1]-s[1]),D=(e[0]-s[0])*y-m*(e[1]-s[1]);return x>0&&D<0||x<0&&D>0}function Ys(r,e,s){for(const P of s)for(let F=0;F<P.length-1;++F)if((D=[(x=P[F+1])[0]-(y=P[F])[0],x[1]-y[1]])[0]*(S=[(m=e)[0]-(u=r)[0],m[1]-u[1]])[1]-D[1]*S[0]!=0&&du(u,m,y,x)&&du(y,x,u,m))return!0;var u,m,y,x,D,S;return!1}function yn(r,e){for(let s=0;s<r.length;++s)if(!ca(r[s],e))return!1;for(let s=0;s<r.length-1;++s)if(Ys(r[s],r[s+1],e))return!1;return!0}function C_(r,e){for(let s=0;s<e.length;s++)if(yn(r,e[s]))return!0;return!1}function hu(r,e,s){const u=[];for(let m=0;m<r.length;m++){const y=[];for(let x=0;x<r[m].length;x++){const D=Fa(r[m][x],s);fl(e,D),y.push(D)}u.push(y)}return u}function Lh(r,e,s){const u=[];for(let m=0;m<r.length;m++){const y=hu(r[m],e,s);u.push(y)}return u}function Bo(r,e,s,u){if(r[0]<s[0]||r[0]>s[2]){const m=.5*u;let y=r[0]-s[0]>m?-u:s[0]-r[0]>m?u:0;0===y&&(y=r[0]-s[2]>m?-u:s[2]-r[0]>m?u:0),r[0]+=y}fl(e,r)}function fu(r,e,s,u){const m=Math.pow(2,u.z)*Ts,y=[u.x*Ts,u.y*Ts],x=[];if(!r)return x;for(const D of r)for(const S of D){const P=[S.x+y[0],S.y+y[1]];Bo(P,e,s,m),x.push(P)}return x}function Ul(r,e,s,u){const m=Math.pow(2,u.z)*Ts,y=[u.x*Ts,u.y*Ts],x=[];if(!r)return x;for(const S of r){const P=[];for(const F of S){const z=[F.x+y[0],F.y+y[1]];fl(e,z),P.push(z)}x.push(P)}if(e[2]-e[0]<=m/2){(D=e)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const S of x)for(const P of S)Bo(P,e,s,m)}var D;return x}class ua{constructor(e,s){this.type=ei,this.geojson=e,this.geometries=s}static parse(e,s){if(2!==e.length)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ul(e[1])){const u=e[1];if("FeatureCollection"===u.type)for(let m=0;m<u.features.length;++m){const y=u.features[m].geometry.type;if("Polygon"===y||"MultiPolygon"===y)return new ua(u,u.features[m].geometry)}else if("Feature"===u.type){const m=u.geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new ua(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new ua(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(s,u){const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(!x)return!1;if("Polygon"===u.type){const D=hu(u.coordinates,y,x),S=fu(s.geometry(),m,y,x);if(!No(m,y))return!1;for(const P of S)if(!ca(P,D))return!1}if("MultiPolygon"===u.type){const D=Lh(u.coordinates,y,x),S=fu(s.geometry(),m,y,x);if(!No(m,y))return!1;for(const P of S)if(!Ms(P,D))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(s,u){const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(!x)return!1;if("Polygon"===u.type){const D=hu(u.coordinates,y,x),S=Ul(s.geometry(),m,y,x);if(!No(m,y))return!1;for(const P of S)if(!yn(P,D))return!1}if("MultiPolygon"===u.type){const D=Lh(u.coordinates,y,x),S=Ul(s.geometry(),m,y,x);if(!No(m,y))return!1;for(const P of S)if(!C_(P,D))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Vr=ua;function pd(r){if(r instanceof Fo&&("get"===r.name&&1===r.args.length||"feature-state"===r.name||"has"===r.name&&1===r.args.length||"properties"===r.name||"geometry-type"===r.name||"id"===r.name||/^filter-/.test(r.name))||r instanceof Vr)return!1;let e=!0;return r.eachChild(s=>{e&&!pd(s)&&(e=!1)}),e}function Or(r){if(r instanceof Fo&&"feature-state"===r.name)return!1;let e=!0;return r.eachChild(s=>{e&&!Or(s)&&(e=!1)}),e}function kr(r,e){if(r instanceof Fo&&e.indexOf(r.name)>=0)return!1;let s=!0;return r.eachChild(u=>{s&&!kr(u,e)&&(s=!1)}),s}class yc{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(2!==e.length||"string"!=typeof e[1])return s.error("'var' expression requires exactly one string literal argument.");const u=e[1];return s.scope.has(u)?new yc(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var pl=yc;class jl{constructor(e,s=[],u,m=new La,y=[]){this.registry=e,this.path=s,this.key=s.map(x=>`[${x}]`).join(""),this.scope=m,this.errors=y,this.expectedType=u}parse(e,s,u,m,y={}){return s?this.concat(s,u,m)._parse(e,y):this._parse(e,y)}_parse(e,s){function u(m,y,x){return"assert"===x?new Lo(y,[m]):"coerce"===x?new qs(y,[m]):m}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=e[0];if("string"!=typeof m)return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[m];if(y){let x=y.parse(e,this);if(!x)return null;if(this.expectedType){const D=this.expectedType,S=x.type;if("string"!==D.kind&&"number"!==D.kind&&"boolean"!==D.kind&&"object"!==D.kind&&"array"!==D.kind||"value"!==S.kind)if("color"!==D.kind&&"formatted"!==D.kind&&"resolvedImage"!==D.kind||"value"!==S.kind&&"string"!==S.kind){if(this.checkSubtype(D,S))return null}else x=u(x,D,s.typeAnnotation||"coerce");else x=u(x,D,s.typeAnnotation||"assert")}if(!(x instanceof ln)&&"resolvedImage"!==x.type.kind&&pu(x)){const D=new Vl;try{x=new ln(x.type,x.evaluate(D))}catch(S){return this.error(S.message),null}}return x}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,u){const m="number"==typeof e?this.path.concat(e):this.path,y=u?this.scope.concat(u):this.scope;return new jl(this.registry,m,s||null,y,this.errors)}error(e,...s){const u=`${this.key}${s.map(m=>`[${m}]`).join("")}`;this.errors.push(new Ro(u,e))}checkSubtype(e,s){const u=_e(e,s);return u&&this.error(u),u}}var Ss=jl;function pu(r){if(r instanceof pl)return pu(r.boundExpression);if(r instanceof Fo&&"error"===r.name||r instanceof _r||r instanceof Vr)return!1;const e=r instanceof qs||r instanceof Lo;let s=!0;return r.eachChild(u=>{s=e?s&&pu(u):s&&u instanceof ln}),!!s&&pd(r)&&kr(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function md(r,e){const s=r.length-1;let u,m,y=0,x=s,D=0;for(;y<=x;)if(D=Math.floor((y+x)/2),u=r[D],m=r[D+1],u<=e){if(D===s||e<m)return D;y=D+1}else{if(!(u>e))throw new Tn("Input is not a number.");x=D-1}return 0}class gd{constructor(e,s,u){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[m,y]of u)this.labels.push(m),this.outputs.push(y)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const u=s.parse(e[1],1,Jt);if(!u)return null;const m=[];let y=null;s.expectedType&&"value"!==s.expectedType.kind&&(y=s.expectedType);for(let x=1;x<e.length;x+=2){const D=1===x?-1/0:e[x],S=e[x+1],P=x,F=x+1;if("number"!=typeof D)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(m.length&&m[m.length-1][0]>=D)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const z=s.parse(S,F,y);if(!z)return null;y=y||z.type,m.push([D,z])}return new gd(y,u,m)}evaluate(e){const s=this.labels,u=this.outputs;if(1===s.length)return u[0].evaluate(e);const m=this.input.evaluate(e);if(m<=s[0])return u[0].evaluate(e);const y=s.length;return m>=s[y-1]?u[y-1].evaluate(e):u[md(s,m)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&e.push(this.labels[s]),e.push(this.outputs[s].serialize());return e}}var Nm=gd;function wi(r,e,s){return r*(1-s)+e*s}var mu=Object.freeze({__proto__:null,array:function(r,e,s){return r.map((u,m)=>wi(u,e[m],s))},color:function(r,e,s){return new xn(wi(r.r,e.r,s),wi(r.g,e.g,s),wi(r.b,e.b,s),wi(r.a,e.a,s))},number:wi});const D_=4/29,gu=6/29,wr=3*gu*gu,Rv=gu*gu*gu,Ov=Math.PI/180,kv=180/Math.PI;function zm(r){return r>Rv?Math.pow(r,1/3):r/wr+D_}function Vm(r){return r>gu?r*r*r:wr*(r-D_)}function Um(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function ep(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Fh(r){const e=ep(r.r),s=ep(r.g),u=ep(r.b),m=zm((.4124564*e+.3575761*s+.1804375*u)/.95047),y=zm((.2126729*e+.7151522*s+.072175*u)/1);return{l:116*y-16,a:500*(m-y),b:200*(y-zm((.0193339*e+.119192*s+.9503041*u)/1.08883)),alpha:r.a}}function tp(r){let e=(r.l+16)/116,s=isNaN(r.a)?e:e+r.a/500,u=isNaN(r.b)?e:e-r.b/200;return e=1*Vm(e),s=.95047*Vm(s),u=1.08883*Vm(u),new xn(Um(3.2404542*s-1.5371385*e-.4985314*u),Um(-.969266*s+1.8760108*e+.041556*u),Um(.0556434*s-.2040259*e+1.0572252*u),r.alpha)}function Lv(r,e,s){const u=e-r;return r+s*(u>180||u<-180?u-360*Math.round(u/360):u)}const Nh={forward:Fh,reverse:tp,interpolate:function(r,e,s){return{l:wi(r.l,e.l,s),a:wi(r.a,e.a,s),b:wi(r.b,e.b,s),alpha:wi(r.alpha,e.alpha,s)}}},vc={forward:function(r){const{l:e,a:s,b:u}=Fh(r),m=Math.atan2(u,s)*kv;return{h:m<0?m+360:m,c:Math.sqrt(s*s+u*u),l:e,alpha:r.a}},reverse:function(r){const e=r.h*Ov,s=r.c;return tp({l:r.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:r.alpha})},interpolate:function(r,e,s){return{h:Lv(r.h,e.h,s),c:wi(r.c,e.c,s),l:wi(r.l,e.l,s),alpha:wi(r.alpha,e.alpha,s)}}};var Na=Object.freeze({__proto__:null,hcl:vc,lab:Nh});class bc{constructor(e,s,u,m,y){this.type=e,this.operator=s,this.interpolation=u,this.input=m,this.labels=[],this.outputs=[];for(const[x,D]of y)this.labels.push(x),this.outputs.push(D)}static interpolationFactor(e,s,u,m){let y=0;if("exponential"===e.name)y=_d(s,e.base,u,m);else if("linear"===e.name)y=_d(s,1,u,m);else if("cubic-bezier"===e.name){const x=e.controlPoints;y=new Dn(x[0],x[1],x[2],x[3]).solve(_d(s,1,u,m))}return y}static parse(e,s){let[u,m,y,...x]=e;if(!Array.isArray(m)||0===m.length)return s.error("Expected an interpolation type expression.",1);if("linear"===m[0])m={name:"linear"};else if("exponential"===m[0]){const P=m[1];if("number"!=typeof P)return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:P}}else{if("cubic-bezier"!==m[0])return s.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const P=m.slice(1);if(4!==P.length||P.some(F=>"number"!=typeof F||F<0||F>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(y=s.parse(y,2,Jt),!y)return null;const D=[];let S=null;"interpolate-hcl"===u||"interpolate-lab"===u?S=Oo:s.expectedType&&"value"!==s.expectedType.kind&&(S=s.expectedType);for(let P=0;P<x.length;P+=2){const F=x[P],z=x[P+1],U=P+3,H=P+4;if("number"!=typeof F)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(D.length&&D[D.length-1][0]>=F)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const G=s.parse(z,H,S);if(!G)return null;S=S||G.type,D.push([F,G])}return"number"===S.kind||"color"===S.kind||"array"===S.kind&&"number"===S.itemType.kind&&"number"==typeof S.N?new bc(S,u,m,y,D):s.error(`Type ${Qi(S)} is not interpolatable.`)}evaluate(e){const s=this.labels,u=this.outputs;if(1===s.length)return u[0].evaluate(e);const m=this.input.evaluate(e);if(m<=s[0])return u[0].evaluate(e);const y=s.length;if(m>=s[y-1])return u[y-1].evaluate(e);const x=md(s,m),D=bc.interpolationFactor(this.interpolation,m,s[x],s[x+1]),S=u[x].evaluate(e),P=u[x+1].evaluate(e);return"interpolate"===this.operator?mu[this.type.kind.toLowerCase()](S,P,D):"interpolate-hcl"===this.operator?vc.reverse(vc.interpolate(vc.forward(S),vc.forward(P),D)):Nh.reverse(Nh.interpolate(Nh.forward(S),Nh.forward(P),D))}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,e,this.input.serialize()];for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function _d(r,e,s,u){const m=u-s,y=r-s;return 0===m?0:1===e?y/m:(Math.pow(e,y)-1)/(Math.pow(e,m)-1)}var vo=bc;class yd{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let u=null;const m=s.expectedType;m&&"value"!==m.kind&&(u=m);const y=[];for(const D of e.slice(1)){const S=s.parse(D,1+y.length,u,void 0,{typeAnnotation:"omit"});if(!S)return null;u=u||S.type,y.push(S)}const x=m&&y.some(D=>_e(m,D.type));return new yd(x?ai:u,y)}evaluate(e){let s,u=null,m=0;for(const y of this.args){if(m++,u=y.evaluate(e),u&&u instanceof yo&&!u.available&&(s||(s=u),u=null,m===this.args.length))return s;if(null!==u)break}return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(s=>{e.push(s.serialize())}),e}}var np=yd;class _u{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const u=[];for(let y=1;y<e.length-1;y+=2){const x=e[y];if("string"!=typeof x)return s.error(`Expected string, but found ${typeof x} instead.`,y);if(/[^a-zA-Z0-9_]/.test(x))return s.error("Variable names must contain only alphanumeric characters or '_'.",y);const D=s.parse(e[y+1],y+1);if(!D)return null;u.push([x,D])}const m=s.parse(e[e.length-1],e.length-1,s.expectedType,u);return m?new _u(u,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[s,u]of this.bindings)e.push(s,u.serialize());return e.push(this.result.serialize()),e}}var Bh=_u;class jm{constructor(e,s,u){this.type=e,this.index=s,this.input=u}static parse(e,s){if(3!==e.length)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=s.parse(e[1],1,Jt),m=s.parse(e[2],2,as(s.expectedType||ai));return u&&m?new jm(m.type.itemType,u,m):null}evaluate(e){const s=this.index.evaluate(e),u=this.input.evaluate(e);if(s<0)throw new Tn(`Array index out of bounds: ${s} < 0.`);if(s>=u.length)throw new Tn(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s!==Math.floor(s))throw new Tn(`Array index must be an integer, but found ${s} instead.`);return u[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var T_=jm;class Is{constructor(e,s){this.type=ei,this.needle=e,this.haystack=s}static parse(e,s){if(3!==e.length)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=s.parse(e[1],1,ai),m=s.parse(e[2],2,ai);return u&&m?st(u.type,[ei,Ln,Jt,zl,ai])?new Is(u,m):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(u.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(null==u)return!1;if(!Et(s,["boolean","string","number","null"]))throw new Tn(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(xr(s))} instead.`);if(!Et(u,["string","array"]))throw new Tn(`Expected second argument to be of type array or string, but found ${Qi(xr(u))} instead.`);return u.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ml=Is;class Lr{constructor(e,s,u){this.type=Jt,this.needle=e,this.haystack=s,this.fromIndex=u}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=s.parse(e[1],1,ai),m=s.parse(e[2],2,ai);if(!u||!m)return null;if(!st(u.type,[ei,Ln,Jt,zl,ai]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(u.type)} instead`);if(4===e.length){const y=s.parse(e[3],3,Jt);return y?new Lr(u,m,y):null}return new Lr(u,m)}evaluate(e){const s=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!Et(s,["boolean","string","number","null"]))throw new Tn(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(xr(s))} instead.`);if(!Et(u,["string","array"]))throw new Tn(`Expected second argument to be of type array or string, but found ${Qi(xr(u))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(e);return u.indexOf(s,m)}return u.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var vd=Lr;class ip{constructor(e,s,u,m,y,x){this.inputType=e,this.type=s,this.input=u,this.cases=m,this.outputs=y,this.otherwise=x}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let u,m;s.expectedType&&"value"!==s.expectedType.kind&&(m=s.expectedType);const y={},x=[];for(let P=2;P<e.length-1;P+=2){let F=e[P];const z=e[P+1];Array.isArray(F)||(F=[F]);const U=s.concat(P);if(0===F.length)return U.error("Expected at least one branch label.");for(const G of F){if("number"!=typeof G&&"string"!=typeof G)return U.error("Branch labels must be numbers or strings.");if("number"==typeof G&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof G&&Math.floor(G)!==G)return U.error("Numeric branch labels must be integer values.");if(u){if(U.checkSubtype(u,xr(G)))return null}else u=xr(G);if(void 0!==y[String(G)])return U.error("Branch labels must be unique.");y[String(G)]=x.length}const H=s.parse(z,P,m);if(!H)return null;m=m||H.type,x.push(H)}const D=s.parse(e[1],1,ai);if(!D)return null;const S=s.parse(e[e.length-1],e.length-1,m);return S?"value"!==D.type.kind&&s.concat(1).checkSubtype(u,D.type)?null:new ip(u,m,D,y,x,S):null}evaluate(e){const s=this.input.evaluate(e);return(xr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],m={};for(const x of s){const D=m[this.cases[x]];void 0===D?(m[this.cases[x]]=u.length,u.push([this.cases[x],[x]])):u[D][1].push(x)}const y=x=>"number"===this.inputType.kind?Number(x):x;for(const[x,D]of u)e.push(1===D.length?y(D[0]):D.map(y)),e.push(this.outputs[x].serialize());return e.push(this.otherwise.serialize()),e}}var rp=ip;class bd{constructor(e,s,u){this.type=e,this.branches=s,this.otherwise=u}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&"value"!==s.expectedType.kind&&(u=s.expectedType);const m=[];for(let x=1;x<e.length-1;x+=2){const D=s.parse(e[x],x,ei);if(!D)return null;const S=s.parse(e[x+1],x+1,u);if(!S)return null;m.push([D,S]),u=u||S.type}const y=s.parse(e[e.length-1],e.length-1,u);return y?new bd(u,m,y):null}evaluate(e){for(const[s,u]of this.branches)if(s.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,u]of this.branches)e(s),e(u);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(s=>{e.push(s.serialize())}),e}}var xd=bd;class wd{constructor(e,s,u,m){this.type=e,this.input=s,this.beginIndex=u,this.endIndex=m}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=s.parse(e[1],1,ai),m=s.parse(e[2],2,Jt);if(!u||!m)return null;if(!st(u.type,[as(ai),Ln,ai]))return s.error(`Expected first argument to be of type array or string, but found ${Qi(u.type)} instead`);if(4===e.length){const y=s.parse(e[3],3,Jt);return y?new wd(u.type,u,m,y):null}return new wd(u.type,u,m)}evaluate(e){const s=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!Et(s,["string","array"]))throw new Tn(`Expected first argument to be of type array or string, but found ${Qi(xr(s))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(e);return s.slice(u,m)}return s.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var $m=wd;function yu(r,e){return"=="===r||"!="===r?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function zh(r,e,s,u){return 0===u.compare(e,s)}function xc(r,e,s){const u="=="!==r&&"!="!==r;return class SM{constructor(y,x,D){this.type=ei,this.lhs=y,this.rhs=x,this.collator=D,this.hasUntypedArgument="value"===y.type.kind||"value"===x.type.kind}static parse(y,x){if(3!==y.length&&4!==y.length)return x.error("Expected two or three arguments.");const D=y[0];let S=x.parse(y[1],1,ai);if(!S)return null;if(!yu(D,S.type))return x.concat(1).error(`"${D}" comparisons are not supported for type '${Qi(S.type)}'.`);let P=x.parse(y[2],2,ai);if(!P)return null;if(!yu(D,P.type))return x.concat(2).error(`"${D}" comparisons are not supported for type '${Qi(P.type)}'.`);if(S.type.kind!==P.type.kind&&"value"!==S.type.kind&&"value"!==P.type.kind)return x.error(`Cannot compare types '${Qi(S.type)}' and '${Qi(P.type)}'.`);u&&("value"===S.type.kind&&"value"!==P.type.kind?S=new Lo(P.type,[S]):"value"!==S.type.kind&&"value"===P.type.kind&&(P=new Lo(S.type,[P])));let F=null;if(4===y.length){if("string"!==S.type.kind&&"string"!==P.type.kind&&"value"!==S.type.kind&&"value"!==P.type.kind)return x.error("Cannot use collator to compare non-string types.");if(F=x.parse(y[3],3,so),!F)return null}return new SM(S,P,F)}evaluate(y){const x=this.lhs.evaluate(y),D=this.rhs.evaluate(y);if(u&&this.hasUntypedArgument){const S=xr(x),P=xr(D);if(S.kind!==P.kind||"string"!==S.kind&&"number"!==S.kind)throw new Tn(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${S.kind}, ${P.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const S=xr(x),P=xr(D);if("string"!==S.kind||"string"!==P.kind)return e(y,x,D)}return this.collator?s(y,x,D,this.collator.evaluate(y)):e(y,x,D)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[r];return this.eachChild(x=>{y.push(x.serialize())}),y}}}const Ed=xc("==",function(r,e,s){return e===s},zh),M_=xc("!=",function(r,e,s){return e!==s},function(r,e,s,u){return!zh(0,e,s,u)}),S_=xc("<",function(r,e,s){return e<s},function(r,e,s,u){return u.compare(e,s)<0}),Fv=xc(">",function(r,e,s){return e>s},function(r,e,s,u){return u.compare(e,s)>0}),I_=xc("<=",function(r,e,s){return e<=s},function(r,e,s,u){return u.compare(e,s)<=0}),op=xc(">=",function(r,e,s){return e>=s},function(r,e,s,u){return u.compare(e,s)>=0});class Vh{constructor(e,s,u,m,y,x){this.type=Ln,this.number=e,this.locale=s,this.currency=u,this.unit=m,this.minFractionDigits=y,this.maxFractionDigits=x}static parse(e,s){if(3!==e.length)return s.error("Expected two arguments.");const u=s.parse(e[1],1,Jt);if(!u)return null;const m=e[2];if("object"!=typeof m||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");let y=null;if(m.locale&&(y=s.parse(m.locale,1,Ln),!y))return null;let x=null;if(m.currency&&(x=s.parse(m.currency,1,Ln),!x))return null;let D=null;if(m.unit&&(D=s.parse(m.unit,1,Ln),!D))return null;let S=null;if(m["min-fraction-digits"]&&(S=s.parse(m["min-fraction-digits"],1,Jt),!S))return null;let P=null;return m["max-fraction-digits"]&&(P=s.parse(m["max-fraction-digits"],1,Jt),!P)?null:new Vh(u,y,x,D,S,P)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class vu{constructor(e){this.type=Jt,this.input=e}static parse(e,s){if(2!==e.length)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const u=s.parse(e[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?s.error(`Expected argument of type string or array, but found ${Qi(u.type)} instead.`):new vu(u):null}evaluate(e){const s=this.input.evaluate(e);if("string"==typeof s||Array.isArray(s))return s.length;throw new Tn(`Expected value to be of type string or array, but found ${Qi(xr(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(s=>{e.push(s.serialize())}),e}}const Uh={"==":Ed,"!=":M_,">":Fv,"<":S_,">=":op,"<=":I_,array:Lo,at:T_,boolean:Lo,case:xd,coalesce:np,collator:_r,format:Mr,image:dl,in:ml,"index-of":vd,interpolate:vo,"interpolate-hcl":vo,"interpolate-lab":vo,length:vu,let:Bh,literal:ln,match:rp,number:Lo,"number-format":Vh,object:Lo,slice:$m,step:Nm,string:Lo,"to-boolean":qs,"to-color":qs,"to-number":qs,"to-string":qs,var:pl,within:Vr};function sp(r,[e,s,u,m]){e=e.evaluate(r),s=s.evaluate(r),u=u.evaluate(r);const y=m?m.evaluate(r):1,x=Oh(e,s,u,y);if(x)throw new Tn(x);return new xn(e/255*y,s/255*y,u/255*y,y)}function gl(r,e){return r in e}function $l(r,e){const s=e[r];return void 0===s?null:s}function As(r){return{type:r}}Fo.register(Uh,{error:[{kind:"error"},[Ln],(r,[e])=>{throw new Tn(e.evaluate(r))}],typeof:[Ln,[ai],(r,[e])=>Qi(xr(e.evaluate(r)))],"to-rgba":[as(Jt,4),[Oo],(r,[e])=>e.evaluate(r).toArray()],rgb:[Oo,[Jt,Jt,Jt],sp],rgba:[Oo,[Jt,Jt,Jt,Jt],sp],has:{type:ei,overloads:[[[Ln],(r,[e])=>gl(e.evaluate(r),r.properties())],[[Ln,ss],(r,[e,s])=>gl(e.evaluate(r),s.evaluate(r))]]},get:{type:ai,overloads:[[[Ln],(r,[e])=>$l(e.evaluate(r),r.properties())],[[Ln,ss],(r,[e,s])=>$l(e.evaluate(r),s.evaluate(r))]]},"feature-state":[ai,[Ln],(r,[e])=>$l(e.evaluate(r),r.featureState||{})],properties:[ss,[],r=>r.properties()],"geometry-type":[Ln,[],r=>r.geometryType()],id:[ai,[],r=>r.id()],zoom:[Jt,[],r=>r.globals.zoom],pitch:[Jt,[],r=>r.globals.pitch||0],"distance-from-center":[Jt,[],r=>r.distanceFromCenter()],"heatmap-density":[Jt,[],r=>r.globals.heatmapDensity||0],"line-progress":[Jt,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[Jt,[],r=>r.globals.skyRadialProgress||0],accumulated:[ai,[],r=>void 0===r.globals.accumulated?null:r.globals.accumulated],"+":[Jt,As(Jt),(r,e)=>{let s=0;for(const u of e)s+=u.evaluate(r);return s}],"*":[Jt,As(Jt),(r,e)=>{let s=1;for(const u of e)s*=u.evaluate(r);return s}],"-":{type:Jt,overloads:[[[Jt,Jt],(r,[e,s])=>e.evaluate(r)-s.evaluate(r)],[[Jt],(r,[e])=>-e.evaluate(r)]]},"/":[Jt,[Jt,Jt],(r,[e,s])=>e.evaluate(r)/s.evaluate(r)],"%":[Jt,[Jt,Jt],(r,[e,s])=>e.evaluate(r)%s.evaluate(r)],ln2:[Jt,[],()=>Math.LN2],pi:[Jt,[],()=>Math.PI],e:[Jt,[],()=>Math.E],"^":[Jt,[Jt,Jt],(r,[e,s])=>Math.pow(e.evaluate(r),s.evaluate(r))],sqrt:[Jt,[Jt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Jt,[Jt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Jt,[Jt],(r,[e])=>Math.log(e.evaluate(r))],log2:[Jt,[Jt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Jt,[Jt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Jt,[Jt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Jt,[Jt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Jt,[Jt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Jt,[Jt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Jt,[Jt],(r,[e])=>Math.atan(e.evaluate(r))],min:[Jt,As(Jt),(r,e)=>Math.min(...e.map(s=>s.evaluate(r)))],max:[Jt,As(Jt),(r,e)=>Math.max(...e.map(s=>s.evaluate(r)))],abs:[Jt,[Jt],(r,[e])=>Math.abs(e.evaluate(r))],round:[Jt,[Jt],(r,[e])=>{const s=e.evaluate(r);return s<0?-Math.round(-s):Math.round(s)}],floor:[Jt,[Jt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Jt,[Jt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[ei,[Ln,ai],(r,[e,s])=>r.properties()[e.value]===s.value],"filter-id-==":[ei,[ai],(r,[e])=>r.id()===e.value],"filter-type-==":[ei,[Ln],(r,[e])=>r.geometryType()===e.value],"filter-<":[ei,[Ln,ai],(r,[e,s])=>{const u=r.properties()[e.value],m=s.value;return typeof u==typeof m&&u<m}],"filter-id-<":[ei,[ai],(r,[e])=>{const s=r.id(),u=e.value;return typeof s==typeof u&&s<u}],"filter->":[ei,[Ln,ai],(r,[e,s])=>{const u=r.properties()[e.value],m=s.value;return typeof u==typeof m&&u>m}],"filter-id->":[ei,[ai],(r,[e])=>{const s=r.id(),u=e.value;return typeof s==typeof u&&s>u}],"filter-<=":[ei,[Ln,ai],(r,[e,s])=>{const u=r.properties()[e.value],m=s.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[ei,[ai],(r,[e])=>{const s=r.id(),u=e.value;return typeof s==typeof u&&s<=u}],"filter->=":[ei,[Ln,ai],(r,[e,s])=>{const u=r.properties()[e.value],m=s.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[ei,[ai],(r,[e])=>{const s=r.id(),u=e.value;return typeof s==typeof u&&s>=u}],"filter-has":[ei,[ai],(r,[e])=>e.value in r.properties()],"filter-has-id":[ei,[],r=>null!==r.id()&&void 0!==r.id()],"filter-type-in":[ei,[as(Ln)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[ei,[as(ai)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[ei,[Ln,as(ai)],(r,[e,s])=>s.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[ei,[Ln,as(ai)],(r,[e,s])=>function(u,m,y,x){for(;y<=x;){const D=y+x>>1;if(m[D]===u)return!0;m[D]>u?x=D-1:y=D+1}return!1}(r.properties()[e.value],s.value,0,s.value.length-1)],all:{type:ei,overloads:[[[ei,ei],(r,[e,s])=>e.evaluate(r)&&s.evaluate(r)],[As(ei),(r,e)=>{for(const s of e)if(!s.evaluate(r))return!1;return!0}]]},any:{type:ei,overloads:[[[ei,ei],(r,[e,s])=>e.evaluate(r)||s.evaluate(r)],[As(ei),(r,e)=>{for(const s of e)if(s.evaluate(r))return!0;return!1}]]},"!":[ei,[ei],(r,[e])=>!e.evaluate(r)],"is-supported-script":[ei,[Ln],(r,[e])=>{const s=r.globals&&r.globals.isSupportedScript;return!s||s(e.evaluate(r))}],upcase:[Ln,[Ln],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Ln,[Ln],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Ln,As(ai),(r,e)=>e.map(s=>uu(s.evaluate(r))).join("")],"resolved-locale":[Ln,[so],(r,[e])=>e.evaluate(r).resolvedLocale()]});var wc=Uh;function Cd(r){return{result:"success",value:r}}function ls(r){return{result:"error",value:r}}function Ec(r){return"data-driven"===r["property-type"]}function bo(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function bu(r){return!!r.expression&&r.expression.interpolated}function vi(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":null===r?"null":typeof r}function Hi(r){return"object"==typeof r&&null!==r&&!Array.isArray(r)}function Cc(r){return r}function _l(r,e){const s="color"===e.type,u=r.stops&&"object"==typeof r.stops[0][0],m=u||!(u||void 0!==r.property),y=r.type||(bu(e)?"exponential":"interval");if(s&&((r=Ds({},r)).stops&&(r.stops=r.stops.map(P=>[P[0],xn.parse(P[1])])),r.default=xn.parse(r.default?r.default:e.default)),r.colorSpace&&"rgb"!==r.colorSpace&&!Na[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let x,D,S;if("exponential"===y)x=xo;else if("interval"===y)x=Dc;else if("categorical"===y){x=Dd,D=Object.create(null);for(const P of r.stops)D[P[0]]=P[1];S=typeof r.stops[0][0]}else{if("identity"!==y)throw new Error(`Unknown function type "${y}"`);x=wo}if(u){const P={},F=[];for(let H=0;H<r.stops.length;H++){const G=r.stops[H],K=G[0].zoom;void 0===P[K]&&(P[K]={zoom:K,type:r.type,property:r.property,default:r.default,stops:[]},F.push(K)),P[K].stops.push([G[0].value,G[1]])}const z=[];for(const H of F)z.push([P[H].zoom,_l(P[H],e)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:vo.interpolationFactor.bind(void 0,U),zoomStops:z.map(H=>H[0]),evaluate:({zoom:H},G)=>xo({stops:z,base:r.base},e,H).evaluate(H,G)}}if(m){const P="exponential"===y?{name:"exponential",base:void 0!==r.base?r.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:vo.interpolationFactor.bind(void 0,P),zoomStops:r.stops.map(F=>F[0]),evaluate:({zoom:F})=>x(r,e,F,D,S)}}return{kind:"source",evaluate(P,F){const z=F&&F.properties?F.properties[r.property]:void 0;return void 0===z?Ur(r.default,e.default):x(r,e,z,D,S)}}}function Ur(r,e,s){return void 0!==r?r:void 0!==e?e:void 0!==s?s:void 0}function Dd(r,e,s,u,m){return Ur(typeof s===m?u[s]:void 0,r.default,e.default)}function Dc(r,e,s){if("number"!==vi(s))return Ur(r.default,e.default);const u=r.stops.length;if(1===u||s<=r.stops[0][0])return r.stops[0][1];if(s>=r.stops[u-1][0])return r.stops[u-1][1];const m=md(r.stops.map(y=>y[0]),s);return r.stops[m][1]}function xo(r,e,s){const u=void 0!==r.base?r.base:1;if("number"!==vi(s))return Ur(r.default,e.default);const m=r.stops.length;if(1===m||s<=r.stops[0][0])return r.stops[0][1];if(s>=r.stops[m-1][0])return r.stops[m-1][1];const y=md(r.stops.map(F=>F[0]),s),x=function(F,z,U,H){const G=H-U,K=F-U;return 0===G?0:1===z?K/G:(Math.pow(z,K)-1)/(Math.pow(z,G)-1)}(s,u,r.stops[y][0],r.stops[y+1][0]),D=r.stops[y][1],S=r.stops[y+1][1];let P=mu[e.type]||Cc;if(r.colorSpace&&"rgb"!==r.colorSpace){const F=Na[r.colorSpace];P=(z,U)=>F.reverse(F.interpolate(F.forward(z),F.forward(U),x))}return"function"==typeof D.evaluate?{evaluate(...F){const z=D.evaluate.apply(void 0,F),U=S.evaluate.apply(void 0,F);if(void 0!==z&&void 0!==U)return P(z,U,x)}}:P(D,S,x)}function wo(r,e,s){return"color"===e.type?s=xn.parse(s):"formatted"===e.type?s=qi.fromString(s.toString()):"resolvedImage"===e.type?s=yo.fromString(s.toString()):vi(s)===e.type||"enum"===e.type&&e.values[s]||(s=void 0),Ur(s,r.default,e.default)}class xu{constructor(e,s){var u;this.expression=e,this._warningHistory={},this._evaluator=new Vl,this._defaultValue=s?"color"===(u=s).type&&(Hi(u.default)||Array.isArray(u.default))?new xn(0,0,0,0):"color"===u.type?xn.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(e,s,u,m,y,x,D,S){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=m||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=D||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(e,s,u,m,y,x,D,S){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=D||null,this._evaluator.featureDistanceData=S||null;try{const P=this.expression.evaluate(this._evaluator);if(null==P||"number"==typeof P&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new Tn(`Expected value to be one of ${Object.keys(this._enumValues).map(F=>JSON.stringify(F)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(P.message)),this._defaultValue}}}function Tc(r){return Array.isArray(r)&&r.length>0&&"string"==typeof r[0]&&r[0]in wc}function Mc(r,e){const s=new Ss(wc,[],e?function(m){const y={color:Oo,string:Ln,number:Jt,enum:Ln,boolean:ei,formatted:cl,resolvedImage:la};return"array"===m.type?as(y[m.value]||ai,m.length):y[m.type]}(e):void 0),u=s.parse(r,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return u?Cd(new xu(u,e)):ls(s.errors)}class da{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent="constant"!==e&&!Or(s.expression)}evaluateWithoutErrorHandling(e,s,u,m,y,x){return this._styleExpression.evaluateWithoutErrorHandling(e,s,u,m,y,x)}evaluate(e,s,u,m,y,x){return this._styleExpression.evaluate(e,s,u,m,y,x)}}class Sc{constructor(e,s,u,m){this.kind=e,this.zoomStops=u,this._styleExpression=s,this.isStateDependent="camera"!==e&&!Or(s.expression),this.interpolationType=m}evaluateWithoutErrorHandling(e,s,u,m,y,x){return this._styleExpression.evaluateWithoutErrorHandling(e,s,u,m,y,x)}evaluate(e,s,u,m,y,x){return this._styleExpression.evaluate(e,s,u,m,y,x)}interpolationFactor(e,s,u){return this.interpolationType?vo.interpolationFactor(this.interpolationType,e,s,u):0}}function wu(r,e){if("error"===(r=Mc(r,e)).result)return r;const s=r.value.expression,u=pd(s);if(!u&&!Ec(e))return ls([new Ro("","data expressions not supported")]);const m=kr(s,["zoom","pitch","distance-from-center"]);if(!m&&!bo(e))return ls([new Ro("","zoom expressions not supported")]);const y=Ic(s);return y||m?y instanceof Ro?ls([y]):y instanceof vo&&!bu(e)?ls([new Ro("",'"interpolate" expressions cannot be used with this property')]):Cd(y?new Sc(u?"camera":"composite",r.value,y.labels,y instanceof vo?y.interpolation:void 0):new da(u?"constant":"source",r.value)):ls([new Ro("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Eu{constructor(e,s){this._parameters=e,this._specification=s,Ds(this,_l(this._parameters,this._specification))}static deserialize(e){return new Eu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ic(r){let e=null;if(r instanceof Bh)e=Ic(r.result);else if(r instanceof np){for(const s of r.args)if(e=Ic(s),e)break}else(r instanceof Nm||r instanceof vo)&&r.input instanceof Fo&&"zoom"===r.input.name&&(e=r);return e instanceof Ro||r.eachChild(s=>{const u=Ic(s);u instanceof Ro?e=u:!e&&u?e=new Ro("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&u&&e!==u&&(e=new Ro("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class tn{constructor(e,s,u,m){this.message=(e?`${e}: `:"")+u,m&&(this.identifier=m),null!=s&&s.__line__&&(this.line=s.__line__)}}function cs(r){const e=r.key,s=r.value,u=r.valueSpec||{},m=r.objectElementValidators||{},y=r.style,x=r.styleSpec;let D=[];const S=vi(s);if("object"!==S)return[new tn(e,s,`object expected, ${S} found`)];for(const P in s){const F=P.split(".")[0];let z;m[F]?z=m[F]:u[F]?z=no:m["*"]?z=m["*"]:u["*"]&&(z=no),z?D=D.concat(z({key:(e&&`${e}.`)+P,value:s[P],valueSpec:u[F]||u["*"],style:y,styleSpec:x,object:s,objectKey:P},s)):D.push(new tn(e,s[P],`unknown property "${P}"`))}for(const P in u)m[P]||u[P].required&&void 0===u[P].default&&void 0===s[P]&&D.push(new tn(e,s,`missing required property "${P}"`));return D}function Xn(r){const e=r.value,s=r.valueSpec,u=r.style,m=r.styleSpec,y=r.key,x=r.arrayElementValidator||no;if("array"!==vi(e))return[new tn(y,e,`array expected, ${vi(e)} found`)];if(s.length&&e.length!==s.length)return[new tn(y,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new tn(y,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let D={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};m.$version<7&&(D.function=s.function),"object"===vi(s.value)&&(D=s.value);let S=[];for(let P=0;P<e.length;P++)S=S.concat(x({array:e,arrayIndex:P,value:e[P],valueSpec:D,style:u,styleSpec:m,key:`${y}[${P}]`}));return S}function Cu(r){const e=r.key,s=r.value,u=r.valueSpec;let m=vi(s);if("number"===m&&s!=s&&(m="NaN"),"number"!==m)return[new tn(e,s,`number expected, ${m} found`)];if("minimum"in u){let y=u.minimum;if("array"===vi(u.minimum)&&(y=u.minimum[r.arrayIndex]),s<y)return[new tn(e,s,`${s} is less than the minimum value ${y}`)]}if("maximum"in u){let y=u.maximum;if("array"===vi(u.maximum)&&(y=u.maximum[r.arrayIndex]),s>y)return[new tn(e,s,`${s} is greater than the maximum value ${y}`)]}return[]}function Du(r){const e=r.valueSpec,s=Ji(r.value.type);let u,m,y,x={};const D="categorical"!==s&&void 0===r.value.property,S=!D,P="array"===vi(r.value.stops)&&"array"===vi(r.value.stops[0])&&"object"===vi(r.value.stops[0][0]),F=cs({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(H){if("identity"===s)return[new tn(H.key,H.value,'identity function may not have a "stops" property')];let G=[];const K=H.value;return G=G.concat(Xn({key:H.key,value:K,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:z})),"array"===vi(K)&&0===K.length&&G.push(new tn(H.key,K,"array must have at least one stop")),G},default:function(H){return no({key:H.key,value:H.value,valueSpec:e,style:H.style,styleSpec:H.styleSpec})}}});return"identity"===s&&D&&F.push(new tn(r.key,r.value,'missing required property "property"')),"identity"===s||r.value.stops||F.push(new tn(r.key,r.value,'missing required property "stops"')),"exponential"===s&&r.valueSpec.expression&&!bu(r.valueSpec)&&F.push(new tn(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(S&&!Ec(r.valueSpec)?F.push(new tn(r.key,r.value,"property functions not supported")):D&&!bo(r.valueSpec)&&F.push(new tn(r.key,r.value,"zoom functions not supported"))),"categorical"!==s&&!P||void 0!==r.value.property||F.push(new tn(r.key,r.value,'"property" property is required')),F;function z(H){let G=[];const K=H.value,re=H.key;if("array"!==vi(K))return[new tn(re,K,`array expected, ${vi(K)} found`)];if(2!==K.length)return[new tn(re,K,`array length 2 expected, length ${K.length} found`)];if(P){if("object"!==vi(K[0]))return[new tn(re,K,`object expected, ${vi(K[0])} found`)];if(void 0===K[0].zoom)return[new tn(re,K,"object stop key must have zoom")];if(void 0===K[0].value)return[new tn(re,K,"object stop key must have value")];const he=Ji(K[0].zoom);if("number"!=typeof he)return[new tn(re,K[0].zoom,"stop zoom values must be numbers")];if(y&&y>he)return[new tn(re,K[0].zoom,"stop zoom values must appear in ascending order")];he!==y&&(y=he,m=void 0,x={}),G=G.concat(cs({key:`${re}[0]`,value:K[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:Cu,value:U}}))}else G=G.concat(U({key:`${re}[0]`,value:K[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},K));return Tc(mr(K[1]))?G.concat([new tn(`${re}[1]`,K[1],"expressions are not allowed in function stops.")]):G.concat(no({key:`${re}[1]`,value:K[1],valueSpec:e,style:H.style,styleSpec:H.styleSpec}))}function U(H,G){const K=vi(H.value),re=Ji(H.value),he=null!==H.value?H.value:G;if(u){if(K!==u)return[new tn(H.key,he,`${K} stop domain type must match previous stop domain type ${u}`)]}else u=K;if("number"!==K&&"string"!==K&&"boolean"!==K&&"number"!=typeof re&&"string"!=typeof re&&"boolean"!=typeof re)return[new tn(H.key,he,"stop domain value must be a number, string, or boolean")];if("number"!==K&&"categorical"!==s){let be=`number expected, ${K} found`;return Ec(e)&&void 0===s&&(be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new tn(H.key,he,be)]}return"categorical"!==s||"number"!==K||"number"==typeof re&&isFinite(re)&&Math.floor(re)===re?"categorical"!==s&&"number"===K&&"number"==typeof re&&"number"==typeof m&&void 0!==m&&re<m?[new tn(H.key,he,"stop domain values must appear in ascending order")]:(m=re,"categorical"===s&&re in x?[new tn(H.key,he,"stop domain values must be unique")]:(x[re]=!0,[])):[new tn(H.key,he,`integer expected, found ${String(re)}`)]}}function eo(r){const e=("property"===r.expressionContext?wu:Mc)(mr(r.value),r.valueSpec);if("error"===e.result)return e.value.map(u=>new tn(`${r.key}${u.key}`,r.value,u.message));const s=e.value.expression||e.value._styleExpression.expression;if("property"===r.expressionContext&&"text-font"===r.propertyKey&&!s.outputDefined())return[new tn(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===r.expressionContext&&"layout"===r.propertyType&&!Or(s))return[new tn(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===r.expressionContext)return Hl(s,r);if(r.expressionContext&&0===r.expressionContext.indexOf("cluster")){if(!kr(s,["zoom","feature-state"]))return[new tn(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===r.expressionContext&&!pd(s))return[new tn(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hl(r,e){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const m of e.valueSpec.expression.parameters)s.delete(m);if(0===s.size)return[];const u=[];return r instanceof Fo&&s.has(r.name)?[new tn(e.key,e.value,`["${r.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(r.eachChild(m=>{u.push(...Hl(m,e))}),u)}function Tu(r){const e=r.key,s=r.value,u=r.valueSpec,m=[];return Array.isArray(u.values)?-1===u.values.indexOf(Ji(s))&&m.push(new tn(e,s,`expected one of [${u.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(u.values).indexOf(Ji(s))&&m.push(new tn(e,s,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function Td(r){if(!0===r||!1===r)return!0;if(!Array.isArray(r)||0===r.length)return!1;switch(r[0]){case"has":return r.length>=2&&"$id"!==r[1]&&"$type"!==r[1];case"in":return r.length>=3&&("string"!=typeof r[1]||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==r.length||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Td(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function ha(r,e="fill"){if(null==r)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Td(r)||(r=yi(r));const s=r;let u=!0;try{u=function(P){if(!Ac(P))return P;let F=mr(P);return Md(F),F=ap(F),F}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const m=lt[`filter_${e}`],y=Mc(u,m);let x=null;if("error"===y.result)throw new Error(y.value.map(P=>`${P.key}: ${P.message}`).join(", "));x=(P,F,z)=>y.value.evaluate(P,F,{},z);let D=null,S=null;if(u!==s){const P=Mc(s,m);if("error"===P.result)throw new Error(P.value.map(F=>`${F.key}: ${F.message}`).join(", "));D=(F,z,U,H,G)=>P.value.evaluate(F,z,{},U,void 0,void 0,H,G),S=!pd(P.value.expression)}return{filter:x,dynamicFilter:D||void 0,needGeometry:Nt(u),needFeature:!!S}}function ap(r){if(!Array.isArray(r))return r;const e=function(s){if(lp.has(s[0]))for(let u=1;u<s.length;u++)if(Ac(s[u]))return!0;return s}(r);return!0===e?e:e.map(s=>ap(s))}function Md(r){let e=!1;const s=[];if("case"===r[0]){for(let u=1;u<r.length-1;u+=2)e=e||Ac(r[u]),s.push(r[u+1]);s.push(r[r.length-1])}else if("match"===r[0]){e=e||Ac(r[1]);for(let u=2;u<r.length-1;u+=2)s.push(r[u+1]);s.push(r[r.length-1])}else if("step"===r[0]){e=e||Ac(r[1]);for(let u=1;u<r.length-1;u+=2)s.push(r[u+1])}e&&(r.length=0,r.push("any",...s));for(let u=1;u<r.length;u++)Md(r[u])}function Ac(r){if(!Array.isArray(r))return!1;if("pitch"===(e=r[0])||"distance-from-center"===e)return!0;var e;for(let s=1;s<r.length;s++)if(Ac(r[s]))return!0;return!1}const lp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function A_(r,e){return r<e?-1:r>e?1:0}function Nt(r){if(!Array.isArray(r))return!1;if("within"===r[0])return!0;for(let e=1;e<r.length;e++)if(Nt(r[e]))return!0;return!1}function yi(r){if(!r)return!0;const e=r[0];return r.length<=1?"any"!==e:"=="===e?Sd(r[1],r[2],"=="):"!="===e?Pc(Sd(r[1],r[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Sd(r[1],r[2],e):"any"===e?(s=r.slice(1),["any"].concat(s.map(yi))):"all"===e?["all"].concat(r.slice(1).map(yi)):"none"===e?["all"].concat(r.slice(1).map(yi).map(Pc)):"in"===e?Id(r[1],r.slice(2)):"!in"===e?Pc(Id(r[1],r.slice(2))):"has"===e?Zr(r[1]):"!has"===e?Pc(Zr(r[1])):"within"!==e||r;var s}function Sd(r,e,s){switch(r){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,r,e]}}function Id(r,e){if(0===e.length)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",r,["literal",e.sort(A_)]]:["filter-in-small",r,["literal",e]]}}function Zr(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Pc(r){return["!",r]}function Ba(r){return Td(mr(r.value))?eo(Ds({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${r.layerType||"fill"}`]})):Ko(r)}function Ko(r){const e=r.value,s=r.key;if("array"!==vi(e))return[new tn(s,e,`array expected, ${vi(e)} found`)];const u=r.styleSpec;let m,y=[];if(e.length<1)return[new tn(s,e,"filter array must have at least 1 element")];switch(y=y.concat(Tu({key:`${s}[0]`,value:e[0],valueSpec:u.filter_operator,style:r.style,styleSpec:r.styleSpec})),Ji(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Ji(e[1])&&y.push(new tn(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&y.push(new tn(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(m=vi(e[1]),"string"!==m&&y.push(new tn(`${s}[1]`,e[1],`string expected, ${m} found`)));for(let x=2;x<e.length;x++)m=vi(e[x]),"$type"===Ji(e[1])?y=y.concat(Tu({key:`${s}[${x}]`,value:e[x],valueSpec:u.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==m&&"number"!==m&&"boolean"!==m&&y.push(new tn(`${s}[${x}]`,e[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<e.length;x++)y=y.concat(Ko({key:`${s}[${x}]`,value:e[x],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":m=vi(e[1]),2!==e.length?y.push(new tn(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==m&&y.push(new tn(`${s}[1]`,e[1],`string expected, ${m} found`));break;case"within":m=vi(e[1]),2!==e.length?y.push(new tn(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==m&&y.push(new tn(`${s}[1]`,e[1],`object expected, ${m} found`))}return y}function Rc(r,e){const s=r.key,u=r.style,m=r.styleSpec,y=r.value,x=r.objectKey,D=m[`${e}_${r.layerType}`];if(!D)return[];const S=x.match(/^(.*)-transition$/);if("paint"===e&&S&&D[S[1]]&&D[S[1]].transition)return no({key:s,value:y,valueSpec:m.transition,style:u,styleSpec:m});const P=r.valueSpec||D[x];if(!P)return[new tn(s,y,`unknown property "${x}"`)];let F;if("string"===vi(y)&&Ec(P)&&!P.tokens&&(F=/^{([^}]+)}$/.exec(y))){const U=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new tn(s,y,`"${x}" does not support interpolation syntax\nUse an identity property function instead: ${U}.`)]}const z=[];return"symbol"===r.layerType&&("text-field"===x&&u&&!u.glyphs&&z.push(new tn(s,y,'use of "text-field" requires a style "glyphs" property')),"text-font"===x&&Hi(mr(y))&&"identity"===Ji(y.type)&&z.push(new tn(s,y,'"text-font" does not support identity functions'))),z.concat(no({key:r.key,value:y,valueSpec:P,style:u,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:x}))}function Mu(r){return Rc(r,"paint")}function Ad(r){return Rc(r,"layout")}function P_(r){let e=[];const s=r.value,u=r.key,m=r.style,y=r.styleSpec;s.type||s.ref||e.push(new tn(u,s,'either "type" or "ref" is required'));let x=Ji(s.type);const D=Ji(s.ref);if(s.id){const S=Ji(s.id);for(let P=0;P<r.arrayIndex;P++){const F=m.layers[P];Ji(F.id)===S&&e.push(new tn(u,s.id,`duplicate layer id "${s.id}", previously used at line ${F.id.__line__}`))}}if("ref"in s){let S;["type","source","source-layer","filter","layout"].forEach(P=>{P in s&&e.push(new tn(u,s[P],`"${P}" is prohibited for ref layers`))}),m.layers.forEach(P=>{Ji(P.id)===D&&(S=P)}),S?S.ref?e.push(new tn(u,s.ref,"ref cannot reference another ref layer")):x=Ji(S.type):"string"==typeof D&&e.push(new tn(u,s.ref,`ref layer "${D}" not found`))}else if("background"!==x&&"sky"!==x)if(s.source){const S=m.sources&&m.sources[s.source],P=S&&Ji(S.type);S?"vector"===P&&"raster"===x?e.push(new tn(u,s.source,`layer "${s.id}" requires a raster source`)):"raster"===P&&"raster"!==x?e.push(new tn(u,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==P||s["source-layer"]?"raster-dem"===P&&"hillshade"!==x?e.push(new tn(u,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==x||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||"geojson"===P&&S.lineMetrics||e.push(new tn(u,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new tn(u,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new tn(u,s.source,`source "${s.source}" not found`))}else e.push(new tn(u,s,'missing required property "source"'));return e=e.concat(cs({key:u,value:s,valueSpec:y.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>no({key:`${u}.type`,value:s.type,valueSpec:y.layer.type,style:r.style,styleSpec:r.styleSpec,object:s,objectKey:"type"}),filter:S=>Ba(Ds({layerType:x},S)),layout:S=>cs({layer:s,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":P=>Ad(Ds({layerType:x},P))}}),paint:S=>cs({layer:s,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":P=>Mu(Ds({layerType:x},P))}})}})),e}function za(r){const e=r.value,s=r.key,u=vi(e);return"string"!==u?[new tn(s,e,`string expected, ${u} found`)]:[]}const zo={promoteId:function({key:r,value:e}){if("string"===vi(e))return za({key:r,value:e});{const s=[];for(const u in e)s.push(...za({key:`${r}.${u}`,value:e[u]}));return s}}};function fa(r){const e=r.value,s=r.key,u=r.styleSpec,m=r.style;if(!e.type)return[new tn(s,e,'"type" is required')];const y=Ji(e.type);let x;switch(y){case"vector":case"raster":case"raster-dem":return x=cs({key:s,value:e,valueSpec:u[`source_${y.replace("-","_")}`],style:r.style,styleSpec:u,objectElementValidators:zo}),x;case"geojson":if(x=cs({key:s,value:e,valueSpec:u.source_geojson,style:m,styleSpec:u,objectElementValidators:zo}),e.cluster)for(const D in e.clusterProperties){const[S,P]=e.clusterProperties[D],F="string"==typeof S?[S,["accumulated"],["get",D]]:S;x.push(...eo({key:`${s}.${D}.map`,value:P,expressionContext:"cluster-map"})),x.push(...eo({key:`${s}.${D}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return x;case"video":return cs({key:s,value:e,valueSpec:u.source_video,style:m,styleSpec:u});case"image":return cs({key:s,value:e,valueSpec:u.source_image,style:m,styleSpec:u});case"canvas":return[new tn(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Tu({key:`${s}.type`,value:e.type,valueSpec:{values:jh(u)},style:m,styleSpec:u})}}function jh(r){return r.source.reduce((e,s)=>{const u=r[s];return"enum"===u.type.type&&(e=e.concat(Object.keys(u.type.values))),e},[])}function yl(r){const e=r.value,s=r.styleSpec,u=s.light,m=r.style;let y=[];const x=vi(e);if(void 0===e)return y;if("object"!==x)return y=y.concat([new tn("light",e,`object expected, ${x} found`)]),y;for(const D in e){const S=D.match(/^(.*)-transition$/);y=y.concat(S&&u[S[1]]&&u[S[1]].transition?no({key:D,value:e[D],valueSpec:s.transition,style:m,styleSpec:s}):u[D]?no({key:D,value:e[D],valueSpec:u[D],style:m,styleSpec:s}):[new tn(D,e[D],`unknown property "${D}"`)])}return y}function to(r){const e=r.value,s=r.key,u=r.style,m=r.styleSpec,y=m.terrain;let x=[];const D=vi(e);if(void 0===e)return x;if("object"!==D)return x=x.concat([new tn("terrain",e,`object expected, ${D} found`)]),x;for(const S in e){const P=S.match(/^(.*)-transition$/);x=x.concat(P&&y[P[1]]&&y[P[1]].transition?no({key:S,value:e[S],valueSpec:m.transition,style:u,styleSpec:m}):y[S]?no({key:S,value:e[S],valueSpec:y[S],style:u,styleSpec:m}):[new tn(S,e[S],`unknown property "${S}"`)])}if(e.source){const S=u.sources&&u.sources[e.source],P=S&&Ji(S.type);S?"raster-dem"!==P&&x.push(new tn(s,e.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):x.push(new tn(s,e.source,`source "${e.source}" not found`))}else x.push(new tn(s,e,'terrain is missing required property "source"'));return x}function cp(r){const e=r.value,s=r.style,u=r.styleSpec,m=u.fog;let y=[];const x=vi(e);if(void 0===e)return y;if("object"!==x)return y=y.concat([new tn("fog",e,`object expected, ${x} found`)]),y;for(const D in e){const S=D.match(/^(.*)-transition$/);y=y.concat(S&&m[S[1]]&&m[S[1]].transition?no({key:D,value:e[D],valueSpec:u.transition,style:s,styleSpec:u}):m[D]?no({key:D,value:e[D],valueSpec:m[D],style:s,styleSpec:u}):[new tn(D,e[D],`unknown property "${D}"`)])}return y}const $h={"*":()=>[],array:Xn,boolean:function(r){const e=r.value,s=r.key,u=vi(e);return"boolean"!==u?[new tn(s,e,`boolean expected, ${u} found`)]:[]},number:Cu,color:function(r){const e=r.key,s=r.value,u=vi(s);return"string"!==u?[new tn(e,s,`color expected, ${u} found`)]:null===qe(s)?[new tn(e,s,`color expected, "${s}" found`)]:[]},enum:Tu,filter:Ba,function:Du,layer:P_,object:cs,source:fa,light:yl,terrain:to,fog:cp,string:za,formatted:function(r){return 0===za(r).length?[]:eo(r)},resolvedImage:function(r){return 0===za(r).length?[]:eo(r)},projection:function(r){const e=r.value,s=r.styleSpec,u=s.projection,m=r.style;let y=[];const x=vi(e);if("object"===x)for(const D in e)y=y.concat(no({key:D,value:e[D],valueSpec:u[D],style:m,styleSpec:s}));else"string"!==x&&(y=y.concat([new tn("projection",e,`object or string expected, ${x} found`)]));return y}};function no(r){const e=r.value,s=r.valueSpec,u=r.styleSpec;return s.expression&&Hi(Ji(e))?Du(r):s.expression&&Tc(mr(e))?eo(r):s.type&&$h[s.type]?$h[s.type](r):cs(Ds({},r,{valueSpec:s.type?u[s.type]:s}))}function up(r){const e=r.value,s=r.key,u=za(r);return u.length||(-1===e.indexOf("{fontstack}")&&u.push(new tn(s,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&u.push(new tn(s,e,'"glyphs" url must include a "{range}" token'))),u}function Hh(r,e=lt){return Jo(no({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:up,"*":()=>[]}}))}const dp=r=>Jo(Mu(r)),Hm=r=>Jo(Ad(r));function Jo(r){return r.slice().sort((e,s)=>e.line&&s.line?e.line-s.line:0)}function Gm(r,e){let s=!1;if(e&&e.length)for(const u of e)r.fire(new qo(new Error(u.message))),s=!0;return s}var Wm=pa,Ps=3;function pa(r,e,s){var u=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var m=new Int32Array(this.arrayBuffer);r=m[0],this.d=(e=m[1])+2*(s=m[2]);for(var y=0;y<this.d*this.d;y++){var x=m[Ps+y],D=m[Ps+y+1];u.push(x===D?null:m.subarray(x,D))}var S=m[Ps+u.length+1];this.keys=m.subarray(m[Ps+u.length],S),this.bboxes=m.subarray(S),this.insert=this._insertReadonly}else{this.d=e+2*s;for(var P=0;P<this.d*this.d;P++)u.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=r,this.padding=s,this.scale=e/r,this.uid=0;var F=s/e*r;this.min=-F,this.max=r+F}pa.prototype.insert=function(r,e,s,u,m){this._forEachCell(e,s,u,m,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(e),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(m)},pa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},pa.prototype._insertCell=function(r,e,s,u,m,y){this.cells[m].push(y)},pa.prototype.query=function(r,e,s,u,m){var y=this.min,x=this.max;if(r<=y&&e<=y&&x<=s&&x<=u&&!m)return Array.prototype.slice.call(this.keys);var D=[];return this._forEachCell(r,e,s,u,this._queryCell,D,{},m),D},pa.prototype._queryCell=function(r,e,s,u,m,y,x,D){var S=this.cells[m];if(null!==S)for(var P=this.keys,F=this.bboxes,z=0;z<S.length;z++){var U=S[z];if(void 0===x[U]){var H=4*U;(D?D(F[H+0],F[H+1],F[H+2],F[H+3]):r<=F[H+2]&&e<=F[H+3]&&s>=F[H+0]&&u>=F[H+1])?(x[U]=!0,y.push(P[U])):x[U]=!1}}},pa.prototype._forEachCell=function(r,e,s,u,m,y,x,D){for(var S=this._convertToCellCoord(r),P=this._convertToCellCoord(e),F=this._convertToCellCoord(s),z=this._convertToCellCoord(u),U=S;U<=F;U++)for(var H=P;H<=z;H++){var G=this.d*H+U;if((!D||D(this._convertFromCellCoord(U),this._convertFromCellCoord(H),this._convertFromCellCoord(U+1),this._convertFromCellCoord(H+1)))&&m.call(this,r,e,s,u,G,y,x,D))return}},pa.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},pa.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},pa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,e=Ps+this.cells.length+1+1,s=0,u=0;u<this.cells.length;u++)s+=this.cells[u].length;var m=new Int32Array(e+s+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var y=e,x=0;x<r.length;x++){var D=r[x];m[Ps+x]=y,m.set(D,y),y+=D.length}return m[Ps+r.length]=y,m.set(this.keys,y),m[Ps+r.length+1]=y+=this.keys.length,m.set(this.bboxes,y),y+=this.bboxes.length,m.buffer};var Gl=Pt(Wm);const Pd={};function dn(r,e,s={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writeable:!1}),Pd[e]={klass:r,omit:s.omit||[]}}dn(Object,"Object"),Gl.serialize=function(r,e){const s=r.toArrayBuffer();return e&&e.push(s),{buffer:s}},Gl.deserialize=function(r){return new Gl(r.buffer)},Object.defineProperty(Gl,"name",{value:"Grid"}),dn(Gl,"Grid"),dn(xn,"Color"),dn(Error,"Error"),dn(os,"AJAXError"),dn(yo,"ResolvedImage"),dn(Eu,"StylePropertyFunction"),dn(xu,"StyleExpression",{omit:["_evaluator"]}),dn(Sc,"ZoomDependentExpression"),dn(da,"ZoomConstantExpression"),dn(Fo,"CompoundExpression",{omit:["_evaluate"]});for(const r in wc)Pd[wc[r]._classRegistryKey]||dn(wc[r],`Expression${r}`);function Rd(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&"ArrayBuffer"===r.constructor.name)}function Gh(r){return ue.ImageBitmap&&r instanceof ue.ImageBitmap}function Wl(r,e){if(null==r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Rd(r)||Gh(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const s=r;return e&&e.push(s.buffer),s}if(r instanceof ue.ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const s=[];for(const u of r)s.push(Wl(u,e));return s}if("object"==typeof r){const s=r.constructor,u=s._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const m=s.serialize?s.serialize(r,e):{};if(!s.serialize){for(const y in r)r.hasOwnProperty(y)&&(Pd[u].omit.indexOf(y)>=0||(m[y]=Wl(r[y],e)));r instanceof Error&&(m.message=r.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(m.$name=u),m}throw new Error("can't serialize object of type "+typeof r)}function jr(r){if(null==r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Rd(r)||Gh(r)||ArrayBuffer.isView(r)||r instanceof ue.ImageData)return r;if(Array.isArray(r))return r.map(jr);if("object"==typeof r){const e=r.$name||"Object",{klass:s}=Pd[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(r);const u=Object.create(s.prototype);for(const m of Object.keys(r))"$name"!==m&&(u[m]=jr(r[m]));return u}throw new Error("can't deserialize object of type "+typeof r)}const Xt={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function yr(r){for(const e of r)if(hp(e.charCodeAt(0)))return!0;return!1}function R_(r){for(const e of r)if(!Zm(e.charCodeAt(0)))return!1;return!0}function Zm(r){return!(Xt.Arabic(r)||Xt["Arabic Supplement"](r)||Xt["Arabic Extended-A"](r)||Xt["Arabic Presentation Forms-A"](r)||Xt["Arabic Presentation Forms-B"](r))}function hp(r){return!(746!==r&&747!==r&&(r<4352||!(Xt["Bopomofo Extended"](r)||Xt.Bopomofo(r)||Xt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Xt["CJK Compatibility Ideographs"](r)||Xt["CJK Compatibility"](r)||Xt["CJK Radicals Supplement"](r)||Xt["CJK Strokes"](r)||!(!Xt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||12336===r)||Xt["CJK Unified Ideographs Extension A"](r)||Xt["CJK Unified Ideographs"](r)||Xt["Enclosed CJK Letters and Months"](r)||Xt["Hangul Compatibility Jamo"](r)||Xt["Hangul Jamo Extended-A"](r)||Xt["Hangul Jamo Extended-B"](r)||Xt["Hangul Jamo"](r)||Xt["Hangul Syllables"](r)||Xt.Hiragana(r)||Xt["Ideographic Description Characters"](r)||Xt.Kanbun(r)||Xt["Kangxi Radicals"](r)||Xt["Katakana Phonetic Extensions"](r)||Xt.Katakana(r)&&12540!==r||!(!Xt["Halfwidth and Fullwidth Forms"](r)||65288===r||65289===r||65293===r||r>=65306&&r<=65310||65339===r||65341===r||65343===r||r>=65371&&r<=65503||65507===r||r>=65512&&r<=65519)||!(!Xt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Xt["Unified Canadian Aboriginal Syllabics"](r)||Xt["Unified Canadian Aboriginal Syllabics Extended"](r)||Xt["Vertical Forms"](r)||Xt["Yijing Hexagram Symbols"](r)||Xt["Yi Syllables"](r)||Xt["Yi Radicals"](r))))}function qm(r){return!(hp(r)||(e=r,Xt["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Xt["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Xt["Letterlike Symbols"](e)||Xt["Number Forms"](e)||Xt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Xt["Control Pictures"](e)&&9251!==e||Xt["Optical Character Recognition"](e)||Xt["Enclosed Alphanumerics"](e)||Xt["Geometric Shapes"](e)||Xt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Xt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Xt["CJK Symbols and Punctuation"](e)||Xt.Katakana(e)||Xt["Private Use Area"](e)||Xt["CJK Compatibility Forms"](e)||Xt["Small Form Variants"](e)||Xt["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function Vo(r){return r>=1424&&r<=2303||Xt["Arabic Presentation Forms-A"](r)||Xt["Arabic Presentation Forms-B"](r)}function us(r,e){return!(!e&&Vo(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Xt.Khmer(r))}function Od(r){for(const e of r)if(Vo(e.charCodeAt(0)))return!0;return!1}const ar="deferred",Fn="loading",Eo="loaded";let Va=null,_="unavailable",a=null;const f=function(r){r&&"string"==typeof r&&r.indexOf("NetworkError")>-1&&(_="error"),Va&&Va(r)};function v(){C.fire(new Po("pluginStateChange",{pluginStatus:_,pluginURL:a}))}const C=new ka,M=function(){return _},O=function(){if(_!==ar||!a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_=Fn,v(),a&&bi({url:a},r=>{r?f(r):(_=Eo,v())})},k={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_===Eo||null!=k.applyArabicShaping,isLoading:()=>_===Fn,setState(r){_=r.pluginStatus,a=r.pluginURL},isParsed:()=>null!=k.applyArabicShaping&&null!=k.processBidirectionalText&&null!=k.processStyledBidirectionalText,getPluginURL:()=>a};class B{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(s,u){for(const m of s)if(!us(m.charCodeAt(0),u))return!1;return!0}(e,k.isLoaded())}}class ${constructor(e,s){this.property=e,this.value=s,this.expression=function(u,m){if(Hi(u))return new Eu(u,m);if(Tc(u)){const y=wu(u,m);if("error"===y.result)throw new Error(y.value.map(x=>`${x.key}: ${x.message}`).join(", "));return y.value}{let y=u;return"string"==typeof u&&"color"===m.type&&(y=xn.parse(u)),{kind:"constant",evaluate:()=>y}}}(void 0===s?e.specification.default:s,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,s,u){return this.property.possiblyEvaluate(this,e,s,u)}}class j{constructor(e){this.property=e,this.value=new $(e,void 0)}transitioned(e,s){return new ee(this.property,this.value,s,ot({},e.transition,this.transition),e.now)}untransitioned(){return new ee(this.property,this.value,null,{},0)}}class q{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return oi(this._values[e].value.value)}setValue(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new j(this._values[e].property)),this._values[e].value=new $(this._values[e].property,null===s?void 0:oi(s))}getTransition(e){return oi(this._values[e].transition)}setTransition(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new j(this._values[e].property)),this._values[e].transition=oi(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const u=this.getValue(s);void 0!==u&&(e[s]=u);const m=this.getTransition(s);void 0!==m&&(e[`${s}-transition`]=m)}return e}transitioned(e,s){const u=new se(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(e,s._values[m]);return u}untransitioned(){const e=new se(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class ee{constructor(e,s,u,m,y){const x=m.delay||0,D=m.duration||0;y=y||0,this.property=e,this.value=s,this.begin=y+x,this.end=this.begin+D,e.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(e,s,u){const m=e.now||0,y=this.value.possiblyEvaluate(e,s,u),x=this.prior;if(x){if(m>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(m<this.begin)return x.possiblyEvaluate(e,s,u);{const D=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(e,s,u),y,mi(D))}}return y}}class se{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,u){const m=new ce(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(e,s,u);return m}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class le{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return oi(this._values[e].value)}setValue(e,s){this._values[e]=new $(this._values[e].property,null===s?void 0:oi(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const u=this.getValue(s);void 0!==u&&(e[s]=u)}return e}possiblyEvaluate(e,s,u){const m=new ce(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(e,s,u);return m}}class ae{constructor(e,s,u){this.property=e,this.value=s,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,s,u,m){return this.property.evaluate(this.value,this.parameters,e,s,u,m)}}class ce{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class X{constructor(e){this.specification=e}possiblyEvaluate(e,s){return e.expression.evaluate(s)}interpolate(e,s,u){const m=mu[this.specification.type];return m?m(e,s,u):e}}class oe{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,u,m){return new ae(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(s,null,{},u,m)}:e.expression,s)}interpolate(e,s,u){if("constant"!==e.value.kind||"constant"!==s.value.kind)return e;if(void 0===e.value.value||void 0===s.value.value)return new ae(this,{kind:"constant",value:void 0},e.parameters);const m=mu[this.specification.type];return m?new ae(this,{kind:"constant",value:m(e.value.value,s.value.value,u)},e.parameters):e}evaluate(e,s,u,m,y,x){return"constant"===e.kind?e.value:e.evaluate(s,u,m,y,x)}}class fe{constructor(e){this.specification=e}possiblyEvaluate(e,s,u,m){return!!e.expression.evaluate(s,null,{},u,m)}interpolate(){return!1}}class pe{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new B(0,{});for(const u in e){const m=e[u];m.specification.overridable&&this.overridableProperties.push(u);const y=this.defaultPropertyValues[u]=new $(m,void 0),x=this.defaultTransitionablePropertyValues[u]=new j(m);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=y.possiblyEvaluate(s)}}}function Te(r,e){return 256*(r=Wn(Math.floor(r),0,255))+Wn(Math.floor(e),0,255)}dn(oe,"DataDrivenProperty"),dn(X,"DataConstantProperty"),dn(fe,"ColorRampProperty");const De={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Me{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ze{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Oe(r,e=1){let s=0,u=0;return{members:r.map(m=>{const y=De[m.type].BYTES_PER_ELEMENT,x=s=Xe(s,Math.max(e,y)),D=m.components||1;return u=Math.max(u,y),s+=y*D,{name:m.name,type:m.type,components:D,offset:x}}),size:Xe(s,Math.max(u,e)),alignment:e}}function Xe(r,e){return Math.ceil(r/e)*e}class At extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,s)}emplace(e,s,u){const m=2*e;return this.int16[m+0]=s,this.int16[m+1]=u,e}}At.prototype.bytesPerElement=4,dn(At,"StructArrayLayout2i4");class Ve extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,u)}emplace(e,s,u,m){const y=3*e;return this.int16[y+0]=s,this.int16[y+1]=u,this.int16[y+2]=m,e}}Ve.prototype.bytesPerElement=6,dn(Ve,"StructArrayLayout3i6");class ht extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,u,m)}emplace(e,s,u,m,y){const x=4*e;return this.int16[x+0]=s,this.int16[x+1]=u,this.int16[x+2]=m,this.int16[x+3]=y,e}}ht.prototype.bytesPerElement=8,dn(ht,"StructArrayLayout4i8");class tt extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x,D){const S=this.length;return this.resize(S+1),this.emplace(S,e,s,u,m,y,x,D)}emplace(e,s,u,m,y,x,D,S){const P=6*e,F=12*e,z=3*e;return this.int16[P+0]=s,this.int16[P+1]=u,this.uint8[F+4]=m,this.uint8[F+5]=y,this.uint8[F+6]=x,this.uint8[F+7]=D,this.float32[z+2]=S,e}}tt.prototype.bytesPerElement=12,dn(tt,"StructArrayLayout2i4ub1f12");class _t extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,u,m)}emplace(e,s,u,m,y){const x=4*e;return this.float32[x+0]=s,this.float32[x+1]=u,this.float32[x+2]=m,this.float32[x+3]=y,e}}_t.prototype.bytesPerElement=16,dn(_t,"StructArrayLayout4f16");class He extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,u,m,y)}emplace(e,s,u,m,y,x){const D=6*e,S=3*e;return this.uint16[D+0]=s,this.uint16[D+1]=u,this.uint16[D+2]=m,this.uint16[D+3]=y,this.float32[S+2]=x,e}}He.prototype.bytesPerElement=12,dn(He,"StructArrayLayout4ui1f12");class ct extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,u,m)}emplace(e,s,u,m,y){const x=4*e;return this.uint16[x+0]=s,this.uint16[x+1]=u,this.uint16[x+2]=m,this.uint16[x+3]=y,e}}ct.prototype.bytesPerElement=8,dn(ct,"StructArrayLayout4ui8");class Lt extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x){const D=this.length;return this.resize(D+1),this.emplace(D,e,s,u,m,y,x)}emplace(e,s,u,m,y,x,D){const S=6*e;return this.int16[S+0]=s,this.int16[S+1]=u,this.int16[S+2]=m,this.int16[S+3]=y,this.int16[S+4]=x,this.int16[S+5]=D,e}}Lt.prototype.bytesPerElement=12,dn(Lt,"StructArrayLayout6i12");class ft extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x,D,S,P,F,z,U){const H=this.length;return this.resize(H+1),this.emplace(H,e,s,u,m,y,x,D,S,P,F,z,U)}emplace(e,s,u,m,y,x,D,S,P,F,z,U,H){const G=12*e;return this.int16[G+0]=s,this.int16[G+1]=u,this.int16[G+2]=m,this.int16[G+3]=y,this.uint16[G+4]=x,this.uint16[G+5]=D,this.uint16[G+6]=S,this.uint16[G+7]=P,this.int16[G+8]=F,this.int16[G+9]=z,this.int16[G+10]=U,this.int16[G+11]=H,e}}ft.prototype.bytesPerElement=24,dn(ft,"StructArrayLayout4i4ui4i24");class Ct extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x){const D=this.length;return this.resize(D+1),this.emplace(D,e,s,u,m,y,x)}emplace(e,s,u,m,y,x,D){const S=10*e,P=5*e;return this.int16[S+0]=s,this.int16[S+1]=u,this.int16[S+2]=m,this.float32[P+2]=y,this.float32[P+3]=x,this.float32[P+4]=D,e}}Ct.prototype.bytesPerElement=20,dn(Ct,"StructArrayLayout3i3f20");class vn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}vn.prototype.bytesPerElement=4,dn(vn,"StructArrayLayout1ul4");class Rn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x,D,S,P,F,z,U,H){const G=this.length;return this.resize(G+1),this.emplace(G,e,s,u,m,y,x,D,S,P,F,z,U,H)}emplace(e,s,u,m,y,x,D,S,P,F,z,U,H,G){const K=20*e,re=10*e;return this.int16[K+0]=s,this.int16[K+1]=u,this.int16[K+2]=m,this.int16[K+3]=y,this.int16[K+4]=x,this.float32[re+3]=D,this.float32[re+4]=S,this.float32[re+5]=P,this.float32[re+6]=F,this.int16[K+14]=z,this.uint32[re+8]=U,this.uint16[K+18]=H,this.uint16[K+19]=G,e}}Rn.prototype.bytesPerElement=40,dn(Rn,"StructArrayLayout5i4f1i1ul2ui40");class sn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x,D){const S=this.length;return this.resize(S+1),this.emplace(S,e,s,u,m,y,x,D)}emplace(e,s,u,m,y,x,D,S){const P=8*e;return this.int16[P+0]=s,this.int16[P+1]=u,this.int16[P+2]=m,this.int16[P+4]=y,this.int16[P+5]=x,this.int16[P+6]=D,this.int16[P+7]=S,e}}sn.prototype.bytesPerElement=16,dn(sn,"StructArrayLayout3i2i2i16");class bn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,u,m,y)}emplace(e,s,u,m,y,x){const D=4*e,S=8*e;return this.float32[D+0]=s,this.float32[D+1]=u,this.float32[D+2]=m,this.int16[S+6]=y,this.int16[S+7]=x,e}}bn.prototype.bytesPerElement=16,dn(bn,"StructArrayLayout2f1f2i16");class Kn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,u,m)}emplace(e,s,u,m,y){const x=12*e,D=3*e;return this.uint8[x+0]=s,this.uint8[x+1]=u,this.float32[D+1]=m,this.float32[D+2]=y,e}}Kn.prototype.bytesPerElement=12,dn(Kn,"StructArrayLayout2ub2f12");class Mn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,u)}emplace(e,s,u,m){const y=3*e;return this.float32[y+0]=s,this.float32[y+1]=u,this.float32[y+2]=m,e}}Mn.prototype.bytesPerElement=12,dn(Mn,"StructArrayLayout3f12");class an extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,u)}emplace(e,s,u,m){const y=3*e;return this.uint16[y+0]=s,this.uint16[y+1]=u,this.uint16[y+2]=m,e}}an.prototype.bytesPerElement=6,dn(an,"StructArrayLayout3ui6");class Ai extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x,D,S,P,F,z,U,H,G,K,re,he,be,de,ve,we){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,e,s,u,m,y,x,D,S,P,F,z,U,H,G,K,re,he,be,de,ve,we)}emplace(e,s,u,m,y,x,D,S,P,F,z,U,H,G,K,re,he,be,de,ve,we,Ee){const Je=30*e,Ke=15*e,dt=60*e;return this.int16[Je+0]=s,this.int16[Je+1]=u,this.int16[Je+2]=m,this.float32[Ke+2]=y,this.float32[Ke+3]=x,this.uint16[Je+8]=D,this.uint16[Je+9]=S,this.uint32[Ke+5]=P,this.uint32[Ke+6]=F,this.uint32[Ke+7]=z,this.uint16[Je+16]=U,this.uint16[Je+17]=H,this.uint16[Je+18]=G,this.float32[Ke+10]=K,this.float32[Ke+11]=re,this.uint8[dt+48]=he,this.uint8[dt+49]=be,this.uint8[dt+50]=de,this.uint32[Ke+13]=ve,this.int16[Je+28]=we,this.uint8[dt+58]=Ee,e}}Ai.prototype.bytesPerElement=60,dn(Ai,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ii extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y,x,D,S,P,F,z,U,H,G,K,re,he,be,de,ve,we,Ee,Je,Ke,dt,Ot,rt,vt,yt,Mt){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,e,s,u,m,y,x,D,S,P,F,z,U,H,G,K,re,he,be,de,ve,we,Ee,Je,Ke,dt,Ot,rt,vt,yt,Mt)}emplace(e,s,u,m,y,x,D,S,P,F,z,U,H,G,K,re,he,be,de,ve,we,Ee,Je,Ke,dt,Ot,rt,vt,yt,Mt,Rt){const at=38*e,Ht=19*e;return this.int16[at+0]=s,this.int16[at+1]=u,this.int16[at+2]=m,this.float32[Ht+2]=y,this.float32[Ht+3]=x,this.int16[at+8]=D,this.int16[at+9]=S,this.int16[at+10]=P,this.int16[at+11]=F,this.int16[at+12]=z,this.int16[at+13]=U,this.uint16[at+14]=H,this.uint16[at+15]=G,this.uint16[at+16]=K,this.uint16[at+17]=re,this.uint16[at+18]=he,this.uint16[at+19]=be,this.uint16[at+20]=de,this.uint16[at+21]=ve,this.uint16[at+22]=we,this.uint16[at+23]=Ee,this.uint16[at+24]=Je,this.uint16[at+25]=Ke,this.uint16[at+26]=dt,this.uint16[at+27]=Ot,this.uint16[at+28]=rt,this.uint32[Ht+15]=vt,this.float32[Ht+16]=yt,this.float32[Ht+17]=Mt,this.float32[Ht+18]=Rt,e}}ii.prototype.bytesPerElement=76,dn(ii,"StructArrayLayout3i2f6i15ui1ul3f76");class Gi extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}Gi.prototype.bytesPerElement=4,dn(Gi,"StructArrayLayout1f4");class ki extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,u,m,y)}emplace(e,s,u,m,y,x){const D=5*e;return this.float32[D+0]=s,this.float32[D+1]=u,this.float32[D+2]=m,this.float32[D+3]=y,this.float32[D+4]=x,e}}ki.prototype.bytesPerElement=20,dn(ki,"StructArrayLayout5f20");class Sr extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,u,m)}emplace(e,s,u,m,y){const x=6*e;return this.uint32[3*e+0]=s,this.uint16[x+2]=u,this.uint16[x+3]=m,this.uint16[x+4]=y,e}}Sr.prototype.bytesPerElement=12,dn(Sr,"StructArrayLayout1ul3ui12");class $r extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,s)}emplace(e,s,u){const m=2*e;return this.uint16[m+0]=s,this.uint16[m+1]=u,e}}$r.prototype.bytesPerElement=4,dn($r,"StructArrayLayout2ui4");class zn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}zn.prototype.bytesPerElement=2,dn(zn,"StructArrayLayout1ui2");class Co extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,s)}emplace(e,s,u){const m=2*e;return this.float32[m+0]=s,this.float32[m+1]=u,e}}Co.prototype.bytesPerElement=8,dn(Co,"StructArrayLayout2f8");class Li extends Me{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Li.prototype.size=40;class gi extends Rn{get(e){return new Li(this,e)}}dn(gi,"CollisionBoxArray");class _i extends Me{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}_i.prototype.size=60;class Ir extends Ai{get(e){return new _i(this,e)}}dn(Ir,"PlacedSymbolArray");class lr extends Me{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}lr.prototype.size=76;class Pi extends ii{get(e){return new lr(this,e)}}dn(Pi,"SymbolInstanceArray");class Qo extends Gi{getoffsetX(e){return this.float32[1*e+0]}}dn(Qo,"GlyphOffsetArray");class Xs extends At{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}dn(Xs,"SymbolLineVertexArray");class Oc extends Me{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Oc.prototype.size=12;class Su extends Sr{get(e){return new Oc(this,e)}}dn(Su,"FeatureIndexArray");class Ua extends $r{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}dn(Ua,"FillExtrusionCentroidArray");const Zl=Oe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ql=Oe([{name:"a_dash",components:4,type:"Uint16"}]);var Wh={exports:{}},Er=function(r,e){var s,u,m,y,x,D,S,P;for(u=r.length-(s=3&r.length),m=e,x=3432918353,D=461845907,P=0;P<u;)S=255&r.charCodeAt(P)|(255&r.charCodeAt(++P))<<8|(255&r.charCodeAt(++P))<<16|(255&r.charCodeAt(++P))<<24,++P,m=27492+(65535&(y=5*(65535&(m=(m^=S=(65535&(S=(S=(65535&S)*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*D+(((S>>>16)*D&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(S=0,s){case 3:S^=(255&r.charCodeAt(P+2))<<16;case 2:S^=(255&r.charCodeAt(P+1))<<8;case 1:m^=S=(65535&(S=(S=(65535&(S^=255&r.charCodeAt(P)))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*D+(((S>>>16)*D&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0},er=function(r,e){for(var s,u=r.length,m=e^u,y=0;u>=4;)s=1540483477*(65535&(s=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(s>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),u-=4,++y;switch(u){case 3:m^=(255&r.charCodeAt(y+2))<<16;case 2:m^=(255&r.charCodeAt(y+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(y)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};Wh.exports=Er,Wh.exports.murmur3=Er,Wh.exports.murmur2=er;var ja=Pt(Wh.exports);class fp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,u,m){this.ids.push(ao(e)),this.positions.push(s,u,m)}getPositions(e){const s=ao(e);let u=0,m=this.ids.length-1;for(;u<m;){const x=u+m>>1;this.ids[x]>=s?m=x:u=x+1}const y=[];for(;this.ids[u]===s;)y.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return y}static serialize(e,s){const u=new Float64Array(e.ids),m=new Uint32Array(e.positions);return kc(u,m,0,u.length-1),s&&s.push(u.buffer,m.buffer),{ids:u,positions:m}}static deserialize(e){const s=new fp;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function ao(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ja(String(r))}function kc(r,e,s,u){for(;s<u;){const m=r[s+u>>1];let y=s-1,x=u+1;for(;;){do{y++}while(r[y]<m);do{x--}while(r[x]>m);if(y>=x)break;Yl(r,y,x),Yl(e,3*y,3*x),Yl(e,3*y+1,3*x+1),Yl(e,3*y+2,3*x+2)}x-s<u-x?(kc(r,e,s,x),s=x+1):(kc(r,e,x+1,u),u=x)}}function Yl(r,e,s){const u=r[e];r[e]=r[s],r[s]=u}dn(fp,"FeaturePositionMap");class Rs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,s),this.initialized=!0),!!this.location}}class Lc extends Rs{constructor(e){super(e),this.current=0}set(e,s,u){this.fetchUniformLocation(e,s)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class qh extends Rs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,s,u){this.fetchUniformLocation(e,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Yh extends Rs{constructor(e){super(e),this.current=xn.transparent}set(e,s,u){this.fetchUniformLocation(e,s)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const O_=new Float32Array(16),Ym=new Float32Array(9),Js=new Float32Array(4);function Iu(r){return[Te(255*r.r,255*r.g),Te(255*r.b,255*r.a)]}class Qs{constructor(e,s,u){this.value=e,this.uniformNames=s.map(m=>`u_${m}`),this.type=u}setUniform(e,s,u,m,y){s.set(e,y,m.constantOr(this.value))}getBinding(e,s){return"color"===this.type?new Yh(e):new Lc(e)}}class Ld{constructor(e,s){this.uniformNames=s.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,s,u,m,y){const x="u_pattern"===y||"u_dash"===y?this.pattern:"u_pixel_ratio"===y?this.pixelRatio:null;x&&s.set(e,y,x)}getBinding(e,s){return"u_pattern"===s||"u_dash"===s?new qh(e):new Lc(e)}}class $a{constructor(e,s,u,m){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,s,u,m,y,x){const D=this.paintVertexArray.length,S=this.expression.evaluate(new B(0),s,{},y,m,x);this.paintVertexArray.resize(e),this._setPaintValue(D,e,S)}updatePaintArray(e,s,u,m,y){const x=this.expression.evaluate({zoom:0},u,m,void 0,y);this._setPaintValue(e,s,x)}_setPaintValue(e,s,u){if("color"===this.type){const m=Iu(u);for(let y=e;y<s;y++)this.paintVertexArray.emplace(y,m[0],m[1])}else{for(let m=e;m<s;m++)this.paintVertexArray.emplace(m,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ha{constructor(e,s,u,m,y,x){this.expression=e,this.uniformNames=s.map(D=>`u_${D}_t`),this.type=u,this.useIntegerZoom=m,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=s.map(D=>({name:`a_${D}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(e,s,u,m,y,x){const D=this.expression.evaluate(new B(this.zoom),s,{},y,m,x),S=this.expression.evaluate(new B(this.zoom+1),s,{},y,m,x),P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,D,S)}updatePaintArray(e,s,u,m,y){const x=this.expression.evaluate({zoom:this.zoom},u,m,void 0,y),D=this.expression.evaluate({zoom:this.zoom+1},u,m,void 0,y);this._setPaintValue(e,s,x,D)}_setPaintValue(e,s,u,m){if("color"===this.type){const y=Iu(u),x=Iu(m);for(let D=e;D<s;D++)this.paintVertexArray.emplace(D,y[0],y[1],x[0],x[1])}else{for(let y=e;y<s;y++)this.paintVertexArray.emplace(y,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s,u,m,y){const x=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,D=Wn(this.expression.interpolationFactor(x,this.zoom,this.zoom+1),0,1);s.set(e,y,D)}getBinding(e,s){return new Lc(e)}}class Fc{constructor(e,s,u,m,y){this.expression=e,this.layerId=y,this.paintVertexAttributes=("array"===u?ql:Zl).members;for(let x=0;x<s.length;++x);this.paintVertexArray=new m}populatePaintArray(e,s,u){const m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(e,s,u,m,y,x){this._setPaintValues(e,s,u.patterns&&u.patterns[this.layerId],x)}_setPaintValues(e,s,u,m){if(!m||!u)return;const y=m[u];if(!y)return;const{tl:x,br:D,pixelRatio:S}=y;for(let P=e;P<s;P++)this.paintVertexArray.emplace(P,x[0],x[1],D[0],D[1],S)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Nc{constructor(e,s,u=(()=>!0)){this.binders={},this._buffers=[];const m=[];for(const y in e.paint._values){if(!u(y))continue;const x=e.paint.get(y);if(!(x instanceof ae&&Ec(x.property.specification)))continue;const D=Bv(y,e.type),S=x.value,P=x.property.specification.type,F=!!x.property.useIntegerZoom,z="line-dasharray"===y||y.endsWith("pattern"),U="line-dasharray"===y&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==S.kind||U)if("source"===S.kind||U||z){const H=Km(y,P,"source");this.binders[y]=z?new Fc(S,D,P,H,e.id):new $a(S,D,P,H),m.push(`/a_${y}`)}else{const H=Km(y,P,"composite");this.binders[y]=new Ha(S,D,P,F,s,H),m.push(`/z_${y}`)}else this.binders[y]=z?new Ld(S.value,D):new Qs(S.value,D,P),m.push(`/u_${y}`)}this.cacheKey=m.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof $a||s instanceof Ha?s.maxValue:0}populatePaintArrays(e,s,u,m,y,x){for(const D in this.binders){const S=this.binders[D];(S instanceof $a||S instanceof Ha||S instanceof Fc)&&S.populatePaintArray(e,s,u,m,y,x)}}setConstantPatternPositions(e){for(const s in this.binders){const u=this.binders[s];u instanceof Ld&&u.setConstantPatternPositions(e)}}updatePaintArrays(e,s,u,m,y,x){let D=!1;for(const S in e){const P=s.getPositions(S);for(const F of P){const z=u.feature(F.index);for(const U in this.binders){const H=this.binders[U];if((H instanceof $a||H instanceof Ha||H instanceof Fc)&&!0===H.expression.isStateDependent){const G=m.paint.get(U);H.expression=G.value,H.updatePaintArray(F.start,F.end,z,e[S],y,x),D=!0}}}}return D}defines(){const e=[];for(const s in this.binders){const u=this.binders[s];(u instanceof Qs||u instanceof Ld)&&e.push(...u.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof $a||u instanceof Ha||u instanceof Fc)for(let m=0;m<u.paintVertexAttributes.length;m++)e.push(u.paintVertexAttributes[m].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Qs||u instanceof Ld||u instanceof Ha)for(const m of u.uniformNames)e.push(m)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const s=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Qs||m instanceof Ld||m instanceof Ha)for(const y of m.uniformNames)s.push({name:y,property:u,binding:m.getBinding(e,y)})}return s}setUniforms(e,s,u,m,y){for(const{name:x,property:D,binding:S}of u)this.binders[D].setUniform(e,S,y,m.get(D),x)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const s=this.binders[e];(s instanceof $a||s instanceof Ha||s instanceof Fc)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const s in this.binders){const u=this.binders[s];(u instanceof $a||u instanceof Ha||u instanceof Fc)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof $a||s instanceof Ha||s instanceof Fc)&&s.destroy()}}}class Xl{constructor(e,s,u=(()=>!0)){this.programConfigurations={};for(const m of e)this.programConfigurations[m.id]=new Nc(m,s,u);this.needsUpload=!1,this._featureMap=new fp,this._bufferOffset=0}populatePaintArrays(e,s,u,m,y,x,D){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,s,m,y,x,D);void 0!==s.id&&this._featureMap.add(s.id,u,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,u,m,y){for(const x of u)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,s,x,m,y)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Nv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Bv(r,e){return Nv[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const Xm={"line-pattern":{source:He,composite:He},"fill-pattern":{source:He,composite:He},"fill-extrusion-pattern":{source:He,composite:He},"line-dasharray":{source:ct,composite:ct}},pp={color:{source:Co,composite:_t},number:{source:Gi,composite:Co}};function Km(r,e,s){const u=Xm[r];return u&&u[s]||pp[e][s]}dn(Qs,"ConstantBinder"),dn(Ld,"PatternConstantBinder"),dn($a,"SourceExpressionBinder"),dn(Fc,"PatternCompositeBinder"),dn(Ha,"CompositeExpressionBinder"),dn(Nc,"ProgramConfiguration",{omit:["_buffers"]}),dn(Xl,"ProgramConfigurationSet");const Xh="-transition";class Ga extends ka{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),s.layout&&(this._unevaluatedLayout=new le(s.layout)),s.paint)){this._transitionablePaint=new q(s.paint);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ce(s.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s,u={}){null!=s&&this._validate(Hm,`layers.${this.id}.layout.${e}`,e,s,u)||("visibility"!==e?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return gt(e,Xh)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,u={}){if(null!=s&&this._validate(dp,`layers.${this.id}.paint.${e}`,e,s,u))return!1;if(gt(e,Xh))return this._transitionablePaint.setTransition(e.slice(0,-11),s||void 0),!1;{const m=this._transitionablePaint._values[e],y=m.value.isDataDriven(),x=m.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const D=this._transitionablePaint._values[e].value,S=D.isDataDriven(),P=gt(e,"pattern")||"line-dasharray"===e;return S||y||P||this._handleOverridablePaintPropertyUpdate(e,x,D)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,s,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),_n(e,(s,u)=>!(void 0===s||"layout"===u&&!Object.keys(s).length||"paint"===u&&!Object.keys(s).length))}_validate(e,s,u,m,y={}){return(!y||!1!==y.validate)&&Gm(this,e.call(Hh,{key:s,layerType:this.type,objectKey:u,value:m,styleSpec:lt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof ae&&Ec(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ha(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Kh=Oe([{name:"a_pos",components:2,type:"Int16"}],4),k_=Oe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ar{constructor(e=[]){this.segments=e}prepareSegment(e,s,u,m){let y=this.segments[this.segments.length-1];return e>Ar.MAX_VERTEX_ARRAY_LENGTH&&qn(`Max vertices per segment is ${Ar.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!y||y.vertexLength+e>Ar.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==m)&&(y={vertexOffset:s.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==m&&(y.sortKey=m),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,u,m){return new Ar([{vertexOffset:e,primitiveOffset:s,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}Ar.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,dn(Ar,"SegmentVector");var mn=8192;class Wa{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Yi?new Yi(e.lng,e.lat):Yi.convert(e),this}setSouthWest(e){return this._sw=e instanceof Yi?new Yi(e.lng,e.lat):Yi.convert(e),this}extend(e){const s=this._sw,u=this._ne;let m,y;if(e instanceof Yi)m=e,y=e;else{if(!(e instanceof Wa))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Wa.convert(e)):this.extend(Yi.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Yi.convert(e)):this;if(m=e._sw,y=e._ne,!m||!y)return this}return s||u?(s.lng=Math.min(m.lng,s.lng),s.lat=Math.min(m.lat,s.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new Yi(m.lng,m.lat),this._ne=new Yi(y.lng,y.lat)),this}getCenter(){return new Yi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Yi(this.getWest(),this.getNorth())}getSouthEast(){return new Yi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:u}=Yi.convert(e);let m=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&m}static convert(e){return!e||e instanceof Wa?e:new Wa(e)}}var Fd=1e-6,ds=typeof Float32Array<"u"?Float32Array:Array;function Jh(){var r=new ds(9);return ds!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Za(r,e,s){var u=e[0],m=e[1],y=e[2],x=e[3],D=e[4],S=e[5],P=e[6],F=e[7],z=e[8],U=s[0],H=s[1],G=s[2],K=s[3],re=s[4],he=s[5],be=s[6],de=s[7],ve=s[8];return r[0]=U*u+H*x+G*P,r[1]=U*m+H*D+G*F,r[2]=U*y+H*S+G*z,r[3]=K*u+re*x+he*P,r[4]=K*m+re*D+he*F,r[5]=K*y+re*S+he*z,r[6]=be*u+de*x+ve*P,r[7]=be*m+de*D+ve*F,r[8]=be*y+de*S+ve*z,r}function Uo(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function mp(r,e){var s=e[0],u=e[1],m=e[2],y=e[3],x=e[4],D=e[5],S=e[6],P=e[7],F=e[8],z=e[9],U=e[10],H=e[11],G=e[12],K=e[13],re=e[14],he=e[15],be=s*D-u*x,de=s*S-m*x,ve=s*P-y*x,we=u*S-m*D,Ee=u*P-y*D,Je=m*P-y*S,Ke=F*K-z*G,dt=F*re-U*G,Ot=F*he-H*G,rt=z*re-U*K,vt=z*he-H*K,yt=U*he-H*re,Mt=be*yt-de*vt+ve*rt+we*Ot-Ee*dt+Je*Ke;return Mt?(r[0]=(D*yt-S*vt+P*rt)*(Mt=1/Mt),r[1]=(m*vt-u*yt-y*rt)*Mt,r[2]=(K*Je-re*Ee+he*we)*Mt,r[3]=(U*Ee-z*Je-H*we)*Mt,r[4]=(S*Ot-x*yt-P*dt)*Mt,r[5]=(s*yt-m*Ot+y*dt)*Mt,r[6]=(re*ve-G*Je-he*de)*Mt,r[7]=(F*Je-U*ve+H*de)*Mt,r[8]=(x*vt-D*Ot+P*Ke)*Mt,r[9]=(u*Ot-s*vt-y*Ke)*Mt,r[10]=(G*Ee-K*ve+he*be)*Mt,r[11]=(z*ve-F*Ee-H*be)*Mt,r[12]=(D*dt-x*rt-S*Ke)*Mt,r[13]=(s*rt-u*dt+m*Ke)*Mt,r[14]=(K*de-G*we-re*be)*Mt,r[15]=(F*we-z*de+U*be)*Mt,r):null}function Au(r,e,s){var u=e[0],m=e[1],y=e[2],x=e[3],D=e[4],S=e[5],P=e[6],F=e[7],z=e[8],U=e[9],H=e[10],G=e[11],K=e[12],re=e[13],he=e[14],be=e[15],de=s[0],ve=s[1],we=s[2],Ee=s[3];return r[0]=de*u+ve*D+we*z+Ee*K,r[1]=de*m+ve*S+we*U+Ee*re,r[2]=de*y+ve*P+we*H+Ee*he,r[3]=de*x+ve*F+we*G+Ee*be,r[4]=(de=s[4])*u+(ve=s[5])*D+(we=s[6])*z+(Ee=s[7])*K,r[5]=de*m+ve*S+we*U+Ee*re,r[6]=de*y+ve*P+we*H+Ee*he,r[7]=de*x+ve*F+we*G+Ee*be,r[8]=(de=s[8])*u+(ve=s[9])*D+(we=s[10])*z+(Ee=s[11])*K,r[9]=de*m+ve*S+we*U+Ee*re,r[10]=de*y+ve*P+we*H+Ee*he,r[11]=de*x+ve*F+we*G+Ee*be,r[12]=(de=s[12])*u+(ve=s[13])*D+(we=s[14])*z+(Ee=s[15])*K,r[13]=de*m+ve*S+we*U+Ee*re,r[14]=de*y+ve*P+we*H+Ee*he,r[15]=de*x+ve*F+we*G+Ee*be,r}function Nd(r,e,s){var u,m,y,x,D,S,P,F,z,U,H,G,K=s[0],re=s[1],he=s[2];return e===r?(r[12]=e[0]*K+e[4]*re+e[8]*he+e[12],r[13]=e[1]*K+e[5]*re+e[9]*he+e[13],r[14]=e[2]*K+e[6]*re+e[10]*he+e[14],r[15]=e[3]*K+e[7]*re+e[11]*he+e[15]):(m=e[1],y=e[2],x=e[3],D=e[4],S=e[5],P=e[6],F=e[7],z=e[8],U=e[9],H=e[10],G=e[11],r[0]=u=e[0],r[1]=m,r[2]=y,r[3]=x,r[4]=D,r[5]=S,r[6]=P,r[7]=F,r[8]=z,r[9]=U,r[10]=H,r[11]=G,r[12]=u*K+D*re+z*he+e[12],r[13]=m*K+S*re+U*he+e[13],r[14]=y*K+P*re+H*he+e[14],r[15]=x*K+F*re+G*he+e[15]),r}function vl(r,e,s){var u=s[0],m=s[1],y=s[2];return r[0]=e[0]*u,r[1]=e[1]*u,r[2]=e[2]*u,r[3]=e[3]*u,r[4]=e[4]*m,r[5]=e[5]*m,r[6]=e[6]*m,r[7]=e[7]*m,r[8]=e[8]*y,r[9]=e[9]*y,r[10]=e[10]*y,r[11]=e[11]*y,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function L_(r,e,s){var u=Math.sin(s),m=Math.cos(s),y=e[4],x=e[5],D=e[6],S=e[7],P=e[8],F=e[9],z=e[10],U=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=y*m+P*u,r[5]=x*m+F*u,r[6]=D*m+z*u,r[7]=S*m+U*u,r[8]=P*m-y*u,r[9]=F*m-x*u,r[10]=z*m-D*u,r[11]=U*m-S*u,r}function gp(r,e,s){var u=Math.sin(s),m=Math.cos(s),y=e[0],x=e[1],D=e[2],S=e[3],P=e[8],F=e[9],z=e[10],U=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=y*m-P*u,r[1]=x*m-F*u,r[2]=D*m-z*u,r[3]=S*m-U*u,r[8]=y*u+P*m,r[9]=x*u+F*m,r[10]=D*u+z*m,r[11]=S*u+U*m,r}function F_(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Jm(r,e,s){var u,m,y,x=s[0],D=s[1],S=s[2],P=Math.hypot(x,D,S);return P<Fd?null:(x*=P=1/P,D*=P,S*=P,u=Math.sin(e),m=Math.cos(e),r[0]=x*x*(y=1-m)+m,r[1]=D*x*y+S*u,r[2]=S*x*y-D*u,r[3]=0,r[4]=x*D*y-S*u,r[5]=D*D*y+m,r[6]=S*D*y+x*u,r[7]=0,r[8]=x*S*y+D*u,r[9]=D*S*y-x*u,r[10]=S*S*y+m,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Bc=Au;function _p(){var r=new ds(3);return ds!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function yp(r){var e=new ds(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Bd(r){return Math.hypot(r[0],r[1],r[2])}function zd(r,e,s){var u=new ds(3);return u[0]=r,u[1]=e,u[2]=s,u}function qa(r,e,s){return r[0]=e[0]+s[0],r[1]=e[1]+s[1],r[2]=e[2]+s[2],r}function Vd(r,e,s){return r[0]=e[0]-s[0],r[1]=e[1]-s[1],r[2]=e[2]-s[2],r}function Ya(r,e,s){return r[0]=e[0]*s[0],r[1]=e[1]*s[1],r[2]=e[2]*s[2],r}function zc(r,e,s){return r[0]=Math.min(e[0],s[0]),r[1]=Math.min(e[1],s[1]),r[2]=Math.min(e[2],s[2]),r}function Os(r,e,s){return r[0]=Math.max(e[0],s[0]),r[1]=Math.max(e[1],s[1]),r[2]=Math.max(e[2],s[2]),r}function es(r,e,s){return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function Kl(r,e,s,u){return r[0]=e[0]+s[0]*u,r[1]=e[1]+s[1]*u,r[2]=e[2]+s[2]*u,r}function qr(r,e){var s=e[0],u=e[1],m=e[2],y=s*s+u*u+m*m;return y>0&&(y=1/Math.sqrt(y)),r[0]=e[0]*y,r[1]=e[1]*y,r[2]=e[2]*y,r}function ma(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function N_(r,e,s){var u=e[0],m=e[1],y=e[2],x=s[0],D=s[1],S=s[2];return r[0]=m*S-y*D,r[1]=y*x-u*S,r[2]=u*D-m*x,r}function Fr(r,e,s){var u=e[0],m=e[1],y=e[2],x=s[3]*u+s[7]*m+s[11]*y+s[15];return r[0]=(s[0]*u+s[4]*m+s[8]*y+s[12])/(x=x||1),r[1]=(s[1]*u+s[5]*m+s[9]*y+s[13])/x,r[2]=(s[2]*u+s[6]*m+s[10]*y+s[14])/x,r}function zv(r,e,s){var u=s[0],m=s[1],y=s[2],x=e[0],D=e[1],S=e[2],P=m*S-y*D,F=y*x-u*S,z=u*D-m*x,U=m*z-y*F,H=y*P-u*z,G=u*F-m*P,K=2*s[3];return F*=K,z*=K,H*=2,G*=2,r[0]=x+(P*=K)+(U*=2),r[1]=D+F+H,r[2]=S+z+G,r}var vp,Xa=Vd,bp=Ya,xp=Bd;function Qm(r,e,s){return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=e[3]*s,r}function eg(r,e){var s=e[0],u=e[1],m=e[2],y=e[3],x=s*s+u*u+m*m+y*y;return x>0&&(x=1/Math.sqrt(x)),r[0]=s*x,r[1]=u*x,r[2]=m*x,r[3]=y*x,r}function Vc(r,e,s){var u=e[0],m=e[1],y=e[2],x=e[3];return r[0]=s[0]*u+s[4]*m+s[8]*y+s[12]*x,r[1]=s[1]*u+s[5]*m+s[9]*y+s[13]*x,r[2]=s[2]*u+s[6]*m+s[10]*y+s[14]*x,r[3]=s[3]*u+s[7]*m+s[11]*y+s[15]*x,r}function Uc(){var r=new ds(4);return ds!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Qh(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function ef(r,e,s){s*=.5;var u=e[0],m=e[1],y=e[2],x=e[3],D=Math.sin(s),S=Math.cos(s);return r[0]=u*S+x*D,r[1]=m*S+y*D,r[2]=y*S-m*D,r[3]=x*S-u*D,r}function wp(r,e,s){s*=.5;var u=e[0],m=e[1],y=e[2],x=e[3],D=Math.sin(s),S=Math.cos(s);return r[0]=u*S-y*D,r[1]=m*S+x*D,r[2]=y*S+u*D,r[3]=x*S-m*D,r}_p(),vp=new ds(4),ds!=Float32Array&&(vp[0]=0,vp[1]=0,vp[2]=0,vp[3]=0);var Ep=eg;_p(),zd(1,0,0),zd(0,1,0),Uc(),Uc(),Jh();const jc=Oe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:tg}=jc,Cp=Oe([{name:"a_pos_3",components:3,type:"Int16"}]);var Pu=Oe([{name:"a_pos",type:"Int16",components:2}]);class ga{constructor(e,s){this.pos=e,this.dir=s}intersectsPlane(e,s,u){const m=ma(s,this.dir);if(Math.abs(m)<1e-6)return!1;const y=((e[0]-this.pos[0])*s[0]+(e[1]-this.pos[1])*s[1]+(e[2]-this.pos[2])*s[2])/m;return u[0]=this.pos[0]+this.dir[0]*y,u[1]=this.pos[1]+this.dir[1]*y,u[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(e,s,u){if(K=(H=this.pos)[0],re=H[1],he=H[2],be=(G=e)[0],de=G[1],ve=G[2],Math.abs(K-be)<=Fd*Math.max(1,Math.abs(K),Math.abs(be))&&Math.abs(re-de)<=Fd*Math.max(1,Math.abs(re),Math.abs(de))&&Math.abs(he-ve)<=Fd*Math.max(1,Math.abs(he),Math.abs(ve))||0===s)return u[0]=u[1]=u[2]=0,!1;var H,G,K,re,he,be,de,ve;const[m,y,x]=this.dir,D=this.pos[0]-e[0],S=this.pos[1]-e[1],P=this.pos[2]-e[2],F=m*m+y*y+x*x,z=2*(D*m+S*y+P*x),U=z*z-4*F*(D*D+S*S+P*P-s*s);if(U<0){const H=Math.max(-z/2,0),G=D+m*H,K=S+y*H,re=P+x*H,he=Math.hypot(G,K,re);return u[0]=G*s/he,u[1]=K*s/he,u[2]=re*s/he,!1}{const H=(-z-Math.sqrt(U))/(2*F);if(H<0){const G=Math.hypot(D,S,P);return u[0]=D*s/G,u[1]=S*s/G,u[2]=P*s/G,!1}return u[0]=D+m*H,u[1]=S+y*H,u[2]=P+x*H,!0}}}class bl{constructor(e,s,u,m,y){this.TL=e,this.TR=s,this.BR=u,this.BL=m,this.horizon=y}static fromInvProjectionMatrix(e,s,u){const m=[-1,1,1],y=[1,1,1],x=[1,-1,1],D=[-1,-1,1],S=Fr(m,m,e),P=Fr(y,y,e),F=Fr(x,x,e),z=Fr(D,D,e);return new bl(S,P,F,z,s/u)}}class Dp{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,u,m){const y=Math.pow(2,u),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const P=Vc([],S,e),F=1/P[3]/s*y;return(z=P)[0]=(U=P)[0]*(H=[F,F,m?1/P[3]:F,F])[0],z[1]=U[1]*H[1],z[2]=U[2]*H[2],z[3]=U[3]*H[3],z;var z,U,H}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const P=qr([],N_([],Xa([],x[S[0]],x[S[1]]),Xa([],x[S[2]],x[S[1]]))),F=-ma(P,x[S[1]]);return P.concat(F)});return new Dp(x,D)}}class jo{static fromPoints(e){const s=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const m of e)zc(s,s,m),Os(u,u,m);return new jo(s,u)}static applyTransform(e,s){const u=e.getCorners();for(let m=0;m<u.length;++m)Fr(u[m],u[m],s);return jo.fromPoints(u)}constructor(e,s){this.min=e,this.max=s,this.center=es([],qa([],this.min,this.max),.5)}quadrant(e){const s=[e%2==0,e<2],u=yp(this.min),m=yp(this.max);for(let y=0;y<s.length;y++)u[y]=s[y]?this.min[y]:this.center[y],m[y]=s[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new jo(u,m)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,s=this.max;return[[e[0],e[1],e[2]],[s[0],e[1],e[2]],[s[0],s[1],e[2]],[e[0],s[1],e[2]],[e[0],e[1],s[2]],[s[0],e[1],s[2]],[s[0],s[1],s[2]],[e[0],s[1],s[2]]]}intersects(e){const s=this.getCorners();let u=!0;for(let m=0;m<e.planes.length;m++){const y=e.planes[m];let x=0;for(let D=0;D<s.length;D++)x+=ma(y,s[D])+y[3]>=0;if(0===x)return 0;x!==s.length&&(u=!1)}if(u)return 2;for(let m=0;m<3;m++){let y=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let D=0;D<e.points.length;D++){const S=e.points[D][m]-this.min[m];y=Math.min(y,S),x=Math.max(x,S)}if(x<0||y>this.max[m]-this.min[m])return 0}return 1}}const ng=5,Jl=6,Ka=mn/Math.PI/2,Vv=16383,$c=[64,32,16],hs=-Ka,fs=Ka,Do=[new jo([hs,hs,hs],[fs,fs,fs]),new jo([hs,hs,hs],[0,0,fs]),new jo([0,hs,hs],[fs,0,fs]),new jo([hs,0,hs],[0,fs,fs]),new jo([0,0,hs],[fs,fs,fs])];function xl(r){return r*Ka/ps}function tf(r,e,s,u=!0){const m=es([],r._camera.position,r.worldSize),y=[e,s,1,1];Vc(y,y,r.pixelMatrixInverse),Qm(y,y,1/y[3]);const x=qr([],Xa([],y,m)),D=r.globeMatrix,S=[D[12],D[13],D[14]],P=Xa([],S,m),F=Bd(P),z=qr([],P),U=r.worldSize/(2*Math.PI),H=ma(z,x),G=Math.asin(U/F);if(G<Math.acos(H)){if(!u)return null;const Ot=[],rt=[];es(Ot,x,F/H),qr(rt,Xa(rt,Ot,P)),qr(x,qa(x,P,es(x,rt,Math.tan(G)*F)))}const K=[];new ga(m,x).closestPointOnSphere(S,U,K);const re=qr([],po(D,0)),he=qr([],po(D,1)),be=qr([],po(D,2)),de=ma(re,K),ve=ma(he,K),we=ma(be,K),Ee=Yt(Math.asin(-ve/U));let Je=Yt(Math.atan2(de,we));Je=r.center.lng+function(Ot,rt){const vt=(rt-Ot+180)%360-180;return vt<-180?vt+360:vt}(r.center.lng,Je);const Ke=wl(Je),dt=Wn(va(Ee),0,1);return new Fu(Ke,dt)}class B_{constructor(e,s,u){this.a=Xa([],e,u),this.b=Xa([],s,u),this.center=u;const m=qr([],this.a),y=qr([],this.b);this.angle=Math.acos(ma(m,y))}}function Ud(r,e){if(0===r.angle)return null;let s;return s=0===r.a[e]?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),s<0||s>1?null:function(u,m,y,x){const D=Math.sin(y);return u*(Math.sin((1-x)*y)/D)+m*(Math.sin(x*y)/D)}(r.a[e],r.b[e],r.angle,Wn(s,0,1))+r.center[e]}function _a(r){if(r.z<=1)return Do[r.z+2*r.y+r.x];const e=Tp(jd(r));return jo.fromPoints(e)}function Ru(r,e,s){return es(r,r,1-s),Kl(r,r,e,s)}function Ou(r,e){const s=Hd(e.zoom);if(0===s)return _a(r);const u=jd(r),m=Tp(u),y=wl(u.getWest())*e.worldSize,x=wl(u.getEast())*e.worldSize,D=va(u.getNorth())*e.worldSize,S=va(u.getSouth())*e.worldSize,P=[y,D,0],F=[x,D,0],z=[y,S,0],U=[x,S,0],H=mp([],e.globeMatrix);return Fr(P,P,H),Fr(F,F,H),Fr(z,z,H),Fr(U,U,H),m[0]=Ru(m[0],z,s),m[1]=Ru(m[1],U,s),m[2]=Ru(m[2],F,s),m[3]=Ru(m[3],P,s),jo.fromPoints(m)}function z_(r,e,s){for(const u of r)Fr(u,u,e),es(u,u,s)}function jd({x:r,y:e,z:s}){const u=1/(1<<s),m=new Yi(ms(r*u),io((e+1)*u)),y=new Yi(ms((r+1)*u),io(e*u));return new Wa(m,y)}function Tp(r){const e=kt(r.getNorth()),s=kt(r.getSouth()),u=Math.cos(e),m=Math.cos(s),y=Math.sin(e),x=Math.sin(s),D=r.getWest(),S=r.getEast();return[Ql(m,x,D),Ql(m,x,S),Ql(u,y,S),Ql(u,y,D)]}function Ql(r,e,s,u=Ka){return s=kt(s),[r*Math.sin(s)*u,-e*u,r*Math.cos(s)*u]}function Hc(r,e,s){return Ql(Math.cos(kt(r)),Math.sin(kt(r)),e,s)}function $d(r,e,s,u){const m=1<<s.z,y=(r/mn+s.x)/m;return Hc(io((e/mn+s.y)/m),ms(y),u)}function ec({min:r,max:e}){return Vv/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const U_=new Float64Array(16);function Mp(r){const e=ec(r),s=F_(U_,[e,e,e]);return Nd(s,s,((u=[])[0]=-(m=r.min)[0],u[1]=-m[1],u[2]=-m[2],u));var u,m}function ig(r){const e=(u=r.min,(s=U_)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=u[0],s[13]=u[1],s[14]=u[2],s[15]=1,s);var s,u;const m=1/ec(r);return vl(e,e,[m,m,m])}function j_(r,e,s,u,m){const y=function(S){const P=mn/(2*Math.PI);return S/(2*Math.PI)/P}(s),x=[r,e,-s/(2*Math.PI)],D=Uo(new Float64Array(16));return Nd(D,D,x),vl(D,D,[y,y,y]),L_(D,D,kt(-m)),gp(D,D,kt(-u)),D}function Hd(r){return $s(ng,Jl,r)}function ku(r,e){const s=Hc(e.lat,e.lng);return x=(m=Vd([],function(G){const K=Hc(G._center.lat,G._center.lng);let re=N_([],zd(0,1,0),K);const he=Jm([],-G.angle,K);re=Fr(re,re,he),Jm(he,-G._pitch,re);const be=qr([],K);return es(be,be,xl(G.cameraToCenterDistance/G.pixelsPerMeter)),Fr(be,be,he),qa([],K,be)}(r),s))[0],D=m[1],S=m[2],P=(y=s)[0],F=y[1],z=y[2],H=(U=Math.sqrt(x*x+D*D+S*S)*Math.sqrt(P*P+F*F+z*z))&&ma(m,y)/U,Math.acos(Math.min(Math.max(H,-1),1));var m,y,x,D,S,P,F,z,U,H}function nf(r,e){return ku(r,e)>Math.PI/2*1.01}const rg=kt(85),og=Math.cos(rg),Gd=Math.sin(rg),ps=6371008.8,$_=2*Math.PI*ps;class ya{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ya(Ci(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,u=this.lat*s,m=e.lat*s,y=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((e.lng-this.lng)*s);return ps*Math.acos(Math.min(y,1))}toBounds(e=0){const s=360*e/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new Wa(new ya(this.lng-u,this.lat-s),new ya(this.lng+u,this.lat+s))}toEcef(e){const s=xl(e);return Hc(this.lat,this.lng,Ka+s)}static convert(e){if(e instanceof ya)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ya(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ya(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Yi=ya;function sg(r){return $_*Math.cos(r*Math.PI/180)}function wl(r){return(180+r)/360}function va(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function $o(r,e){return r/sg(e)}function ms(r){return 360*r-180}function io(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Lu(r,e){return r*sg(io(e))}const Hr=85.051129;function Sp(r){return 1/Math.cos(r*Math.PI/180)}class Fu{constructor(e,s,u=0){this.x=+e,this.y=+s,this.z=+u}static fromLngLat(e,s=0){const u=Yi.convert(e);return new Fu(wl(u.lng),va(u.lat),$o(s,u.lat))}toLngLat(){return new Yi(ms(this.x),io(this.y))}toAltitude(){return Lu(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/$_*Sp(io(this.y))}}function ea(r,e,s,u,m,y,x,D,S){const P=(e+u)/2,F=(s+m)/2,z=new Ne(P,F);D(z),function(U,H,G,K,re,he){const be=G-re,de=K-he;return Math.abs((K-H)*be-(G-U)*de)/Math.hypot(be,de)}(z.x,z.y,y.x,y.y,x.x,x.y)>=S?(ea(r,e,s,P,F,y,z,D,S),ea(r,P,F,u,m,z,x,D,S)):r.push(x)}function Nu(r,e,s){let u=r[0],m=u.x,y=u.y;e(u);const x=[u];for(let D=1;D<r.length;D++){const S=r[D],{x:P,y:F}=S;e(S),ea(x,m,y,P,F,u,S,e,s),m=P,y=F,u=S}return x}function Ip(r,e,s,u){if(u(e,s)){const m=e.add(s)._mult(.5);Ip(r,e,m,u),Ip(r,m,s,u)}else r.push(s)}function Uv(r,e){let s=r[0];const u=[s];for(let m=1;m<r.length;m++){const y=r[m];Ip(u,s,y,e),s=y}return u}const H_=Math.pow(2,14)-1,rf=-H_-1;function jv(r,e){const s=Math.round(r.x*e),u=Math.round(r.y*e);return r.x=Wn(s,rf,H_),r.y=Wn(u,rf,H_),(s<r.x||s>r.x+1||u<r.y||u>r.y+1)&&qn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function El(r,e,s){const u=r.loadGeometry(),m=r.extent,y=mn/m;if(e&&s&&s.projection.isReprojectedInTileSpace){const x=1<<e.z,{scale:D,x:S,y:P,projection:F}=s,z=U=>{const H=ms((e.x+U.x/m)/x),G=io((e.y+U.y/m)/x),K=F.project(H,G);U.x=(K.x*D-S)*m,U.y=(K.y*D-P)*m};for(let U=0;U<u.length;U++)if(1!==r.type)u[U]=Nu(u[U],z,1);else{const H=[];for(const G of u[U])G.x<0||G.x>=m||G.y<0||G.y>=m||(z(G),H.push(G));u[U]=H}}for(const x of u)for(const D of x)jv(D,y);return u}function Bu(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?El(r):[]}}function sf(r,e,s,u,m){r.emplaceBack(2*e+(u+1)/2,2*s+(m+1)/2)}function zu(r,e,s){r.emplaceBack(e.x,e.y,e.z,16384*s[0],16384*s[1],16384*s[2])}class Vu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new At,this.indexArray=new an,this.segments=new Ar,this.programConfigurations=new Xl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,u,m){const y=this.layers[0],x=[];let D=null;"circle"===y.type&&(D=y.layout.get("circle-sort-key"));for(const{feature:P,id:F,index:z,sourceLayerIndex:U}of e){const H=this.layers[0]._featureFilter.needGeometry,G=Bu(P,H);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),G,u))continue;const K=D?D.evaluate(G,{},u):void 0,re={id:F,properties:P.properties,type:P.type,sourceLayerIndex:U,index:z,geometry:H?G.geometry:El(P,u,m),patterns:{},sortKey:K};x.push(re)}D&&x.sort((P,F)=>P.sortKey-F.sortKey);let S=null;"globe"===m.projection.name&&(this.globeExtVertexArray=new Lt,S=m.projection);for(const P of x){const{geometry:F,index:z,sourceLayerIndex:U}=P,H=e[z].feature;this.addFeature(P,F,z,s.availableImages,u,S),s.featureIndex.insert(H,F,z,U,this.index)}}update(e,s,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,u,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,k_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,s,u,m,y,x){for(const D of s)for(const S of D){const P=S.x,F=S.y;if(P<0||P>=mn||F<0||F>=mn)continue;if(x){const H=x.projectTilePoint(P,F,y),G=x.upVector(y,P,F),K=this.globeExtVertexArray;zu(K,H,G),zu(K,H,G),zu(K,H,G),zu(K,H,G)}const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),U=z.vertexLength;sf(this.layoutVertexArray,P,F,-1,-1),sf(this.layoutVertexArray,P,F,1,-1),sf(this.layoutVertexArray,P,F,1,1),sf(this.layoutVertexArray,P,F,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+2,U+3),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},m,y)}}function Cl(r,e){for(let s=0;s<r.length;s++)if(Gc(e,r[s]))return!0;for(let s=0;s<e.length;s++)if(Gc(r,e[s]))return!0;return!!Wd(r,e)}function af(r,e,s){return!!Gc(r,e)||!!lf(e,r,s)}function ag(r,e){if(1===r.length)return W_(e,r[0]);for(let s=0;s<e.length;s++){const u=e[s];for(let m=0;m<u.length;m++)if(Gc(r,u[m]))return!0}for(let s=0;s<r.length;s++)if(W_(e,r[s]))return!0;for(let s=0;s<e.length;s++)if(Wd(r,e[s]))return!0;return!1}function lg(r,e,s){if(r.length>1){if(Wd(r,e))return!0;for(let u=0;u<e.length;u++)if(lf(e[u],r,s))return!0}for(let u=0;u<r.length;u++)if(lf(r[u],e,s))return!0;return!1}function Wd(r,e){if(0===r.length||0===e.length)return!1;for(let s=0;s<r.length-1;s++){const u=r[s],m=r[s+1];for(let y=0;y<e.length-1;y++)if(G_(u,m,e[y],e[y+1]))return!0}return!1}function G_(r,e,s,u){return Vi(r,s,u)!==Vi(e,s,u)&&Vi(r,e,s)!==Vi(r,e,u)}function lf(r,e,s){const u=s*s;if(1===e.length)return r.distSqr(e[0])<u;for(let m=1;m<e.length;m++)if(Zd(r,e[m-1],e[m])<u)return!0;return!1}function Zd(r,e,s){const u=e.distSqr(s);if(0===u)return r.distSqr(e);const m=((r.x-e.x)*(s.x-e.x)+(r.y-e.y)*(s.y-e.y))/u;return r.distSqr(m<0?e:m>1?s:s.sub(e)._mult(m)._add(e))}function W_(r,e){let s,u,m,y=!1;for(let x=0;x<r.length;x++){s=r[x];for(let D=0,S=s.length-1;D<s.length;S=D++)u=s[D],m=s[S],u.y>e.y!=m.y>e.y&&e.x<(m.x-u.x)*(e.y-u.y)/(m.y-u.y)+u.x&&(y=!y)}return y}function Gc(r,e){let s=!1;for(let u=0,m=r.length-1;u<r.length;m=u++){const y=r[u],x=r[m];y.y>e.y!=x.y>e.y&&e.x<(x.x-y.x)*(e.y-y.y)/(x.y-y.y)+y.x&&(s=!s)}return s}function cg(r,e,s,u,m){for(const x of r)if(e<=x.x&&s<=x.y&&u>=x.x&&m>=x.y)return!0;const y=[new Ne(e,s),new Ne(e,m),new Ne(u,m),new Ne(u,s)];if(r.length>2)for(const x of y)if(Gc(r,x))return!0;for(let x=0;x<r.length-1;x++)if($v(r[x],r[x+1],y))return!0;return!1}function $v(r,e,s){const u=s[0],m=s[2];if(r.x<u.x&&e.x<u.x||r.x>m.x&&e.x>m.x||r.y<u.y&&e.y<u.y||r.y>m.y&&e.y>m.y)return!1;const y=Vi(r,e,s[0]);return y!==Vi(r,e,s[1])||y!==Vi(r,e,s[2])||y!==Vi(r,e,s[3])}function tc(r,e,s){const u=e.paint.get(r).value;return"constant"===u.kind?u.value:s.programConfigurations.get(e.id).getMaxValue(r)}function qd(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Wc(r,e,s,u,m){if(!e[0]&&!e[1])return r;const y=Ne.convert(e)._mult(m);"viewport"===s&&y._rotate(-u);const x=[];for(let D=0;D<r.length;D++)x.push(r[D].sub(y));return x}function Yd(r,e,s,u){const m=Ne.convert(r)._mult(u);return"viewport"===e&&m._rotate(-s),m}dn(Vu,"CircleBucket",{omit:["layers"]});const ug=new pe({"circle-sort-key":new oe(lt.layout_circle["circle-sort-key"])});var Xd={paint:new pe({"circle-radius":new oe(lt.paint_circle["circle-radius"]),"circle-color":new oe(lt.paint_circle["circle-color"]),"circle-blur":new oe(lt.paint_circle["circle-blur"]),"circle-opacity":new oe(lt.paint_circle["circle-opacity"]),"circle-translate":new X(lt.paint_circle["circle-translate"]),"circle-translate-anchor":new X(lt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new X(lt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new X(lt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new oe(lt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new oe(lt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new oe(lt.paint_circle["circle-stroke-opacity"])}),layout:ug};function Z_(r,e,s,u,m,y,x,D,S){if(y&&r.queryGeometry.isAboveHorizon)return!1;y&&(S*=r.pixelToTileUnitsFactor);const P=r.tileID.canonical,F=s.projection.upVectorScale(P,s.center.lat,s.worldSize).metersToTile;for(const z of e)for(const U of z){const H=U.add(D),G=m&&s.elevation?s.elevation.exaggeration()*m.getElevationAt(H.x,H.y,!0):0,K=s.projection.projectTilePoint(H.x,H.y,P);if(G>0){const de=s.projection.upVector(P,H.x,H.y);K.x+=de[0]*F*G,K.y+=de[1]*F*G,K.z+=de[2]*F*G}const re=y?H:dg(K.x,K.y,K.z,u),he=y?r.tilespaceRays.map(de=>Ap(de,G)):r.queryGeometry.screenGeometry,be=Vc([],[K.x,K.y,K.z,1],u);if(!x&&y?S*=be[3]/s.cameraToCenterDistance:x&&!y&&(S*=s.cameraToCenterDistance/be[3]),y){const de=io((U.y/mn+P.y)/(1<<P.z));S/=s.projection.pixelsPerMeter(de,1)/$o(1,de)}if(af(he,re,S))return!0}return!1}function dg(r,e,s,u){const m=Vc([],[r,e,s,1],u);return new Ne(m[0]/m[3],m[1]/m[3])}const Hv=zd(0,0,0),hg=zd(0,0,1);function Ap(r,e){const s=_p();return Hv[2]=e,r.intersectsPlane(Hv,hg,s),new Ne(s[0],s[1])}class q_ extends Vu{}function Uu(r,{width:e,height:s},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==e*s*u)throw new RangeError("mismatched image size")}else m=new Uint8Array(e*s*u);return r.width=e,r.height=s,r.data=m,r}function cf(r,e,s){const{width:u,height:m}=e;u===r.width&&m===r.height||(uf(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,u),height:Math.min(r.height,m)},s),r.width=u,r.height=m,r.data=e.data)}function uf(r,e,s,u,m,y){if(0===m.width||0===m.height)return e;if(m.width>r.width||m.height>r.height||s.x>r.width-m.width||s.y>r.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>e.width||m.height>e.height||u.x>e.width-m.width||u.y>e.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const x=r.data,D=e.data;for(let S=0;S<m.height;S++){const P=((s.y+S)*r.width+s.x)*y,F=((u.y+S)*e.width+u.x)*y;for(let z=0;z<m.width*y;z++)D[F+z]=x[P+z]}return e}dn(q_,"HeatmapBucket",{omit:["layers"]});class ta{constructor(e,s){Uu(this,e,1,s)}resize(e){cf(this,new ta(e),1)}clone(){return new ta({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,u,m,y){uf(e,s,u,m,y,1)}}class gs{constructor(e,s){Uu(this,e,4,s)}resize(e){cf(this,new gs(e),4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new gs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,u,m,y){uf(e,s,u,m,y,4)}}dn(ta,"AlphaImage"),dn(gs,"RGBAImage");var Y_={paint:new pe({"heatmap-radius":new oe(lt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new oe(lt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new X(lt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fe(lt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new X(lt.paint_heatmap["heatmap-opacity"])})};function Pp(r){const e={},s=r.resolution||256,u=r.clips?r.clips.length:1,m=r.image||new gs({width:s,height:u}),y=(x,D,S)=>{e[r.evaluationKey]=S;const P=r.expression.evaluate(e);m.data[x+D+0]=Math.floor(255*P.r/P.a),m.data[x+D+1]=Math.floor(255*P.g/P.a),m.data[x+D+2]=Math.floor(255*P.b/P.a),m.data[x+D+3]=Math.floor(255*P.a)};if(r.clips)for(let x=0,D=0;x<u;++x,D+=4*s)for(let S=0,P=0;S<s;S++,P+=4){const F=S/(s-1),{start:z,end:U}=r.clips[x];y(D,P,z*(1-F)+U*F)}else for(let x=0,D=0;x<s;x++,D+=4)y(0,D,x/(s-1));return m}var Gv={paint:new pe({"hillshade-illumination-direction":new X(lt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new X(lt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new X(lt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new X(lt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new X(lt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new X(lt.paint_hillshade["hillshade-accent-color"])})};const Wv=Oe([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zv}=Wv;var Rp={exports:{}};function fg(r,e,s){s=s||2;var u,m,y,x,D,S,P,F=e&&e.length,z=F?e[0]*s:r.length,U=Dl(r,0,z,s,!0),H=[];if(!U||U.next===U.prev)return H;if(F&&(U=function(K,re,he,be){var de,ve,we,Ee=[];for(de=0,ve=re.length;de<ve;de++)(we=Dl(K,re[de]*be,de<ve-1?re[de+1]*be:K.length,be,!1))===we.next&&(we.steiner=!0),Ee.push(gg(we));for(Ee.sort(Eb),de=0;de<Ee.length;de++)he=pg(Ee[de],he);return he}(r,e,U,s)),r.length>80*s){u=y=r[0],m=x=r[1];for(var G=s;G<z;G+=s)(D=r[G])<u&&(u=D),(S=r[G+1])<m&&(m=S),D>y&&(y=D),S>x&&(x=S);P=0!==(P=Math.max(y-u,x-m))?32767/P:0}return df(U,H,s,u,m,P,0),H}function Dl(r,e,s,u,m){var y,x;if(m===Jd(r,e,s,u)>0)for(y=e;y<s;y+=u)x=Fp(y,r[y],r[y+1],x);else for(y=s-u;y>=e;y-=u)x=Fp(y,r[y],r[y+1],x);return x&&nc(x,x.next)&&(ju(x),x=x.next),x}function ba(r,e){if(!r)return r;e||(e=r);var s,u=r;do{if(s=!1,u.steiner||!nc(u,u.next)&&0!==Oi(u.prev,u,u.next))u=u.next;else{if(ju(u),(u=e=u.prev)===u.next)break;s=!0}}while(s||u!==e);return e}function df(r,e,s,u,m,y,x){if(r){!x&&y&&function(F,z,U,H){var G=F;do{0===G.z&&(G.z=Zc(G.x,G.y,z,U,H)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next}while(G!==F);G.prevZ.nextZ=null,G.prevZ=null,function(K){var re,he,be,de,ve,we,Ee,Je,Ke=1;do{for(he=K,K=null,ve=null,we=0;he;){for(we++,be=he,Ee=0,re=0;re<Ke&&(Ee++,be=be.nextZ);re++);for(Je=Ke;Ee>0||Je>0&&be;)0!==Ee&&(0===Je||!be||he.z<=be.z)?(de=he,he=he.nextZ,Ee--):(de=be,be=be.nextZ,Je--),ve?ve.nextZ=de:K=de,de.prevZ=ve,ve=de;he=be}ve.nextZ=null,Ke*=2}while(we>1)}(G)}(r,u,m,y);for(var D,S,P=r;r.prev!==r.next;)if(D=r.prev,S=r.next,y?bb(r,u,m,y):vb(r))e.push(D.i/s|0),e.push(r.i/s|0),e.push(S.i/s|0),ju(r),r=S.next,P=S.next;else if((r=S)===P){x?1===x?df(r=xb(ba(r),e,s),e,s,u,m,y,2):2===x&&wb(r,e,s,u,m,y):df(ba(r),e,s,u,m,y,1);break}}}function vb(r){var e=r.prev,s=r,u=r.next;if(Oi(e,s,u)>=0)return!1;for(var m=e.x,y=s.x,x=u.x,D=e.y,S=s.y,P=u.y,F=m<y?m<x?m:x:y<x?y:x,z=D<S?D<P?D:P:S<P?S:P,U=m>y?m>x?m:x:y>x?y:x,H=D>S?D>P?D:P:S>P?S:P,G=u.next;G!==e;){if(G.x>=F&&G.x<=U&&G.y>=z&&G.y<=H&&Kd(m,D,y,S,x,P,G.x,G.y)&&Oi(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function bb(r,e,s,u){var m=r.prev,y=r,x=r.next;if(Oi(m,y,x)>=0)return!1;for(var D=m.x,S=y.x,P=x.x,F=m.y,z=y.y,U=x.y,H=D<S?D<P?D:P:S<P?S:P,G=F<z?F<U?F:U:z<U?z:U,K=D>S?D>P?D:P:S>P?S:P,re=F>z?F>U?F:U:z>U?z:U,he=Zc(H,G,e,s,u),be=Zc(K,re,e,s,u),de=r.prevZ,ve=r.nextZ;de&&de.z>=he&&ve&&ve.z<=be;){if(de.x>=H&&de.x<=K&&de.y>=G&&de.y<=re&&de!==m&&de!==x&&Kd(D,F,S,z,P,U,de.x,de.y)&&Oi(de.prev,de,de.next)>=0||(de=de.prevZ,ve.x>=H&&ve.x<=K&&ve.y>=G&&ve.y<=re&&ve!==m&&ve!==x&&Kd(D,F,S,z,P,U,ve.x,ve.y)&&Oi(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;de&&de.z>=he;){if(de.x>=H&&de.x<=K&&de.y>=G&&de.y<=re&&de!==m&&de!==x&&Kd(D,F,S,z,P,U,de.x,de.y)&&Oi(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;ve&&ve.z<=be;){if(ve.x>=H&&ve.x<=K&&ve.y>=G&&ve.y<=re&&ve!==m&&ve!==x&&Kd(D,F,S,z,P,U,ve.x,ve.y)&&Oi(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function xb(r,e,s){var u=r;do{var m=u.prev,y=u.next.next;!nc(m,y)&&kp(m,u,u.next,y)&&Lp(m,y)&&Lp(y,m)&&(e.push(m.i/s|0),e.push(u.i/s|0),e.push(y.i/s|0),ju(u),ju(u.next),u=r=y),u=u.next}while(u!==r);return ba(u)}function wb(r,e,s,u,m,y){var x=r;do{for(var D=x.next.next;D!==x.prev;){if(x.i!==D.i&&Op(x,D)){var S=qv(x,D);return x=ba(x,x.next),S=ba(S,S.next),df(x,e,s,u,m,y,0),void df(S,e,s,u,m,y,0)}D=D.next}x=x.next}while(x!==r)}function Eb(r,e){return r.x-e.x}function pg(r,e){var s=function(m,y){var x,D=y,S=m.x,P=m.y,F=-1/0;do{if(P<=D.y&&P>=D.next.y&&D.next.y!==D.y){var z=D.x+(P-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(z<=S&&z>F&&(F=z,x=D.x<D.next.x?D:D.next,z===S))return x}D=D.next}while(D!==y);if(!x)return null;var U,H=x,G=x.x,K=x.y,re=1/0;D=x;do{S>=D.x&&D.x>=G&&S!==D.x&&Kd(P<K?S:F,P,G,K,P<K?F:S,P,D.x,D.y)&&(U=Math.abs(P-D.y)/(S-D.x),Lp(D,m)&&(U<re||U===re&&(D.x>x.x||D.x===x.x&&mg(x,D)))&&(x=D,re=U)),D=D.next}while(D!==H);return x}(r,e);if(!s)return e;var u=qv(s,r);return ba(u,u.next),ba(s,s.next)}function mg(r,e){return Oi(r.prev,r,e.prev)<0&&Oi(e.next,r,r.next)<0}function Zc(r,e,s,u,m){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-s)*m|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*m|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function gg(r){var e=r,s=r;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==r);return s}function Kd(r,e,s,u,m,y,x,D){return(m-x)*(e-D)>=(r-x)*(y-D)&&(r-x)*(u-D)>=(s-x)*(e-D)&&(s-x)*(y-D)>=(m-x)*(u-D)}function Op(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(s,u){var m=s;do{if(m.i!==s.i&&m.next.i!==s.i&&m.i!==u.i&&m.next.i!==u.i&&kp(m,m.next,s,u))return!0;m=m.next}while(m!==s);return!1}(r,e)&&(Lp(r,e)&&Lp(e,r)&&function(s,u){var m=s,y=!1,x=(s.x+u.x)/2,D=(s.y+u.y)/2;do{m.y>D!=m.next.y>D&&m.next.y!==m.y&&x<(m.next.x-m.x)*(D-m.y)/(m.next.y-m.y)+m.x&&(y=!y),m=m.next}while(m!==s);return y}(r,e)&&(Oi(r.prev,r,e.prev)||Oi(r,e.prev,e))||nc(r,e)&&Oi(r.prev,r,r.next)>0&&Oi(e.prev,e,e.next)>0)}function Oi(r,e,s){return(e.y-r.y)*(s.x-e.x)-(e.x-r.x)*(s.y-e.y)}function nc(r,e){return r.x===e.x&&r.y===e.y}function kp(r,e,s,u){var m=ff(Oi(r,e,s)),y=ff(Oi(r,e,u)),x=ff(Oi(s,u,r)),D=ff(Oi(s,u,e));return m!==y&&x!==D||!(0!==m||!hf(r,s,e))||!(0!==y||!hf(r,u,e))||!(0!==x||!hf(s,r,u))||!(0!==D||!hf(s,e,u))}function hf(r,e,s){return e.x<=Math.max(r.x,s.x)&&e.x>=Math.min(r.x,s.x)&&e.y<=Math.max(r.y,s.y)&&e.y>=Math.min(r.y,s.y)}function ff(r){return r>0?1:r<0?-1:0}function Lp(r,e){return Oi(r.prev,r,r.next)<0?Oi(r,e,r.next)>=0&&Oi(r,r.prev,e)>=0:Oi(r,e,r.prev)<0||Oi(r,r.next,e)<0}function qv(r,e){var s=new pf(r.i,r.x,r.y),u=new pf(e.i,e.x,e.y),m=r.next,y=e.prev;return r.next=e,e.prev=r,s.next=m,m.prev=s,u.next=s,s.prev=u,y.next=u,u.prev=y,u}function Fp(r,e,s,u){var m=new pf(r,e,s);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function ju(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function pf(r,e,s){this.i=r,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Jd(r,e,s,u){for(var m=0,y=e,x=s-u;y<s;y+=u)m+=(r[x]-r[y])*(r[y+1]+r[x+1]),x=y;return m}Rp.exports=fg,Rp.exports.default=fg,fg.deviation=function(r,e,s,u){var m=e&&e.length,y=Math.abs(Jd(r,0,m?e[0]*s:r.length,s));if(m)for(var x=0,D=e.length;x<D;x++)y-=Math.abs(Jd(r,e[x]*s,x<D-1?e[x+1]*s:r.length,s));var S=0;for(x=0;x<u.length;x+=3){var P=u[x]*s,F=u[x+1]*s,z=u[x+2]*s;S+=Math.abs((r[P]-r[z])*(r[F+1]-r[P+1])-(r[P]-r[F])*(r[z+1]-r[P+1]))}return 0===y&&0===S?0:Math.abs((S-y)/y)},fg.flatten=function(r){for(var e=r[0][0].length,s={vertices:[],holes:[],dimensions:e},u=0,m=0;m<r.length;m++){for(var y=0;y<r[m].length;y++)for(var x=0;x<e;x++)s.vertices.push(r[m][y][x]);m>0&&s.holes.push(u+=r[m-1].length)}return s};var _g=Pt(Rp.exports);function X_(r,e,s,u,m){K_(r,e,s||0,u||r.length-1,m||Yv)}function K_(r,e,s,u,m){for(;u>s;){if(u-s>600){var y=u-s+1,x=e-s+1,D=Math.log(y),S=.5*Math.exp(2*D/3),P=.5*Math.sqrt(D*S*(y-S)/y)*(x-y/2<0?-1:1);K_(r,e,Math.max(s,Math.floor(e-x*S/y+P)),Math.min(u,Math.floor(e+(y-x)*S/y+P)),m)}var F=r[e],z=s,U=u;for(mf(r,s,e),m(r[u],F)>0&&mf(r,s,u);z<U;){for(mf(r,z,U),z++,U--;m(r[z],F)<0;)z++;for(;m(r[U],F)>0;)U--}0===m(r[s],F)?mf(r,s,U):mf(r,++U,u),U<=e&&(s=U+1),e<=U&&(u=U-1)}}function mf(r,e,s){var u=r[e];r[e]=r[s],r[s]=u}function Yv(r,e){return r<e?-1:r>e?1:0}function lo(r,e){const s=r.length;if(s<=1)return[r];const u=[];let m,y;for(let x=0;x<s;x++){const D=Xr(r[x]);0!==D&&(r[x].area=Math.abs(D),void 0===y&&(y=D<0),y===D<0?(m&&u.push(m),m=[r[x]]):m.push(r[x]))}if(m&&u.push(m),e>1)for(let x=0;x<u.length;x++)u[x].length<=e||(X_(u[x],e,1,u[x].length-1,J_),u[x]=u[x].slice(0,e));return u}function J_(r,e){return e.area-r.area}function $u(r,e,s){const u=s.patternDependencies;let m=!1;for(const y of e){const x=y.paint.get(`${r}-pattern`);x.isConstant()||(m=!0);const D=x.constantOr(null);D&&(m=!0,u[D]=!0)}return m}function Qd(r,e,s,u,m){const y=m.patternDependencies;for(const x of e){const D=x.paint.get(`${r}-pattern`).value;if("constant"!==D.kind){let S=D.evaluate({zoom:u},s,{},m.availableImages);S=S&&S.name?S.name:S,y[S]=!0,s.patterns[x.id]=S}}return s}class eh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new At,this.indexArray=new an,this.indexArray2=new $r,this.programConfigurations=new Xl(e.layers,e.zoom),this.segments=new Ar,this.segments2=new Ar,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=e.projection}populate(e,s,u,m){this.hasPattern=$u("fill",this.layers,s);const y=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:D,id:S,index:P,sourceLayerIndex:F}of e){const z=this.layers[0]._featureFilter.needGeometry,U=Bu(D,z);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),U,u))continue;const H=y?y.evaluate(U,{},u,s.availableImages):void 0,G={id:S,properties:D.properties,type:D.type,sourceLayerIndex:F,index:P,geometry:z?U.geometry:El(D,u,m),patterns:{},sortKey:H};x.push(G)}y&&x.sort((D,S)=>D.sortKey-S.sortKey);for(const D of x){const{geometry:S,index:P,sourceLayerIndex:F}=D;if(this.hasPattern){const z=Qd("fill",this.layers,D,this.zoom,s);this.patternFeatures.push(z)}else this.addFeature(D,S,P,u,{},s.availableImages);s.featureIndex.insert(e[P].feature,S,P,F,this.index)}}update(e,s,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,u,m)}addFeatures(e,s,u,m,y){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,u,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zv),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,u,m,y,x=[]){for(const D of lo(s,500)){let S=0;for(const G of D)S+=G.length;const P=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray),F=P.vertexLength,z=[],U=[];for(const G of D){if(0===G.length)continue;G!==D[0]&&U.push(z.length/2);const K=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),re=K.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(re+G.length-1,re),z.push(G[0].x),z.push(G[0].y);for(let he=1;he<G.length;he++)this.layoutVertexArray.emplaceBack(G[he].x,G[he].y),this.indexArray2.emplaceBack(re+he-1,re+he),z.push(G[he].x),z.push(G[he].y);K.vertexLength+=G.length,K.primitiveLength+=G.length}const H=_g(z,U);for(let G=0;G<H.length;G+=3)this.indexArray.emplaceBack(F+H[G],F+H[G+1],F+H[G+2]);P.vertexLength+=S,P.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,y,x,m)}}dn(eh,"FillBucket",{omit:["layers","patternFeatures"]});const Xv=new pe({"fill-sort-key":new oe(lt.layout_fill["fill-sort-key"])});var Hu={paint:new pe({"fill-antialias":new X(lt.paint_fill["fill-antialias"]),"fill-opacity":new oe(lt.paint_fill["fill-opacity"]),"fill-color":new oe(lt.paint_fill["fill-color"]),"fill-outline-color":new oe(lt.paint_fill["fill-outline-color"]),"fill-translate":new X(lt.paint_fill["fill-translate"]),"fill-translate-anchor":new X(lt.paint_fill["fill-translate-anchor"]),"fill-pattern":new oe(lt.paint_fill["fill-pattern"])}),layout:Xv};const Cb=Oe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Db=Oe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),yg=Oe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Np}=Cb;var gf={},Tb=pn,vg=ks;function ks(r,e,s,u,m){this.properties={},this.extent=s,this.type=0,this._pbf=r,this._geometry=-1,this._keys=u,this._values=m,r.readFields(Q_,this,e)}function Q_(r,e,s){1==r?e.id=s.readVarint():2==r?function(u,m){for(var y=u.readVarint()+u.pos;u.pos<y;){var x=m._keys[u.readVarint()],D=m._values[u.readVarint()];m.properties[x]=D}}(s,e):3==r?e.type=s.readVarint():4==r&&(e._geometry=s.pos)}function u1(r){for(var e,s,u=0,m=0,y=r.length,x=y-1;m<y;x=m++)u+=((s=r[x]).x-(e=r[m]).x)*(e.y+s.y);return u}ks.types=["Unknown","Point","LineString","Polygon"],ks.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,s=r.readVarint()+r.pos,u=1,m=0,y=0,x=0,D=[];r.pos<s;){if(m<=0){var S=r.readVarint();u=7&S,m=S>>3}if(m--,1===u||2===u)y+=r.readSVarint(),x+=r.readSVarint(),1===u&&(e&&D.push(e),e=[]),e.push(new Tb(y,x));else{if(7!==u)throw new Error("unknown command "+u);e&&e.push(e[0].clone())}}return e&&D.push(e),D},ks.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,s=1,u=0,m=0,y=0,x=1/0,D=-1/0,S=1/0,P=-1/0;r.pos<e;){if(u<=0){var F=r.readVarint();s=7&F,u=F>>3}if(u--,1===s||2===s)(m+=r.readSVarint())<x&&(x=m),m>D&&(D=m),(y+=r.readSVarint())<S&&(S=y),y>P&&(P=y);else if(7!==s)throw new Error("unknown command "+s)}return[x,S,D,P]},ks.prototype.toGeoJSON=function(r,e,s){var u,m,y=this.extent*Math.pow(2,s),x=this.extent*r,D=this.extent*e,S=this.loadGeometry(),P=ks.types[this.type];function F(H){for(var G=0;G<H.length;G++){var K=H[G];H[G]=[360*(K.x+x)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+D)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(u=0;u<S.length;u++)z[u]=S[u][0];F(S=z);break;case 2:for(u=0;u<S.length;u++)F(S[u]);break;case 3:for(S=function(H){var G=H.length;if(G<=1)return[H];for(var K,re,he=[],be=0;be<G;be++){var de=u1(H[be]);0!==de&&(void 0===re&&(re=de<0),re===de<0?(K&&he.push(K),K=[H[be]]):K.push(H[be]))}return K&&he.push(K),he}(S),u=0;u<S.length;u++)for(m=0;m<S[u].length;m++)F(S[u][m])}1===S.length?S=S[0]:P="Multi"+P;var U={type:"Feature",geometry:{type:P,coordinates:S},properties:this.properties};return"id"in this&&(U.id=this.id),U};var d1=vg,_f=Fi;function Fi(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(th,this,e),this.length=this._features.length}function th(r,e,s){15===r?e.version=s.readVarint():1===r?e.name=s.readString():5===r?e.extent=s.readVarint():2===r?e._features.push(s.pos):3===r?e._keys.push(s.readString()):4===r&&e._values.push(function(u){for(var m=null,y=u.readVarint()+u.pos;u.pos<y;){var x=u.readVarint()>>3;m=1===x?u.readString():2===x?u.readFloat():3===x?u.readDouble():4===x?u.readVarint64():5===x?u.readVarint():6===x?u.readSVarint():7===x?u.readBoolean():null}return m}(s))}Fi.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new d1(this._pbf,e,this.extent,this._keys,this._values)};var Bp=_f;function ey(r,e,s){if(3===r){var u=new Bp(s,s.readVarint()+s.pos);u.length&&(e[u.name]=u)}}var yf=gf.VectorTile=function(r,e){this.layers=r.readFields(ey,{},e)},vf=gf.VectorTileFeature=vg;function bf(r,e,s,u){const m=[],y=0===u?(x,D,S,P,F,z)=>{x.push(new Ne(z,S+(z-D)/(P-D)*(F-S)))}:(x,D,S,P,F,z)=>{x.push(new Ne(D+(z-S)/(F-S)*(P-D),z))};for(const x of r){const D=[];for(const S of x){if(S.length<=2)continue;const P=[];for(let U=0;U<S.length-1;U++){const H=S[U].x,G=S[U].y,K=S[U+1].x,re=S[U+1].y,he=0===u?H:G,be=0===u?K:re;he<e?be>e&&y(P,H,G,K,re,e):he>s?be<s&&y(P,H,G,K,re,s):P.push(S[U]),be<e&&he>=e&&y(P,H,G,K,re,e),be>s&&he<=s&&y(P,H,G,K,re,s)}let F=S[S.length-1];const z=0===u?F.x:F.y;z>=e&&z<=s&&P.push(F),P.length&&(F=P[P.length-1],P[0].x===F.x&&P[0].y===F.y||P.push(P[0]),D.push(P))}D.length&&m.push(D)}return m}gf.VectorTileLayer=_f;const ty=vf.types,Kv=Math.pow(2,13);function Gu(r,e,s,u,m,y,x,D){r.emplaceBack((e<<1)+x,(s<<1)+y,(Math.floor(u*Kv)<<1)+m,Math.round(D))}function bg(r,e,s){r.emplaceBack(e.x,e.y,e.z,16384*s[0],16384*s[1],16384*s[2])}class zp{constructor(){this.acc=new Ne(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ne(e.x,e.y),this.max=new Ne(e.x,e.y))}append(e,s){this.currentPolyCount.edges++,this.acc._add(e);const u=this.min,m=this.max;e.x<u.x?u.x=e.x:e.x>m.x&&(m.x=e.x),e.y<u.y?u.y=e.y:e.y>m.y&&(m.y=e.y),((0===e.x||e.x===mn)&&e.x===s.x)!=((0===e.y||e.y===mn)&&e.y===s.y)&&this.processBorderOverlap(e,s),s.x<0!=e.x<0&&this.addBorderIntersection(0,wi(s.y,e.y,(0-s.x)/(e.x-s.x))),s.x>mn!=e.x>mn&&this.addBorderIntersection(1,wi(s.y,e.y,(mn-s.x)/(e.x-s.x))),s.y<0!=e.y<0&&this.addBorderIntersection(2,wi(s.x,e.x,(0-s.y)/(e.y-s.y))),s.y>mn!=e.y>mn&&this.addBorderIntersection(3,wi(s.x,e.x,(mn-s.y)/(e.y-s.y)))}addBorderIntersection(e,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[e];s<u[0]&&(u[0]=s),s>u[1]&&(u[1]=s)}processBorderOverlap(e,s){if(e.x===s.x){if(e.y===s.y)return;const u=0===e.x?0:1;this.addBorderIntersection(u,s.y),this.addBorderIntersection(u,e.y)}else{const u=0===e.y?2:3;this.addBorderIntersection(u,s.x),this.addBorderIntersection(u,e.x)}}centroid(){const e=this.polyCount.reduce((s,u)=>s+u.edges,0);return 0!==e?this.acc.div(e)._round():new Ne(0,0)}span(){return new Ne(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,s)=>e+ +(s[0]!==Number.MAX_VALUE),0)}}class Vp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new ht,this.centroidVertexArray=new Ua,this.indexArray=new an,this.programConfigurations=new Xl(e.layers,e.zoom),this.segments=new Ar,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=e.enableTerrain}populate(e,s,u,m){this.features=[],this.hasPattern=$u("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(y){const x=Math.exp(Math.PI*(1-y.y/(1<<y.z)*2));return 80150034*x/(x*x+1)/mn/(1<<y.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:y,id:x,index:D,sourceLayerIndex:S}of e){const P=this.layers[0]._featureFilter.needGeometry,F=Bu(y,P);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),F,u))continue;const z={id:x,sourceLayerIndex:S,index:D,geometry:P?F.geometry:El(y,u,m),properties:y.properties,type:y.type,patterns:{}},U=this.layoutVertexArray.length;this.hasPattern?this.features.push(Qd("fill-extrusion",this.layers,z,this.zoom,s)):this.addFeature(z,z.geometry,D,u,{},s.availableImages,m),s.featureIndex.insert(y,z.geometry,D,S,this.index,U)}this.sortBorders()}addFeatures(e,s,u,m,y){for(const x of this.features){const{geometry:D}=x;this.addFeature(x,D,x.index,s,u,m,y)}this.sortBorders()}update(e,s,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,u,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Np),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,yg.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Db.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,u,m,y,x,D){const S=[new Ne(0,0),new Ne(mn,mn)],P=D.projection,F="globe"===P.name,z=this.enableTerrain&&!F?new zp:null,U="Polygon"===ty[e.type];F&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Lt);const H=lo(s,500);for(let he=H.length-1;he>=0;he--){const be=H[he];(0===be.length||(G=be[0]).every(de=>de.x<=0)||G.every(de=>de.x>=mn)||G.every(de=>de.y<=0)||G.every(de=>de.y>=mn))&&H.splice(he,1)}var G;let K;if(F)K=ry(H,S,m);else{K=[];for(const he of H)K.push({polygon:he,bounds:S})}const re=U?this.edgeRadius:0;for(const{polygon:he,bounds:be}of K){let de=0,ve=0;for(const Ee of he)U&&!Ee[0].equals(Ee[Ee.length-1])&&Ee.push(Ee[0]),ve+=U?Ee.length-1:Ee.length;const we=this.segments.prepareSegment((U?5:4)*ve,this.layoutVertexArray,this.indexArray);if(U){const Ee=[],Je=[];de=we.vertexLength;for(const dt of he){let Ot,rt;dt.length&&dt!==he[0]&&Je.push(Ee.length/2),Ot=dt[1].sub(dt[0])._perp()._unit();for(let vt=1;vt<dt.length;vt++){const yt=dt[vt],Mt=dt[vt===dt.length-1?1:vt+1];let{x:Rt,y:at}=yt;if(re){rt=Mt.sub(yt)._perp()._unit();const Ht=Ot.add(rt)._unit(),rn=re*Math.min(4,1/(Ot.x*Ht.x+Ot.y*Ht.y));Rt+=rn*Ht.x,at+=rn*Ht.y,Ot=rt}Gu(this.layoutVertexArray,Rt,at,0,0,1,1,0),we.vertexLength++,Ee.push(yt.x,yt.y),F&&bg(this.layoutVertexExtArray,P.projectTilePoint(Rt,at,m),P.upVector(m,Rt,at))}}const Ke=_g(Ee,Je);for(let dt=0;dt<Ke.length;dt+=3)this.indexArray.emplaceBack(de+Ke[dt],de+Ke[dt+2],de+Ke[dt+1]),we.primitiveLength++}for(const Ee of he){z&&Ee.length&&z.startRing(Ee[0]);let Je,Ke,dt,Ot=Ee.length>4&&iy(Ee[Ee.length-2],Ee[0],Ee[1]),rt=re?ny(Ee[Ee.length-2],Ee[0],Ee[1],re):0;Ke=Ee[1].sub(Ee[0])._perp()._unit();let vt=!0;for(let yt=1,Mt=0;yt<Ee.length;yt++){let Rt=Ee[yt-1],at=Ee[yt];const Ht=Ee[yt===Ee.length-1?1:yt+1];if(z&&U&&z.currentPolyCount.top++,Tl(at,Rt,be)){re&&(Ke=Ht.sub(at)._perp()._unit(),vt=!vt);continue}z&&z.append(at,Rt);const rn=at.sub(Rt)._perp(),Kt=rn.x/(Math.abs(rn.x)+Math.abs(rn.y)),Sn=rn.y>0?1:0,Ut=Rt.dist(at);if(Mt+Ut>32768&&(Mt=0),re){dt=Ht.sub(at)._perp()._unit();let Vn=xg(Rt,at,Ht,xf(Ke,dt),re);isNaN(Vn)&&(Vn=0);const wn=at.sub(Rt)._unit();Rt=Rt.add(wn.mult(rt))._round(),at=at.add(wn.mult(-Vn))._round(),rt=Vn,Ke=dt}const gn=we.vertexLength,$n=Ee.length>4&&iy(Rt,at,Ht);let di=Up(Mt,Ot,vt);if(Gu(this.layoutVertexArray,Rt.x,Rt.y,Kt,Sn,0,0,di),Gu(this.layoutVertexArray,Rt.x,Rt.y,Kt,Sn,0,1,di),Mt+=Ut,di=Up(Mt,$n,!vt),Ot=$n,Gu(this.layoutVertexArray,at.x,at.y,Kt,Sn,0,0,di),Gu(this.layoutVertexArray,at.x,at.y,Kt,Sn,0,1,di),we.vertexLength+=4,this.indexArray.emplaceBack(gn+0,gn+1,gn+2),this.indexArray.emplaceBack(gn+1,gn+3,gn+2),we.primitiveLength+=2,re){const Vn=de+(1===yt?Ee.length-2:yt-2),wn=1===yt?de:Vn+1;if(this.indexArray.emplaceBack(gn+1,Vn,gn+3),this.indexArray.emplaceBack(Vn,wn,gn+3),we.primitiveLength+=2,void 0===Je&&(Je=gn),!Tl(Ht,Ee[yt],be)){const Si=yt===Ee.length-1?Je:we.vertexLength;this.indexArray.emplaceBack(gn+2,gn+3,Si),this.indexArray.emplaceBack(gn+3,Si+1,Si),this.indexArray.emplaceBack(gn+3,wn,Si+1),we.primitiveLength+=3}vt=!vt}if(F){const Vn=this.layoutVertexExtArray,wn=P.projectTilePoint(Rt.x,Rt.y,m),Si=P.projectTilePoint(at.x,at.y,m),In=P.upVector(m,Rt.x,Rt.y),Hn=P.upVector(m,at.x,at.y);bg(Vn,wn,In),bg(Vn,wn,In),bg(Vn,Si,Hn),bg(Vn,Si,Hn)}}U&&(de+=Ee.length-1)}}if(z&&z.polyCount.length>0){if(z.borders){z.vertexArrayOffset=this.centroidVertexArray.length;const he=z.borders,be=this.featuresOnBorder.push(z)-1;for(let de=0;de<4;de++)he[de][0]!==Number.MAX_VALUE&&this.borders[de].push(be)}this.encodeCentroid(z.borders?void 0:z.centroid(),z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,y,x,m)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((s,u)=>this.featuresOnBorder[s].borders[e][0]-this.featuresOnBorder[u].borders[e][0])}encodeCentroid(e,s,u=!0){let m,y;if(e)if(0!==e.y){const D=s.span()._mult(this.tileToMeter);m=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(D.x/10)),y=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(D.y/10))}else m=Math.ceil(7*(e.x+450)),y=0;else m=0,y=+u;let x=u?this.centroidVertexArray.length:s.vertexArrayOffset;for(const D of s.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*D.edges+D.top);for(let S=0;S<D.top;S++)this.centroidVertexArray.emplace(x++,m,y);for(let S=0;S<2*D.edges;S++)this.centroidVertexArray.emplace(x++,0,y),this.centroidVertexArray.emplace(x++,m,y)}}}function xf(r,e){const s=r.add(e)._unit();return r.x*s.x+r.y*s.y}function ny(r,e,s,u){const m=e.sub(r)._perp()._unit(),y=s.sub(e)._perp()._unit();return xg(r,e,s,xf(m,y),u)}function xg(r,e,s,u,m){const y=Math.sqrt(1-u*u);return Math.min(r.dist(e)/3,e.dist(s)/3,m*y/u)}function Tl(r,e,s){return r.x<s[0].x&&e.x<s[0].x||r.x>s[1].x&&e.x>s[1].x||r.y<s[0].y&&e.y<s[0].y||r.y>s[1].y&&e.y>s[1].y}function iy(r,e,s){if(r.x<0||r.x>=mn||e.x<0||e.x>=mn||s.x<0||s.x>=mn)return!1;const u=s.sub(e),m=u.perp(),y=r.sub(e);return(u.x*y.x+u.y*y.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(y.x*y.x+y.y*y.y))>-.866&&m.x*y.x+m.y*y.y<0}function Up(r,e,s){const u=e?2|r:-3&r;return s?1|u:-2&u}function wf(){const r=Math.PI/32,e=Math.tan(r),s=ps;return s*Math.sqrt(1+2*e*e)-s}function ry(r,e,s){const u=1<<s.z,m=ms(s.x/u),y=ms((s.x+1)/u),x=io(s.y/u),D=io((s.y+1)/u);return function(S,P,F,z,U=0,H){const G=[];if(!S.length||!F||!z)return G;const K=(Ee,Je)=>{for(const Ke of Ee)G.push({polygon:Ke,bounds:Je})},re=Math.ceil(Math.log2(F)),he=Math.ceil(Math.log2(z)),be=re-he,de=[];for(let Ee=0;Ee<Math.abs(be);Ee++)de.push(be>0?0:1);for(let Ee=0;Ee<Math.min(re,he);Ee++)de.push(0),de.push(1);let ve=S;if(ve=bf(ve,P[0].y-U,P[1].y+U,1),ve=bf(ve,P[0].x-U,P[1].x+U,0),!ve.length)return G;const we=[];for(de.length?we.push({polygons:ve,bounds:P,depth:0}):K(ve,P);we.length;){const Ee=we.pop(),Je=Ee.depth,Ke=de[Je],dt=Ee.bounds[0],Ot=Ee.bounds[1],rt=0===Ke?dt.x:dt.y,vt=0===Ke?Ot.x:Ot.y,yt=H?H(Ke,rt,vt):.5*(rt+vt),Mt=bf(Ee.polygons,rt-U,yt+U,Ke),Rt=bf(Ee.polygons,yt-U,vt+U,Ke);if(Mt.length){const at=[dt,new Ne(0===Ke?yt:Ot.x,1===Ke?yt:Ot.y)];de.length>Je+1?we.push({polygons:Mt,bounds:at,depth:Je+1}):K(Mt,at)}if(Rt.length){const at=[new Ne(0===Ke?yt:dt.x,1===Ke?yt:dt.y),Ot];de.length>Je+1?we.push({polygons:Rt,bounds:at,depth:Je+1}):K(Rt,at)}}return G}(r,e,Math.ceil((y-m)/11.25),Math.ceil((x-D)/11.25),1,(S,P,F)=>{if(0===S)return.5*(P+F);{const z=io((s.y+P/mn)/u);return(va(.5*(io((s.y+F/mn)/u)+z))*u-s.y)*mn}})}dn(Vp,"FillExtrusionBucket",{omit:["layers","features"]}),dn(zp,"PartMetadata");const wg=new pe({"fill-extrusion-edge-radius":new X(lt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Ef={paint:new pe({"fill-extrusion-opacity":new X(lt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new oe(lt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new X(lt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new X(lt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new oe(lt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new oe(lt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new oe(lt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new X(lt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new X(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new X(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new X(lt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:wg};function Ja(r,e,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[r*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}class nh{constructor(e,s,u){this.z=e,this.x=s,this.y=u,this.key=jp(0,e,e,s,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s){const u=(x=this.y,D=this.z,S=Ja(256*(y=this.x),256*(x=Math.pow(2,D)-x-1),D),P=Ja(256*(y+1),256*(x+1),D),S[0]+","+S[1]+","+P[0]+","+P[1]),m=function(y,x,D){let S,P="";for(let F=y;F>0;F--)S=1<<F-1,P+=(x&S?1:0)+(D&S?2:0);return P}(this.z,this.x,this.y);var y,x,D,S,P;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Eg{constructor(e,s){this.wrap=e,this.canonical=s,this.key=jp(e,s.z,s.z,s.x,s.y)}}class _s{constructor(e,s,u,m,y){this.overscaledZ=e,this.wrap=s,this.canonical=new nh(u,+m,+y),this.key=0===s&&e===u?this.canonical.key:jp(s,e,u,m,y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const s=this.canonical.z-e;return e>this.canonical.z?new _s(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _s(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s=!0){if(this.overscaledZ===e&&s)return this.key;if(e>this.canonical.z)return jp(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-e;return jp(this.wrap*+s,e,e,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new _s(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new _s(s,this.wrap,s,u,m),new _s(s,this.wrap,s,u+1,m),new _s(s,this.wrap,s,u,m+1),new _s(s,this.wrap,s,u+1,m+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new _s(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new _s(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Eg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function jp(r,e,s,u,m){const y=1<<Math.min(s,22);let x=y*(m%y)+u%y;return r&&s<22&&(x+=y*y*((r<0?-2*r-1:2*r)%(1<<2*(22-s)))),16*(32*x+s)+(e-s)}dn(nh,"CanonicalTileID"),dn(_s,"OverscaledTileID",{omit:["projMatrix"]});class ih extends Ne{constructor(e,s,u){super(e,s),this.z=u}}function ic(r,e){return r.x*e.x+r.y*e.y}function on(r,e){if(1===r.length){let s=0;const u=e[s++];let m;for(;!m||u.equals(m);)if(m=e[s++],!m)return 1/0;for(;s<e.length;s++){const y=e[s],x=r[0],D=m.sub(u),S=y.sub(u),P=x.sub(u),F=ic(D,D),z=ic(D,S),U=ic(S,S),H=ic(P,D),G=ic(P,S),K=F*U-z*z,re=(U*H-z*G)/K,he=(F*G-z*H)/K,be=u.z*(1-re-he)+m.z*re+y.z*he;if(isFinite(be))return be}return 1/0}{let s=1/0;for(const u of e)s=Math.min(s,u.z);return s}}function $p(r,e,s,u,m,y,x,D){const S=x*m.getElevationAt(r,e,!0,!0),P=0!==y[0],F=P?0===y[1]?x*(y[0]/7-450):x*function(z,U,H){const G=Math.floor(U[0]/8),K=Math.floor(U[1]/8),re=10*(U[0]-8*G),he=10*(U[1]-8*K),be=z.getElevationAt(G,K,!0,!0),de=z.getMeterToDEM(H),ve=Math.floor(.5*(re*de-1)),we=Math.floor(.5*(he*de-1)),Ee=z.tileCoordToPixel(G,K),Je=2*ve+1,Ke=2*we+1,dt=(rn=Je,Kt=Ke,[(Rt=z).getElevationAtPixel(at=Ee.x-ve,Ht=Ee.y-we,!0),Rt.getElevationAtPixel(at+Kt,Ht,!0),Rt.getElevationAtPixel(at,Ht+Kt,!0),Rt.getElevationAtPixel(at+rn,Ht+Kt,!0)]),Ot=Math.abs(dt[0]-dt[1]),rt=Math.abs(dt[2]-dt[3]),vt=Math.abs(dt[0]-dt[2])+Math.abs(dt[1]-dt[3]),yt=Math.min(.25,.5*de*(Ot+rt)/Je),Mt=Math.min(.25,.5*de*vt/Ke);var Rt,at,Ht,rn,Kt;return be+Math.max(yt*re,Mt*he)}(m,y,D):S;return{base:S+(0===s)?-1:s,top:P?Math.max(F+u,S+s+2):S+u}}const oy=Oe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Cg}=oy,sy=Oe([{name:"a_packed",components:4,type:"Float32"}]),{members:Mb}=sy,Cf=vf.types,Hp=Math.cos(Math.PI/180*37.5);class rh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new tt,this.layoutVertexArray2=new _t,this.indexArray=new an,this.programConfigurations=new Xl(e.layers,e.zoom),this.segments=new Ar,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,u,m){this.hasPattern=$u("line",this.layers,s);const y=this.layers[0].layout.get("line-sort-key"),x=[];for(const{feature:F,id:z,index:U,sourceLayerIndex:H}of e){const G=this.layers[0]._featureFilter.needGeometry,K=Bu(F,G);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),K,u))continue;const re=y?y.evaluate(K,{},u):void 0,he={id:z,properties:F.properties,type:F.type,sourceLayerIndex:H,index:U,geometry:G?K.geometry:El(F,u,m),patterns:{},sortKey:re};x.push(he)}y&&x.sort((F,z)=>F.sortKey-z.sortKey);const{lineAtlas:D,featureIndex:S}=s,P=this.addConstantDashes(D);for(const F of x){const{geometry:z,index:U,sourceLayerIndex:H}=F;if(P&&this.addFeatureDashes(F,D),this.hasPattern){const G=Qd("line",this.layers,F,this.zoom,s);this.patternFeatures.push(G)}else this.addFeature(F,z,U,u,D.positions,s.availableImages);S.insert(e[U].feature,z,U,H,this.index)}}addConstantDashes(e){let s=!1;for(const u of this.layers){const m=u.paint.get("line-dasharray").value,y=u.layout.get("line-cap").value;if("constant"!==m.kind||"constant"!==y.kind)s=!0;else{const x=y.value,D=m.value;if(!D)continue;e.addDash(D,x)}}return s}addFeatureDashes(e,s){const u=this.zoom;for(const m of this.layers){const y=m.paint.get("line-dasharray").value,x=m.layout.get("line-cap").value;if("constant"===y.kind&&"constant"===x.kind)continue;let D,S;if("constant"===y.kind){if(D=y.value,!D)continue}else D=y.evaluate({zoom:u},e);S="constant"===x.kind?x.value:x.evaluate({zoom:u},e),s.addDash(D,S),e.patterns[m.id]=s.getKey(D,S)}}update(e,s,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,u,m)}addFeatures(e,s,u,m,y){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,u,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Mb)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cg),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,u,m,y,x){const D=this.layers[0].layout,S=D.get("line-join").evaluate(e,{}),P=D.get("line-cap").evaluate(e,{}),F=D.get("line-miter-limit"),z=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const U of s)this.addLine(U,e,S,P,F,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,y,x,m)}addLine(e,s,u,m,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<e.length-1;he++)this.totalDistance+=e[he].dist(e[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D="Polygon"===Cf[s.type];let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let P=0;for(;P<S-1&&e[P].equals(e[P+1]);)P++;if(S<(D?3:2))return;"bevel"===u&&(y=1.05);const F=this.overscaling<=16?15*mn/(512*this.overscaling):0,z=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let U,H,G,K,re;this.e1=this.e2=-1,D&&(U=e[S-2],re=e[P].sub(U)._unit()._perp());for(let he=P;he<S;he++){if(G=he===S-1?D?e[P+1]:void 0:e[he+1],G&&e[he].equals(G))continue;re&&(K=re),U&&(H=U),U=e[he],re=G?G.sub(U)._unit()._perp():K,K=K||re;let be=K.add(re);0===be.x&&0===be.y||be._unit();const de=K.x*re.x+K.y*re.y,ve=be.x*re.x+be.y*re.y,we=0!==ve?1/ve:1/0,Ee=2*Math.sqrt(2-2*ve),Je=ve<Hp&&H&&G,Ke=K.x*re.y-K.y*re.x>0;if(Je&&he>P){const rt=U.dist(H);if(rt>2*F){const vt=U.sub(U.sub(H)._mult(F/rt)._round());this.updateDistance(H,vt),this.addCurrentVertex(vt,K,0,0,z),H=vt}}const dt=H&&G;let Ot=dt?u:D?"butt":m;if(dt&&"round"===Ot&&(we<x?Ot="miter":we<=2&&(Ot="fakeround")),"miter"===Ot&&we>y&&(Ot="bevel"),"bevel"===Ot&&(we>2&&(Ot="flipbevel"),we<y&&(Ot="miter")),H&&this.updateDistance(H,U),"miter"===Ot)be._mult(we),this.addCurrentVertex(U,be,0,0,z);else if("flipbevel"===Ot){if(we>100)be=re.mult(-1);else{const rt=we*K.add(re).mag()/K.sub(re).mag();be._perp()._mult(rt*(Ke?-1:1))}this.addCurrentVertex(U,be,0,0,z),this.addCurrentVertex(U,be.mult(-1),0,0,z)}else if("bevel"===Ot||"fakeround"===Ot){const rt=-Math.sqrt(we*we-1),vt=Ke?rt:0,yt=Ke?0:rt;if(H&&this.addCurrentVertex(U,K,vt,yt,z),"fakeround"===Ot){const Mt=Math.round(180*Ee/Math.PI/20);for(let Rt=1;Rt<Mt;Rt++){let at=Rt/Mt;if(.5!==at){const rn=at-.5;at+=at*rn*(at-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*rn*rn+(.848013+de*(.215638*de-1.06021)))}const Ht=re.sub(K)._mult(at)._add(K)._unit()._mult(Ke?-1:1);this.addHalfVertex(U,Ht.x,Ht.y,!1,Ke,0,z)}}G&&this.addCurrentVertex(U,re,-vt,-yt,z)}else if("butt"===Ot)this.addCurrentVertex(U,be,0,0,z);else if("square"===Ot){const rt=H?1:-1;H||this.addCurrentVertex(U,be,rt,rt,z),this.addCurrentVertex(U,be,0,0,z),H&&this.addCurrentVertex(U,be,rt,rt,z)}else"round"===Ot&&(H&&(this.addCurrentVertex(U,K,0,0,z),this.addCurrentVertex(U,K,1,1,z,!0)),G&&(this.addCurrentVertex(U,re,-1,-1,z,!0),this.addCurrentVertex(U,re,0,0,z)));if(Je&&he<S-1){const rt=U.dist(G);if(rt>2*F){const vt=U.add(G.sub(U)._mult(F/rt)._round());this.updateDistance(U,vt),this.addCurrentVertex(vt,re,0,0,z),U=vt}}}}addCurrentVertex(e,s,u,m,y,x=!1){const D=s.y*m-s.x,S=-s.y-s.x*m;this.addHalfVertex(e,s.x+s.y*u,s.y-s.x*u,x,!1,u,y),this.addHalfVertex(e,D,S,x,!0,-m,y)}addHalfVertex({x:e,y:s},u,m,y,x,D,S){this.layoutVertexArray.emplaceBack((e<<1)+(y?1:0),(s<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(0===D?0:D<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const P=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),S.primitiveLength++),x?this.e2=P:this.e1=P}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}dn(rh,"LineBucket",{omit:["layers","patternFeatures"]});const Gp=new pe({"line-cap":new oe(lt.layout_line["line-cap"]),"line-join":new oe(lt.layout_line["line-join"]),"line-miter-limit":new X(lt.layout_line["line-miter-limit"]),"line-round-limit":new X(lt.layout_line["line-round-limit"]),"line-sort-key":new oe(lt.layout_line["line-sort-key"])});var na={paint:new pe({"line-opacity":new oe(lt.paint_line["line-opacity"]),"line-color":new oe(lt.paint_line["line-color"]),"line-translate":new X(lt.paint_line["line-translate"]),"line-translate-anchor":new X(lt.paint_line["line-translate-anchor"]),"line-width":new oe(lt.paint_line["line-width"]),"line-gap-width":new oe(lt.paint_line["line-gap-width"]),"line-offset":new oe(lt.paint_line["line-offset"]),"line-blur":new oe(lt.paint_line["line-blur"]),"line-dasharray":new oe(lt.paint_line["line-dasharray"]),"line-pattern":new oe(lt.paint_line["line-pattern"]),"line-gradient":new fe(lt.paint_line["line-gradient"]),"line-trim-offset":new X(lt.paint_line["line-trim-offset"])}),layout:Gp};const Jv=new class extends oe{possiblyEvaluate(r,e){return e=new B(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,s,u){return e=ot({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,s,u)}}(na.paint.properties["line-width"].specification);function Qv(r,e){return e>0?e+2*r:r}Jv.useIntegerZoom=!0;const Sb=Oe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Wp=Oe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),e0=Oe([{name:"a_projected_pos",components:4,type:"Float32"}],4);Oe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Zp=Oe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),oh=Oe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Oe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ls=Oe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ay=Oe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Oe([{name:"triangle",components:3,type:"Uint16"}]),Oe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Oe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Oe([{type:"Float32",name:"offsetX"}]),Oe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Yr=24;const ys=128;function Wu(r,e){const{expression:s}=e;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new B(r+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:m}=s;let y=0;for(;y<u.length&&u[y]<=r;)y++;y=Math.max(0,y-1);let x=y;for(;x<u.length&&u[x]<r+1;)x++;x=Math.min(u.length-1,x);const D=u[y],S=u[x];return"composite"===s.kind?{kind:"composite",minZoom:D,maxZoom:S,interpolationType:m}:{kind:"camera",minZoom:D,maxZoom:S,minSize:s.evaluate(new B(D)),maxSize:s.evaluate(new B(S)),interpolationType:m}}}function Ml(r,{uSize:e,uSizeT:s},{lowerSize:u,upperSize:m}){return"source"===r.kind?u/ys:"composite"===r.kind?wi(u/ys,m/ys,s):e}function rc(r,e){let s=0,u=0;if("constant"===r.kind)u=r.layoutSize;else if("source"!==r.kind){const{interpolationType:m,minZoom:y,maxZoom:x}=r,D=m?Wn(vo.interpolationFactor(m,e,y,x),0,1):0;"camera"===r.kind?u=wi(r.minSize,r.maxSize,D):s=D}return{uSizeT:s,uSize:u}}var Dg=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ys,evaluateSizeForFeature:Ml,evaluateSizeForZoom:rc,getSizeData:Wu});function qc(r,e,s){return r.sections.forEach(u=>{u.text=function(m,y,x){const D=y.layout.get("text-transform").evaluate(x,{});return"uppercase"===D?m=m.toLocaleUpperCase():"lowercase"===D&&(m=m.toLocaleLowerCase()),k.applyArabicShaping&&(m=k.applyArabicShaping(m)),m}(u.text,e,s)}),r}const oc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Df(r){return"\ufe36"===r||"\ufe48"===r||"\ufe38"===r||"\ufe44"===r||"\ufe42"===r||"\ufe3e"===r||"\ufe3c"===r||"\ufe3a"===r||"\ufe18"===r||"\ufe40"===r||"\ufe10"===r||"\ufe13"===r||"\ufe14"===r||"\uff40"===r||"\uffe3"===r||"\ufe11"===r||"\ufe12"===r}function Zu(r){return"\ufe35"===r||"\ufe47"===r||"\ufe37"===r||"\ufe43"===r||"\ufe41"===r||"\ufe3d"===r||"\ufe3b"===r||"\ufe39"===r||"\ufe17"===r||"\ufe3f"===r}var qu=Ri,qp=function(r,e,s,u,m){var y,x,D=8*m-u-1,S=(1<<D)-1,P=S>>1,F=-7,z=s?m-1:0,U=s?-1:1,H=r[e+z];for(z+=U,y=H&(1<<-F)-1,H>>=-F,F+=D;F>0;y=256*y+r[e+z],z+=U,F-=8);for(x=y&(1<<-F)-1,y>>=-F,F+=u;F>0;x=256*x+r[e+z],z+=U,F-=8);if(0===y)y=1-P;else{if(y===S)return x?NaN:1/0*(H?-1:1);x+=Math.pow(2,u),y-=P}return(H?-1:1)*x*Math.pow(2,y-u)},Yp=function(r,e,s,u,m,y){var x,D,S,P=8*y-m-1,F=(1<<P)-1,z=F>>1,U=23===m?Math.pow(2,-24)-Math.pow(2,-77):0,H=u?0:y-1,G=u?1:-1,K=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(D=isNaN(e)?1:0,x=F):(x=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-x))<1&&(x--,S*=2),(e+=x+z>=1?U/S:U*Math.pow(2,1-z))*S>=2&&(x++,S/=2),x+z>=F?(D=0,x=F):x+z>=1?(D=(e*S-1)*Math.pow(2,m),x+=z):(D=e*Math.pow(2,z-1)*Math.pow(2,m),x=0));m>=8;r[s+H]=255&D,H+=G,D/=256,m-=8);for(x=x<<m|D,P+=m;P>0;r[s+H]=255&x,H+=G,x/=256,P-=8);r[s+H-G]|=128*K};function Ri(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Ri.Varint=0,Ri.Fixed64=1,Ri.Bytes=2,Ri.Fixed32=5;var Xp=4294967296,Tg=1/Xp,t0=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Sl(r){return r.type===Ri.Bytes?r.readVarint()+r.pos:r.pos+1}function Mg(r,e,s){var u=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(u);for(var m=s.pos-1;m>=r;m--)s.buf[m+u]=s.buf[m]}function Sg(r,e){for(var s=0;s<r.length;s++)e.writeVarint(r[s])}function Jp(r,e){for(var s=0;s<r.length;s++)e.writeSVarint(r[s])}function n0(r,e){for(var s=0;s<r.length;s++)e.writeFloat(r[s])}function ly(r,e){for(var s=0;s<r.length;s++)e.writeDouble(r[s])}function Qp(r,e){for(var s=0;s<r.length;s++)e.writeBoolean(r[s])}function Yc(r,e){for(var s=0;s<r.length;s++)e.writeFixed32(r[s])}function cy(r,e){for(var s=0;s<r.length;s++)e.writeSFixed32(r[s])}function uy(r,e){for(var s=0;s<r.length;s++)e.writeFixed64(r[s])}function dy(r,e){for(var s=0;s<r.length;s++)e.writeSFixed64(r[s])}function em(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function tm(r,e,s){r[s]=e,r[s+1]=e>>>8,r[s+2]=e>>>16,r[s+3]=e>>>24}function r0(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}Ri.prototype={destroy:function(){this.buf=null},readFields:function(r,e,s){for(s=s||this.length;this.pos<s;){var u=this.readVarint(),m=u>>3,y=this.pos;this.type=7&u,r(m,e,this),this.pos===y&&this.skip(u)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=em(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=r0(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=em(this.buf,this.pos)+em(this.buf,this.pos+4)*Xp;return this.pos+=8,r},readSFixed64:function(){var r=em(this.buf,this.pos)+r0(this.buf,this.pos+4)*Xp;return this.pos+=8,r},readFloat:function(){var r=qp(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=qp(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,s,u=this.buf;return e=127&(s=u[this.pos++]),s<128?e:(e|=(127&(s=u[this.pos++]))<<7,s<128?e:(e|=(127&(s=u[this.pos++]))<<14,s<128?e:(e|=(127&(s=u[this.pos++]))<<21,s<128?e:function(m,y,x){var D,S,P=x.buf;if(D=(112&(S=P[x.pos++]))>>4,S<128||(D|=(127&(S=P[x.pos++]))<<3,S<128)||(D|=(127&(S=P[x.pos++]))<<10,S<128)||(D|=(127&(S=P[x.pos++]))<<17,S<128)||(D|=(127&(S=P[x.pos++]))<<24,S<128)||(D|=(1&(S=P[x.pos++]))<<31,S<128))return function Kp(r,e,s){return s?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}(m,D,y);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(s=u[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&t0?t0.decode(this.buf.subarray(e,r)):function(s,u,m){for(var y="",x=u;x<m;){var D,S,P,F=s[x],z=null,U=F>239?4:F>223?3:F>191?2:1;if(x+U>m)break;1===U?F<128&&(z=F):2===U?128==(192&(D=s[x+1]))&&(z=(31&F)<<6|63&D)<=127&&(z=null):3===U?(S=s[x+2],128==(192&(D=s[x+1]))&&128==(192&S)&&((z=(15&F)<<12|(63&D)<<6|63&S)<=2047||z>=55296&&z<=57343)&&(z=null)):4===U&&(S=s[x+2],P=s[x+3],128==(192&(D=s[x+1]))&&128==(192&S)&&128==(192&P)&&((z=(15&F)<<18|(63&D)<<12|(63&S)<<6|63&P)<=65535||z>=1114112)&&(z=null)),null===z?(z=65533,U=1):z>65535&&(z-=65536,y+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),y+=String.fromCharCode(z),x+=U}return y}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Ri.Bytes)return r.push(this.readVarint(e));var s=Sl(this);for(r=r||[];this.pos<s;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Ri.Bytes)return r.push(this.readSVarint());var e=Sl(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Ri.Bytes)return r.push(this.readBoolean());var e=Sl(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Ri.Bytes)return r.push(this.readFloat());var e=Sl(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Ri.Bytes)return r.push(this.readDouble());var e=Sl(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Ri.Bytes)return r.push(this.readFixed32());var e=Sl(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Ri.Bytes)return r.push(this.readSFixed32());var e=Sl(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Ri.Bytes)return r.push(this.readFixed64());var e=Sl(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Ri.Bytes)return r.push(this.readSFixed64());var e=Sl(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Ri.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ri.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ri.Fixed32)this.pos+=4;else{if(e!==Ri.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),tm(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),tm(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),tm(this.buf,-1&r,this.pos),tm(this.buf,Math.floor(r*Tg),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),tm(this.buf,-1&r,this.pos),tm(this.buf,Math.floor(r*Tg),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,s){var u,m,y,D;if(e>=0?(u=e%4294967296|0,m=e/4294967296|0):(m=~(-e/4294967296),4294967295^(u=~(-e%4294967296))?u=u+1|0:(u=0,m=m+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),y=u,(D=s).buf[D.pos++]=127&y|128,y>>>=7,D.buf[D.pos++]=127&y|128,y>>>=7,D.buf[D.pos++]=127&y|128,y>>>=7,D.buf[D.pos++]=127&y|128,D.buf[D.pos]=127&(y>>>=7),function(y,x){var D=(7&y)<<4;x.buf[x.pos++]|=D|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))}(m,s)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(u,m,y){for(var x,D,S=0;S<m.length;S++){if((x=m.charCodeAt(S))>55295&&x<57344){if(!D){x>56319||S+1===m.length?(u[y++]=239,u[y++]=191,u[y++]=189):D=x;continue}if(x<56320){u[y++]=239,u[y++]=191,u[y++]=189,D=x;continue}x=D-55296<<10|x-56320|65536,D=null}else D&&(u[y++]=239,u[y++]=191,u[y++]=189,D=null);x<128?u[y++]=x:(x<2048?u[y++]=x>>6|192:(x<65536?u[y++]=x>>12|224:(u[y++]=x>>18|240,u[y++]=x>>12&63|128),u[y++]=x>>6&63|128),u[y++]=63&x|128)}return y}(this.buf,r,this.pos);var s=this.pos-e;s>=128&&Mg(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s},writeFloat:function(r){this.realloc(4),Yp(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Yp(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var s=0;s<e;s++)this.buf[this.pos++]=r[s]},writeRawMessage:function(r,e){this.pos++;var s=this.pos;r(e,this);var u=this.pos-s;u>=128&&Mg(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u},writeMessage:function(r,e,s){this.writeTag(r,Ri.Bytes),this.writeRawMessage(e,s)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,Sg,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,Jp,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,Qp,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,n0,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,ly,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,Yc,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,cy,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,uy,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,dy,e)},writeBytesField:function(r,e){this.writeTag(r,Ri.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Ri.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Ri.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Ri.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Ri.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Ri.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Ri.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Ri.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Ri.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Ri.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var Yu=Pt(qu);const hy=3;function Tf(r,e,s){e.glyphs=[],1===r&&s.readMessage(Mf,e)}function Mf(r,e,s){if(3===r){const{id:u,bitmap:m,width:y,height:x,left:D,top:S,advance:P}=s.readMessage(o0,{});e.glyphs.push({id:u,bitmap:new ta({width:y+2*hy,height:x+2*hy},m),metrics:{width:y,height:x,left:D,top:S,advance:P}})}else 4===r?e.ascender=s.readSVarint():5===r&&(e.descender=s.readSVarint())}function o0(r,e,s){1===r?e.id=s.readVarint():2===r?e.bitmap=s.readBytes():3===r?e.width=s.readVarint():4===r?e.height=s.readVarint():5===r?e.left=s.readSVarint():6===r?e.top=s.readSVarint():7===r&&(e.advance=s.readVarint())}const nm=hy;function Ig(r){let e=0,s=0;for(const x of r)e+=x.w*x.h,s=Math.max(s,x.w);r.sort((x,D)=>D.h-x.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let m=0,y=0;for(const x of r)for(let D=u.length-1;D>=0;D--){const S=u[D];if(!(x.w>S.w||x.h>S.h)){if(x.x=S.x,x.y=S.y,y=Math.max(y,x.y+x.h),m=Math.max(m,x.x+x.w),x.w===S.w&&x.h===S.h){const P=u.pop();D<u.length&&(u[D]=P)}else x.h===S.h?(S.x+=x.w,S.w-=x.w):x.w===S.w?(S.y+=x.h,S.h-=x.h):(u.push({x:S.x+x.w,y:S.y,w:S.w-x.w,h:x.h}),S.y+=x.h,S.h-=x.h);break}}return{w:m,h:y,fill:e/(m*y)||0}}const Fs=1;class Ag{constructor(e,{pixelRatio:s,version:u,stretchX:m,stretchY:y,content:x}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=m,this.stretchY=y,this.content=x,this.version=u}get tl(){return[this.paddedRect.x+Fs,this.paddedRect.y+Fs]}get br(){return[this.paddedRect.x+this.paddedRect.w-Fs,this.paddedRect.y+this.paddedRect.h-Fs]}get displaySize(){return[(this.paddedRect.w-2*Fs)/this.pixelRatio,(this.paddedRect.h-2*Fs)/this.pixelRatio]}}class Pg{constructor(e,s){const u={},m={};this.haveRenderCallbacks=[];const y=[];this.addImages(e,u,y),this.addImages(s,m,y);const{w:x,h:D}=Ig(y),S=new gs({width:x||1,height:D||1});for(const P in e){const F=e[P],z=u[P].paddedRect;gs.copy(F.data,S,{x:0,y:0},{x:z.x+Fs,y:z.y+Fs},F.data)}for(const P in s){const F=s[P],z=m[P].paddedRect,U=z.x+Fs,H=z.y+Fs,G=F.data.width,K=F.data.height;gs.copy(F.data,S,{x:0,y:0},{x:U,y:H},F.data),gs.copy(F.data,S,{x:0,y:K-1},{x:U,y:H-1},{width:G,height:1}),gs.copy(F.data,S,{x:0,y:0},{x:U,y:H+K},{width:G,height:1}),gs.copy(F.data,S,{x:G-1,y:0},{x:U-1,y:H},{width:1,height:K}),gs.copy(F.data,S,{x:0,y:0},{x:U+G,y:H},{width:1,height:K})}this.image=S,this.iconPositions=u,this.patternPositions=m}addImages(e,s,u){for(const m in e){const y=e[m],x={x:0,y:0,w:y.data.width+2*Fs,h:y.data.height+2*Fs};u.push(x),s[m]=new Ag(x,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(e,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in e.updatedImages)this.patchUpdatedImage(this.iconPositions[u],e.getImage(u),s),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u),s)}patchUpdatedImage(e,s,u){if(!e||!s||e.version===s.version)return;e.version=s.version;const[m,y]=e.tl;u.update(s.data,void 0,{x:m,y})}}dn(Ag,"ImagePosition"),dn(Pg,"ImageAtlas");const Ns={horizontal:1,vertical:2,horizontalOnly:3},sh=-17;class im{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,s){const u=new im;return u.scale=e||1,u.fontStack=s,u}static forImage(e){const s=new im;return s.imageName=e,s}}class Il{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const u=new Il;for(let m=0;m<e.sections.length;m++){const y=e.sections[m];y.image?u.addImageSection(y):u.addTextSection(y,s)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(s,u){let m="";for(let y=0;y<s.length;y++){const x=s.charCodeAt(y+1)||null,D=s.charCodeAt(y-1)||null;m+=!u&&(x&&qm(x)&&!oc[s[y+1]]||D&&qm(D)&&!oc[s[y-1]])||!oc[s[y]]?s[y]:oc[s[y]]}return m}(this.text,e)}trim(){let e=0;for(let u=0;u<this.text.length&&Sf[this.text.charCodeAt(u)];u++)e++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&Sf[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const u=new Il;return u.text=this.text.substring(e,s),u.sectionIndex=this.sectionIndex.slice(e,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(im.forText(e.scale,e.fontStack||s));const u=this.sections.length-1;for(let m=0;m<e.text.length;++m)this.sectionIndex.push(u)}addImageSection(e){const s=e.image?e.image.name:"";if(0===s.length)return void qn("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(im.forImage(s)),this.sectionIndex.push(this.sections.length-1)):qn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rm(r,e,s,u,m,y,x,D,S,P,F,z,U,H,G){const K=Il.fromFeature(r,m);z===Ns.vertical&&K.verticalizePunctuation(U);let re=[];const he=function(Ee,Je,Ke,dt,Ot,rt){if(!Ee)return[];const vt=[],yt=function(Ht,rn,Kt,Sn,Ut,gn){let $n=0;for(let di=0;di<Ht.length();di++){const Vn=Ht.getSection(di);$n+=Rg(Ht.getCharCode(di),Vn,Sn,Ut,rn,gn)}return $n/Math.max(1,Math.ceil($n/Kt))}(Ee,Je,Ke,dt,Ot,rt),Mt=Ee.text.indexOf("\u200b")>=0;let Rt=0;for(let Ht=0;Ht<Ee.length();Ht++){const rn=Ee.getSection(Ht),Kt=Ee.getCharCode(Ht);if(Sf[Kt]||(Rt+=Rg(Kt,rn,dt,Ot,Je,rt)),Ht<Ee.length()-1){const Sn=!((at=Kt)<11904||!(Xt["Bopomofo Extended"](at)||Xt.Bopomofo(at)||Xt["CJK Compatibility Forms"](at)||Xt["CJK Compatibility Ideographs"](at)||Xt["CJK Compatibility"](at)||Xt["CJK Radicals Supplement"](at)||Xt["CJK Strokes"](at)||Xt["CJK Symbols and Punctuation"](at)||Xt["CJK Unified Ideographs Extension A"](at)||Xt["CJK Unified Ideographs"](at)||Xt["Enclosed CJK Letters and Months"](at)||Xt["Halfwidth and Fullwidth Forms"](at)||Xt.Hiragana(at)||Xt["Ideographic Description Characters"](at)||Xt["Kangxi Radicals"](at)||Xt["Katakana Phonetic Extensions"](at)||Xt.Katakana(at)||Xt["Vertical Forms"](at)||Xt["Yi Radicals"](at)||Xt["Yi Syllables"](at)));(fy[Kt]||Sn||rn.imageName)&&vt.push(sc(Ht+1,Rt,yt,vt,s0(Kt,Ee.getCharCode(Ht+1),Sn&&Mt),!1))}}var at;return Xc(sc(Ee.length(),Rt,yt,vt,0,!0))}(K,P,y,e,u,H),{processBidirectionalText:be,processStyledBidirectionalText:de}=k;if(be&&1===K.sections.length){const Ee=be(K.toString(),he);for(const Je of Ee){const Ke=new Il;Ke.text=Je,Ke.sections=K.sections;for(let dt=0;dt<Je.length;dt++)Ke.sectionIndex.push(0);re.push(Ke)}}else if(de){const Ee=de(K.text,K.sectionIndex,he);for(const Je of Ee){const Ke=new Il;Ke.text=Je[0],Ke.sectionIndex=Je[1],Ke.sections=K.sections,re.push(Ke)}}else re=function(Ee,Je){const Ke=[],dt=Ee.text;let Ot=0;for(const rt of Je)Ke.push(Ee.substring(Ot,rt)),Ot=rt;return Ot<dt.length&&Ke.push(Ee.substring(Ot,dt.length)),Ke}(K,he);const ve=[],we={positionedLines:ve,text:K.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:z,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ee,Je,Ke,dt,Ot,rt,vt,yt,Mt,Rt,at,Ht){let rn=0,Kt=0,Sn=0;const Ut="right"===yt?1:"left"===yt?0:.5;let gn=!1;for(const In of Ot){const Hn=In.getSections();for(const Ei of Hn){if(Ei.imageName)continue;const Wi=Je[Ei.fontStack];if(Wi&&(gn=void 0!==Wi.ascender&&void 0!==Wi.descender,!gn))break}if(!gn)break}let $n=0;for(const In of Ot){In.trim();const Hn=In.getMaxScale(),Ei=(Hn-1)*Yr,Wi={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[$n]=Wi;const Ni=Wi.positionedGlyphs;let Bi=0;if(!In.length()){Kt+=rt,++$n;continue}let cr=0,ur=0;for(let zi=0;zi<In.length();zi++){const Pr=In.getSection(zi),Rr=In.getSectionIndex(zi),tr=In.getCharCode(zi);let Di=Pr.scale,Br=null,Ki=null,Ho=null,Wr=Yr,Go=0;const co=!(Mt===Ns.horizontal||!at&&!hp(tr)||at&&(Sf[tr]||(di=tr,Xt.Arabic(di)||Xt["Arabic Supplement"](di)||Xt["Arabic Extended-A"](di)||Xt["Arabic Presentation Forms-A"](di)||Xt["Arabic Presentation Forms-B"](di))));if(Pr.imageName){const is=dt[Pr.imageName];if(!is)continue;Ho=Pr.imageName,Ee.iconsInText=Ee.iconsInText||!0,Ki=is.paddedRect;const oo=is.displaySize;Di=Di*Yr/Ht,Br={width:oo[0],height:oo[1],left:Fs,top:-nm,advance:co?oo[1]:oo[0],localGlyph:!1},Go=gn?-Br.height*Di:sh+Hn*Yr-oo[1]*Di,Wr=Br.advance;const kl=(co?oo[0]:oo[1])*Di-Yr*Hn;kl>0&&kl>Bi&&(Bi=kl)}else{const is=Ke[Pr.fontStack];if(!is)continue;is[tr]&&(Ki=is[tr]);const oo=Je[Pr.fontStack];if(!oo)continue;const kl=oo.glyphs[tr];if(!kl)continue;if(Br=kl.metrics,Wr=8203!==tr?Yr:0,gn){const zf=void 0!==oo.ascender?Math.abs(oo.ascender):0,bh=void 0!==oo.descender?Math.abs(oo.descender):0,ru=(zf+bh)*Di;cr<ru&&(cr=ru,ur=(zf-bh)/2*Di),Go=-zf*Di}else Go=sh+(Hn-Di)*Yr}co?(Ee.verticalizable=!0,Ni.push({glyph:tr,imageName:Ho,x:rn,y:Kt+Go,vertical:co,scale:Di,localGlyph:Br.localGlyph,fontStack:Pr.fontStack,sectionIndex:Rr,metrics:Br,rect:Ki}),rn+=Wr*Di+Rt):(Ni.push({glyph:tr,imageName:Ho,x:rn,y:Kt+Go,vertical:co,scale:Di,localGlyph:Br.localGlyph,fontStack:Pr.fontStack,sectionIndex:Rr,metrics:Br,rect:Ki}),rn+=Br.advance*Di+Rt)}0!==Ni.length&&(Sn=Math.max(rn-Rt,Sn),gn?gy(Ni,Ut,Bi,ur,rt*Hn/2):gy(Ni,Ut,Bi,0,rt/2)),rn=0;const Cr=rt*Hn+Bi;Wi.lineOffset=Math.max(Bi,Ei),Kt+=Cr,++$n}var di;const Vn=Kt,{horizontalAlign:wn,verticalAlign:Si}=my(vt);(function(In,Hn,Ei,Wi,Ni,Bi){const cr=(Hn-Ei)*Ni,ur=-Bi*Wi;for(const Cr of In)for(const zi of Cr.positionedGlyphs)zi.x+=cr,zi.y+=ur})(Ee.positionedLines,Ut,wn,Si,Sn,Vn),Ee.top+=-Si*Vn,Ee.bottom=Ee.top+Vn,Ee.left+=-wn*Sn,Ee.right=Ee.left+Sn,Ee.hasBaseline=gn}(we,e,s,u,re,x,D,S,z,P,U,G),!function(Ee){for(const Je of Ee)if(0!==Je.positionedGlyphs.length)return!1;return!0}(ve)&&we}const Sf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},fy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Rg(r,e,s,u,m,y){if(e.imageName){const x=u[e.imageName];return x?x.displaySize[0]*e.scale*Yr/y+m:0}{const x=s[e.fontStack],D=x&&x.glyphs[r];return D?D.metrics.advance*e.scale+m:0}}function py(r,e,s,u){const m=Math.pow(r-e,2);return u?r<e?m/2:2*m:m+Math.abs(s)*s}function s0(r,e,s){let u=0;return 10===r&&(u-=1e4),s&&(u+=150),40!==r&&65288!==r||(u+=50),41!==e&&65289!==e||(u+=50),u}function sc(r,e,s,u,m,y){let x=null,D=py(e,s,m,y);for(const S of u){const P=py(e-S.x,s,m,y)+S.badness;P<=D&&(x=S,D=P)}return{index:r,x:e,priorBreak:x,badness:D}}function Xc(r){return r?Xc(r.priorBreak).concat(r.index):[]}function my(r){let e=.5,s=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function gy(r,e,s,u,m){if(!(e||s||u||m))return;const y=r.length-1,x=r[y],D=(x.x+x.metrics.advance*x.scale)*e;for(let S=0;S<=y;S++)r[S].x-=D,r[S].y+=s+u+m}function Og(r,e,s){const{horizontalAlign:u,verticalAlign:m}=my(s),y=e[0]-r.displaySize[0]*u,x=e[1]-r.displaySize[1]*m;return{image:r,top:x,bottom:x+r.displaySize[1],left:y,right:y+r.displaySize[0]}}function xa(r,e,s,u,m,y){const x=r.image;let D;if(x.content){const re=x.content,he=x.pixelRatio||1;D=[re[0]/he,re[1]/he,x.displaySize[0]-re[2]/he,x.displaySize[1]-re[3]/he]}const S=e.left*y,P=e.right*y;let F,z,U,H;"width"===s||"both"===s?(H=m[0]+S-u[3],z=m[0]+P+u[1]):(H=m[0]+(S+P-x.displaySize[0])/2,z=H+x.displaySize[0]);const G=e.top*y,K=e.bottom*y;return"height"===s||"both"===s?(F=m[1]+G-u[0],U=m[1]+K+u[2]):(F=m[1]+(G+K-x.displaySize[1])/2,U=F+x.displaySize[1]),{image:x,top:F,right:z,bottom:U,left:H,collisionPadding:D}}class wa extends Ne{constructor(e,s,u,m,y){super(e,s),this.angle=m,this.z=u,void 0!==y&&(this.segment=y)}clone(){return new wa(this.x,this.y,this.z,this.angle,this.segment)}}function a0(r,e,s,u,m){if(void 0===e.segment)return!0;let y=e,x=e.segment+1,D=0;for(;D>-s/2;){if(x--,x<0)return!1;D-=r[x].dist(y),y=r[x]}D+=r[x].dist(r[x+1]),x++;const S=[];let P=0;for(;D<s/2;){const F=r[x],z=r[x+1];if(!z)return!1;let U=r[x-1].angleTo(F)-F.angleTo(z);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:D,angleDelta:U}),P+=U;D-S[0].distance>u;)P-=S.shift().angleDelta;if(P>m)return!1;x++,D+=F.dist(z)}return!0}function l0(r){let e=0;for(let s=0;s<r.length-1;s++)e+=r[s].dist(r[s+1]);return e}function c0(r,e,s){return r?.6*e*s:0}function kg(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function ac(r,e,s,u,m,y){const x=c0(s,m,y),D=kg(s,u)*y;let S=0;const P=l0(r)/2;for(let F=0;F<r.length-1;F++){const z=r[F],U=r[F+1],H=z.dist(U);if(S+H>P){const G=(P-S)/H,K=wi(z.x,U.x,G),re=wi(z.y,U.y,G),he=new wa(K,re,0,U.angleTo(z),F);return!x||a0(r,he,D,x,e)?he:void 0}S+=H}}function Lg(r,e,s,u,m,y,x,D,S){const P=c0(u,y,x),F=kg(u,m),z=F*x,U=0===r[0].x||r[0].x===S||0===r[0].y||r[0].y===S;return e-z<e/4&&(e=z+e/4),u0(r,U?e/2*D%e:(F/2+2*y)*x*D%e,e,P,s,z,U,!1,S)}function u0(r,e,s,u,m,y,x,D,S){const P=y/2,F=l0(r);let z=0,U=e-s,H=[];for(let G=0;G<r.length-1;G++){const K=r[G],re=r[G+1],he=K.dist(re),be=re.angleTo(K);for(;U+s<z+he;){U+=s;const de=(U-z)/he,ve=wi(K.x,re.x,de),we=wi(K.y,re.y,de);if(ve>=0&&ve<S&&we>=0&&we<S&&U-P>=0&&U+P<=F){const Ee=new wa(ve,we,0,be,G);Ee._round(),u&&!a0(r,Ee,y,u,m)||H.push(Ee)}}z+=he}return D||H.length||x||(H=u0(r,z/2,s,u,m,y,x,!0,S)),H}function om(r,e,s,u,m){const y=[];for(let x=0;x<r.length;x++){const D=r[x];let S;for(let P=0;P<D.length-1;P++){let F=D[P],z=D[P+1];F.x<e&&z.x<e||(F.x<e?F=new Ne(e,F.y+(e-F.x)/(z.x-F.x)*(z.y-F.y))._round():z.x<e&&(z=new Ne(e,F.y+(e-F.x)/(z.x-F.x)*(z.y-F.y))._round()),F.y<s&&z.y<s||(F.y<s?F=new Ne(F.x+(s-F.y)/(z.y-F.y)*(z.x-F.x),s)._round():z.y<s&&(z=new Ne(F.x+(s-F.y)/(z.y-F.y)*(z.x-F.x),s)._round()),F.x>=u&&z.x>=u||(F.x>=u?F=new Ne(u,F.y+(u-F.x)/(z.x-F.x)*(z.y-F.y))._round():z.x>=u&&(z=new Ne(u,F.y+(u-F.x)/(z.x-F.x)*(z.y-F.y))._round()),F.y>=m&&z.y>=m||(F.y>=m?F=new Ne(F.x+(m-F.y)/(z.y-F.y)*(z.x-F.x),m)._round():z.y>=m&&(z=new Ne(F.x+(m-F.y)/(z.y-F.y)*(z.x-F.x),m)._round()),S&&F.equals(S[S.length-1])||(S=[F],y.push(S)),S.push(z)))))}}return y}dn(wa,"Anchor");const Gr=1e20;function _y(r,e,s,u,m,y,x,D,S){for(let P=e;P<e+u;P++)sm(r,s*y+P,y,m,x,D,S);for(let P=s;P<s+m;P++)sm(r,P*y+e,1,u,x,D,S)}function sm(r,e,s,u,m,y,x){y[0]=0,x[0]=-Gr,x[1]=Gr,m[0]=r[e];for(let D=1,S=0,P=0;D<u;D++){m[D]=r[e+D*s];const F=D*D;do{const z=y[S];P=(m[D]-m[z]+F-z*z)/(D-z)/2}while(P<=x[S]&&--S>-1);S++,y[S]=D,x[S]=P,x[S+1]=Gr}for(let D=0,S=0;D<u;D++){for(;x[S+1]<D;)S++;const P=y[S],F=D-P;r[e+D*s]=m[P]+F*F}}const Qa=2,Fg={none:0,ideographs:1,all:2};class Xu{constructor(e,s,u){this.requestManager=e,this.localGlyphMode=s,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,s){const u=[];for(const m in e)for(const y of e[m])u.push({stack:m,id:y});dr(u,({stack:m,id:y},x)=>{let D=this.entries[m];D||(D=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=D.glyphs[y];if(void 0!==S)return void x(null,{stack:m,id:y,glyph:S});if(S=this._tinySDF(D,m,y),S)return D.glyphs[y]=S,void x(null,{stack:m,id:y,glyph:S});const P=Math.floor(y/256);if(256*P>65535)return void x(new Error("glyphs > 65535 not supported"));if(D.ranges[P])return void x(null,{stack:m,id:y,glyph:S});let F=D.requests[P];F||(F=D.requests[P]=[],Xu.loadGlyphRange(m,P,this.url,this.requestManager,(z,U)=>{if(U){D.ascender=U.ascender,D.descender=U.descender;for(const H in U.glyphs)this._doesCharSupportLocalGlyph(+H)||(D.glyphs[+H]=U.glyphs[+H]);D.ranges[P]=!0}for(const H of F)H(z,U);delete D.requests[P]})),F.push((z,U)=>{z?x(z):U&&x(null,{stack:m,id:y,glyph:U.glyphs[y]||null})})},(m,y)=>{if(m)s(m);else if(y){const x={};for(const{stack:D,id:S,glyph:P}of y)void 0===x[D]&&(x[D]={}),void 0===x[D].glyphs&&(x[D].glyphs={}),x[D].glyphs[S]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},x[D].ascender=this.entries[D].ascender,x[D].descender=this.entries[D].descender;s(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Fg.none&&(this.localGlyphMode===Fg.all?!!this.localFontFamily:!!this.localFontFamily&&(Xt["CJK Unified Ideographs"](e)||Xt["Hangul Syllables"](e)||Xt.Hiragana(e)||Xt.Katakana(e)||Xt["CJK Symbols and Punctuation"](e)))}_tinySDF(e,s,u){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(u))return;let y=e.tinySDF;if(!y){let K="400";/bold/i.test(s)?K="900":/medium/i.test(s)?K="500":/light/i.test(s)&&(K="200"),y=e.tinySDF=new Xu.TinySDF({fontFamily:m,fontWeight:K,fontSize:24*Qa,buffer:3*Qa,radius:8*Qa}),y.fontWeight=K}if(this.localGlyphs[y.fontWeight][u])return this.localGlyphs[y.fontWeight][u];const x=String.fromCharCode(u),{data:D,width:S,height:P,glyphWidth:F,glyphHeight:z,glyphLeft:U,glyphTop:H,glyphAdvance:G}=y.draw(x);return this.localGlyphs[y.fontWeight][u]={id:u,bitmap:new ta({width:S,height:P},D),metrics:{width:F/Qa,height:z/Qa,left:U/Qa,top:H/Qa-27,advance:G/Qa,localGlyph:!0}}}}Xu.loadGlyphRange=function(r,e,s,u,m){const y=256*e,x=y+255,D=u.transformRequest(u.normalizeGlyphsURL(s).replace("{fontstack}",r).replace("{range}",`${y}-${x}`),Kr.Glyphs);bi(D,(S,P)=>{if(S)m(S);else if(P){const F={},z=new Yu(P).readFields(Tf,{});for(const U of z.glyphs)F[U.id]=U;m(null,{glyphs:F,ascender:z.ascender,descender:z.descender})}})},Xu.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:s=8,cutoff:u=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:x="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=s;const D=this.size=r+4*e,S=this._createCanvas(D),P=this.ctx=S.getContext("2d",{willReadFrequently:!0});P.font=`${x} ${y} ${r}px ${m}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(r),x=Math.ceil(s),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-m))),S=Math.min(this.size-this.buffer,x+Math.ceil(u)),P=D+2*this.buffer,F=S+2*this.buffer,z=Math.max(P*F,0),U=new Uint8ClampedArray(z),H={data:U,width:P,height:F,glyphWidth:D,glyphHeight:S,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(0===D||0===S)return H;const{ctx:G,buffer:K,gridInner:re,gridOuter:he}=this;G.clearRect(K,K,D,S),G.fillText(r,K,K+x);const be=G.getImageData(K,K,D,S);he.fill(Gr,0,z),re.fill(0,0,z);for(let de=0;de<S;de++)for(let ve=0;ve<D;ve++){const we=be.data[4*(de*D+ve)+3]/255;if(0===we)continue;const Ee=(de+K)*P+ve+K;if(1===we)he[Ee]=0,re[Ee]=Gr;else{const Je=.5-we;he[Ee]=Je>0?Je*Je:0,re[Ee]=Je<0?Je*Je:0}}_y(he,0,0,P,F,P,this.f,this.v,this.z),_y(re,K,K,D,S,P,this.f,this.v,this.z);for(let de=0;de<z;de++){const ve=Math.sqrt(he[de])-Math.sqrt(re[de]);U[de]=Math.round(255-255*(ve/this.radius+this.cutoff))}return H}};const Kc=Fs;function Ng(r,e,s,u){const m=[],y=r.image,x=y.pixelRatio,D=y.paddedRect.w-2*Kc,S=y.paddedRect.h-2*Kc,P=r.right-r.left,F=r.bottom-r.top,z=y.stretchX||[[0,D]],U=y.stretchY||[[0,S]],H=(rt,vt)=>rt+vt[1]-vt[0],G=z.reduce(H,0),K=U.reduce(H,0),re=D-G,he=S-K;let be=0,de=G,ve=0,we=K,Ee=0,Je=re,Ke=0,dt=he;if(y.content&&u){const rt=y.content;be=am(z,0,rt[0]),ve=am(U,0,rt[1]),de=am(z,rt[0],rt[2]),we=am(U,rt[1],rt[3]),Ee=rt[0]-be,Ke=rt[1]-ve,Je=rt[2]-rt[0]-de,dt=rt[3]-rt[1]-we}const Ot=(rt,vt,yt,Mt)=>{const Rt=If(rt.stretch-be,de,P,r.left),at=ah(rt.fixed-Ee,Je,rt.stretch,G),Ht=If(vt.stretch-ve,we,F,r.top),rn=ah(vt.fixed-Ke,dt,vt.stretch,K),Kt=If(yt.stretch-be,de,P,r.left),Sn=ah(yt.fixed-Ee,Je,yt.stretch,G),Ut=If(Mt.stretch-ve,we,F,r.top),gn=ah(Mt.fixed-Ke,dt,Mt.stretch,K),$n=new Ne(Rt,Ht),di=new Ne(Kt,Ht),Vn=new Ne(Kt,Ut),wn=new Ne(Rt,Ut),Si=new Ne(at/x,rn/x),In=new Ne(Sn/x,gn/x),Hn=e*Math.PI/180;if(Hn){const Ni=Math.sin(Hn),Bi=Math.cos(Hn),cr=[Bi,-Ni,Ni,Bi];$n._matMult(cr),di._matMult(cr),wn._matMult(cr),Vn._matMult(cr)}const Ei=rt.stretch+rt.fixed,Wi=vt.stretch+vt.fixed;return{tl:$n,tr:di,bl:wn,br:Vn,tex:{x:y.paddedRect.x+Kc+Ei,y:y.paddedRect.y+Kc+Wi,w:yt.stretch+yt.fixed-Ei,h:Mt.stretch+Mt.fixed-Wi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Si,pixelOffsetBR:In,minFontScaleX:Je/x/P,minFontScaleY:dt/x/F,isSDF:s}};if(u&&(y.stretchX||y.stretchY)){const rt=Bg(z,re,G),vt=Bg(U,he,K);for(let yt=0;yt<rt.length-1;yt++){const Mt=rt[yt],Rt=rt[yt+1];for(let at=0;at<vt.length-1;at++)m.push(Ot(Mt,vt[at],Rt,vt[at+1]))}}else m.push(Ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:S+1}));return m}function am(r,e,s){let u=0;for(const m of r)u+=Math.max(e,Math.min(s,m[1]))-Math.max(e,Math.min(s,m[0]));return u}function Bg(r,e,s){const u=[{fixed:-Kc,stretch:0}];for(const[m,y]of r){const x=u[u.length-1];u.push({fixed:m-x.stretch,stretch:x.stretch}),u.push({fixed:m-x.stretch,stretch:x.stretch+(y-m)})}return u.push({fixed:e+Kc,stretch:s}),u}function If(r,e,s,u){return r/e*s+u}function ah(r,e,s,u){return r-e*s/u}function yy(r,e,s,u){const m=e+r.positionedLines[u].lineOffset;return 0===u?s+m/2:s+(m+(e+r.positionedLines[u-1].lineOffset))/2}class zg{constructor(e=[],s=lh){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:u}=this,m=s[e];for(;e>0;){const y=e-1>>1,x=s[y];if(u(m,x)>=0)break;s[e]=x,e=y}s[e]=m}_down(e){const{data:s,compare:u}=this,m=this.length>>1,y=s[e];for(;e<m;){let x=1+(e<<1),D=s[x];const S=x+1;if(S<this.length&&u(s[S],D)<0&&(x=S,D=s[S]),u(D,y)>=0)break;s[e]=D,e=x}s[e]=y}}function lh(r,e){return r<e?-1:r>e?1:0}function Al(r,e=1,s=!1){let u=1/0,m=1/0,y=-1/0,x=-1/0;const D=r[0];for(let H=0;H<D.length;H++){const G=D[H];(!H||G.x<u)&&(u=G.x),(!H||G.y<m)&&(m=G.y),(!H||G.x>y)&&(y=G.x),(!H||G.y>x)&&(x=G.y)}const S=Math.min(y-u,x-m);let P=S/2;const F=new zg([],Ea);if(0===S)return new Ne(u,m);for(let H=u;H<y;H+=S)for(let G=m;G<x;G+=S)F.push(new vs(H+P,G+P,P,r));let z=function(H){let G=0,K=0,re=0;const he=H[0];for(let be=0,de=he.length,ve=de-1;be<de;ve=be++){const we=he[be],Ee=he[ve],Je=we.x*Ee.y-Ee.x*we.y;K+=(we.x+Ee.x)*Je,re+=(we.y+Ee.y)*Je,G+=3*Je}return new vs(K/G,re/G,0,H)}(r),U=F.length;for(;F.length;){const H=F.pop();(H.d>z.d||!z.d)&&(z=H,s&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,U)),H.max-z.d<=e||(P=H.h/2,F.push(new vs(H.p.x-P,H.p.y-P,P,r)),F.push(new vs(H.p.x+P,H.p.y-P,P,r)),F.push(new vs(H.p.x-P,H.p.y+P,P,r)),F.push(new vs(H.p.x+P,H.p.y+P,P,r)),U+=4)}return s&&(console.log(`num probes: ${U}`),console.log(`best distance: ${z.d}`)),z.p}function Ea(r,e){return e.max-r.max}class vs{constructor(e,s,u,m){this.p=new Ne(e,s),this.h=u,this.d=function(y,x){let D=!1,S=1/0;for(let P=0;P<x.length;P++){const F=x[P];for(let z=0,U=F.length,H=U-1;z<U;H=z++){const G=F[z],K=F[H];G.y>y.y!=K.y>y.y&&y.x<(K.x-G.x)*(y.y-G.y)/(K.y-G.y)+G.x&&(D=!D),S=Math.min(S,Zd(y,G,K))}}return(D?1:-1)*Math.sqrt(S)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const ch=7,Af=Number.POSITIVE_INFINITY,Vg=Math.sqrt(2);function uh(r,[e,s]){let u=0,m=0;if(s===Af){e<0&&(e=0);const y=e/Vg;switch(r){case"top-right":case"top-left":m=y-ch;break;case"bottom-right":case"bottom-left":m=-y+ch;break;case"bottom":m=-e+ch;break;case"top":m=e-ch}switch(r){case"top-right":case"bottom-right":u=-y;break;case"top-left":case"bottom-left":u=y;break;case"left":u=e;break;case"right":u=-e}}else{switch(e=Math.abs(e),s=Math.abs(s),r){case"top-right":case"top-left":case"top":m=s-ch;break;case"bottom-right":case"bottom-left":case"bottom":m=-s+ch}switch(r){case"top-right":case"bottom-right":case"right":u=-e;break;case"top-left":case"bottom-left":case"left":u=e}}return[u,m]}function vy(r,e,s,u,m,y,x,D,S,P){r.createArrays(),r.tilePixelRatio=mn/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const F=r.layers[0].layout,z=r.layers[0]._unevaluatedLayout._values,U={};if("composite"===r.textSizeData.kind){const{minZoom:K,maxZoom:re}=r.textSizeData;U.compositeTextSizes=[z["text-size"].possiblyEvaluate(new B(K),D),z["text-size"].possiblyEvaluate(new B(re),D)]}if("composite"===r.iconSizeData.kind){const{minZoom:K,maxZoom:re}=r.iconSizeData;U.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new B(K),D),z["icon-size"].possiblyEvaluate(new B(re),D)]}U.layoutTextSize=z["text-size"].possiblyEvaluate(new B(S+1),D),U.layoutIconSize=z["icon-size"].possiblyEvaluate(new B(S+1),D),U.textMaxSize=z["text-size"].possiblyEvaluate(new B(18),D);const H="map"===F.get("text-rotation-alignment")&&"point"!==F.get("symbol-placement"),G=F.get("text-size");for(const K of r.features){const re=F.get("text-font").evaluate(K,{},D).join(","),he=G.evaluate(K,{},D),be=U.layoutTextSize.evaluate(K,{},D),de=(U.layoutIconSize.evaluate(K,{},D),{horizontal:{},vertical:void 0}),ve=K.text;let we,Ee=[0,0];if(ve){const dt=ve.toString(),Ot=F.get("text-letter-spacing").evaluate(K,{},D)*Yr,rt=F.get("text-line-height").evaluate(K,{},D)*Yr,vt=R_(dt)?Ot:0,yt=F.get("text-anchor").evaluate(K,{},D),Mt=F.get("text-variable-anchor");if(!Mt){const Kt=F.get("text-radial-offset").evaluate(K,{},D);Ee=Kt?uh(yt,[Kt*Yr,Af]):F.get("text-offset").evaluate(K,{},D).map(Sn=>Sn*Yr)}let Rt=H?"center":F.get("text-justify").evaluate(K,{},D);const at="point"===F.get("symbol-placement"),Ht=at?F.get("text-max-width").evaluate(K,{},D)*Yr:1/0,rn=Kt=>{r.allowVerticalPlacement&&yr(dt)&&(de.vertical=rm(ve,e,s,m,re,Ht,rt,yt,Kt,vt,Ee,Ns.vertical,!0,be,he))};if(!H&&Mt){const Kt="auto"===Rt?Mt.map(Ut=>Ku(Ut)):[Rt];let Sn=!1;for(let Ut=0;Ut<Kt.length;Ut++){const gn=Kt[Ut];if(!de.horizontal[gn])if(Sn)de.horizontal[gn]=de.horizontal[0];else{const $n=rm(ve,e,s,m,re,Ht,rt,"center",gn,vt,Ee,Ns.horizontal,!1,be,he);$n&&(de.horizontal[gn]=$n,Sn=1===$n.positionedLines.length)}}rn("left")}else{if("auto"===Rt&&(Rt=Ku(yt)),at||F.get("text-writing-mode").indexOf("horizontal")>=0||!yr(dt)){const Kt=rm(ve,e,s,m,re,Ht,rt,yt,Rt,vt,Ee,Ns.horizontal,!1,be,he);Kt&&(de.horizontal[Rt]=Kt)}rn(at?"left":Rt)}}let Je=!1;if(K.icon&&K.icon.name){const dt=u[K.icon.name];dt&&(we=Og(m[K.icon.name],F.get("icon-offset").evaluate(K,{},D),F.get("icon-anchor").evaluate(K,{},D)),Je=dt.sdf,void 0===r.sdfIcons?r.sdfIcons=dt.sdf:r.sdfIcons!==dt.sdf&&qn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(dt.pixelRatio!==r.pixelRatio||0!==F.get("icon-rotate").constantOr(1))&&(r.iconsNeedLinear=!0))}const Ke=Ug(de.horizontal)||de.vertical;r.iconsInText||(r.iconsInText=!!Ke&&Ke.iconsInText),(Ke||we)&&Pl(r,K,de,we,u,U,be,0,Ee,Je,x,D,P)}y&&r.generateCollisionDebugBuffers(S,r.collisionBoxArray)}function Ku(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pl(r,e,s,u,m,y,x,D,S,P,F,z,U){let H=y.textMaxSize.evaluate(e,{},z);void 0===H&&(H=x);const G=r.layers[0].layout,K=G.get("icon-offset").evaluate(e,{},z),re=Ug(s.horizontal)||s.vertical,he="globe"===U.name,be=Yr,de=x/be,ve=r.tilePixelRatio*H/be,we=(yt=r.overscaling,r.zoom>18&&yt>2&&(yt>>=1),Math.max(mn/(512*yt),1)*G.get("symbol-spacing")),Ee=G.get("text-padding")*r.tilePixelRatio,Je=G.get("icon-padding")*r.tilePixelRatio,Ke=kt(G.get("text-max-angle")),dt="map"===G.get("text-rotation-alignment")&&"point"!==G.get("symbol-placement"),Ot="map"===G.get("icon-rotation-alignment")&&"point"!==G.get("symbol-placement"),rt=G.get("symbol-placement"),vt=we/2;var yt;const Mt=G.get("icon-text-fit");let Rt;u&&"none"!==Mt&&(r.allowVerticalPlacement&&s.vertical&&(Rt=xa(u,s.vertical,Mt,G.get("icon-text-fit-padding"),K,de)),re&&(u=xa(u,re,Mt,G.get("icon-text-fit-padding"),K,de)));const at=(Ht,rn,Kt)=>{if(rn.x<0||rn.x>=mn||rn.y<0||rn.y>=mn)return;let Sn=null;if(he){const{x:Ut,y:gn,z:$n}=U.projectTilePoint(rn.x,rn.y,Kt);Sn={anchor:new wa(Ut,gn,$n,0,void 0),up:U.upVector(Kt,rn.x,rn.y)}}!function(Ut,gn,$n,di,Vn,wn,Si,In,Hn,Ei,Wi,Ni,Bi,cr,ur,Cr,zi,Pr,Rr,tr,Di,Br,Ki,Ho,Wr){const Go=Ut.addToLineVertexArray(gn,di);let co,is,oo,kl,zf,bh,ru,Xg=0,bm=0,Ny=0,sd=0,Vf=-1,Kg=-1;const Vs={};let By=ja("");const ou=$n?$n.anchor:gn;let xm=0,wm=0;if(void 0===Hn._unevaluatedLayout.getValue("text-radial-offset")?[xm,wm]=Hn.layout.get("text-offset").evaluate(Di,{},Wr).map(Ta=>Ta*Yr):(xm=Hn.layout.get("text-radial-offset").evaluate(Di,{},Wr)*Yr,wm=Af),Ut.allowVerticalPlacement&&Vn.vertical){const Ta=Vn.vertical;if(ur)bh=lm(Ta),In&&(ru=lm(In));else{const uo=Hn.layout.get("text-rotate").evaluate(Di,{},Wr)+90;oo=Bs(Ei,ou,gn,Wi,Ni,Bi,Ta,cr,uo,Cr),In&&(kl=Bs(Ei,ou,gn,Wi,Ni,Bi,In,Pr,uo))}}if(wn){const Ta=Hn.layout.get("icon-rotate").evaluate(Di,{},Wr),uo="none"!==Hn.layout.get("icon-text-fit"),Cm=Ng(wn,Ta,Ki,uo),wh=In?Ng(In,Ta,Ki,uo):void 0;is=Bs(Ei,ou,gn,Wi,Ni,Bi,wn,Pr,Ta),Xg=4*Cm.length;const x0=Ut.iconSizeData;let ad=null;"source"===x0.kind?(ad=[ys*Hn.layout.get("icon-size").evaluate(Di,{},Wr)],ad[0]>vr&&qn(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${el}. Reduce your "icon-size".`)):"composite"===x0.kind&&(ad=[ys*Br.compositeIconSizes[0].evaluate(Di,{},Wr),ys*Br.compositeIconSizes[1].evaluate(Di,{},Wr)],(ad[0]>vr||ad[1]>vr)&&qn(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${el}. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,Cm,ad,tr,Rr,Di,!1,$n,gn,Go.lineStartIndex,Go.lineLength,-1,Ho,Wr),Vf=Ut.icon.placedSymbolArray.length-1,wh&&(bm=4*wh.length,Ut.addSymbols(Ut.icon,wh,ad,tr,Rr,Di,Ns.vertical,$n,gn,Go.lineStartIndex,Go.lineLength,-1,Ho,Wr),Kg=Ut.icon.placedSymbolArray.length-1)}for(const Ta in Vn.horizontal){const uo=Vn.horizontal[Ta];co||(By=ja(uo.text),ur?zf=lm(uo):co=Bs(Ei,ou,gn,Wi,Ni,Bi,uo,cr,Hn.layout.get("text-rotate").evaluate(Di,{},Wr),Cr));const Cm=1===uo.positionedLines.length;if(Ny+=Rl(Ut,$n,gn,uo,Si,Hn,ur,Di,Cr,Go,Vn.vertical?Ns.horizontal:Ns.horizontalOnly,Cm?Object.keys(Vn.horizontal):[Ta],Vs,Vf,Br,Ho,Wr),Cm)break}Vn.vertical&&(sd+=Rl(Ut,$n,gn,Vn.vertical,Si,Hn,ur,Di,Cr,Go,Ns.vertical,["vertical"],Vs,Kg,Br,Ho,Wr));let Ll=-1;const xh=(Ta,uo)=>Ta?Math.max(Ta,uo):uo;Ll=xh(zf,Ll),Ll=xh(bh,Ll),Ll=xh(ru,Ll);const Em=Ll>-1?1:0;Ut.glyphOffsetArray.length>=tl.MAX_GLYPHS&&qn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Di.sortKey&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,Di.sortKey),Ut.symbolInstances.emplaceBack(ou.x,ou.y,ou.z,gn.x,gn.y,Vs.right>=0?Vs.right:-1,Vs.center>=0?Vs.center:-1,Vs.left>=0?Vs.left:-1,Vs.vertical>=0?Vs.vertical:-1,Vf,Kg,By,void 0!==co?co:Ut.collisionBoxArray.length,void 0!==co?co+1:Ut.collisionBoxArray.length,void 0!==oo?oo:Ut.collisionBoxArray.length,void 0!==oo?oo+1:Ut.collisionBoxArray.length,void 0!==is?is:Ut.collisionBoxArray.length,void 0!==is?is+1:Ut.collisionBoxArray.length,kl||Ut.collisionBoxArray.length,kl?kl+1:Ut.collisionBoxArray.length,Wi,Ny,sd,Xg,bm,Em,0,xm,wm,Ll)}(r,rn,Sn,Ht,s,u,m,Rt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,Ee,dt,S,0,Je,Ot,K,e,y,P,F,z)};if("line"===rt)for(const Ht of om(e.geometry,0,0,mn,mn)){const rn=Lg(Ht,we,Ke,s.vertical||re,u,be,ve,r.overscaling,mn);for(const Kt of rn)re&&by(r,re.text,vt,Kt)||at(Ht,Kt,z)}else if("line-center"===rt){for(const Ht of e.geometry)if(Ht.length>1){const rn=ac(Ht,Ke,s.vertical||re,u,be,ve);rn&&at(Ht,rn,z)}}else if("Polygon"===e.type)for(const Ht of lo(e.geometry,0)){const rn=Al(Ht,16);at(Ht[0],new wa(rn.x,rn.y,0,0,void 0),z)}else if("LineString"===e.type)for(const Ht of e.geometry)at(Ht,new wa(Ht[0].x,Ht[0].y,0,0,void 0),z);else if("Point"===e.type)for(const Ht of e.geometry)for(const rn of Ht)at([rn],new wa(rn.x,rn.y,0,0,void 0),z)}const el=255,vr=el*ys;function Rl(r,e,s,u,m,y,x,D,S,P,F,z,U,H,G,K,re){const he=function(ve,we,Ee,Je,Ke,dt,Ot,rt){const vt=[];if(0===we.positionedLines.length)return vt;const yt=Je.layout.get("text-rotate").evaluate(dt,{})*Math.PI/180,Mt=function(Kt){const Sn=Kt[0],Ut=Kt[1],gn=Sn*Ut;return gn>0?[Sn,-Ut]:gn<0?[-Sn,Ut]:0===Sn?[Ut,Sn]:[Ut,-Sn]}(Ee);let Rt=Math.abs(we.top-we.bottom);for(const Kt of we.positionedLines)Rt-=Kt.lineOffset;const at=we.positionedLines.length,Ht=Rt/at;let rn=we.top-Ee[1];for(let Kt=0;Kt<at;++Kt){const Sn=we.positionedLines[Kt];rn=yy(we,Ht,rn,Kt);for(const Ut of Sn.positionedGlyphs){if(!Ut.rect)continue;const gn=Ut.rect||{};let $n=nm+1,di=!0,Vn=1,wn=0;if(Ut.imageName){const Ki=Ot[Ut.imageName];if(!Ki)continue;if(Ki.sdf){qn("SDF images are not supported in formatted text and will be ignored.");continue}di=!1,Vn=Ki.pixelRatio,$n=Fs/Vn}const Si=(Ke||rt)&&Ut.vertical,In=Ut.metrics.advance*Ut.scale/2,Hn=Ut.metrics,Ei=Ut.rect;if(null===Ei)continue;rt&&we.verticalizable&&(wn=Ut.imageName?In-Ut.metrics.width*Ut.scale/2:0);const Wi=Ke?[Ut.x+In,Ut.y]:[0,0];let Ni=[0,0],Bi=[0,0],cr=!1;Ke||(Si?(Bi=[Ut.x+In+Mt[0],Ut.y+Mt[1]-wn],cr=!0):Ni=[Ut.x+In+Ee[0],Ut.y+Ee[1]-wn]);const ur=Ei.w*Ut.scale/(Vn*(Ut.localGlyph?Qa:1)),Cr=Ei.h*Ut.scale/(Vn*(Ut.localGlyph?Qa:1));let zi,Pr,Rr,tr;if(Si){const Ki=Ut.y-rn,Ho=new Ne(-In,In-Ki),Wr=-Math.PI/2,Go=new Ne(...Bi);zi=new Ne(-In+Ni[0],Ni[1]),zi._rotateAround(Wr,Ho)._add(Go),zi.x+=-Ki+In,zi.y-=(Hn.left-$n)*Ut.scale;const co=Ut.imageName?Hn.advance*Ut.scale:Yr*Ut.scale,is=String.fromCharCode(Ut.glyph);Df(is)?zi.x+=(1-$n)*Ut.scale:Zu(is)?zi.x+=co-Hn.height*Ut.scale+(-$n-1)*Ut.scale:zi.x+=Ut.imageName||Hn.width+2*$n===Ei.w&&Hn.height+2*$n===Ei.h?(co-Cr)/2:(co-(Hn.height+2*$n)*Ut.scale)/2,Pr=new Ne(zi.x,zi.y-ur),Rr=new Ne(zi.x+Cr,zi.y),tr=new Ne(zi.x+Cr,zi.y-ur)}else{const Ki=(Hn.left-$n)*Ut.scale-In+Ni[0],Ho=(-Hn.top-$n)*Ut.scale+Ni[1],Wr=Ki+ur,Go=Ho+Cr;zi=new Ne(Ki,Ho),Pr=new Ne(Wr,Ho),Rr=new Ne(Ki,Go),tr=new Ne(Wr,Go)}if(yt){let Ki;Ki=Ke?new Ne(0,0):cr?new Ne(Mt[0],Mt[1]):new Ne(Ee[0],Ee[1]),zi._rotateAround(yt,Ki),Pr._rotateAround(yt,Ki),Rr._rotateAround(yt,Ki),tr._rotateAround(yt,Ki)}const Di=new Ne(0,0),Br=new Ne(0,0);vt.push({tl:zi,tr:Pr,bl:Rr,br:tr,tex:gn,writingMode:we.writingMode,glyphOffset:Wi,sectionIndex:Ut.sectionIndex,isSDF:di,pixelOffsetTL:Di,pixelOffsetBR:Br,minFontScaleX:0,minFontScaleY:0})}}return vt}(0,u,S,y,x,D,m,r.allowVerticalPlacement),be=r.textSizeData;let de=null;"source"===be.kind?(de=[ys*y.layout.get("text-size").evaluate(D,{},re)],de[0]>vr&&qn(`${r.layerIds[0]}: Value for "text-size" is >= ${el}. Reduce your "text-size".`)):"composite"===be.kind&&(de=[ys*G.compositeTextSizes[0].evaluate(D,{},re),ys*G.compositeTextSizes[1].evaluate(D,{},re)],(de[0]>vr||de[1]>vr)&&qn(`${r.layerIds[0]}: Value for "text-size" is >= ${el}. Reduce your "text-size".`)),r.addSymbols(r.text,he,de,S,x,D,F,e,s,P.lineStartIndex,P.lineLength,H,K,re);for(const ve of z)U[ve]=r.text.placedSymbolArray.length-1;return 4*he.length}function Ug(r){for(const e in r)return r[e];return null}function Bs(r,e,s,u,m,y,x,D,S,P){let F=x.top,z=x.bottom,U=x.left,H=x.right;const G=x.collisionPadding;if(G&&(U-=G[0],F-=G[1],H+=G[2],z+=G[3]),S){const K=new Ne(U,F),re=new Ne(H,F),he=new Ne(U,z),be=new Ne(H,z),de=kt(S);let ve=new Ne(0,0);P&&(ve=new Ne(P[0],P[1])),K._rotateAround(de,ve),re._rotateAround(de,ve),he._rotateAround(de,ve),be._rotateAround(de,ve),U=Math.min(K.x,re.x,he.x,be.x),H=Math.max(K.x,re.x,he.x,be.x),F=Math.min(K.y,re.y,he.y,be.y),z=Math.max(K.y,re.y,he.y,be.y)}return r.emplaceBack(e.x,e.y,e.z,s.x,s.y,U,F,H,z,D,u,m,y),r.length-1}function lm(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function by(r,e,s,u){const m=r.compareText;if(e in m){const y=m[e];for(let x=y.length-1;x>=0;x--)if(u.dist(y[x])<s)return!0}else m[e]=[];return m[e].push(u),!1}function jg(r,e){const s=r.fovAboveCenter,u=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,m=(r._camera.position[2]*r.worldSize-u)/Math.cos(r._pitch),y=Math.sin(s)*m/Math.sin(Math.max(Math.PI/2-r._pitch-s,.01)),x=Math.sin(r._pitch)*y+m;return Math.min(1.01*x,m*(1/r._horizonShift))}function lc(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const s=Math.pow(2,-r.z),u=r.x*s,m=(r.x+1)*s,y=r.y*s,x=(r.y+1)*s,D=ms(u),S=ms(m),P=io(y),F=io(x),z=e.project(D,P),U=e.project(S,P),H=e.project(S,F),G=e.project(D,F);let K=Math.min(z.x,U.x,H.x,G.x),re=Math.min(z.y,U.y,H.y,G.y),he=Math.max(z.x,U.x,H.x,G.x),be=Math.max(z.y,U.y,H.y,G.y);const de=s/16;function ve(Ee,Je,Ke,dt,Ot,rt){const vt=(Ke+Ot)/2,yt=(dt+rt)/2,Mt=e.project(ms(vt),io(yt)),Rt=Math.max(0,K-Mt.x,re-Mt.y,Mt.x-he,Mt.y-be);K=Math.min(K,Mt.x),he=Math.max(he,Mt.x),re=Math.min(re,Mt.y),be=Math.max(be,Mt.y),Rt>de&&(ve(Ee,Mt,Ke,dt,vt,yt),ve(Mt,Je,vt,yt,Ot,rt))}ve(z,U,u,y,m,y),ve(U,H,m,y,m,x),ve(H,G,m,x,u,x),ve(G,z,u,x,u,y),K-=de,re-=de,he+=de,be+=de;const we=1/Math.max(he-K,be-re);return{scale:we,x:K*we,y:re*we,x2:he*we,y2:be*we,projection:e}}const d0=Uo(new Float32Array(16));class cc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,s){return{x:0,y:0,z:0}}unproject(e,s){return new Yi(0,0)}projectTilePoint(e,s,u){return{x:e,y:s,z:0}}locationPoint(e,s,u=!0){return e._coordinatePoint(e.locationCoordinate(s),u)}pixelsPerMeter(e,s){return $o(1,e)*s}pixelSpaceConversion(e,s,u){return 1}farthestPixelDistance(e){return jg(e,e.pixelsPerMeter)}pointCoordinate(e,s,u,m){const y=e.horizonLineFromTop(!1),x=new Ne(s,Math.max(y,u));return e.rayIntersectionCoordinate(e.pointRayIntersection(x,m))}pointCoordinate3D(e,s,u){const m=new Ne(s,u);if(e.elevation)return e.elevation.pointCoordinate(m);{const y=this.pointCoordinate(e,m.x,m.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(e,s){if(e.elevation)return!this.pointCoordinate3D(e,s.x,s.y);const u=e.horizonLineFromTop();return s.y<u}createInversionMatrix(e,s){return d0}createTileMatrix(e,s,u){let m,y,x;const D=u.canonical,S=Uo(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=lc(D,this);m=1,y=P.x+u.wrap*P.scale,x=P.y,vl(S,S,[m/P.scale,m/P.scale,e.pixelsPerMeter/s])}else m=s/e.zoomScale(D.z),y=(D.x+Math.pow(2,D.z)*u.wrap)*m,x=D.y*m;return Nd(S,S,[y,x,0]),vl(S,S,[m/mn,m/mn,1]),S}upVector(e,s,u){return[0,0,1]}upVectorScale(e,s,u){return{metersToTile:1}}}class h0 extends cc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[s,u]=this.parallels=e.parallels||[29.5,45.5],m=Math.sin(kt(s));this.n=(m+Math.sin(kt(u)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(e,s){const{n:u,c:m,r0:y}=this,x=kt(e-this.center[0]),D=kt(s),S=Math.sqrt(m-2*u*Math.sin(D))/u;return{x:S*Math.sin(x*u),y:S*Math.cos(x*u)-y,z:0}}unproject(e,s){const{n:u,c:m,r0:y}=this,x=y+s;let D=Math.atan2(e,Math.abs(x))*Math.sign(x);x*u<0&&(D-=Math.PI*Math.sign(e)*Math.sign(x));const S=kt(this.center[0])*u;D=Ci(D,-Math.PI-S,Math.PI-S);const P=Wn(Yt(D/u)+this.center[0],-180,180),F=Math.asin(Wn((m-(e*e+x*x)*u*u)/(2*u),-1,1)),z=Wn(Yt(F),-Hr,Hr);return new Yi(P,z)}}const Pf=1.340264,uc=-.081106,Ju=893e-6,Rf=.003796,dh=Math.sqrt(3)/2;class Of extends cc{project(e,s){s=s/180*Math.PI,e=e/180*Math.PI;const u=Math.asin(dh*Math.sin(s)),m=u*u,y=m*m*m;return{x:.5*(e*Math.cos(u)/(dh*(Pf+3*uc*m+y*(7*Ju+9*Rf*m)))/Math.PI+.5),y:1-.5*(u*(Pf+uc*m+y*(Ju+Rf*m))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,m=u*u,y=m*m*m;for(let F,z,U,H=0;H<12&&(z=u*(Pf+uc*m+y*(Ju+Rf*m))-s,U=Pf+3*uc*m+y*(7*Ju+9*Rf*m),F=z/U,u=Wn(u-F,-Math.PI/3,Math.PI/3),m=u*u,y=m*m*m,!(Math.abs(F)<1e-12));++H);const x=dh*e*(Pf+3*uc*m+y*(7*Ju+9*Rf*m))/Math.cos(u),D=Math.asin(Math.sin(u)/dh),S=Wn(180*x/Math.PI,-180,180),P=Wn(180*D/Math.PI,-Hr,Hr);return new Yi(S,P)}}class xy extends cc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){return{x:.5+e/360,y:.5-s/360,z:0}}unproject(e,s){const u=360*(e-.5),m=Wn(360*(.5-s),-Hr,Hr);return new Yi(u,m)}}const Jc=Math.PI/2;function hh(r){return Math.tan((Jc+r)/2)}class li extends cc{constructor(e){super(e),this.center=e.center||[0,30];const[s,u]=this.parallels=e.parallels||[30,30];let m=kt(s),y=kt(u);this.southernCenter=m+y<0,this.southernCenter&&(m=-m,y=-y);const x=Math.cos(m),D=hh(m);this.n=m===y?Math.sin(m):Math.log(x/Math.cos(y))/Math.log(hh(y)/D),this.f=x*Math.pow(hh(m),this.n)/this.n}project(e,s){s=kt(s),this.southernCenter&&(s=-s),e=kt(e-this.center[0]);const u=1e-6,{n:m,f:y}=this;y>0?s<-Jc+u&&(s=-Jc+u):s>Jc-u&&(s=Jc-u);const x=y/Math.pow(hh(s),m);let D=x*Math.sin(m*e),S=y-x*Math.cos(m*e);return D=.5*(D/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:D,y:this.southernCenter?S:1-S,z:0}}unproject(e,s){e=(2*e-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:u,f:m}=this,y=m-s,x=Math.sign(y),D=Math.sign(u)*Math.sqrt(e*e+y*y);let S=Math.atan2(e,Math.abs(y))*x;y*u<0&&(S-=Math.PI*Math.sign(e)*x);const P=Wn(Yt(S/u)+this.center[0],-180,180),F=Wn(Yt(2*Math.atan(Math.pow(m/D,1/u))-Jc),-Hr,Hr);return new Yi(P,this.southernCenter?-F:F)}}class cm extends cc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,s){return{x:wl(e),y:va(s),z:0}}unproject(e,s){const u=ms(e),m=io(s);return new Yi(u,m)}}const kf=kt(Hr);class Qu extends cc{project(e,s){const u=(s=kt(s))*s,m=u*u;return{x:.5*((e=kt(e))*(.8707-.131979*u+m*(m*(.003971*u-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+u*(.015085+m*(.028874*u-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,m=25,y=0,x=u*u;do{x=u*u;const P=x*x;y=(u*(1.007226+x*(.015085+P*(.028874*x-.044475-.005916*P)))-s)/(1.007226+x*(.045255+P*(.259866*x-.311325-.005916*11*P))),u=Wn(u-y,-kf,kf)}while(Math.abs(y)>1e-6&&--m>0);x=u*u;const D=Wn(Yt(e/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),S=Yt(u);return new Yi(D,S)}}const um=kt(Hr);class wy extends cc{project(e,s){s=kt(s),e=kt(e);const u=Math.cos(s),m=2/Math.PI,y=Math.acos(u*Math.cos(e/2)),x=Math.sin(y)/y,D=.5*(e*m+2*u*Math.sin(e/2)/x)||0,S=.5*(s+Math.sin(s)/x)||0;return{x:.5*(D/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(e,s){let u=e=(2*e-.5)*Math.PI,m=s=(2*(1-s)-1)*Math.PI,y=25;const x=1e-6;let D=0,S=0;do{const P=Math.cos(m),F=Math.sin(m),z=2*F*P,U=F*F,H=P*P,G=Math.cos(u/2),K=Math.sin(u/2),re=2*G*K,he=K*K,be=1-H*G*G,de=be?1/be:0,ve=be?Math.acos(P*G)*Math.sqrt(1/be):0,we=.5*(2*ve*P*K+2*u/Math.PI)-e,Ee=.5*(ve*F+m)-s,Je=.5*de*(H*he+ve*P*G*U)+1/Math.PI,Ke=de*(re*z/4-ve*F*K),dt=.125*de*(z*K-ve*F*H*re),Ot=.5*de*(U*G+ve*he*P)+.5,rt=Ke*dt-Ot*Je;D=(Ee*Ke-we*Ot)/rt,S=(we*dt-Ee*Je)/rt,u=Wn(u-D,-Math.PI,Math.PI),m=Wn(m-S,-um,um)}while((Math.abs(D)>x||Math.abs(S)>x)&&--y>0);return new Yi(Yt(u),Yt(m))}}class ed extends cc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(kt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){const{scale:u,cosPhi:m}=this;return{x:kt(e)*m*u+.5,y:-Math.sin(kt(s))/m*u+.5,z:0}}unproject(e,s){const{scale:u,cosPhi:m}=this,y=-(s-.5)/u,x=Wn(Yt((e-.5)/u)/m,-180,180),D=Math.asin(Wn(y*m,-1,1)),S=Wn(Yt(D),-Hr,Hr);return new Yi(x,S)}}class dc extends cm{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,s,u){const m=$d(e,s,u);return Fr(m,m,Mp(_a(u))),{x:m[0],y:m[1],z:m[2]}}locationPoint(e,s){const u=Hc(s.lat,s.lng),m=qr([],u),y=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(s),e._centerAltitude):e._centerAltitude;Kl(u,u,m,$o(1,0)*mn*y);const x=Uo(new Float64Array(16));return Au(x,e.pixelMatrix,e.globeMatrix),Fr(u,u,x),new Ne(u[0],u[1])}pixelsPerMeter(e,s){return $o(1,0)*s}pixelSpaceConversion(e,s,u){const m=$o(1,e)*s,y=wi($o(1,45)*s,m,u);return this.pixelsPerMeter(e,s)/y}createTileMatrix(e,s,u){const m=ig(_a(u.canonical));return Au(new Float64Array(16),e.globeMatrix,m)}createInversionMatrix(e,s){const{center:u}=e,m=Mp(_a(s));return gp(m,m,kt(u.lng)),L_(m,m,kt(u.lat)),vl(m,m,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(e,s,u,m){return tf(e,s,u,!0)||new Fu(0,0)}pointCoordinate3D(e,s,u){const m=this.pointCoordinate(e,s,u,0);return[m.x,m.y,m.z]}isPointAboveHorizon(e,s){return!tf(e,s.x,s.y,!1)}farthestPixelDistance(e){const s=function(m,y){const x=m.cameraToCenterDistance,D=m._centerAltitude*y,S=m._camera,P=m._camera.forward(),F=qa([],es([],P,-x),[0,0,D]),z=m.worldSize/(2*Math.PI),U=[0,0,-z],H=m.width/m.height,G=Math.tan(m.fovAboveCenter),K=es([],S.up(),G),re=es([],S.right(),G*H),he=qr([],qa([],qa([],P,K),re)),be=[];let de;if(new ga(F,he).closestPointOnSphere(U,z,be)){const ve=qa([],be,U),we=Xa([],ve,F);de=Math.cos(m.fovAboveCenter)*Bd(we)}else{const ve=Xa([],F,U),we=Xa([],U,F);qr(we,we);const Ee=Bd(ve)-z;de=Math.sqrt(Ee*(Ee+2*z));const Je=Math.acos(de/(z+Ee))-Math.acos(ma(P,we));de*=Math.cos(Je)}return 1.01*de}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),u=Hd(e.zoom);if(u>0){const m=jg(e,$o(1,e.center.lat)*e.worldSize),y=e.worldSize/(2*Math.PI),x=Math.max(e.width,e.height)/e.worldSize*Math.PI;return wi(s,m+y*(1-Math.cos(x)),Math.pow(u,10))}return s}upVector(e,s,u){return $d(s,u,e,1)}upVectorScale(e){return{metersToTile:xl(ec(_a(e)))}}}function Lf(r){const e=r.parallels,s=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new cm(r);case"equirectangular":return new xy(r);case"naturalEarth":return new Qu(r);case"equalEarth":return new Of(r);case"winkelTripel":return new wy(r);case"albers":return s?new ed(r):new h0(r);case"lambertConformalConic":return s?new ed(r):new li(r);case"globe":return new dc(r)}throw new Error(`Invalid projection name: ${r.name}`)}const fh=vf.types,$g=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ro(r,e,s,u,m,y,x,D,S,P,F,z,U){const H=D?Math.min(vr,Math.round(D[0])):0,G=D?Math.min(vr,Math.round(D[1])):0;r.emplaceBack(e,s,Math.round(32*u),Math.round(32*m),y,x,(H<<1)+(S?1:0),G,16*P,16*F,256*z,256*U)}function ia(r,e,s,u,m,y,x){r.emplaceBack(e,s,u,m,y,x)}function td(r,e,s,u,m){r.emplaceBack(e,s,u,m),r.emplaceBack(e,s,u,m),r.emplaceBack(e,s,u,m),r.emplaceBack(e,s,u,m)}function f0(r){for(const e of r.sections)if(Od(e.text))return!0;return!1}class dm{constructor(e){this.layoutVertexArray=new ft,this.indexArray=new an,this.programConfigurations=e,this.segments=new Ar,this.dynamicLayoutVertexArray=new _t,this.opacityVertexArray=new vn,this.placedSymbolArray=new Ir,this.globeExtVertexArray=new Ct}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,s,u,m){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,e0.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,$g,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Wp.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}dn(dm,"SymbolBuffers");class ph{constructor(e,s,u){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new u,this.segments=new Ar,this.collisionVertexArray=new Kn,this.collisionVertexArrayExt=new Mn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Zp.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,oh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}dn(ph,"CollisionBuffers");class tl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(x=>x.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Uo([]),this.placementViewportMatrix=Uo([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Wu(this.zoom,s["text-size"]),this.iconSizeData=Wu(this.zoom,s["icon-size"]);const u=this.layers[0].layout,m=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==y&&void 0!==m.constantOr(1),this.sortFeaturesByY=("viewport-y"===y||"auto"===y&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(x=>Ns[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new dm(new Xl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new dm(new Xl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Qo,this.lineVertexArray=new Xs,this.symbolInstances=new Pi}calculateGlyphDependencies(e,s,u,m,y){for(let x=0;x<e.length;x++)if(s[e.charCodeAt(x)]=!0,m&&y){const D=oc[e.charAt(x)];D&&(s[D.charCodeAt(0)]=!0)}}populate(e,s,u,m){const y=this.layers[0],x=y.layout,D="globe"===this.projection.name,S=x.get("text-font"),P=x.get("text-field"),F=x.get("icon-image"),z=("constant"!==P.value.kind||P.value.value instanceof qi&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&("constant"!==S.value.kind||S.value.value.length>0),U="constant"!==F.value.kind||!!F.value.value||Object.keys(F.parameters).length>0,H=x.get("symbol-sort-key");if(this.features=[],!z&&!U)return;const G=s.iconDependencies,K=s.glyphDependencies,re=s.availableImages,he=new B(this.zoom);for(const{feature:be,id:de,index:ve,sourceLayerIndex:we}of e){const Ee=y._featureFilter.needGeometry,Je=Bu(be,Ee);if(!y._featureFilter.filter(he,Je,u))continue;if(Ee||(Je.geometry=El(be,u,m)),D&&1!==be.type&&u.z<=5){const rt=Je.geometry,vt=.98078528056,yt=(Mt,Rt)=>ma($d(Mt.x,Mt.y,u,1),$d(Rt.x,Rt.y,u,1))<vt;for(let Mt=0;Mt<rt.length;Mt++)rt[Mt]=Uv(rt[Mt],yt)}let Ke,dt;if(z){const rt=y.getValueAndResolveTokens("text-field",Je,u,re),vt=qi.factory(rt);f0(vt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===M()||this.hasRTLText&&k.isParsed())&&(Ke=qc(vt,y,Je))}if(U){const rt=y.getValueAndResolveTokens("icon-image",Je,u,re);dt=rt instanceof yo?rt:yo.fromString(rt)}if(!Ke&&!dt)continue;const Ot=this.sortFeaturesByKey?H.evaluate(Je,{},u):void 0;if(this.features.push({id:de,text:Ke,icon:dt,index:ve,sourceLayerIndex:we,geometry:Je.geometry,properties:be.properties,type:fh[be.type],sortKey:Ot}),dt&&(G[dt.name]=!0),Ke){const rt=S.evaluate(Je,{},u).join(","),vt="map"===x.get("text-rotation-alignment")&&"point"!==x.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ns.vertical)>=0;for(const yt of Ke.sections)if(yt.image)G[yt.image.name]=!0;else{const Mt=yr(Ke.toString()),Rt=yt.fontStack||rt,at=K[Rt]=K[Rt]||{};this.calculateGlyphDependencies(yt.text,at,vt,this.allowVerticalPlacement,Mt)}}}"line"===x.get("symbol-placement")&&(this.features=function(be){const de={},ve={},we=[];let Ee=0;function Je(rt){we.push(be[rt]),Ee++}function Ke(rt,vt,yt){const Mt=ve[rt];return delete ve[rt],ve[vt]=Mt,we[Mt].geometry[0].pop(),we[Mt].geometry[0]=we[Mt].geometry[0].concat(yt[0]),Mt}function dt(rt,vt,yt){const Mt=de[vt];return delete de[vt],de[rt]=Mt,we[Mt].geometry[0].shift(),we[Mt].geometry[0]=yt[0].concat(we[Mt].geometry[0]),Mt}function Ot(rt,vt,yt){const Mt=yt?vt[0][vt[0].length-1]:vt[0][0];return`${rt}:${Mt.x}:${Mt.y}`}for(let rt=0;rt<be.length;rt++){const vt=be[rt],yt=vt.geometry,Mt=vt.text?vt.text.toString():null;if(!Mt){Je(rt);continue}const Rt=Ot(Mt,yt),at=Ot(Mt,yt,!0);if(Rt in ve&&at in de&&ve[Rt]!==de[at]){const Ht=dt(Rt,at,yt),rn=Ke(Rt,at,we[Ht].geometry);delete de[Rt],delete ve[at],ve[Ot(Mt,we[rn].geometry,!0)]=rn,we[Ht].geometry=null}else Rt in ve?Ke(Rt,at,yt):at in de?dt(Rt,at,yt):(Je(rt),de[Rt]=Ee-1,ve[at]=Ee-1)}return we.filter(rt=>rt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((be,de)=>be.sortKey-de.sortKey)}update(e,s,u,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,u,m),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,u,m))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Lf(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const u=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:m,y}of s)this.lineVertexArray.emplaceBack(m,y);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,s,u,m,y,x,D,S,P,F,z,U,H,G){const K=e.indexArray,re=e.layoutVertexArray,he=e.globeExtVertexArray,be=e.segments.prepareSegment(4*s.length,re,K,this.canOverlap?x.sortKey:void 0),de=this.glyphOffsetArray.length,ve=be.vertexLength,we=this.allowVerticalPlacement&&D===Ns.vertical?Math.PI/2:0,Ee=x.text&&x.text.sections;for(let Ke=0;Ke<s.length;Ke++){const{tl:dt,tr:Ot,bl:rt,br:vt,tex:yt,pixelOffsetTL:Mt,pixelOffsetBR:Rt,minFontScaleX:at,minFontScaleY:Ht,glyphOffset:rn,isSDF:Kt,sectionIndex:Sn}=s[Ke],Ut=be.vertexLength,gn=rn[1];if(ro(re,P.x,P.y,dt.x,gn+dt.y,yt.x,yt.y,u,Kt,Mt.x,Mt.y,at,Ht),ro(re,P.x,P.y,Ot.x,gn+Ot.y,yt.x+yt.w,yt.y,u,Kt,Rt.x,Mt.y,at,Ht),ro(re,P.x,P.y,rt.x,gn+rt.y,yt.x,yt.y+yt.h,u,Kt,Mt.x,Rt.y,at,Ht),ro(re,P.x,P.y,vt.x,gn+vt.y,yt.x+yt.w,yt.y+yt.h,u,Kt,Rt.x,Rt.y,at,Ht),S){const{x:$n,y:di,z:Vn}=S.anchor,[wn,Si,In]=S.up;ia(he,$n,di,Vn,wn,Si,In),ia(he,$n,di,Vn,wn,Si,In),ia(he,$n,di,Vn,wn,Si,In),ia(he,$n,di,Vn,wn,Si,In),td(e.dynamicLayoutVertexArray,$n,di,Vn,we)}else td(e.dynamicLayoutVertexArray,P.x,P.y,P.z,we);K.emplaceBack(Ut,Ut+1,Ut+2),K.emplaceBack(Ut+1,Ut+2,Ut+3),be.vertexLength+=4,be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(rn[0]),Ke!==s.length-1&&Sn===s[Ke+1].sectionIndex||e.programConfigurations.populatePaintArrays(re.length,x,x.index,{},H,G,Ee&&Ee[Sn])}const Je=S?S.anchor:P;e.placedSymbolArray.emplaceBack(Je.x,Je.y,Je.z,P.x,P.y,de,this.glyphOffsetArray.length-de,ve,F,z,P.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],D,0,!1,0,U,0)}_commitLayoutVertex(e,s,u,m,y,x,D){e.emplaceBack(s,u,m,y,x,Math.round(D.x),Math.round(D.y))}_addCollisionDebugVertices(e,s,u,m,y,x,D){const S=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),P=S.vertexLength,F=D.tileAnchorX,z=D.tileAnchorY;for(let H=0;H<4;H++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(s,-e.padding,-e.padding),u.collisionVertexArrayExt.emplaceBack(s,e.padding,-e.padding),u.collisionVertexArrayExt.emplaceBack(s,e.padding,e.padding),u.collisionVertexArrayExt.emplaceBack(s,-e.padding,e.padding),this._commitLayoutVertex(u.layoutVertexArray,m,y,x,F,z,new Ne(e.x1,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,y,x,F,z,new Ne(e.x2,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,y,x,F,z,new Ne(e.x2,e.y2)),this._commitLayoutVertex(u.layoutVertexArray,m,y,x,F,z,new Ne(e.x1,e.y2)),S.vertexLength+=4;const U=u.indexArray;U.emplaceBack(P,P+1),U.emplaceBack(P+1,P+2),U.emplaceBack(P+2,P+3),U.emplaceBack(P+3,P),S.primitiveLength+=4}_addTextDebugCollisionBoxes(e,s,u,m,y,x){for(let D=m;D<y;D++){const S=u.get(D),P=this.getSymbolInstanceTextSize(e,x,s,D);this._addCollisionDebugVertices(S,P,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(e,s,u,m,y,x){for(let D=m;D<y;D++){const S=u.get(D),P=this.getSymbolInstanceIconSize(e,s,x.placedIconSymbolIndex);this._addCollisionDebugVertices(S,P,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,x)}}generateCollisionDebugBuffers(e,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ph(sn,Ls.members,$r),this.iconCollisionBox=new ph(sn,Ls.members,$r);const u=rc(this.iconSizeData,e),m=rc(this.textSizeData,e);for(let y=0;y<this.symbolInstances.length;y++){const x=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(m,e,s,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(m,e,s,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(u,e,s,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(u,e,s,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,s,u,m){const y=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:m),x=Ml(this.textSizeData,e,y)/Yr;return this.tilePixelRatio*x}getSymbolInstanceIconSize(e,s,u){const m=this.icon.placedSymbolArray.get(u),y=Ml(this.iconSizeData,e,m);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(e,s,u){e.emplaceBack(s,-u,-u),e.emplaceBack(s,u,-u),e.emplaceBack(s,u,u),e.emplaceBack(s,-u,u)}_updateTextDebugCollisionBoxes(e,s,u,m,y,x){for(let D=m;D<y;D++){const S=u.get(D),P=this.getSymbolInstanceTextSize(e,x,s,D);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,P,S.padding)}}_updateIconDebugCollisionBoxes(e,s,u,m,y,x){for(let D=m;D<y;D++){const S=u.get(D),P=this.getSymbolInstanceIconSize(e,s,x);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,P,S.padding)}}updateCollisionDebugBuffers(e,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=rc(this.iconSizeData,e),m=rc(this.textSizeData,e);for(let y=0;y<this.symbolInstances.length;y++){const x=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(m,e,s,x.textBoxStartIndex,x.textBoxEndIndex,x),this._updateTextDebugCollisionBoxes(m,e,s,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._updateIconDebugCollisionBoxes(u,e,s,x.iconBoxStartIndex,x.iconBoxEndIndex,x.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,e,s,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,s,u,m,y,x,D,S,P){const F={};if(s<u){const{x1:z,y1:U,x2:H,y2:G,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve,featureIndex:we}=e.get(s);F.textBox={x1:z,y1:U,x2:H,y2:G,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve},F.textFeatureIndex=we}if(m<y){const{x1:z,y1:U,x2:H,y2:G,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve,featureIndex:we}=e.get(m);F.verticalTextBox={x1:z,y1:U,x2:H,y2:G,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve},F.verticalTextFeatureIndex=we}if(x<D){const{x1:z,y1:U,x2:H,y2:G,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve,featureIndex:we}=e.get(x);F.iconBox={x1:z,y1:U,x2:H,y2:G,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve},F.iconFeatureIndex=we}if(S<P){const{x1:z,y1:U,x2:H,y2:G,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve,featureIndex:we}=e.get(S);F.verticalIconBox={x1:z,y1:U,x2:H,y2:G,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:ve},F.verticalIconFeatureIndex=we}return F}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const u=e.placedSymbolArray.get(s),m=u.vertexStartIndex+4*u.numGlyphs;for(let y=u.vertexStartIndex;y<m;y+=4)e.indexArray.emplaceBack(y,y+1,y+2),e.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(e),u=Math.cos(e),m=[],y=[],x=[];for(let D=0;D<this.symbolInstances.length;++D){x.push(D);const S=this.symbolInstances.get(D);m.push(0|Math.round(s*S.tileAnchorX+u*S.tileAnchorY)),y.push(S.featureIndex)}return x.sort((D,S)=>m[D]-m[S]||y[S]-y[D]),x}addToSortKeyRanges(e,s){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:D,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:P}=u;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&y!==m&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&x!==y&&x!==m&&this.addIndicesForPlacedSymbol(this.text,x),D>=0&&this.addIndicesForPlacedSymbol(this.text,D),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}dn(tl,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),tl.MAX_GLYPHS=65535,tl.addDynamicAttributes=td;const Hg=new pe({"symbol-placement":new X(lt.layout_symbol["symbol-placement"]),"symbol-spacing":new X(lt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new X(lt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new oe(lt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new X(lt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new X(lt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new X(lt.layout_symbol["icon-ignore-placement"]),"icon-optional":new X(lt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new X(lt.layout_symbol["icon-rotation-alignment"]),"icon-size":new oe(lt.layout_symbol["icon-size"]),"icon-text-fit":new X(lt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new X(lt.layout_symbol["icon-text-fit-padding"]),"icon-image":new oe(lt.layout_symbol["icon-image"]),"icon-rotate":new oe(lt.layout_symbol["icon-rotate"]),"icon-padding":new X(lt.layout_symbol["icon-padding"]),"icon-keep-upright":new X(lt.layout_symbol["icon-keep-upright"]),"icon-offset":new oe(lt.layout_symbol["icon-offset"]),"icon-anchor":new oe(lt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new X(lt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new X(lt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new X(lt.layout_symbol["text-rotation-alignment"]),"text-field":new oe(lt.layout_symbol["text-field"]),"text-font":new oe(lt.layout_symbol["text-font"]),"text-size":new oe(lt.layout_symbol["text-size"]),"text-max-width":new oe(lt.layout_symbol["text-max-width"]),"text-line-height":new oe(lt.layout_symbol["text-line-height"]),"text-letter-spacing":new oe(lt.layout_symbol["text-letter-spacing"]),"text-justify":new oe(lt.layout_symbol["text-justify"]),"text-radial-offset":new oe(lt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new X(lt.layout_symbol["text-variable-anchor"]),"text-anchor":new oe(lt.layout_symbol["text-anchor"]),"text-max-angle":new X(lt.layout_symbol["text-max-angle"]),"text-writing-mode":new X(lt.layout_symbol["text-writing-mode"]),"text-rotate":new oe(lt.layout_symbol["text-rotate"]),"text-padding":new X(lt.layout_symbol["text-padding"]),"text-keep-upright":new X(lt.layout_symbol["text-keep-upright"]),"text-transform":new oe(lt.layout_symbol["text-transform"]),"text-offset":new oe(lt.layout_symbol["text-offset"]),"text-allow-overlap":new X(lt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new X(lt.layout_symbol["text-ignore-placement"]),"text-optional":new X(lt.layout_symbol["text-optional"])});var nd={paint:new pe({"icon-opacity":new oe(lt.paint_symbol["icon-opacity"]),"icon-color":new oe(lt.paint_symbol["icon-color"]),"icon-halo-color":new oe(lt.paint_symbol["icon-halo-color"]),"icon-halo-width":new oe(lt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new oe(lt.paint_symbol["icon-halo-blur"]),"icon-translate":new X(lt.paint_symbol["icon-translate"]),"icon-translate-anchor":new X(lt.paint_symbol["icon-translate-anchor"]),"text-opacity":new oe(lt.paint_symbol["text-opacity"]),"text-color":new oe(lt.paint_symbol["text-color"],{runtimeType:Oo,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new oe(lt.paint_symbol["text-halo-color"]),"text-halo-width":new oe(lt.paint_symbol["text-halo-width"]),"text-halo-blur":new oe(lt.paint_symbol["text-halo-blur"]),"text-translate":new X(lt.paint_symbol["text-translate"]),"text-translate-anchor":new X(lt.paint_symbol["text-translate-anchor"])}),layout:Hg};class Ey{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:zl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}dn(Ey,"FormatSectionOverride",{omit:["defaultValue"]});class mh extends Ga{constructor(e){super(e,nd)}recalculate(e,s){super.recalculate(e,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const m=[];for(const y of u)m.indexOf(y)<0&&m.push(y);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,s,u,m){const y=this.layout.get(e).evaluate(s,{},u,m),x=this._unevaluatedLayout._values[e];return x.isDataDriven()||Tc(x.value)||!y?y:(D=s.properties,y.replace(/{([^{}]+)}/g,(P,F)=>F in D?String(D[F]):""));var D}createBucket(e){return new tl(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of nd.paint.overridableProperties){if(!mh.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),u=new Ey(s),m=new xu(u,s.property.specification);let y=null;y="constant"===s.value.kind||"source"===s.value.kind?new da("source",m):new Sc("composite",m,s.value.zoomStops,s.value._interpolationType),this.paint._values[e]=new ae(s.property,y,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&mh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const u=e.get("text-field"),m=nd.paint.properties[s];let y=!1;const x=D=>{for(const S of D)if(m.overrides&&m.overrides.hasOverride(S))return void(y=!0)};if("constant"===u.value.kind&&u.value.value instanceof qi)x(u.value.value.sections);else if("source"===u.value.kind){const D=P=>{y||(P instanceof ln&&xr(P.value)===cl?x(P.value.sections):P instanceof Mr?x(P.sections):P.eachChild(D))},S=u.value;S._styleExpression&&D(S._styleExpression.expression)}return y}getProgramConfiguration(e){return new Nc(this,e)}}var p0={paint:new pe({"background-color":new X(lt.paint_background["background-color"]),"background-pattern":new X(lt.paint_background["background-pattern"]),"background-opacity":new X(lt.paint_background["background-opacity"])})},Ib={paint:new pe({"raster-opacity":new X(lt.paint_raster["raster-opacity"]),"raster-hue-rotate":new X(lt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new X(lt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new X(lt.paint_raster["raster-brightness-max"]),"raster-saturation":new X(lt.paint_raster["raster-saturation"]),"raster-contrast":new X(lt.paint_raster["raster-contrast"]),"raster-resampling":new X(lt.paint_raster["raster-resampling"]),"raster-fade-duration":new X(lt.paint_raster["raster-fade-duration"])})};class m0 extends Ga{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var g0={paint:new pe({"sky-type":new X(lt.paint_sky["sky-type"]),"sky-atmosphere-sun":new X(lt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new X(lt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new X(lt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new X(lt.paint_sky["sky-gradient-radius"]),"sky-gradient":new fe(lt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new X(lt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new X(lt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new X(lt.paint_sky["sky-opacity"])})};function Cy(r,e,s){const u=[0,0,1],m=Qh([]);return wp(m,m,s?-kt(r)+Math.PI:kt(r)),ef(m,m,-kt(e)),zv(u,u,m),qr(u,u)}const Ab={circle:class extends Ga{constructor(r){super(r,Xd)}createBucket(r){return new Vu(r)}queryRadius(r){const e=r;return tc("circle-radius",this,e)+tc("circle-stroke-width",this,e)+qd(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,s,u,m,y,x,D){const S=Yd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,r.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s);return Z_(r,u,y,x,D,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),S,P)}getProgramIds(){return["circle"]}getProgramConfiguration(r){return new Nc(this,r)}},heatmap:class extends Ga{createBucket(r){return new q_(r)}constructor(r){super(r,Y_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){"heatmap-color"===r&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Pp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return tc("heatmap-radius",this,r)}queryIntersectsFeature(r,e,s,u,m,y,x,D){const S=this.paint.get("heatmap-radius").evaluate(e,s);return Z_(r,u,y,x,D,!0,!0,new Ne(0,0),S)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(r){return new Nc(this,r)}},hillshade:class extends Ga{constructor(r){super(r,Gv)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ga{constructor(r){super(r,Hu)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),s=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(r){return new Nc(this,r)}recalculate(r,e){super.recalculate(r,e);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new eh(r)}queryRadius(){return qd(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,s,u,m,y){return!r.queryGeometry.isAboveHorizon&&ag(Wc(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,r.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Ga{constructor(r){super(r,Ef)}createBucket(r){return new Vp(r)}queryRadius(){return qd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(r){return new Nc(this,r)}queryIntersectsFeature(r,e,s,u,m,y,x,D,S){const P=Yd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,r.pixelToTileUnitsFactor),F=this.paint.get("fill-extrusion-height").evaluate(e,s),z=this.paint.get("fill-extrusion-base").evaluate(e,s),U=[0,0],H=D&&y.elevation,G=y.elevation?y.elevation.exaggeration():1,K=r.tile.getBucket(this);if(H&&K instanceof Vp){const ve=K.centroidVertexArray,we=S+1;we<ve.length&&(U[0]=ve.geta_centroid_pos0(we),U[1]=ve.geta_centroid_pos1(we))}if(0===U[0]&&1===U[1])return!1;"globe"===y.projection.name&&(u=ry([u],[new Ne(0,0),new Ne(mn,mn)],r.tileID.canonical).map(ve=>ve.polygon).flat());const re=H?D:null,[he,be]=(we=u,Ee=z,Je=F,Ke=P,dt=x,Ot=re,rt=U,vt=G,yt=y.center.lat,"globe"===(ve=y).projection.name?function(Rt,at,Ht,rn,Kt,Sn,Ut,gn,$n,di,Vn){const wn=[],Si=[],In=Rt.projection.upVectorScale(Vn,Rt.center.lat,Rt.worldSize).metersToTile,Hn=[0,0,0,1],Ei=[0,0,0,1],Wi=(Bi,cr,ur,Cr)=>{Bi[0]=cr,Bi[1]=ur,Bi[2]=Cr,Bi[3]=1},Ni=wf();Ht>0&&(Ht+=Ni),rn+=Ni;for(const Bi of at){const cr=[],ur=[];for(const Cr of Bi){const zi=Cr.x+Kt.x,Pr=Cr.y+Kt.y,Rr=Rt.projection.projectTilePoint(zi,Pr,Vn),tr=Rt.projection.upVector(Vn,Cr.x,Cr.y);let Di=Ht,Br=rn;if(Ut){const Ki=$p(zi,Pr,Ht,rn,Ut,gn,$n,di);Di+=Ki.base,Br+=Ki.top}0!==Ht?Wi(Hn,Rr.x+tr[0]*In*Di,Rr.y+tr[1]*In*Di,Rr.z+tr[2]*In*Di):Wi(Hn,Rr.x,Rr.y,Rr.z),Wi(Ei,Rr.x+tr[0]*In*Br,Rr.y+tr[1]*In*Br,Rr.z+tr[2]*In*Br),Fr(Hn,Hn,Sn),Fr(Ei,Ei,Sn),cr.push(new ih(Hn[0],Hn[1],Hn[2])),ur.push(new ih(Ei[0],Ei[1],Ei[2]))}wn.push(cr),Si.push(ur)}return[wn,Si]}(ve,we,Ee,Je,Ke,dt,Ot,rt,vt,yt,r.tileID.canonical):Ot?function(Rt,at,Ht,rn,Kt,Sn,Ut,gn,$n){const di=[],Vn=[],wn=[0,0,0,1];for(const Si of Rt){const In=[],Hn=[];for(const Ei of Si){const Wi=Ei.x+rn.x,Ni=Ei.y+rn.y,Bi=$p(Wi,Ni,at,Ht,Sn,Ut,gn,$n);wn[0]=Wi,wn[1]=Ni,wn[2]=Bi.base,wn[3]=1,Vc(wn,wn,Kt),wn[3]=Math.max(wn[3],1e-5);const cr=new ih(wn[0]/wn[3],wn[1]/wn[3],wn[2]/wn[3]);wn[0]=Wi,wn[1]=Ni,wn[2]=Bi.top,wn[3]=1,Vc(wn,wn,Kt),wn[3]=Math.max(wn[3],1e-5);const ur=new ih(wn[0]/wn[3],wn[1]/wn[3],wn[2]/wn[3]);In.push(cr),Hn.push(ur)}di.push(In),Vn.push(Hn)}return[di,Vn]}(we,Ee,Je,Ke,dt,Ot,rt,vt,yt):function(Rt,at,Ht,rn,Kt){const Sn=[],Ut=[],gn=Kt[8]*at,$n=Kt[9]*at,di=Kt[10]*at,Vn=Kt[11]*at,wn=Kt[8]*Ht,Si=Kt[9]*Ht,In=Kt[10]*Ht,Hn=Kt[11]*Ht;for(const Ei of Rt){const Wi=[],Ni=[];for(const Bi of Ei){const cr=Bi.x+rn.x,ur=Bi.y+rn.y,Cr=Kt[0]*cr+Kt[4]*ur+Kt[12],zi=Kt[1]*cr+Kt[5]*ur+Kt[13],Pr=Kt[2]*cr+Kt[6]*ur+Kt[14],Rr=Kt[3]*cr+Kt[7]*ur+Kt[15],tr=Cr+gn,Di=zi+$n,Br=Pr+di,Ki=Math.max(Rr+Vn,1e-5),Ho=Cr+wn,Wr=zi+Si,Go=Pr+In,co=Math.max(Rr+Hn,1e-5);Wi.push(new ih(tr/Ki,Di/Ki,Br/Ki)),Ni.push(new ih(Ho/co,Wr/co,Go/co))}Sn.push(Wi),Ut.push(Ni)}return[Sn,Ut]}(we,Ee,Je,Ke,dt)),de=r.queryGeometry;var ve,we,Ee,Je,Ke,dt,Ot,rt,vt,yt;return function(ve,we,Ee){let Je=1/0;ag(Ee,we)&&(Je=on(Ee,we[0]));for(let Ke=0;Ke<we.length;Ke++){const dt=we[Ke],Ot=ve[Ke];for(let rt=0;rt<dt.length-1;rt++){const vt=dt[rt],yt=[vt,dt[rt+1],Ot[rt+1],Ot[rt],vt];Cl(Ee,yt)&&(Je=Math.min(Je,on(Ee,yt)))}}return Je!==1/0&&Je}(he,be,de.isPointQuery()?de.screenBounds:de.screenGeometry)}},line:class extends Ga{constructor(r){super(r,na),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if("line-gradient"===r){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Nm,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=Jv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new rh(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(r){return new Nc(this,r)}queryRadius(r){const e=r,s=Qv(tc("line-width",this,e),tc("line-gap-width",this,e)),u=tc("line-offset",this,e);return s/2+Math.abs(u)+qd(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,s,u,m,y){if(r.queryGeometry.isAboveHorizon)return!1;const x=Wc(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,r.pixelToTileUnitsFactor),D=r.pixelToTileUnitsFactor/2*Qv(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),S=this.paint.get("line-offset").evaluate(e,s);return S&&(u=function(P,F){const z=[],U=new Ne(0,0);for(let H=0;H<P.length;H++){const G=P[H],K=[];for(let re=0;re<G.length;re++){const he=G[re],be=G[re+1],de=0===re?U:he.sub(G[re-1])._unit()._perp(),ve=re===G.length-1?U:be.sub(he)._unit()._perp(),we=de._add(ve)._unit();we._mult(1/(we.x*ve.x+we.y*ve.y)),K.push(we._mult(F)._add(he))}z.push(K)}return z}(u,S*r.pixelToTileUnitsFactor)),function(P,F,z){for(let U=0;U<F.length;U++){const H=F[U];if(P.length>=3)for(let G=0;G<H.length;G++)if(Gc(P,H[G]))return!0;if(lg(P,H,z))return!0}return!1}(x,u,D)}isTileClipped(){return!0}},symbol:mh,background:class extends Ga{constructor(r){super(r,p0)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ga{constructor(r){super(r,Ib)}getProgramIds(){return["raster"]}},sky:class extends Ga{constructor(r){super(r,g0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){"sky-gradient"===r?this._updateColorRamp():"sky-atmosphere-sun"!==r&&"sky-atmosphere-halo-color"!==r&&"sky-atmosphere-color"!==r&&"sky-atmosphere-sun-intensity"!==r||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Pp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),m=!u,y=r.style.light,x=y.properties.get("position");return m&&"viewport"===y.properties.get("anchor")&&qn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?Cy(x.azimuthal,90-x.polar,e):Cy(u[0],90-u[1],e)}const s=this.paint.get("sky-gradient-center");return Cy(s[0],90-s[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return"atmosphere"===r?["skyboxCapture","skybox"]:"gradient"===r?["skyboxGradient"]:null}}};class ts{constructor(e,s,u,m){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(s,m)}update(e,s,u){const{width:m,height:y}=e,{context:x}=this,{gl:D}=x,{HTMLImageElement:S,HTMLCanvasElement:P,HTMLVideoElement:F,ImageData:z,ImageBitmap:U}=ue;if(D.bindTexture(D.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!s||!1!==s.premultiply)),u||this.size&&this.size[0]===m&&this.size[1]===y){const{x:H,y:G}=u||{x:0,y:0};e instanceof S||e instanceof P||e instanceof F||e instanceof z||U&&e instanceof U?D.texSubImage2D(D.TEXTURE_2D,0,H,G,D.RGBA,D.UNSIGNED_BYTE,e):D.texSubImage2D(D.TEXTURE_2D,0,H,G,m,y,D.RGBA,D.UNSIGNED_BYTE,e.data)}else this.size=[m,y],e instanceof S||e instanceof P||e instanceof F||e instanceof z||U&&e instanceof U?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,e):D.texImage2D(D.TEXTURE_2D,0,this.format,m,y,0,this.format,D.UNSIGNED_BYTE,e.data);this.useMipmap=!!(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&D.generateMipmap(D.TEXTURE_2D)}bind(e,s){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_NEAREST:e),this.filter=e),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Pb{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class _0{constructor(){this.tasks={},this.taskQueue=[],mt(["process"],this),this.invoker=new Pb(this.process),this.nextId=0}add(e,s){const u=this.nextId++,m=function({type:y,isSymbolTile:x,zoom:D}){return D=D||0,"message"===y?0:"maybePrepare"!==y||x?"parseTile"!==y||x?"parseTile"===y&&x?300-D:"maybePrepare"===y&&x?400-D:500:200-D:100-D}(s);if(0===m){Ii();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:e,metadata:s,priority:m,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){Ii();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const s=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let e=null,s=1/0;for(let m=0;m<this.taskQueue.length;m++){const y=this.tasks[this.taskQueue[m]];y.priority<s&&(s=y.priority,e=m)}if(null===e)return null;const u=this.taskQueue[e];return this.taskQueue.splice(e,1),u}remove(){this.invoker.remove()}}class Dy{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const u=e[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Ty=["tile","layer","source","sourceLayer","state"];class My{constructor(e,s,u,m,y){this.type="Feature",this._vectorTileFeature=e,this._z=s,this._x=u,this._y=m,this.properties=e.properties,this.id=y}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const s of Ty)void 0!==this[s]&&(e[s]=this[s]);return e}}const il=new Uint16Array(8184);for(let r=0;r<2046;r++){let e=r+2,s=0,u=0,m=0,y=0,x=0,D=0;for(1&e?m=y=x=32:s=u=D=32;(e>>=1)>1;){const P=s+m>>1,F=u+y>>1;1&e?(m=s,y=u,s=x,u=D):(s=m,u=y,m=x,y=D),x=P,D=F}const S=4*r;il[S+0]=s,il[S+1]=u,il[S+2]=m,il[S+3]=y}const ns=new Uint16Array(2178),Ca=new Uint8Array(1089),gh=new Uint16Array(1089);function hm(r){return 0===r?-.03125:32===r?.03125:0}var fm=Oe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Sy={type:2,extent:mn,loadGeometry:()=>[[new Ne(0,0),new Ne(mn+1,0),new Ne(mn+1,mn+1),new Ne(0,mn+1),new Ne(0,0)]]};class _h{constructor(e,s,u,m,y){this.tileID=e,this.uid=xt(),this.uses=0,this.tileSize=s,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(e){const s=e+this.timeAdded;s<_o.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=lc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,s,u){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(m,y){const x={};if(!y)return x;for(const D of m){const S=D.layerIds.map(P=>y.getLayer(P)).filter(Boolean);if(0!==S.length){D.layers=S,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(P=>S.filter(F=>F.id===P)[0]));for(const P of S)x[P.id]=D}}return x}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof tl){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof tl&&y.hasRTLText){this.hasRTLText=!0,k.isLoading()||k.isLoaded()||"deferred"!==M()||O();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(m).queryRadius(y))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new gi}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const m=this.buckets[u];m.uploadPending()&&m.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ts(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ts(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ts(e,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,u,m,y,x,D,S){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:D,transform:x,params:y,tileTransform:this.tileTransform},e,s,u):{}}querySourceFeatures(e,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const m=u.loadVTLayers(),y=s?s.sourceLayer:"",x=m._geojsonTileLayer||m[y];if(!x)return;const D=ha(s&&s.filter),{z:S,x:P,y:F}=this.tileID.canonical,z={z:S,x:P,y:F};for(let U=0;U<x.length;U++){const H=x.feature(U);if(D.needGeometry){const re=Bu(H,!0);if(!D.filter(new B(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!D.filter(new B(this.tileID.overscaledZ),H))continue;const G=u.getId(H,y),K=new My(H,S,P,F,G);K.tile=z,e.push(K)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const u=rr(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let m=!1;if(this.expirationTime>u)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{const y=this.expirationTime-s;y?this.expirationTime=u+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!s)return;const u=this.latestFeatureIndex.loadVTLayers(),m=s.style.listImages();for(const y in this.buckets){if(!s.style.hasLayer(y))continue;const x=this.buckets[y],D=x.layers[0].sourceLayer||"_geojsonTileLayer",S=u[D],P=e[D];if(!S||!P||0===Object.keys(P).length)continue;if(x.update(P,S,m,this.imageAtlas&&this.imageAtlas.patternPositions||{}),x instanceof rh||x instanceof eh){const z=s.style._getSourceCache(x.layers[0].source);s._terrain&&s._terrain.enabled&&z&&x.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(z.id,this.tileID)}const F=s&&s.style&&s.style.getLayer(y);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(x)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=_o.now()+e}setTexture(e,s){const u=s.context,m=u.gl;this.texture=this.texture||s.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new ts(u,e,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(e,s){const u={};for(const m of s)u[m]=!0;this.dependencies[e]=u}hasDependency(e,s){for(const u of e){const m=this.dependencies[u];if(m)for(const y of s)if(m[y])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const u=El(Sy,this.tileID.canonical,this.tileTransform)[0],m=new At,y=new zn;for(let x=0;x<u.length;x++){const{x:D,y:S}=u[x];m.emplaceBack(D,S),y.emplaceBack(x)}y.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(m,Pu.members),this._tileDebugSegments=Ar.simpleSegment(0,0,m.length,y.length)}_makeTileBoundsBuffers(e,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const u=El(Sy,this.tileID.canonical,this.tileTransform)[0];let m,y;if(this.isRaster){const x=function(D,S){const P=lc(D,S),F=Math.pow(2,D.z);for(let re=0;re<33;re++)for(let he=0;he<33;he++){const be=ms((D.x+(he+hm(he))/32)/F),de=io((D.y+(re+hm(re))/32)/F),ve=S.project(be,de),we=33*re+he;ns[2*we+0]=Math.round((ve.x*P.scale-P.x)*mn),ns[2*we+1]=Math.round((ve.y*P.scale-P.y)*mn)}Ca.fill(0),gh.fill(0);for(let re=2045;re>=0;re--){const he=4*re,be=il[he+0],de=il[he+1],ve=il[he+2],we=il[he+3],Ee=be+ve>>1,Je=de+we>>1,Ke=Ee+Je-de,dt=Je+be-Ee,Ot=33*de+be,rt=33*we+ve,vt=33*Je+Ee,yt=Math.hypot((ns[2*Ot+0]+ns[2*rt+0])/2-ns[2*vt+0],(ns[2*Ot+1]+ns[2*rt+1])/2-ns[2*vt+1])>=16;Ca[vt]=Ca[vt]||(yt?1:0),re<1022&&(Ca[vt]=Ca[vt]||Ca[33*(de+dt>>1)+(be+Ke>>1)]||Ca[33*(we+dt>>1)+(ve+Ke>>1)])}const z=new ht,U=new an;let H=0;function G(re,he){const be=33*he+re;return 0===gh[be]&&(z.emplaceBack(ns[2*be+0],ns[2*be+1],re*mn/32,he*mn/32),gh[be]=++H),gh[be]-1}function K(re,he,be,de,ve,we){const Ee=re+be>>1,Je=he+de>>1;if(Math.abs(re-ve)+Math.abs(he-we)>1&&Ca[33*Je+Ee])K(ve,we,re,he,Ee,Je),K(be,de,ve,we,Ee,Je);else{const Ke=G(re,he),dt=G(be,de),Ot=G(ve,we);U.emplaceBack(Ke,dt,Ot)}}return K(0,0,32,32,32,0),K(32,32,0,0,0,32),{vertices:z,indices:U}}(this.tileID.canonical,s);m=x.vertices,y=x.indices}else{m=new ht,y=new an;for(const{x:D,y:S}of u)m.emplaceBack(D,S,0,0);const x=_g(m.int16,void 0,4);for(let D=0;D<x.length;D+=3)y.emplaceBack(x[D],x[D+1],x[D+2])}this._tileBoundsBuffer=e.createVertexBuffer(m,fm.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(y),this._tileBoundsSegments=Ar.simpleSegment(0,0,m.length,y.length)}_makeGlobeTileDebugBuffers(e,s){const u=s.projection;if(!u||"globe"!==u.name||s.freezeTileCoverage)return;const m=this.tileID.canonical,y=Mp(Ou(m,s)),x=Hd(s.zoom);let D;x>0&&(D=mp(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,m,s,y,D,x),this._makeGlobeTileDebugTextBuffer(e,m,s,y,D,x)}_globePoint(e,s,u,m,y,x,D){let S=$d(e,s,u);if(x){const P=1<<u.z,F=wl(m.center.lng),z=va(m.center.lat),U=(u.x+.5)/P-F;let H=0;U>.5?H=-1:U<-.5&&(H=1);let G=(e/mn+u.x)/P+H,K=(s/mn+u.y)/P;G=(G-F)*m._pixelsPerMercatorPixel+F,K=(K-z)*m._pixelsPerMercatorPixel+z;const re=[G*m.worldSize,K*m.worldSize,0];Fr(re,re,x),S=Ru(S,re,D)}return Fr(S,S,y)}_makeGlobeTileDebugBorderBuffer(e,s,u,m,y,x){const D=new At,S=new zn,P=new Ve,F=(U,H,G,K,re)=>{const he=(G-U)/(re-1),be=(K-H)/(re-1),de=D.length;for(let ve=0;ve<re;ve++){const we=U+ve*he,Ee=H+ve*be;D.emplaceBack(we,Ee);const Je=this._globePoint(we,Ee,s,u,m,y,x);P.emplaceBack(Je[0],Je[1],Je[2]),S.emplaceBack(de+ve)}},z=mn;F(0,0,z,0,16),F(z,0,z,z,16),F(z,z,0,z,16),F(0,z,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(S),this._tileDebugBuffer=e.createVertexBuffer(D,Pu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(P,Cp.members),this._tileDebugSegments=Ar.simpleSegment(0,0,D.length,S.length)}_makeGlobeTileDebugTextBuffer(e,s,u,m,y,x){const D=mn/4,S=new At,P=new an,F=new Ve,z=25;P.reserve(32),S.reserve(z),F.reserve(z);const U=(H,G)=>z*H+G;for(let H=0;H<z;H++){const G=H*D;for(let K=0;K<z;K++){const re=K*D;S.emplaceBack(re,G);const he=this._globePoint(re,G,s,u,m,y,x);F.emplaceBack(he[0],he[1],he[2])}}for(let H=0;H<4;H++)for(let G=0;G<4;G++){const K=U(H,G),re=U(H,G+1),he=U(H+1,G),be=U(H+1,G+1);P.emplaceBack(K,re,he),P.emplaceBack(he,re,be)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(P),this._tileDebugTextBuffer=e.createVertexBuffer(S,Pu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(F,Cp.members),this._tileDebugTextSegments=Ar.simpleSegment(0,0,z,32)}}class Iy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,u){const m=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][m]=this.stateChanges[e][m]||{},ot(this.stateChanges[e][m],u),null===this.deletedStates[e]){this.deletedStates[e]={};for(const y in this.state[e])y!==m&&(this.deletedStates[e][y]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][m]){this.deletedStates[e][m]={};for(const y in this.state[e][m])u[y]||(this.deletedStates[e][m][y]=null)}else for(const y in u)this.deletedStates[e]&&this.deletedStates[e][m]&&null===this.deletedStates[e][m][y]&&delete this.deletedStates[e][m][y]}removeFeatureState(e,s,u){if(null===this.deletedStates[e])return;const m=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&void 0!==s)null!==this.deletedStates[e][m]&&(this.deletedStates[e][m]=this.deletedStates[e][m]||{},this.deletedStates[e][m][u]=null);else if(void 0!==s)if(this.stateChanges[e]&&this.stateChanges[e][m])for(u in this.deletedStates[e][m]={},this.stateChanges[e][m])this.deletedStates[e][m][u]=null;else this.deletedStates[e][m]=null;else this.deletedStates[e]=null}getState(e,s){const u=String(s),m=ot({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const y=this.deletedStates[e][s];if(null===y)return{};for(const x in y)delete m[x]}return m}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const u={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const x in this.stateChanges[m])this.state[m][x]||(this.state[m][x]={}),ot(this.state[m][x],this.stateChanges[m][x]),y[x]=this.state[m][x];u[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(null===this.deletedStates[m])for(const x in this.state[m])y[x]={},this.state[m][x]={};else for(const x in this.deletedStates[m]){if(null===this.deletedStates[m][x])this.state[m][x]={};else if(this.state[m][x])for(const D of Object.keys(this.deletedStates[m][x]))delete this.state[m][x][D];y[x]=this.state[m][x]}u[m]=u[m]||{},ot(u[m],y)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const m in e)e[m].setFeatureState(u,s)}}class Gg{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,s){const u=this.toIdx(e,s);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(e,s){return this.leaves[this.toIdx(e,s)]}toIdx(e,s){return s*this.size+e}}function Da(r,e,s,u){let m=0,y=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(u[x])<1e-15){if(s[x]<r[x]||s[x]>e[x])return null}else{const D=1/u[x];let S=(r[x]-s[x])*D,P=(e[x]-s[x])*D;if(S>P){const F=S;S=P,P=F}if(S>m&&(m=S),P<y&&(y=P),m>y)return null}return m}function hc(r,e,s,u,m,y,x,D,S,P,F){const z=u-r,U=m-e,H=y-s,G=x-r,K=D-e,re=S-s,he=F[1]*re-F[2]*K,be=F[2]*G-F[0]*re,de=F[0]*K-F[1]*G,ve=z*he+U*be+H*de;if(Math.abs(ve)<1e-15)return null;const we=1/ve,Ee=P[0]-r,Je=P[1]-e,Ke=P[2]-s,dt=(Ee*he+Je*be+Ke*de)*we;if(dt<0||dt>1)return null;const Ot=Je*H-Ke*U,rt=Ke*z-Ee*H,vt=Ee*U-Je*z,yt=(F[0]*Ot+F[1]*rt+F[2]*vt)*we;return yt<0||dt+yt>1?null:(G*Ot+K*rt+re*vt)*we}function y0(r,e,s){return(r-e)/(s-e)}function Ay(r,e,s,u,m,y,x,D,S){const P=1<<s,F=y-u,z=x-m,U=(r+1)/P*F+u,H=(e+0)/P*z+m,G=(e+1)/P*z+m;D[0]=(r+0)/P*F+u,D[1]=H,S[0]=U,S[1]=G}class Py{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(y){const x=Math.ceil(Math.log2(y.dim/8)),D=[];let S=Math.ceil(Math.pow(2,x));const P=1/S,F=(H,G,K,re,he)=>{const be=re?1:0,de=(H+1)*K-be,ve=G*K,we=(G+1)*K-be;he[0]=H*K,he[1]=ve,he[2]=de,he[3]=we};let z=new Gg(S);const U=[];for(let H=0;H<S*S;H++){F(H%S,Math.floor(H/S),P,!1,U);const G=bs(U[0],U[1],y),K=bs(U[2],U[1],y),re=bs(U[2],U[3],y),he=bs(U[0],U[3],y);z.minimums.push(Math.min(G,K,re,he)),z.maximums.push(Math.max(G,K,re,he)),z.leaves.push(1)}for(D.push(z),S/=2;S>=1;S/=2){const H=D[D.length-1];z=new Gg(S);for(let G=0;G<S*S;G++){F(G%S,Math.floor(G/S),2,!0,U);const K=H.getElevation(U[0],U[1]),re=H.getElevation(U[2],U[1]),he=H.getElevation(U[2],U[3]),be=H.getElevation(U[0],U[3]),de=H.isLeaf(U[0],U[1]),ve=H.isLeaf(U[2],U[1]),we=H.isLeaf(U[2],U[3]),Ee=H.isLeaf(U[0],U[3]),Je=Math.min(K.min,re.min,he.min,be.min),Ke=Math.max(K.max,re.max,he.max,be.max),dt=de&&ve&&we&&Ee;z.maximums.push(Ke),z.minimums.push(Je),z.leaves.push(Ke-Je<=5&&dt?1:0)}D.push(z)}return D}(this.dem),u=s.length-1,m=s[u];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(s,0,0,u,0)}raycastRoot(e,s,u,m,y,x,D=1){return Da([e,s,-100],[u,m,this.maximums[0]*D],y,x)}raycast(e,s,u,m,y,x,D=1){if(!this.nodeCount)return null;const S=this.raycastRoot(e,s,u,m,y,x,D);if(null==S)return null;const P=[],F=[],z=[],U=[],H=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;H.length>0;){const{idx:G,t:K,nodex:re,nodey:he,depth:be}=H.pop();if(this.leaves[G]){Ay(re,he,be,e,s,u,m,z,U);const ve=1<<be,we=(re+0)/ve,Ee=(re+1)/ve,Je=(he+0)/ve,Ke=(he+1)/ve,dt=bs(we,Je,this.dem)*D,Ot=bs(Ee,Je,this.dem)*D,rt=bs(Ee,Ke,this.dem)*D,vt=bs(we,Ke,this.dem)*D,yt=hc(z[0],z[1],dt,U[0],z[1],Ot,U[0],U[1],rt,y,x),Mt=hc(U[0],U[1],rt,z[0],U[1],vt,z[0],z[1],dt,y,x),Rt=Math.min(null!==yt?yt:Number.MAX_VALUE,null!==Mt?Mt:Number.MAX_VALUE);if(Rt!==Number.MAX_VALUE)return Rt;{const at=Kl([],y,x,K);if(Ry(dt,Ot,vt,rt,y0(at[0],z[0],U[0]),y0(at[1],z[1],U[1]))>=at[2])return K}continue}let de=0;for(let ve=0;ve<this._siblingOffset.length;ve++){Ay((re<<1)+this._siblingOffset[ve][0],(he<<1)+this._siblingOffset[ve][1],be+1,e,s,u,m,z,U),z[2]=-100,U[2]=this.maximums[this.childOffsets[G]+ve]*D;const we=Da(z,U,y,x);if(null!=we){const Ee=we;P[ve]=Ee;let Je=!1;for(let Ke=0;Ke<de&&!Je;Ke++)Ee>=P[F[Ke]]&&(F.splice(Ke,0,ve),Je=!0);Je||(F[de]=ve),de++}}for(let ve=0;ve<de;ve++){const we=F[ve];H.push({idx:this.childOffsets[G]+we,t:P[we],nodex:(re<<1)+this._siblingOffset[we][0],nodey:(he<<1)+this._siblingOffset[we][1],depth:be+1})}}return null}_addNode(e,s,u){return this.minimums.push(e),this.maximums.push(s),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(e,s,u,m,y){if(1===e[m].isLeaf(s,u))return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const x=m-1,D=e[x];let S=0,P=0;for(let F=0;F<this._siblingOffset.length;F++){const z=2*s+this._siblingOffset[F][0],U=2*u+this._siblingOffset[F][1],H=D.getElevation(z,U),G=D.isLeaf(z,U),K=this._addNode(H.min,H.max,G);G&&(S|=1<<F),P||(P=K)}for(let F=0;F<this._siblingOffset.length;F++)S&1<<F||this._construct(e,2*s+this._siblingOffset[F][0],2*u+this._siblingOffset[F][1],x,P+F)}}function Ry(r,e,s,u,m,y){return wi(wi(r,s,y),wi(e,u,y),m)}function bs(r,e,s){const u=s.dim,m=Wn(r*u-.5,0,u-1),y=Wn(e*u-.5,0,u-1),x=Math.floor(m),D=Math.floor(y),S=Math.min(x+1,u-1),P=Math.min(D+1,u-1);return Ry(s.get(x,D),s.get(S,D),s.get(x,P),s.get(S,P),m-x,y-D)}const fc={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function yh(r,e,s){return(256*r*256+256*e+s)/10-1e4}function pm(r,e,s){return 256*r+e+s/256-32768}class Qc{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,s,u,m=!1,y=!1){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return qn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const x=this.dim=s.height-2,D=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=u||"mapbox",this.borderReady=m,!m){for(let S=0;S<x;S++)D[this._idx(-1,S)]=D[this._idx(0,S)],D[this._idx(x,S)]=D[this._idx(x-1,S)],D[this._idx(S,-1)]=D[this._idx(S,0)],D[this._idx(S,x)]=D[this._idx(S,x-1)];D[this._idx(-1,-1)]=D[this._idx(0,0)],D[this._idx(x,-1)]=D[this._idx(x-1,0)],D[this._idx(-1,x)]=D[this._idx(0,x-1)],D[this._idx(x,x)]=D[this._idx(x-1,x-1)],y&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Py(this)}get(e,s,u=!1){u&&(e=Wn(e,-1,this.dim),s=Wn(s,-1,this.dim));const m=4*this._idx(e,s);return("terrarium"===this.encoding?pm:yh)(this.pixels[m],this.pixels[m+1],this.pixels[m+2])}static getUnpackVector(e){return fc[e]}get unpackVector(){return fc[this.encoding]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}static pack(e,s){const u=[0,0,0,0],m=Qc.getUnpackVector(s);let y=Math.floor((e+m[3])/m[2]);return u[2]=y%256,y=Math.floor(y/256),u[1]=y%256,y=Math.floor(y/256),u[0]=y,u}getPixels(){return new gs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,s,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let m=s*this.dim,y=s*this.dim+this.dim,x=u*this.dim,D=u*this.dim+this.dim;switch(s){case-1:m=y-1;break;case 1:y=m+1}switch(u){case-1:x=D-1;break;case 1:D=x+1}const S=-s*this.dim,P=-u*this.dim;for(let F=x;F<D;F++)for(let z=m;z<y;z++){const U=4*this._idx(z,F),H=4*this._idx(z+S,F+P);this.pixels[U+0]=e.pixels[H+0],this.pixels[U+1]=e.pixels[H+1],this.pixels[U+2]=e.pixels[H+2],this.pixels[U+3]=e.pixels[H+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}dn(Qc,"DEMData"),dn(Py,"DemMinMaxQuadTree",{omit:["dem"]});class Ff{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,u){const m=e.wrapped().key;void 0===this.data[m]&&(this.data[m]=[]);const y={value:s,timeout:void 0};if(void 0!==u&&(y.timeout=setTimeout(()=>{this.remove(e,y)},u)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const u=e.wrapped().key,m=void 0===s?0:this.data[u].indexOf(s),y=this.data[u][m];return this.data[u].splice(m,1),y.timeout&&clearTimeout(y.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const u in this.data)for(const m of this.data[u])e(m.value)||s.push(m);for(const u of s)this.remove(u.value.tileID,u)}}class id{constructor(e,s,u){this.func=e,this.mask=s,this.range=u}}id.ReadOnly=!1,id.ReadWrite=!0,id.disabled=new id(519,id.ReadOnly,[0,1]);class eu{constructor(e,s,u,m,y,x){this.test=e,this.ref=s,this.mask=u,this.fail=m,this.depthFail=y,this.pass=x}}eu.disabled=new eu({func:519,mask:0},0,0,7680,7680,7680);class To{constructor(e,s,u){this.blendFunction=e,this.blendColor=s,this.mask=u}}To.Replace=[1,0],To.disabled=new To(To.Replace,xn.transparent,[!1,!1,!1,!1]),To.unblended=new To(To.Replace,xn.transparent,[!0,!0,!0,!0]),To.alphaBlended=new To([1,771],xn.transparent,[!0,!0,!0,!0]);class ra{constructor(e,s,u){this.enable=e,this.mode=s,this.frontFace=u}}ra.disabled=new ra(!1,1029,2305),ra.backCCW=new ra(!0,1029,2305),ra.backCW=new ra(!0,1029,2304),ra.frontCW=new ra(!0,1028,2304),ra.frontCCW=new ra(!0,1028,2305);class tu extends ka{constructor(e,s,u){super(),this.id=e,this._onlySymbols=u,s.on("data",m=>{"source"===m.dataType&&"metadata"===m.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===m.dataType&&"content"===m.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new Ff(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Iy,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const s=this._tiles[e];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,s){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const u=this._tiles[s];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Hs(this._tiles).map(e=>e.tileID).sort(Zg).map(e=>e.key)}getRenderableIds(e){const s=[];for(const u in this._tiles)this._isIdRenderable(+u,e)&&s.push(this._tiles[u]);return e?s.sort((u,m)=>{const y=u.tileID,x=m.tileID,D=new Ne(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),S=new Ne(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-x.overscaledZ||S.y-D.y||S.x-D.x}).map(u=>u.tileID.key):s.map(u=>u.tileID).sort(Zg).map(u=>u.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,s){const u=this._tiles[e];u&&("loading"!==u.state&&(u.state=s),this._loadTile(u,this._tileLoaded.bind(this,u,e,s)))}_tileLoaded(e,s,u,m){if(m)if(e.state="errored",404!==m.status)this._source.fire(new qo(m,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=_o.now(),"expired"===u&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Po("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const s=this.getRenderableIds();for(let m=0;m<s.length;m++){const y=s[m];if(e.neighboringTiles&&e.neighboringTiles[y]){const x=this.getTileByID(y);u(e,x),u(x,e)}}function u(m,y){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let x=y.tileID.canonical.x-m.tileID.canonical.x;const D=y.tileID.canonical.y-m.tileID.canonical.y,S=Math.pow(2,m.tileID.canonical.z),P=y.tileID.key;0===x&&0===D||Math.abs(D)>1||(Math.abs(x)>1&&(1===Math.abs(x+S)?x+=S:1===Math.abs(x-S)&&(x-=S)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,x,D),m.neighboringTiles&&m.neighboringTiles[P]&&(m.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,u,m){for(const y in this._tiles){let x=this._tiles[y];if(m[y]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>u)continue;let D=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const P=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[P.key],x&&x.hasData()&&(D=P)}let S=D;for(;S.overscaledZ>s;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]){m[D.key]=D;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=s?u:null}for(let u=e.overscaledZ-1;u>=s;u--){const m=e.scaledTo(u),y=this._getLoadedTile(m);if(y)return y}}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,s){s=s||this._source.tileSize;const u=Math.ceil(e.width/s)+1,m=Math.ceil(e.height/s)+1,y=Math.floor(u*m*5),x="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,y):y,D="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(D)}handleWrapJump(e){const s=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,s){const u={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+s),u[y.tileID.key]=y}this._tiles=u;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(e,s,u){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let m;this.updateCacheSize(e,s),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new _s(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(m=e.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(m=m.filter(D=>this._source.hasTile(D)))):m=[];const y=this._updateRetainedTiles(m);if(v0(this._source.type)&&0!==m.length){const D={},S={},P=Object.keys(y);for(const z of P){const U=y[z],H=this._tiles[z];if(!H||H.fadeEndTime&&H.fadeEndTime<=_o.now())continue;const G=this.findLoadedParent(U,Math.max(U.overscaledZ-tu.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),D[G.tileID.key]=G.tileID),S[z]=U}const F=m[m.length-1].overscaledZ;for(const z in this._tiles){const U=this._tiles[z];if(y[z]||!U.hasData())continue;let H=U.tileID;for(;H.overscaledZ>F;){H=H.scaledTo(H.overscaledZ-1);const G=this._tiles[H.key];if(G&&G.hasData()&&S[H.key]){y[z]=U.tileID;break}}}for(const z in D)y[z]||(this._coveredTiles[z]=!0,y[z]=D[z])}for(const D in y)this._tiles[D].clearFadeHold();const x=function(D,S){const P=[];for(const F in D)F in S||P.push(F);return P}(this._tiles,y);for(const D of x){const S=this._tiles[D];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(+D)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const s={};if(0===e.length)return s;const u={},m=e.reduce((P,F)=>Math.min(P,F.overscaledZ),1/0),y=e[0].overscaledZ,x=Math.max(y-tu.maxOverzooming,this._source.minzoom),D=Math.max(y+tu.maxUnderzooming,this._source.minzoom),S={};for(const P of e){const F=this._addTile(P);s[P.key]=P,F.hasData()||m<this._source.maxzoom&&(S[P.key]=P)}this._retainLoadedChildren(S,m,D,s);for(const P of e){let F=this._tiles[P.key];if(F.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const U=P.children(this._source.maxzoom)[0],H=this.getTile(U);if(H&&H.hasData()){s[U.key]=U;continue}}else{const U=P.children(this._source.maxzoom);if(s[U[0].key]&&s[U[1].key]&&s[U[2].key]&&s[U[3].key])continue}let z=F.wasRequested();for(let U=P.overscaledZ-1;U>=x;--U){const H=P.scaledTo(U);if(u[H.key]||(u[H.key]=!0,F=this.getTile(H),!F&&z&&(F=this._addTile(H)),F&&(s[H.key]=H,z=F.wasRequested(),F.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let u,m=this._tiles[e].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){u=this._loadedParentTiles[m.key];break}s.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(u=this._getLoadedTile(y),u)break;m=y}for(const y of s)this._loadedParentTiles[y]=u}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const u=!!s;if(!u){const m=this.map?this.map.painter:null;s=new _h(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,m,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))}return s?(s.uses++,this._tiles[e.key]=s,u||this._source.fire(new Po("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=s.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,s,u){const m=[],y=this.transform;if(!y)return m;const x="globe"===y.projection.name,D=wl(y.center.lng);for(const S in this._tiles){const P=this._tiles[S];if(u&&P.clearQueryDebugViz(),P.holdingForFade())continue;let F;if(x){const z=P.tileID.canonical;if(0===z.z){const U=[Math.abs(Wn(D,...nu(z,-1))-D),Math.abs(Wn(D,...nu(z,1))-D)];F=[0,2*U.indexOf(Math.min(...U))-1]}else{const U=[Math.abs(Wn(D,...nu(z,-1))-D),Math.abs(Wn(D,...nu(z,0))-D),Math.abs(Wn(D,...nu(z,1))-D)];F=[U.indexOf(Math.min(...U))-1]}}else F=[0];for(const z of F){const U=e.containsTile(P,y,s,z);U&&m.push(U)}}return m}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(const u of s)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(v0(this._source.type))for(const e in this._tiles){const s=this._tiles[e];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=_o.now())return!0}return!1}setFeatureState(e,s,u){this._state.updateState(e=e||"_geojsonTileLayer",s,u)}removeFeatureState(e,s,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,u)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,u){const m=this._tiles[e];m&&m.setDependencies(s,u)}reloadTilesForDependencies(e,s){for(const u in this._tiles)this._tiles[u].hasDependency(e,s)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(e,s))}_preloadTiles(e,s){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(e,s))};return void this._source.on("data",D)}const u=new Map,m=Array.isArray(e)?e:[e],y=this.map.painter.terrain,x=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const D of m){const S=D.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const P of S)u.set(P.key,P);this.usedForTerrain&&D.updateElevation(!1)}dr(Array.from(u.values()),(D,S)=>{const P=new _h(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(P,F=>{"raster-dem"===this._source.type&&P.dem&&this._backfillDEM(P),S(F,P)})},s)}}function Zg(r,e){const s=Math.abs(2*r.wrap)-+(r.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||u-s||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x}function v0(r){return"raster"===r||"image"===r||"video"===r||"custom"===r}function nu(r,e){const s=1<<r.z;return[r.x/s+e,(r.x+1)/s+e]}tu.maxOverzooming=10,tu.maxUnderzooming=3;class Ol{constructor(e,s,u){this._demTile=e,this._dem=this._demTile.dem,this._scale=s,this._offset=u}static create(e,s,u){const m=u||e.findDEMTileFor(s);if(!m||!m.dem)return;const y=m.dem,x=m.tileID,D=1<<s.canonical.z-x.canonical.z;return new Ol(m,m.tileSize/mn/D,[(s.canonical.x/D-x.canonical.x)*y.dim,(s.canonical.y/D-x.canonical.y)*y.dim])}tileCoordToPixel(e,s){const u=s*this._scale+this._offset[1],m=Math.floor(e*this._scale+this._offset[0]),y=Math.floor(u);return new Ne(m,y)}getElevationAt(e,s,u,m){const y=e*this._scale+this._offset[0],x=s*this._scale+this._offset[1],D=Math.floor(y),S=Math.floor(x),P=this._dem;return m=!!m,u?wi(wi(P.get(D,S,m),P.get(D,S+1,m),x-S),wi(P.get(D+1,S,m),P.get(D+1,S+1,m),x-S),y-D):P.get(D,S,m)}getElevationAtPixel(e,s,u){return this._dem.get(e,s,!!u)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*$o(1,e)*this._dem.stride}}class Oy{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Gl(mn,16,0),this.featureIndexArray=new Su,this.promoteId=s}insert(e,s,u,m,y,x=0){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,y,x);const S=this.grid;for(let P=0;P<s.length;P++){const F=s[P],z=[1/0,1/0,-1/0,-1/0];for(let U=0;U<F.length;U++){const H=F[U];z[0]=Math.min(z[0],H.x),z[1]=Math.min(z[1],H.y),z[2]=Math.max(z[2],H.x),z[3]=Math.max(z[3],H.y)}z[0]<mn&&z[1]<mn&&z[2]>=0&&z[3]>=0&&S.insert(D,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new yf(new Yu(this.rawTileData)).layers,this.sourceLayerCoder=new Dy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,s,u,m){this.loadVTLayers();const y=e.params||{},x=ha(y.filter),D=e.tileResult,S=e.transform,P=D.bufferedTilespaceBounds,F=this.grid.query(P.min.x,P.min.y,P.max.x,P.max.y,(G,K,re,he)=>cg(D.bufferedTilespaceGeometry,G,K,re,he));F.sort(ky);let z=null;S.elevation&&F.length>0&&(z=Ol.create(S.elevation,this.tileID));const U={};let H;for(let G=0;G<F.length;G++){const K=F[G];if(K===H)continue;H=K;const re=this.featureIndexArray.get(K);let he=null;this.loadMatchingFeature(U,re,x,y.layers,y.availableImages,s,u,m,(be,de,ve,we=0)=>(he||(he=El(be,this.tileID.canonical,e.tileTransform)),de.queryIntersectsFeature(D,be,ve,he,this.z,e.transform,e.pixelPosMatrix,z,we)))}return U}loadMatchingFeature(e,s,u,m,y,x,D,S,P){const{featureIndex:F,bucketIndex:z,sourceLayerIndex:U,layoutVertexArrayOffset:H}=s,G=this.bucketLayerIDs[z];if(m&&!function(be,de){for(let ve=0;ve<be.length;ve++)if(de.indexOf(be[ve])>=0)return!0;return!1}(m,G))return;const K=this.sourceLayerCoder.decode(U),re=this.vtLayers[K].feature(F);if(u.needGeometry){const be=Bu(re,!0);if(!u.filter(new B(this.tileID.overscaledZ),be,this.tileID.canonical))return}else if(!u.filter(new B(this.tileID.overscaledZ),re))return;const he=this.getId(re,K);for(let be=0;be<G.length;be++){const de=G[be];if(m&&m.indexOf(de)<0)continue;const ve=x[de];if(!ve)continue;let we={};void 0!==he&&S&&(we=S.getState(ve.sourceLayer||"_geojsonTileLayer",he));const Ee=ot({},D[de]);Ee.paint=gm(Ee.paint,ve.paint,re,we,y),Ee.layout=gm(Ee.layout,ve.layout,re,we,y);const Je=!P||P(re,ve,we,H);if(!Je)continue;const Ke=new My(re,this.z,this.x,this.y,he);Ke.layer=Ee;let dt=e[de];void 0===dt&&(dt=e[de]=[]),dt.push({featureIndex:F,feature:Ke,intersectionZ:Je})}}lookupSymbolFeatures(e,s,u,m,y,x,D,S){const P={};this.loadVTLayers();const F=ha(y);for(const z of e)this.loadMatchingFeature(P,{bucketIndex:u,sourceLayerIndex:m,featureIndex:z,layoutVertexArrayOffset:0},F,x,D,S,s);return P}loadFeature(e){const{featureIndex:s,sourceLayerIndex:u}=e;this.loadVTLayers();const m=this.sourceLayerCoder.decode(u),y=this.vtFeatures[m];if(y[s])return y[s];const x=this.vtLayers[m].feature(s);return y[s]=x,x}hasLayer(e){for(const s of this.bucketLayerIDs)for(const u of s)if(e===u)return!0;return!1}getId(e,s){let u=e.id;if(this.promoteId){const m="string"==typeof this.promoteId?this.promoteId:this.promoteId[s];null!=m&&(u=e.properties[m]),"boolean"==typeof u&&(u=Number(u))}return u}}function gm(r,e,s,u,m){return un(r,(y,x)=>{const D=e instanceof ce?e.get(x):null;return D&&D.evaluate?D.evaluate(s,u,m):D})}function ky(r,e){return e-r}dn(Oy,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Ly{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.image=new ta({width:e,height:s}),this.positions={},this.uploaded=!1}getDash(e,s){const u=this.getKey(e,s);return this.positions[u]}trim(){const e=this.width,s=this.height=Gt(this.nextRow);this.image.resize({width:e,height:s})}getKey(e,s){return e.join(",")+s}getDashRanges(e,s,u){const m=[];let y=e.length%2==1?-e[e.length-1]*u:0,x=e[0]*u,D=!0;m.push({left:y,right:x,isDash:D,zeroLength:0===e[0]});let S=e[0];for(let P=1;P<e.length;P++){D=!D;const F=e[P];y=S*u,S+=F,x=S*u,m.push({left:y,right:x,isDash:D,zeroLength:0===F})}return m}addRoundDash(e,s,u){const m=s/2;for(let y=-u;y<=u;y++){const x=this.width*(this.nextRow+u+y);let D=0,S=e[D];for(let P=0;P<this.width;P++){P/S.right>1&&(S=e[++D]);const F=Math.abs(P-S.left),z=Math.abs(P-S.right),U=Math.min(F,z);let H;const G=y/u*(m+1);if(S.isDash){const K=m-Math.abs(G);H=Math.sqrt(U*U+K*K)}else H=m-Math.sqrt(U*U+G*G);this.image.data[x+P]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(e,s){for(let S=e.length-1;S>=0;--S){const P=e[S],F=e[S+1];P.zeroLength?e.splice(S,1):F&&F.isDash===P.isDash&&(F.left=P.left,e.splice(S,1))}const u=e[0],m=e[e.length-1];u.isDash===m.isDash&&(u.left=m.left-this.width,m.right=u.right+this.width);const y=this.width*this.nextRow;let x=0,D=e[x];for(let S=0;S<this.width;S++){S/D.right>1&&(D=e[++x]);const P=Math.abs(S-D.left),F=Math.abs(S-D.right),z=Math.min(P,F);this.image.data[y+S]=Math.max(0,Math.min(255,(D.isDash?z:-z)+s+128))}}addDash(e,s){const u=this.getKey(e,s);if(this.positions[u])return this.positions[u];const m="round"===s,y=m?7:0,x=2*y+1;if(this.nextRow+x>this.height)return qn("LineAtlas out of space"),null;0===e.length&&e.push(1);let D=0;for(let F=0;F<e.length;F++)e[F]<0&&(qn("Negative value is found in line dasharray, replacing values with 0"),e[F]=0),D+=e[F];if(0!==D){const F=this.width/D,z=this.getDashRanges(e,this.width,F);m?this.addRoundDash(z,F,y):this.addRegularDash(z,"square"===s?.5*F:0)}const S=this.nextRow+y;this.nextRow+=x;const P={tl:[S,y],br:[D,0]};return this.positions[u]=P,P}}dn(Ly,"LineAtlas");const _m=1*Qa;class Nf{constructor(e){const s={},u=[];for(const D in e){const S=e[D],P=s[D]={};for(const F in S.glyphs){const z=S.glyphs[+F];if(!z||0===z.bitmap.width||0===z.bitmap.height)continue;const U=z.metrics.localGlyph?_m:1,H={x:0,y:0,w:z.bitmap.width+2*U,h:z.bitmap.height+2*U};u.push(H),P[F]=H}}const{w:m,h:y}=Ig(u),x=new ta({width:m||1,height:y||1});for(const D in e){const S=e[D];for(const P in S.glyphs){const F=S.glyphs[+P];if(!F||0===F.bitmap.width||0===F.bitmap.height)continue;const z=s[D][P],U=F.metrics.localGlyph?_m:1;ta.copy(F.bitmap,x,{x:0,y:0},{x:z.x+U,y:z.y+U},F.bitmap)}}this.image=x,this.positions=s}}dn(Nf,"GlyphAtlas");class b0{constructor(e){this.tileID=new _s(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=lc(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,s,u,m,y){this.status="parsing",this.data=e,this.collisionBoxArray=new gi;const x=new Dy(Object.keys(e.layers).sort()),D=new Oy(this.tileID,this.promoteId);D.bucketLayerIDs=[];const S={},P=new Ly(256,256),F={featureIndex:D,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:P,availableImages:u},z=s.familiesBySource[this.source];for(const we in z){const Ee=e.layers[we];if(!Ee)continue;let Je=!1,Ke=!1;for(const rt of z[we])"symbol"===rt[0].type?Je=!0:Ke=!0;if(!0===this.isSymbolTile&&!Je||!1===this.isSymbolTile&&!Ke)continue;1===Ee.version&&qn(`Vector tile source "${this.source}" layer "${we}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const dt=x.encode(we),Ot=[];for(let rt=0;rt<Ee.length;rt++){const vt=Ee.feature(rt),yt=D.getId(vt,we);Ot.push({feature:vt,id:yt,index:rt,sourceLayerIndex:dt})}for(const rt of z[we]){const vt=rt[0];void 0!==this.isSymbolTile&&"symbol"===vt.type!==this.isSymbolTile||vt.minzoom&&this.zoom<Math.floor(vt.minzoom)||vt.maxzoom&&this.zoom>=vt.maxzoom||"none"!==vt.visibility&&(Fy(rt,this.zoom,u),(S[vt.id]=vt.createBucket({index:D.bucketLayerIDs.length,layers:rt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:dt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(Ot,F,this.tileID.canonical,this.tileTransform),D.bucketLayerIDs.push(rt.map(yt=>yt.id)))}}let U,H,G,K;P.trim();const re={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},he=()=>{if(U)return y(U);if(H&&G&&K){const we=new Nf(H),Ee=new Pg(G,K);for(const Je in S){const Ke=S[Je];Ke instanceof tl?(Fy(Ke.layers,this.zoom,u),vy(Ke,H,we.positions,G,Ee.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):Ke.hasPattern&&(Ke instanceof rh||Ke instanceof eh||Ke instanceof Vp)&&(Fy(Ke.layers,this.zoom,u),Ke.addFeatures(F,this.tileID.canonical,Ee.patternPositions,u,this.tileTransform))}this.status="done",y(null,{buckets:Hs(S).filter(Je=>!Je.isEmpty()),featureIndex:D,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:we.image,lineAtlas:P,imageAtlas:Ee,glyphMap:this.returnDependencies?H:null,iconMap:this.returnDependencies?G:null,glyphPositions:this.returnDependencies?we.positions:null})}},be=un(F.glyphDependencies,we=>Object.keys(we).map(Number));Object.keys(be).length?m.send("getGlyphs",{uid:this.uid,stacks:be},(we,Ee)=>{U||(U=we,H=Ee,he())},void 0,!1,re):H={};const de=Object.keys(F.iconDependencies);de.length?m.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"icons"},(we,Ee)=>{U||(U=we,G=Ee,he())},void 0,!1,re):G={};const ve=Object.keys(F.patternDependencies);ve.length?m.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"patterns"},(we,Ee)=>{U||(U=we,K=Ee,he())},void 0,!1,re):K={},he()}}function Fy(r,e,s){const u=new B(e);for(const m of r)m.recalculate(u,s)}class qg{constructor(e){this.entries={},this.scheduler=e}request(e,s,u,m){const y=this.entries[e]=this.entries[e]||{callbacks:[]};if(y.result){const[x,D]=y.result;return this.scheduler?this.scheduler.add(()=>{m(x,D)},s):m(x,D),()=>{}}return y.callbacks.push(m),y.cancel||(y.cancel=u((x,D)=>{y.result=[x,D];for(const S of y.callbacks)this.scheduler?this.scheduler.add(()=>{S(x,D)},s):S(x,D);setTimeout(()=>delete this.entries[e],3e3)})),()=>{y.result||(y.callbacks=y.callbacks.filter(x=>x!==m),y.callbacks.length||(y.cancel(),delete this.entries[e]))}}}function rd(r,e,s){const u=JSON.stringify(r.request);return r.data&&(this.deduped.entries[u]={result:[null,r.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},m=>{const y=bi(r.request,(x,D,S,P)=>{x?m(x):D&&m(null,{vectorTile:s?void 0:new yf(new Yu(D)),rawData:D,cacheControl:S,expires:P})});return()=>{y.cancel(),m()}},e)}const iu=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ym{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,u]=new Uint8Array(e,0,2);if(219!==s)throw new Error("Data does not appear to be in a KDBush format.");const m=u>>4;if(1!==m)throw new Error(`Got v${m} data when expected v1.`);const y=iu[15&u];if(!y)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(e,2,1),[D]=new Uint32Array(e,4,1);return new ym(D,x,y,e)}constructor(e,s=64,u=Float64Array,m){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const y=iu.indexOf(this.ArrayType),x=2*e*this.ArrayType.BYTES_PER_ELEMENT,D=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-D%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${u}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+D+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+x+D+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+D+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=e,this.coords[this._pos++]=s,u}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Bf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:x,nodeSize:D}=this,S=[0,y.length-1,0],P=[];for(;S.length;){const F=S.pop()||0,z=S.pop()||0,U=S.pop()||0;if(z-U<=D){for(let re=U;re<=z;re++){const he=x[2*re],be=x[2*re+1];he>=e&&he<=u&&be>=s&&be<=m&&P.push(y[re])}continue}const H=U+z>>1,G=x[2*H],K=x[2*H+1];G>=e&&G<=u&&K>=s&&K<=m&&P.push(y[H]),(0===F?e<=G:s<=K)&&(S.push(U),S.push(H-1),S.push(1-F)),(0===F?u>=G:m>=K)&&(S.push(H+1),S.push(z),S.push(1-F))}return P}within(e,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:x}=this,D=[0,m.length-1,0],S=[],P=u*u;for(;D.length;){const F=D.pop()||0,z=D.pop()||0,U=D.pop()||0;if(z-U<=x){for(let re=U;re<=z;re++)od(y[2*re],y[2*re+1],e,s)<=P&&S.push(m[re]);continue}const H=U+z>>1,G=y[2*H],K=y[2*H+1];od(G,K,e,s)<=P&&S.push(m[H]),(0===F?e-u<=G:s-u<=K)&&(D.push(U),D.push(H-1),D.push(1-F)),(0===F?e+u>=G:s+u>=K)&&(D.push(H+1),D.push(z),D.push(1-F))}return S}}function Bf(r,e,s,u,m,y){if(m-u<=s)return;const x=u+m>>1;rl(r,e,x,u,m,y),Bf(r,e,s,u,x-1,1-y),Bf(r,e,s,x+1,m,1-y)}function rl(r,e,s,u,m,y){for(;m>u;){if(m-u>600){const P=m-u+1,F=s-u+1,z=Math.log(P),U=.5*Math.exp(2*z/3),H=.5*Math.sqrt(z*U*(P-U)/P)*(F-P/2<0?-1:1);rl(r,e,s,Math.max(u,Math.floor(s-F*U/P+H)),Math.min(m,Math.floor(s+(P-F)*U/P+H)),y)}const x=e[2*s+y];let D=u,S=m;for(vm(r,e,u,s),e[2*m+y]>x&&vm(r,e,u,m);D<S;){for(vm(r,e,D,S),D++,S--;e[2*D+y]<x;)D++;for(;e[2*S+y]>x;)S--}e[2*u+y]===x?vm(r,e,u,S):(S++,vm(r,e,S,m)),S<=s&&(u=S+1),s<=S&&(m=S-1)}}function vm(r,e,s,u){Yg(r,s,u),Yg(e,2*s,2*u),Yg(e,2*s+1,2*u+1)}function Yg(r,e,s){const u=r[e];r[e]=r[s],r[s]=u}function od(r,e,s,u){const m=r-s,y=e-u;return m*m+y*y}p.ARRAY_TYPE=ds,p.AUTH_ERR_MSG=Ce,p.Aabb=jo,p.Actor=class{constructor(r,e,s){this.target=r,this.parent=e,this.mapId=s,this.callbacks={},this.cancelCallbacks={},mt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ii()?r:ue,this.scheduler=new _0}send(r,e,s,u,m=!1,y){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=y,this.callbacks[x]=s);const D=ws(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:r,hasCallback:!!s,targetMapId:u,mustQueue:m,sourceMapId:this.mapId,data:Wl(e,D)},D),{cancel:()=>{s&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(r){const e=r.data,s=e.id;if(s&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const u=this.cancelCallbacks[s];delete this.cancelCallbacks[s],u&&u.cancel()}else if(e.mustQueue||Ii()){const u=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,e),u&&u.metadata||{type:"message"})}else this.processTask(s,e)}processTask(r,e){if("<response>"===e.type){const s=this.callbacks[r];delete this.callbacks[r],s&&(e.error?s(jr(e.error)):s(null,jr(e.data)))}else{const s=ws(this.globalScope)?void 0:[],u=e.hasCallback?(y,x)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:y?Wl(y):null,data:Wl(x,s)},s)}:y=>{},m=jr(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,m,u);else if(this.parent.getWorkerSource){const y=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,y[0],m.source)[y[1]](m,u)}else u(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=nh,p.Color=xn,p.ColorMode=To,p.CullFaceMode=ra,p.DEMData=Qc,p.DataConstantProperty=X,p.DedupedRequest=qg,p.DepthMode=id,p.EXTENT=mn,p.Elevation=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const s=e.getSource().maxzoom,u=1<<s,m=Math.floor(r.x),y=Math.floor((r.x-m)*u),x=Math.floor(r.y*u),D=this.findDEMTileFor(new _s(s,m,s,y,x));return!(!D||!D.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,s=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const u=this._source();if(!u||r.y<0||r.y>1)return e;const m=u.getSource().maxzoom,y=1<<m,x=Math.floor(r.x),D=r.x-x,S=new _s(m,x,m,Math.floor(D*y),Math.floor(r.y*y)),P=this.findDEMTileFor(S);if(!P||!P.dem)return e;const F=P.dem,z=1<<P.tileID.canonical.z,U=(D*z-P.tileID.canonical.x)*F.dim,H=(r.y*z-P.tileID.canonical.y)*F.dim,G=Math.floor(U),K=Math.floor(H);return(s?this.exaggeration():1)*wi(wi(F.get(G,K),F.get(G,K+1),H-K),wi(F.get(G+1,K),F.get(G+1,K+1),H-K),U-G)}getAtTileOffset(r,e,s){const u=1<<r.canonical.z;return this.getAtPointOrZero(new Fu(r.wrap+(r.canonical.x+e/mn)/u,(r.canonical.y+s/mn)/u))}getAtTileOffsetFunc(r,e,s,u){return m=>{const y=this.getAtTileOffset(r,m.x,m.y),x=u.upVector(r.canonical,m.x,m.y);return es(x,x,y*u.upVectorScale(r.canonical,e,s).metersToTile),x}}getForTilePoints(r,e,s,u){if(this.isUsingMockSource())return!1;const m=Ol.create(this,r,u);return!!m&&(e.forEach(y=>{y[2]=this.exaggeration()*m.getElevationAt(y[0],y[1],s)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const s=e.dem.tree,u=e.tileID,m=1<<r.canonical.z-u.canonical.z;let y=r.canonical.x/m-u.canonical.x,x=r.canonical.y/m-u.canonical.y,D=0;for(let S=0;S<r.canonical.z-u.canonical.z&&!s.leaves[D];S++){y*=2,x*=2;const P=2*Math.floor(x)+Math.floor(y);D=s.childOffsets[D]+P,y%=1,x%=1}return{min:this.exaggeration()*s.minimums[D],max:this.exaggeration()*s.maximums[D]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,s){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=qo,p.EvaluationParameters=B,p.Event=Po,p.Evented=ka,p.FillExtrusionBucket=Vp,p.Frustum=Dp,p.FrustumCorners=bl,p.GLOBE_RADIUS=Ka,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=Jl,p.GLOBE_ZOOM_THRESHOLD_MIN=ng,p.GlobeSharedBuffers=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const r of this._wireframeSegments)r.destroy()}}_fillGridMeshWithLods(r,e){const s=new At,u=new an,m=[],y=r+1+2,x=e[0]+1,D=e[0]+1+(1+e.length),S=(P,F,z)=>{let U=P===y-1?P-2:0===P?P:P-1;return U+=z?24575:0,[U,F]};for(let P=0;P<y;++P)s.emplaceBack(...S(P,0,!0));for(let P=0;P<x;++P)for(let F=0;F<y;++F)s.emplaceBack(...S(F,P,(0===F||F===y-1)&&!0));for(let P=0;P<e.length;++P){const F=e[P];for(let z=0;z<y;++z)s.emplaceBack(...S(z,F,!0))}for(let P=0;P<e.length;++P){const F=u.length,z=e[P]+1+2,U=new an;for(let K=0;K<z-1;K++){const re=K===z-2,he=re?y*(D-e.length+P-K):y;for(let be=0;be<y-1;be++){const de=K*y+be;0===K||re||0===be||be===y-2?(U.emplaceBack(de+1,de,de+he),U.emplaceBack(de+he,de+he+1,de+1)):(u.emplaceBack(de+1,de,de+he),u.emplaceBack(de+he,de+he+1,de+1))}}const H=Ar.simpleSegment(0,F,s.length,u.length-F);for(let K=0;K<U.uint16.length;K+=3)u.emplaceBack(U.uint16[K],U.uint16[K+1],U.uint16[K+2]);const G=Ar.simpleSegment(0,F,s.length,u.length-F);m.push({withoutSkirts:H,withSkirts:G})}return{vertices:s,indices:u,segments:m}}_createGrid(r){const e=this._fillGridMeshWithLods(64,$c);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,Pu.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new an;for(let m=0;m<=64;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const s=new ki,u=new ki;this._poleSegments=[];for(let m=0,y=0;m<ng;m++){const x=360/(1<<m);s.emplaceBack(0,-Ka,0,.5,0),u.emplaceBack(0,-Ka,0,.5,1);for(let D=0;D<=64;D++){const S=D/64,P=wi(0,x,S),[F,z,U]=Ql(og,Gd,P,Ka);s.emplaceBack(F,z,U,S,0),u.emplaceBack(F,z,U,S,1)}this._poleSegments.push(Ar.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(s,tg,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(u,tg,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}getWirefameBuffers(r,e){if(!this._wireframeSegments){const s=new $r,u=64,m=u+1+2,y=1;this._wireframeSegments=[];for(let x=0,D=0;x<$c.length;x++){const S=$c[x];for(let F=y;F<S+y;F++)for(let z=y;z<u+y;z++){const U=F*m+z;s.emplaceBack(U,U+1),s.emplaceBack(U,U+m),s.emplaceBack(U,U+m+1)}const P=S*u*3;this._wireframeSegments.push(Ar.simpleSegment(0,D,(S+1)*m,P)),D+=P}this._wireframeIndexBuffer=r.createIndexBuffer(s)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},p.GlyphManager=Xu,p.ImagePosition=Ag,p.KDBush=ym,p.LivePerformanceUtils=Rh,p.LngLat=Yi,p.LngLatBounds=Wa,p.LocalGlyphMode=Fg,p.MAX_MERCATOR_LATITUDE=Hr,p.MercatorCoordinate=Fu,p.ONE_EM=Yr,p.OverscaledTileID=_s,p.PerformanceMarkers=ll,p.Point=Ne,p.Properties=pe,p.RGBAImage=gs,p.Ray=ga,p.RequestManager=class{constructor(r,e,s){this._transformRequestFn=r,this._customAccessToken=e,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const r=function(){let e="";for(let s=0;s<10;s++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",nn,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,e){return this._transformRequestFn&&this._transformRequestFn(r,e)||{url:r}}normalizeStyleURL(r,e){if(!Re(r))return r;const s=Zt(r);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeGlyphsURL(r,e){if(!Re(r))return r;const s=Zt(r);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeSourceURL(r,e,s,u){if(!Re(r))return r;const m=Zt(r);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),s&&m.params.push(`language=${s}`),u&&m.params.push(`worldview=${u}`),this._makeAPIURL(m,this._customAccessToken||e)}normalizeSpriteURL(r,e,s,u){const m=Zt(r);return Re(r)?(m.path=`/styles/v1${m.path}/sprite${e}${s}`,this._makeAPIURL(m,this._customAccessToken||u)):(m.path+=`${e}${s}`,zt(m))}normalizeTileURL(r,e,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!Re(r))return r;const u=Zt(r);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||s&&"raster"!==u.authority&&512===s?"@2x":""}${Ie.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${Le.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${Le.TILE_URL_VERSION}${u.path}`);const m=this._customAccessToken||function(y){for(const x of y){const D=x.match(/^access_token=(.*)$/);if(D)return D[1]}return null}(u.params)||Le.ACCESS_TOKEN;return Le.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,m)}canonicalizeTileURL(r,e){const s=Zt(r);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return r;let u="mapbox://";s.path.match(/^\/raster\/v1\//)?u+=`raster/${s.path.replace(`/${Le.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${s.path.replace(`/${Le.TILE_URL_VERSION}/`,"")}`;let m=s.params;return e&&(m=m.filter(y=>!y.match(/^access_token=/))),m.length&&(u+=`?${m.join("&")}`),u}canonicalizeTileset(r,e){const s=!!e&&Re(e),u=[];for(const m of r.tiles||[])We(m)?u.push(this.canonicalizeTileURL(m,s)):u.push(m);return u}_makeAPIURL(r,e){const s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=Zt(Le.API_URL);if(r.protocol=u.protocol,r.authority=u.authority,"http"===r.protocol){const m=r.params.indexOf("secure");m>=0&&r.params.splice(m,1)}if("/"!==u.path&&(r.path=`${u.path}${r.path}`),!Le.REQUIRE_ACCESS_TOKEN)return zt(r);if(e=e||Le.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return r.params=r.params.filter(m=>-1===m.indexOf("access_token")),r.params.push(`access_token=${e||""}`),zt(r)}},p.ResourceType=Kr,p.SegmentVector=Ar,p.SourceCache=tu,p.StencilMode=eu,p.StructArrayLayout1ui2=zn,p.StructArrayLayout2f1f2i16=bn,p.StructArrayLayout2i4=At,p.StructArrayLayout2ui4=$r,p.StructArrayLayout3f12=Mn,p.StructArrayLayout3ui6=an,p.StructArrayLayout4i8=ht,p.StructArrayLayout5f20=ki,p.Texture=ts,p.Tile=_h,p.Transitionable=q,p.Uniform1f=Lc,p.Uniform1i=class extends Rs{constructor(r){super(r),this.current=0}set(r,e,s){this.fetchUniformLocation(r,e)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},p.Uniform2f=class extends Rs{constructor(r){super(r),this.current=[0,0]}set(r,e,s){this.fetchUniformLocation(r,e)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}},p.Uniform3f=class extends Rs{constructor(r){super(r),this.current=[0,0,0]}set(r,e,s){this.fetchUniformLocation(r,e)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}},p.Uniform4f=qh,p.UniformColor=Yh,p.UniformMatrix2f=class extends Rs{constructor(r){super(r),this.current=Js}set(r,e,s){if(this.fetchUniformLocation(r,e))for(let u=0;u<4;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}},p.UniformMatrix3f=class extends Rs{constructor(r){super(r),this.current=Ym}set(r,e,s){if(this.fetchUniformLocation(r,e))for(let u=0;u<9;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}},p.UniformMatrix4f=class extends Rs{constructor(r){super(r),this.current=O_}set(r,e,s){if(this.fetchUniformLocation(r,e)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let u=1;u<16;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}},p.UnwrappedTileID=Eg,p.ValidationError=tn,p.VectorTileFeature=vf,p.VectorTileWorkerSource=class extends ka{constructor(r,e,s,u,m){super(),this.actor=r,this.layerIndex=e,this.availableImages=s,this.loadVectorData=m||rd,this.loading={},this.loaded={},this.deduped=new qg(r.scheduler),this.isSpriteLoaded=u,this.scheduler=r.scheduler}loadTile(r,e){const s=r.uid,u=r&&r.request,m=u&&u.collectResourceTiming,y=this.loading[s]=new b0(r);y.abort=this.loadVectorData(r,(x,D)=>{const S=!this.loading[s];if(delete this.loading[s],S||x||!D)return y.status="done",S||(this.loaded[s]=y),e(x);const P=D.rawData,F={};D.expires&&(F.expires=D.expires),D.cacheControl&&(F.cacheControl=D.cacheControl),y.vectorTile=D.vectorTile||new yf(new Yu(P));const z=()=>{y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,(U,H)=>{if(U||!H)return e(U);const G={};if(m){const K=Cs(u);K.length>0&&(G.resourceTiming=JSON.parse(JSON.stringify(K)))}e(null,ot({rawTileData:P.slice(0)},H,F,G))})};this.isSpriteLoaded?z():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(z,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):z()}),this.loaded=this.loaded||{},this.loaded[s]=y})}reloadTile(r,e){const s=this.loaded,u=r.uid,m=this;if(s&&s[u]){const y=s[u];y.showCollisionBoxes=r.showCollisionBoxes,y.enableTerrain=!!r.enableTerrain,y.projection=r.projection,y.tileTransform=lc(r.tileID.canonical,r.projection);const x=(D,S)=>{const P=y.reloadCallback;P&&(delete y.reloadCallback,y.parse(y.vectorTile,m.layerIndex,this.availableImages,m.actor,P)),e(D,S)};"parsing"===y.status?y.reloadCallback=x:"done"===y.status&&(y.vectorTile?y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,x):x())}}abortTile(r,e){const s=r.uid,u=this.loading[s];u&&(u.abort&&u.abort(),delete this.loading[s]),e()}removeTile(r,e){const s=this.loaded,u=r.uid;s&&s[u]&&delete s[u],e()}},p.WritingMode=Ns,p.ZoomDependentExpression=Sc,p.add=qa,p.addDynamicAttributes=td,p.adjoint=function(r,e){var s=e[0],u=e[1],m=e[2],y=e[3],x=e[4],D=e[5],S=e[6],P=e[7],F=e[8];return r[0]=x*F-D*P,r[1]=m*P-u*F,r[2]=u*D-m*x,r[3]=D*S-y*F,r[4]=s*F-m*S,r[5]=m*y-s*D,r[6]=y*P-x*S,r[7]=u*S-s*P,r[8]=s*x-u*y,r},p.asyncAll=dr,p.bezier=ir,p.bindAll=mt,p.boundsAttributes=fm,p.bufferConvexPolygon=function(r,e){const s=[];for(let u=0;u<r.length;u++){const m=Ci(u-1,-1,r.length-1),y=Ci(u+1,-1,r.length-1),x=r[u],D=r[y],S=r[m].sub(x).unit(),P=D.sub(x).unit(),F=P.angleWithSep(S.x,S.y),z=S.add(P).unit().mult(-1*e/Math.sin(F/2));s.push(x.add(z))}return s},p.cacheEntryPossiblyAdded=function(r){Ui++,Ui>Un&&(r.getActor().send("enforceCacheSizeLimit",Bl),Ui=0)},p.calculateGlobeLabelMatrix=function(r,e){const{x:s,y:u}=r.point,m=j_(s,u,r.worldSize/r._pixelsPerMercatorPixel,0,0);return Au(m,m,ig(_a(e)))},p.calculateGlobeMatrix=function(r){const{x:e,y:s}=r.point,{lng:u,lat:m}=r._center;return j_(e,s,r.worldSize,u,m)},p.calculateGlobeMercatorMatrix=function(r){const e=r.pixelsPerMeter,s=e/$o(1,r.center.lat),u=Uo(new Float64Array(16));return Nd(u,u,[r.point.x,r.point.y,0]),vl(u,u,[s,s,e]),Float32Array.from(u)},p.circumferenceAtLatitude=sg,p.clamp=Wn,p.clearTileCache=function(r){if(!zr())return;const e=ue.caches.delete(So);r&&e.catch(r).then(()=>r())},p.clipLine=om,p.clone=function(r){var e=new ds(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},p.clone$1=oi,p.collisionCircleLayout=ay,p.config=Le,p.conjugate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},p.create=function(){var r=new ds(16);return ds!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},p.create$1=Jh,p.createExpression=Mc,p.createLayout=Oe,p.createStyleLayer=function(r){return"custom"===r.type?new m0(r):new Ab[r.type](r)},p.cross=N_,p.degToRad=kt,p.distance=function(r,e){return Math.hypot(e[0]-r[0],e[1]-r[1],e[2]-r[2])},p.div=function(r,e,s){return r[0]=e[0]/s[0],r[1]=e[1]/s[1],r[2]=e[2]/s[2],r},p.dot=ma,p.earthRadius=ps,p.ease=Mo,p.easeCubicInOut=mi,p.ecefToLatLng=function([r,e,s]){const u=Math.hypot(r,e,s),m=Math.atan2(r,s),y=.5*Math.PI-Math.acos(-e/u);return new Yi(Yt(m),Yt(y))},p.emitValidationErrors=Gm,p.endsWith=gt,p.enforceCacheSizeLimit=function(r){Io(),ni&&ni.then(e=>{e.keys().then(s=>{for(let u=0;u<s.length-r;u++)e.delete(s[u])})})},p.evaluateSizeForFeature=Ml,p.evaluateSizeForZoom=rc,p.evaluateVariableOffset=uh,p.evented=C,p.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},p.exactEquals$1=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]},p.exported=_o,p.exported$1=Ie,p.extend=ot,p.extend$1=Ds,p.fillExtrusionHeightLift=wf,p.filterObject=_n,p.fromMat4=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},p.fromQuat=function(r,e){var s=e[0],u=e[1],m=e[2],y=e[3],x=s+s,D=u+u,S=m+m,P=s*x,F=u*x,z=u*D,U=m*x,H=m*D,G=m*S,K=y*x,re=y*D,he=y*S;return r[0]=1-z-G,r[1]=F+he,r[2]=U-re,r[3]=0,r[4]=F-he,r[5]=1-P-G,r[6]=H+K,r[7]=0,r[8]=U+re,r[9]=H-K,r[10]=1-P-z,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},p.fromRotation=function(r,e){var s=Math.sin(e),u=Math.cos(e);return r[0]=u,r[1]=s,r[2]=0,r[3]=-s,r[4]=u,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},p.fromScaling=F_,p.furthestTileCorner=function(r){const e=Math.round((r+45+360)%360/90)%4;return ui[e]},p.getAABBPointSquareDist=function(r,e,s){let u=0;for(let m=0;m<2;++m){const y=s?s[m]:0;r[m]>y&&(u+=(r[m]-y)*(r[m]-y)),e[m]<y&&(u+=(y-e[m])*(y-e[m]))}return u},p.getAnchorAlignment=my,p.getAnchorJustification=Ku,p.getBounds=function(r){let e=1/0,s=1/0,u=-1/0,m=-1/0;for(const y of r)e=Math.min(e,y.x),s=Math.min(s,y.y),u=Math.max(u,y.x),m=Math.max(m,y.y);return{min:new Ne(e,s),max:new Ne(u,m)}},p.getColumn=po,p.getDefaultExportFromCjs=Pt,p.getGridMatrix=function(r,e,s,u){const m=e.getNorth(),y=e.getSouth(),x=e.getWest(),D=e.getEast(),S=1<<r.z,P=D-x,F=m-y,z=P/64,U=-F/$c[s],H=[0,z,0,U,0,0,m,x,0];if(r.z>0){const G=180/u;Za(H,H,[G/P+1,0,0,0,G/F+1,0,-.5*G/z,.5*G/U,1])}return H[2]=S,H[5]=r.x,H[8]=r.y,H},p.getImage=ge,p.getJSON=function(r,e){return Gs(ot(r,{type:"json"}),e)},p.getLatitudinalLod=function(r){const e=Hr-5;r=Wn(r,-e,e)/e*90;const s=Math.pow(Math.abs(Math.sin(kt(r))),3);return Math.round(s*($c.length-1))},p.getMapSessionAPI=pr,p.getPerformanceMeasurement=Cs,p.getProjection=Lf,p.getRTLTextPluginStatus=M,p.getReferrer=ji,p.getTilePoint=function(r,{x:e,y:s},u=0){return new Ne(((e-u)*r.scale-r.x)*mn,(s*r.scale-r.y)*mn)},p.getTileVec3=function(r,e,s=0){return zd(((e.x-s)*r.scale-r.x)*mn,(e.y*r.scale-r.y)*mn,Lu(e.z,e.y))},p.getVideo=function(r,e){const s=ue.document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let u=0;u<r.length;u++){const m=ue.document.createElement("source");Oa(r[u])||(s.crossOrigin="Anonymous"),m.src=r[u],s.appendChild(m)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(r){const e=[0,0,0],s=Uo(new Float64Array(16));return Au(s,r.pixelMatrix,r.globeMatrix),Fr(e,e,s),new Ne(e[0],e[1])},p.globeDenormalizeECEF=ig,p.globeECEFOrigin=function(r,e){const s=[0,0,0];return Fr(s,s,Mp(_a(e.canonical))),Fr(s,s,r),s},p.globeMetersToEcef=xl,p.globeNormalizeECEF=Mp,p.globePixelsToTileUnits=function(r,e){return mn/(512*Math.pow(2,r))*ec(_a(e))},p.globePoleMatrixForTile=function(r,e,s){const u=Uo(new Float64Array(16)),m=(e/(1<<r)-.5)*Math.PI*2;return gp(u,s.globeMatrix,m),Float32Array.from(u)},p.globeTileBounds=_a,p.globeTiltAtLngLat=ku,p.globeToMercatorTransition=Hd,p.globeUseCustomAntiAliasing=function(r,e,s){const u=Hd(s.zoom),m=r.style.map._antialias,y=!!e.extStandardDerivatives,x=e.extStandardDerivativesForceOff||r.terrain&&r.terrain.exaggeration()>0;return 0===u&&!m&&!x&&y},p.identity=Uo,p.identity$1=Qh,p.invert=mp,p.isFullscreen=function(){return!!ue.document.fullscreenElement||!!ue.document.webkitFullscreenElement},p.isLngLatBehindGlobe=nf,p.isMapAuthenticated=function(r){return Jr.has(r)},p.isMapboxURL=Re,p.isSafariWithAntialiasingBug=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!ws(r)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=io,p.latLngToECEF=Hc,p.len=xp,p.length=Bd,p.length$1=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},p.lngFromMercatorX=ms,p.loadVectorTile=rd,p.makeRequest=Gs,p.mapValue=function(r,e,s,u,m){return Wn((r-e)/(s-e)*(m-u)+u,u,m)},p.mercatorScale=Sp,p.mercatorXfromLng=wl,p.mercatorYfromLat=va,p.mercatorZfromAltitude=$o,p.mul=Bc,p.mul$1=bp,p.multiply=Au,p.multiply$1=Za,p.multiply$2=Ya,p.nextPowerOfTwo=Gt,p.normalize=qr,p.normalize$1=Ep,p.normalize$2=eg,p.number=wi,p.ortho=function(r,e,s,u,m,y,x){var D=1/(e-s),S=1/(u-m),P=1/(y-x);return r[0]=-2*D,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*S,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*P,r[11]=0,r[12]=(e+s)*D,r[13]=(m+u)*S,r[14]=(x+y)*P,r[15]=1,r},p.pbf=qu,p.perspective=function(r,e,s,u,m){var y,x=1/Math.tan(e/2);return r[0]=x/s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,null!=m&&m!==1/0?(r[10]=(m+u)*(y=1/(u-m)),r[14]=2*m*u*y):(r[10]=-1,r[14]=-2*u),r},p.pick=function(r,e){const s={};for(let u=0;u<e.length;u++){const m=e[u];m in r&&(s[m]=r[m])}return s},p.plugin=k,p.pointGeometry=pn,p.polesInViewport=function(r){const e=Uo(new Float64Array(16));Au(e,r.pixelMatrix,r.globeMatrix);const s=[0,hs,0],u=[0,fs,0];return Fr(s,s,e),Fr(u,u,e),[s[0]>0&&s[0]<=r.width&&s[1]>0&&s[1]<=r.height&&!nf(r,new Yi(r.center.lat,90)),u[0]>0&&u[0]<=r.width&&u[1]>0&&u[1]<=r.height&&!nf(r,new Yi(r.center.lat,-90))]},p.polygonContainsPoint=Gc,p.polygonIntersectsBox=cg,p.polygonIntersectsPolygon=Cl,p.polygonizeBounds=function(r,e,s=0,u=!0){const m=new Ne(s,s),y=r.sub(m),x=e.add(m),D=[y,new Ne(x.x,y.y),x,new Ne(y.x,x.y)];return u&&D.push(y.clone()),D},p.posAttributes=Pu,p.postMapLoadEvent=fr,p.postPerformanceEvent=Xi,p.postTurnstileEvent=Qn,p.potpack=Ig,p.prevPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},p.radToDeg=Yt,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(r){return r({pluginStatus:_,pluginURL:a}),C.on("pluginStateChange",r),r},p.removeAuthState=function(r){Jr.delete(r)},p.renderColorRamp=Pp,p.resample=Nu,p.rotateX=L_,p.rotateX$1=ef,p.rotateY=gp,p.rotateY$1=wp,p.rotateZ=function(r,e,s){var u=Math.sin(s),m=Math.cos(s),y=e[0],x=e[1],D=e[2],S=e[3],P=e[4],F=e[5],z=e[6],U=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=y*m+P*u,r[1]=x*m+F*u,r[2]=D*m+z*u,r[3]=S*m+U*u,r[4]=P*m-y*u,r[5]=F*m-x*u,r[6]=z*m-D*u,r[7]=U*m-S*u,r},p.rotateZ$1=function(r,e,s){s*=.5;var u=e[0],m=e[1],y=e[2],x=e[3],D=Math.sin(s),S=Math.cos(s);return r[0]=u*S+m*D,r[1]=m*S-u*D,r[2]=y*S+x*D,r[3]=x*S-y*D,r},p.scale=vl,p.scale$1=Qm,p.scale$2=es,p.scaleAndAdd=Kl,p.set=function(r,e,s,u){return r[0]=e,r[1]=s,r[2]=u,r},p.setCacheLimits=function(r,e){Bl=r,Un=e},p.setColumn=function(r,e,s){r[4*e+0]=s[0],r[4*e+1]=s[1],r[4*e+2]=s[2],r[4*e+3]=s[3]},p.setRTLTextPlugin=function(r,e,s=!1){if(_===ar||_===Fn||_===Eo)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=_o.resolveURL(r),_=ar,Va=e,v(),s||O()},p.smoothstep=$s,p.spec=lt,p.squaredLength=function(r){var e=r[0],s=r[1],u=r[2];return e*e+s*s+u*u},p.storeAuthState=function(r,e){e?Jr.add(r):Jr.delete(r)},p.sub=Xa,p.subtract=Vd,p.symbolSize=Dg,p.tileAABB=function(r,e,s,u,m,y,x,D,S){if("globe"===S.name)return function V_(r,e,s){const u=e/r.worldSize,m=r.globeMatrix;if(s.z<=1){const Ke=_a(s).getCorners();return z_(Ke,m,u),jo.fromPoints(Ke)}const y=jd(s),x=Tp(y);z_(x,m,u);const D=Number.MAX_VALUE,S=[-D,-D,-D],P=[D,D,D];if(y.contains(r.center)){for(const Ot of x)zc(P,P,Ot),Os(S,S,Ot);S[2]=0;const Ke=r.point,dt=[Ke.x*u,Ke.y*u,0];return zc(P,P,dt),Os(S,S,dt),new jo(P,S)}const F=[m[12]*u,m[13]*u,m[14]*u],z=y.getCenter(),U=Wn(r.center.lat,-Hr,Hr),H=Wn(z.lat,-Hr,Hr),G=wl(r.center.lng),K=va(U);let re=G-wl(z.lng);const he=K-va(H);re>.5?re-=1:re<-.5&&(re+=1);let be=0;Math.abs(re)>Math.abs(he)?be=re>=0?1:3:(be=he>=0?0:2,Kl(F,F,[m[4]*u,m[5]*u,m[6]*u],-Math.sin(kt(he>=0?y.getSouth():y.getNorth()))*Ka));const de=x[be],ve=x[(be+1)%4],we=new B_(de,ve,F),Ee=[Ud(we,0)||de[0],Ud(we,1)||de[1],Ud(we,2)||de[2]],Je=Hd(r.zoom);if(Je>0){const Ke=function({x:Ot,y:rt,z:vt},yt,Mt,Rt,at){const Ht=1/(1<<vt);let rn=Ot*Ht,Kt=rn+Ht,Sn=rt*Ht,Ut=Sn+Ht,gn=0;const $n=(rn+Kt)/2-Rt;return $n>.5?gn=-1:$n<-.5&&(gn=1),rn=((rn+gn)*yt-(Rt*=yt))*Mt+Rt,Kt=((Kt+gn)*yt-Rt)*Mt+Rt,Sn=(Sn*yt-(at*=yt))*Mt+at,Ut=(Ut*yt-at)*Mt+at,[[rn,Ut,0],[Kt,Ut,0],[Kt,Sn,0],[rn,Sn,0]]}(s,e,r._pixelsPerMercatorPixel,G,K);for(let Ot=0;Ot<x.length;Ot++)Ru(x[Ot],Ke[Ot],Je);const dt=qa([],Ke[be],Ke[(be+1)%4]);es(dt,dt,.5),Ru(Ee,dt,Je)}for(const Ke of x)zc(P,P,Ke),Os(S,S,Ke);return P[2]=Math.min(de[2],ve[2]),zc(P,P,Ee),Os(S,S,Ee),new jo(P,S)}(r,e,new nh(s,u,m));const P=lc({z:s,x:u,y:m},S);return new jo([(y+P.x/P.scale)*e,e*(P.y/P.scale),x],[(y+P.x2/P.scale)*e,e*(P.y2/P.scale),D])},p.tileCornersToBounds=jd,p.tileTransform=lc,p.transformMat3=function(r,e,s){var u=e[0],m=e[1],y=e[2];return r[0]=u*s[0]+m*s[3]+y*s[6],r[1]=u*s[1]+m*s[4]+y*s[7],r[2]=u*s[2]+m*s[5]+y*s[8],r},p.transformMat4=Fr,p.transformMat4$1=Vc,p.transformQuat=zv,p.transitionTileAABBinECEF=Ou,p.translate=Nd,p.transpose=function(r,e){if(r===e){var s=e[1],u=e[2],m=e[5];r[1]=e[3],r[2]=e[6],r[3]=s,r[5]=e[7],r[6]=u,r[7]=m}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r},p.triggerPluginCompletionEvent=f,p.uniqueId=xt,p.updateGlobeVertexNormal=function(r,e,s,u,m){const y=5*e+2;r.float32[y+0]=s,r.float32[y+1]=u,r.float32[y+2]=m},p.validateCustomStyleLayer=function(r){const e=[],s=r.id;return void 0===s&&e.push({message:`layers.${s}: missing required property "id"`}),void 0===r.render&&e.push({message:`layers.${s}: missing required method "render"`}),r.renderingMode&&"2d"!==r.renderingMode&&"3d"!==r.renderingMode&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},p.validateFilter=r=>Jo(Ba(r)),p.validateFog=r=>Jo(cp(r)),p.validateLayer=r=>Jo(P_(r)),p.validateLight=r=>Jo(yl(r)),p.validateSource=r=>Jo(fa(r)),p.validateStyle=Hh,p.validateTerrain=r=>Jo(to(r)),p.values=Hs,p.vectorTile=gf,p.version=Ye,p.warnOnce=qn,p.window=ue,p.wrap=Ci}),Be(0,function(p){function ue(ye){if("number"==typeof ye||"boolean"==typeof ye||"string"==typeof ye||null==ye)return JSON.stringify(ye);if(Array.isArray(ye)){let ie="[";for(const ge of ye)ie+=`${ue(ge)},`;return`${ie}]`}let Q="{";for(const ie of Object.keys(ye).sort())Q+=`${ie}:${ue(ye[ie])},`;return`${Q}}`}function Ye(ye){let Q="";for(const ie of p.refProperties)Q+=`/${ue(ye[ie])}`;return Q}class Ge{constructor(Q){this.keyCache={},Q&&this.replace(Q)}replace(Q){this._layerConfigs={},this._layers={},this.update(Q,[])}update(Q,ie){for(const Ce of Q)this._layerConfigs[Ce.id]=Ce,(this._layers[Ce.id]=p.createStyleLayer(Ce)).compileFilter(),this.keyCache[Ce.id]&&delete this.keyCache[Ce.id];for(const Ce of ie)delete this.keyCache[Ce],delete this._layerConfigs[Ce],delete this._layers[Ce];this.familiesBySource={};const ge=function(Ce,Re){const We={};for(let Pe=0;Pe<Ce.length;Pe++){const et=Re&&Re[Ce[Pe].id]||Ye(Ce[Pe]);Re&&(Re[Ce[Pe].id]=et);let $t=We[et];$t||($t=We[et]=[]),$t.push(Ce[Pe])}const je=[];for(const Pe in We)je.push(We[Pe]);return je}(p.values(this._layerConfigs),this.keyCache);for(const Ce of ge){const Re=Ce.map(Zt=>this._layers[Zt.id]),We=Re[0];if("none"===We.visibility)continue;const je=We.source||"";let Pe=this.familiesBySource[je];Pe||(Pe=this.familiesBySource[je]={});const et=We.sourceLayer||"_geojsonTileLayer";let $t=Pe[et];$t||($t=Pe[et]=[]),$t.push(Re)}}}class Le{loadTile(Q,ie){const{uid:ge,encoding:Ce,rawImageData:Re,padding:We,buildQuadTree:je}=Q,Pe=p.window.ImageBitmap&&Re instanceof p.window.ImageBitmap?this.getImageData(Re,We):Re;ie(null,new p.DEMData(ge,Pe,Ce,We<1,je))}getImageData(Q,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Q.width,Q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Q.width,this.offscreenCanvas.height=Q.height,this.offscreenCanvasContext.drawImage(Q,0,0,Q.width,Q.height);const ge=this.offscreenCanvasContext.getImageData(-ie,-ie,Q.width+2*ie,Q.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ge}}function Ie(ye,Q){if(0!==ye.length){ke(ye[0],Q);for(var ie=1;ie<ye.length;ie++)ke(ye[ie],!Q)}}function ke(ye,Q){for(var ie=0,ge=0,Ce=0,Re=ye.length,We=Re-1;Ce<Re;We=Ce++){var je=(ye[Ce][0]-ye[We][0])*(ye[We][1]+ye[Ce][1]),Pe=ie+je;ge+=Math.abs(ie)>=Math.abs(je)?ie-Pe+je:je-Pe+ie,ie=Pe}ie+ge>=0!=!!Q&&ye.reverse()}var $e=p.getDefaultExportFromCjs(function ye(Q,ie){var ge,Ce=Q&&Q.type;if("FeatureCollection"===Ce)for(ge=0;ge<Q.features.length;ge++)ye(Q.features[ge],ie);else if("GeometryCollection"===Ce)for(ge=0;ge<Q.geometries.length;ge++)ye(Q.geometries[ge],ie);else if("Feature"===Ce)ye(Q.geometry,ie);else if("Polygon"===Ce)Ie(Q.coordinates,ie);else if("MultiPolygon"===Ce)for(ge=0;ge<Q.coordinates.length;ge++)Ie(Q.coordinates[ge],ie);return Q});const Qe=p.VectorTileFeature.prototype.toGeoJSON;var Tt={exports:{}},Wt=p.pointGeometry,nn=p.vectorTile.VectorTileFeature,Pt=En;function En(ye,Q){this.options=Q||{},this.features=ye,this.length=ye.length}function cn(ye,Q){this.id="number"==typeof ye.id?ye.id:void 0,this.type=ye.type,this.rawGeometry=1===ye.type?[ye.geometry]:ye.geometry,this.properties=ye.tags,this.extent=Q||4096}En.prototype.feature=function(ye){return new cn(this.features[ye],this.options.extent)},cn.prototype.loadGeometry=function(){var ye=this.rawGeometry;this.geometry=[];for(var Q=0;Q<ye.length;Q++){for(var ie=ye[Q],ge=[],Ce=0;Ce<ie.length;Ce++)ge.push(new Wt(ie[Ce][0],ie[Ce][1]));this.geometry.push(ge)}return this.geometry},cn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ye=this.geometry,Q=1/0,ie=-1/0,ge=1/0,Ce=-1/0,Re=0;Re<ye.length;Re++)for(var We=ye[Re],je=0;je<We.length;je++){var Pe=We[je];Q=Math.min(Q,Pe.x),ie=Math.max(ie,Pe.x),ge=Math.min(ge,Pe.y),Ce=Math.max(Ce,Pe.y)}return[Q,ge,ie,Ce]},cn.prototype.toGeoJSON=nn.prototype.toGeoJSON;var Dn=p.pbf,pn=Pt;function nt(ye){var Q=new Dn;return function(ie,ge){for(var Ce in ie.layers)ge.writeMessage(3,Ne,ie.layers[Ce])}(ye,Q),Q.finish()}function Ne(ye,Q){var ie;Q.writeVarintField(15,ye.version||1),Q.writeStringField(1,ye.name||""),Q.writeVarintField(5,ye.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<ye.length;ie++)ge.feature=ye.feature(ie),Q.writeMessage(2,Ft,ge);var Ce=ge.keys;for(ie=0;ie<Ce.length;ie++)Q.writeStringField(3,Ce[ie]);var Re=ge.values;for(ie=0;ie<Re.length;ie++)Q.writeMessage(4,mi,Re[ie])}function Ft(ye,Q){var ie=ye.feature;void 0!==ie.id&&Q.writeVarintField(1,ie.id),Q.writeMessage(2,jt,ye),Q.writeVarintField(3,ie.type),Q.writeMessage(4,ui,ie)}function jt(ye,Q){var ie=ye.feature,ge=ye.keys,Ce=ye.values,Re=ye.keycache,We=ye.valuecache;for(var je in ie.properties){var Pe=ie.properties[je],et=Re[je];if(null!==Pe){void 0===et&&(ge.push(je),Re[je]=et=ge.length-1),Q.writeVarint(et);var $t=typeof Pe;"string"!==$t&&"boolean"!==$t&&"number"!==$t&&(Pe=JSON.stringify(Pe));var Zt=$t+":"+Pe,zt=We[Zt];void 0===zt&&(Ce.push(Pe),We[Zt]=zt=Ce.length-1),Q.writeVarint(zt)}}}function kt(ye,Q){return(Q<<3)+(7&ye)}function Yt(ye){return ye<<1^ye>>31}function ui(ye,Q){for(var ie=ye.loadGeometry(),ge=ye.type,Ce=0,Re=0,We=ie.length,je=0;je<We;je++){var Pe=ie[je],et=1;1===ge&&(et=Pe.length),Q.writeVarint(kt(1,et));for(var $t=3===ge?Pe.length-1:Pe.length,Zt=0;Zt<$t;Zt++){1===Zt&&1!==ge&&Q.writeVarint(kt(2,$t-1));var zt=Pe[Zt].x-Ce,Zn=Pe[Zt].y-Re;Q.writeVarint(Yt(zt)),Q.writeVarint(Yt(Zn)),Ce+=zt,Re+=Zn}3===ge&&Q.writeVarint(kt(7,1))}}function mi(ye,Q){var ie=typeof ye;"string"===ie?Q.writeStringField(1,ye):"boolean"===ie?Q.writeBooleanField(7,ye):"number"===ie&&(ye%1!=0?Q.writeDoubleField(3,ye):ye<0?Q.writeSVarintField(6,ye):Q.writeVarintField(5,ye))}Tt.exports=nt,Tt.exports.fromVectorTileJs=nt,Tt.exports.fromGeojsonVt=function(ye,Q){Q=Q||{};var ie={};for(var ge in ye)ie[ge]=new pn(ye[ge].features,Q),ie[ge].name=ge,ie[ge].version=Q.version,ie[ge].extent=Q.extent;return nt({layers:ie})},Tt.exports.GeoJSONWrapper=pn;var ir=p.getDefaultExportFromCjs(Tt.exports);const Mo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},Wn=Math.fround||($s=new Float32Array(1),ye=>($s[0]=+ye,$s[0]));var $s;const Ci=3,dr=5,Hs=6;class ot{constructor(Q){this.options=Object.assign(Object.create(Mo),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:ie,minZoom:ge,maxZoom:Ce}=this.options;ie&&console.time("total time");const Re=`prepare ${Q.length} points`;ie&&console.time(Re),this.points=Q;const We=[];for(let Pe=0;Pe<Q.length;Pe++){const et=Q[Pe];if(!et.geometry)continue;const[$t,Zt]=et.geometry.coordinates,zt=Wn(bt($t)),Zn=Wn(Gt(Zt));We.push(zt,Zn,1/0,Pe,-1,1),this.options.reduce&&We.push(0)}let je=this.trees[Ce+1]=this._createTree(We);ie&&console.timeEnd(Re);for(let Pe=Ce;Pe>=ge;Pe--){const et=+Date.now();je=this.trees[Pe]=this._createTree(this._cluster(je,Pe)),ie&&console.log("z%d: %d clusters in %dms",Pe,je.numItems,+Date.now()-et)}return ie&&console.timeEnd("total time"),this}getClusters(Q,ie){let ge=((Q[0]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,Q[1]));let Re=180===Q[2]?180:((Q[2]+180)%360+360)%360-180;const We=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)ge=-180,Re=180;else if(ge>Re){const Zt=this.getClusters([ge,Ce,180,We],ie),zt=this.getClusters([-180,Ce,Re,We],ie);return Zt.concat(zt)}const je=this.trees[this._limitZoom(ie)],Pe=je.range(bt(ge),Gt(We),bt(Re),Gt(Ce)),et=je.data,$t=[];for(const Zt of Pe){const zt=this.stride*Zt;$t.push(et[zt+dr]>1?ut(et,zt,this.clusterProps):this.points[et[zt+Ci]])}return $t}getChildren(Q){const ie=this._getOriginId(Q),ge=this._getOriginZoom(Q),Ce="No cluster with the specified id.",Re=this.trees[ge];if(!Re)throw new Error(Ce);const We=Re.data;if(ie*this.stride>=We.length)throw new Error(Ce);const je=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),Pe=Re.within(We[ie*this.stride],We[ie*this.stride+1],je),et=[];for(const $t of Pe){const Zt=$t*this.stride;We[Zt+4]===Q&&et.push(We[Zt+dr]>1?ut(We,Zt,this.clusterProps):this.points[We[Zt+Ci]])}if(0===et.length)throw new Error(Ce);return et}getLeaves(Q,ie,ge){const Ce=[];return this._appendLeaves(Ce,Q,ie=ie||10,ge=ge||0,0),Ce}getTile(Q,ie,ge){const Ce=this.trees[this._limitZoom(Q)],Re=Math.pow(2,Q),{extent:We,radius:je}=this.options,Pe=je/We,et=(ge-Pe)/Re,$t=(ge+1+Pe)/Re,Zt={features:[]};return this._addTileFeatures(Ce.range((ie-Pe)/Re,et,(ie+1+Pe)/Re,$t),Ce.data,ie,ge,Re,Zt),0===ie&&this._addTileFeatures(Ce.range(1-Pe/Re,et,1,$t),Ce.data,Re,ge,Re,Zt),ie===Re-1&&this._addTileFeatures(Ce.range(0,et,Pe/Re,$t),Ce.data,-1,ge,Re,Zt),Zt.features.length?Zt:null}getClusterExpansionZoom(Q){let ie=this._getOriginZoom(Q)-1;for(;ie<=this.options.maxZoom;){const ge=this.getChildren(Q);if(ie++,1!==ge.length)break;Q=ge[0].properties.cluster_id}return ie}_appendLeaves(Q,ie,ge,Ce,Re){const We=this.getChildren(ie);for(const je of We){const Pe=je.properties;if(Pe&&Pe.cluster?Re+Pe.point_count<=Ce?Re+=Pe.point_count:Re=this._appendLeaves(Q,Pe.cluster_id,ge,Ce,Re):Re<Ce?Re++:Q.push(je),Q.length===ge)break}return Re}_createTree(Q){const ie=new p.KDBush(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<Q.length;ge+=this.stride)ie.add(Q[ge],Q[ge+1]);return ie.finish(),ie.data=Q,ie}_addTileFeatures(Q,ie,ge,Ce,Re,We){for(const je of Q){const Pe=je*this.stride,et=ie[Pe+dr]>1;let $t,Zt,zt;if(et)$t=xt(ie,Pe,this.clusterProps),Zt=ie[Pe],zt=ie[Pe+1];else{const Yn=this.points[ie[Pe+Ci]];$t=Yn.properties;const[jn,Qn]=Yn.geometry.coordinates;Zt=bt(jn),zt=Gt(Qn)}const Zn={type:1,geometry:[[Math.round(this.options.extent*(Zt*Re-ge)),Math.round(this.options.extent*(zt*Re-Ce))]],tags:$t};let Nn;Nn=et||this.options.generateId?ie[Pe+Ci]:this.points[ie[Pe+Ci]].id,void 0!==Nn&&(Zn.id=Nn),We.features.push(Zn)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,ie){const{radius:ge,extent:Ce,reduce:Re,minPoints:We}=this.options,je=ge/(Ce*Math.pow(2,ie)),Pe=Q.data,et=[],$t=this.stride;for(let Zt=0;Zt<Pe.length;Zt+=$t){if(Pe[Zt+2]<=ie)continue;Pe[Zt+2]=ie;const zt=Pe[Zt],Zn=Pe[Zt+1],Nn=Q.within(Pe[Zt],Pe[Zt+1],je),Yn=Pe[Zt+dr];let jn=Yn;for(const Qn of Nn){const Jn=Qn*$t;Pe[Jn+2]>ie&&(jn+=Pe[Jn+dr])}if(jn>Yn&&jn>=We){let Qn,Jn=zt*Yn,fr=Zn*Yn,si=-1;const Xi=((Zt/$t|0)<<5)+(ie+1)+this.points.length;for(const Ao of Nn){const pr=Ao*$t;if(Pe[pr+2]<=ie)continue;Pe[pr+2]=ie;const Jr=Pe[pr+dr];Jn+=Pe[pr]*Jr,fr+=Pe[pr+1]*Jr,Pe[pr+4]=Xi,Re&&(Qn||(Qn=this._map(Pe,Zt,!0),si=this.clusterProps.length,this.clusterProps.push(Qn)),Re(Qn,this._map(Pe,pr)))}Pe[Zt+4]=Xi,et.push(Jn/jn,fr/jn,1/0,Xi,-1,jn),Re&&et.push(si)}else{for(let Qn=0;Qn<$t;Qn++)et.push(Pe[Zt+Qn]);if(jn>1)for(const Qn of Nn){const Jn=Qn*$t;if(!(Pe[Jn+2]<=ie)){Pe[Jn+2]=ie;for(let fr=0;fr<$t;fr++)et.push(Pe[Jn+fr])}}}}return et}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,ie,ge){if(Q[ie+dr]>1){const We=this.clusterProps[Q[ie+Hs]];return ge?Object.assign({},We):We}const Ce=this.points[Q[ie+Ci]].properties,Re=this.options.map(Ce);return ge&&Re===Ce?Object.assign({},Re):Re}}function ut(ye,Q,ie){return{type:"Feature",id:ye[Q+Ci],properties:xt(ye,Q,ie),geometry:{type:"Point",coordinates:[(ge=ye[Q],360*(ge-.5)),pt(ye[Q+1])]}};var ge}function xt(ye,Q,ie){const ge=ye[Q+dr],Ce=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Re=ye[Q+Hs],We=-1===Re?{}:Object.assign({},ie[Re]);return Object.assign(We,{cluster:!0,cluster_id:ye[Q+Ci],point_count:ge,point_count_abbreviated:Ce})}function bt(ye){return ye/360+.5}function Gt(ye){const Q=Math.sin(ye*Math.PI/180),ie=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ie<0?0:ie>1?1:ie}function pt(ye){const Q=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function mt(ye,Q,ie,ge){for(var Ce,Re=ge,We=ie-Q>>1,je=ie-Q,Pe=ye[Q],et=ye[Q+1],$t=ye[ie],Zt=ye[ie+1],zt=Q+3;zt<ie;zt+=3){var Zn=gt(ye[zt],ye[zt+1],Pe,et,$t,Zt);if(Zn>Re)Ce=zt,Re=Zn;else if(Zn===Re){var Nn=Math.abs(zt-We);Nn<je&&(Ce=zt,je=Nn)}}Re>ge&&(Ce-Q>3&&mt(ye,Q,Ce,ge),ye[Ce+2]=Re,ie-Ce>3&&mt(ye,Ce,ie,ge))}function gt(ye,Q,ie,ge,Ce,Re){var We=Ce-ie,je=Re-ge;if(0!==We||0!==je){var Pe=((ye-ie)*We+(Q-ge)*je)/(We*We+je*je);Pe>1?(ie=Ce,ge=Re):Pe>0&&(ie+=We*Pe,ge+=je*Pe)}return(We=ye-ie)*We+(je=Q-ge)*je}function un(ye,Q,ie,ge){var Ce={id:void 0===ye?null:ye,type:Q,geometry:ie,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Re){var We=Re.geometry,je=Re.type;if("Point"===je||"MultiPoint"===je||"LineString"===je)_n(Re,We);else if("Polygon"===je||"MultiLineString"===je)for(var Pe=0;Pe<We.length;Pe++)_n(Re,We[Pe]);else if("MultiPolygon"===je)for(Pe=0;Pe<We.length;Pe++)for(var et=0;et<We[Pe].length;et++)_n(Re,We[Pe][et])}(Ce),Ce}function _n(ye,Q){for(var ie=0;ie<Q.length;ie+=3)ye.minX=Math.min(ye.minX,Q[ie]),ye.minY=Math.min(ye.minY,Q[ie+1]),ye.maxX=Math.max(ye.maxX,Q[ie]),ye.maxY=Math.max(ye.maxY,Q[ie+1])}function oi(ye,Q,ie,ge){if(Q.geometry){var Ce=Q.geometry.coordinates,Re=Q.geometry.type,We=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2),je=[],Pe=Q.id;if(ie.promoteId?Pe=Q.properties[ie.promoteId]:ie.generateId&&(Pe=ge||0),"Point"===Re)An(Ce,je);else if("MultiPoint"===Re)for(var et=0;et<Ce.length;et++)An(Ce[et],je);else if("LineString"===Re)qn(Ce,je,We,!1);else if("MultiLineString"===Re){if(ie.lineMetrics){for(et=0;et<Ce.length;et++)qn(Ce[et],je=[],We,!1),ye.push(un(Pe,"LineString",je,Q.properties));return}Vi(Ce,je,We,!1)}else if("Polygon"===Re)Vi(Ce,je,We,!0);else{if("MultiPolygon"!==Re){if("GeometryCollection"===Re){for(et=0;et<Q.geometry.geometries.length;et++)oi(ye,{id:Pe,geometry:Q.geometry.geometries[et],properties:Q.properties},ie,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(et=0;et<Ce.length;et++){var $t=[];Vi(Ce[et],$t,We,!0),je.push($t)}}ye.push(un(Pe,Re,je,Q.properties))}}function An(ye,Q){Q.push(Xr(ye[0])),Q.push(Ii(ye[1])),Q.push(0)}function qn(ye,Q,ie,ge){for(var Ce,Re,We=0,je=0;je<ye.length;je++){var Pe=Xr(ye[je][0]),et=Ii(ye[je][1]);Q.push(Pe),Q.push(et),Q.push(0),je>0&&(We+=ge?(Ce*et-Pe*Re)/2:Math.sqrt(Math.pow(Pe-Ce,2)+Math.pow(et-Re,2))),Ce=Pe,Re=et}var $t=Q.length-3;Q[2]=1,mt(Q,0,$t,ie),Q[$t+2]=1,Q.size=Math.abs(We),Q.start=0,Q.end=Q.size}function Vi(ye,Q,ie,ge){for(var Ce=0;Ce<ye.length;Ce++){var Re=[];qn(ye[Ce],Re,ie,ge),Q.push(Re)}}function Xr(ye){return ye/360+.5}function Ii(ye){var Q=Math.sin(ye*Math.PI/180),ie=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ie<0?0:ie>1?1:ie}function rr(ye,Q,ie,ge,Ce,Re,We,je){if(ge/=Q,Re>=(ie/=Q)&&We<ge)return ye;if(We<ie||Re>=ge)return null;for(var Pe=[],et=0;et<ye.length;et++){var $t=ye[et],Zt=$t.geometry,zt=$t.type,Zn=0===Ce?$t.minX:$t.minY,Nn=0===Ce?$t.maxX:$t.maxY;if(Zn>=ie&&Nn<ge)Pe.push($t);else if(!(Nn<ie||Zn>=ge)){var Yn=[];if("Point"===zt||"MultiPoint"===zt)Wo(Zt,Yn,ie,ge,Ce);else if("LineString"===zt)ws(Zt,Yn,ie,ge,Ce,!1,je.lineMetrics);else if("MultiLineString"===zt)po(Zt,Yn,ie,ge,Ce,!1);else if("Polygon"===zt)po(Zt,Yn,ie,ge,Ce,!0);else if("MultiPolygon"===zt)for(var jn=0;jn<Zt.length;jn++){var Qn=[];po(Zt[jn],Qn,ie,ge,Ce,!0),Qn.length&&Yn.push(Qn)}if(Yn.length){if(je.lineMetrics&&"LineString"===zt){for(jn=0;jn<Yn.length;jn++)Pe.push(un($t.id,zt,Yn[jn],$t.tags));continue}"LineString"!==zt&&"MultiLineString"!==zt||(1===Yn.length?(zt="LineString",Yn=Yn[0]):zt="MultiLineString"),"Point"!==zt&&"MultiPoint"!==zt||(zt=3===Yn.length?"Point":"MultiPoint"),Pe.push(un($t.id,zt,Yn,$t.tags))}}}return Pe.length?Pe:null}function Wo(ye,Q,ie,ge,Ce){for(var Re=0;Re<ye.length;Re+=3){var We=ye[Re+Ce];We>=ie&&We<=ge&&(Q.push(ye[Re]),Q.push(ye[Re+1]),Q.push(ye[Re+2]))}}function ws(ye,Q,ie,ge,Ce,Re,We){for(var je,Pe,et=aa(ye),$t=0===Ce?Bl:Un,Zt=ye.start,zt=0;zt<ye.length-3;zt+=3){var Zn=ye[zt],Nn=ye[zt+1],Yn=ye[zt+2],jn=ye[zt+3],Qn=ye[zt+4],Jn=0===Ce?Zn:Nn,fr=0===Ce?jn:Qn,si=!1;We&&(je=Math.sqrt(Math.pow(Zn-jn,2)+Math.pow(Nn-Qn,2))),Jn<ie?fr>ie&&(Pe=$t(et,Zn,Nn,jn,Qn,ie),We&&(et.start=Zt+je*Pe)):Jn>ge?fr<ge&&(Pe=$t(et,Zn,Nn,jn,Qn,ge),We&&(et.start=Zt+je*Pe)):So(et,Zn,Nn,Yn),fr<ie&&Jn>=ie&&(Pe=$t(et,Zn,Nn,jn,Qn,ie),si=!0),fr>ge&&Jn<=ge&&(Pe=$t(et,Zn,Nn,jn,Qn,ge),si=!0),!Re&&si&&(We&&(et.end=Zt+je*Pe),Q.push(et),et=aa(ye)),We&&(Zt+=je)}var Xi=ye.length-3;Zn=ye[Xi],Nn=ye[Xi+1],Yn=ye[Xi+2],(Jn=0===Ce?Zn:Nn)>=ie&&Jn<=ge&&So(et,Zn,Nn,Yn),Xi=et.length-3,Re&&Xi>=3&&(et[Xi]!==et[0]||et[Xi+1]!==et[1])&&So(et,et[0],et[1],et[2]),et.length&&Q.push(et)}function aa(ye){var Q=[];return Q.size=ye.size,Q.start=ye.start,Q.end=ye.end,Q}function po(ye,Q,ie,ge,Ce,Re){for(var We=0;We<ye.length;We++)ws(ye[We],Q,ie,ge,Ce,Re,!1)}function So(ye,Q,ie,ge){ye.push(Q),ye.push(ie),ye.push(ge)}function Bl(ye,Q,ie,ge,Ce,Re){var We=(Re-Q)/(ge-Q);return ye.push(Re),ye.push(ie+(Ce-ie)*We),ye.push(1),We}function Un(ye,Q,ie,ge,Ce,Re){var We=(Re-ie)/(Ce-ie);return ye.push(Q+(ge-Q)*We),ye.push(Re),ye.push(1),We}function ni(ye,Q){for(var ie=[],ge=0;ge<ye.length;ge++){var Ce,Re=ye[ge],We=Re.type;if("Point"===We||"MultiPoint"===We||"LineString"===We)Ce=ri(Re.geometry,Q);else if("MultiLineString"===We||"Polygon"===We){Ce=[];for(var je=0;je<Re.geometry.length;je++)Ce.push(ri(Re.geometry[je],Q))}else if("MultiPolygon"===We)for(Ce=[],je=0;je<Re.geometry.length;je++){for(var Pe=[],et=0;et<Re.geometry[je].length;et++)Pe.push(ri(Re.geometry[je][et],Q));Ce.push(Pe)}ie.push(un(Re.id,We,Ce,Re.tags))}return ie}function ri(ye,Q){var ie=[];ie.size=ye.size,void 0!==ye.start&&(ie.start=ye.start,ie.end=ye.end);for(var ge=0;ge<ye.length;ge+=3)ie.push(ye[ge]+Q,ye[ge+1],ye[ge+2]);return ie}function zr(ye,Q){if(ye.transformed)return ye;var ie,ge,Ce,Re=1<<ye.z,We=ye.x,je=ye.y;for(ie=0;ie<ye.features.length;ie++){var Pe=ye.features[ie],et=Pe.geometry,$t=Pe.type;if(Pe.geometry=[],1===$t)for(ge=0;ge<et.length;ge+=2)Pe.geometry.push(Io(et[ge],et[ge+1],Q,Re,We,je));else for(ge=0;ge<et.length;ge++){var Zt=[];for(Ce=0;Ce<et[ge].length;Ce+=2)Zt.push(Io(et[ge][Ce],et[ge][Ce+1],Q,Re,We,je));Pe.geometry.push(Zt)}}return ye.transformed=!0,ye}function Io(ye,Q,ie,ge,Ce,Re){return[Math.round(ie*(ye*ge-Ce)),Math.round(ie*(Q*ge-Re))]}function mo(ye,Q,ie,ge,Ce){for(var Re=Q===Ce.maxZoom?0:Ce.tolerance/((1<<Q)*Ce.extent),We={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ie,y:ge,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},je=0;je<ye.length;je++){We.numFeatures++,Ui(We,ye[je],Re,Ce);var Pe=ye[je].minX,et=ye[je].minY,$t=ye[je].maxX,Zt=ye[je].maxY;Pe<We.minX&&(We.minX=Pe),et<We.minY&&(We.minY=et),$t>We.maxX&&(We.maxX=$t),Zt>We.maxY&&(We.maxY=Zt)}return We}function Ui(ye,Q,ie,ge){var Ce=Q.geometry,Re=Q.type,We=[];if("Point"===Re||"MultiPoint"===Re)for(var je=0;je<Ce.length;je+=3)We.push(Ce[je]),We.push(Ce[je+1]),ye.numPoints++,ye.numSimplified++;else if("LineString"===Re)Kr(We,Ce,ye,ie,!1,!1);else if("MultiLineString"===Re||"Polygon"===Re)for(je=0;je<Ce.length;je++)Kr(We,Ce[je],ye,ie,"Polygon"===Re,0===je);else if("MultiPolygon"===Re)for(var Pe=0;Pe<Ce.length;Pe++){var et=Ce[Pe];for(je=0;je<et.length;je++)Kr(We,et[je],ye,ie,!0,0===je)}if(We.length){var $t=Q.tags||null;if("LineString"===Re&&ge.lineMetrics){for(var Zt in $t={},Q.tags)$t[Zt]=Q.tags[Zt];$t.mapbox_clip_start=Ce.start/Ce.size,$t.mapbox_clip_end=Ce.end/Ce.size}var zt={geometry:We,type:"Polygon"===Re||"MultiPolygon"===Re?3:"LineString"===Re||"MultiLineString"===Re?2:1,tags:$t};null!==Q.id&&(zt.id=Q.id),ye.features.push(zt)}}function Kr(ye,Q,ie,ge,Ce,Re){var We=ge*ge;if(ge>0&&Q.size<(Ce?We:ge))ie.numPoints+=Q.length/3;else{for(var je=[],Pe=0;Pe<Q.length;Pe+=3)(0===ge||Q[Pe+2]>We)&&(ie.numSimplified++,je.push(Q[Pe]),je.push(Q[Pe+1])),ie.numPoints++;Ce&&function(et,$t){for(var Zt=0,zt=0,Zn=et.length,Nn=Zn-2;zt<Zn;Nn=zt,zt+=2)Zt+=(et[zt]-et[Nn])*(et[zt+1]+et[Nn+1]);if(Zt>0===$t)for(zt=0,Zn=et.length;zt<Zn/2;zt+=2){var Yn=et[zt],jn=et[zt+1];et[zt]=et[Zn-2-zt],et[zt+1]=et[Zn-1-zt],et[Zn-2-zt]=Yn,et[Zn-1-zt]=jn}}(je,Re),ye.push(je)}}function os(ye,Q){var ie=(Q=this.options=function(Ce,Re){for(var We in Re)Ce[We]=Re[We];return Ce}(Object.create(this.options),Q)).debug;if(ie&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ce,Re,We,je,Pe,et,ge=function(Ce,Re){var We=[];if("FeatureCollection"===Ce.type)for(var je=0;je<Ce.features.length;je++)oi(We,Ce.features[je],Re,je);else oi(We,"Feature"===Ce.type?Ce:{geometry:Ce},Re);return We}(ye,Q);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),je=Ce=ge,Pe=rr(Ce,1,-1-(We=(Re=Q).buffer/Re.extent),We,0,-1,2,Re),et=rr(Ce,1,1-We,2+We,0,-1,2,Re),(Pe||et)&&(je=rr(Ce,1,-We,1+We,0,-1,2,Re)||[],Pe&&(je=ni(Pe,1).concat(je)),et&&(je=je.concat(ni(et,-1)))),(ge=je).length&&this.splitTile(ge,0,0,0),ie&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ji(ye,Q,ie){return 32*((1<<ye)*ie+Q)+ye}function Gs(ye,Q){const ie=ye.tileID.canonical;if(!this._geoJSONIndex)return Q(null,null);const ge=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!ge)return Q(null,null);const Ce=new class{constructor(We){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=We.length,this._features=We}feature(We){return new class{constructor(je){this._feature=je,this.extent=p.EXTENT,this.type=je.type,this.properties=je.tags,"id"in je&&!isNaN(je.id)&&(this.id=parseInt(je.id,10))}loadGeometry(){if(1===this._feature.type){const je=[];for(const Pe of this._feature.geometry)je.push([new p.Point(Pe[0],Pe[1])]);return je}{const je=[];for(const Pe of this._feature.geometry){const et=[];for(const $t of Pe)et.push(new p.Point($t[0],$t[1]));je.push(et)}return je}}toGeoJSON(je,Pe,et){return Qe.call(this,je,Pe,et)}}(this._features[We])}}(ge.features);let Re=ir(Ce);0===Re.byteOffset&&Re.byteLength===Re.buffer.byteLength||(Re=new Uint8Array(Re)),Q(null,{vectorTile:Ce,rawData:Re.buffer})}os.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},os.prototype.splitTile=function(ye,Q,ie,ge,Ce,Re,We){for(var je=[ye,Q,ie,ge],Pe=this.options,et=Pe.debug;je.length;){ge=je.pop(),ie=je.pop(),Q=je.pop(),ye=je.pop();var $t=1<<Q,Zt=ji(Q,ie,ge),zt=this.tiles[Zt];if(!zt&&(et>1&&console.time("creation"),zt=this.tiles[Zt]=mo(ye,Q,ie,ge,Pe),this.tileCoords.push({z:Q,x:ie,y:ge}),et)){et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,ie,ge,zt.numFeatures,zt.numPoints,zt.numSimplified),console.timeEnd("creation"));var Zn="z"+Q;this.stats[Zn]=(this.stats[Zn]||0)+1,this.total++}if(zt.source=ye,Ce){if(Q===Pe.maxZoom||Q===Ce)continue;var Nn=1<<Ce-Q;if(ie!==Math.floor(Re/Nn)||ge!==Math.floor(We/Nn))continue}else if(Q===Pe.indexMaxZoom||zt.numPoints<=Pe.indexMaxPoints)continue;if(zt.source=null,0!==ye.length){et>1&&console.time("clipping");var Yn,jn,Qn,Jn,fr,si,Xi=.5*Pe.buffer/Pe.extent,Ao=.5-Xi,pr=.5+Xi,Jr=1+Xi;Yn=jn=Qn=Jn=null,fr=rr(ye,$t,ie-Xi,ie+pr,0,zt.minX,zt.maxX,Pe),si=rr(ye,$t,ie+Ao,ie+Jr,0,zt.minX,zt.maxX,Pe),ye=null,fr&&(Yn=rr(fr,$t,ge-Xi,ge+pr,1,zt.minY,zt.maxY,Pe),jn=rr(fr,$t,ge+Ao,ge+Jr,1,zt.minY,zt.maxY,Pe),fr=null),si&&(Qn=rr(si,$t,ge-Xi,ge+pr,1,zt.minY,zt.maxY,Pe),Jn=rr(si,$t,ge+Ao,ge+Jr,1,zt.minY,zt.maxY,Pe),si=null),et>1&&console.timeEnd("clipping"),je.push(Yn||[],Q+1,2*ie,2*ge),je.push(jn||[],Q+1,2*ie,2*ge+1),je.push(Qn||[],Q+1,2*ie+1,2*ge),je.push(Jn||[],Q+1,2*ie+1,2*ge+1)}}},os.prototype.getTile=function(ye,Q,ie){var ge=this.options,Ce=ge.extent,Re=ge.debug;if(ye<0||ye>24)return null;var We=1<<ye,je=ji(ye,Q=(Q%We+We)%We,ie);if(this.tiles[je])return zr(this.tiles[je],Ce);Re>1&&console.log("drilling down to z%d-%d-%d",ye,Q,ie);for(var Pe,et=ye,$t=Q,Zt=ie;!Pe&&et>0;)et--,$t=Math.floor($t/2),Zt=Math.floor(Zt/2),Pe=this.tiles[ji(et,$t,Zt)];return Pe&&Pe.source?(Re>1&&console.log("found parent tile z%d-%d-%d",et,$t,Zt),Re>1&&console.time("drilling down"),this.splitTile(Pe.source,et,$t,Zt,ye,Q,ie),Re>1&&console.timeEnd("drilling down"),this.tiles[je]?zr(this.tiles[je],Ce):null):null};class bi extends p.VectorTileWorkerSource{constructor(Q,ie,ge,Ce,Re){super(Q,ie,ge,Ce,Gs),Re&&(this.loadGeoJSON=Re)}loadData(Q,ie){const ge=Q&&Q.request,Ce=ge&&ge.collectResourceTiming;this.loadGeoJSON(Q,(Re,We)=>{if(Re||!We)return ie(Re);if("object"!=typeof We)return ie(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));{$e(We,!0);try{if(Q.filter){const Pe=p.createExpression(Q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Pe.result)throw new Error(Pe.value.map($t=>`${$t.key}: ${$t.message}`).join(", "));We={type:"FeatureCollection",features:We.features.filter($t=>Pe.value.evaluate({zoom:0},$t))}}this._geoJSONIndex=Q.cluster?new ot(function({superclusterOptions:Pe,clusterProperties:et}){if(!et||!Pe)return Pe;const $t={},Zt={},zt={accumulated:null,zoom:0},Zn={properties:null},Nn=Object.keys(et);for(const Yn of Nn){const[jn,Qn]=et[Yn],Jn=p.createExpression(Qn),fr=p.createExpression("string"==typeof jn?[jn,["accumulated"],["get",Yn]]:jn);$t[Yn]=Jn.value,Zt[Yn]=fr.value}return Pe.map=Yn=>{Zn.properties=Yn;const jn={};for(const Qn of Nn)jn[Qn]=$t[Qn].evaluate(zt,Zn);return jn},Pe.reduce=(Yn,jn)=>{Zn.properties=jn;for(const Qn of Nn)zt.accumulated=Yn[Qn],Yn[Qn]=Zt[Qn].evaluate(zt,Zn)},Pe}(Q)).load(We.features):new os(Pe=We,Q.geojsonVtOptions)}catch(Pe){return ie(Pe)}this.loaded={};const je={};if(Ce){const Pe=p.getPerformanceMeasurement(ge);Pe&&(je.resourceTiming={},je.resourceTiming[Q.source]=JSON.parse(JSON.stringify(Pe)))}ie(null,je)}var Pe})}reloadTile(Q,ie){const ge=this.loaded;return ge&&ge[Q.uid]?super.reloadTile(Q,ie):this.loadTile(Q,ie)}loadGeoJSON(Q,ie){if(Q.request)p.getJSON(Q.request,ie);else{if("string"!=typeof Q.data)return ie(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(Q.data))}catch{return ie(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Q,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId))}catch(ge){ie(ge)}}getClusterChildren(Q,ie){try{ie(null,this._geoJSONIndex.getChildren(Q.clusterId))}catch(ge){ie(ge)}}getClusterLeaves(Q,ie){try{ie(null,this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset))}catch(ge){ie(ge)}}}class Oa{constructor(Q){this.self=Q,this.actor=new p.Actor(Q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:bi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ie,ge)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=ge},this.self.registerRTLTextPlugin=ie=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=ie.applyArabicShaping,p.plugin.processBidirectionalText=ie.processBidirectionalText,p.plugin.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(Q,ie,ge){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q],ge()}checkIfReady(Q,ie,ge){ge()}setReferrer(Q,ie){this.referrer=ie}spriteLoaded(Q,ie){this.isSpriteLoaded[Q]=ie;for(const ge in this.workerSources[Q]){const Ce=this.workerSources[Q][ge];for(const Re in Ce)Ce[Re]instanceof p.VectorTileWorkerSource&&(Ce[Re].isSpriteLoaded=ie,Ce[Re].fire(new p.Event("isSpriteLoaded")))}}setImages(Q,ie,ge){this.availableImages[Q]=ie;for(const Ce in this.workerSources[Q]){const Re=this.workerSources[Q][Ce];for(const We in Re)Re[We].availableImages=ie}ge()}enableTerrain(Q,ie,ge){this.terrain=ie,ge()}setProjection(Q,ie){this.projections[Q]=p.getProjection(ie)}setLayers(Q,ie,ge){this.getLayerIndex(Q).replace(ie),ge()}updateLayers(Q,ie,ge){this.getLayerIndex(Q).update(ie.layers,ie.removedIds),ge()}loadTile(Q,ie,ge){const Ce=this.enableTerrain?p.extend({enableTerrain:this.terrain},ie):ie;Ce.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,ie.type,ie.source).loadTile(Ce,ge)}loadDEMTile(Q,ie,ge){const Ce=this.enableTerrain?p.extend({buildQuadTree:this.terrain},ie):ie;this.getDEMWorkerSource(Q,ie.source).loadTile(Ce,ge)}reloadTile(Q,ie,ge){const Ce=this.enableTerrain?p.extend({enableTerrain:this.terrain},ie):ie;Ce.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,ie.type,ie.source).reloadTile(Ce,ge)}abortTile(Q,ie,ge){this.getWorkerSource(Q,ie.type,ie.source).abortTile(ie,ge)}removeTile(Q,ie,ge){this.getWorkerSource(Q,ie.type,ie.source).removeTile(ie,ge)}removeSource(Q,ie,ge){if(!this.workerSources[Q]||!this.workerSources[Q][ie.type]||!this.workerSources[Q][ie.type][ie.source])return;const Ce=this.workerSources[Q][ie.type][ie.source];delete this.workerSources[Q][ie.type][ie.source],void 0!==Ce.removeSource?Ce.removeSource(ie,ge):ge()}loadWorkerSource(Q,ie,ge){try{this.self.importScripts(ie.url),ge()}catch(Ce){ge(Ce.toString())}}syncRTLPluginState(Q,ie,ge){try{p.plugin.setState(ie);const Ce=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=Ce){this.self.importScripts(Ce);const Re=p.plugin.isParsed();ge(Re?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ce}`),Re)}}catch(Ce){ge(Ce.toString())}}getAvailableImages(Q){let ie=this.availableImages[Q];return ie||(ie=[]),ie}getLayerIndex(Q){let ie=this.layerIndexes[Q];return ie||(ie=this.layerIndexes[Q]=new Ge),ie}getWorkerSource(Q,ie,ge){return this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][ie]||(this.workerSources[Q][ie]={}),this.workerSources[Q][ie][ge]||(this.workerSources[Q][ie][ge]=new this.workerSourceTypes[ie]({send:(Re,We,je,Pe,et,$t)=>{this.actor.send(Re,We,je,Q,et,$t)},scheduler:this.actor.scheduler},this.getLayerIndex(Q),this.getAvailableImages(Q),this.isSpriteLoaded[Q])),this.workerSources[Q][ie][ge]}getDEMWorkerSource(Q,ie){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][ie]||(this.demWorkerSources[Q][ie]=new Le),this.demWorkerSources[Q][ie]}enforceCacheSizeLimit(Q,ie){p.enforceCacheSizeLimit(ie)}getWorkerPerformanceMetrics(Q,ie,ge){ge(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Oa(self)),Oa}),Be(0,function(p){function ue(_,a){if(Array.isArray(_)){if(!Array.isArray(a)||_.length!==a.length)return!1;for(let f=0;f<_.length;f++)if(!ue(_[f],a[f]))return!1;return!0}if("object"==typeof _&&null!==_&&null!==a){if("object"!=typeof a||Object.keys(_).length!==Object.keys(a).length)return!1;for(const f in _)if(!ue(_[f],a[f]))return!1;return!0}return _===a}var Ye=Ge;function Ge(_){return a=_,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,C,M=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(M);try{C=new Worker(O),v=!0}catch{v=!1}return C&&C.terminate(),URL.revokeObjectURL(O),v}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var v=document.createElement("canvas");v.width=v.height=1;var C=v.getContext("2d");if(!C)return!1;var M=C.getImageData(0,0,1,1);return M&&M.width===v.width}()||(void 0===Le[f=a&&a.failIfMajorPerformanceCaveat]&&(Le[f]=function(v){var C,O,k,B,M=(O=v,k=document.createElement("canvas"),(B=Object.create(Ge.webGLContextAttributes)).failIfMajorPerformanceCaveat=O,k.getContext("webgl",B)||k.getContext("experimental-webgl",B));if(!M)return!1;try{C=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!C||M.isContextLost())&&(M.shaderSource(C,"void main() {}"),M.compileShader(C),!0===M.getShaderParameter(C,M.COMPILE_STATUS))}(f)),!Le[f]||document.documentMode));var a,f}var Le={};function Ie(_,a,f){const v=p.window.document.createElement(_);return void 0!==a&&(v.className=a),f&&f.appendChild(v),v}function ke(_,a,f){const v=p.window.document.createElementNS("http://www.w3.org/2000/svg",_);for(const C of Object.keys(a))v.setAttributeNS(null,C,a[C]);return f&&f.appendChild(v),v}Ge.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const $e=p.window.document&&p.window.document.documentElement.style,Qe=$e&&void 0!==$e.userSelect?"userSelect":"WebkitUserSelect";let Tt;function Wt(){$e&&Qe&&(Tt=$e[Qe],$e[Qe]="none")}function nn(){$e&&Qe&&($e[Qe]=Tt)}function Pt(_){_.preventDefault(),_.stopPropagation(),p.window.removeEventListener("click",Pt,!0)}function En(){p.window.addEventListener("click",Pt,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",Pt,!0)},0)}function cn(_,a){const f=_.getBoundingClientRect();return nt(_,f,a)}function Dn(_,a){const f=_.getBoundingClientRect(),v=[];for(let C=0;C<a.length;C++)v.push(nt(_,f,a[C]));return v}function pn(_){return void 0!==p.window.InstallTrigger&&2===_.button&&_.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button}function nt(_,a,f){const v=_.offsetWidth===a.width?1:_.offsetWidth/a.width;return new p.Point((f.clientX-a.left)*v,(f.clientY-a.top)*v)}function Ne(_,a){var f=a[0],v=a[1],C=a[2],M=a[3],O=f*M-C*v;return O?(_[0]=M*(O=1/O),_[1]=-v*O,_[2]=-C*O,_[3]=f*O,_):null}function Ft(_){const{userImage:a}=_;return!!(a&&a.render&&a.render())&&(_.data.replace(new Uint8Array(a.data.buffer)),!0)}class jt extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:f,callback:v}of this.requestors)this._notify(f,v);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,f){this._validate(a,f)&&(this.images[a]=f)}_validate(a,f){let v=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),v=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),v=!1),this._validateContent(f.content,f)||(this.fire(new p.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),v=!1),v}_validateStretch(a,f){if(!a)return!0;let v=0;for(const C of a){if(C[0]<v||C[1]<C[0]||f<C[1])return!1;v=C[1]}return!0}_validateContent(a,f){return!(a&&(4!==a.length||a[0]<0||f.data.width<a[0]||a[1]<0||f.data.height<a[1]||a[2]<0||f.data.width<a[2]||a[3]<0||f.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,f){f.version=this.images[a].version+1,this.images[a]=f,this.updatedImages[a]=!0}removeImage(a){const f=this.images[a];delete this.images[a],delete this.patterns[a],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,f){let v=!0;if(!this.isLoaded())for(const C of a)this.images[C]||(v=!1);this.isLoaded()||v?this._notify(a,f):this.requestors.push({ids:a,callback:f})}_notify(a,f){const v={};for(const C of a){this.images[C]||this.fire(new p.Event("styleimagemissing",{id:C}));const M=this.images[C];M?v[C]={data:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:!(!M.userImage||!M.userImage.render)}:p.warnOnce(`Image "${C}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,v)}getPixelSize(){const{width:a,height:f}=this.atlasImage;return{width:a,height:f}}getPattern(a){const f=this.patterns[a],v=this.getImage(a);if(!v)return null;if(f&&f.position.version===v.version)return f.position;if(f)f.position.version=v.version;else{const C={w:v.data.width+2,h:v.data.height+2,x:0,y:0},M=new p.ImagePosition(C,v);this.patterns[a]={bin:C,position:M}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const f=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(a,this.atlasImage,f.RGBA),this.atlasTexture&&this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const M in this.patterns)a.push(this.patterns[M].bin);const{w:f,h:v}=p.potpack(a),C=this.atlasImage;C.resize({width:f||1,height:v||1});for(const M in this.patterns){const{bin:O}=this.patterns[M],k=O.x+1,B=O.y+1,$=this.images[M].data,j=$.width,q=$.height;p.RGBAImage.copy($,C,{x:0,y:0},{x:k,y:B},{width:j,height:q}),p.RGBAImage.copy($,C,{x:0,y:q-1},{x:k,y:B-1},{width:j,height:1}),p.RGBAImage.copy($,C,{x:0,y:0},{x:k,y:B+q},{width:j,height:1}),p.RGBAImage.copy($,C,{x:j-1,y:0},{x:k-1,y:B},{width:1,height:q}),p.RGBAImage.copy($,C,{x:0,y:0},{x:k+j,y:B},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const f of a){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const v=this.images[f];Ft(v)&&this.updateImage(f,v)}}}const kt=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(_,a){return function([f,v,C]){const M=p.degToRad(v+90),O=p.degToRad(C);return{x:f*Math.cos(M)*Math.sin(O),y:f*Math.sin(M)*Math.sin(O),z:f*Math.cos(O),azimuthal:v,polar:C}}(_.expression.evaluate(a))}interpolate(_,a,f){return{x:p.number(_.x,a.x,f),y:p.number(_.y,a.y,f),z:p.number(_.z,a.z,f),azimuthal:p.number(_.azimuthal,a.azimuthal,f),polar:p.number(_.polar,a.polar,f)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class Yt extends p.Evented{constructor(a){super(),this._transitionable=new p.Transitionable(kt),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,f={}){if(!this._validate(p.validateLight,a,f))for(const v in a){const C=a[v];p.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),C):this._transitionable.setValue(v,C)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,v){return(!v||!1!==v.validate)&&p.emitValidationErrors(this,a.call(p.validateStyle,p.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const ui=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let mi=class extends p.Evented{constructor(_,a){super(),this._transitionable=new p.Transitionable(ui),this.set(_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(_){for(const a in _){const f=_[a];p.endsWith(a,"-transition")?this._transitionable.setTransition(a.slice(0,-11),f):this._transitionable.setValue(a,f)}}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}};function ir(_,a,f,v){const C=p.smoothstep(45,65,f),[M,O]=Mo(_,v),k=p.length(a);let B=1-Math.min(1,Math.exp((k-M)/(O-M)*-6));return B*=B*B,B=Math.min(1,1.00747*B),B*C*_.alpha}function Mo(_,a){const f=.5/Math.tan(.5*a);return[_.range[0]+f,_.range[1]+f]}const Wn=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class $s extends p.Evented{constructor(a,f){super(),this._transitionable=new p.Transitionable(Wn),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const a=this._transform,f="globe"===a.projection.name,v=p.globeToMercatorTransition(a.zoom),C=this.properties.get("range"),M=[.5,3];return{range:f?[p.number(M[0],C[0],v),p.number(M[1],C[1],v)]:C,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,f={}){if(!this._validate(p.validateFog,a,f)){for(const v of Object.keys(p.spec.fog))a&&void 0===a[v]&&(a[v]=p.spec.fog[v].default);for(const v in a){const C=a[v];p.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),C):this._transitionable.setValue(v,C)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,a))*f.a}getOpacityAtLatLng(a,f){return this._transform.projection.supportsFog?function(v,C,M){const O=p.MercatorCoordinate.fromLngLat(C),k=M.elevation?M.elevation.getAtPointOrZero(O):0,B=[O.x,O.y,k];return p.transformMat4(B,B,M.mercatorFogMatrix),ir(v,B,M.pitch,M._fov)}(this.state,a,f):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Mo(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,v){return(!v||!1!==v.validate)&&p.emitValidationErrors(this,a.call(p.validateStyle,p.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Ci{constructor(a,f){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const v=this.workerPool.acquire(this.id);for(let C=0;C<v.length;C++){const M=new Ci.Actor(v[C],f,this.id);M.name=`Worker ${C}`,this.actors.push(M)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,f,v){p.asyncAll(this.actors,(C,M)=>{C.send(a,f,M)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function dr(_,a,f){return a*(p.EXTENT/(_.tileSize*Math.pow(2,f-_.tileID.overscaledZ)))}Ci.Actor=p.Actor;class Hs{constructor(a,f,v,C){this.screenBounds=a,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,C)}static createFromScreenPoints(a,f){let v,C;if(a instanceof p.Point||"number"==typeof a[0]){const M=p.Point.convert(a);v=[M],C=f.isPointAboveHorizon(M)}else{const M=p.Point.convert(a[0]),O=p.Point.convert(a[1]);v=[M,O],C=p.polygonizeBounds(M,O).every(k=>f.isPointAboveHorizon(k))}return new Hs(v,f.getCameraPoint(),C,f)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(a){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const f=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],C=p.polygonizeBounds(f,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<v.x?C.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?C[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(C[3]=this.cameraPoint)),p.bufferConvexPolygon(C,a)}bufferedCameraGeometryGlobe(a){const f=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],C=p.polygonizeBounds(f,v,a),M=this.cameraPoint.clone();switch(3*((M.y>f.y)+(M.y>v.y))+((M.x>f.x)+(M.x>v.x))){case 0:C[0]=M,C[4]=M.clone();break;case 1:C.splice(1,0,M);break;case 2:C[1]=M;break;case 3:C.splice(4,0,M);break;case 5:C.splice(2,0,M);break;case 6:C[3]=M;break;case 7:C.splice(3,0,M);break;case 8:C[2]=M}return C}containsTile(a,f,v,C=0){const M=a.queryPadding/f._pixelsPerMercatorPixel+1,O=v?this._bufferedCameraMercator(M,f):this._bufferedScreenMercator(M,f);let k=a.tileID.wrap+(O.unwrapped?C:0);const B=O.polygon.map(ce=>p.getTilePoint(a.tileTransform,ce,k));if(!p.polygonIntersectsBox(B,0,0,p.EXTENT,p.EXTENT))return;k=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?C:0);const $=this.screenGeometryMercator.polygon.map(ce=>p.getTileVec3(a.tileTransform,ce,k)),j=$.map(ce=>new p.Point(ce[0],ce[1])),q=f.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),ee=p.getTileVec3(a.tileTransform,q,k),se=$.map(ce=>{const X=p.sub(ce,ce,ee);return p.normalize(X,X),new p.Ray(ee,X)}),le=dr(a,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:se,bufferedTilespaceGeometry:B,bufferedTilespaceBounds:(ae=p.getBounds(B),ae.min.x=p.clamp(ae.min.x,0,p.EXTENT),ae.min.y=p.clamp(ae.min.y,0,p.EXTENT),ae.max.x=p.clamp(ae.max.x,0,p.EXTENT),ae.max.y=p.clamp(ae.max.y,0,p.EXTENT),ae),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:le};var ae}_bufferedScreenMercator(a,f){const v=xt(a);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let C;return C="globe"===f.projection.name?this._projectAndResample(this.bufferedScreenGeometry(a),f):{polygon:this.bufferedScreenGeometry(a).map(M=>f.pointCoordinate3D(M)),unwrapped:!0},this._screenRaycastCache[v]=C,C}}_bufferedCameraMercator(a,f){const v=xt(a);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let C;return C="globe"===f.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),f):{polygon:this.bufferedCameraGeometry(a).map(M=>f.pointCoordinate3D(M)),unwrapped:!0},this._cameraRaycastCache[v]=C,C}}_projectAndResample(a,f){const v=function(M,O){const k=p.multiply([],O.pixelMatrix,O.globeMatrix),B=[0,-p.GLOBE_RADIUS,0,1],$=[0,p.GLOBE_RADIUS,0,1],j=[0,0,0,1];p.transformMat4$1(B,B,k),p.transformMat4$1($,$,k),p.transformMat4$1(j,j,k);const q=new p.Point(B[0]/B[3],B[1]/B[3]),ee=new p.Point($[0]/$[3],$[1]/$[3]),se=p.polygonContainsPoint(M,q)&&B[3]<j[3],le=p.polygonContainsPoint(M,ee)&&$[3]<j[3];if(!se&&!le)return null;const ae=function(Me,ze,Oe){for(let Xe=1;Xe<Me.length;Xe++){const At=ut(ze.pointCoordinate3D(Me[Xe-1]).x),Ve=ut(ze.pointCoordinate3D(Me[Xe]).x);if(Oe<0){if(At<Ve)return{idx:Xe,t:-At/(Ve-1-At)}}else if(Ve<At)return{idx:Xe,t:(1-At)/(Ve+1-At)}}return null}(M,O,se?-1:1);if(!ae)return null;const{idx:ce,t:X}=ae;let oe=ce>1?ot(M.slice(0,ce),O):[],fe=ce<M.length?ot(M.slice(ce),O):[];oe=oe.map(Me=>new p.Point(ut(Me.x),Me.y)),fe=fe.map(Me=>new p.Point(ut(Me.x),Me.y));const pe=[...oe];0===pe.length&&pe.push(fe[fe.length-1]);const Te=p.number(pe[pe.length-1].y,(0===fe.length?oe[0]:fe[0]).y,X);let De;return De=se?[new p.Point(0,Te),new p.Point(0,0),new p.Point(1,0),new p.Point(1,Te)]:[new p.Point(1,Te),new p.Point(1,1),new p.Point(0,1),new p.Point(0,Te)],pe.push(...De),0===fe.length?pe.push(oe[0]):pe.push(...fe),{polygon:pe.map(Me=>new p.MercatorCoordinate(Me.x,Me.y)),unwrapped:!1}}(a,f);if(v)return v;const C=function(M,O){let k=!1,B=-1/0,$=0;for(let q=0;q<M.length-1;q++)M[q].x>B&&(B=M[q].x,$=q);for(let q=0;q<M.length-1;q++){const ee=($+q)%(M.length-1),se=M[ee],le=M[ee+1];Math.abs(se.x-le.x)>.5&&(se.x<le.x?(se.x+=1,0===ee&&(M[M.length-1].x+=1)):(le.x+=1,ee+1===M.length-1&&(M[0].x+=1)),k=!0)}const j=p.mercatorXfromLng(O.center.lng);return k&&j<Math.abs(j-1)&&M.forEach(q=>{q.x-=1}),{polygon:M,unwrapped:k}}(ot(a,f).map(M=>new p.Point(ut(M.x),M.y)),f);return{polygon:C.polygon.map(M=>new p.MercatorCoordinate(M.x,M.y)),unwrapped:C.unwrapped}}}function ot(_,a){return p.resample(_,f=>{const v=a.pointCoordinate3D(f);f.x=v.x,f.y=v.y},1/256)}function ut(_){return _<0?1+_%1:_%1}function xt(_){return 100*_|0}function bt(_,a,f,v,C){const M=function(O,k){if(O)return C(O);if(k){_.url&&k.tiles&&_.tiles&&delete _.tiles;const B=p.pick(p.extend(k,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(B.vectorLayers=k.vector_layers,B.vectorLayerIds=B.vectorLayers.map($=>$.id)),B.tiles=a.canonicalizeTileset(B,_.url),C(null,B)}};return _.url?p.getJSON(a.transformRequest(a.normalizeSourceURL(_.url,null,f,v),p.ResourceType.Source),M):p.exported.frame(()=>M(null,_))}class Gt{constructor(a,f,v){this.bounds=p.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=f||0,this.maxzoom=v||24}validateBounds(a){return Array.isArray(a)&&4===a.length?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const f=Math.pow(2,a.z),v=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*f),C=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*f),M=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*f),O=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*f);return a.x>=v&&a.x<M&&a.y>=C&&a.y<O}}class pt{constructor(a,f,v){this.context=a;const C=a.gl;this.buffer=C.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const mt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class gt{constructor(a,f,v,C){this.length=f.length,this.attributes=v,this.itemSize=f.bytesPerElement,this.dynamicDraw=C,this.context=a;const M=a.gl;this.buffer=M.createBuffer(),a.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,f){for(let v=0;v<this.attributes.length;v++){const C=f.attributes[this.attributes[v].name];void 0!==C&&a.enableVertexAttribArray(C)}}setVertexAttribPointers(a,f,v){for(let C=0;C<this.attributes.length;C++){const M=this.attributes[C],O=f.attributes[M.name];void 0!==O&&a.vertexAttribPointer(O,M.components,a[mt[M.type]],!1,this.itemSize,M.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class un{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _n extends un{getDefault(){return p.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class oi extends un{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class An extends un{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class qn extends un{getDefault(){return[!0,!0,!0,!0]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Vi extends un{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Xr extends un{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Ii extends un{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const f=this.current;(a.func!==f.func||a.ref!==f.ref||a.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class rr extends un{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Wo extends un{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=a,this.dirty=!1}}class ws extends un{getDefault(){return[0,1]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class aa extends un{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=a,this.dirty=!1}}class po extends un{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class So extends un{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.BLEND):f.disable(f.BLEND),this.current=a,this.dirty=!1}}class Bl extends un{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Un extends un{getDefault(){return p.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class ni extends un{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class ri extends un{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=a,this.dirty=!1}}class zr extends un{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Io extends un{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let mo,Ui=class extends un{getDefault(){return null}set(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)}};class Kr extends un{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class os extends un{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class ji extends un{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Gs extends un{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class bi extends un{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class Oa extends un{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class ye extends un{getDefault(){return null}set(a){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Q extends un{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class ie extends un{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class ge extends un{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Ce extends un{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Re extends un{constructor(a,f){super(a),this.context=a,this.parent=f}getDefault(){return null}}class We extends Re{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class je extends Re{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Pe extends je{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class et{constructor(a,f,v,C){this.context=a,this.width=f,this.height=v;const M=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new We(a,M),C&&(this.depthAttachment=new je(a,M))}destroy(){const a=this.context.gl,f=this.colorAttachment.get();if(f&&a.deleteTexture(f),this.depthAttachment){const v=this.depthAttachment.get();v&&a.deleteRenderbuffer(v)}a.deleteFramebuffer(this.framebuffer)}}class $t{constructor(a,f=!1){if(this.gl=a,this.isWebGL2=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),f){const v=a;this.extVertexArrayObject={createVertexArrayOES:v.createVertexArray.bind(a),deleteVertexArrayOES:v.deleteVertexArray.bind(a),bindVertexArrayOES:v.bindVertexArray.bind(a)}}this.clearColor=new _n(this),this.clearDepth=new oi(this),this.clearStencil=new An(this),this.colorMask=new qn(this),this.depthMask=new Vi(this),this.stencilMask=new Xr(this),this.stencilFunc=new Ii(this),this.stencilOp=new rr(this),this.stencilTest=new Wo(this),this.depthRange=new ws(this),this.depthTest=new aa(this),this.depthFunc=new po(this),this.blend=new So(this),this.blendFunc=new Bl(this),this.blendColor=new Un(this),this.blendEquation=new ni(this),this.cullFace=new ri(this),this.cullFaceSide=new zr(this),this.frontFace=new Io(this),this.program=new Ui(this),this.activeTexture=new Kr(this),this.viewport=new os(this),this.bindFramebuffer=new ji(this),this.bindRenderbuffer=new Gs(this),this.bindTexture=new bi(this),this.bindVertexBuffer=new Oa(this),this.bindElementBuffer=new ye(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Q(this),this.pixelStoreUnpack=new ie(this),this.pixelStoreUnpackPremultiplyAlpha=new ge(this),this.pixelStoreUnpackFlipY=new Ce(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),f||(this.extTextureHalfFloat=a.getExtension("OES_texture_half_float")),(f||this.extTextureHalfFloat&&a.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=f||a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,f){return new pt(this,a,f)}createVertexBuffer(a,f,v){return new gt(this,a,f,v)}createRenderbuffer(a,f,v){const C=this.gl,M=C.createRenderbuffer();return this.bindRenderbuffer.set(M),C.renderbufferStorage(C.RENDERBUFFER,a,f,v),this.bindRenderbuffer.set(null),M}createFramebuffer(a,f,v){return new et(this,a,f,v)}clear({color:a,depth:f,stencil:v}){const C=this.gl;let M=0;a&&(M|=C.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),void 0!==f&&(M|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),void 0!==v&&(M|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),C.clear(M)}setCullFace(a){!1===a.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){ue(a.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Zt extends p.Evented{constructor(a,f,v,C){if(super(),this.id=a,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(f,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(a){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=bt(this._options,this.map._requestManager,f,v,(C,M)=>{this._tileJSONRequest=null,this._loaded=!0,C?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),v&&2!==v.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new p.ErrorEvent(C))):M&&(p.extend(this,M),M.bounds&&(this.tileBounds=new Gt(M.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(M.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(C)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(a,f){const v=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(v,p.ResourceType.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile};if(C.request.collectResourceTiming=this._collectResourceTiming,a.actor&&"expired"!==a.state)"loading"===a.state?a.reloadCallback=f:a.request=a.actor.send("reloadTile",C,M.bind(this));else if(a.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",C,M.bind(this),void 0,!0);else{const O=p.loadVectorTile.call({deduped:this._deduped},C,(k,B)=>{k||!B?M.call(this,k):(C.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},a.actor&&a.actor.send("loadTile",C,M.bind(this),void 0,!0))},!0);a.request={cancel:O}}function M(O,k){return delete a.request,a.aborted?f(null):O&&404!==O.status?f(O):(k&&k.resourceTiming&&(a.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&a.setExpiryData(k),a.loadVectorData(k,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id})}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class zt extends p.Evented{constructor(a,f,v,C){super(),this.id=a,this.dispatcher=v,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},f),p.extend(this,p.pick(f,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=bt(this._options,this.map._requestManager,null,null,(f,v)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new p.ErrorEvent(f)):v&&(p.extend(this,v),v.bounds&&(this.tileBounds=new Gt(v.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(v.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(f)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,f){const v=p.exported.devicePixelRatio>=2,C=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);a.request=p.getImage(this.map._requestManager.transformRequest(C,p.ResourceType.Tile),(M,O,k,B)=>(delete a.request,a.aborted?(a.state="unloaded",f(null)):M?(a.state="errored",f(M)):O?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:k,expires:B}),a.setTexture(O,this.map.painter),a.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null)))}static loadTileData(a,f,v){a.setTexture(f,v)}static unloadTileData(a,f){a.texture&&f.saveTileTexture(a.texture)}abortTile(a,f){a.request&&(a.request.cancel(),delete a.request),f()}unloadTile(a,f){a.texture&&this.map.painter.saveTileTexture(a.texture),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Zn(_,a,f,v,C,M,O,k){const B=[_,f,C,a,v,M,1,1,1],$=[O,k,1],j=p.adjoint([],B),[q,ee,se]=p.transformMat3($,$,p.transpose(j,j));return p.multiply$1(B,[q,0,0,0,ee,0,0,0,se],B)}class Nn extends p.Evented{constructor(a,f,v,C){super(),this.id=a,this.dispatcher=v,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=f,this._dirty=!1}load(a,f){this._loaded=f||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(v,C)=>{if(this._imageRequest=null,this._loaded=!0,v)this.fire(new p.ErrorEvent(v));else if(C){const{HTMLImageElement:M}=p.window;this.image=C instanceof M?p.exported.getImageData(C):C,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const f=a.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(v){let C=1/0,M=1/0,O=-1/0,k=-1/0;for(const q of v)C=Math.min(C,q.x),M=Math.min(M,q.y),O=Math.max(O,q.x),k=Math.max(k,q.y);const B=Math.max(O-C,k-M),$=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),j=Math.pow(2,$);return new p.CanonicalTileID($,Math.floor((C+O)/2*j),Math.floor((M+k)/2*j))}(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const B in this.tiles){const $=this.tiles[B];"loaded"!==$.state&&($.state="loaded",$.texture=this.texture)}if(this._boundsArray)return;const f=p.tileTransform(this.tileID,this.map.transform.projection),[v,C,M,O]=this.coordinates.map(B=>{const $=f.projection.project(B[0],B[1]);return p.getTilePoint(f,$)._round()});this.perspectiveTransform=function(B,$,j,q,ee,se,le,ae,ce,X){const oe=Zn(0,0,B,0,0,$,B,$),fe=Zn(j,q,ee,se,le,ae,ce,X);return p.multiply$1(fe,p.adjoint(oe,oe),fe),[fe[6]/fe[8]*B/p.EXTENT,fe[7]/fe[8]*$/p.EXTENT]}(this.width,this.height,v.x,v.y,C.x,C.y,O.x,O.y,M.x,M.y);const k=this._boundsArray=new p.StructArrayLayout4i8;k.emplaceBack(v.x,v.y,0,0),k.emplaceBack(C.x,C.y,p.EXTENT,0),k.emplaceBack(O.x,O.y,0,p.EXTENT),k.emplaceBack(M.x,M.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(k,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const a=this.map.painter.context,f=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(a,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,f){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},f(null)):(a.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Yn={vector:Zt,raster:zt,"raster-dem":class extends zt{constructor(_,a,f,v){super(_,a,f,v),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(_,a){const f=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(C,M){C&&(_.state="errored",a(C)),M&&(_.dem=M,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",a(null))}_.request=p.getImage(this.map._requestManager.transformRequest(f,p.ResourceType.Tile),function(C,M,O,k){if(delete _.request,_.aborted)_.state="unloaded",a(null);else if(C)_.state="errored",a(C);else if(M){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:O,expires:k});const B=p.window.ImageBitmap&&M instanceof p.window.ImageBitmap&&(null==mo&&(mo=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),mo),$=1-(M.width-p.prevPowerOfTwo(M.width))/2;$<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const j=B?M:p.exported.getImageData(M,$),q={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:j,encoding:this.encoding,padding:$};_.actor&&"expired"!==_.state||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",q,v.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(_){const a=_.canonical,f=Math.pow(2,a.z),v=(a.x-1+f)%f,C=0===a.x?_.wrap-1:_.wrap,M=(a.x+1+f)%f,O=a.x+1===f?_.wrap+1:_.wrap,k={};return k[new p.OverscaledTileID(_.overscaledZ,C,a.z,v,a.y).key]={backfilled:!1},k[new p.OverscaledTileID(_.overscaledZ,O,a.z,M,a.y).key]={backfilled:!1},a.y>0&&(k[new p.OverscaledTileID(_.overscaledZ,C,a.z,v,a.y-1).key]={backfilled:!1},k[new p.OverscaledTileID(_.overscaledZ,_.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},k[new p.OverscaledTileID(_.overscaledZ,O,a.z,M,a.y-1).key]={backfilled:!1}),a.y+1<f&&(k[new p.OverscaledTileID(_.overscaledZ,C,a.z,v,a.y+1).key]={backfilled:!1},k[new p.OverscaledTileID(_.overscaledZ,_.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},k[new p.OverscaledTileID(_.overscaledZ,O,a.z,M,a.y+1).key]={backfilled:!1}),k}unloadTile(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded"}},geojson:class extends p.Evented{constructor(_,a,f,v){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(v),this._data=a.data,this._options=p.extend({},a),this._collectResourceTiming=a.collectResourceTiming,void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const C=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(void 0!==a.buffer?a.buffer:128)*C,tolerance:(void 0!==a.tolerance?a.tolerance:.375)*C,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:void 0!==a.clusterMaxZoom?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==a.clusterRadius?a.clusterRadius:50)*C,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},a),this}getClusterChildren(_,a){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},a),this}getClusterLeaves(_,a,f,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:a,offset:f},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const _=p.extend({},this.workerOptions),a=this._data;"string"==typeof a?(_.request=this.map._requestManager.transformRequest(p.exported.resolveURL(a),p.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(f,v)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new p.ErrorEvent(f));else{const C={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(C.resourceTiming=v.resourceTiming[this.id]),this.fire(new p.Event("data",C)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,a){const f=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(f,{type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(v,C)=>(delete _.request,_.unloadVectorData(),_.aborted?a(null):v?a(v):(_.loadVectorData(C,this.map.painter,"reloadTile"===f),a(null))),void 0,"loadTile"===f)}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Nn{constructor(_,a,f,v){super(_,a,f,v),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const a of _.urls)this.urls.push(this.map._requestManager.transformRequest(a,p.ResourceType.Source).url);p.getVideo(this.urls,(a,f)=>{this._loaded=!0,a?this.fire(new p.ErrorEvent(a)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const a=this.video.seekable;_<a.start(0)||_>a.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const _=this.map.painter.context,a=_.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(_,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Nn,canvas:class extends Nn{constructor(_,a,f,v){super(_,a,f,v),a.coordinates?Array.isArray(a.coordinates)&&4===a.coordinates.length&&!a.coordinates.some(C=>!Array.isArray(C)||2!==C.length||C.some(M=>"number"!=typeof M))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${_}`,null,'missing required property "coordinates"'))),a.animate&&"boolean"!=typeof a.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),a.canvas?"string"==typeof a.canvas||a.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${_}`,null,'missing required property "canvas"'))),this.options=a,this.animate=void 0===a.animate||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const a=this.map.painter.context;this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends p.Evented{constructor(_,a,f,v){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=a,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Gt(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this._map=_,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){const{x:a,y:f,z:v}=_.canonical;return this._implementation.hasTile({x:a,y:f,z:v})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,a){const{x:f,y:v,z:C}=_.tileID.canonical,M=new p.window.AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:f,y:v,z:C},{signal:M.signal})).then(function(O){return delete _.request,_.aborted?(_.state="unloaded",a(null)):void 0===O?(_.state="errored",a(null)):null===O?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",a(null)):(k=O)instanceof p.window.ImageData||k instanceof p.window.HTMLCanvasElement||k instanceof p.window.ImageBitmap||k instanceof p.window.HTMLImageElement?(this.loadTileData(_,O),_.state="loaded",void a(null)):(_.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var k}.bind(this)).catch(O=>{20!==O.code&&(_.state="errored",a(O))}),_.request.cancel=()=>M.abort()}loadTileData(_,a){zt.loadTileData(_,a,this._map.painter)}unloadTileData(_){zt.unloadTileData(_,this._map.painter)}unloadTile(_,a){if(this.unloadTileData(_),this._implementation.unloadTile){const{x:f,y:v,z:C}=_.tileID.canonical;this._implementation.unloadTile({x:f,y:v,z:C})}a()}abortTile(_,a){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},jn=function(_,a,f,v){const C=new Yn[a.type](_,a,f,v);if(C.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${C.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],C),C};function Qn(_,a){const f=p.identity([]);return p.scale(f,f,[.5*_.width,.5*-_.height,1]),p.translate(f,f,[1,-1,0]),p.multiply(f,f,_.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(f)}function Jn(_,a,f,v,C,M,O,k=!1){const B=_.tilesIn(v,O,k);B.sort(si);const $=[];for(const q of B)$.push({wrappedTileID:q.tile.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(a,f,_._state,q,C,M,Qn(_.transform,q.tile.tileID),k)});const j=function(q){const ee={},se={};for(const le of q){const ae=le.queryResults,ce=le.wrappedTileID,X=se[ce]=se[ce]||{};for(const oe in ae){const fe=ae[oe],pe=X[oe]=X[oe]||{},Te=ee[oe]=ee[oe]||[];for(const De of fe)pe[De.featureIndex]||(pe[De.featureIndex]=!0,Te.push(De))}}return ee}($);for(const q in j)j[q].forEach(ee=>{const se=ee.feature,le=se.layer;le&&"background"!==le.type&&"sky"!==le.type&&(se.source=le.source,le["source-layer"]&&(se.sourceLayer=le["source-layer"]),se.state=void 0!==se.id?_.getFeatureState(le["source-layer"],se.id):{})});return j}function fr(_,a){const f=_.getRenderableIds().map(M=>_.getTileByID(M)),v=[],C={};for(let M=0;M<f.length;M++){const O=f[M],k=O.tileID.canonical.key;C[k]||(C[k]=!0,O.querySourceFeatures(v,a))}return v}function si(_,a){const f=_.tileID,v=a.tileID;return f.overscaledZ-v.overscaledZ||f.canonical.y-v.canonical.y||f.wrap-v.wrap||f.canonical.x-v.canonical.x}function Xi(){return null!=Va.workerClass?new Va.workerClass:new p.window.Worker(Va.workerUrl)}const Ao="mapboxgl_preloaded_worker_pool";class pr{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<pr.workerCount;)this.workers.push(new Xi);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],0===this.numActive()&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ao]}numActive(){return Object.keys(this.active).length}}let Jr;function ll(){return Jr||(Jr=new pr),Jr}function Rh(_,a){const f={};for(const v in _)"ref"!==v&&(f[v]=_[v]);return p.refProperties.forEach(v=>{v in a&&(f[v]=a[v])}),f}function Es(_){_=_.slice();const a=Object.create(null);for(let f=0;f<_.length;f++)a[_[f].id]=_[f];for(let f=0;f<_.length;f++)"ref"in _[f]&&(_[f]=Rh(_[f],a[_[f].ref]));return _}pr.workerCount=2;const pi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Cs(_,a,f){f.push({command:pi.addSource,args:[_,a[_]]})}function Qr(_,a,f){a.push({command:pi.removeSource,args:[_]}),f[_]=!0}function xi(_,a,f,v){Qr(_,f,v),Cs(_,a,f)}function Ws(_,a,f){let v;for(v in _[f])if(_[f].hasOwnProperty(v)&&"data"!==v&&!ue(_[f][v],a[f][v]))return!1;for(v in a[f])if(a[f].hasOwnProperty(v)&&"data"!==v&&!ue(_[f][v],a[f][v]))return!1;return!0}function go(_,a,f,v,C,M){let O;for(O in a=a||{},_=_||{})_.hasOwnProperty(O)&&(ue(_[O],a[O])||f.push({command:M,args:[v,O,a[O],C]}));for(O in a)a.hasOwnProperty(O)&&!_.hasOwnProperty(O)&&(ue(_[O],a[O])||f.push({command:M,args:[v,O,a[O],C]}))}function _o(_){return _.id}function gc(_,a){return _[a.id]=a,_}class Zo{constructor(a,f){this.reset(a,f)}reset(a,f){this.points=a||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(1===this.points.length)return this.points[0];a=p.clamp(a,0,1);let f=1,v=this._distances[f];const C=a*this.paddedLength+this.padding;for(;v<C&&f<this._distances.length;)v=this._distances[++f];const M=f-1,O=this._distances[M],k=v-O,B=k>0?(C-O)/k:0;return this.points[M].mult(1-B).add(this.points[f].mult(B))}}class Po{constructor(a,f,v){const C=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(a/v),this.yCellCount=Math.ceil(f/v);for(let O=0;O<this.xCellCount*this.yCellCount;O++)C.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=f,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,f,v,C,M){this._forEachCell(f,v,C,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(C),this.bboxes.push(M)}insertCircle(a,f,v,C){this._forEachCell(f-C,v-C,f+C,v+C,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(f),this.circles.push(v),this.circles.push(C)}_insertBoxCell(a,f,v,C,M,O){this.boxCells[M].push(O)}_insertCircleCell(a,f,v,C,M,O){this.circleCells[M].push(O)}_query(a,f,v,C,M,O){if(v<0||a>this.width||C<0||f>this.height)return!M&&[];const k=[];if(a<=0&&f<=0&&this.width<=v&&this.height<=C){if(M)return!0;for(let B=0;B<this.boxKeys.length;B++)k.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const $=this.circles[3*B],j=this.circles[3*B+1],q=this.circles[3*B+2];k.push({key:this.circleKeys[B],x1:$-q,y1:j-q,x2:$+q,y2:j+q})}return O?k.filter(O):k}return this._forEachCell(a,f,v,C,this._queryCell,k,{hitTest:M,seenUids:{box:{},circle:{}}},O),M?k.length>0:k}_queryCircle(a,f,v,C,M){const O=a-v,k=a+v,B=f-v,$=f+v;if(k<0||O>this.width||$<0||B>this.height)return!C&&[];const j=[];return this._forEachCell(O,B,k,$,this._queryCellCircle,j,{hitTest:C,circle:{x:a,y:f,radius:v},seenUids:{box:{},circle:{}}},M),C?j.length>0:j}query(a,f,v,C,M){return this._query(a,f,v,C,!1,M)}hitTest(a,f,v,C,M){return this._query(a,f,v,C,!0,M)}hitTestCircle(a,f,v,C){return this._queryCircle(a,f,v,!0,C)}_queryCell(a,f,v,C,M,O,k,B){const $=k.seenUids,j=this.boxCells[M];if(null!==j){const ee=this.bboxes;for(const se of j)if(!$.box[se]){$.box[se]=!0;const le=4*se;if(a<=ee[le+2]&&f<=ee[le+3]&&v>=ee[le+0]&&C>=ee[le+1]&&(!B||B(this.boxKeys[se]))){if(k.hitTest)return O.push(!0),!0;O.push({key:this.boxKeys[se],x1:ee[le],y1:ee[le+1],x2:ee[le+2],y2:ee[le+3]})}}}const q=this.circleCells[M];if(null!==q){const ee=this.circles;for(const se of q)if(!$.circle[se]){$.circle[se]=!0;const le=3*se;if(this._circleAndRectCollide(ee[le],ee[le+1],ee[le+2],a,f,v,C)&&(!B||B(this.circleKeys[se]))){if(k.hitTest)return O.push(!0),!0;{const ae=ee[le],ce=ee[le+1],X=ee[le+2];O.push({key:this.circleKeys[se],x1:ae-X,y1:ce-X,x2:ae+X,y2:ce+X})}}}}}_queryCellCircle(a,f,v,C,M,O,k,B){const $=k.circle,j=k.seenUids,q=this.boxCells[M];if(null!==q){const se=this.bboxes;for(const le of q)if(!j.box[le]){j.box[le]=!0;const ae=4*le;if(this._circleAndRectCollide($.x,$.y,$.radius,se[ae+0],se[ae+1],se[ae+2],se[ae+3])&&(!B||B(this.boxKeys[le])))return O.push(!0),!0}}const ee=this.circleCells[M];if(null!==ee){const se=this.circles;for(const le of ee)if(!j.circle[le]){j.circle[le]=!0;const ae=3*le;if(this._circlesCollide(se[ae],se[ae+1],se[ae+2],$.x,$.y,$.radius)&&(!B||B(this.circleKeys[le])))return O.push(!0),!0}}}_forEachCell(a,f,v,C,M,O,k,B){const $=this._convertToXCellCoord(a),j=this._convertToYCellCoord(f),q=this._convertToXCellCoord(v),ee=this._convertToYCellCoord(C);for(let se=$;se<=q;se++)for(let le=j;le<=ee;le++)if(M.call(this,a,f,v,C,this.xCellCount*le+se,O,k,B))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,f,v,C,M,O){const k=C-a,B=M-f,$=v+O;return $*$>k*k+B*B}_circleAndRectCollide(a,f,v,C,M,O,k){const B=(O-C)/2,$=Math.abs(a-(C+B));if($>B+v)return!1;const j=(k-M)/2,q=Math.abs(f-(M+j));if(q>j+v)return!1;if($<=B||q<=j)return!0;const ee=$-B,se=q-j;return ee*ee+se*se<=v*v}}const qo={unknown:0,flipRequired:1,flipNotRequired:2},ka=Math.tan(85*Math.PI/180);function lt(_,a,f,v,C,M,O){const k=p.create();if(f)if("globe"===M.name){const B=p.calculateGlobeLabelMatrix(C,a);p.multiply(k,k,B)}else{const B=Ne([],O);k[0]=B[0],k[1]=B[1],k[4]=B[2],k[5]=B[3],v||p.rotateZ(k,k,C.angle)}else p.multiply(k,C.labelPlaneMatrix,_);return k}function Ds(_,a,f,v,C,M,O){const k=lt(_,a,f,v,C,M,O);return"globe"===M.name&&f||(k[2]=k[6]=k[10]=k[14]=0),k}function Ji(_,a,f,v,C,M,O){if(f){if("globe"===M.name){const k=lt(_,a,f,v,C,M,O);return p.invert(k,k),p.multiply(k,_,k),k}{const k=p.clone(_),B=p.identity([]);return B[0]=O[0],B[1]=O[1],B[4]=O[2],B[5]=O[3],p.multiply(k,k,B),v||p.rotateZ(k,k,-C.angle),k}}return C.glCoordMatrix}function mr(_,a,f,v){const C=[_,a,f,1];f?p.transformMat4$1(C,C,v):ai(C,C,v);const M=C[3];return C[0]/=M,C[1]/=M,C[2]/=M,C}function _c(_,a){return Math.min(.5+_/a*.5,1.5)}function Ro(_,a){const f=_[0]/_[3],v=_[1]/_[3];return f>=-a[0]&&f<=a[0]&&v>=-a[1]&&v<=a[1]}function fd(_,a,f,v,C,M,O,k,B,$){const j=f.transform,q=v?_.textSizeData:_.iconSizeData,ee=p.evaluateSizeForZoom(q,f.transform.zoom),se="globe"===j.projection.name,le=[256/f.width*2+1,256/f.height*2+1],ae=v?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ae.clear();let ce=null;se&&(ce=v?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);const X=_.lineVertexArray,oe=v?_.text.placedSymbolArray:_.icon.placedSymbolArray,fe=f.transform.width/f.transform.height;let pe,Te=!1;for(let De=0;De<oe.length;De++){const Me=oe.get(De),{numGlyphs:ze,writingMode:Oe}=Me;if(Oe!==p.WritingMode.vertical||Te||pe===p.WritingMode.horizontal||(Te=!0),pe=Oe,(Me.hidden||Oe===p.WritingMode.vertical)&&!Te){ss(ze,ae);continue}Te=!1;const Xe=new p.Point(Me.tileAnchorX,Me.tileAnchorY);let{x:At,y:Ve,z:ht}=j.projection.projectTilePoint(Xe.x,Xe.y,$.canonical);if(B){const[Rn,sn,bn]=B(Xe);At+=Rn,Ve+=sn,ht+=bn}const tt=[At,Ve,ht,1];if(p.transformMat4$1(tt,tt,a),!Ro(tt,le)){ss(ze,ae);continue}const _t=_c(f.transform.cameraToCenterDistance,tt[3]),He=p.evaluateSizeForFeature(q,ee,Me),ct=O?He/_t:He*_t,Lt=mr(At,Ve,ht,C);if(Lt[3]<=0){ss(ze,ae);continue}let ft={};const Ct=O?null:B,vn=Jt(Me,ct,!1,k,a,C,M,_.glyphOffsetArray,X,ae,ce,Lt,Xe,ft,fe,Ct,j.projection,$,O);Te=vn.useVertical,Ct&&vn.needsFlipping&&(ft={}),(vn.notEnoughRoom||Te||vn.needsFlipping&&Jt(Me,ct,!0,k,a,C,M,_.glyphOffsetArray,X,ae,ce,Lt,Xe,ft,fe,Ct,j.projection,$,O).notEnoughRoom)&&ss(ze,ae)}v?(_.text.dynamicLayoutVertexBuffer.updateData(ae),ce&&_.text.globeExtVertexBuffer.updateData(ce)):(_.icon.dynamicLayoutVertexBuffer.updateData(ae),ce&&_.icon.globeExtVertexBuffer.updateData(ce))}function La(_,a,f,v,C,M,O,k,B,$,j,q,ee,se,le,ae){const{lineStartIndex:ce,glyphStartIndex:X,segment:oe}=k,fe=X+k.numGlyphs,pe=ce+k.lineLength,Te=a.getoffsetX(X),De=a.getoffsetX(fe-1),Me=Oo(_*Te,f,v,C,M,O,oe,ce,pe,B,$,j,q,ee,!0,se,le,ae);if(!Me)return null;const ze=Oo(_*De,f,v,C,M,O,oe,ce,pe,B,$,j,q,ee,!0,se,le,ae);return ze?{first:Me,last:ze}:null}function zl(_,a,f,v){return _===p.WritingMode.horizontal&&Math.abs(v)>Math.abs(f)?{useVertical:!0}:_===p.WritingMode.vertical?v>0?{needsFlipping:!0}:null:a!==qo.unknown&&(0===(C=f)||Math.abs(v/C)>ka)?a===qo.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null;var C}function Jt(_,a,f,v,C,M,O,k,B,$,j,q,ee,se,le,ae,ce,X,oe){const fe=a/24,pe=_.lineOffsetX*fe,Te=_.lineOffsetY*fe,{lineStartIndex:De,glyphStartIndex:Me,numGlyphs:ze,segment:Oe,writingMode:Xe,flipState:At}=_,Ve=De+_.lineLength,ht=tt=>{if(j){const[Lt,ft,Ct]=tt.up,vn=$.length;p.updateGlobeVertexNormal(j,vn+0,Lt,ft,Ct),p.updateGlobeVertexNormal(j,vn+1,Lt,ft,Ct),p.updateGlobeVertexNormal(j,vn+2,Lt,ft,Ct),p.updateGlobeVertexNormal(j,vn+3,Lt,ft,Ct)}const[_t,He,ct]=tt.point;p.addDynamicAttributes($,_t,He,ct,tt.angle)};if(ze>1){const tt=La(fe,k,pe,Te,f,q,ee,_,B,M,se,ae,!1,ce,X,oe);if(!tt)return{notEnoughRoom:!0};if(v&&!f){let[_t,He,ct]=tt.first.point,[Lt,ft,Ct]=tt.last.point;[_t,He]=mr(_t,He,ct,O),[Lt,ft]=mr(Lt,ft,Ct,O);const vn=zl(Xe,At,(Lt-_t)*le,ft-He);if(_.flipState=vn&&vn.needsFlipping?qo.flipRequired:qo.flipNotRequired,vn)return vn}ht(tt.first);for(let _t=Me+1;_t<Me+ze-1;_t++){const He=Oo(fe*k.getoffsetX(_t),pe,Te,f,q,ee,Oe,De,Ve,B,M,se,ae,!1,!1,ce,X,oe);if(!He)return $.length-=4*(_t-Me),{notEnoughRoom:!0};ht(He)}ht(tt.last)}else{if(v&&!f){const _t=mr(ee.x,ee.y,0,C),He=De+Oe+1,ct=new p.Point(B.getx(He),B.gety(He)),Lt=mr(ct.x,ct.y,0,C),ft=Lt[3]>0?Lt:ei(ee,ct,_t,1,C,void 0,ce,X.canonical),Ct=zl(Xe,At,(ft[0]-_t[0])*le,ft[1]-_t[1]);if(_.flipState=Ct&&Ct.needsFlipping?qo.flipRequired:qo.flipNotRequired,Ct)return Ct}const tt=Oo(fe*k.getoffsetX(Me),pe,Te,f,q,ee,Oe,De,Ve,B,M,se,ae,!1,!1,ce,X,oe);if(!tt)return{notEnoughRoom:!0};ht(tt)}return{}}function Ln(_,a,f,v,C){const{x:M,y:O,z:k}=v.projectTilePoint(_.x,_.y,a);if(!C)return mr(M,O,k,f);const[B,$,j]=C(_);return mr(M+B,O+$,k+j,f)}function ei(_,a,f,v,C,M,O,k){const B=Ln(_.sub(a)._unit()._add(_),k,C,O,M);return p.sub(B,f,B),p.normalize(B,B),p.scaleAndAdd(B,f,B,v)}function Oo(_,a,f,v,C,M,O,k,B,$,j,q,ee,se,le,ae,ce,X){const oe=v?_-a:_+a;let fe=oe>0?1:-1,pe=0;v&&(fe*=-1,pe=Math.PI),fe<0&&(pe+=Math.PI);let Te=k+O+(fe>0?0:1)|0,De=C,Me=C,ze=0,Oe=0;const Xe=Math.abs(oe),At=[],Ve=[];let ht=M,tt=ht;const _t=()=>ei(tt,ht,Me,Xe-ze+1,j,ee,ae,ce.canonical);for(;ze+Oe<=Xe;){if(Te+=fe,Te<k||Te>=B)return null;if(Me=De,tt=ht,At.push(Me),se&&Ve.push(tt),ht=new p.Point($.getx(Te),$.gety(Te)),De=q[Te],!De){const bn=Ln(ht,ce.canonical,j,ae,ee);De=bn[3]>0?q[Te]=bn:_t()}ze+=Oe,Oe=p.distance(Me,De)}le&&ee&&(q[Te]&&(De=_t(),Oe=p.distance(Me,De)),q[Te]=De);const He=(Xe-ze)/Oe,ct=ht.sub(tt)._mult(He)._add(tt),Lt=p.sub([],De,Me),ft=p.scaleAndAdd([],Me,Lt,He);let Ct=[0,0,1],vn=Lt[0],Rn=Lt[1];if(X&&(Ct=ae.upVector(ce.canonical,ct.x,ct.y),0!==Ct[0]||0!==Ct[1]||1!==Ct[2])){const bn=[Ct[2],0,-Ct[0]],Kn=p.cross([],Ct,bn);p.normalize(bn,bn),p.normalize(Kn,Kn),vn=p.dot(Lt,bn),Rn=p.dot(Lt,Kn)}if(f){const bn=p.cross([],Ct,Lt);p.normalize(bn,bn),p.scaleAndAdd(ft,ft,bn,f*fe)}const sn=pe+Math.atan2(Rn,vn);return At.push(ft),se&&Ve.push(ct),{point:ft,angle:sn,path:At,tilePath:Ve,up:Ct}}function ss(_,a){const f=a.length,v=f+4*_;a.resize(v),a.float32.fill(-1/0,4*f,4*v)}function ai(_,a,f){const v=a[0],C=a[1];return _[0]=f[0]*v+f[4]*C+f[12],_[1]=f[1]*v+f[5]*C+f[13],_[3]=f[3]*v+f[7]*C+f[15],_}const so=100;class cl{constructor(a,f,v=new Po(a.width+200,a.height+200,25),C=new Po(a.width+200,a.height+200,25)){this.transform=a,this.grid=v,this.ignoredGrid=C,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+so,this.screenBottomBoundary=a.height+so,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=f}placeCollisionBox(a,f,v,C,M,O,k,B){let $=v.projectedAnchorX,j=v.projectedAnchorY,q=v.projectedAnchorZ;const ee=v.elevation,se=v.tileID,le=a.getProjection();if(ee&&se){const[De,Me,ze]=le.upVector(se.canonical,v.tileAnchorX,v.tileAnchorY),Oe=le.upVectorScale(se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;$+=De*ee*Oe,j+=Me*ee*Oe,q+=ze*ee*Oe}const ae=this.projectAndGetPerspectiveRatio(k,$,j,q,v.tileID,"globe"===le.name||!!ee||this.transform.pitch>0,le),ce=O*ae.perspectiveRatio,X=(v.x1*f+C.x-v.padding)*ce+ae.point.x,oe=(v.y1*f+C.y-v.padding)*ce+ae.point.y,fe=(v.x2*f+C.x+v.padding)*ce+ae.point.x,pe=(v.y2*f+C.y+v.padding)*ce+ae.point.y,Te=ae.perspectiveRatio<=.55||ae.occluded;return!this.isInsideGrid(X,oe,fe,pe)||!M&&this.grid.hitTest(X,oe,fe,pe,B)||Te?{box:[],offscreen:!1,occluded:ae.occluded}:{box:[X,oe,fe,pe],offscreen:this.isOffscreen(X,oe,fe,pe),occluded:!1}}placeCollisionCircles(a,f,v,C,M,O,k,B,$,j,q,ee,se,le,ae){const ce=[],X=this.transform.elevation,oe=a.getProjection(),fe=X?X.getAtTileOffsetFunc(ae,this.transform.center.lat,this.transform.worldSize,oe):null,pe=new p.Point(v.tileAnchorX,v.tileAnchorY);let{x:Te,y:De,z:Me}=oe.projectTilePoint(pe.x,pe.y,ae.canonical);if(fe){const[ct,Lt,ft]=fe(pe);Te+=ct,De+=Lt,Me+=ft}const ze="globe"===oe.name,Oe=this.projectAndGetPerspectiveRatio(k,Te,De,Me,ae,ze||!!X||this.transform.pitch>0,oe),{perspectiveRatio:Xe}=Oe,At=(q?O/Xe:O*Xe)/p.ONE_EM,Ve=mr(Te,De,Me,B),ht=Oe.signedDistanceFromCamera>0?La(At,M,v.lineOffsetX*At,v.lineOffsetY*At,!1,Ve,pe,v,C,B,{},X&&!q?fe:null,q&&!!X,oe,ae,q):null;let tt=!1,_t=!1,He=!0;if(ht&&!Oe.occluded){const ct=.5*se*Xe+le,Lt=new p.Point(-100,-100),ft=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),Ct=new Zo,{first:vn,last:Rn}=ht,sn=vn.path.length;let bn=[];for(let an=sn-1;an>=1;an--)bn.push(vn.path[an]);for(let an=1;an<Rn.path.length;an++)bn.push(Rn.path[an]);const Kn=2.5*ct;$&&(bn=bn.map(([an,Ai,ii],Gi)=>(fe&&!ze&&(ii=fe(Gi<sn-1?vn.tilePath[sn-1-Gi]:Rn.tilePath[Gi-sn+2])[2]),mr(an,Ai,ii,$))),bn.some(an=>an[3]<=0)&&(bn=[]));let Mn=[];if(bn.length>0){let an=1/0,Ai=-1/0,ii=1/0,Gi=-1/0;for(const ki of bn)an=Math.min(an,ki[0]),ii=Math.min(ii,ki[1]),Ai=Math.max(Ai,ki[0]),Gi=Math.max(Gi,ki[1]);Ai>=Lt.x&&an<=ft.x&&Gi>=Lt.y&&ii<=ft.y&&(Mn=[bn.map(ki=>new p.Point(ki[0],ki[1]))],(an<Lt.x||Ai>ft.x||ii<Lt.y||Gi>ft.y)&&(Mn=p.clipLine(Mn,Lt.x,Lt.y,ft.x,ft.y)))}for(const an of Mn){Ct.reset(an,.25*ct);let Ai=0;Ai=Ct.length<=.5*ct?1:Math.ceil(Ct.paddedLength/Kn)+1;for(let ii=0;ii<Ai;ii++){const Gi=ii/Math.max(Ai-1,1),ki=Ct.lerp(Gi),Sr=ki.x+so,$r=ki.y+so;ce.push(Sr,$r,ct,0);const zn=Sr-ct,Co=$r-ct,Li=Sr+ct,gi=$r+ct;if(He=He&&this.isOffscreen(zn,Co,Li,gi),_t=_t||this.isInsideGrid(zn,Co,Li,gi),!f&&this.grid.hitTestCircle(Sr,$r,ct,ee)&&(tt=!0,!j))return{circles:[],offscreen:!1,collisionDetected:tt,occluded:!1}}}}return{circles:!j&&tt||!_t?[]:ce,offscreen:He,collisionDetected:tt,occluded:Oe.occluded}}queryRenderedSymbols(a){if(0===a.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const f=[];let v=1/0,C=1/0,M=-1/0,O=-1/0;for(const j of a){const q=new p.Point(j.x+so,j.y+so);v=Math.min(v,q.x),C=Math.min(C,q.y),M=Math.max(M,q.x),O=Math.max(O,q.y),f.push(q)}const k=this.grid.query(v,C,M,O).concat(this.ignoredGrid.query(v,C,M,O)),B={},$={};for(const j of k){const q=j.key;if(void 0===B[q.bucketInstanceId]&&(B[q.bucketInstanceId]={}),B[q.bucketInstanceId][q.featureIndex])continue;const ee=[new p.Point(j.x1,j.y1),new p.Point(j.x2,j.y1),new p.Point(j.x2,j.y2),new p.Point(j.x1,j.y2)];p.polygonIntersectsPolygon(f,ee)&&(B[q.bucketInstanceId][q.featureIndex]=!0,void 0===$[q.bucketInstanceId]&&($[q.bucketInstanceId]=[]),$[q.bucketInstanceId].push(q.featureIndex))}return $}insertCollisionBox(a,f,v,C,M){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:C,collisionGroupID:M},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,f,v,C,M){const O=f?this.ignoredGrid:this.grid,k={bucketInstanceId:v,featureIndex:C,collisionGroupID:M};for(let B=0;B<a.length;B+=4)O.insertCircle(k,a[B],a[B+1],a[B+2])}projectAndGetPerspectiveRatio(a,f,v,C,M,O,k){const B=[f,v,C,1];let $=!1;C||this.transform.pitch>0?(p.transformMat4$1(B,B,a),this.fogState&&M&&"globe"!==k.name&&($=function(ee,se,le,ae,ce,X){const oe=X.calculateFogTileMatrix(ce),fe=[se,le,ae];return p.transformMat4(fe,fe,oe),ir(ee,fe,X.pitch,X._fov)}(this.fogState,f,v,C,M.toUnwrapped(),this.transform)>.9)):ai(B,B,a);const j=B[3];return{point:new p.Point((B[0]/j+1)/2*this.transform.width+so,(-B[1]/j+1)/2*this.transform.height+so),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/j*.5,1.5),signedDistanceFromCamera:j,occluded:O&&B[2]>j||$}}isOffscreen(a,f,v,C){return v<so||a>=this.screenRightBoundary||C<so||f>this.screenBottomBoundary}isInsideGrid(a,f,v,C){return v>=0&&a<this.gridRightBoundary&&C>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const a=p.identity([]);return p.translate(a,a,[-100,-100,0]),a}}function la(_,a,f){const v=a.createTileMatrix(_,_.worldSize,f.toUnwrapped());return p.multiply(new Float32Array(16),_.projMatrix,v)}function as(_,a,f){if(a.projection.name===f.projection.name)return _.projMatrix;const v=f.clone();return v.setProjection(a.projection),la(v,a.getProjection(),_)}function Qi(_,a,f){return a.name===f.projection.name?_.projMatrix:la(f,a,_)}class Yo{constructor(a,f,v,C){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?f:-f))):C&&v?1:0,this.placed=v}isHidden(){return 0===this.opacity&&!this.placed}}class _e{constructor(a,f,v,C,M,O=!1){this.text=new Yo(a?a.text:null,f,v,M),this.icon=new Yo(a?a.icon:null,f,C,M),this.clipped=O}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class st{constructor(a,f,v,C=!1){this.text=a,this.icon=f,this.skipFade=v,this.clipped=C}}class Et{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class qe{constructor(a,f,v,C,M){this.bucketInstanceId=a,this.featureIndex=f,this.sourceLayerIndex=v,this.bucketIndex=C,this.tileID=M}}class Vt{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const f=++this.maxGroupID;this.collisionGroups[a]={ID:f,predicate:v=>v.collisionGroupID===f}}return this.collisionGroups[a]}}function en(_,a,f,v,C){const{horizontalAlign:M,verticalAlign:O}=p.getAnchorAlignment(_),k=-(M-.5)*a,B=-(O-.5)*f,$=p.evaluateVariableOffset(_,v);return new p.Point(k+$[0]*C,B+$[1]*C)}function Gn(_,a,f,v,C){const M=new p.Point(_,a);return f&&M._rotate(v?C:-C),M}class or{constructor(a,f,v,C,M){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new cl(this.transform,M),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Vt(v),this.collisionCircleArrays={},this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,f,v,C){const M=v.getBucket(f),O=v.latestFeatureIndex;if(!M||!O||f.id!==M.layerIds[0])return;const k=M.layers[0].layout,B=v.collisionBoxArray,$=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),j=v.tileSize/p.EXTENT,q=v.tileID.toUnwrapped();this.transform.setProjection(M.projection);const ee=(se=v.tileID,le=M.getProjection(),ae=this.transform,le.name===this.projection?ae.calculateProjMatrix(se.toUnwrapped()):la(ae,le,se));var se,le,ae;const ce="map"===k.get("text-pitch-alignment"),X="map"===k.get("text-rotation-alignment");f.compileFilter();const oe=f.dynamicFilter(),fe=f.dynamicFilterNeedsFeature(),pe=this.transform.calculatePixelsToTileUnitsMatrix(v),Te=Ds(ee,v.tileID.canonical,ce,X,this.transform,M.getProjection(),pe);let De=null;if(ce){const Oe=Ji(ee,v.tileID.canonical,ce,X,this.transform,M.getProjection(),pe);De=p.multiply([],this.transform.labelPlaneMatrix,Oe)}let Me=null;oe&&v.latestFeatureIndex&&(Me={unwrappedTileID:q,dynamicFilter:oe,dynamicFilterNeedsFeature:fe,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[M.bucketInstanceId]=new qe(M.bucketInstanceId,O,M.sourceLayerIndex,M.index,v.tileID);const ze={bucket:M,layout:k,posMatrix:ee,textLabelPlaneMatrix:Te,labelToScreenMatrix:De,clippingData:Me,scale:$,textPixelRatio:j,holdingForFade:v.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(M.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(M.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(M.sourceID)};if(C)for(const Oe of M.sortKeyRanges){const{sortKey:Xe,symbolInstanceStart:At,symbolInstanceEnd:Ve}=Oe;a.push({sortKey:Xe,symbolInstanceStart:At,symbolInstanceEnd:Ve,parameters:ze})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:M.symbolInstances.length,parameters:ze})}attemptAnchorPlacement(a,f,v,C,M,O,k,B,$,j,q,ee,se,le,ae,ce,X,oe){const{textOffset0:fe,textOffset1:pe,crossTileID:Te}=ee,De=[fe,pe],Me=en(a,v,C,De,M),ze=this.collisionIndex.placeCollisionBox(le,M,f,Gn(Me.x,Me.y,O,k,this.transform.angle),q,B,$,j.predicate);if(ce){const Oe=le.getSymbolInstanceIconSize(oe,this.transform.zoom,ee.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(le,Oe,ce,Gn(Me.x,Me.y,O,k,this.transform.angle),q,B,$,j.predicate).box.length)return}if(ze.box.length>0){let Oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Te]&&this.prevPlacement.placements[Te]&&this.prevPlacement.placements[Te].text&&(Oe=this.prevPlacement.variableOffsets[Te].anchor),this.variableOffsets[Te]={textOffset:De,width:v,height:C,anchor:a,textScale:M,prevAnchor:Oe},this.markUsedJustification(le,a,ee,ae),le.allowVerticalPlacement&&(this.markUsedOrientation(le,ae,ee),this.placedOrientations[Te]=ae),{shift:Me,placedGlyphBoxes:ze}}}placeLayerBucketPart(a,f,v,C){const{bucket:M,layout:O,posMatrix:k,textLabelPlaneMatrix:B,labelToScreenMatrix:$,clippingData:j,textPixelRatio:q,holdingForFade:ee,collisionBoxArray:se,partiallyEvaluatedTextSize:le,partiallyEvaluatedIconSize:ae,collisionGroup:ce}=a.parameters,X=O.get("text-optional"),oe=O.get("icon-optional"),fe=O.get("text-allow-overlap"),pe=O.get("icon-allow-overlap"),Te="map"===O.get("text-rotation-alignment"),De="map"===O.get("text-pitch-alignment"),Me="none"!==O.get("icon-text-fit"),ze="viewport-y"===O.get("symbol-z-order");this.transform.setProjection(M.projection);let Oe=fe&&(pe||!M.hasIconData()||oe),Xe=pe&&(fe||!M.hasTextData()||X);!M.collisionArrays&&se&&M.deserializeCollisionBoxes(se),v&&C&&M.updateCollisionDebugBuffers(this.transform.zoom,se);const At=(Ve,ht,tt)=>{const{crossTileID:_t,numVerticalGlyphVertices:He}=Ve;if(j){const Li={zoom:this.transform.zoom,pitch:this.transform.pitch};let gi=null;if(j.dynamicFilterNeedsFeature){const _i=this.retainedQueryData[M.bucketInstanceId];gi=j.featureIndex.loadFeature({featureIndex:Ve.featureIndex,bucketIndex:_i.bucketIndex,sourceLayerIndex:_i.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,j.dynamicFilter)(Li,gi,this.retainedQueryData[M.bucketInstanceId].tileID.canonical,new p.Point(Ve.tileAnchorX,Ve.tileAnchorY),this.transform.calculateDistanceTileData(j.unwrappedTileID)))return this.placements[_t]=new st(!1,!1,!1,!0),void f.add(_t)}if(f.has(_t))return;if(ee)return void(this.placements[_t]=new st(!1,!1,!1));let ct=!1,Lt=!1,ft=!0,Ct=!1,vn=!1,Rn=null,sn={box:null,offscreen:null,occluded:null},bn={box:null,offscreen:null,occluded:null},Kn=null,Mn=null,an=null,Ai=0,ii=0,Gi=0;tt.textFeatureIndex?Ai=tt.textFeatureIndex:Ve.useRuntimeCollisionCircles&&(Ai=Ve.featureIndex),tt.verticalTextFeatureIndex&&(ii=tt.verticalTextFeatureIndex);const ki=Li=>{Li.tileID=this.retainedQueryData[M.bucketInstanceId].tileID;const gi=this.transform.elevation;(gi||Li.elevation)&&(Li.elevation=gi?gi.getAtTileOffset(Li.tileID,Li.tileAnchorX,Li.tileAnchorY):0)},Sr=tt.textBox;if(Sr){ki(Sr);const Li=_i=>{let Ir=p.WritingMode.horizontal;if(M.allowVerticalPlacement&&!_i&&this.prevPlacement){const lr=this.prevPlacement.placedOrientations[_t];lr&&(this.placedOrientations[_t]=lr,Ir=lr,this.markUsedOrientation(M,Ir,Ve))}return Ir},gi=(_i,Ir)=>{if(M.allowVerticalPlacement&&He>0&&tt.verticalTextBox){for(const lr of M.writingModes)if(lr===p.WritingMode.vertical?(sn=Ir(),bn=sn):sn=_i(),sn&&sn.box&&sn.box.length)break}else sn=_i()};if(O.get("text-variable-anchor")){let _i=O.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[_t]){const Pi=this.prevPlacement.variableOffsets[_t];_i.indexOf(Pi.anchor)>0&&(_i=_i.filter(Qo=>Qo!==Pi.anchor),_i.unshift(Pi.anchor))}const Ir=(Pi,Qo,Xs)=>{const Oc=M.getSymbolInstanceTextSize(le,Ve,this.transform.zoom,ht),Su=(Pi.x2-Pi.x1)*Oc+2*Pi.padding,Ua=(Pi.y2-Pi.y1)*Oc+2*Pi.padding,Zl=Me&&!pe?Qo:null;Zl&&ki(Zl);let ql={box:[],offscreen:!1,occluded:!1};const Wh=fe?2*_i.length:_i.length;for(let Ks=0;Ks<Wh;++Ks){const kd=this.attemptAnchorPlacement(_i[Ks%_i.length],Pi,Su,Ua,Oc,Te,De,q,k,ce,Ks>=_i.length,Ve,ht,M,Xs,Zl,le,ae);if(kd&&(ql=kd.placedGlyphBoxes,ql&&ql.box&&ql.box.length)){ct=!0,Rn=kd.shift;break}}return ql};gi(()=>Ir(Sr,tt.iconBox,p.WritingMode.horizontal),()=>{const Pi=tt.verticalTextBox;return Pi&&ki(Pi),M.allowVerticalPlacement&&!(sn&&sn.box&&sn.box.length)&&He>0&&Pi?Ir(Pi,tt.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),sn&&(ct=sn.box,ft=sn.offscreen,Ct=sn.occluded);const lr=Li(!(!sn||!sn.box));if(!ct&&this.prevPlacement){const Pi=this.prevPlacement.variableOffsets[_t];Pi&&(this.variableOffsets[_t]=Pi,this.markUsedJustification(M,Pi.anchor,Ve,lr))}}else{const _i=(Ir,lr)=>{const Pi=M.getSymbolInstanceTextSize(le,Ve,this.transform.zoom,ht),Qo=this.collisionIndex.placeCollisionBox(M,Pi,Ir,new p.Point(0,0),fe,q,k,ce.predicate);return Qo&&Qo.box&&Qo.box.length&&(this.markUsedOrientation(M,lr,Ve),this.placedOrientations[_t]=lr),Qo};gi(()=>_i(Sr,p.WritingMode.horizontal),()=>{const Ir=tt.verticalTextBox;return M.allowVerticalPlacement&&He>0&&Ir?(ki(Ir),_i(Ir,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Li(!!(sn&&sn.box&&sn.box.length))}}if(Kn=sn,ct=Kn&&Kn.box&&Kn.box.length>0,ft=Kn&&Kn.offscreen,Ct=Kn&&Kn.occluded,Ve.useRuntimeCollisionCircles){const Li=M.text.placedSymbolArray.get(Ve.centerJustifiedTextSymbolIndex>=0?Ve.centerJustifiedTextSymbolIndex:Ve.verticalPlacedTextSymbolIndex),gi=p.evaluateSizeForFeature(M.textSizeData,le,Li),_i=O.get("text-padding");Mn=this.collisionIndex.placeCollisionCircles(M,fe,Li,M.lineVertexArray,M.glyphOffsetArray,gi,k,B,$,v,De,ce.predicate,Ve.collisionCircleDiameter*gi/p.ONE_EM,_i,this.retainedQueryData[M.bucketInstanceId].tileID),ct=fe||Mn.circles.length>0&&!Mn.collisionDetected,ft=ft&&Mn.offscreen,Ct=Mn.occluded}if(tt.iconFeatureIndex&&(Gi=tt.iconFeatureIndex),tt.iconBox){const Li=gi=>{ki(gi);const _i=Me&&Rn?Gn(Rn.x,Rn.y,Te,De,this.transform.angle):new p.Point(0,0),Ir=M.getSymbolInstanceIconSize(ae,this.transform.zoom,Ve.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(M,Ir,gi,_i,pe,q,k,ce.predicate)};bn&&bn.box&&bn.box.length&&tt.verticalIconBox?(an=Li(tt.verticalIconBox),Lt=an.box.length>0):(an=Li(tt.iconBox),Lt=an.box.length>0),ft=ft&&an.offscreen,vn=an.occluded}const $r=X||0===Ve.numHorizontalGlyphVertices&&0===He,zn=oe||0===Ve.numIconVertices;if($r||zn?zn?$r||(Lt=Lt&&ct):ct=Lt&&ct:Lt=ct=Lt&&ct,ct&&Kn&&Kn.box&&this.collisionIndex.insertCollisionBox(Kn.box,O.get("text-ignore-placement"),M.bucketInstanceId,bn&&bn.box&&ii?ii:Ai,ce.ID),Lt&&an&&this.collisionIndex.insertCollisionBox(an.box,O.get("icon-ignore-placement"),M.bucketInstanceId,Gi,ce.ID),Mn&&(ct&&this.collisionIndex.insertCollisionCircles(Mn.circles,O.get("text-ignore-placement"),M.bucketInstanceId,Ai,ce.ID),v)){const Li=M.bucketInstanceId;let gi=this.collisionCircleArrays[Li];void 0===gi&&(gi=this.collisionCircleArrays[Li]=new Et);for(let _i=0;_i<Mn.circles.length;_i+=4)gi.circles.push(Mn.circles[_i+0]),gi.circles.push(Mn.circles[_i+1]),gi.circles.push(Mn.circles[_i+2]),gi.circles.push(Mn.collisionDetected?1:0)}const Co="globe"!==M.projection.name;Oe=Oe&&(Co||!Ct),Xe=Xe&&(Co||!vn),this.placements[_t]=new st(ct||Oe,Lt||Xe,ft||M.justReloaded),f.add(_t)};if(ze){const Ve=M.getSortedSymbolIndexes(this.transform.angle);for(let ht=Ve.length-1;ht>=0;--ht){const tt=Ve[ht];At(M.symbolInstances.get(tt),tt,M.collisionArrays[tt])}}else for(let Ve=a.symbolInstanceStart;Ve<a.symbolInstanceEnd;Ve++)At(M.symbolInstances.get(Ve),Ve,M.collisionArrays[Ve]);if(v&&M.bucketInstanceId in this.collisionCircleArrays){const Ve=this.collisionCircleArrays[M.bucketInstanceId];p.invert(Ve.invProjMatrix,k),Ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1}markUsedJustification(a,f,v,C){const{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:B,crossTileID:$}=v,j=p.getAnchorJustification(f),q=C===p.WritingMode.vertical?B:"left"===j?M:"center"===j?O:"right"===j?k:-1;M>=0&&(a.text.placedSymbolArray.get(M).crossTileID=q>=0&&M!==q?0:$),O>=0&&(a.text.placedSymbolArray.get(O).crossTileID=q>=0&&O!==q?0:$),k>=0&&(a.text.placedSymbolArray.get(k).crossTileID=q>=0&&k!==q?0:$),B>=0&&(a.text.placedSymbolArray.get(B).crossTileID=q>=0&&B!==q?0:$)}markUsedOrientation(a,f,v){const C=f===p.WritingMode.horizontal||f===p.WritingMode.horizontalOnly?f:0,M=f===p.WritingMode.vertical?f:0,{leftJustifiedTextSymbolIndex:O,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:$}=v,j=a.text.placedSymbolArray;O>=0&&(j.get(O).placedOrientation=C),k>=0&&(j.get(k).placedOrientation=C),B>=0&&(j.get(B).placedOrientation=C),$>=0&&(j.get($).placedOrientation=M)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let v=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const C=f?f.symbolFadeChange(a):1,M=f?f.opacities:{},O=f?f.variableOffsets:{},k=f?f.placedOrientations:{};for(const B in this.placements){const $=this.placements[B],j=M[B];j?(this.opacities[B]=new _e(j,C,$.text,$.icon,null,$.clipped),v=v||$.text!==j.text.placed||$.icon!==j.icon.placed):(this.opacities[B]=new _e(null,C,$.text,$.icon,$.skipFade,$.clipped),v=v||$.text||$.icon)}for(const B in M){const $=M[B];if(!this.opacities[B]){const j=new _e($,C,!1,!1);j.isHidden()||(this.opacities[B]=j,v=v||$.text.placed||$.icon.placed)}}for(const B in O)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=O[B]);for(const B in k)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=k[B]);v?this.lastPlacementChangeTime=a:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:a)}updateLayerOpacities(a,f){const v=new Set;for(const C of f){const M=C.getBucket(a);M&&C.latestFeatureIndex&&a.id===M.layerIds[0]&&this.updateBucketOpacities(M,v,C.collisionBoxArray)}}updateBucketOpacities(a,f,v){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const C=a.layers[0].layout,M=!!a.layers[0].dynamicFilter(),O=new _e(null,0,!1,!1,!0),k=C.get("text-allow-overlap"),B=C.get("icon-allow-overlap"),$=C.get("text-variable-anchor"),j="map"===C.get("text-rotation-alignment"),q="map"===C.get("text-pitch-alignment"),ee="none"!==C.get("icon-text-fit"),se=new _e(null,0,k&&(B||!a.hasIconData()||C.get("icon-optional")),B&&(k||!a.hasTextData()||C.get("text-optional")),!0);!a.collisionArrays&&v&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(v);const le=(ce,X,oe)=>{for(let fe=0;fe<X/4;fe++)ce.opacityVertexArray.emplaceBack(oe)};let ae=0;for(let ce=0;ce<a.symbolInstances.length;ce++){const X=a.symbolInstances.get(ce),{numHorizontalGlyphVertices:oe,numVerticalGlyphVertices:fe,crossTileID:pe,numIconVertices:Te}=X,De=f.has(pe);let Me=this.opacities[pe];De?Me=O:Me||(Me=se,this.opacities[pe]=Me),f.add(pe);const ze=oe>0||fe>0,Oe=Te>0,Xe=this.placedOrientations[pe],At=Xe===p.WritingMode.vertical,Ve=Xe===p.WritingMode.horizontal||Xe===p.WritingMode.horizontalOnly;if(!ze&&!Oe||Me.isHidden()||ae++,ze){const ht=ul(Me.text);le(a.text,oe,At?xr:ht),le(a.text,fe,Ve?xr:ht);const tt=Me.text.isHidden(),{leftJustifiedTextSymbolIndex:_t,centerJustifiedTextSymbolIndex:He,rightJustifiedTextSymbolIndex:ct,verticalPlacedTextSymbolIndex:Lt}=X,ft=a.text.placedSymbolArray,Ct=tt||At?1:0;_t>=0&&(ft.get(_t).hidden=Ct),He>=0&&(ft.get(He).hidden=Ct),ct>=0&&(ft.get(ct).hidden=Ct),Lt>=0&&(ft.get(Lt).hidden=tt||Ve?1:0);const vn=this.variableOffsets[pe];vn&&this.markUsedJustification(a,vn.anchor,X,Xe);const Rn=this.placedOrientations[pe];Rn&&(this.markUsedJustification(a,"left",X,Rn),this.markUsedOrientation(a,Rn,X))}if(Oe){const ht=ul(Me.icon),{placedIconSymbolIndex:tt,verticalPlacedIconSymbolIndex:_t}=X,He=a.icon.placedSymbolArray,ct=Me.icon.isHidden()?1:0;tt>=0&&(le(a.icon,Te,At?xr:ht),He.get(tt).hidden=ct),_t>=0&&(le(a.icon,X.numVerticalIconVertices,Ve?xr:ht),He.get(_t).hidden=ct)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const ht=a.collisionArrays[ce];if(ht){let tt=new p.Point(0,0),_t=!0;if(ht.textBox||ht.verticalTextBox){if($){const ct=this.variableOffsets[pe];ct?(tt=en(ct.anchor,ct.width,ct.height,ct.textOffset,ct.textScale),j&&tt._rotate(q?this.transform.angle:-this.transform.angle)):_t=!1}M&&(_t=!Me.clipped),ht.textBox&&Zi(a.textCollisionBox.collisionVertexArray,Me.text.placed,!_t||At,tt.x,tt.y),ht.verticalTextBox&&Zi(a.textCollisionBox.collisionVertexArray,Me.text.placed,!_t||Ve,tt.x,tt.y)}const He=_t&&!(Ve||!ht.verticalIconBox);ht.iconBox&&Zi(a.iconCollisionBox.collisionVertexArray,Me.icon.placed,He,ee?tt.x:0,ee?tt.y:0),ht.verticalIconBox&&Zi(a.iconCollisionBox.collisionVertexArray,Me.icon.placed,!He,ee?tt.x:0,ee?tt.y:0)}}}if(a.fullyClipped=0===ae,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const ce=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=ce.invProjMatrix,a.placementViewportMatrix=ce.viewportMatrix,a.collisionCircleArray=ce.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return 0===this.fadeDuration?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,f){const v=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*v>a}setStale(){this.stale=!0}}function Zi(_,a,f,v,C){_.emplaceBack(a?1:0,f?1:0,v||0,C||0),_.emplaceBack(a?1:0,f?1:0,v||0,C||0),_.emplaceBack(a?1:0,f?1:0,v||0,C||0),_.emplaceBack(a?1:0,f?1:0,v||0,C||0)}const Cn=Math.pow(2,25),xn=Math.pow(2,24),$i=Math.pow(2,17),Xo=Math.pow(2,16),qi=Math.pow(2,9),yo=Math.pow(2,8),Oh=Math.pow(2,1);function ul(_){if(0===_.opacity&&!_.placed)return 0;if(1===_.opacity&&_.placed)return 4294967295;const a=_.placed?1:0,f=Math.floor(127*_.opacity);return f*Cn+a*xn+f*$i+a*Xo+f*qi+a*yo+f*Oh+a}const xr=0;class uu{constructor(a){this._sortAcrossTiles="viewport-y"!==a.layout.get("symbol-z-order")&&void 0!==a.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,f,v,C,M){const O=this._bucketParts;for(;this._currentTileIndex<a.length;)if(f.getBucketParts(O,C,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((k,B)=>k.sortKey-B.sortKey));this._currentPartIndex<O.length;){const k=O[this._currentPartIndex];if(f.placeLayerBucketPart(k,this._seenCrossTileIDs,v,0===k.symbolInstanceStart),this._currentPartIndex++,M())return!0}return!1}}class hr{constructor(a,f,v,C,M,O,k,B){this.placement=new or(a,M,O,k,B),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=C,this._done=!1}isDone(){return this._done}continuePlacement(a,f,v){const C=p.exported.now(),M=()=>{const O=p.exported.now()-C;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=f[a[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if("symbol"===O.type&&(!O.minzoom||O.minzoom<=k)&&(!O.maxzoom||O.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new uu(O)),this._inProgressLayer.continuePlacement(v[O.source],this.placement,this._showCollisionBoxes,O,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const ln=512/p.EXTENT/2;class Tn{constructor(a,f,v){this.tileID=a,this.bucketInstanceId=v,this.index=new p.KDBush(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const C=a.canonical.x*p.EXTENT,M=a.canonical.y*p.EXTENT;for(let O=0;O<f.length;O++){const{key:k,crossTileID:B,tileAnchorX:$,tileAnchorY:j}=f.get(O),q=Math.floor((C+$)*ln),ee=Math.floor((M+j)*ln);this.index.add(q,ee),this.keys.push(k),this.crossTileIDs.push(B)}this.index.finish()}findMatches(a,f,v){const C=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),M=ln/Math.pow(2,f.canonical.z-this.tileID.canonical.z),O=f.canonical.x*p.EXTENT,k=f.canonical.y*p.EXTENT;for(let B=0;B<a.length;B++){const $=a.get(B);if($.crossTileID)continue;const{key:j,tileAnchorX:q,tileAnchorY:ee}=$,se=Math.floor((O+q)*M),le=Math.floor((k+ee)*M),ae=this.index.range(se-C,le-C,se+C,le+C);for(const ce of ae){const X=this.crossTileIDs[ce];if(this.keys[ce]===j&&!v.has(X)){v.add(X),$.crossTileID=X;break}}}}}class sr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ko{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const f=Math.round((a-this.lng)/360);if(0!==f)for(const v in this.indexes){const C=this.indexes[v],M={};for(const O in C){const k=C[O];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+f),M[k.tileID.key]=k}this.indexes[v]=M}this.lng=a}addBucket(a,f,v){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let M=0;M<f.symbolInstances.length;M++)f.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const C=this.usedCrossTileIDs[a.overscaledZ];for(const M in this.indexes){const O=this.indexes[M];if(Number(M)>a.overscaledZ)for(const k in O){const B=O[k];B.tileID.isChildOf(a)&&B.findMatches(f.symbolInstances,a,C)}else{const k=O[a.scaledTo(Number(M)).key];k&&k.findMatches(f.symbolInstances,a,C)}}for(let M=0;M<f.symbolInstances.length;M++){const O=f.symbolInstances.get(M);O.crossTileID||(O.crossTileID=v.generate(),C.add(O.crossTileID))}return void 0===this.indexes[a.overscaledZ]&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Tn(a,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(a,f){for(const v of f.crossTileIDs)this.usedCrossTileIDs[a].delete(v)}removeStaleBuckets(a){let f=!1;for(const v in this.indexes){const C=this.indexes[v];for(const M in C)a[C[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,C[M]),delete C[M],f=!0)}return f}}class Lo{constructor(){this.layerIndexes={},this.crossTileIDs=new sr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,f,v,C){let M=this.layerIndexes[a.id];void 0===M&&(M=this.layerIndexes[a.id]=new ko);let O=!1;const k={};"globe"!==C.name&&M.handleWrapJump(v);for(const B of f){const $=B.getBucket(a);$&&a.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(B.tileID,$,this.crossTileIDs)&&(O=!0),k[$.bucketInstanceId]=!0)}return M.removeStaleBuckets(k)&&(O=!0),O}pruneUnusedLayers(a){const f={};a.forEach(v=>{f[v]=!0});for(const v in this.layerIndexes)f[v]||delete this.layerIndexes[v]}}const Mr=(_,a)=>p.emitValidationErrors(_,a&&a.filter(f=>"source.canvas"!==f.identifier)),dl=p.pick(pi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),gr=p.pick(pi,["setCenter","setZoom","setBearing","setPitch"]),Zs={version:8,layers:[],sources:{}},qs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Bn extends p.Evented{constructor(a,f={}){super(),this.map=a,this.dispatcher=new Ci(ll(),this),this.imageManager=new jt,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(a._requestManager,f.localFontFamily?p.LocalGlyphMode.all:f.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.crossTileSymbolIndex=new Lo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const v=this;this._rtlTextPluginCallback=Bn.registerForPluginStateChange(C=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:C.pluginStatus,pluginURL:C.pluginURL},(M,O)=>{if(p.triggerPluginCompletionEvent(M),O&&O.every(k=>k))for(const k in v._sourceCaches){const B=v._sourceCaches[k],$=B.getSource().type;"vector"!==$&&"geojson"!==$||B.reload()}})}),this.on("data",C=>{if("source"!==C.dataType||"metadata"!==C.sourceDataType)return;const M=this.getSource(C.sourceId);if(M&&M.vectorLayerIds)for(const O in this._layers){const k=this._layers[O];k.source===M.id&&this._validateLayer(k)}})}loadURL(a,f={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const v="boolean"==typeof f.validate?f.validate:!p.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,f.accessToken);const C=this.map._requestManager.transformRequest(a,p.ResourceType.Style);this._request=p.getJSON(C,(M,O)=>{this._request=null,M?this.fire(new p.ErrorEvent(M)):O&&this._load(O,v)})}loadJSON(a,f={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(a,!1!==f.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Zs,!1)}_updateLayerCount(a,f){const v=f?1:-1;a.is3D()&&(this._num3DLayers+=v),"circle"===a.type&&(this._numCircleLayers+=v),"symbol"===a.type&&(this._numSymbolLayers+=v)}_load(a,f){if(f&&Mr(this,p.validateStyle(a)))return;this._loaded=!0,this.stylesheet=p.clone$1(a),this._updateMapProjection();for(const C in a.sources)this.addSource(C,a.sources[C],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const v=Es(this.stylesheet.layers);this._order=v.map(C=>C.id),this._layers={},this._serializedLayers={};for(const C of v){const M=p.createStyleLayer(C);M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M,this._serializedLayers[M.id]=M.serialize(),this._updateLayerCount(M,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Yt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=function(f,v,C){let M,O,k;const B=p.exported.devicePixelRatio>1?"@2x":"";let $=p.getJSON(v.transformRequest(v.normalizeSpriteURL(f,B,".json"),p.ResourceType.SpriteJSON),(ee,se)=>{$=null,k||(k=ee,M=se,q())}),j=p.getImage(v.transformRequest(v.normalizeSpriteURL(f,B,".png"),p.ResourceType.SpriteImage),(ee,se)=>{j=null,k||(k=ee,O=se,q())});function q(){if(k)C(k);else if(M&&O){const ee=p.exported.getImageData(O),se={};for(const le in M){const{width:ae,height:ce,x:X,y:oe,sdf:fe,pixelRatio:pe,stretchX:Te,stretchY:De,content:Me}=M[le],ze=new p.RGBAImage({width:ae,height:ce});p.RGBAImage.copy(ee,ze,{x:X,y:oe},{x:0,y:0},{width:ae,height:ce}),se[le]={data:ze,pixelRatio:pe,sdf:fe,stretchX:Te,stretchY:De,content:Me}}C(null,se)}}return{cancel(){$&&($.cancel(),$=null),j&&(j.cancel(),j=null)}}}(a,this.map._requestManager,(f,v)=>{if(this._spriteRequest=null,f)this.fire(new p.ErrorEvent(f));else if(v)for(const C in v)this.imageManager.addImage(C,v[C]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(a){const f=this.getSource(a.source);if(!f)return;const v=a.sourceLayer;v&&("geojson"===f.type||f.vectorLayerIds&&-1===f.vectorLayerIds.indexOf(v))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${f.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const f=[];for(const v of a){const C=this._layers[v];"custom"!==C.type&&f.push(C.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&("function"==typeof a.isLayerDraped?a.isLayerDraped():qs[a.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const f=this._changed;if(this._changed){const C=Object.keys(this._updatedLayers),M=Object.keys(this._removedLayers);(C.length||M.length)&&this._updateWorkerLayers(C,M);for(const O in this._updatedSources){const k=this._updatedSources[O];"reload"===k?this._reloadSource(O):"clear"===k&&this._clearSource(O)}this._updateTilesForChangedImages();for(const O in this._updatedPaintProps)this._layers[O].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const v={};for(const C in this._sourceCaches){const M=this._sourceCaches[C];v[C]=M.used,M.used=!1}for(const C of this._order){const M=this._layers[C];if(M.recalculate(a,this._availableImages),!M.isHidden(a.zoom)){const k=this._getLayerSourceCache(M);k&&(k.used=!0)}const O=this.map.painter;if(O){const k=M.getProgramIds();if(!k)continue;const B=M.getProgramConfiguration(a.zoom);for(const $ of k)O.useProgram($,B)}}for(const C in v){const M=this._sourceCaches[C];v[C]!==M.used&&M.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Mr(this,p.validateStyle(a)))return!1;(a=p.clone$1(a)).layers=Es(a.layers);const f=function(C,M){if(!C)return[{command:pi.setStyle,args:[M]}];let O=[];try{if(!ue(C.version,M.version))return[{command:pi.setStyle,args:[M]}];ue(C.center,M.center)||O.push({command:pi.setCenter,args:[M.center]}),ue(C.zoom,M.zoom)||O.push({command:pi.setZoom,args:[M.zoom]}),ue(C.bearing,M.bearing)||O.push({command:pi.setBearing,args:[M.bearing]}),ue(C.pitch,M.pitch)||O.push({command:pi.setPitch,args:[M.pitch]}),ue(C.sprite,M.sprite)||O.push({command:pi.setSprite,args:[M.sprite]}),ue(C.glyphs,M.glyphs)||O.push({command:pi.setGlyphs,args:[M.glyphs]}),ue(C.transition,M.transition)||O.push({command:pi.setTransition,args:[M.transition]}),ue(C.light,M.light)||O.push({command:pi.setLight,args:[M.light]}),ue(C.fog,M.fog)||O.push({command:pi.setFog,args:[M.fog]}),ue(C.projection,M.projection)||O.push({command:pi.setProjection,args:[M.projection]});const k={},B=[];!function(q,ee,se,le){let ae;for(ae in ee=ee||{},q=q||{})q.hasOwnProperty(ae)&&(ee.hasOwnProperty(ae)||Qr(ae,se,le));for(ae in ee){if(!ee.hasOwnProperty(ae))continue;const ce=ee[ae];q.hasOwnProperty(ae)?ue(q[ae],ce)||("geojson"===q[ae].type&&"geojson"===ce.type&&Ws(q,ee,ae)?se.push({command:pi.setGeoJSONSourceData,args:[ae,ce.data]}):xi(ae,ee,se,le)):Cs(ae,ee,se)}}(C.sources,M.sources,B,k);const $=[];C.layers&&C.layers.forEach(q=>{q.source&&k[q.source]?O.push({command:pi.removeLayer,args:[q.id]}):$.push(q)});let j=C.terrain;j&&k[j.source]&&(O.push({command:pi.setTerrain,args:[void 0]}),j=void 0),O=O.concat(B),ue(j,M.terrain)||O.push({command:pi.setTerrain,args:[M.terrain]}),function(q,ee,se){ee=ee||[];const le=(q=q||[]).map(_o),ae=ee.map(_o),ce=q.reduce(gc,{}),X=ee.reduce(gc,{}),oe=le.slice(),fe=Object.create(null);let pe,Te,De,Me,ze,Oe,Xe;for(pe=0,Te=0;pe<le.length;pe++)De=le[pe],X.hasOwnProperty(De)?Te++:(se.push({command:pi.removeLayer,args:[De]}),oe.splice(oe.indexOf(De,Te),1));for(pe=0,Te=0;pe<ae.length;pe++)De=ae[ae.length-1-pe],oe[oe.length-1-pe]!==De&&(ce.hasOwnProperty(De)?(se.push({command:pi.removeLayer,args:[De]}),oe.splice(oe.lastIndexOf(De,oe.length-Te),1)):Te++,Oe=oe[oe.length-pe],se.push({command:pi.addLayer,args:[X[De],Oe]}),oe.splice(oe.length-pe,0,De),fe[De]=!0);for(pe=0;pe<ae.length;pe++)if(De=ae[pe],Me=ce[De],ze=X[De],!fe[De]&&!ue(Me,ze))if(ue(Me.source,ze.source)&&ue(Me["source-layer"],ze["source-layer"])&&ue(Me.type,ze.type)){for(Xe in go(Me.layout,ze.layout,se,De,null,pi.setLayoutProperty),go(Me.paint,ze.paint,se,De,null,pi.setPaintProperty),ue(Me.filter,ze.filter)||se.push({command:pi.setFilter,args:[De,ze.filter]}),ue(Me.minzoom,ze.minzoom)&&ue(Me.maxzoom,ze.maxzoom)||se.push({command:pi.setLayerZoomRange,args:[De,ze.minzoom,ze.maxzoom]}),Me)Me.hasOwnProperty(Xe)&&"layout"!==Xe&&"paint"!==Xe&&"filter"!==Xe&&"metadata"!==Xe&&"minzoom"!==Xe&&"maxzoom"!==Xe&&(0===Xe.indexOf("paint.")?go(Me[Xe],ze[Xe],se,De,Xe.slice(6),pi.setPaintProperty):ue(Me[Xe],ze[Xe])||se.push({command:pi.setLayerProperty,args:[De,Xe,ze[Xe]]}));for(Xe in ze)ze.hasOwnProperty(Xe)&&!Me.hasOwnProperty(Xe)&&"layout"!==Xe&&"paint"!==Xe&&"filter"!==Xe&&"metadata"!==Xe&&"minzoom"!==Xe&&"maxzoom"!==Xe&&(0===Xe.indexOf("paint.")?go(Me[Xe],ze[Xe],se,De,Xe.slice(6),pi.setPaintProperty):ue(Me[Xe],ze[Xe])||se.push({command:pi.setLayerProperty,args:[De,Xe,ze[Xe]]}))}else se.push({command:pi.removeLayer,args:[De]}),Oe=oe[oe.lastIndexOf(De)+1],se.push({command:pi.addLayer,args:[ze,Oe]})}($,M.layers,O)}catch(k){console.warn("Unable to compute style diff:",k),O=[{command:pi.setStyle,args:[M]}]}return O}(this.serialize(),a).filter(C=>!(C.command in gr));if(0===f.length)return!1;const v=f.filter(C=>!(C.command in dl));if(v.length>0)throw new Error(`Unimplemented: ${v.map(C=>C.command).join(", ")}.`);return f.forEach(C=>{"setTransition"!==C.command&&"setProjection"!==C.command&&this[C.command].apply(this,C.args)}),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,f){return this.getImage(a)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,f),this._afterImageUpdated(a),this)}updateImage(a,f){this.imageManager.updateImage(a,f)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,f,v={}){if(this._checkLoaded(),void 0!==this.getSource(a))throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(p.validateSource,`sources.${a}`,f,null,v))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const C=jn(a,f,this.dispatcher,this);C.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:C.serialize(),sourceId:a}));const M=O=>{const k=(O?"symbol:":"other:")+a,B=this._sourceCaches[k]=new p.SourceCache(k,C,O);(O?this._symbolSourceCaches:this._otherSourceCaches)[a]=B,B.style=this,B.onAdd(this.map)};M(!1),"vector"!==f.type&&"geojson"!==f.type||M(!0),C.onAdd&&C.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const f=this.getSource(a);if(!f)throw new Error("There is no source with this ID");for(const C in this._layers)if(this._layers[C].source===a)return this.fire(new p.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${C}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new p.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(a);for(const C of v)delete this._sourceCaches[C.id],delete this._updatedSources[C.id],C.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:C.getSource().id})),C.setEventedParent(null),C.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,f){this._checkLoaded(),this.getSource(a).setData(f),this._changed=!0}getSource(a){const f=this._getSourceCache(a);return f&&f.getSource()}_getSources(){const a=[];for(const f in this._otherSourceCaches){const v=this._getSourceCache(f);v&&a.push(v.getSource())}return a}addLayer(a,f,v={}){this._checkLoaded();const C=a.id;if(this.getLayer(C))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${C}" already exists on this map`)));let M;if("custom"===a.type){if(Mr(this,p.validateCustomStyleLayer(a)))return;M=p.createStyleLayer(a)}else{if("object"==typeof a.source&&(this.addSource(C,a.source),a=p.clone$1(a),a=p.extend(a,{source:C})),this._validate(p.validateLayer,`layers.${C}`,a,{arrayIndex:-1},v))return;M=p.createStyleLayer(a),this._validateLayer(M),M.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[M.id]=M.serialize(),this._updateLayerCount(M,!0)}const O=f?this._order.indexOf(f):this._order.length;if(f&&-1===O)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(O,0,C),this._layerOrderChanged=!0,this._layers[C]=M;const k=this._getLayerSourceCache(M);if(this._removedLayers[C]&&M.source&&k&&"custom"!==M.type){const B=this._removedLayers[C];delete this._removedLayers[C],B.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",k.pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,f){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===f)return;const v=this._order.indexOf(a);this._order.splice(v,1);const C=f?this._order.indexOf(f):this._order.length;f&&-1===C?this.fire(new p.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(C,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const f=this._layers[a];if(!f)return void this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const v=this._order.indexOf(a);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=f,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const f in this._layers)if(this._layers[f].type===a)return!0;return!1}setLayerZoomRange(a,f,v){this._checkLoaded();const C=this.getLayer(a);C?C.minzoom===f&&C.maxzoom===v||(null!=f&&(C.minzoom=f),null!=v&&(C.maxzoom=v),this._updateLayer(C)):this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,f,v={}){this._checkLoaded();const C=this.getLayer(a);if(C){if(!ue(C.filter,f))return null==f?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(p.validateFilter,`layers.${C.id}.filter`,f,{layerType:C.type},v)||(C.filter=p.clone$1(f),this._updateLayer(C)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const f=this.getLayer(a);return f&&p.clone$1(f.filter)}setLayoutProperty(a,f,v,C={}){this._checkLoaded();const M=this.getLayer(a);M?ue(M.getLayoutProperty(f),v)||(M.setLayoutProperty(f,v,C),this._updateLayer(M)):this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,f){const v=this.getLayer(a);if(v)return v.getLayoutProperty(f);this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,f,v,C={}){this._checkLoaded();const M=this.getLayer(a);M?ue(M.getPaintProperty(f),v)||(M.setPaintProperty(f,v,C)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,f){const v=this.getLayer(a);return v&&v.getPaintProperty(f)}setFeatureState(a,f){this._checkLoaded();const v=a.source,C=a.sourceLayer,M=this.getSource(v);if(!M)return void this.fire(new p.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const O=M.type;if("geojson"===O&&C)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===O&&!C)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===a.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const k=this._getSourceCaches(v);for(const B of k)B.setFeatureState(C,a.id,f)}removeFeatureState(a,f){this._checkLoaded();const v=a.source,C=this.getSource(v);if(!C)return void this.fire(new p.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const M=C.type,O="vector"===M?a.sourceLayer:void 0;if("vector"===M&&!O)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&"string"!=typeof a.id&&"number"!=typeof a.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const k=this._getSourceCaches(v);for(const B of k)B.removeFeatureState(O,a.id,f)}getFeatureState(a){this._checkLoaded();const f=a.source,v=a.sourceLayer,C=this.getSource(f);if(C){if("vector"!==C.type||v)return void 0===a.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(v,a.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const f in this._sourceCaches){const v=this._sourceCaches[f].getSource();a[v.id]||(a[v.id]=v.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},f=>void 0!==f)}_updateLayer(a){this._updatedLayers[a.id]=!0;const f=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&f&&"raster"!==f.getSource().type&&(this._updatedSources[a.source]="reload",f.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const f=O=>"fill-extrusion"===this._layers[O].type,v={},C=[];for(let O=this._order.length-1;O>=0;O--){const k=this._order[O];if(f(k)){v[k]=O;for(const B of a){const $=B[k];if($)for(const j of $)C.push(j)}}}C.sort((O,k)=>k.intersectionZ-O.intersectionZ);const M=[];for(let O=this._order.length-1;O>=0;O--){const k=this._order[O];if(f(k))for(let B=C.length-1;B>=0;B--){const $=C[B].feature;if(v[$.layer.id]<O)break;M.push($),C.pop()}else for(const B of a){const $=B[k];if($)for(const j of $)M.push(j.feature)}}return M}queryRenderedFeatures(a,f,v){f&&f.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const C={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const B of f.layers){const $=this._layers[B];if(!$)return this.fire(new p.ErrorEvent(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];C[$.source]=!0}}const M=[];f.availableImages=this._availableImages;const O=f&&f.layers?f.layers.some(B=>{const $=this.getLayer(B);return $&&$.is3D()}):this.has3DLayers(),k=Hs.createFromScreenPoints(a,v);for(const B in this._sourceCaches){const $=this._sourceCaches[B].getSource().id;f.layers&&!C[$]||M.push(Jn(this._sourceCaches[B],this._layers,this._serializedLayers,k,f,v,O,!!this.map._showQueryGeometry))}return this.placement&&M.push(function(B,$,j,q,ee,se,le){const ae={},ce=se.queryRenderedSymbols(q),X=[];for(const oe of Object.keys(ce).map(Number))X.push(le[oe]);X.sort(si);for(const oe of X){const fe=oe.featureIndex.lookupSymbolFeatures(ce[oe.bucketInstanceId],$,oe.bucketIndex,oe.sourceLayerIndex,ee.filter,ee.layers,ee.availableImages,B);for(const pe in fe){const Te=ae[pe]=ae[pe]||[],De=fe[pe];De.sort((Me,ze)=>{const Oe=oe.featureSortOrder;if(Oe){const Xe=Oe.indexOf(Me.featureIndex);return Oe.indexOf(ze.featureIndex)-Xe}return ze.featureIndex-Me.featureIndex});for(const Me of De)Te.push(Me)}}for(const oe in ae)ae[oe].forEach(fe=>{const pe=fe.feature,Te=j(B[oe]);if(!Te)return;const De=Te.getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=De});return ae}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),k.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(M)}querySourceFeatures(a,f){f&&f.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const v=this._getSourceCaches(a);let C=[];for(const M of v)C=C.concat(fr(M,f));return C}addSourceType(a,f,v){return Bn.getSourceType(a)?v(new Error(`A source type called "${a}" already exists.`)):(Bn.setSourceType(a,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:f.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(a,f={}){this._checkLoaded();const v=this.light.getLight();let C=!1;for(const O in a)if(!ue(a[O],v[O])){C=!0;break}if(!C)return;const M=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,f),this.light.updateTransitions(M)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,f=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=a;if(1===f){if("object"==typeof v.source){const C="terrain-dem-src";this.addSource(C,v.source),v=p.clone$1(v),v=p.extend(v,{source:C})}if(this._validate(p.validateTerrain,"terrain",v))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,f)}else{const C=this.terrain,M=C.get();for(const O of Object.keys(p.spec.terrain))!v.hasOwnProperty(O)&&p.spec.terrain[O].default&&(v[O]=p.spec.terrain[O].default);for(const O in v)if(!ue(v[O],M[O])){C.set(v),this.stylesheet.terrain=v;const k=this._setTransitionParameters({duration:0});C.updateTransitions(k);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const f=this.fog=new $s(a,this.map.transform);this.stylesheet.fog=a;const v=this._setTransitionParameters({duration:0});f.updateTransitions(v)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,v=f.get();0===Object.keys(a).length&&f.set(a);for(const C in a)if(!ue(a[C],v[C])){f.set(a),this.stylesheet.fog=a;const M=this._setTransitionParameters({duration:0});f.updateTransitions(M);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:p.exported.now(),transition:p.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter(v=>this.isLayerDraped(this._layers[v])),f=this._order.filter(v=>!this.isLayerDraped(this._layers[v]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...f)}_createTerrain(a,f){const v=this.terrain=new mi(a,f);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const C=this._setTransitionParameters({duration:0});v.updateTransitions(C)}_force3DLayerUpdate(){for(const a in this._layers){const f=this._layers[a];"fill-extrusion"===f.type&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const f=this._layers[a];"symbol"===f.type&&this._updateLayer(f)}}_validate(a,f,v,C,M={}){return(!M||!1!==M.validate)&&Mr(this,a.call(p.validateStyle,p.extend({key:f,style:this.serialize(),value:v,styleSpec:p.spec},C)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const f=this._getSourceCaches(a);for(const v of f)v.clearTiles()}_reloadSource(a){const f=this._getSourceCaches(a);for(const v of f)v.resume(),v.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const f in this._sourceCaches)this._sourceCaches[f].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const f=this._sourceCaches[a];f.resume(),f.reload()}}_updatePlacement(a,f,v,C,M=!1){let O=!1,k=!1;const B={};for(const $ of this._order){const j=this._layers[$];if("symbol"!==j.type)continue;if(!B[j.source]){const ee=this._getLayerSourceCache(j);if(!ee)continue;B[j.source]=ee.getRenderableIds(!0).map(se=>ee.getTileByID(se)).sort((se,le)=>le.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(le.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(j,B[j.source],a.center.lng,a.projection);O=O||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),M=M||this._layerOrderChanged||0===v,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),a.zoom))&&(this.pauseablePlacement=new hr(a,this._order,M,f,v,C,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),k=!0),O&&this.pauseablePlacement.placement.setStale()),k||O)for(const $ of this._order){const j=this._layers[$];"symbol"===j.type&&this.placement.updateLayerOpacities(j,B[j.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,f,v){this.imageManager.getImages(f.icons,v),this._updateTilesForChangedImages();const C=M=>{M&&M.setDependencies(f.tileID.key,f.type,f.icons)};C(this._otherSourceCaches[f.source]),C(this._symbolSourceCaches[f.source])}getGlyphs(a,f,v){this.glyphManager.getGlyphs(f.stacks,v)}getResource(a,f,v){return p.makeRequest(f,v)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return"symbol"===a.type?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const f=[];return this._otherSourceCaches[a]&&f.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&f.push(this._symbolSourceCaches[a]),f}_isSourceCacheLoaded(a){const f=this._getSourceCaches(a);return 0===f.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):f.every(v=>v.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Bn.getSourceType=function(_){return Yn[_]},Bn.setSourceType=function(_,a){Yn[_]=a},Bn.registerForPluginStateChange=p.registerForPluginStateChange;var Vl="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",hl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Fo="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",_r="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ts="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let fl={},No={};const Fa=[];Ys(Vl,Fa),Ys(Fo,Fa),Ys(_r,Fa),Ys(Ts,Fa),fl=yn("",Fo),No=yn(Ts,_r);const kh=yn("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ca=Vl,Ms="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var du={background:yn("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:yn("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:yn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:yn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:yn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:yn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:yn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:yn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:yn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:yn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:yn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:yn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:yn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:yn("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:yn("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:yn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:yn("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:yn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:yn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:yn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:yn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:yn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:yn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:yn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:yn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",hl),skyboxGradient:yn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",hl),skyboxCapture:yn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:yn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:yn("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Ys(_,a){const f=_.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let v of f)if(v=v.trim(),"#"===v[0]&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const C=v.split(" ");for(const M of C)a.includes(M)||a.push(M)}}function yn(_,a){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),C={},M=[...Fa];return Ys(_,M),Ys(a,M),{fragmentSource:_=_.replace(f,(O,k,B,$,j)=>(C[j]=!0,"define"===k?`\n#ifndef HAS_UNIFORM_u_${j}\nvarying ${B} ${$} ${j};\n#else\nuniform ${B} ${$} u_${j};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${j}\n    ${B} ${$} ${j} = u_${j};\n#endif\n`)),vertexSource:a=a.replace(f,(O,k,B,$,j)=>{const q="float"===$?"vec2":"vec4",ee=j.match(/color/)?"color":q;return C[j]?"define"===k?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nattribute ${B} ${q} a_${j};\nvarying ${B} ${$} ${j};\n#else\nuniform ${B} ${$} u_${j};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = a_${j};\n#else\n    ${B} ${$} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = unpack_mix_${ee}(a_${j}, u_${j}_t);\n#else\n    ${B} ${$} ${j} = u_${j};\n#endif\n`:"define"===k?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nattribute ${B} ${q} a_${j};\n#else\nuniform ${B} ${$} u_${j};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${B} ${$} ${j} = a_${j};\n#else\n    ${B} ${$} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${B} ${$} ${j} = unpack_mix_${ee}(a_${j}, u_${j}_t);\n#else\n    ${B} ${$} ${j} = u_${j};\n#endif\n`}),staticAttributes:v,usedDefines:M}}class C_{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,f,v,C,M,O,k){this.context=a;let B=this.boundPaintVertexBuffers.length!==C.length;for(let j=0;!B&&j<C.length;j++)this.boundPaintVertexBuffers[j]!==C[j]&&(B=!0);let $=this.boundDynamicVertexBuffers.length!==k.length;for(let j=0;!$&&j<k.length;j++)this.boundDynamicVertexBuffers[j]!==k[j]&&($=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==v||B||$||this.boundIndexBuffer!==M||this.boundVertexOffset!==O)this.freshBind(f,v,C,M,O,k);else{a.bindVertexArrayOES.set(this.vao);for(const j of k)j&&j.bind();M&&M.dynamicDraw&&M.bind()}}freshBind(a,f,v,C,M,O){let k;const B=a.numAttributes,$=this.context,j=$.gl;if($.extVertexArrayObject)this.vao&&this.destroy(),this.vao=$.extVertexArrayObject.createVertexArrayOES(),$.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=a,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=C,this.boundVertexOffset=M,this.boundDynamicVertexBuffers=O;else{k=$.currentNumAttributes||0;for(let q=B;q<k;q++)j.disableVertexAttribArray(q)}f.enableAttributes(j,a),f.bind(),f.setVertexAttribPointers(j,a,M);for(const q of v)q.enableAttributes(j,a),q.bind(),q.setVertexAttribPointers(j,a,M);for(const q of O)q&&(q.enableAttributes(j,a),q.bind(),q.setVertexAttribPointers(j,a,M));C&&C.bind(),$.currentNumAttributes=B}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function hu(_,a){const f=Math.pow(2,a.canonical.z),v=a.canonical.y;return[new p.MercatorCoordinate(0,v/f).toLngLat().lat,new p.MercatorCoordinate(0,(v+1)/f).toLngLat().lat]}function Lh(_,a,f,v,C,M,O){const k=_.context,B=k.gl,$=f.fbo;if(!$)return;_.prepareDrawTile();const j=_.useProgram("hillshade");k.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,$.colorAttachment.get());const q=((ae,ce,X,oe)=>{const fe=X.paint.get("hillshade-shadow-color"),pe=X.paint.get("hillshade-highlight-color"),Te=X.paint.get("hillshade-accent-color");let De=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===X.paint.get("hillshade-illumination-anchor")&&(De-=ae.transform.angle);const Me=!ae.options.moving;return{u_matrix:oe||ae.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Me),u_image:0,u_latrange:hu(0,ce.tileID),u_light:[X.paint.get("hillshade-exaggeration"),De],u_shadow:fe,u_highlight:pe,u_accent:Te}})(_,f,v,_.terrain?a.projMatrix:null);_.prepareDrawProgram(k,j,a.toUnwrapped());const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:se,tileBoundsSegments:le}=_.getTileBoundsBuffers(f);j.draw(k,B.TRIANGLES,C,M,O,p.CullFaceMode.disabled,q,v.id,ee,se,le)}function Bo(_,a,f){if(!a.needsDEMTextureUpload)return;const v=_.context,C=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||_.getTileTexture(f.stride);const M=f.getPixels();a.demTexture?a.demTexture.update(M,{premultiply:!1}):a.demTexture=new p.Texture(v,M,C.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function fu(_,a,f,v,C,M){const O=_.context,k=O.gl;if(!a.dem)return;const B=a.dem;if(O.activeTexture.set(k.TEXTURE1),Bo(_,a,B),!a.demTexture)return;a.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);const $=B.dim;O.activeTexture.set(k.TEXTURE0);let j=a.fbo;if(!j){const le=new p.Texture(O,{width:$,height:$,data:null},k.RGBA);le.bind(k.LINEAR,k.CLAMP_TO_EDGE),j=a.fbo=O.createFramebuffer($,$,!0),j.colorAttachment.set(le.texture)}O.bindFramebuffer.set(j.framebuffer),O.viewport.set([0,0,$,$]);const{tileBoundsBuffer:q,tileBoundsIndexBuffer:ee,tileBoundsSegments:se}=_.getMercatorTileBoundsBuffers();_.useProgram("hillshadePrepare").draw(O,k.TRIANGLES,v,C,M,p.CullFaceMode.disabled,((le,ae)=>{const ce=ae.stride,X=p.create();return p.ortho(X,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(X,X,[0,-p.EXTENT,0]),{u_matrix:X,u_image:1,u_dimension:[ce,ce],u_zoom:le.overscaledZ,u_unpack:ae.unpackVector}})(a.tileID,B),f.id,q,ee,se),a.needsHillshadePrepare=!1}const Ul=_=>({u_matrix:new p.UniformMatrix4f(_),u_image0:new p.Uniform1i(_),u_skirt_height:new p.Uniform1f(_)}),ua=(_,a)=>({u_matrix:_,u_image0:0,u_skirt_height:a}),Vr=(_,a,f,v,C,M,O,k,B,$,j,q,ee,se,le)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:f,u_zoom_transition:C,u_merc_center:M,u_image0:0,u_frustum_tl:O,u_frustum_tr:k,u_frustum_br:B,u_frustum_bl:$,u_globe_pos:j,u_globe_radius:q,u_viewport:ee,u_grid_matrix:le?Float32Array.from(le):new Float32Array(9),u_skirt_height:se});function pd(_,a){return null!=_&&null!=a&&!(!_.hasData()||!a.hasData())&&null!=_.demTexture&&null!=a.demTexture&&_.tileID.key!==a.tileID.key}const Or=new class{constructor(){this.operations={}}newMorphing(_,a,f,v,C){if(_ in this.operations){const M=this.operations[_];M.to.tileID.key!==f.tileID.key&&(M.queued=f)}else this.operations[_]={startTime:v,phase:0,duration:C,from:a,to:f,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const a=this.operations[_];return{from:a.from,to:a.to,phase:a.phase}}update(_){for(const a in this.operations){const f=this.operations[a];for(f.phase=(_-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,_)){delete this.operations[a];break}}}_nextOp(_,a){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=a,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},kr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function yc(_){return 6*Math.pow(1.5,22-_)}function pl(_,a){const f=1<<_.z;return!a&&(0===_.x||_.x===f-1)||0===_.y||_.y===f-1}const jl=_=>({u_matrix:_});function Ss(_,a,f,v,C){if(C>0){const M=p.exported.now(),O=(M-_.timeAdded)/C,k=a?(M-a.timeAdded)/C:-1,B=f.getSource(),$=v.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),j=!a||Math.abs(a.tileID.overscaledZ-$)>Math.abs(_.tileID.overscaledZ-$),q=j&&_.refreshedUponExpiration?1:p.clamp(j?O:1-k,0,1);return _.refreshedUponExpiration&&O>=1&&(_.refreshedUponExpiration=!1),a?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}class pu extends p.SourceCache{constructor(a){const f={type:"raster-dem",maxzoom:a.transform.maxZoom},v=new Ci(ll(),null),C=jn("mock-dem",f,v,a.style);super("mock-dem",C,!1),C.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,f){a.state="loaded",f(null)}}class md extends p.SourceCache{constructor(a){const f=jn("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new Ci(ll(),null),a.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,f,v){if(a.freezeTileCoverage)return;this.transform=a;const C=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((M,O)=>{if(M[O.key]="",!this._tiles[O.key]){const k=new p.Tile(O,this._source.tileSize*O.overscaleFactor(),a.tileZoom);k.state="loaded",this._tiles[O.key]=k}return M},{});for(const M in this._tiles)M in C||(this.freeFBO(M),this._tiles[M].unloadVectorData(),delete this._tiles[M])}freeFBO(a){const f=this.proxyCachedFBO[a];if(void 0!==f){const v=Object.values(f);this.renderCachePool.push(...v),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class gd extends p.OverscaledTileID{constructor(a,f,v){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=f,this.projMatrix=v}}class Nm extends p.Elevation{constructor(a,f){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,C,M]=function(B){const $=new p.StructArrayLayout2i4,j=new p.StructArrayLayout3ui6,q=131;$.reserve(17161),j.reserve(33800);const ee=p.EXTENT/128,se=p.EXTENT+ee/2,le=se+ee;for(let ce=-ee;ce<le;ce+=ee)for(let X=-ee;X<le;X+=ee){const oe=X<0||X>se||ce<0||ce>se?24575:0,fe=p.clamp(Math.round(X),0,p.EXTENT),pe=p.clamp(Math.round(ce),0,p.EXTENT);$.emplaceBack(fe+oe,pe)}const ae=(ce,X)=>{const oe=X*q+ce;j.emplaceBack(oe+1,oe,oe+q),j.emplaceBack(oe+q,oe+q+1,oe+1)};for(let ce=1;ce<129;ce++)for(let X=1;X<129;X++)ae(X,ce);return[0,129].forEach(ce=>{for(let X=0;X<130;X++)ae(X,ce),ae(ce,X)}),[$,j,32768]}(),O=a.context;this.gridBuffer=O.createVertexBuffer(v,p.posAttributes.members),this.gridIndexBuffer=O.createIndexBuffer(C),this.gridSegments=p.SegmentVector.simpleSegment(0,0,v.length,C.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,v.length,M),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new md(f.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const k=O.gl;this._overlapStencilMode=new p.StencilMode({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new pu(f.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,f,v){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const C=a.terrain.properties;this.sourceCache=0===a.terrain.drapeRenderMode?this._mockSourceCache:a._getSourceCache(C.get("source")),this._exaggeration=C.get("exaggeration");const M=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const O=this.getScaledDemTileSize();this.sourceCache.update(f,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,M(),this._initializing=!0),M(),f.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==a.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&"source"===a.dataType?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):"style"===a.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=0===v._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(v.center),-1),this._emptyDEMTextureDirty=!this._initializing);const C=this.proxyCoords=f.getIds().map(B=>{const $=f.getTileByID(B).tileID;return $.projMatrix=v.calculateProjMatrix($.toUnwrapped()),$});(function(B,$){const j=$.transform.pointCoordinate($.transform.getCameraPoint()),q=new p.Point(j.x,j.y);B.sort((ee,se)=>{if(se.overscaledZ-ee.overscaledZ)return se.overscaledZ-ee.overscaledZ;const le=new p.Point(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),ae=new p.Point(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),ce=q.mult(1<<ee.canonical.z);return ce.x-=.5,ce.y-=.5,ce.distSqr(le)-ce.distSqr(ae)})})(C,this.painter),this._previousZoom=v.zoom;const M=this.proxyToSource||{};this.proxyToSource={},C.forEach(B=>{this.proxyToSource[B.key]={}}),this.terrainTileForTile={};const O=this._style._sourceCaches;for(const B in O){const $=O[B];if(!$.used||($!==this.sourceCache&&this.resetTileLookupCache($.id),this._setupProxiedCoordsForOrtho($,a[B],M),$.usedForTerrain))continue;const j=a[B];$.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[f.id]=C.map(B=>new gd(B,B.key,this.orthoMatrix)),this._assignTerrainTiles(C),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(M),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const k={};this._visibleDemTiles=[];for(const B of this.proxyCoords){const $=this.terrainTileForTile[B.key];if(!$)continue;const j=$.tileID.key;j in k||(this._visibleDemTiles.push($),k[j]=j)}}_assignTerrainTiles(a){this._initializing||a.forEach(f=>{if(this.terrainTileForTile[f.key])return;const v=this._findTileCoveringTileID(f,this.sourceCache);v&&(this.terrainTileForTile[f.key]=v)})}_prepareDEMTextures(){const a=this.painter.context,f=a.gl;for(const v in this.terrainTileForTile){const C=this.terrainTileForTile[v],M=C.dem;!M||C.demTexture&&!C.needsDEMTextureUpload||(a.activeTexture.set(f.TEXTURE1),Bo(this.painter,C,M))}}_prepareDemTileUniforms(a,f,v,C){if(!f||null==f.demTexture)return!1;const M=a.tileID.canonical,O=Math.pow(2,f.tileID.canonical.z-M.z),k=C||"";return v[`u_dem_tl${k}`]=[M.x*O%1,M.y*O%1],v[`u_dem_scale${k}`]=O,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,f=a.gl;if(!this._emptyDepthBufferTexture){const v=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(a,v,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const f=this._visibleDemTiles.reduce((v,C)=>{if(!C.dem)return v;const M=C.dem.tree.minimums[0];return M>0&&a++,v+M},0);return a?f/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,f=a.gl;a.activeTexture.set(f.TEXTURE2);const v=this._getLoadedAreaMinimum(),C=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(v,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(C,{premultiply:!1}):M=this._emptyDEMTexture=new p.Texture(a,C,f.RGBA,{premultiply:!1}),M}setupElevationDraw(a,f,v){const C=this.painter.context,M=C.gl,O=(k=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(k),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var k;O.u_dem_size=this.sourceCache.getSource().tileSize,O.u_exaggeration=this.exaggeration();let B=null,$=null,j=1;if(v&&v.morphing&&this._useVertexMorphing){const q=v.morphing.srcDemTile,ee=v.morphing.dstDemTile;j=v.morphing.phase,q&&ee&&(this._prepareDemTileUniforms(a,q,O,"_prev")&&($=q),this._prepareDemTileUniforms(a,ee,O)&&(B=ee))}if($&&B?(C.activeTexture.set(M.TEXTURE2),B.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE,M.NEAREST),C.activeTexture.set(M.TEXTURE4),$.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE,M.NEAREST),O.u_dem_lerp=j):(B=this.terrainTileForTile[a.tileID.key],C.activeTexture.set(M.TEXTURE2),(this._prepareDemTileUniforms(a,B,O)?B.demTexture:this.emptyDEMTexture).bind(M.NEAREST,M.CLAMP_TO_EDGE)),C.activeTexture.set(M.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),this._depthFBO&&(O.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),O.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&B){const q=(1<<B.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;O.u_meter_to_dem=q}if(v&&v.labelPlaneMatrixInv&&(O.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),f.setTerrainUniformValues(C,O),"globe"===this.painter.transform.projection.name){const q=this.globeUniformValues(this.painter.transform,a.tileID.canonical,v&&v.useDenormalizedUpVectorScale);f.setGlobeUniformValues(C,q)}}globeUniformValues(a,f,v){const C=a.projection;return{u_tile_tl_up:C.upVector(f,0,0),u_tile_tr_up:C.upVector(f,p.EXTENT,0),u_tile_br_up:C.upVector(f,p.EXTENT,p.EXTENT),u_tile_bl_up:C.upVector(f,0,p.EXTENT),u_tile_up_scale:v?p.globeMetersToEcef(1):C.upVectorScale(f,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const f=this.painter,v=this.painter.context;0!==a.length&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(C,M,O,k,B){if("globe"===C.transform.projection.name)!function($,j,q,ee,se){const le=$.context,ae=le.gl;let ce,X;const oe=$.options.showTerrainWireframe?2:0,fe=$.transform,pe=p.globeUseCustomAntiAliasing($,le,fe),Te=(_t,He)=>{if(X===_t)return;const ct=[kr[_t],"PROJECTION_GLOBE_VIEW"];pe&&ct.push("CUSTOM_ANTIALIASING"),He&&ct.push(kr[oe]),ce=$.useProgram("globeRaster",null,ct),X=_t},De=$.colorModeForRenderPass(),Me=new p.DepthMode(ae.LEQUAL,p.DepthMode.ReadWrite,$.depthRangeFor3D);Or.update(se);const ze=p.calculateGlobeMercatorMatrix(fe),Oe=[p.mercatorXfromLng(fe.center.lng),p.mercatorYfromLat(fe.center.lat)],Xe=oe?[!1,!0]:[!1],At=$.globeSharedBuffers,Ve=[fe.width*p.exported.devicePixelRatio,fe.height*p.exported.devicePixelRatio],ht=Float32Array.from(fe.globeMatrix),tt={useDenormalizedUpVectorScale:!0};if(Xe.forEach(_t=>{const He=$.transform,ct=yc(He.zoom)*j.exaggeration();X=-1;const Lt=_t?ae.LINES:ae.TRIANGLES;for(const ft of ee){const Ct=q.getTile(ft),vn=p.StencilMode.disabled,Rn=j.prevTerrainTileForTile[ft.key],sn=j.terrainTileForTile[ft.key];pd(Rn,sn)&&Or.newMorphing(ft.key,Rn,sn,se,250),le.activeTexture.set(ae.TEXTURE0),Ct.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const bn=Or.getMorphValuesForProxy(ft.key),Kn=bn?1:0;bn&&p.extend$1(tt,{morphing:{srcDemTile:bn.from,dstDemTile:bn.to,phase:p.easeCubicInOut(bn.phase)}});const Mn=p.tileCornersToBounds(ft.canonical),an=p.getLatitudinalLod(Mn.getCenter().lat),Ai=p.getGridMatrix(ft.canonical,Mn,an,He.worldSize/He._pixelsPerMercatorPixel),ii=p.globeNormalizeECEF(p.globeTileBounds(ft.canonical)),Gi=Vr(He.projMatrix,ht,ze,ii,p.globeToMercatorTransition(He.zoom),Oe,He.frustumCorners.TL,He.frustumCorners.TR,He.frustumCorners.BR,He.frustumCorners.BL,He.globeCenterInViewSpace,He.globeRadius,Ve,ct,Ai);if(Te(Kn,_t),j.setupElevationDraw(Ct,ce,tt),$.prepareDrawProgram(le,ce,ft.toUnwrapped()),At){const[ki,Sr,$r]=_t?At.getWirefameBuffers($.context,an):At.getGridBuffers(an,0!==ct);ce.draw(le,Lt,Me,vn,De,p.CullFaceMode.backCCW,Gi,"globe_raster",ki,Sr,$r)}}}),At){const _t=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&_t.push("CUSTOM_ANTIALIASING"),ce=$.useProgram("globeRaster",null,_t);for(const He of ee){const{x:ct,y:Lt,z:ft}=He.canonical,Ct=0===Lt,vn=Lt===(1<<ft)-1,[Rn,sn,bn,Kn]=At.getPoleBuffers(ft);if(Kn&&(Ct||vn)){const Mn=q.getTile(He);le.activeTexture.set(ae.TEXTURE0),Mn.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);let an=p.globePoleMatrixForTile(ft,ct,fe);const Ai=p.globeNormalizeECEF(p.globeTileBounds(He.canonical)),ii=(Gi,ki)=>Gi.draw(le,ae.TRIANGLES,Me,p.StencilMode.disabled,De,p.CullFaceMode.disabled,Vr(fe.projMatrix,an,an,Ai,0,Oe,fe.frustumCorners.TL,fe.frustumCorners.TR,fe.frustumCorners.BR,fe.frustumCorners.BL,fe.globeCenterInViewSpace,fe.globeRadius,Ve,0),"globe_pole_raster",ki,bn,Kn);j.setupElevationDraw(Mn,ce,tt),$.prepareDrawProgram(le,ce,He.toUnwrapped()),Ct&&ii(ce,Rn),vn&&(an=p.scale(p.create(),an,[1,-1,1]),ii(ce,sn))}}}}(C,M,O,k,B);else{const $=C.context,j=$.gl;let q,ee;const se=C.options.showTerrainWireframe?2:0,le=(fe,pe)=>{if(ee===fe)return;const Te=[kr[fe]];pe&&Te.push(kr[se]),q=C.useProgram("terrainRaster",null,Te),ee=fe},ae=C.colorModeForRenderPass(),ce=new p.DepthMode(j.LEQUAL,p.DepthMode.ReadWrite,C.depthRangeFor3D);Or.update(B);const X=C.transform,oe=yc(X.zoom)*M.exaggeration();(se?[!1,!0]:[!1]).forEach(fe=>{ee=-1;const pe=fe?j.LINES:j.TRIANGLES,[Te,De]=fe?M.getWirefameBuffer():[M.gridIndexBuffer,M.gridSegments];for(const Me of k){const ze=O.getTile(Me),Oe=p.StencilMode.disabled,Xe=M.prevTerrainTileForTile[Me.key],At=M.terrainTileForTile[Me.key];pd(Xe,At)&&Or.newMorphing(Me.key,Xe,At,B,250),$.activeTexture.set(j.TEXTURE0),ze.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST);const Ve=Or.getMorphValuesForProxy(Me.key),ht=Ve?1:0;let tt;Ve&&(tt={morphing:{srcDemTile:Ve.from,dstDemTile:Ve.to,phase:p.easeCubicInOut(Ve.phase)}});const _t=ua(Me.projMatrix,pl(Me.canonical,X.renderWorldCopies)?oe/10:oe);le(ht,fe),M.setupElevationDraw(ze,q,tt),C.prepareDrawProgram($,q,Me.toUnwrapped()),q.draw($,pe,ce,Oe,ae,p.CullFaceMode.backCCW,_t,"terrain_raster",M.gridBuffer,Te,De)}})}}(f,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(0===this._drapedRenderBatches.length)return a+1;this.renderingToTexture=!0;const f=this.painter,v=this.painter.context,C=this.proxySourceCache,M=this.proxiedCoords[C.id],O=this._drapedRenderBatches.shift(),k=[],B=f.style.order;let $=0;for(const j of M){const q=C.getTileByID(j.proxyTileKey),ee=C.proxyCachedFBO[j.key]?C.proxyCachedFBO[j.key][a]:void 0,se=void 0!==ee?C.renderCache[ee]:this.pool[$++],le=void 0!==ee;if(q.texture=se.tex,le&&!se.dirty){k.push(q.tileID);continue}let ae;v.bindFramebuffer.set(se.fb.framebuffer),this.renderedToTile=!1,se.dirty&&(v.clear({color:p.Color.transparent,stencil:0}),se.dirty=!1);for(let ce=O.start;ce<=O.end;++ce){const X=f.style._layers[B[ce]];if(X.isHidden(f.transform.zoom))continue;const oe=f.style._getLayerSourceCache(X),fe=oe?this.proxyToSource[j.key][oe.id]:[j];if(!fe)continue;const pe=fe;v.viewport.set([0,0,se.fb.width,se.fb.height]),ae!==(oe?oe.id:null)&&(this._setupStencil(se,fe,X,oe),ae=oe?oe.id:null),f.renderLayer(f,oe,X,pe)}this.renderedToTile?(se.dirty=!0,k.push(q.tileID)):le||--$,5===$&&($=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),O.end+1}postRender(){}renderCacheEfficiency(a){const f=a.order.length;if(0===f)return{efficiency:100};let v,C=0,M=0,O=!1;for(let k=0;k<f;++k){const B=a._layers[a.order[k]];this._style.isLayerDraped(B)?(O&&++C,++M):O||(O=!0,v=B.id)}return 0===M?{efficiency:100}:{efficiency:100*(1-C/M),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{a=Math.min(a,f.dem.tree.minimums[0])}),0===a?a:(a-30)*this._exaggeration}raycast(a,f,v){if(!this._visibleDemTiles)return null;const C=this._visibleDemTiles.filter(M=>M.dem).map(M=>{const O=M.tileID,k=1<<O.overscaledZ,{x:B,y:$}=O.canonical,j=B/k,q=(B+1)/k,ee=$/k,se=($+1)/k;return{minx:j,miny:ee,maxx:q,maxy:se,t:M.dem.tree.raycastRoot(j,ee,q,se,a,f,v),tile:M}});C.sort((M,O)=>(null!==M.t?M.t:Number.MAX_VALUE)-(null!==O.t?O.t:Number.MAX_VALUE));for(const M of C){if(null==M.t)return null;const O=M.tile.dem.tree.raycast(M.minx,M.miny,M.maxx,M.maxy,a,f,v);if(null!=O)return O}return null}_createFBO(){const a=this.painter.context,f=a.gl,v=this.drapeBufferSize;a.activeTexture.set(f.TEXTURE0);const C=new p.Texture(a,{width:v[0],height:v[1],data:null},f.RGBA);C.bind(f.LINEAR,f.CLAMP_TO_EDGE);const M=a.createFramebuffer(v[0],v[1],!1);return M.colorAttachment.set(C.texture),M.depthAttachment=new Pe(a,M.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,M.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):M.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:M,tex:C,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const f=this._style._layers[a],v=f.isHidden(this.painter.transform.zoom);return"custom"===f.type?!v&&f.shouldRedrape():!v&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const v of this._style._getSources())if(v instanceof Zt){a=!0;break}if(!a)return;const f={};for(let v=0;v<this._style.order.length;++v){const C=this._style._layers[this._style.order[v]],M=this._style._getLayerSourceCache(C);if(M&&!f[M.id]&&!C.isHidden(this.painter.transform.zoom)&&"line"===C.type&&C.widthExpression()instanceof p.ZoomDependentExpression){f[M.id]=!0;for(const O of this.proxyCoords){const k=this.proxyToSource[O.key][M.id];if(k)for(const B of k)this._clearRenderCacheForTile(M.id,B)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const v in this._style._sourceCaches)if(this._style._sourceCaches[v]._source instanceof zt){a=!0;break}if(!a)return;const f={};for(let v=0;v<this._style.order.length;++v){const C=this._style._layers[this._style.order[v]],M=this._style._getLayerSourceCache(C);if(!M||f[M.id]||C.isHidden(this.painter.transform.zoom)||"raster"!==C.type)continue;const O=C.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const B=this.proxyToSource[k.key][M.id];if(B)for(const $ of B){const j=Ss(M.getTile($),M.findLoadedParent($,0),M,this.painter.transform,O);(1!==j.opacity||0!==j.mix)&&this._clearRenderCacheForTile(M.id,$)}}}}_setupDrapedRenderBatches(){const a=this._style.order,f=a.length;if(0===f)return;const v=[];let C,M=0,O=this._style._layers[a[M]];for(;!this._style.isLayerDraped(O)&&O.isHidden(this.painter.transform.zoom)&&++M<f;)O=this._style._layers[a[M]];for(;M<f;++M){const k=this._style._layers[a[M]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?void 0===C&&(C=M):void 0!==C&&(v.push({start:C,end:M-1}),C=void 0))}void 0!==C&&v.push({start:C,end:M-1}),this._drapedRenderBatches=v}_setupRenderCache(a){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const O=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let k=0;k<O.length;++k){const B=Object.values(O[k]);f.renderCachePool.push(...B)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,C=this._tilesDirty;for(let O=v.length-1;O>=0;O--){const k=v[O];if(f.getTileByID(k.key),void 0!==f.proxyCachedFBO[k.key]){const B=a[k.key],$=this.proxyToSource[k.key];let j=0;for(const q in $){const ee=$[q],se=B[q];if(!se||se.length!==ee.length||ee.some((le,ae)=>le!==se[ae]||C[q]&&C[q].hasOwnProperty(le.key))){j=-1;break}++j}for(const q in f.proxyCachedFBO[k.key])f.renderCache[f.proxyCachedFBO[k.key][q]].dirty=j<0||j!==Object.values(B).length}}const M=[...this._drapedRenderBatches];M.sort((O,k)=>k.end-k.start-(O.end-O.start));for(const O of M)for(const k of v){if(f.proxyCachedFBO[k.key])continue;let B=f.renderCachePool.pop();void 0===B&&f.renderCache.length<50&&(B=f.renderCache.length,f.renderCache.push(this._createFBO())),void 0!==B&&(f.proxyCachedFBO[k.key]={},f.proxyCachedFBO[k.key][O.start]=B,f.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(a,f,v,C){if(!C||!this._sourceTilesOverlap[C.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const M=this.painter.context,O=M.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let k;if(v.isTileClipped())k=f.length,this._overlapStencilMode.test={func:O.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:O.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(M.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(a,f){const v=this.painter,C=this.painter.context,M=C.gl;v._tileClippingMaskIDs={},C.setColorMode(p.ColorMode.disabled),C.setDepthMode(p.DepthMode.disabled);const O=v.useProgram("clippingMask");for(const k of a){const B=v._tileClippingMaskIDs[k.key]=--f;O.draw(C,M.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:M.ALWAYS,mask:0},B,255,M.KEEP,M.KEEP,M.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,jl(k.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(a){const f=this.painter.transform;if(a.x<0||a.x>f.width||a.y<0||a.y>f.height)return null;const v=[a.x,a.y,1,1];p.transformMat4$1(v,v,f.pixelMatrixInverse),p.scale$1(v,v,1/v[3]),v[0]/=f.worldSize,v[1]/=f.worldSize;const C=f._camera.position,M=p.mercatorZfromAltitude(1,f.center.lat),O=[C[0],C[1],C[2]/M,0],k=p.subtract([],v.slice(0,3),O);p.normalize(k,k);const B=this.raycast(O,k,this._exaggeration);return null!==B&&B?(p.scaleAndAdd(O,O,k,B),O[3]=O[2],O[2]*=M,O):null}drawDepth(){const a=this.painter,f=a.context,v=this.proxySourceCache,C=Math.ceil(a.width),M=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===C&&this._depthFBO.height===M||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const O=f.gl,k=f.createFramebuffer(C,M,!0);f.activeTexture.set(O.TEXTURE0);const B=new p.Texture(f,{width:C,height:M,data:null},O.RGBA);B.bind(O.NEAREST,O.CLAMP_TO_EDGE),k.colorAttachment.set(B.texture);const $=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,C,M);k.depthAttachment.set($),this._depthFBO=k,this._depthTexture=B}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,C,M]),function(O,k,B,$){if("globe"===O.transform.projection.name)return;const j=O.context,q=j.gl;j.clear({depth:1});const ee=O.useProgram("terrainDepth"),se=new p.DepthMode(q.LESS,p.DepthMode.ReadWrite,O.depthRangeFor3D);for(const le of $){const ae=B.getTile(le),ce=ua(le.projMatrix,0);k.setupElevationDraw(ae,ee),ee.draw(j,q.TRIANGLES,se,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,ce,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(a,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,f,v){if(a.getSource()instanceof Nn)return this._setupProxiedCoordsForImageSource(a,f,v);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const C=this.proxiedCoords[a.id]=[],M=this.proxyCoords;for(let k=0;k<M.length;k++){const B=M[k],$=this._findTileCoveringTileID(B,a);if($){const j=this._createProxiedId(B,$,v[B.key]&&v[B.key][a.id]);C.push(j),this.proxyToSource[B.key][a.id]=[j]}}let O=!1;for(let k=0;k<f.length;k++){const B=a.getTile(f[k]);if(!B||!B.hasData())continue;const $=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if($&&$.tileID.canonical.z!==B.tileID.canonical.z){const j=this.proxyToSource[$.tileID.key][a.id],q=this._createProxiedId($.tileID,B,v[$.tileID.key]&&v[$.tileID.key][a.id]);j?j.splice(j.length-1,0,q):this.proxyToSource[$.tileID.key][a.id]=[q],C.push(q),O=!0}}this._sourceTilesOverlap[a.id]=O}_setupProxiedCoordsForImageSource(a,f,v){if(!a.getSource().loaded())return;const C=this.proxiedCoords[a.id]=[],M=this.proxyCoords,O=a.getSource(),k=new p.Point(O.tileID.x,O.tileID.y)._div(1<<O.tileID.z),B=O.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((j,q)=>(j.min.x=Math.min(j.min.x,q.x-k.x),j.min.y=Math.min(j.min.y,q.y-k.y),j.max.x=Math.max(j.max.x,q.x-k.x),j.max.y=Math.max(j.max.y,q.y-k.y),j),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),$=(j,q)=>{const ee=j.wrap+j.canonical.x/(1<<j.canonical.z),se=j.canonical.y/(1<<j.canonical.z),le=p.EXTENT/(1<<j.canonical.z),ae=q.wrap+q.canonical.x/(1<<q.canonical.z),ce=q.canonical.y/(1<<q.canonical.z);return ee+le<ae+B.min.x||ee>ae+B.max.x||se+le<ce+B.min.y||se>ce+B.max.y};for(let j=0;j<M.length;j++){const q=M[j];for(let ee=0;ee<f.length;ee++){const se=a.getTile(f[ee]);if(!se||!se.hasData()||$(q,se.tileID))continue;const le=this._createProxiedId(q,se,v[q.key]&&v[q.key][a.id]),ae=this.proxyToSource[q.key][a.id];ae?ae.push(le):this.proxyToSource[q.key][a.id]=[le],C.push(le)}}}_createProxiedId(a,f,v){let C=this.orthoMatrix;if(v){const M=v.find(O=>O.key===f.tileID.key);if(M)return M}if(f.tileID.key!==a.key){const M=a.canonical.z-f.tileID.canonical.z;let O,k,B;C=p.create();const $=f.tileID.wrap-a.wrap<<a.overscaledZ;M>0?(O=p.EXTENT>>M,k=O*((f.tileID.canonical.x<<M)-a.canonical.x+$),B=O*((f.tileID.canonical.y<<M)-a.canonical.y)):(O=p.EXTENT<<-M,k=p.EXTENT*(f.tileID.canonical.x-(a.canonical.x+$<<-M)),B=p.EXTENT*(f.tileID.canonical.y-(a.canonical.y<<-M))),p.ortho(C,0,O,0,O,0,1),p.translate(C,C,[k,B,0])}return new gd(f.tileID,a.key,C)}_findTileCoveringTileID(a,f){let v=f.getTile(a);if(v&&v.hasData())return v;const C=this._findCoveringTileCache[f.id],M=C[a.key];if(v=M?f.getTileByID(M):null,v&&v.hasData()||null===M)return v;let O=v?v.tileID:a,k=O.overscaledZ;const B=f.getSource().minzoom,$=[];if(!M){const q=f.getSource().maxzoom;if(a.canonical.z>=q){const ee=a.canonical.z-q;f.getSource().reparseOverscaled?(k=Math.max(a.canonical.z+2,f.transform.tileZoom),O=new p.OverscaledTileID(k,a.wrap,q,a.canonical.x>>ee,a.canonical.y>>ee)):0!==ee&&(k=q,O=new p.OverscaledTileID(k,a.wrap,q,a.canonical.x>>ee,a.canonical.y>>ee))}O.key!==a.key&&($.push(O.key),v=f.getTile(O))}const j=q=>{$.forEach(ee=>{C[ee]=q}),$.length=0};for(k-=1;k>=B&&(!v||!v.hasData());k--){v&&j(v.tileID.key);const q=O.calculateScaledKey(k);if(v=f.getTileByID(q),v&&v.hasData())break;const ee=C[q];if(null===ee)break;void 0===ee?$.push(q):v=f.getTileByID(ee)}return j(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,f){let v=this._tilesDirty[a];v||(v=this._tilesDirty[a]={}),v[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=function(f){let v=0;const C=new p.StructArrayLayout2ui4,M=131;for(let O=1;O<129;O++){for(let k=1;k<129;k++)v=O*M+k,C.emplaceBack(v,v+1),C.emplaceBack(v,v+M),C.emplaceBack(v+1,v+M),128===O&&C.emplaceBack(v+M,v+M+1);C.emplaceBack(v+1,v+1+M)}return C}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class wi{static cacheKey(a,f,v,C){let M=`${f}${C?C.cacheKey:""}`;for(const O of v)a.usedDefines.includes(O)&&(M+=`/${O}`);return M}constructor(a,f,v,C,M,O){const k=a.gl;this.program=k.createProgram();const B=function(X){const oe=[];for(let fe=0;fe<X.length;fe++){if(null===X[fe])continue;const pe=X[fe].split(" ");oe.push(pe.pop())}return oe}(v.staticAttributes),$=C?C.getBinderAttributes():[],j=B.concat($);let q=C?C.defines():[];q=q.concat(O.map(X=>`#define ${X}`));const ee=a.isWebGL2?"#version 300 es\n":"",se=ee+q.concat(a.extStandardDerivatives&&0===ee.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Ms):Ms,Ms,ca,kh.fragmentSource,No.fragmentSource,v.fragmentSource).join("\n"),le=ee+q.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ca,kh.vertexSource,No.vertexSource,fl.vertexSource,v.vertexSource).join("\n"),ae=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(ae,se),k.compileShader(ae),k.attachShader(this.program,ae);const ce=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(ce,le),k.compileShader(ce),k.attachShader(this.program,ce),this.attributes={},this.numAttributes=j.length;for(let X=0;X<this.numAttributes;X++)j[X]&&(k.bindAttribLocation(this.program,X,j[X]),this.attributes[j[X]]=X);k.linkProgram(this.program),k.deleteShader(ce),k.deleteShader(ae),this.fixedUniforms=M(a),this.binderUniforms=C?C.getUniforms(a):[],O.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(X=a),u_dem_prev:new p.Uniform1i(X),u_dem_unpack:new p.Uniform4f(X),u_dem_tl:new p.Uniform2f(X),u_dem_scale:new p.Uniform1f(X),u_dem_tl_prev:new p.Uniform2f(X),u_dem_scale_prev:new p.Uniform1f(X),u_dem_size:new p.Uniform1f(X),u_dem_lerp:new p.Uniform1f(X),u_exaggeration:new p.Uniform1f(X),u_depth:new p.Uniform1i(X),u_depth_size_inv:new p.Uniform2f(X),u_meter_to_dem:new p.Uniform1f(X),u_label_plane_matrix_inv:new p.UniformMatrix4f(X)}),O.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new p.Uniform3f(X),u_tile_tr_up:new p.Uniform3f(X),u_tile_br_up:new p.Uniform3f(X),u_tile_bl_up:new p.Uniform3f(X),u_tile_up_scale:new p.Uniform1f(X)}))(a)),O.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new p.UniformMatrix4f(X),u_fog_range:new p.Uniform2f(X),u_fog_color:new p.Uniform4f(X),u_fog_horizon_blend:new p.Uniform1f(X),u_fog_temporal_offset:new p.Uniform1f(X),u_frustum_tl:new p.Uniform3f(X),u_frustum_tr:new p.Uniform3f(X),u_frustum_br:new p.Uniform3f(X),u_frustum_bl:new p.Uniform3f(X),u_globe_pos:new p.Uniform3f(X),u_globe_radius:new p.Uniform1f(X),u_globe_transition:new p.Uniform1f(X),u_is_globe:new p.Uniform1i(X),u_viewport:new p.Uniform2f(X)}))(a))}var X}setTerrainUniformValues(a,f){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const C in f)v[C]&&v[C].set(this.program,C,f[C])}}setGlobeUniformValues(a,f){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const C in f)v[C]&&v[C].set(this.program,C,f[C])}}setFogUniformValues(a,f){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const C in f)v[C].set(this.program,C,f[C])}}draw(a,f,v,C,M,O,k,B,$,j,q,ee,se,le,ae){const ce=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(v),a.setStencilMode(C),a.setColorMode(M),a.setCullFace(O);for(const oe of Object.keys(this.fixedUniforms))this.fixedUniforms[oe].set(this.program,oe,k[oe]);le&&le.setUniforms(this.program,a,this.binderUniforms,ee,{zoom:se});const X={[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[f];for(const oe of q.get()){const fe=oe.vaos||(oe.vaos={});(fe[B]||(fe[B]=new C_)).bind(a,this,$,le?le.getPaintVertexBuffers():[],j,oe.vertexOffset,ae||[]),ce.drawElements(f,oe.primitiveLength*X,ce.UNSIGNED_SHORT,oe.primitiveOffset*X*2)}}}function mu(_,a){const f=Math.pow(2,a.tileID.overscaledZ),v=a.tileSize*Math.pow(2,_.transform.tileZoom)/f,C=v*(a.tileID.canonical.x+a.tileID.wrap*f),M=v*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_tile_units_to_pixels:1/dr(a,1,_.transform.tileZoom),u_pixel_coord_upper:[C>>16,M>>16],u_pixel_coord_lower:[65535&C,65535&M]}}const Bm=p.create(),Qf=(_,a,f,v,C,M,O,k,B,$,j)=>{const q=a.style.light,ee=q.properties.get("position"),se=[ee.x,ee.y,ee.z],le=p.create$1();"viewport"===q.properties.get("anchor")&&(p.fromRotation(le,-a.transform.angle),p.transformMat3(se,se,le));const ae=q.properties.get("color"),ce=a.transform,X={u_matrix:_,u_lightpos:se,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_vertical_gradient:+f,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Bm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:C,u_edge_radius:M};return"globe"===ce.projection.name&&(X.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],X.u_zoom_transition=B,X.u_inv_rot_matrix=j,X.u_merc_center=$,X.u_up_dir=ce.projection.upVector(new p.CanonicalTileID(0,0,0),$[0]*p.EXTENT,$[1]*p.EXTENT),X.u_height_lift=k),X},D_=(_,a,f,v,C,M,O,k,B,$,j,q)=>{const ee=Qf(_,a,f,v,C,M,O,B,$,j,q),se={u_height_factor:-Math.pow(2,O.overscaledZ)/k.tileSize/8};return p.extend(ee,mu(a,k),se)},gu=_=>({u_matrix:_}),wr=(_,a,f)=>p.extend(gu(_),mu(a,f)),Rv=(_,a)=>({u_matrix:_,u_world:a}),Ov=(_,a,f,v)=>p.extend(wr(_,a,f),{u_world:v}),kv=p.create(),zm=(_,a,f,v,C,M)=>{const O=_.transform,k="globe"===O.projection.name;let B;if("map"===M.paint.get("circle-pitch-alignment"))if(k){const j=p.globePixelsToTileUnits(O.zoom,a.canonical)*O._pixelsPerMercatorPixel;B=Float32Array.from([j,0,0,j])}else B=O.calculatePixelsToTileUnitsMatrix(f);else B=new Float32Array([O.pixelsToGLUnits[0],0,0,O.pixelsToGLUnits[1]]);const $={u_camera_to_center_distance:O.cameraToCenterDistance,u_matrix:_.translatePosMatrix(a.projMatrix,f,M.paint.get("circle-translate"),M.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:B,u_inv_rot_matrix:kv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){$.u_inv_rot_matrix=v,$.u_merc_center=C,$.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],$.u_zoom_transition=p.globeToMercatorTransition(O.zoom);const j=C[0]*p.EXTENT,q=C[1]*p.EXTENT;$.u_up_dir=O.projection.upVector(new p.CanonicalTileID(0,0,0),j,q)}return $},Vm=_=>{const a=[];return"map"===_.paint.get("circle-pitch-alignment")&&a.push("PITCH_WITH_MAP"),"map"===_.paint.get("circle-pitch-scale")&&a.push("SCALE_WITH_MAP"),a},Um=(_,a,f,v)=>{const C=p.EXTENT/f.tileSize;return{u_matrix:_,u_camera_to_center_distance:a.getCameraToCenterDistance(v),u_extrude_scale:[a.pixelsToGLUnits[0]/C,a.pixelsToGLUnits[1]/C]}},ep=(_,a,f=1)=>({u_matrix:_,u_color:a,u_overlay:0,u_overlay_scale:f}),Fh=p.create(),tp=(_,a,f,v,C,M,O)=>{const k=_.transform,B="globe"===k.projection.name,$=B?p.globePixelsToTileUnits(k.zoom,a.canonical)*k._pixelsPerMercatorPixel:dr(f,1,M),j={u_matrix:a.projMatrix,u_extrude_scale:$,u_intensity:O,u_inv_rot_matrix:Fh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){j.u_inv_rot_matrix=v,j.u_merc_center=C,j.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],j.u_zoom_transition=p.globeToMercatorTransition(k.zoom);const q=C[0]*p.EXTENT,ee=C[1]*p.EXTENT;j.u_up_dir=k.projection.upVector(new p.CanonicalTileID(0,0,0),q,ee)}return j},Lv=(_,a,f,v,C,M,O)=>{const k=_.transform,B=k.calculatePixelsToTileUnitsMatrix(a);return{u_matrix:Na(_,a,f,v),u_pixels_to_tile_units:B,u_device_pixel_ratio:M,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:C,u_texsize:bc(f)?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:vc(a,_.transform),u_alpha_discard_threshold:0,u_trim_offset:O}},Nh=(_,a,f,v,C)=>{const M=_.transform;return{u_matrix:Na(_,a,f,v),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:C,u_image:0,u_tile_units_to_pixels:vc(a,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function vc(_,a){return 1/dr(_,1,a.tileZoom)}function Na(_,a,f,v){return _.translatePosMatrix(v||a.tileID.projMatrix,a,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function bc(_){const a=_.paint.get("line-dasharray").value;return a.value||"constant"!==a.kind}const _d=(_,a,f,v,C,M)=>{return{u_matrix:_,u_tl_parent:a,u_scale_parent:f,u_fade_t:v.mix,u_opacity:v.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(k=C.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(O=C.paint.get("raster-contrast"),O>0?1/(1-O):1+O),u_spin_weights:vo(C.paint.get("raster-hue-rotate")),u_perspective_transform:M};var O,k};function vo(_){_*=Math.PI/180;const a=Math.sin(_),f=Math.cos(_);return[(2*f+1)/3,(-Math.sqrt(3)*a-f+1)/3,(Math.sqrt(3)*a-f+1)/3]}const yd=p.create(),np=(_,a,f,v,C,M,O,k,B,$,j,q,ee,se,le,ae)=>{const ce=C.transform,X={u_is_size_zoom_constant:+("constant"===_||"source"===_),u_is_size_feature_constant:+("constant"===_||"camera"===_),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:ce.width/ce.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:O,u_coord_matrix:k,u_is_text:+B,u_pitch_with_map:+v,u_texsize:$,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:yd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:yd,u_up_vector:[0,-1,0]};return"globe"===ae.name&&(X.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],X.u_zoom_transition=q,X.u_inv_rot_matrix=se,X.u_merc_center=ee,X.u_camera_forward=ce._camera.forward(),X.u_ecef_origin=p.globeECEFOrigin(ce.globeMatrix,j.toUnwrapped()),X.u_tile_matrix=Float32Array.from(ce.globeMatrix),X.u_up_vector=le),X},_u=(_,a,f,v,C,M,O,k,B,$,j,q,ee,se,le,ae,ce)=>p.extend(np(_,a,f,v,C,M,O,k,B,$,q,ee,se,le,ae,ce),{u_gamma_scale:v?C.transform.cameraToCenterDistance*Math.cos(C.terrain?0:C.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+j}),Bh=(_,a,f,v,C,M,O,k,B,$,j,q,ee,se,le,ae)=>p.extend(_u(_,a,f,v,C,M,O,k,!0,B,!0,j,q,ee,se,le,ae),{u_texsize_icon:$,u_texture_icon:1}),jm=(_,a,f)=>({u_matrix:_,u_opacity:a,u_color:f}),T_=(_,a,f,v,C)=>p.extend(function(M,O,k){const B=O.imageManager.getPattern(M.toString()),{width:$,height:j}=O.imageManager.getPixelSize(),q=Math.pow(2,k.tileID.overscaledZ),ee=k.tileSize*Math.pow(2,O.transform.tileZoom)/q,se=ee*(k.tileID.canonical.x+k.tileID.wrap*q),le=ee*k.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[$,j],u_pattern_size:B.displaySize,u_tile_units_to_pixels:1/dr(k,1,O.transform.tileZoom),u_pixel_coord_upper:[se>>16,le>>16],u_pixel_coord_lower:[65535&se,65535&le]}}(v,f,C),{u_matrix:_,u_opacity:a}),Is={fillExtrusion:_=>({u_matrix:new p.UniformMatrix4f(_),u_lightpos:new p.Uniform3f(_),u_lightintensity:new p.Uniform1f(_),u_lightcolor:new p.Uniform3f(_),u_vertical_gradient:new p.Uniform1f(_),u_opacity:new p.Uniform1f(_),u_edge_radius:new p.Uniform1f(_),u_ao:new p.Uniform2f(_),u_tile_id:new p.Uniform3f(_),u_zoom_transition:new p.Uniform1f(_),u_inv_rot_matrix:new p.UniformMatrix4f(_),u_merc_center:new p.Uniform2f(_),u_up_dir:new p.Uniform3f(_),u_height_lift:new p.Uniform1f(_)}),fillExtrusionPattern:_=>({u_matrix:new p.UniformMatrix4f(_),u_lightpos:new p.Uniform3f(_),u_lightintensity:new p.Uniform1f(_),u_lightcolor:new p.Uniform3f(_),u_vertical_gradient:new p.Uniform1f(_),u_height_factor:new p.Uniform1f(_),u_edge_radius:new p.Uniform1f(_),u_ao:new p.Uniform2f(_),u_tile_id:new p.Uniform3f(_),u_zoom_transition:new p.Uniform1f(_),u_inv_rot_matrix:new p.UniformMatrix4f(_),u_merc_center:new p.Uniform2f(_),u_up_dir:new p.Uniform3f(_),u_height_lift:new p.Uniform1f(_),u_image:new p.Uniform1i(_),u_texsize:new p.Uniform2f(_),u_pixel_coord_upper:new p.Uniform2f(_),u_pixel_coord_lower:new p.Uniform2f(_),u_tile_units_to_pixels:new p.Uniform1f(_),u_opacity:new p.Uniform1f(_)}),fill:_=>({u_matrix:new p.UniformMatrix4f(_)}),fillPattern:_=>({u_matrix:new p.UniformMatrix4f(_),u_image:new p.Uniform1i(_),u_texsize:new p.Uniform2f(_),u_pixel_coord_upper:new p.Uniform2f(_),u_pixel_coord_lower:new p.Uniform2f(_),u_tile_units_to_pixels:new p.Uniform1f(_)}),fillOutline:_=>({u_matrix:new p.UniformMatrix4f(_),u_world:new p.Uniform2f(_)}),fillOutlinePattern:_=>({u_matrix:new p.UniformMatrix4f(_),u_world:new p.Uniform2f(_),u_image:new p.Uniform1i(_),u_texsize:new p.Uniform2f(_),u_pixel_coord_upper:new p.Uniform2f(_),u_pixel_coord_lower:new p.Uniform2f(_),u_tile_units_to_pixels:new p.Uniform1f(_)}),circle:_=>({u_camera_to_center_distance:new p.Uniform1f(_),u_extrude_scale:new p.UniformMatrix2f(_),u_device_pixel_ratio:new p.Uniform1f(_),u_matrix:new p.UniformMatrix4f(_),u_inv_rot_matrix:new p.UniformMatrix4f(_),u_merc_center:new p.Uniform2f(_),u_tile_id:new p.Uniform3f(_),u_zoom_transition:new p.Uniform1f(_),u_up_dir:new p.Uniform3f(_)}),collisionBox:_=>({u_matrix:new p.UniformMatrix4f(_),u_camera_to_center_distance:new p.Uniform1f(_),u_extrude_scale:new p.Uniform2f(_)}),collisionCircle:_=>({u_matrix:new p.UniformMatrix4f(_),u_inv_matrix:new p.UniformMatrix4f(_),u_camera_to_center_distance:new p.Uniform1f(_),u_viewport_size:new p.Uniform2f(_)}),debug:_=>({u_color:new p.UniformColor(_),u_matrix:new p.UniformMatrix4f(_),u_overlay:new p.Uniform1i(_),u_overlay_scale:new p.Uniform1f(_)}),clippingMask:_=>({u_matrix:new p.UniformMatrix4f(_)}),heatmap:_=>({u_extrude_scale:new p.Uniform1f(_),u_intensity:new p.Uniform1f(_),u_matrix:new p.UniformMatrix4f(_),u_inv_rot_matrix:new p.UniformMatrix4f(_),u_merc_center:new p.Uniform2f(_),u_tile_id:new p.Uniform3f(_),u_zoom_transition:new p.Uniform1f(_),u_up_dir:new p.Uniform3f(_)}),heatmapTexture:_=>({u_image:new p.Uniform1i(_),u_color_ramp:new p.Uniform1i(_),u_opacity:new p.Uniform1f(_)}),hillshade:_=>({u_matrix:new p.UniformMatrix4f(_),u_image:new p.Uniform1i(_),u_latrange:new p.Uniform2f(_),u_light:new p.Uniform2f(_),u_shadow:new p.UniformColor(_),u_highlight:new p.UniformColor(_),u_accent:new p.UniformColor(_)}),hillshadePrepare:_=>({u_matrix:new p.UniformMatrix4f(_),u_image:new p.Uniform1i(_),u_dimension:new p.Uniform2f(_),u_zoom:new p.Uniform1f(_),u_unpack:new p.Uniform4f(_)}),line:_=>({u_matrix:new p.UniformMatrix4f(_),u_pixels_to_tile_units:new p.UniformMatrix2f(_),u_device_pixel_ratio:new p.Uniform1f(_),u_units_to_pixels:new p.Uniform2f(_),u_dash_image:new p.Uniform1i(_),u_gradient_image:new p.Uniform1i(_),u_image_height:new p.Uniform1f(_),u_texsize:new p.Uniform2f(_),u_tile_units_to_pixels:new p.Uniform1f(_),u_alpha_discard_threshold:new p.Uniform1f(_),u_trim_offset:new p.Uniform2f(_)}),linePattern:_=>({u_matrix:new p.UniformMatrix4f(_),u_texsize:new p.Uniform2f(_),u_pixels_to_tile_units:new p.UniformMatrix2f(_),u_device_pixel_ratio:new p.Uniform1f(_),u_image:new p.Uniform1i(_),u_units_to_pixels:new p.Uniform2f(_),u_tile_units_to_pixels:new p.Uniform1f(_),u_alpha_discard_threshold:new p.Uniform1f(_)}),raster:_=>({u_matrix:new p.UniformMatrix4f(_),u_tl_parent:new p.Uniform2f(_),u_scale_parent:new p.Uniform1f(_),u_fade_t:new p.Uniform1f(_),u_opacity:new p.Uniform1f(_),u_image0:new p.Uniform1i(_),u_image1:new p.Uniform1i(_),u_brightness_low:new p.Uniform1f(_),u_brightness_high:new p.Uniform1f(_),u_saturation_factor:new p.Uniform1f(_),u_contrast_factor:new p.Uniform1f(_),u_spin_weights:new p.Uniform3f(_),u_perspective_transform:new p.Uniform2f(_)}),symbolIcon:_=>({u_is_size_zoom_constant:new p.Uniform1i(_),u_is_size_feature_constant:new p.Uniform1i(_),u_size_t:new p.Uniform1f(_),u_size:new p.Uniform1f(_),u_camera_to_center_distance:new p.Uniform1f(_),u_rotate_symbol:new p.Uniform1i(_),u_aspect_ratio:new p.Uniform1f(_),u_fade_change:new p.Uniform1f(_),u_matrix:new p.UniformMatrix4f(_),u_label_plane_matrix:new p.UniformMatrix4f(_),u_coord_matrix:new p.UniformMatrix4f(_),u_is_text:new p.Uniform1i(_),u_pitch_with_map:new p.Uniform1i(_),u_texsize:new p.Uniform2f(_),u_tile_id:new p.Uniform3f(_),u_zoom_transition:new p.Uniform1f(_),u_inv_rot_matrix:new p.UniformMatrix4f(_),u_merc_center:new p.Uniform2f(_),u_camera_forward:new p.Uniform3f(_),u_tile_matrix:new p.UniformMatrix4f(_),u_up_vector:new p.Uniform3f(_),u_ecef_origin:new p.Uniform3f(_),u_texture:new p.Uniform1i(_)}),symbolSDF:_=>({u_is_size_zoom_constant:new p.Uniform1i(_),u_is_size_feature_constant:new p.Uniform1i(_),u_size_t:new p.Uniform1f(_),u_size:new p.Uniform1f(_),u_camera_to_center_distance:new p.Uniform1f(_),u_rotate_symbol:new p.Uniform1i(_),u_aspect_ratio:new p.Uniform1f(_),u_fade_change:new p.Uniform1f(_),u_matrix:new p.UniformMatrix4f(_),u_label_plane_matrix:new p.UniformMatrix4f(_),u_coord_matrix:new p.UniformMatrix4f(_),u_is_text:new p.Uniform1i(_),u_pitch_with_map:new p.Uniform1i(_),u_texsize:new p.Uniform2f(_),u_texture:new p.Uniform1i(_),u_gamma_scale:new p.Uniform1f(_),u_device_pixel_ratio:new p.Uniform1f(_),u_tile_id:new p.Uniform3f(_),u_zoom_transition:new p.Uniform1f(_),u_inv_rot_matrix:new p.UniformMatrix4f(_),u_merc_center:new p.Uniform2f(_),u_camera_forward:new p.Uniform3f(_),u_tile_matrix:new p.UniformMatrix4f(_),u_up_vector:new p.Uniform3f(_),u_ecef_origin:new p.Uniform3f(_),u_is_halo:new p.Uniform1i(_)}),symbolTextAndIcon:_=>({u_is_size_zoom_constant:new p.Uniform1i(_),u_is_size_feature_constant:new p.Uniform1i(_),u_size_t:new p.Uniform1f(_),u_size:new p.Uniform1f(_),u_camera_to_center_distance:new p.Uniform1f(_),u_rotate_symbol:new p.Uniform1i(_),u_aspect_ratio:new p.Uniform1f(_),u_fade_change:new p.Uniform1f(_),u_matrix:new p.UniformMatrix4f(_),u_label_plane_matrix:new p.UniformMatrix4f(_),u_coord_matrix:new p.UniformMatrix4f(_),u_is_text:new p.Uniform1i(_),u_pitch_with_map:new p.Uniform1i(_),u_texsize:new p.Uniform2f(_),u_texsize_icon:new p.Uniform2f(_),u_texture:new p.Uniform1i(_),u_texture_icon:new p.Uniform1i(_),u_gamma_scale:new p.Uniform1f(_),u_device_pixel_ratio:new p.Uniform1f(_),u_is_halo:new p.Uniform1i(_)}),background:_=>({u_matrix:new p.UniformMatrix4f(_),u_opacity:new p.Uniform1f(_),u_color:new p.UniformColor(_)}),backgroundPattern:_=>({u_matrix:new p.UniformMatrix4f(_),u_opacity:new p.Uniform1f(_),u_image:new p.Uniform1i(_),u_pattern_tl:new p.Uniform2f(_),u_pattern_br:new p.Uniform2f(_),u_texsize:new p.Uniform2f(_),u_pattern_size:new p.Uniform2f(_),u_pixel_coord_upper:new p.Uniform2f(_),u_pixel_coord_lower:new p.Uniform2f(_),u_tile_units_to_pixels:new p.Uniform1f(_)}),terrainRaster:Ul,terrainDepth:Ul,skybox:_=>({u_matrix:new p.UniformMatrix4f(_),u_sun_direction:new p.Uniform3f(_),u_cubemap:new p.Uniform1i(_),u_opacity:new p.Uniform1f(_),u_temporal_offset:new p.Uniform1f(_)}),skyboxGradient:_=>({u_matrix:new p.UniformMatrix4f(_),u_color_ramp:new p.Uniform1i(_),u_center_direction:new p.Uniform3f(_),u_radius:new p.Uniform1f(_),u_opacity:new p.Uniform1f(_),u_temporal_offset:new p.Uniform1f(_)}),skyboxCapture:_=>({u_matrix_3f:new p.UniformMatrix3f(_),u_sun_direction:new p.Uniform3f(_),u_sun_intensity:new p.Uniform1f(_),u_color_tint_r:new p.Uniform4f(_),u_color_tint_m:new p.Uniform4f(_),u_luminance:new p.Uniform1f(_)}),globeRaster:_=>({u_proj_matrix:new p.UniformMatrix4f(_),u_globe_matrix:new p.UniformMatrix4f(_),u_normalize_matrix:new p.UniformMatrix4f(_),u_merc_matrix:new p.UniformMatrix4f(_),u_zoom_transition:new p.Uniform1f(_),u_merc_center:new p.Uniform2f(_),u_image0:new p.Uniform1i(_),u_grid_matrix:new p.UniformMatrix3f(_),u_skirt_height:new p.Uniform1f(_),u_frustum_tl:new p.Uniform3f(_),u_frustum_tr:new p.Uniform3f(_),u_frustum_br:new p.Uniform3f(_),u_frustum_bl:new p.Uniform3f(_),u_globe_pos:new p.Uniform3f(_),u_globe_radius:new p.Uniform1f(_),u_viewport:new p.Uniform2f(_)}),globeAtmosphere:_=>({u_frustum_tl:new p.Uniform3f(_),u_frustum_tr:new p.Uniform3f(_),u_frustum_br:new p.Uniform3f(_),u_frustum_bl:new p.Uniform3f(_),u_horizon:new p.Uniform1f(_),u_transition:new p.Uniform1f(_),u_fadeout_range:new p.Uniform1f(_),u_color:new p.Uniform4f(_),u_high_color:new p.Uniform4f(_),u_space_color:new p.Uniform4f(_),u_star_intensity:new p.Uniform1f(_),u_star_density:new p.Uniform1f(_),u_star_size:new p.Uniform1f(_),u_temporal_offset:new p.Uniform1f(_),u_horizon_angle:new p.Uniform1f(_),u_rotation_matrix:new p.UniformMatrix4f(_)})};let ml;function Lr(_,a,f,v,C,M,O){const k=_.context,B=k.gl,$=_.transform,j=_.useProgram("collisionBox"),q=[];let ee=0,se=0;for(let pe=0;pe<v.length;pe++){const Te=v[pe],De=a.getTile(Te),Me=De.getBucket(f);if(!Me)continue;const ze=as(Te,Me,$);let Oe=ze;0===C[0]&&0===C[1]||(Oe=_.translatePosMatrix(ze,De,C,M));const Xe=O?Me.textCollisionBox:Me.iconCollisionBox,At=Me.collisionCircleArray;if(At.length>0){const Ve=p.create(),ht=Oe;p.mul(Ve,Me.placementInvProjMatrix,$.glCoordMatrix),p.mul(Ve,Ve,Me.placementViewportMatrix),q.push({circleArray:At,circleOffset:se,transform:ht,invTransform:Ve,projection:Me.getProjection()}),ee+=At.length/4,se=ee}Xe&&(_.terrain&&_.terrain.setupElevationDraw(De,j),j.draw(k,B.LINES,p.DepthMode.disabled,p.StencilMode.disabled,_.colorModeForRenderPass(),p.CullFaceMode.disabled,Um(Oe,$,De,Me.getProjection()),f.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,null,$.zoom,null,[Xe.collisionVertexBuffer,Xe.collisionVertexBufferExt]))}if(!O||!q.length)return;const le=_.useProgram("collisionCircle"),ae=new p.StructArrayLayout2f1f2i16;ae.resize(4*ee),ae._trim();let ce=0;for(const pe of q)for(let Te=0;Te<pe.circleArray.length/4;Te++){const De=4*Te,Me=pe.circleArray[De+0],ze=pe.circleArray[De+1],Oe=pe.circleArray[De+2],Xe=pe.circleArray[De+3];ae.emplace(ce++,Me,ze,Oe,Xe,0),ae.emplace(ce++,Me,ze,Oe,Xe,1),ae.emplace(ce++,Me,ze,Oe,Xe,2),ae.emplace(ce++,Me,ze,Oe,Xe,3)}(!ml||ml.length<2*ee)&&(ml=function(pe){const Te=2*pe,De=new p.StructArrayLayout3ui6;De.resize(Te),De._trim();for(let Me=0;Me<Te;Me++){const ze=6*Me;De.uint16[ze+0]=4*Me+0,De.uint16[ze+1]=4*Me+1,De.uint16[ze+2]=4*Me+2,De.uint16[ze+3]=4*Me+2,De.uint16[ze+4]=4*Me+3,De.uint16[ze+5]=4*Me+0}return De}(ee));const X=k.createIndexBuffer(ml,!0),oe=k.createVertexBuffer(ae,p.collisionCircleLayout.members,!0);for(const pe of q){const Te={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(fe=$).getCameraToCenterDistance(pe.projection),u_viewport_size:[fe.width,fe.height]};le.draw(k,B.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,_.colorModeForRenderPass(),p.CullFaceMode.disabled,Te,f.id,oe,X,p.SegmentVector.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,$.zoom)}var fe;oe.destroy(),X.destroy()}const vd=p.create();function ip({width:_,height:a,anchor:f,textOffset:v,textScale:C},M){const{horizontalAlign:O,verticalAlign:k}=p.getAnchorAlignment(f),B=-(O-.5)*_,$=-(k-.5)*a,j=p.evaluateVariableOffset(f,v);return new p.Point((B/C+j[0])*M,($/C+j[1])*M)}function rp(_,a,f,v,C,M,O,k,B,$,j){const q=_.text.placedSymbolArray,ee=_.text.dynamicLayoutVertexArray,se=_.icon.dynamicLayoutVertexArray,le={},ae=_.getProjection(),ce=Qi(k,ae,M),X=M.elevation,oe=ae.upVectorScale(k.canonical,M.center.lat,M.worldSize).metersToTile;ee.clear();for(let fe=0;fe<q.length;fe++){const pe=q.get(fe),{tileAnchorX:Te,tileAnchorY:De,numGlyphs:Me}=pe,ze=pe.hidden||!pe.crossTileID||_.allowVerticalPlacement&&!pe.placedOrientation?null:v[pe.crossTileID];if(ze){let Oe=0,Xe=0,At=0;if(X){const Ct=X?X.getAtTileOffset(k,Te,De):0,[vn,Rn,sn]=ae.upVector(k.canonical,Te,De);Oe=Ct*vn*oe,Xe=Ct*Rn*oe,At=Ct*sn*oe}let[Ve,ht,tt,_t]=mr(pe.projectedAnchorX+Oe,pe.projectedAnchorY+Xe,pe.projectedAnchorZ+At,f?ce:O);const He=_c(M.getCameraToCenterDistance(ae),_t);let ct=C.evaluateSizeForFeature(_.textSizeData,$,pe)*He/p.ONE_EM;f&&(ct*=_.tilePixelRatio/B);const Lt=ip(ze,ct);f?(({x:Ve,y:ht,z:tt}=ae.projectTilePoint(Te+Lt.x,De+Lt.y,k.canonical)),[Ve,ht,tt]=mr(Ve+Oe,ht+Xe,tt+At,O)):(a&&Lt._rotate(-M.angle),Ve+=Lt.x,ht+=Lt.y,tt=0);const ft=_.allowVerticalPlacement&&pe.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let Ct=0;Ct<Me;Ct++)p.addDynamicAttributes(ee,Ve,ht,tt,ft);j&&pe.associatedIconIndex>=0&&(le[pe.associatedIconIndex]={x:Ve,y:ht,z:tt,angle:ft})}else ss(Me,ee)}if(j){se.clear();const fe=_.icon.placedSymbolArray;for(let pe=0;pe<fe.length;pe++){const Te=fe.get(pe),{numGlyphs:De}=Te,Me=le[pe];if(Te.hidden||!Me)ss(De,se);else{const{x:ze,y:Oe,z:Xe,angle:At}=Me;for(let Ve=0;Ve<De;Ve++)p.addDynamicAttributes(se,ze,Oe,Xe,At)}}_.icon.dynamicLayoutVertexBuffer.updateData(se)}_.text.dynamicLayoutVertexBuffer.updateData(ee)}function bd(_,a,f){return f.iconsInText&&a?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function xd(_,a,f,v,C,M,O,k,B,$,j,q){const ee=_.context,se=ee.gl,le=_.transform,ae="map"===k,ce="map"===B,X=ae&&"point"!==f.layout.get("symbol-placement"),oe=ae&&!ce&&!X,fe=void 0!==f.layout.get("symbol-sort-key").constantOr(1);let pe=!1;const Te=_.depthModeForSublayer(0,p.DepthMode.ReadOnly),De=[p.mercatorXfromLng(le.center.lng),p.mercatorYfromLat(le.center.lat)],Me=f.layout.get("text-variable-anchor"),ze="globe"===le.projection.name,Oe=[],Xe=[0,-1,0];let At=Xe;!ze&&!le.mercatorFromTransition||ae||(At=function(Ve){const ht=Ve._camera.getWorldToCamera(Ve.worldSize,1),tt=p.multiply([],ht,Ve.globeMatrix);p.invert(tt,tt);const _t=[0,0,0],He=[0,1,0,0];return p.transformMat4$1(He,He,tt),_t[0]=He[0],_t[1]=He[1],_t[2]=He[2],p.normalize(_t,_t),_t}(le));for(const Ve of v){const ht=a.getTile(Ve),tt=ht.getBucket(f);if(!tt||"mercator"===tt.projection.name&&ze)continue;const _t=C?tt.text:tt.icon;if(!_t||tt.fullyClipped||!_t.segments.get().length)continue;const He=_t.programConfigurations.get(f.id),ct=C||tt.sdfIcons,Lt=C?tt.textSizeData:tt.iconSizeData,ft=ce||0!==le.pitch,Ct=p.evaluateSizeForZoom(Lt,le.zoom);let vn,Rn,sn,bn,Kn=[0,0],Mn=null;if(C)Rn=ht.glyphAtlasTexture,sn=se.LINEAR,vn=ht.glyphAtlasTexture.size,tt.iconsInText&&(Kn=ht.imageAtlasTexture.size,Mn=ht.imageAtlasTexture,bn=ft||_.options.rotating||_.options.zooming||"composite"===Lt.kind||"camera"===Lt.kind?se.LINEAR:se.NEAREST);else{const Ua=1!==f.layout.get("icon-size").constantOr(0)||tt.iconsNeedLinear;Rn=ht.imageAtlasTexture,sn=ct||_.options.rotating||_.options.zooming||Ua||ft?se.LINEAR:se.NEAREST,vn=ht.imageAtlasTexture.size}const an="globe"===tt.projection.name,Ai=an?At:Xe,ii=an?p.globeToMercatorTransition(le.zoom):0,Gi=Qi(Ve,tt.getProjection(),le),ki=le.calculatePixelsToTileUnitsMatrix(ht),Sr=lt(Gi,ht.tileID.canonical,ce,ae,le,tt.getProjection(),ki),$r=_.terrain&&ce&&X?p.invert(p.create(),Sr):vd,zn=Ji(Gi,ht.tileID.canonical,ce,ae,le,tt.getProjection(),ki),Co=Me&&tt.hasTextData(),Li="none"!==f.layout.get("icon-text-fit")&&Co&&tt.hasIconData();if(X){const Ua=le.elevation,Zl=Ua?Ua.getAtTileOffsetFunc(Ve,le.center.lat,le.worldSize,tt.getProjection()):null,ql=Ds(Gi,ht.tileID.canonical,ce,ae,le,tt.getProjection(),ki);fd(tt,Gi,_,C,ql,zn,ce,$,Zl,Ve)}const gi=X||C&&Me||Li,_i=_.translatePosMatrix(Gi,ht,M,O),Ir=gi?vd:Sr,lr=_.translatePosMatrix(zn,ht,M,O,!0),Pi=tt.getProjection().createInversionMatrix(le,Ve.canonical),Qo=[];_.terrainRenderModeElevated()&&ce&&Qo.push("PITCH_WITH_MAP_TERRAIN"),an&&Qo.push("PROJECTION_GLOBE_VIEW"),gi&&Qo.push("PROJECTED_POS_ON_VIEWPORT");const Xs=ct&&0!==f.paint.get(C?"text-halo-width":"icon-halo-width").constantOr(1);let Oc;Oc=ct?tt.iconsInText?Bh(Lt.kind,Ct,oe,ce,_,_i,Ir,lr,vn,Kn,Ve,ii,De,Pi,Ai,tt.getProjection()):_u(Lt.kind,Ct,oe,ce,_,_i,Ir,lr,C,vn,!0,Ve,ii,De,Pi,Ai,tt.getProjection()):np(Lt.kind,Ct,oe,ce,_,_i,Ir,lr,C,vn,Ve,ii,De,Pi,Ai,tt.getProjection());const Su={program:_.useProgram(bd(ct,C,tt),He,Qo),buffers:_t,uniformValues:Oc,atlasTexture:Rn,atlasTextureIcon:Mn,atlasInterpolation:sn,atlasInterpolationIcon:bn,isSDF:ct,hasHalo:Xs,tile:ht,labelPlaneMatrixInv:$r};if(fe&&tt.canOverlap){pe=!0;const Ua=_t.segments.get();for(const Zl of Ua)Oe.push({segments:new p.SegmentVector([Zl]),sortKey:Zl.sortKey,state:Su})}else Oe.push({segments:_t.segments,sortKey:0,state:Su})}pe&&Oe.sort((Ve,ht)=>Ve.sortKey-ht.sortKey);for(const Ve of Oe){const ht=Ve.state;if(_.terrain&&_.terrain.setupElevationDraw(ht.tile,ht.program,{useDepthForOcclusion:!ze,labelPlaneMatrixInv:ht.labelPlaneMatrixInv}),ee.activeTexture.set(se.TEXTURE0),ht.atlasTexture.bind(ht.atlasInterpolation,se.CLAMP_TO_EDGE),ht.atlasTextureIcon&&(ee.activeTexture.set(se.TEXTURE1),ht.atlasTextureIcon&&ht.atlasTextureIcon.bind(ht.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),ht.isSDF){const tt=ht.uniformValues;ht.hasHalo&&(tt.u_is_halo=1,wd(ht.buffers,Ve.segments,f,_,ht.program,Te,j,q,tt)),tt.u_is_halo=0}wd(ht.buffers,Ve.segments,f,_,ht.program,Te,j,q,ht.uniformValues)}}function wd(_,a,f,v,C,M,O,k,B){const $=v.context,j=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.globeExtVertexBuffer];C.draw($,$.gl.TRIANGLES,M,O,k,p.CullFaceMode.disabled,B,f.id,_.layoutVertexBuffer,_.indexBuffer,a,f.paint,v.transform.zoom,_.programConfigurations.get(f.id),j)}function $m(_,a,f,v,C,M,O){const k=_.context.gl,B=f.paint.get("fill-pattern"),$=B&&B.constantOr(1);let j,q,ee,se,le;O?(q=$&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=k.LINES):(q=$?"fillPattern":"fill",j=k.TRIANGLES);for(const ae of v){const ce=a.getTile(ae);if($&&!ce.patternsLoaded())continue;const X=ce.getBucket(f);if(!X)continue;_.prepareDrawTile();const oe=X.programConfigurations.get(f.id),fe=_.useProgram(q,oe);$&&(_.context.activeTexture.set(k.TEXTURE0),ce.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),oe.updatePaintBuffers());const pe=B.constantOr(null);if(pe&&ce.imageAtlas){const De=ce.imageAtlas.patternPositions[pe.toString()];De&&oe.setConstantPatternPositions(De)}const Te=_.translatePosMatrix(ae.projMatrix,ce,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(O){se=X.indexBuffer2,le=X.segments2;const De=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];ee="fillOutlinePattern"===q&&$?Ov(Te,_,ce,De):Rv(Te,De)}else se=X.indexBuffer,le=X.segments,ee=$?wr(Te,_,ce):gu(Te);_.prepareDrawProgram(_.context,fe,ae.toUnwrapped()),fe.draw(_.context,j,C,_.stencilModeForClipping(ae),M,p.CullFaceMode.disabled,ee,f.id,X.layoutVertexBuffer,se,le,f.paint,_.transform.zoom,oe)}}function yu(_,a,f,v,C,M,O){const k=_.context,B=k.gl,$=_.transform,j=f.paint.get("fill-extrusion-pattern"),q=j.constantOr(1),ee=f.paint.get("fill-extrusion-opacity"),se=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),f.paint.get("fill-extrusion-ambient-occlusion-radius")],le=f.layout.get("fill-extrusion-edge-radius"),ae=le>0&&!f.paint.get("fill-extrusion-rounded-roof"),ce=ae?0:le,X="globe"===$.projection.name?p.fillExtrusionHeightLift():0,oe="globe"===$.projection.name,fe=oe?p.globeToMercatorTransition($.zoom):0,pe=[p.mercatorXfromLng($.center.lng),p.mercatorYfromLat($.center.lat)],Te=[];oe&&Te.push("PROJECTION_GLOBE_VIEW"),se[0]>0&&Te.push("FAUX_AO"),ae&&Te.push("ZERO_ROOF_RADIUS");for(const De of v){const Me=a.getTile(De),ze=Me.getBucket(f);if(!ze||ze.projection.name!==$.projection.name)continue;const Oe=ze.programConfigurations.get(f.id),Xe=_.useProgram(q?"fillExtrusionPattern":"fillExtrusion",Oe,Te);if(_.terrain){const ct=_.terrain;if(_.style.terrainSetForDrapingOnly())ct.setupElevationDraw(Me,Xe,{useMeterToDem:!0});else{if(!ze.enableTerrain)continue;if(ct.setupElevationDraw(Me,Xe,{useMeterToDem:!0}),zh(k,a,De,ze,f,ct),!ze.centroidVertexBuffer){const Lt=Xe.attributes.a_centroid_pos;void 0!==Lt&&B.vertexAttrib2f(Lt,0,0)}}}q&&(_.context.activeTexture.set(B.TEXTURE0),Me.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Oe.updatePaintBuffers());const At=j.constantOr(null);if(At&&Me.imageAtlas){const ct=Me.imageAtlas.patternPositions[At.toString()];ct&&Oe.setConstantPatternPositions(ct)}const Ve=_.translatePosMatrix(De.projMatrix,Me,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),ht=$.projection.createInversionMatrix($,De.canonical),tt=f.paint.get("fill-extrusion-vertical-gradient"),_t=q?D_(Ve,_,tt,ee,se,ce,De,Me,X,fe,pe,ht):Qf(Ve,_,tt,ee,se,ce,De,X,fe,pe,ht);_.prepareDrawProgram(k,Xe,De.toUnwrapped());const He=[];_.terrain&&He.push(ze.centroidVertexBuffer),oe&&He.push(ze.layoutVertexExtBuffer),Xe.draw(k,k.gl.TRIANGLES,C,M,O,p.CullFaceMode.backCCW,_t,f.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,f.paint,_.transform.zoom,Oe,He)}}function zh(_,a,f,v,C,M){const O=[X=>{let oe=X.canonical.x-1,fe=X.wrap;return oe<0&&(oe=(1<<X.canonical.z)-1,fe--),new p.OverscaledTileID(X.overscaledZ,fe,X.canonical.z,oe,X.canonical.y)},X=>{let oe=X.canonical.x+1,fe=X.wrap;return oe===1<<X.canonical.z&&(oe=0,fe++),new p.OverscaledTileID(X.overscaledZ,fe,X.canonical.z,oe,X.canonical.y)},X=>new p.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,(0===X.canonical.y?1<<X.canonical.z:X.canonical.y)-1),X=>new p.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y===(1<<X.canonical.z)-1?0:X.canonical.y+1)],k=X=>{const oe=a.getSource().minzoom,fe=Te=>{const De=a.getTileByID(Te);if(De&&De.hasData())return De.getBucket(C)},pe=[0,-1,1];for(const Te of pe){if(X.overscaledZ+Te<oe)continue;const De=fe(X.calculateScaledKey(X.overscaledZ+Te));if(De)return De}},B=[0,0,0],$=(X,oe)=>(B[0]=Math.min(X.min.y,oe.min.y),B[1]=Math.max(X.max.y,oe.max.y),B[2]=p.EXTENT-oe.min.x>X.max.x?oe.min.x-p.EXTENT:X.max.x,B),j=(X,oe)=>(B[0]=Math.min(X.min.x,oe.min.x),B[1]=Math.max(X.max.x,oe.max.x),B[2]=p.EXTENT-oe.min.y>X.max.y?oe.min.y-p.EXTENT:X.max.y,B),q=[(X,oe)=>$(X,oe),(X,oe)=>$(oe,X),(X,oe)=>j(X,oe),(X,oe)=>j(oe,X)],ee=new p.Point(0,0);let se,le,ae;const ce=(X,oe,fe,pe,Te)=>{const De=[[pe?fe:X,pe?X:fe,0],[pe?fe:oe,pe?oe:fe,0]],Me=Te<0?p.EXTENT+Te:Te,ze=[pe?Me:(X+oe)/2,pe?(X+oe)/2:Me,0];return 0===fe&&Te<0||0!==fe&&Te>0?M.getForTilePoints(ae,[ze],!0,le):De.push(ze),M.getForTilePoints(f,De,!0,se),Math.max(De[0][2],De[1][2],ze[2])/M.exaggeration()};for(let X=0;X<4;X++){const oe=(X<2?1:5)-X,fe=v.borders[X];if(0===fe.length)continue;const pe=ae=O[X](f),Te=k(pe);if(!(Te&&Te instanceof p.FillExtrusionBucket&&Te.enableTerrain)||v.borderDoneWithNeighborZ[X]===Te.canonical.z&&Te.borderDoneWithNeighborZ[oe]===v.canonical.z||(le=M.findDEMTileFor(pe),!le||!le.dem))continue;if(!se){const Oe=M.findDEMTileFor(f);if(!Oe||!Oe.dem)return;se=Oe}const De=Te.borders[oe];let Me=0;const ze=Te.borderDoneWithNeighborZ[oe]!==v.canonical.z;if(v.canonical.z===Te.canonical.z){for(let Oe=0;Oe<fe.length;Oe++){const Xe=v.featuresOnBorder[fe[Oe]],At=Xe.borders[X];let Ve;for(;Me<De.length&&(Ve=Te.featuresOnBorder[De[Me]],!(Ve.borders[oe][1]>At[0]+3));)ze&&Te.encodeCentroid(void 0,Ve,!1),Me++;if(Ve&&Me<De.length){const ht=Me;let tt=0;for(;!(Ve.borders[oe][0]>At[1]-3)&&(tt++,++Me!==De.length);)Ve=Te.featuresOnBorder[De[Me]];if(Ve=Te.featuresOnBorder[De[ht]],Xe.intersectsCount()>1||Ve.intersectsCount()>1||1!==tt){1!==tt&&(Me=ht),v.encodeCentroid(void 0,Xe,!1),ze&&Te.encodeCentroid(void 0,Ve,!1);continue}const _t=q[X](Xe,Ve),He=X%2?p.EXTENT-1:0;ee.x=ce(_t[0],Math.min(p.EXTENT-1,_t[1]),He,X<2,_t[2]),ee.y=0,v.encodeCentroid(ee,Xe,!1),ze&&Te.encodeCentroid(ee,Ve,!1)}else v.encodeCentroid(void 0,Xe,!1)}v.borderDoneWithNeighborZ[X]=Te.canonical.z,v.needsCentroidUpdate=!0,ze&&(Te.borderDoneWithNeighborZ[oe]=v.canonical.z,Te.needsCentroidUpdate=!0)}else{for(const Oe of fe)v.encodeCentroid(void 0,v.featuresOnBorder[Oe],!1);if(ze){for(const Oe of De)Te.encodeCentroid(void 0,Te.featuresOnBorder[Oe],!1);Te.borderDoneWithNeighborZ[oe]=v.canonical.z,Te.needsCentroidUpdate=!0}v.borderDoneWithNeighborZ[X]=Te.canonical.z,v.needsCentroidUpdate=!0}}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&0!==v.centroidVertexArray.length)&&v.uploadCentroid(_)}const xc=new p.Color(1,0,0,1),Ed=new p.Color(0,1,0,1),M_=new p.Color(0,0,1,1),S_=new p.Color(1,0,1,1),Fv=new p.Color(0,1,1,1);function I_(_,a,f){const v=_.context,C=_.transform,M=v.gl,O="globe"===C.projection.name,k=O?["PROJECTION_GLOBE_VIEW"]:null;let B=f.projMatrix;if(O&&p.globeToMercatorTransition(C.zoom)>0){const Xe=p.transitionTileAABBinECEF(f.canonical,C),At=p.globeDenormalizeECEF(Xe);B=p.multiply(new Float32Array(16),C.globeMatrix,At),p.multiply(B,C.projMatrix,B)}const $=_.useProgram("debug",null,k),j=a.getTileByID(f.key);_.terrain&&_.terrain.setupElevationDraw(j,$);const q=p.DepthMode.disabled,ee=p.StencilMode.disabled,se=_.colorModeForRenderPass();v.activeTexture.set(M.TEXTURE0),_.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),O?j._makeGlobeTileDebugBuffers(_.context,C):j._makeDebugTileBoundsBuffers(_.context,C.projection);const ae=j._tileDebugBuffer||_.debugBuffer,ce=j._tileDebugIndexBuffer||_.debugIndexBuffer,X=j._tileDebugSegments||_.debugSegments;$.draw(v,M.LINE_STRIP,q,ee,se,p.CullFaceMode.disabled,ep(B,p.Color.red),"$debug",ae,ce,X,null,null,null,[j._globeTileDebugBorderBuffer]);const oe=j.latestRawTileData,fe=Math.floor((oe&&oe.byteLength||0)/1024),pe=a.getTile(f).tileSize,Te=512/Math.min(pe,512)*(f.overscaledZ/C.zoom)*.5;let De=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(De+=` => ${f.overscaledZ}`),De+=` ${fe}kb`,function(Xe,At){Xe.initDebugOverlayCanvas();const Ve=Xe.debugOverlayCanvas,ht=Xe.context.gl,tt=Xe.debugOverlayCanvas.getContext("2d");tt.clearRect(0,0,Ve.width,Ve.height),tt.shadowColor="white",tt.shadowBlur=2,tt.lineWidth=1.5,tt.strokeStyle="white",tt.textBaseline="top",tt.font="bold 36px Open Sans, sans-serif",tt.fillText(At,5,5),tt.strokeText(At,5,5),Xe.debugOverlayTexture.update(Ve),Xe.debugOverlayTexture.bind(ht.LINEAR,ht.CLAMP_TO_EDGE)}(_,De);const Me=j._tileDebugTextBuffer||_.debugBuffer,ze=j._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,Oe=j._tileDebugTextSegments||_.debugSegments;$.draw(v,M.TRIANGLES,q,ee,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,ep(B,p.Color.transparent,Te),"$debug",Me,ze,Oe,null,null,null,[j._globeTileDebugTextBuffer])}function op(_,a,f,v){vu(_,0,a+f/2,_.transform.width,f,v)}function Vh(_,a,f,v){vu(_,a-f/2,0,f,_.transform.height,v)}function vu(_,a,f,v,C,M){const O=_.context,k=O.gl;k.enable(k.SCISSOR_TEST),k.scissor(a*p.exported.devicePixelRatio,f*p.exported.devicePixelRatio,v*p.exported.devicePixelRatio,C*p.exported.devicePixelRatio),O.clear({color:M}),k.disable(k.SCISSOR_TEST)}const Uh=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:sp}=Uh;function gl(_,a,f,v){_.emplaceBack(a,f,v)}class $l{constructor(a){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,gl(this.vertexArray,-1,-1,1),gl(this.vertexArray,1,-1,1),gl(this.vertexArray,-1,1,1),gl(this.vertexArray,1,1,1),gl(this.vertexArray,-1,-1,-1),gl(this.vertexArray,1,-1,-1),gl(this.vertexArray,-1,1,-1),gl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,sp),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function As(_,a,f,v,C,M){const O=_.gl,k=a.paint.get("sky-atmosphere-color"),B=a.paint.get("sky-atmosphere-halo-color"),$=a.paint.get("sky-atmosphere-sun-intensity"),j={u_matrix_3f:p.fromMat4(p.create$1(),v),u_sun_direction:C,u_sun_intensity:$,u_color_tint_r:[(le=k).r,le.g,le.b,le.a],u_color_tint_m:[(ae=B).r,ae.g,ae.b,ae.a],u_luminance:5e-5};var le,ae;O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+M,a.skyboxTexture,0),f.draw(_,O.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,j,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const wc=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Cd{constructor(a){const f=new p.StructArrayLayout5f20;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const v=new p.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(f,wc.members),this.indexBuffer=a.createIndexBuffer(v),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ls={symbol:function(_,a,f,v,C){if("translucent"!==_.renderPass)return;const M=p.StencilMode.disabled,O=_.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(k,B,$,j,q,ee,se){const le=B.transform,ae="map"===q,ce="map"===ee;for(const X of k){const oe=j.getTile(X),fe=oe.getBucket($);if(!fe||!fe.text||!fe.text.segments.get().length)continue;const pe=p.evaluateSizeForZoom(fe.textSizeData,le.zoom),Te=Qi(X,fe.getProjection(),le),De=le.calculatePixelsToTileUnitsMatrix(oe),Me=lt(Te,oe.tileID.canonical,ce,ae,le,fe.getProjection(),De),ze="none"!==$.layout.get("icon-text-fit")&&fe.hasIconData();if(pe){const Oe=Math.pow(2,le.zoom-oe.tileID.overscaledZ);rp(fe,ae,ce,se,p.symbolSize,le,Me,X,Oe,pe,ze)}}}(v,_,f,a,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),C),0!==f.paint.get("icon-opacity").constantOr(1)&&xd(_,a,f,v,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),M,O),0!==f.paint.get("text-opacity").constantOr(1)&&xd(_,a,f,v,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),M,O),a.map.showCollisionBoxes&&(Lr(_,a,f,v,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),Lr(_,a,f,v,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(_,a,f,v){if("translucent"!==_.renderPass)return;const C=f.paint.get("circle-opacity"),M=f.paint.get("circle-stroke-width"),O=f.paint.get("circle-stroke-opacity"),k=void 0!==f.layout.get("circle-sort-key").constantOr(1);if(0===C.constantOr(1)&&(0===M.constantOr(1)||0===O.constantOr(1)))return;const B=_.context,$=B.gl,j=_.transform,q=_.depthModeForSublayer(0,p.DepthMode.ReadOnly),ee=p.StencilMode.disabled,se=_.colorModeForRenderPass(),le="globe"===j.projection.name,ae=[p.mercatorXfromLng(j.center.lng),p.mercatorYfromLat(j.center.lat)],ce=[];for(let oe=0;oe<v.length;oe++){const fe=v[oe],pe=a.getTile(fe),Te=pe.getBucket(f);if(!Te||Te.projection.name!==j.projection.name)continue;const De=Te.programConfigurations.get(f.id),Me=Vm(f);le&&Me.push("PROJECTION_GLOBE_VIEW");const ze=_.useProgram("circle",De,Me),Oe=Te.layoutVertexBuffer,Xe=Te.globeExtVertexBuffer,At=Te.indexBuffer,Ve=j.projection.createInversionMatrix(j,fe.canonical),ht={programConfiguration:De,program:ze,layoutVertexBuffer:Oe,globeExtVertexBuffer:Xe,indexBuffer:At,uniformValues:zm(_,fe,pe,Ve,ae,f),tile:pe};if(k){const tt=Te.segments.get();for(const _t of tt)ce.push({segments:new p.SegmentVector([_t]),sortKey:_t.sortKey,state:ht})}else ce.push({segments:Te.segments,sortKey:0,state:ht})}k&&ce.sort((oe,fe)=>oe.sortKey-fe.sortKey);const X={useDepthForOcclusion:!le};for(const oe of ce){const{programConfiguration:fe,program:pe,layoutVertexBuffer:Te,globeExtVertexBuffer:De,indexBuffer:Me,uniformValues:ze,tile:Oe}=oe.state,Xe=oe.segments;_.terrain&&_.terrain.setupElevationDraw(Oe,pe,X),_.prepareDrawProgram(B,pe,Oe.tileID.toUnwrapped()),pe.draw(B,$.TRIANGLES,q,ee,se,p.CullFaceMode.disabled,ze,f.id,Te,Me,Xe,f.paint,j.zoom,fe,[De])}},heatmap:function(_,a,f,v){if(0!==f.paint.get("heatmap-opacity"))if("offscreen"===_.renderPass){const C=_.context,M=C.gl,O=p.StencilMode.disabled,k=new p.ColorMode([M.ONE,M.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(se,le,ae,ce){const X=se.gl,oe=le.width*ce,fe=le.height*ce;se.activeTexture.set(X.TEXTURE1),se.viewport.set([0,0,oe,fe]);let pe=ae.heatmapFbo;if(!pe||pe&&(pe.width!==oe||pe.height!==fe)){pe&&pe.destroy();const Te=X.createTexture();X.bindTexture(X.TEXTURE_2D,Te),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),pe=ae.heatmapFbo=se.createFramebuffer(oe,fe,!1),function(De,Me,ze,Oe,Xe,At){const Ve=De.gl;Ve.texImage2D(Ve.TEXTURE_2D,0,De.isWebGL2&&De.extRenderToTextureHalfFloat?Ve.RGBA16F:Ve.RGBA,Xe,At,0,Ve.RGBA,De.extRenderToTextureHalfFloat?De.isWebGL2?Ve.HALF_FLOAT:De.extTextureHalfFloat.HALF_FLOAT_OES:Ve.UNSIGNED_BYTE,null),Oe.colorAttachment.set(ze)}(se,0,Te,pe,oe,fe)}else X.bindTexture(X.TEXTURE_2D,pe.colorAttachment.get()),se.bindFramebuffer.set(pe.framebuffer)})(C,_,f,"globe"===_.transform.projection.name?.5:.25),C.clear({color:p.Color.transparent});const B=_.transform,$="globe"===B.projection.name,j=$?["PROJECTION_GLOBE_VIEW"]:null,q=$?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,ee=[p.mercatorXfromLng(B.center.lng),p.mercatorYfromLat(B.center.lat)];for(let se=0;se<v.length;se++){const le=v[se];if(a.hasRenderableParent(le))continue;const ae=a.getTile(le),ce=ae.getBucket(f);if(!ce||ce.projection.name!==B.projection.name)continue;const X=ce.programConfigurations.get(f.id),oe=_.useProgram("heatmap",X,j),{zoom:fe}=_.transform;_.terrain&&_.terrain.setupElevationDraw(ae,oe),_.prepareDrawProgram(C,oe,le.toUnwrapped());const pe=B.projection.createInversionMatrix(B,le.canonical);oe.draw(C,M.TRIANGLES,p.DepthMode.disabled,O,k,q,tp(_,le,ae,pe,ee,fe,f.paint.get("heatmap-intensity")),f.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,f.paint,_.transform.zoom,X,$?[ce.globeExtVertexBuffer]:null)}C.viewport.set([0,0,_.width,_.height])}else"translucent"===_.renderPass&&(_.context.setColorMode(_.colorModeForRenderPass()),function(C,M){const O=C.context,k=O.gl,B=M.heatmapFbo;if(!B)return;O.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,B.colorAttachment.get()),O.activeTexture.set(k.TEXTURE1);let $=M.colorRampTexture;$||($=M.colorRampTexture=new p.Texture(O,M.colorRamp,k.RGBA)),$.bind(k.LINEAR,k.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(O,k.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,C.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:M.paint.get("heatmap-opacity")},M.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,M.paint,C.transform.zoom)}(_,f))},line:function(_,a,f,v){if("translucent"!==_.renderPass)return;const C=f.paint.get("line-opacity"),M=f.paint.get("line-width");if(0===C.constantOr(1)||0===M.constantOr(1))return;const O=_.depthModeForSublayer(0,p.DepthMode.ReadOnly),k=_.colorModeForRenderPass(),B=_.terrain&&_.terrain.renderingToTexture?1:p.exported.devicePixelRatio,$=f.paint.get("line-dasharray"),j=$.constantOr(1),q=f.layout.get("line-cap"),ee=f.paint.get("line-pattern"),se=ee.constantOr(1),le=f.paint.get("line-gradient"),ae=se?"linePattern":"line",ce=_.context,X=ce.gl,oe=(pe=>{const Te=[];bc(pe)&&Te.push("RENDER_LINE_DASH"),pe.paint.get("line-gradient")&&Te.push("RENDER_LINE_GRADIENT");const De=pe.paint.get("line-trim-offset");0===De[0]&&0===De[1]||Te.push("RENDER_LINE_TRIM_OFFSET");const Me=pe.paint.get("line-pattern").constantOr(1),ze=1!==pe.paint.get("line-opacity").constantOr(1);return!Me&&ze&&Te.push("RENDER_LINE_ALPHA_DISCARD"),Te})(f);let fe=oe.includes("RENDER_LINE_ALPHA_DISCARD");_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(fe=!1);for(const pe of v){const Te=a.getTile(pe);if(se&&!Te.patternsLoaded())continue;const De=Te.getBucket(f);if(!De)continue;_.prepareDrawTile();const Me=De.programConfigurations.get(f.id),ze=_.useProgram(ae,Me,oe),Oe=ee.constantOr(null);if(Oe&&Te.imageAtlas){const ct=Te.imageAtlas.patternPositions[Oe.toString()];ct&&Me.setConstantPatternPositions(ct)}const Xe=$.constantOr(null),At=q.constantOr(null);if(!se&&Xe&&At&&Te.lineAtlas){const ct=Te.lineAtlas.getDash(Xe,At);ct&&Me.setConstantPatternPositions(ct)}let[Ve,ht]=f.paint.get("line-trim-offset");("round"===At||"square"===At)&&Ve!==ht&&(0===Ve&&(Ve-=1),1===ht&&(ht+=1));const tt=_.terrain?pe.projMatrix:null,_t=se?Nh(_,Te,f,tt,B):Lv(_,Te,f,tt,De.lineClipsArray.length,B,[Ve,ht]);if(le){const ct=De.gradients[f.id];let Lt=ct.texture;if(f.gradientVersion!==ct.version){let ft=256;if(f.stepInterpolant){const Ct=a.getSource().maxzoom,vn=pe.canonical.z===Ct?Math.ceil(1<<_.transform.maxZoom-pe.canonical.z):1;ft=p.clamp(p.nextPowerOfTwo(De.maxLineLength/p.EXTENT*1024*vn),256,ce.maxTextureSize)}ct.gradient=p.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:ft,image:ct.gradient||void 0,clips:De.lineClipsArray}),ct.texture?ct.texture.update(ct.gradient):ct.texture=new p.Texture(ce,ct.gradient,X.RGBA),ct.version=f.gradientVersion,Lt=ct.texture}ce.activeTexture.set(X.TEXTURE1),Lt.bind(f.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}j&&(ce.activeTexture.set(X.TEXTURE0),Te.lineAtlasTexture.bind(X.LINEAR,X.REPEAT),Me.updatePaintBuffers()),se&&(ce.activeTexture.set(X.TEXTURE0),Te.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Me.updatePaintBuffers()),_.prepareDrawProgram(ce,ze,pe.toUnwrapped());const He=ct=>{ze.draw(ce,X.TRIANGLES,O,ct,k,p.CullFaceMode.disabled,_t,f.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,f.paint,_.transform.zoom,Me,[De.layoutVertexBuffer2])};if(fe){const ct=_.stencilModeForClipping(pe).ref;0===ct&&_.terrain&&ce.clear({stencil:0});const Lt={func:X.EQUAL,mask:255};_t.u_alpha_discard_threshold=.8,He(new p.StencilMode(Lt,ct,255,X.KEEP,X.KEEP,X.INVERT)),_t.u_alpha_discard_threshold=0,He(new p.StencilMode(Lt,ct,255,X.KEEP,X.KEEP,X.KEEP))}else He(_.stencilModeForClipping(pe))}fe&&(_.resetStencilClippingMasks(),_.terrain&&ce.clear({stencil:0}))},fill:function(_,a,f,v){const C=f.paint.get("fill-color"),M=f.paint.get("fill-opacity");if(0===M.constantOr(1))return;const O=_.colorModeForRenderPass(),k=f.paint.get("fill-pattern"),B=_.opaquePassEnabledForLayer()&&!k.constantOr(1)&&1===C.constantOr(p.Color.transparent).a&&1===M.constantOr(0)?"opaque":"translucent";if(_.renderPass===B){const $=_.depthModeForSublayer(1,"opaque"===_.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);$m(_,a,f,v,$,O,!1)}if("translucent"===_.renderPass&&f.paint.get("fill-antialias")){const $=_.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);$m(_,a,f,v,$,O,!0)}},"fill-extrusion":function(_,a,f,v){const C=f.paint.get("fill-extrusion-opacity");if(0!==C&&"translucent"===_.renderPass){const M=new p.DepthMode(_.context.gl.LEQUAL,p.DepthMode.ReadWrite,_.depthRangeFor3D);if(1!==C||f.paint.get("fill-extrusion-pattern").constantOr(1))yu(_,a,f,v,M,p.StencilMode.disabled,p.ColorMode.disabled),yu(_,a,f,v,M,_.stencilModeFor3D(),_.colorModeForRenderPass()),_.resetStencilClippingMasks();else{const O=_.colorModeForRenderPass();yu(_,a,f,v,M,p.StencilMode.disabled,O)}}},hillshade:function(_,a,f,v){if("offscreen"!==_.renderPass&&"translucent"!==_.renderPass)return;const C=_.context,M=_.depthModeForSublayer(0,p.DepthMode.ReadOnly),O=_.colorModeForRenderPass(),k=_.terrain&&_.terrain.renderingToTexture,[B,$]="translucent"!==_.renderPass||k?[{},v]:_.stencilConfigForOverlap(v);for(const j of $){const q=a.getTile(j);if(q.needsHillshadePrepare&&"offscreen"===_.renderPass)fu(_,q,f,M,p.StencilMode.disabled,O);else if("translucent"===_.renderPass){const ee=k&&_.terrain?_.terrain.stencilModeForRTTOverlap(j):B[j.overscaledZ];Lh(_,j,q,f,M,ee,O)}}C.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,a,f,v,C,M){if("translucent"!==_.renderPass||0===f.paint.get("raster-opacity")||!v.length)return;const O=_.context,k=O.gl,B=a.getSource(),$=_.useProgram("raster"),j=_.colorModeForRenderPass(),q=_.terrain&&_.terrain.renderingToTexture,[ee,se]=B instanceof Nn||q?[{},v]:_.stencilConfigForOverlap(v),le=se[se.length-1].overscaledZ,ae=!_.options.moving;for(const ce of se){const X=q?p.DepthMode.disabled:_.depthModeForSublayer(ce.overscaledZ-le,1===f.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,k.LESS),oe=ce.toUnwrapped(),fe=a.getTile(ce);if(q&&(!fe||!fe.hasData()))continue;const pe=q?ce.projMatrix:_.transform.calculateProjMatrix(oe,ae),Te=_.terrain&&q?_.terrain.stencilModeForRTTOverlap(ce):ee[ce.overscaledZ],De=M?0:f.paint.get("raster-fade-duration");fe.registerFadeDuration(De);const Me=a.findLoadedParent(ce,0),ze=Ss(fe,Me,a,_.transform,De);let Oe,Xe;_.terrain&&_.terrain.prepareDrawTile();const At="nearest"===f.paint.get("raster-resampling")?k.NEAREST:k.LINEAR;O.activeTexture.set(k.TEXTURE0),fe.texture.bind(At,k.CLAMP_TO_EDGE),O.activeTexture.set(k.TEXTURE1),Me?(Me.texture.bind(At,k.CLAMP_TO_EDGE),Oe=Math.pow(2,Me.tileID.overscaledZ-fe.tileID.overscaledZ),Xe=[fe.tileID.canonical.x*Oe%1,fe.tileID.canonical.y*Oe%1]):fe.texture.bind(At,k.CLAMP_TO_EDGE),fe.texture.useMipmap&&O.extTextureFilterAnisotropic&&_.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);const Ve=_d(pe,Xe||[0,0],Oe||1,ze,f,B instanceof Nn?B.perspectiveTransform:[0,0]);if(_.prepareDrawProgram(O,$,oe),B instanceof Nn)B.boundsBuffer&&B.boundsSegments&&$.draw(O,k.TRIANGLES,X,p.StencilMode.disabled,j,p.CullFaceMode.disabled,Ve,f.id,B.boundsBuffer,_.quadTriangleIndexBuffer,B.boundsSegments);else{const{tileBoundsBuffer:ht,tileBoundsIndexBuffer:tt,tileBoundsSegments:_t}=_.getTileBoundsBuffers(fe);$.draw(O,k.TRIANGLES,X,Te,j,p.CullFaceMode.disabled,Ve,f.id,ht,tt,_t)}}_.resetStencilClippingMasks()},background:function(_,a,f,v){const C=f.paint.get("background-color"),M=f.paint.get("background-opacity");if(0===M)return;const O=_.context,k=O.gl,B=_.transform,$=B.tileSize,j=f.paint.get("background-pattern");if(_.isPatternMissing(j))return;const q=!j&&1===C.a&&1===M&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==q)return;const ee=p.StencilMode.disabled,se=_.depthModeForSublayer(0,"opaque"===q?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),le=_.colorModeForRenderPass(),ae=_.useProgram(j?"backgroundPattern":"background");let ce,X=v;X||(ce=_.getBackgroundTiles(),X=Object.values(ce).map(oe=>oe.tileID)),j&&(O.activeTexture.set(k.TEXTURE0),_.imageManager.bind(_.context));for(const oe of X){const fe=oe.toUnwrapped(),pe=v?oe.projMatrix:_.transform.calculateProjMatrix(fe);_.prepareDrawTile();const Te=a?a.getTile(oe):ce?ce[oe.key]:new p.Tile(oe,$,B.zoom,_),De=j?T_(pe,M,_,j,{tileID:oe,tileSize:$}):jm(pe,M,C);_.prepareDrawProgram(O,ae,fe);const{tileBoundsBuffer:Me,tileBoundsIndexBuffer:ze,tileBoundsSegments:Oe}=_.getTileBoundsBuffers(Te);ae.draw(O,k.TRIANGLES,se,ee,le,p.CullFaceMode.disabled,De,f.id,Me,ze,Oe)}},sky:function(_,a,f){const v=_.transform,C="mercator"===v.projection.name||"globe"===v.projection.name?1:p.smoothstep(7,8,v.zoom),M=f.paint.get("sky-opacity")*C;if(0===M)return;const O=_.context,k=f.paint.get("sky-type"),B=new p.DepthMode(O.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),$=_.frameCounter/1e3%1;"atmosphere"===k?"offscreen"===_.renderPass?f.needsSkyboxCapture(_)&&(function(j,q,ee,se){const le=j.context,ae=le.gl;let ce=q.skyboxFbo;if(!ce){ce=q.skyboxFbo=le.createFramebuffer(32,32,!1),q.skyboxGeometry=new $l(le),q.skyboxTexture=le.gl.createTexture(),ae.bindTexture(ae.TEXTURE_CUBE_MAP,q.skyboxTexture),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MAG_FILTER,ae.LINEAR);for(let pe=0;pe<6;++pe)ae.texImage2D(ae.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,ae.RGBA,32,32,0,ae.RGBA,ae.UNSIGNED_BYTE,null)}le.bindFramebuffer.set(ce.framebuffer),le.viewport.set([0,0,32,32]);const X=q.getCenter(j,!0),oe=j.useProgram("skyboxCapture"),fe=new Float64Array(16);p.identity(fe),p.rotateY(fe,fe,.5*-Math.PI),As(le,q,oe,fe,X,0),p.identity(fe),p.rotateY(fe,fe,.5*Math.PI),As(le,q,oe,fe,X,1),p.identity(fe),p.rotateX(fe,fe,.5*-Math.PI),As(le,q,oe,fe,X,2),p.identity(fe),p.rotateX(fe,fe,.5*Math.PI),As(le,q,oe,fe,X,3),p.identity(fe),As(le,q,oe,fe,X,4),p.identity(fe),p.rotateY(fe,fe,Math.PI),As(le,q,oe,fe,X,5),le.viewport.set([0,0,j.width,j.height])}(_,f),f.markSkyboxValid(_)):"sky"===_.renderPass&&function(j,q,ee,se,le){const ae=j.context,ce=ae.gl,X=j.transform,oe=j.useProgram("skybox");ae.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_CUBE_MAP,q.skyboxTexture);const fe={u_matrix:X.skyboxMatrix,u_sun_direction:q.getCenter(j,!1),u_cubemap:0,u_opacity:se,u_temporal_offset:le};j.prepareDrawProgram(ae,oe),oe.draw(ae,ce.TRIANGLES,ee,p.StencilMode.disabled,j.colorModeForRenderPass(),p.CullFaceMode.backCW,fe,"skybox",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(_,f,B,M,$):"gradient"===k&&"sky"===_.renderPass&&function(j,q,ee,se,le){const ae=j.context,ce=ae.gl,X=j.transform,oe=j.useProgram("skyboxGradient");q.skyboxGeometry||(q.skyboxGeometry=new $l(ae)),ae.activeTexture.set(ce.TEXTURE0);let fe=q.colorRampTexture;fe||(fe=q.colorRampTexture=new p.Texture(ae,q.colorRamp,ce.RGBA)),fe.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const pe=(Te=X.skyboxMatrix,De=q.getCenter(j,!1),Me=q.paint.get("sky-gradient-radius"),ze=se,Oe=le,{u_matrix:Te,u_color_ramp:0,u_center_direction:De,u_radius:p.degToRad(Me),u_opacity:ze,u_temporal_offset:Oe});var Te,De,Me,ze,Oe;j.prepareDrawProgram(ae,oe),oe.draw(ae,ce.TRIANGLES,ee,p.StencilMode.disabled,j.colorModeForRenderPass(),p.CullFaceMode.backCW,pe,"skyboxGradient",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(_,f,B,M,$)},debug:function(_,a,f){for(let v=0;v<f.length;v++)I_(_,a,f[v])},custom:function(_,a,f,v){const C=_.context,M=f.implementation;if(!_.transform.projection.unsupportedLayers||!_.transform.projection.unsupportedLayers.includes("custom")||_.terrain&&(_.terrain.renderingToTexture||"offscreen"===_.renderPass)&&f.isLayerDraped()){if("offscreen"===_.renderPass){const O=M.prerender;if(O){if(_.setCustomLayerDefaults(),C.setColorMode(_.colorModeForRenderPass()),"globe"===_.transform.projection.name){const k=_.transform.pointMerc;O.call(M,C.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(_.transform.zoom),[k.x,k.y],_.transform.pixelsPerMeterRatio)}else O.call(M,C.gl,_.transform.customLayerMatrix());C.setDirty(),_.setBaseState()}}else if("translucent"===_.renderPass){if(_.terrain&&_.terrain.renderingToTexture){const k=M.renderToTile;if(k){const B=v[0].canonical,$=new p.MercatorCoordinate(B.x+v[0].wrap*(1<<B.z),B.y,B.z);C.setDepthMode(p.DepthMode.disabled),C.setStencilMode(p.StencilMode.disabled),C.setColorMode(_.colorModeForRenderPass()),_.setCustomLayerDefaults(),k.call(M,C.gl,$),C.setDirty(),_.setBaseState()}return}_.setCustomLayerDefaults(),C.setColorMode(_.colorModeForRenderPass()),C.setStencilMode(p.StencilMode.disabled);const O="3d"===M.renderingMode?new p.DepthMode(_.context.gl.LEQUAL,p.DepthMode.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(C.setDepthMode(O),"globe"===_.transform.projection.name){const k=_.transform.pointMerc;M.render(C.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(_.transform.zoom),[k.x,k.y],_.transform.pixelsPerMeterRatio)}else M.render(C.gl,_.transform.customLayerMatrix());C.setDirty(),_.setBaseState(),C.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ec{constructor(a,f,v=!1){this.context=new $t(a,v),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,f){const v=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Nm(this,a));const C=this._terrain;this.transform.elevation=v?C:null,C.update(a,this.transform,f)}_updateFog(a){const f=a.fog;if(!f||"globe"===this.transform.projection.name||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,C]=f.getFovAdjustedRange(this.transform._fov);if(v>C)return void(this.transform.fogCullDistSq=null);const M=v+.78*(C-v);this.transform.fogCullDistSq=M*M}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,f){if(this.width=a*p.exported.devicePixelRatio,this.height=f*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const a=this.context,f=new p.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(p.EXTENT,0),f.emplaceBack(0,p.EXTENT),f.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(f,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const v=new p.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(p.EXTENT,0),v.emplaceBack(0,p.EXTENT),v.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=a.createVertexBuffer(v,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const C=new p.StructArrayLayout2i4;C.emplaceBack(-1,-1),C.emplaceBack(1,-1),C.emplaceBack(-1,1),C.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(C,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const M=new p.StructArrayLayout4i8;M.emplaceBack(0,0,0,0),M.emplaceBack(p.EXTENT,0,p.EXTENT,0),M.emplaceBack(0,p.EXTENT,0,p.EXTENT),M.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(M,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const O=new p.StructArrayLayout3ui6;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(O);const k=new p.StructArrayLayout1ui2;for(const $ of[0,1,3,2,0])k.emplaceBack($);this.debugIndexBuffer=a.createIndexBuffer(k),this.emptyTexture=new p.Texture(a,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=p.create();const B=this.context.gl;this.stencilClearMode=new p.StencilMode({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new Cd(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,f=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,f.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,jl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,f,v){if(!f||this.currentStencilSource===f.id||!a.isTileClipped()||!v||0===v.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const B of v)if(void 0===this._tileClippingMaskIDs[B.key]){k=!0;break}if(!k)return}this.currentStencilSource=f.id;const C=this.context,M=C.gl;this.nextStencilID+v.length>256&&this.clearStencil(),C.setColorMode(p.ColorMode.disabled),C.setDepthMode(p.DepthMode.disabled);const O=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of v){const B=f.getTile(k),$=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:q,tileBoundsSegments:ee}=this.getTileBoundsBuffers(B);O.draw(C,M.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:M.ALWAYS,mask:0},$,255,M.KEEP,M.KEEP,M.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,jl(k.projMatrix),"$clipping",j,q,ee)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,f=this.context.gl;return new p.StencilMode({func:f.NOTEQUAL,mask:255},a,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const f=this.context.gl;return new p.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(a){const f=this.context.gl,v=a.sort((O,k)=>k.overscaledZ-O.overscaledZ),C=v[v.length-1].overscaledZ,M=v[0].overscaledZ-C+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const O={};for(let k=0;k<M;k++)O[k+C]=new p.StencilMode({func:f.GEQUAL,mask:255},k+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=M,[O,v]}return[{[C]:p.StencilMode.disabled},v]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([a.CONSTANT_COLOR,a.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(a,f,v){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const C=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new p.DepthMode(v||this.context.gl.LEQUAL,f,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,f){this.style=a,this.options=f,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const v=this.style.order,C=this.style._sourceCaches;for(const $ in C){const j=C[$];j.used&&j.prepare(this.context)}const M={},O={},k={};for(const $ in C){const j=C[$];M[$]=j.getVisibleCoordinates(),O[$]=M[$].slice().reverse(),k[$]=j.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $=0;$<v.length;$++)if(this.style._layers[v[$]].is3D()){this.opaquePassCutoff=$;break}if(this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const $ of v){const j=this.style._layers[$],q=a._getLayerSourceCache(j);if(!j.hasOffscreenPass()||j.isHidden(this.transform.zoom))continue;const ee=q?O[q.id]:void 0;("custom"===j.type||j.isSky()||ee&&ee.length)&&this.renderLayer(this,q,j,ee)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon];const B=this.terrain;if(B&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&B.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:f.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const $=this.style._layers[v[this.currentLayer]],j=a._getLayerSourceCache($);if($.isSky())continue;const q=j?O[j.id]:void 0;this._renderTileClippingMasks($,j,q),this.renderLayer(this,j,$,q)}if(this.style.fog&&this.transform.projection.supportsFog&&function($,j){const q=$.context,ee=q.gl,se=$.transform,le=new p.DepthMode(ee.LEQUAL,p.DepthMode.ReadOnly,[0,1]),ae=$.useProgram("globeAtmosphere",null,"globe"===se.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ce=p.globeToMercatorTransition(se.zoom),X=j.properties.get("color").toArray01(),oe=j.properties.get("high-color").toArray01(),fe=j.properties.get("space-color").toArray01PremultipliedAlpha(),pe=p.identity$1([]);p.rotateY$1(pe,pe,-p.degToRad(se._center.lng)),p.rotateX$1(pe,pe,p.degToRad(se._center.lat)),p.rotateZ$1(pe,pe,se.angle),p.rotateX$1(pe,pe,-se._pitch);const Te=p.fromQuat(new Float32Array(16),pe),De=p.mapValue(j.properties.get("star-intensity"),0,1,0,.25),ze=p.mapValue(j.properties.get("horizon-blend"),0,1,5e-4,.25),Oe=p.globeUseCustomAntiAliasing($,q,se)&&5e-4===ze?se.worldSize/(2*Math.PI*1.025)-1:se.globeRadius,Xe=$.frameCounter/1e3%1,At=p.length(se.globeCenterInViewSpace),Ve=Math.sqrt(Math.pow(At,2)-Math.pow(Oe,2)),ht=Math.acos(Ve/At),tt={u_frustum_tl:se.frustumCorners.TL,u_frustum_tr:se.frustumCorners.TR,u_frustum_br:se.frustumCorners.BR,u_frustum_bl:se.frustumCorners.BL,u_horizon:se.frustumCorners.horizon,u_transition:ce,u_fadeout_range:ze,u_color:X,u_high_color:oe,u_space_color:fe,u_star_intensity:De,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Xe,u_horizon_angle:ht,u_rotation_matrix:Te};$.prepareDrawProgram(q,ae);const _t=$.atmosphereBuffer;_t&&ae.draw(q,ee.TRIANGLES,le,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,tt,"skybox",_t.vertexBuffer,_t.indexBuffer,_t.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const $=this.style._layers[v[this.currentLayer]],j=a._getLayerSourceCache($);$.isSky()&&this.renderLayer(this,j,$,j?O[j.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const $=this.style._layers[v[this.currentLayer]],j=a._getLayerSourceCache($);if($.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped($)){if($.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const q=j?("symbol"===$.type?k:O)[j.id]:void 0;this._renderTileClippingMasks($,j,j?M[j.id]:void 0),this.renderLayer(this,j,$,q),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $=null;p.values(this.style._layers).forEach(j=>{const q=a._getLayerSourceCache(j);q&&!j.isHidden(this.transform.zoom)&&(!$||$.getSource().maxzoom<q.getSource().maxzoom)&&($=q)}),$&&this.options.showTileBoundaries&&ls.debug(this,$,$.getVisibleCoordinates())}this.options.showPadding&&function($){const j=$.transform.padding;op($,$.transform.height-(j.top||0),3,xc),op($,j.bottom||0,3,Ed),Vh($,j.left||0,3,M_),Vh($,$.transform.width-(j.right||0),3,S_);const q=$.transform.centerPoint;var ee,se,le,ae;vu(ee=$,(se=q.x)-1,(le=$.transform.height-q.y)-10,2,20,ae=Fv),vu(ee,se-10,le-1,20,2,ae)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,f,v,C){v.isHidden(this.transform.zoom)||("background"===v.type||"sky"===v.type||"custom"===v.type||C&&C.length)&&(this.id=v.id,this.gpuTimingStart(v),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(v.type)||a.terrain&&"custom"===v.type)&&ls[v.type](a,f,v,C,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let v=this.gpuTimers[a.id];v||(v=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),v.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,f=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(f),a.beginQueryEXT(a.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const f={};for(const v in a){const C=a[v],M=this.context.extTimerQuery,O=M.getQueryObjectEXT(C.query,M.QUERY_RESULT_EXT)/1e6;M.deleteQueryEXT(C.query),f[v]=O}return f}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery;let v=0;for(const C of a)v+=f.getQueryObjectEXT(C,f.QUERY_RESULT_EXT)/1e6,f.deleteQueryEXT(C);return v}translatePosMatrix(a,f,v,C,M){if(!v[0]&&!v[1])return a;const O=M?"map"===C?this.transform.angle:0:"viewport"===C?-this.transform.angle:0;if(O){const $=Math.sin(O),j=Math.cos(O);v=[v[0]*j-v[1]*$,v[0]*$+v[1]*j]}const k=[M?v[0]:dr(f,v[0],this.transform.zoom),M?v[1]:dr(f,v[1],this.transform.zoom),0],B=new Float32Array(16);return p.translate(B,a,k),B}saveTileTexture(a){const f=this._tileTextures[a.size[0]];f?f.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const f=this._tileTextures[a];return f&&f.length>0?f.pop():null}isPatternMissing(a){return null===a||void 0!==a&&!this.imageManager.getPattern(a.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,f=this.terrain&&0===this.terrain.exaggeration(),v=this.style&&this.style.fog,C=[];return this.terrainRenderModeElevated()&&C.push("TERRAIN"),"globe"===this.transform.projection.name&&C.push("GLOBE"),f&&C.push("ZERO_EXAGGERATION"),v&&!a&&0!==v.getOpacity(this.transform.pitch)&&C.push("FOG"),a&&C.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&C.push("OVERDRAW_INSPECTOR"),C}useProgram(a,f,v){this.cache=this.cache||{};const C=v||[],M=this.currentGlobalDefines().concat(C),O=wi.cacheKey(du[a],a,M,f);return this.cache[O]||(this.cache[O]=new wi(this.context,a,du[a],f,Is[a],M)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,f,v){if(this.terrain&&this.terrain.renderingToTexture)return;const C=this.style.fog;if(C){const M=C.getOpacity(this.transform.pitch),O=((k,B,$,j,q,ee,se,le,ae,ce,X)=>{const oe=k.transform,fe=B.properties.get("color").toArray01();fe[3]=j;const pe=k.frameCounter/1e3%1;return{u_fog_matrix:$?oe.calculateFogTileMatrix($):k.identityMat,u_fog_range:B.getFovAdjustedRange(oe._fov),u_fog_color:fe,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_temporal_offset:pe,u_frustum_tl:q,u_frustum_tr:ee,u_frustum_br:se,u_frustum_bl:le,u_globe_pos:ae,u_globe_radius:ce,u_viewport:X,u_globe_transition:p.globeToMercatorTransition(oe.zoom),u_is_globe:+("globe"===oe.projection.name)}})(this,C,v,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);f.setFogUniformValues(a,O)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,f=a.createTexture();return a.bindTexture(a.TEXTURE_2D,f),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&0!==a.getOpacity(this.transform.pitch)}getBackgroundTiles(){const a=this._backgroundTiles,f=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const C of v)f[C.key]=a[C.key]||new p.Tile(C,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class bo{constructor(a=0,f=0,v=0,C=0){if(isNaN(a)||a<0||isNaN(f)||f<0||isNaN(v)||v<0||isNaN(C)||C<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=f,this.left=v,this.right=C}interpolate(a,f,v){return null!=f.top&&null!=a.top&&(this.top=p.number(a.top,f.top,v)),null!=f.bottom&&null!=a.bottom&&(this.bottom=p.number(a.bottom,f.bottom,v)),null!=f.left&&null!=a.left&&(this.left=p.number(a.left,f.left,v)),null!=f.right&&null!=a.right&&(this.right=p.number(a.right,f.right,v)),this}getCenter(a,f){const v=p.clamp((this.left+a-this.right)/2,0,a),C=p.clamp((this.top+f-this.bottom)/2,0,f);return new p.Point(v,C)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new bo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function bu(_,a){const f=p.getColumn(_,3);p.fromQuat(_,a),p.setColumn(_,3,f)}function vi(_,a){const f=p.identity$1([]);return p.rotateZ$1(f,f,-a),p.rotateX$1(f,f,-_),f}function Hi(_,a){const f=[_[0],_[1],0],v=[a[0],a[1],0];if(p.length(f)>=1e-15){const O=p.normalize([],f);p.scale$2(v,O,p.dot(v,O)),a[0]=v[0],a[1]=v[1]}const C=p.cross([],a,_);if(p.len(C)<1e-15)return null;const M=Math.atan2(-C[1],C[0]);return vi(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),M)}class Cc{constructor(a,f){this.position=a,this.orientation=f}get position(){return this._position}set position(a){if(a){const f=a instanceof p.MercatorCoordinate?a:new p.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(f.x=p.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(a,f){if(this.orientation=null,!this.position)return;const v=this.position,C=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(a)):0,M=p.MercatorCoordinate.fromLngLat(a,C),O=[M.x-v.x,M.y-v.y,M.z-v.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Hi(O,f)}setPitchBearing(a,f){this.orientation=vi(p.degToRad(a),p.degToRad(-f))}}class _l{constructor(a,f){this._transform=p.identity([]),this.orientation=f,this.position=a}get mercatorPosition(){const a=this.position;return new p.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=p.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var f;a&&p.setColumn(this._transform,3,[(f=a)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||p.identity$1([]),a&&bu(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,f){this._orientation=vi(a,f),bu(this._transform,this._orientation)}forward(){const a=p.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=p.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=p.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,f){const v=new Float64Array(16);return p.invert(v,this.getWorldToCamera(a,f)),v}getWorldToCameraPosition(a,f,v){const C=this.position;p.scale$2(C,C,-a);const M=new Float64Array(16);return p.fromScaling(M,[v,v,v]),p.translate(M,M,C),M[10]*=f,M}getWorldToCamera(a,f){const v=new Float64Array(16),C=new Float64Array(4),M=this.position;return p.conjugate(C,this._orientation),p.scale$2(M,M,-a),p.fromQuat(v,C),p.translate(v,v,M),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=f,v[9]*=f,v[10]*=f,v[11]*=f,v}getCameraToClipPerspective(a,f,v,C){const M=new Float64Array(16);return p.perspective(M,a,f,v,C),M}getDistanceToElevation(a,f=!1){const v=0===a?0:p.mercatorZfromAltitude(a,f?p.latFromMercatorY(this.position[1]):this.position[1]),C=this.forward();return(v-this.position[2])/C[2]}clone(){return new _l([...this.position],[...this.orientation])}}function Ur(_,a){const f=Dc(_.projection,_.zoom,_.width,_.height),v=function(M,O,k,B,$){const j=new p.LngLat(k.lng-180*xo,k.lat),q=new p.LngLat(k.lng+180*xo,k.lat),ee=M.project(j.lng,j.lat),se=M.project(q.lng,q.lat),le=-Math.atan2(se.y-ee.y,se.x-ee.x),ae=p.MercatorCoordinate.fromLngLat(k);ae.y=p.clamp(ae.y,-1+xo,1-xo);const ce=ae.toLngLat(),X=M.project(ce.lng,ce.lat),oe=p.MercatorCoordinate.fromLngLat(ce);oe.x+=xo;const fe=oe.toLngLat(),pe=M.project(fe.lng,fe.lat),Te=xu(pe.x-X.x,pe.y-X.y,le),De=p.MercatorCoordinate.fromLngLat(ce);De.y+=xo;const Me=De.toLngLat(),ze=M.project(Me.lng,Me.lat),Oe=xu(ze.x-X.x,ze.y-X.y,le),Xe=Math.abs(Te.x)/Math.abs(Oe.y),At=p.identity([]);p.rotateZ(At,At,-le*(1-($?0:B)));const Ve=p.identity([]);return p.scale(Ve,Ve,[1,1-(1-Xe)*B,1]),Ve[4]=-Oe.x/Oe.y*B,p.rotateZ(Ve,Ve,le),p.multiply(Ve,At,Ve),Ve}(_.projection,0,_.center,f,a),C=Dd(_);return p.scale(v,v,[C,C,1]),v}function Dd(_){const a=_.projection,f=Dc(_.projection,_.zoom,_.width,_.height),v=wo(a,_.center),C=wo(a,p.LngLat.convert(a.center));return Math.pow(2,v*f+(1-f)*C)}function Dc(_,a,f,v,C=1/0){const M=_.range;if(!M)return 0;const O=Math.min(C,Math.max(f,v)),k=Math.log(O/1024)/Math.LN2;return p.smoothstep(M[0]+k,M[1]+k,a)}const xo=1/4e4;function wo(_,a){const f=p.clamp(a.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),v=new p.LngLat(a.lng-180*xo,f),C=new p.LngLat(a.lng+180*xo,f),M=_.project(v.lng,f),O=_.project(C.lng,f),k=p.MercatorCoordinate.fromLngLat(v),B=p.MercatorCoordinate.fromLngLat(C),$=O.x-M.x,j=O.y-M.y,q=B.x-k.x,ee=B.y-k.y,se=Math.sqrt((q*q+ee*ee)/($*$+j*j));return Math.log(se)/Math.LN2}function xu(_,a,f){const v=Math.cos(f),C=Math.sin(f);return{x:_*v-a*C,y:_*C+a*v}}class Tc{constructor(a,f,v,C,M,O,k){this.tileSize=512,this._renderWorldCopies=void 0===M||M,this._minZoom=a||0,this._maxZoom=f||22,this._minPitch=v??0,this._maxPitch=C??60,this.setProjection(O),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new bo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new _l,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new Tc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a,f=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||v)&&this._updateCameraOnTerrain(),(a||v)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const v=!ue(f,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const f=a!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(a){void 0===a?a=!0:null===a&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const f=-a*Math.PI/180;var v,C,M,O,k,B,$,j,q,ee;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(v=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),C=this.rotationMatrix,O=this.angle,k=(M=this.rotationMatrix)[0],B=M[1],$=M[2],j=M[3],q=Math.sin(O),ee=Math.cos(O),C[0]=k*ee+$*q,C[1]=B*ee+j*q,C[2]=k*-q+$*ee,C[3]=B*-q+j*ee)}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const f=p.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=p.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const f=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let C=0,M=0;for(let O=0;O<f.length;O++){const k=new p.Point(f[O][0]*this.width,v+f[O][1]*(this.height-v)),B=a.pointCoordinate(k);if(!B)continue;const $=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);C+=B[3]*$,M+=$}return 0===M?NaN:C/M}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const a=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*f,C=this._mercatorZfromZoom(a),M=this._mercatorZfromZoom(this._maxZoom),O=Math.max(C-v,M);this._setZoom(this._zoomFromMercatorZ(O))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let v;v=a.z<this._camera.position[2]?[f.x,f.y,f.z]:[a.x,a.y,a.z];const C=p.length(p.sub([],this._camera.position,v));return p.clamp(this._zoomFromMercatorZ(C),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let f=!1;if(a.orientation&&!p.exactEquals(a.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(a.orientation)),a.position){const v=[a.position.x,a.position.y,a.position.z];p.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,f=new Cc;return f.position=new p.MercatorCoordinate(a[0],a[1],a[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(a){if(!p.length$1(a))return!1;p.normalize$1(a,a);const f=p.transformQuat([],[0,0,-1],a),v=p.transformQuat([],[0,-1,0],a);if(v[2]<0)return!1;const C=Hi(f,v);return!!C&&(this._camera.orientation=C,!0)}_setCameraPosition(a){const f=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,C=this.cameraToCenterDistance;a[2]=p.clamp(a[2],C/v,C/f),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,f,v){this._unmodified=!1,this._edgeInsets.interpolate(a,f,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const f=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(a){const f=[new p.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const v=this.pointCoordinate(new p.Point(0,0)),C=this.pointCoordinate(new p.Point(this.width,0)),M=this.pointCoordinate(new p.Point(this.width,this.height)),O=this.pointCoordinate(new p.Point(0,this.height)),k=Math.floor(Math.min(v.x,C.x,M.x,O.x)),B=Math.floor(Math.max(v.x,C.x,M.x,O.x)),$=1;for(let j=k-$;j<=B+$;j++)0!==j&&f.push(new p.UnwrappedTileID(j,a))}return f}coveringTiles(a){let f=this.coveringZoomLevel(a);const v=f,C=this.elevation&&!a.isTerrainDEM,M="mercator"===this.projection.name;if(void 0!==a.minzoom&&f<a.minzoom)return[];void 0!==a.maxzoom&&f>a.maxzoom&&(f=a.maxzoom);const O=this.locationCoordinate(this.center),k=this.center.lat,B=1<<f,$=[B*O.x,B*O.y,0],j="globe"===this.projection.name,q=!j,ee=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,q),se=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),le=B*p.mercatorZfromAltitude(1,this.center.lat),ae=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),ce=[B*se.x,B*se.y,ae*(q?1:le)],X=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),oe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,fe=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,pe=a.isTerrainDEM?-fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?Dd(this):1,De=He=>{const Lt=new p.MercatorCoordinate(He.x+25e-6,He.y,He.z),ft=new p.MercatorCoordinate(He.x,He.y+25e-6,He.z),Ct=He.toLngLat(),vn=Lt.toLngLat(),Rn=ft.toLngLat(),sn=this.locationCoordinate(Ct),bn=this.locationCoordinate(vn),Kn=this.locationCoordinate(Rn),Mn=Math.hypot(bn.x-sn.x,bn.y-sn.y),an=Math.hypot(Kn.x-sn.x,Kn.y-sn.y);return Math.sqrt(Mn*an)*Te/25e-6},Me=He=>{const ct=fe,Lt=pe;return{aabb:p.tileAABB(this,B,0,0,0,He,Lt,ct,this.projection),zoom:0,x:0,y:0,minZ:Lt,maxZ:ct,wrap:He,fullyVisible:!1}},ze=[];let Oe=[];const Xe=f,At=a.reparseOverscaled?v:f,Ve=He=>He*He,ht=Ve((ae-this._centerAltitude)*le),tt=He=>{if(!this._elevation||!He.tileID||!M)return;const ct=this._elevation.getMinMaxForTile(He.tileID),Lt=He.aabb;ct?(Lt.min[2]=ct.min,Lt.max[2]=ct.max,Lt.center[2]=(Lt.min[2]+Lt.max[2])/2):(He.shouldSplit=_t(He),He.shouldSplit||(Lt.min[2]=Lt.max[2]=Lt.center[2]=this._centerAltitude))},_t=He=>{if(He.zoom<oe)return!0;if(He.zoom===Xe)return!1;if(null!=He.shouldSplit)return He.shouldSplit;const ct=He.aabb.distanceX(ce),Lt=He.aabb.distanceY(ce);let ft=ht,Ct=1;if(j){ft=Ve(He.aabb.distanceZ(ce));const sn=Math.pow(2,He.zoom),bn=p.latFromMercatorY((He.y+1)/sn),Kn=p.latFromMercatorY(He.y/sn),Mn=Math.min(Math.max(k,bn),Kn),an=p.circumferenceAtLatitude(Mn)/p.circumferenceAtLatitude(k);if(Ct=Mn===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,an/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&He.zoom===Xe-1&&an>=.9)return!0}else if(C&&(ft=Ve(He.aabb.distanceZ(ce)*le)),this.projection.isReprojectedInTileSpace&&v<=5){const sn=Math.pow(2,He.zoom),bn=De(new p.MercatorCoordinate((He.x+.5)/sn,(He.y+.5)/sn));Ct=bn>.85?1:bn}const vn=ct*ct+Lt*Lt+ft;return vn<Ve((1<<Xe-He.zoom)*X*Ct*((sn,bn)=>{if(bn*Ve(.707)<sn)return 1;const Kn=Math.sqrt(bn/sn);return Kn/(1.4144271570014144+(Math.pow(1.1,Kn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ft,ht),vn))};if(this.renderWorldCopies)for(let He=1;He<=3;He++)ze.push(Me(-He)),ze.push(Me(He));for(ze.push(Me(0));ze.length>0;){const He=ze.pop(),ct=He.x,Lt=He.y;let ft=He.fullyVisible;if(!ft){const Ct=He.aabb.intersects(ee);if(0===Ct)continue;ft=2===Ct}if(He.zoom!==Xe&&_t(He))for(let Ct=0;Ct<4;Ct++){const vn=(ct<<1)+Ct%2,Rn=(Lt<<1)+(Ct>>1),sn={aabb:M?He.aabb.quadrant(Ct):p.tileAABB(this,B,He.zoom+1,vn,Rn,He.wrap,He.minZ,He.maxZ,this.projection),zoom:He.zoom+1,x:vn,y:Rn,wrap:He.wrap,fullyVisible:ft,tileID:void 0,shouldSplit:void 0,minZ:He.minZ,maxZ:He.maxZ};C&&!j&&(sn.tileID=new p.OverscaledTileID(He.zoom+1===Xe?At:He.zoom+1,He.wrap,He.zoom+1,vn,Rn),tt(sn)),ze.push(sn)}else{const Ct=He.zoom===Xe?At:He.zoom;if(a.minzoom&&a.minzoom>Ct)continue;const vn=$[0]-(.5+ct+(He.wrap<<He.zoom))*(1<<f-He.zoom),Rn=$[1]-.5-Lt,sn=He.tileID?He.tileID:new p.OverscaledTileID(Ct,He.wrap,He.zoom,ct,Lt);Oe.push({tileID:sn,distanceSq:vn*vn+Rn*Rn})}}if(this.fogCullDistSq){const He=this.fogCullDistSq,ct=this.horizonLineFromTop();Oe=Oe.filter(Lt=>{const ft=[0,0,0,1],Ct=[p.EXTENT,p.EXTENT,0,1],vn=this.calculateFogTileMatrix(Lt.tileID.toUnwrapped());p.transformMat4$1(ft,ft,vn),p.transformMat4$1(Ct,Ct,vn);const Rn=p.getAABBPointSquareDist(ft,Ct);if(0===Rn)return!0;let sn=!1;const bn=this._elevation;if(bn&&Rn>He&&0!==ct){const Kn=this.calculateProjMatrix(Lt.tileID.toUnwrapped());let Mn;a.isTerrainDEM||(Mn=bn.getMinMaxForTile(Lt.tileID)),Mn||(Mn={min:pe,max:fe});const an=p.furthestTileCorner(this.rotation),Ai=[an[0]*p.EXTENT,an[1]*p.EXTENT,Mn.max];p.transformMat4(Ai,Ai,Kn),sn=(1-Ai[1])*this.height*.5<ct}return Rn<He||sn})}return Oe.sort((He,ct)=>He.distanceSq-ct.distanceSq).map(He=>He.tileID)}resize(a,f){this.width=a,this.height=f,this.pixelsToGLUnits=[2/a,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const f=p.clamp(a.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),v=this.projection.project(a.lng,f);return new p.Point(v.x*this.worldSize,v.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,f){let v,C;const M=this.centerPoint;if("globe"===this.projection.name){const k=this.worldSize;v=(f.x-M.x)/k,C=(f.y-M.y)/k}else{const k=this.pointCoordinate(f),B=this.pointCoordinate(M);v=k.x-B.x,C=k.y-B.y}const O=this.locationCoordinate(a);this.setLocation(new p.MercatorCoordinate(O.x-v,O.y-C))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,f){const v=f?p.mercatorZfromAltitude(f,a.lat):void 0,C=this.projection.project(a.lng,a.lat);return new p.MercatorCoordinate(C.x,C.y,v)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,f){const v=f??this._centerAltitude,C=[a.x,a.y,0,1],M=[a.x,a.y,1,1];p.transformMat4$1(C,C,this.pixelMatrixInverse),p.transformMat4$1(M,M,this.pixelMatrixInverse);const O=M[3];p.scale$1(C,C,1/C[3]),p.scale$1(M,M,1/O);const k=C[2],B=M[2];return{p0:C,p1:M,t:k===B?0:(v-k)/(B-k)}}screenPointToMercatorRay(a){const f=[a.x,a.y,0,1],v=[a.x,a.y,1,1];return p.transformMat4$1(f,f,this.pixelMatrixInverse),p.transformMat4$1(v,v,this.pixelMatrixInverse),p.scale$1(f,f,1/f[3]),p.scale$1(v,v,1/v[3]),f[2]=p.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,v[2]=p.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,p.scale$1(f,f,1/this.worldSize),p.scale$1(v,v,1/this.worldSize),new p.Ray([f[0],f[1],f[2]],p.normalize([],p.sub([],v,f)))}rayIntersectionCoordinate(a){const{p0:f,p1:v,t:C}=a,M=p.mercatorZfromAltitude(f[2],this._center.lat),O=p.mercatorZfromAltitude(v[2],this._center.lat);return new p.MercatorCoordinate(p.number(f[0],v[0],C)/this.worldSize,p.number(f[1],v[1],C)/this.worldSize,p.number(M,O,C))}pointCoordinate(a,f=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,f)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let f=this.projection.pointCoordinate3D(this,a.x,a.y);if(f)return new p.MercatorCoordinate(f[0],f[1],f[2]);let v=0,C=this.horizonLineFromTop();if(a.y>C)return this.pointCoordinate(a);const M=.02*C,O=a.clone();for(let k=0;k<10&&C-v>M;k++){O.y=p.number(v,C,.66);const B=this.projection.pointCoordinate3D(this,O.x,O.y);B?(C=O.y,f=B):v=O.y}return f?new p.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(a);const f=this.pointCoordinate(a);return f.y>=0&&f.y<=1}_coordinatePoint(a,f){const v=f&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,C=[a.x*this.worldSize,a.y*this.worldSize,v+a.toAltitude(),1];return p.transformMat4$1(C,C,this.pixelMatrix),C[3]>0?new p.Point(C[0]/C[3],C[1]/C[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:f}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,M=this.pointLocation3D(new p.Point(f,a)),O=this.pointLocation3D(new p.Point(C,a)),k=this.pointLocation3D(new p.Point(C,v)),B=this.pointLocation3D(new p.Point(f,v));let $=Math.min(M.lng,O.lng,k.lng,B.lng),j=Math.max(M.lng,O.lng,k.lng,B.lng),q=Math.min(M.lat,O.lat,k.lat,B.lat),ee=Math.max(M.lat,O.lat,k.lat,B.lat);const se=Math.pow(2,-this.zoom)/16*270,le="globe"===this.projection.name?1:4,ae=(ce,X,oe,fe,pe)=>{const Te=(ce+oe)/2,De=(X+fe)/2,Me=new p.Point(Te,De),{lng:ze,lat:Oe}=this.pointLocation3D(Me),Xe=Math.max(0,$-ze,q-Oe,ze-j,Oe-ee);$=Math.min($,ze),j=Math.max(j,ze),q=Math.min(q,Oe),ee=Math.max(ee,Oe),(pe<le||Xe>se)&&(ae(ce,X,Te,De,pe+1),ae(Te,De,oe,fe,pe+1))};if(ae(f,a,C,a,1),ae(C,a,C,v,1),ae(C,v,f,v,1),ae(f,v,f,a,1),"globe"===this.projection.name){const[ce,X]=p.polesInViewport(this);ce?(ee=90,j=180,$=-180):X&&(q=-90,j=180,$=-180)}return new p.LngLatBounds(new p.LngLat($,q),new p.LngLat(j,ee))}_getBoundsRectangular(a,f){const{top:v,left:C}=this._edgeInsets,M=this.height-this._edgeInsets.bottom,O=this.width-this._edgeInsets.right,k=new p.Point(C,v),B=new p.Point(O,v),$=new p.Point(O,M),j=new p.Point(C,M);let q=this.pointCoordinate(k,a),ee=this.pointCoordinate(B,a);const se=this.pointCoordinate($,f),le=this.pointCoordinate(j,f),ae=(ce,X)=>(X.y-ce.y)/(X.x-ce.x);return q.y>1&&ee.y>=0?q=new p.MercatorCoordinate((1-le.y)/ae(le,q)+le.x,1):q.y<0&&ee.y<=1&&(q=new p.MercatorCoordinate(-le.y/ae(le,q)+le.x,0)),ee.y>1&&q.y>=0?ee=new p.MercatorCoordinate((1-se.y)/ae(se,ee)+se.x,1):ee.y<0&&q.y<=1&&(ee=new p.MercatorCoordinate(-se.y/ae(se,ee)+se.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(se))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=a.visibleDemTiles.reduce((v,C)=>{if(C.dem){const M=C.dem.tree;v.min=Math.min(v.min,M.minimums[0]),v.max=Math.max(v.max,M.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*a.exaggeration(),f.max*a.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-f*(1-this._horizonShift);return a?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,f){return this.projection.createTileMatrix(this,f,a)}calculateDistanceTileData(a){const f=a.key,v=this._distanceTileDataCache;if(v[f])return v[f];const C=a.canonical,M=1/this.height,O=this.cameraWorldSize,k=O/this.zoomScale(C.z),B=(C.x+Math.pow(2,C.z)*a.wrap)*k,$=C.y*k,j=this.point;j.x*=O/this.worldSize,j.y*=O/this.worldSize;const q=this.angle,ee=Math.sin(-q),se=-Math.cos(-q);return v[f]={bearing:[ee,se],center:[(j.x-B)*M,(j.y-$)*M],scale:k/p.EXTENT*M},v[f]}calculateFogTileMatrix(a){const f=a.key,v=this._fogTileMatrixCache;if(v[f])return v[f];const C=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return p.multiply(C,this.worldToFogMatrix,C),v[f]=new Float32Array(C),v[f]}calculateProjMatrix(a,f=!1){const v=a.key,C=f?this._alignedProjMatrixCache:this._projMatrixCache;if(C[v])return C[v];const M=this.calculatePosMatrix(a,this.worldSize);return p.multiply(M,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,M),C[v]=new Float32Array(M),C[v]}calculatePixelsToTileUnitsMatrix(a){const f=a.tileID.key,v=this._pixelsToTileUnitsCache;if(v[f])return v[f];const C=function(M,O){const{scale:k}=M.tileTransform,B=k*p.EXTENT/(M.tileSize*Math.pow(2,O.zoom-M.tileID.overscaledZ+M.tileID.canonical.z));return $=new Float32Array(4),ee=(j=O.inverseAdjustmentMatrix)[1],se=j[2],le=j[3],ce=(q=[B,B])[1],$[0]=j[0]*(ae=q[0]),$[1]=ee*ae,$[2]=se*ce,$[3]=le*ce,$;var $,j,q,ee,se,le,ae,ce}(a,this);return v[f]=C,v[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const a=1/this.worldSize,f=p.fromScaling([],[a,a,a]);return p.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const a=this._elevation;this._updateCameraState();const f=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(f),C=this._camera.forward(),M=p.mercatorZfromAltitude(1,this._center.lat);v[2]/=M,C[2]/=M,p.normalize(C,C);const O=a.raycast(v,C,a.exaggeration());if(O){const k=p.scaleAndAdd([],v,C,O),B=new p.MercatorCoordinate(k[0],k[1],p.mercatorZfromAltitude(k[2],p.latFromMercatorY(k[1]))),$=(B.z+p.length([B.x-v[0],B.y-v[1],B.z-v[2]*M]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ($),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const f=this._elevation,v=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,C=this._computeCameraPosition(v),M=f.getAtPointOrZero(new p.MercatorCoordinate(...C)),O=this.pixelsPerMeter/this.worldSize*M,k=this._minimumHeightOverTerrain(),B=C[2]-O;if(B<=k)if(B<0||a){const $=this.locationCoordinate(this._center,this._centerAltitude),j=[C[0],C[1],$.z-C[2]],q=p.length(j);j[2]-=(k-B)/this._pixelsPerMercatorPixel;const ee=p.length(j);if(0===ee)return;p.scale$2(j,j,q/ee*this._pixelsPerMercatorPixel),this._camera.position=[C[0],C[1],$.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const ee=this.center;return ee.lat=p.clamp(ee.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(ee.lng=p.clamp(ee.lng,this.minLng,this.maxLng)),this.center=ee,void(this._constraining=!1)}const f=this._unmodified,{x:v,y:C}=this.point;let M=0,O=v,k=C;const B=this.width/2,$=this.height/2,j=this.worldMinY*this.scale,q=this.worldMaxY*this.scale;if(C-$<j&&(k=j+$),C+$>q&&(k=q-$),q-j<this.height&&(M=Math.max(M,this.height/(q-j)),k=(q+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ee=this.worldMinX*this.scale,se=this.worldMaxX*this.scale,le=this.worldSize/2-(ee+se)/2;O=(v+le+this.worldSize)%this.worldSize-le,O-B<ee&&(O=ee+B),O+B>se&&(O=se-B),se-ee<this.width&&(M=Math.max(M,this.width/(se-ee)),O=(se+ee)/2)}O===v&&k===C||(this.center=this.unproject(new p.Point(O,k))),M&&(this.zoom+=this.scaleZoom(M)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,f=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const v=Dc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const C="meters"===this.projection.zAxisUnit?f:1,M=this._camera.getWorldToCamera(this.worldSize,C),O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);O[8]=2*-a.x/this.width,O[9]=2*a.y/this.height;let k=p.mul([],O,M);if(this.projection.isReprojectedInTileSpace){const De=this.locationCoordinate(this.center),Me=p.identity([]);p.translate(Me,Me,[De.x*this.worldSize,De.y*this.worldSize,0]),p.multiply(Me,Me,Ur(this)),p.translate(Me,Me,[-De.x*this.worldSize,-De.y*this.worldSize,0]),p.multiply(k,k,Me),this.inverseAdjustmentMatrix=function(ze){const Oe=Ur(ze,!0);return Ne([],[Oe[0],Oe[1],Oe[4],Oe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],k,[this.worldSize,this.worldSize,this.worldSize/C,1]),this.projMatrix=k,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const B=p.invert([],O);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height);const $=new Float32Array(16);p.identity($),p.scale($,$,[1,-1,1]),p.rotateX($,$,this._pitch),p.rotateZ($,$,this.angle);const j=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-a.x/this.width,j[9]=2*(a.y+q)/this.height,this.skyboxMatrix=p.multiply($,j,$);const ee=this.point,se=ee.x,le=ee.y,ae=this.width%2/2,ce=this.height%2/2,X=Math.cos(this.angle),oe=Math.sin(this.angle),fe=se-Math.round(se)+X*ae+oe*ce,pe=le-Math.round(le)+X*ce+oe*ae,Te=new Float64Array(k);if(p.translate(Te,Te,[fe>.5?fe-1:fe,pe>.5?pe-1:pe,0]),this.alignedProjMatrix=Te,k=p.create(),p.scale(k,k,[this.width/2,-this.height/2,1]),p.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=p.create(),p.scale(k,k,[1,-1,1]),p.translate(k,k,[-1,-1,0]),p.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},k=p.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const De=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(De,De,M),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,v=this._camera.position,C=1/this.height/this._pixelsPerMercatorPixel,M=[a,a,f];p.scale$2(M,M,C),p.scale$2(v,v,-1),p.multiply$2(v,v,M);const O=p.create();p.translate(O,O,v),p.scale(O,O,M),this.mercatorFogMatrix=O,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,f,C)}_computeCameraPosition(a){const f=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),C=this.point,M=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-a/this.worldSize*this._centerAltitude;return[C.x/this.worldSize-v[0]*M,C.y/this.worldSize-v[1]*M,a/this.worldSize*this._centerAltitude-v[2]*M]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],C=a[2];let M=1;this.projection.wrap&&(this.center=this.center.wrap()),C>0&&(M=Math.min((f-v)/C,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,a,M),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,f=this._camera.forward(),{pitch:v,bearing:C}=this._camera.getPitchBearing(),M=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,O=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),k=Math.max((a[2]-M)/Math.cos(v),O),B=this._zoomFromMercatorZ(k);p.scaleAndAdd(a,a,f,k),this._pitch=p.clamp(v,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(C,-Math.PI,Math.PI),this._setZoom(p.clamp(B,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let f=0,v=p.GLOBE_ZOOM_THRESHOLD_MAX,C=0,M=1/0;for(;v-f>1e-6&&v>f;){const O=f+.5*(v-f),k=this.tileSize*Math.pow(2,O),B=this.getCameraToCenterDistance(this.projection,O,k),$=this.scaleZoom(B/(a*this.tileSize)),j=Math.abs(O-$);j<M&&(M=j,C=O),O<$?f=O:v=O}return C}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,f){const v=Math.min(a.x,f.x),C=Math.max(a.x,f.x),M=Math.min(a.y,f.y),O=Math.max(a.y,f.y);if(M<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const k=[new p.Point(v,M),new p.Point(C,O),new p.Point(v,O),new p.Point(C,M)],B=this.renderWorldCopies?-3:0,$=this.renderWorldCopies?4:1;for(const j of k){const q=this.pointRayIntersection(j);if(q.t<0)return!0;const ee=this.rayIntersectionCoordinate(q);if(ee.x<B||ee.y<0||ee.x>$||ee.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(a,f){const v=p.length(p.sub([],this._camera.position,a)),C=this._zoomFromMercatorZ(v)+f;return v-this._mercatorZfromZoom(C)}getCameraPoint(){if("globe"===this.projection.name){const a=function([f,v,C],M){const O=[f,v,C,1];p.transformMat4$1(O,O,M);const k=O[3]=Math.max(O[3],1e-6);return O[0]/=k,O[1]/=k,O[2]/=k,O}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,a))}}getCameraToCenterDistance(a,f=this.zoom,v=this.worldSize){const C=Dc(a,f,this.width,this.height,1024),M=a.pixelSpaceConversion(this.center.lat,v,C);return.5/Math.tan(.5*this._fov)*this.height*M}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(a,a,this.globeMatrix),a}}function Mc(_,a){let f=!1,v=null;const C=()=>{v=null,f&&(_(),v=setTimeout(C,a),f=!1)};return()=>(f=!0,v||C(),v)}class da{constructor(a){this._hashName=a&&encodeURIComponent(a),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Mc(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,p.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const f=Sc(a);if(this._hashName){const v=this._hashName;let C=!1;const M=p.window.location.hash.slice(1).split("&").map(O=>{const k=O.split("=")[0];return k===v?(C=!0,`${k}=${f}`):O}).filter(O=>O);return C||M.push(`${v}=${f}`),`#${M.join("&")}`}return`#${f}`}_getCurrentHash(){const a=p.window.location.hash.replace("#","");if(this._hashName){let f;return a.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(f=v)}),(f&&f[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(v=>isNaN(v))){const v=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(f[3]||0):a.getBearing();return a.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:v,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,a)}}function Sc(_,a){const f=_.getCenter(),v=Math.round(100*_.getZoom())/100,C=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,C),O=Math.round(f.lng*M)/M,k=Math.round(f.lat*M)/M,B=_.getBearing(),$=_.getPitch();let j=a?`/${O}/${k}/${v}`:`${v}/${k}/${O}`;return(B||$)&&(j+="/"+Math.round(10*B)/10),$&&(j+=`/${Math.round($)}`),j}const wu={linearity:.3,easing:p.bezier(0,0,.3,1)},Eu=p.extend({deceleration:2500,maxSpeed:1400},wu),Ic=p.extend({deceleration:20,maxSpeed:1400},wu),tn=p.extend({deceleration:1e3,maxSpeed:360},wu),cs=p.extend({deceleration:1e3,maxSpeed:90},wu);class Xn{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,f=p.exported.now();for(;a.length>0&&f-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)f.zoom+=M.zoomDelta||0,f.bearing+=M.bearingDelta||0,f.pitch+=M.pitchDelta||0,M.panDelta&&f.pan._add(M.panDelta),M.around&&(f.around=M.around),M.pinchAround&&(f.pinchAround=M.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,C={};if(f.pan.mag()){const M=Du(f.pan.mag(),v,p.extend({},Eu,a||{}));C.offset=f.pan.mult(M.amount/f.pan.mag()),C.center=this._map.transform.center,Cu(C,M)}if(f.zoom){const M=Du(f.zoom,v,Ic);C.zoom=this._map.transform.zoom+M.amount,Cu(C,M)}if(f.bearing){const M=Du(f.bearing,v,tn);C.bearing=this._map.transform.bearing+p.clamp(M.amount,-179,179),Cu(C,M)}if(f.pitch){const M=Du(f.pitch,v,cs);C.pitch=this._map.transform.pitch+M.amount,Cu(C,M)}if(C.zoom||C.bearing){const M=void 0===f.pinchAround?f.around:f.pinchAround;C.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),C.noMoveStart=!0,C}}function Cu(_,a){(!_.duration||_.duration<a.duration)&&(_.duration=a.duration,_.easing=a.easing)}function Du(_,a,f){const{maxSpeed:v,linearity:C,deceleration:M}=f,O=p.clamp(_*C/(a/1e3),-v,v),k=Math.abs(O)/(M*C);return{easing:f.easing,duration:1e3*k,amount:O*(k/2)}}class eo extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v,C={}){const M=cn(f.getCanvasContainer(),v),O=f.unproject(M);super(a,p.extend({point:M,lngLat:O,originalEvent:v},C)),this._defaultPrevented=!1,this.target=f}}class Hl extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v){const C="touchend"===a?v.changedTouches:v.touches,M=Dn(f.getCanvasContainer(),C),O=M.map(B=>f.unproject(B)),k=M.reduce((B,$,j,q)=>B.add($.div(q.length)),new p.Point(0,0));super(a,{points:M,point:k,lngLats:O,lngLat:f.unproject(k),originalEvent:v}),this._defaultPrevented=!1}}class Tu extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v){super(a,{originalEvent:v}),this._defaultPrevented=!1}}class Td{constructor(a,f){this._map=a,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Tu(a.type,this._map,a))}mousedown(a,f){return this._mousedownPos=f,this._firePreventable(new eo(a.type,this._map,a))}mouseup(a){this._map.fire(new eo(a.type,this._map,a))}preclick(a){const f=p.extend({},a);f.type="preclick",this._map.fire(new eo(f.type,this._map,f))}click(a,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(a),this._map.fire(new eo(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new eo(a.type,this._map,a))}mouseover(a){this._map.fire(new eo(a.type,this._map,a))}mouseout(a){this._map.fire(new eo(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Hl(a.type,this._map,a))}touchmove(a){this._map.fire(new Hl(a.type,this._map,a))}touchend(a){this._map.fire(new Hl(a.type,this._map,a))}touchcancel(a){this._map.fire(new Hl(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ha{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new eo(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new eo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new eo(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ap{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,f){this.isEnabled()&&a.shiftKey&&0===a.button&&(Wt(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(a,f){if(!this._active)return;const v=f,C=this._startPos,M=this._lastPos;if(!C||!M||M.equals(v)||!this._box&&v.dist(C)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=Ie("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const O=Math.min(C.x,v.x),k=Math.max(C.x,v.x),B=Math.min(C.y,v.y),$=Math.max(C.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${O}px,${B}px)`,this._box.style.width=k-O+"px",this._box.style.height=$-B+"px")})}mouseupWindow(a,f){if(!this._active)return;const v=this._startPos,C=f;if(v&&0===a.button){if(this.reset(),En(),v.x!==C.x||v.y!==C.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:M=>M.fitScreenCoordinates(v,C,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&27===a.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),nn(),delete this._startPos,delete this._lastPos}_fireEvent(a,f){return this._map.fire(new p.Event(a,{originalEvent:f}))}}function Md(_,a){const f={};for(let v=0;v<_.length;v++)f[_[v].identifier]=a[v];return f}class Ac{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,f,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=a.timeStamp),v.length===this.numTouches&&(this.centroid=function(C){const M=new p.Point(0,0);for(const O of C)M._add(O);return M.div(C.length)}(f),this.touches=Md(v,f)))}touchmove(a,f,v){if(this.aborted||!this.centroid)return;const C=Md(v,f);for(const M in this.touches){const O=C[M];(!O||O.dist(this.touches[M])>30)&&(this.aborted=!0)}}touchend(a,f,v){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),0===v.length){const C=!this.aborted&&this.centroid;if(this.reset(),C)return C}}}class lp{constructor(a){this.singleTap=new Ac(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,f,v){this.singleTap.touchstart(a,f,v)}touchmove(a,f,v){this.singleTap.touchmove(a,f,v)}touchend(a,f,v){const C=this.singleTap.touchend(a,f,v);if(C){const M=a.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(C)<30;if(M&&O||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=C,this.count===this.numTaps)return this.reset(),C}}}class A_{constructor(){this._zoomIn=new lp({numTouches:1,numTaps:2}),this._zoomOut=new lp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,f,v){this._zoomIn.touchstart(a,f,v),this._zoomOut.touchstart(a,f,v)}touchmove(a,f,v){this._zoomIn.touchmove(a,f,v),this._zoomOut.touchmove(a,f,v)}touchend(a,f,v){const C=this._zoomIn.touchend(a,f,v),M=this._zoomOut.touchend(a,f,v);return C?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()+1,around:O.unproject(C)},{originalEvent:a})}):M?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()-1,around:O.unproject(M)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Nt={0:1,2:2};class yi{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,f){return!1}_move(a,f){return{}}mousedown(a,f){if(this._lastPoint)return;const v=pn(a);this._correctButton(a,v)&&(this._lastPoint=f,this._eventButton=v)}mousemoveWindow(a,f){const v=this._lastPoint;if(v)if(a.preventDefault(),null!=this._eventButton&&function(C,M){const O=Nt[M];return void 0===C.buttons||(C.buttons&O)!==O}(a,this._eventButton))this.reset();else if(this._moved||!(f.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(v,f)}mouseupWindow(a){this._lastPoint&&pn(a)===this._eventButton&&(this._moved&&En(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sd extends yi{mousedown(a,f){super.mousedown(a,f),this._lastPoint&&(this._active=!0)}_correctButton(a,f){return 0===f&&!a.ctrlKey}_move(a,f){return{around:f,panDelta:f.sub(a)}}}class Id extends yi{_correctButton(a,f){return 0===f&&a.ctrlKey||2===f}_move(a,f){const v=.8*(f.x-a.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(a){a.preventDefault()}}class Zr extends yi{_correctButton(a,f){return 0===f&&a.ctrlKey||2===f}_move(a,f){const v=-.5*(f.y-a.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(a){a.preventDefault()}}class Pc{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(a,f,v){return this._calculateTransform(a,f,v)}touchmove(a,f,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===v.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,f,v)}}touchend(a,f,v){this._calculateTransform(a,f,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,f,v){v.length>0&&(this._active=!0);const C=Md(v,f),M=new p.Point(0,0),O=new p.Point(0,0);let k=0;for(const $ in C){const j=C[$],q=this._touches[$];q&&(M._add(j),O._add(j.sub(q)),k++,C[$]=j)}if(this._touches=C,k<this._minTouches||!O.mag())return;const B=O.div(k);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(k),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ie("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ba{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,f,v){return{}}touchstart(a,f,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([f[0],f[1]]))}touchmove(a,f,v){const C=this._firstTwoTouches;if(!C)return;a.preventDefault();const[M,O]=C,k=Ko(v,f,M),B=Ko(v,f,O);if(!k||!B)return;const $=this._aroundCenter?null:k.add(B).div(2);return this._move([k,B],$,a)}touchend(a,f,v){if(!this._firstTwoTouches)return;const[C,M]=this._firstTwoTouches,O=Ko(v,f,C),k=Ko(v,f,M);O&&k||(this._active&&En(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ko(_,a,f){for(let v=0;v<_.length;v++)if(_[v].identifier===f)return a[v]}function Rc(_,a){return Math.log(_/a)/Math.LN2}class Mu extends Ba{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,f){const v=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Rc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Rc(this._distance,v),pinchAround:f}}}function Ad(_,a){return 180*_.angleWith(a)/Math.PI}class P_ extends Ba{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,f){const v=this._vector;if(this._vector=a[0].sub(a[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ad(this._vector,v),pinchAround:f}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const f=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const C=Ad(a,v);return Math.abs(C)<f}}function za(_){return Math.abs(_.y)>Math.abs(_.x)}class zo extends Ba{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,za(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,f,v){const C=this._lastPoints;if(!C)return;const M=a[0].sub(C[0]),O=a[1].sub(C[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(M,O,v.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(M.y+O.y)/2*-.5})}gestureBeginsVertically(a,f,v){if(void 0!==this._valid)return this._valid;const C=a.mag()>=2,M=f.mag()>=2;if(!C&&!M)return;if(!C||!M)return null==this._firstMove&&(this._firstMove=v),v-this._firstMove<100&&void 0;const O=a.y>0==f.y>0;return za(a)&&za(f)&&O}}const fa={panStep:100,bearingStep:15,pitchStep:10};class jh{constructor(){const a=fa;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let f=0,v=0,C=0,M=0,O=0;switch(a.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:a.shiftKey?v=-1:(a.preventDefault(),M=-1);break;case 39:a.shiftKey?v=1:(a.preventDefault(),M=1);break;case 38:a.shiftKey?C=1:(a.preventDefault(),O=-1);break;case 40:a.shiftKey?C=-1:(a.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(v=0,C=0),{cameraAnimation:k=>{const B=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:yl,zoom:f?Math.round(B)+f*(a.shiftKey?2:1):B,bearing:k.getBearing()+v*this._bearingStep,pitch:k.getPitch()+C*this._pitchStep,offset:[-M*this._panStep,-O*this._panStep],center:k.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function yl(_){return _*(2-_)}const to=4.000244140625;class cp{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=a.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const v=p.exported.now(),C=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,0!==f&&f%to==0?this._type="wheel":0!==f&&Math.abs(f)<4?this._type="trackpad":C>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(C*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),a.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=a,this._delta-=f,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=cn(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;"wheel"===this._type&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(0!==this._delta){const B="wheel"===this._type&&Math.abs(this._delta)>to?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&0!==$&&($=1/$);const j=f(),q=Math.pow(2,j),ee="number"==typeof this._targetZoom?a.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(ee*$))),"wheel"===this._type&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._delta=0}const v="number"==typeof this._targetZoom?this._targetZoom:f(),C=this._startZoom,M=this._easing;let O,k=!1;if("wheel"===this._type&&C&&M){const B=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),$=M(B);O=p.number(C,v,$),B<1?this._frameId||(this._frameId=!0):k=!0}else O=v,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!k,zoomDelta:O-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let f=p.ease;if(this._prevEase){const v=this._prevEase,C=(p.exported.now()-v.start)/v.duration,M=v.easing(C+.01)-v.easing(C),O=.27/Math.sqrt(M*M+1e-4)*.01,k=Math.sqrt(.0729-O*O);f=p.bezier(O,k,.25,1)}return this._prevEase={start:p.exported.now(),duration:a,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ie("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class $h{constructor(a,f){this._clickZoom=a,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class no{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,f){return a.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(a.shiftKey?-1:1),around:v.unproject(f)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class up{constructor(){this._tap=new lp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,f,v){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=f[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(a,f,v))}touchmove(a,f,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const C=f[0],M=C.y-this._swipePoint.y;return this._swipePoint=C,a.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(a,f,v)}touchend(a,f,v){this._tapTime?this._swipePoint&&0===v.length&&this.reset():this._tap.touchend(a,f,v)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hh{constructor(a,f,v){this._el=a,this._mousePan=f,this._touchPan=v}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class dp{constructor(a,f,v){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=f,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Hm{constructor(a,f,v,C){this._el=a,this._touchZoom=f,this._touchRotate=v,this._tapDragZoom=C,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Jo=_=>_.zoom||_.drag||_.pitch||_.rotate;class Gm extends p.Event{}class Wm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,f){const v=p.sub([],f,a);this.radius=p.length(v[2]<0?p.div([],v,this.constants):[v[0],v[1],0])}projectRay(a){p.div(a,a,this.constants),p.normalize(a,a),p.mul$1(a,a,this.constants);const f=p.scale$2([],a,this.radius);if(f[2]>0){const v=p.scale$2([],[0,0,1],p.dot(f,[0,0,1])),C=p.scale$2([],p.normalize([],[f[0],f[1],0]),this.radius),M=p.add([],f,p.scale$2([],p.sub([],p.add([],C,v),f),2));f[0]=M[0],f[1]=M[1]}return f}}function Ps(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class pa{constructor(a,f){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xn(a),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),p.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[C,M,O]of this._listeners)C.addEventListener(M,C===p.window.document?this.handleWindowEvent:this.handleEvent,O)}destroy(){for(const[a,f,v]of this._listeners)a.removeEventListener(f,a===p.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(a){const f=this._map,v=f.getCanvasContainer();this._add("mapEvent",new Td(f,a));const C=f.boxZoom=new ap(f,a);this._add("boxZoom",C);const M=new A_,O=new no;f.doubleClickZoom=new $h(O,M),this._add("tapZoom",M),this._add("clickZoom",O);const k=new up;this._add("tapDragZoom",k);const B=f.touchPitch=new zo(f);this._add("touchPitch",B);const $=new Id(a),j=new Zr(a);f.dragRotate=new dp(a,$,j),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const q=new Sd(a),ee=new Pc(f,a);f.dragPan=new Hh(v,q,ee),this._add("mousePan",q),this._add("touchPan",ee,["touchZoom","touchRotate"]);const se=new P_,le=new Mu;f.touchZoomRotate=new Hm(v,le,se,k),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ha(f));const ae=f.scrollZoom=new cp(f,this);this._add("scrollZoom",ae,["mousePan"]);const ce=f.keyboard=new jh;this._add("keyboard",ce);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[X]&&f[X].enable(a[X])}_add(a,f,v){this._handlers.push({handlerName:a,handler:f,allowed:v}),this._handlersById[a]=f}stop(a){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Jo(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,f,v){for(const C in a)if(C!==v&&(!f||f.indexOf(C)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const f=[];for(const v of a)this._el.contains(v.target)&&f.push(v);return f}handleEvent(a,f){this._updatingCamera=!0;const v="renderFrame"===a.type,C=v?void 0:a,M={needsRenderFrame:!1},O={},k={},B=a.touches?this._getMapTouches(a.touches):void 0,$=B?Dn(this._el,B):v?void 0:cn(this._el,a);for(const{handlerName:ee,handler:se,allowed:le}of this._handlers){if(!se.isEnabled())continue;let ae;this._blockedByActive(k,le,ee)?se.reset():se[f||a.type]&&(ae=se[f||a.type](a,$,B),this.mergeHandlerResult(M,O,ae,ee,C),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()),(ae||se.isActive())&&(k[ee]=se)}const j={};for(const ee in this._previousActiveHandlers)k[ee]||(j[ee]=C);this._previousActiveHandlers=k,(Object.keys(j).length||Ps(M))&&(this._changes.push([M,O,j]),this._triggerRenderFrame()),(Object.keys(k).length||Ps(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=M;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))}mergeHandlerResult(a,f,v,C,M){if(!v)return;p.extend(a,v);const O={handlerName:C,originalEvent:v.originalEvent||M};void 0!==v.zoomDelta&&(f.zoom=O),void 0!==v.panDelta&&(f.drag=O),void 0!==v.pitchDelta&&(f.pitch=O),void 0!==v.bearingDelta&&(f.rotate=O)}_applyChanges(){const a={},f={},v={};for(const[C,M,O]of this._changes)C.panDelta&&(a.panDelta=(a.panDelta||new p.Point(0,0))._add(C.panDelta)),C.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+C.zoomDelta),C.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+C.bearingDelta),C.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+C.pitchDelta),void 0!==C.around&&(a.around=C.around),void 0!==C.aroundCoord&&(a.aroundCoord=C.aroundCoord),void 0!==C.pinchAround&&(a.pinchAround=C.pinchAround),C.noInertia&&(a.noInertia=C.noInertia),p.extend(f,M),p.extend(v,O);this._updateMapTransform(a,f,v),this._changes=[]}_updateMapTransform(a,f,v){const C=this._map,M=C.transform,O=oe=>[oe.x,oe.y,oe.z];if((oe=>{const fe=this._eventsInProgress.drag;return fe&&!this._handlersById[fe.handlerName].isActive()})()&&!Ps(a)){const oe=M.zoom;M.cameraElevationReference="sea",M.recenterOnTerrain(),M.cameraElevationReference="ground",oe!==M.zoom&&this._map._update(!0)}if(M._isCameraConstrained&&C._stop(!0),!Ps(a))return void this._fireEvents(f,v,!0);let{panDelta:k,zoomDelta:B,bearingDelta:$,pitchDelta:j,around:q,aroundCoord:ee,pinchAround:se}=a;M._isCameraConstrained&&(B>0&&(B=0),M._isCameraConstrained=!1),void 0!==se&&(q=se),(B||(oe=>f.drag&&!this._eventsInProgress.drag)())&&q&&(this._dragOrigin=O(M.pointCoordinate3D(q)),this._trackingEllipsoid.setup(M._camera.position,this._dragOrigin)),M.cameraElevationReference="sea",C._stop(!0),q=q||C.transform.centerPoint,$&&(M.bearing+=$),j&&(M.pitch+=j),M._updateCameraState();const le=[0,0,0];if(k)if("mercator"===M.projection.name){const oe=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(q).dir),fe=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(q.sub(k)).dir);le[0]=fe[0]-oe[0],le[1]=fe[1]-oe[1]}else{const oe=M.pointCoordinate(q);if("globe"===M.projection.name){k=k.rotate(-M.angle);const fe=M._pixelsPerMercatorPixel/M.worldSize;le[0]=-k.x*p.mercatorScale(p.latFromMercatorY(oe.y))*fe,le[1]=-k.y*p.mercatorScale(M.center.lat)*fe}else{const fe=M.pointCoordinate(q.sub(k));oe&&fe&&(le[0]=fe.x-oe.x,le[1]=fe.y-oe.y)}}const ae=M.zoom,ce=[0,0,0];if(B){const oe=O(ee||M.pointCoordinate3D(q)),fe={dir:p.normalize([],p.sub([],oe,M._camera.position))};if(fe.dir[2]<0){const pe=M.zoomDeltaToMovement(oe,B);p.scale$2(ce,fe.dir,pe)}}const X=p.add(le,le,ce);M._translateCameraConstrained(X),B&&Math.abs(M.zoom-ae)>1e-4&&M.recenterOnTerrain(),M.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(f,v,!0)}_fireEvents(a,f,v){const C=Jo(this._eventsInProgress),M=Jo(a),O={};for(const j in a){const{originalEvent:q}=a[j];this._eventsInProgress[j]||(O[`${j}start`]=q),this._eventsInProgress[j]=a[j]}!C&&M&&this._fireEvent("movestart",M.originalEvent);for(const j in O)this._fireEvent(j,O[j]);M&&this._fireEvent("move",M.originalEvent);for(const j in a){const{originalEvent:q}=a[j];this._fireEvent(j,q)}const k={};let B;for(const j in this._eventsInProgress){const{handlerName:q,originalEvent:ee}=this._eventsInProgress[j];this._handlersById[q].isActive()||(delete this._eventsInProgress[j],B=f[q]||ee,k[`${j}end`]=B)}for(const j in k)this._fireEvent(j,k[j]);const $=Jo(this._eventsInProgress);if(v&&(C||M)&&!$){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=ee=>0!==ee&&-this._bearingSnap<ee&&ee<this._bearingSnap;j?(q(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:B})):(this._map.fire(new p.Event("moveend",{originalEvent:B})),q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,f){this._map.fire(new p.Event(a,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new Gm("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Gl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Pd extends p.Evented{constructor(a,f){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=!1!==f.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,f){return this.jumpTo({center:a},f)}panBy(a,f,v){return a=p.Point.convert(a).mult(-1),this.panTo(this.transform.center,p.extend({offset:a},f),v)}panTo(a,f,v){return this.easeTo(p.extend({center:a},f),v)}getZoom(){return this.transform.zoom}setZoom(a,f){return this.jumpTo({zoom:a},f),this}zoomTo(a,f,v){return this.easeTo(p.extend({zoom:a},f),v)}zoomIn(a,f){return this.zoomTo(this.getZoom()+1,a,f),this}zoomOut(a,f){return this.zoomTo(this.getZoom()-1,a,f),this}getBearing(){return this.transform.bearing}setBearing(a,f){return this.jumpTo({bearing:a},f),this}getPadding(){return this.transform.padding}setPadding(a,f){return this.jumpTo({padding:a},f),this}rotateTo(a,f,v){return this.easeTo(p.extend({bearing:a},f),v)}resetNorth(a,f){return this.rotateTo(0,p.extend({duration:1e3},a),f),this}resetNorthPitch(a,f){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},a),f),this}snapToNorth(a,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,f):this}getPitch(){return this.transform.pitch}setPitch(a,f){return this.jumpTo({pitch:a},f),this}cameraForBounds(a,f){a=p.LngLatBounds.convert(a);const v=f&&f.bearing||0,C=f&&f.pitch||0,M=a.getNorthWest(),O=a.getSouthEast();return this._cameraForBounds(this.transform,M,O,v,C,f)}_extendCameraOptions(a){const f={top:0,bottom:0,right:0,left:0};if("number"==typeof(a=p.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding){const v=a.padding;a.padding={top:v,bottom:v,right:v,left:v}}return a.padding=p.extend(f,a.padding),a}_minimumAABBFrustumDistance(a,f){const v=f.max[0]-f.min[0],C=f.max[1]-f.min[1];return v/C>a.aspect?v/(2*Math.tan(.5*a.fovX)*a.aspect):C/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,f,v,C,M,O){const k=a.clone(),B=this._extendCameraOptions(O);k.bearing=C,k.pitch=M;const $=p.LngLat.convert(f),j=p.LngLat.convert(v),q=.5*($.lat+j.lat),ee=.5*($.lng+j.lng),se=p.latLngToECEF(q,ee),le=p.normalize([],se),ae=p.normalize([],p.cross([],le,[0,1,0])),ce=p.cross([],ae,le),X=[ae[0],ae[1],ae[2],0,ce[0],ce[1],ce[2],0,le[0],le[1],le[2],0,0,0,0,1],oe=[se,p.latLngToECEF($.lat,$.lng),p.latLngToECEF(j.lat,$.lng),p.latLngToECEF(j.lat,j.lng),p.latLngToECEF($.lat,j.lng),p.latLngToECEF(q,$.lng),p.latLngToECEF(q,j.lng),p.latLngToECEF($.lat,ee),p.latLngToECEF(j.lat,ee)];let fe=p.Aabb.fromPoints(oe.map(ft=>[p.dot(ae,ft),p.dot(ce,ft),p.dot(le,ft)]));const pe=p.transformMat4([],fe.center,X);0===p.squaredLength(pe)&&p.set(pe,0,0,1),p.normalize(pe,pe),p.scale$2(pe,pe,p.GLOBE_RADIUS),k.center=p.ecefToLatLng(pe);const Te=k.getWorldToCameraMatrix(),De=p.invert(new Float64Array(16),Te);fe=p.Aabb.applyTransform(fe,p.multiply([],Te,X)),p.transformMat4(pe,pe,Te);const Me=.5*(fe.max[2]-fe.min[2]),ze=this._minimumAABBFrustumDistance(k,fe),Oe=p.scale$2([],[0,0,1],Me),Xe=p.add(Oe,pe,Oe),At=ze+(0===k.pitch?0:p.distance(pe,Xe)),Ve=k.globeCenterInViewSpace,ht=p.sub([],pe,[Ve[0],Ve[1],Ve[2]]);p.normalize(ht,ht),p.scale$2(ht,ht,At);const tt=p.add([],pe,ht);p.transformMat4(tt,tt,De);const _t=p.earthRadius/p.GLOBE_RADIUS,He=p.length(tt),ct=p.mercatorZfromAltitude(Math.max(He*_t-p.earthRadius,Number.EPSILON),0),Lt=Math.min(k.zoomFromMercatorZAdjusted(ct),B.maxZoom);return Lt>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(k.setProjection({name:"mercator"}),k.zoom=Lt,this._cameraForBounds(k,f,v,C,M,O)):{center:k.center,zoom:Lt,bearing:C,pitch:M}}queryTerrainElevation(a,f){const v=this.transform.elevation;return v?(f=p.extend({},{exaggerated:!0},f),v.getAtPoint(p.MercatorCoordinate.fromLngLat(a),null,f.exaggerated)):null}_cameraForBounds(a,f,v,C,M,O){if("globe"===a.projection.name)return this._cameraForBoundsOnGlobe(a,f,v,C,M,O);const k=a.clone(),B=this._extendCameraOptions(O),$=k.padding;k.bearing=C,k.pitch=M;const j=p.LngLat.convert(f),q=p.LngLat.convert(v),ee=new p.LngLat(j.lng,q.lat),se=new p.LngLat(q.lng,j.lat),le=k.project(j),ae=k.project(q),ce=this.queryTerrainElevation(j),X=this.queryTerrainElevation(q),oe=this.queryTerrainElevation(ee),fe=this.queryTerrainElevation(se),pe=[[le.x,le.y,Math.min(ce||0,X||0,oe||0,fe||0)],[ae.x,ae.y,Math.max(ce||0,X||0,oe||0,fe||0)]];let Te=p.Aabb.fromPoints(pe);const De=k.getWorldToCameraMatrix(),Me=p.invert(new Float64Array(16),De);Te=p.Aabb.applyTransform(Te,De);const ze=p.sub([],Te.max,Te.min),Oe=$.left||0,Xe=$.right||0,At=$.bottom||0,Ve=$.top||0,{left:ht,right:tt,top:_t,bottom:He}=B.padding,ct=.5*(Oe+Xe),Lt=.5*(Ve+At),ft=Math.min(k.scaleZoom(k.scale*Math.min((k.width-(Oe+Xe+ht+tt))/ze[0],(k.height-(At+Ve+He+_t))/ze[1])),B.maxZoom),Ct=k.scale/k.zoomScale(ft);Te=new p.Aabb([Te.min[0]-(ht+ct)*Ct,Te.min[1]-(He+Lt)*Ct,Te.min[2]],[Te.max[0]+(tt+ct)*Ct,Te.max[1]+(_t+Lt)*Ct,Te.max[2]]);const vn=.5*ze[2],Rn=this._minimumAABBFrustumDistance(k,Te),sn=[0,0,1,0];p.transformMat4$1(sn,sn,De),p.normalize$2(sn,sn);const bn=p.scale$2([],sn,Rn+vn),Kn=p.add([],Te.center,bn),Mn=("number"==typeof B.offset.x&&"number"==typeof B.offset.y?new p.Point(B.offset.x,B.offset.y):p.Point.convert(B.offset)).rotate(-p.degToRad(C));Te.center[0]-=Mn.x*Ct,Te.center[1]+=Mn.y*Ct,p.transformMat4(Te.center,Te.center,Me),p.transformMat4(Kn,Kn,Me);const an=[Te.center[0],Te.center[1],Kn[2]*k.pixelsPerMeter];p.scale$2(an,an,1/k.worldSize);const Ai=p.lngFromMercatorX(an[0]),ii=p.latFromMercatorY(an[1]),Gi=Math.min(k._zoomFromMercatorZ(an[2]),B.maxZoom),ki=new p.LngLat(Ai,ii);return k.mercatorFromTransition&&Gi<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(k.setProjection({name:"globe"}),k.zoom=Gi,this._cameraForBounds(k,f,v,C,M,O)):{center:ki,zoom:Gi,bearing:C,pitch:M}}fitBounds(a,f,v){const C=this.cameraForBounds(a,f);return this._fitInternal(C,f,v)}fitScreenCoordinates(a,f,v,C,M){const O=p.Point.convert(a),k=p.Point.convert(f),B=new p.Point(Math.min(O.x,k.x),Math.min(O.y,k.y)),$=new p.Point(Math.max(O.x,k.x),Math.max(O.y,k.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(O,k))return this;const j=this.transform.pointLocation3D(B),q=this.transform.pointLocation3D($),ee=this.transform.pointLocation3D(new p.Point(B.x,$.y)),se=this.transform.pointLocation3D(new p.Point($.x,B.y)),le=[Math.min(j.lng,q.lng,ee.lng,se.lng),Math.min(j.lat,q.lat,ee.lat,se.lat)],ae=[Math.max(j.lng,q.lng,ee.lng,se.lng),Math.max(j.lat,q.lat,ee.lat,se.lat)],ce=C&&C.pitch?C.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,le,ae,v,ce,C);return this._fitInternal(X,C,M)}_fitInternal(a,f,v){return a?(delete(f=p.extend(a,f)).padding,f.linear?this.easeTo(f,v):this.flyTo(f,v)):this}jumpTo(a,f){this.stop();const v=a.preloadOnly?this.transform.clone():this.transform;let C=!1,M=!1,O=!1;return"zoom"in a&&v.zoom!==+a.zoom&&(C=!0,v.zoom=+a.zoom),void 0!==a.center&&(v.center=p.LngLat.convert(a.center)),"bearing"in a&&v.bearing!==+a.bearing&&(M=!0,v.bearing=+a.bearing),"pitch"in a&&v.pitch!==+a.pitch&&(O=!0,v.pitch=+a.pitch),null==a.padding||v.isPaddingEqual(a.padding)||(v.padding=a.padding),a.preloadOnly?(this._preloadTiles(v),this):(this.fire(new p.Event("movestart",f)).fire(new p.Event("move",f)),C&&this.fire(new p.Event("zoomstart",f)).fire(new p.Event("zoom",f)).fire(new p.Event("zoomend",f)),M&&this.fire(new p.Event("rotatestart",f)).fire(new p.Event("rotate",f)).fire(new p.Event("rotateend",f)),O&&this.fire(new p.Event("pitchstart",f)).fire(new p.Event("pitch",f)).fire(new p.Event("pitchend",f)),this.fire(new p.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Gl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,f){const v=this.transform;if(!v.projection.supportsFreeCamera)return p.warnOnce(Gl),this;this.stop();const C=v.zoom,M=v.pitch,O=v.bearing;v.setFreeCameraOptions(a);const k=C!==v.zoom,B=M!==v.pitch,$=O!==v.bearing;return this.fire(new p.Event("movestart",f)).fire(new p.Event("move",f)),k&&this.fire(new p.Event("zoomstart",f)).fire(new p.Event("zoom",f)).fire(new p.Event("zoomend",f)),$&&this.fire(new p.Event("rotatestart",f)).fire(new p.Event("rotate",f)).fire(new p.Event("rotateend",f)),B&&this.fire(new p.Event("pitchstart",f)).fire(new p.Event("pitch",f)).fire(new p.Event("pitchend",f)),this.fire(new p.Event("moveend",f)),this}easeTo(a,f){this._stop(!1,a.easeId),(!1===(a=p.extend({offset:[0,0],duration:500,easing:p.ease},a)).animate||this._prefersReducedMotion(a))&&(a.duration=0);const v=this.transform,C=this.getZoom(),M=this.getBearing(),O=this.getPitch(),k=this.getPadding(),B="zoom"in a?+a.zoom:C,$="bearing"in a?this._normalizeBearing(a.bearing,M):M,j="pitch"in a?+a.pitch:O,q="padding"in a?a.padding:v.padding,ee=p.Point.convert(a.offset);let se,le,ae;if("globe"===v.projection.name){const Oe=p.MercatorCoordinate.fromLngLat(v.center),Xe=ee.rotate(-v.angle);Oe.x+=Xe.x/v.worldSize,Oe.y+=Xe.y/v.worldSize;const At=Oe.toLngLat(),Ve=p.LngLat.convert(a.center||At);this._normalizeCenter(Ve),se=v.centerPoint.add(Xe),le=new p.Point(Oe.x,Oe.y).mult(v.worldSize),ae=new p.Point(p.mercatorXfromLng(Ve.lng),p.mercatorYfromLat(Ve.lat)).mult(v.worldSize).sub(le)}else{se=v.centerPoint.add(ee);const Oe=v.pointLocation(se),Xe=p.LngLat.convert(a.center||Oe);this._normalizeCenter(Xe),le=v.project(Oe),ae=v.project(Xe).sub(le)}const ce=v.zoomScale(B-C);let X,oe;a.around&&(X=p.LngLat.convert(a.around),oe=v.locationPoint(X));const fe=this._zooming||B!==C,pe=this._rotating||M!==$,Te=this._pitching||j!==O,De=!v.isPaddingEqual(q),Me=Oe=>Xe=>{if(fe&&(Oe.zoom=p.number(C,B,Xe)),pe&&(Oe.bearing=p.number(M,$,Xe)),Te&&(Oe.pitch=p.number(O,j,Xe)),De&&(Oe.interpolatePadding(k,q,Xe),se=Oe.centerPoint.add(ee)),X)Oe.setLocationAtPoint(X,oe);else{const At=Oe.zoomScale(Oe.zoom-C),Ve=B>C?Math.min(2,ce):Math.max(.5,ce),ht=Math.pow(Ve,1-Xe),tt=Oe.unproject(le.add(ae.mult(Xe*ht)).mult(At));Oe.setLocationAtPoint(Oe.renderWorldCopies?tt.wrap():tt,se)}return a.preloadOnly||this._fireMoveEvents(f),Oe};if(a.preloadOnly){const Oe=this._emulate(Me,a.duration,v);return this._preloadTiles(Oe),this}const ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=pe,this._pitching=Te,this._padding=De,this._easeId=a.easeId,this._prepareEase(f,a.noMoveStart,ze),this._ease(Me(v),Oe=>{v.recenterOnTerrain(),this._afterEase(f,Oe)},a),this}_prepareEase(a,f,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||v.moving||this.fire(new p.Event("movestart",a)),this._zooming&&!v.zooming&&this.fire(new p.Event("zoomstart",a)),this._rotating&&!v.rotating&&this.fire(new p.Event("rotatestart",a)),this._pitching&&!v.pitching&&this.fire(new p.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new p.Event("move",a)),this._zooming&&this.fire(new p.Event("zoom",a)),this._rotating&&this.fire(new p.Event("rotate",a)),this._pitching&&this.fire(new p.Event("pitch",a))}_afterEase(a,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,C=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new p.Event("zoomend",a)),C&&this.fire(new p.Event("rotateend",a)),M&&this.fire(new p.Event("pitchend",a)),this.fire(new p.Event("moveend",a))}flyTo(a,f){if(this._prefersReducedMotion(a)){const ft=p.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ft,f)}this.stop(),a=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},a);const v=this.transform,C=this.getZoom(),M=this.getBearing(),O=this.getPitch(),k=this.getPadding(),B="zoom"in a?p.clamp(+a.zoom,v.minZoom,v.maxZoom):C,$="bearing"in a?this._normalizeBearing(a.bearing,M):M,j="pitch"in a?+a.pitch:O,q="padding"in a?a.padding:v.padding,ee=v.zoomScale(B-C),se=p.Point.convert(a.offset);let le=v.centerPoint.add(se);const ae=v.pointLocation(le),ce=p.LngLat.convert(a.center||ae);this._normalizeCenter(ce);const X=v.project(ae),oe=v.project(ce).sub(X);let fe=a.curve;const pe=Math.max(v.width,v.height),Te=pe/ee,De=oe.mag();if("minZoom"in a){const ft=p.clamp(Math.min(a.minZoom,C,B),v.minZoom,v.maxZoom),Ct=pe/v.zoomScale(ft-C);fe=Math.sqrt(Ct/De*2)}const Me=fe*fe;function ze(ft){const Ct=(Te*Te-pe*pe+(ft?-1:1)*Me*Me*De*De)/(2*(ft?Te:pe)*Me*De);return Math.log(Math.sqrt(Ct*Ct+1)-Ct)}function Oe(ft){return(Math.exp(ft)-Math.exp(-ft))/2}function Xe(ft){return(Math.exp(ft)+Math.exp(-ft))/2}const At=ze(0);let Ve=function(ft){return Xe(At)/Xe(At+fe*ft)},ht=function(ft){return pe*((Xe(At)*(Oe(Ct=At+fe*ft)/Xe(Ct))-Oe(At))/Me)/De;var Ct},tt=(ze(1)-At)/fe;if(Math.abs(De)<1e-6||!isFinite(tt)){if(Math.abs(pe-Te)<1e-6)return this.easeTo(a,f);const ft=Te<pe?-1:1;tt=Math.abs(Math.log(Te/pe))/fe,ht=function(){return 0},Ve=function(Ct){return Math.exp(ft*fe*Ct)}}a.duration="duration"in a?+a.duration:1e3*tt/("screenSpeed"in a?+a.screenSpeed/fe:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const _t=M!==$,He=j!==O,ct=!v.isPaddingEqual(q),Lt=ft=>Ct=>{const vn=Ct*tt,Rn=1/Ve(vn);ft.zoom=1===Ct?B:C+ft.scaleZoom(Rn),_t&&(ft.bearing=p.number(M,$,Ct)),He&&(ft.pitch=p.number(O,j,Ct)),ct&&(ft.interpolatePadding(k,q,Ct),le=ft.centerPoint.add(se));const sn=1===Ct?ce:ft.unproject(X.add(oe.mult(ht(vn))).mult(Rn));return ft.setLocationAtPoint(ft.renderWorldCopies?sn.wrap():sn,le),ft._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(f),ft};if(a.preloadOnly){const ft=this._emulate(Lt,a.duration,v);return this._preloadTiles(ft),this}return this._zooming=!0,this._rotating=_t,this._pitching=He,this._padding=ct,this._prepareEase(f,!1),this._ease(Lt(v),()=>this._afterEase(f),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,f)}if(!a){const v=this.handlers;v&&v.stop(!1)}return this}_ease(a,f,v){!1===v.animate||0===v.duration?(a(1),f()):(this._easeStart=p.exported.now(),this._easeOptions=v,this._onEaseFrame=a,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,f){a=p.wrap(a,-180,180);const v=Math.abs(a-f);return Math.abs(a-360-f)<v&&(a-=360),Math.abs(a+360-f)<v&&(a+=360),a}_normalizeCenter(a){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const v=a.lng-f.center.lng;a.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,f,v){const C=Math.ceil(15*f/1e3),M=[],O=a(v.clone());for(let k=0;k<=C;k++){const B=O(k/C);M.push(B.clone())}return M}}class dn{constructor(a={}){this.options=a,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const f=this.options&&this.options.compact;return this._map=a,this._container=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ie("button","mapboxgl-ctrl-attrib-button",this._container),Ie("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ie("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===f&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,f){const v=this._map._getUIString(`AttributionControl.${f}`);a.setAttribute("aria-label",v),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(a){const v=f.reduce((C,M,O)=>(M.value&&(C+=`${M.key}=${M.value}${O<f.length-1?"&":""}`),C),"?");a.href=`${p.config.FEEDBACK_URL}/${v}#${Sc(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||"metadata"!==a.sourceDataType&&"visibility"!==a.sourceDataType&&"style"!==a.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const C=this._map.style.stylesheet;this.styleOwner=C.owner,this.styleId=C.id}const f=this._map.style._sourceCaches;for(const C in f){const M=f[C];if(M.used){const O=M.getSource();O.attribution&&a.indexOf(O.attribution)<0&&a.push(O.attribution)}}a.sort((C,M)=>C.length-M.length),a=a.filter((C,M)=>{for(let O=M+1;O<a.length;O++)if(a[O].indexOf(C)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const v=a.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,a.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Rd{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=Ie("div","mapboxgl-ctrl");const f=Ie("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&"metadata"!==a.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(0===Object.entries(a).length)return!0;for(const f in a){const v=a[f].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const f=a[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class Gh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const f=++this._id;return this._queue.push({callback:a,id:f,cancelled:!1}),f}remove(a){const f=this._currentlyRunning,v=f?this._queue.concat(f):this._queue;for(const C of v)if(C.id===a)return void(C.cancelled=!0)}run(a=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const v of f)if(!v.cancelled&&(v.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Wl(_,a,f){if(_=new p.LngLat(_.lng,_.lat),a){const v=new p.LngLat(_.lng-360,_.lat),C=new p.LngLat(_.lng+360,_.lat),M=360*Math.ceil(Math.abs(_.lng-f.center.lng)/360),O=f.locationPoint(_).distSqr(a),k=a.x<0||a.y<0||a.x>f.width||a.y>f.height;f.locationPoint(v).distSqr(a)<O&&(k||Math.abs(v.lng-f.center.lng)<M)?_=v:f.locationPoint(C).distSqr(a)<O&&(k||Math.abs(C.lng-f.center.lng)<M)&&(_=C)}for(;Math.abs(_.lng-f.center.lng)>180;){const v=f.locationPoint(_);if(v.x>=0&&v.y>=0&&v.x<=f.width&&v.y<=f.height)break;_.lng>f.center.lng?_.lng-=360:_.lng+=360}return _}const jr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Xt extends p.Evented{constructor(a,f){if(super(),(a instanceof p.window.HTMLElement||f)&&(a=p.extend({element:a},f)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=p.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ie("div");const C=41,M=27,O=ke("svg",{display:"block",height:C*this._scale+"px",width:M*this._scale+"px",viewBox:`0 0 ${M} ${C}`},this._element),k=ke("radialGradient",{id:"shadowGradient"},ke("defs",{},O));ke("stop",{offset:"10%","stop-opacity":.4},k),ke("stop",{offset:"100%","stop-opacity":.05},k),ke("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},O),ke("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},O),ke("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},O),ke("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},O),this._offset=p.Point.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",C=>{C.preventDefault()}),this._element.addEventListener("mousedown",C=>{C.preventDefault()});const v=this._element.classList;for(const C in jr)v.remove(`mapboxgl-marker-anchor-${C}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const C=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[C,-1*(24.6+C)],"bottom-right":[-C,-1*(24.6+C)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const f=a.code,v=a.charCode||a.keyCode;"Space"!==f&&"Enter"!==f&&32!==v&&13!==v||this.togglePopup()}_onMapClick(a){const f=a.originalEvent.target,v=this._element;this._popup&&(f===v||v.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,f=this._pos;if(!a||!f)return!1;const v=a.unproject(f),C=a.getFreeCameraOptions();if(!C.position)return!1;const M=C.position.toLngLat();return M.distanceTo(v)<.9*M.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const f=this._pos;if(!f||f.x<0||f.x>a.transform.width||f.y<0||f.y>a.transform.height)return void this._clearFadeTimer();const v=a.unproject(f);let C;a._showingGlobe()&&p.isLngLatBehindGlobe(a.transform,this._lngLat)?C=0:(C=1-a._queryFogOpacity(v),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(C*=this._occludedOpacity)),this._element.style.opacity=`${C}`,this._element.style.pointerEvents=C>0?"auto":"none",this._popup&&this._popup._setOpacity(C),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${a.x}px,${a.y}px)\n            ${jr[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${f.x}px,${f.y}px)\n        `}_calculateXYTransform(){const a=this._pos,f=this._map,v=this.getPitchAlignment();if(!f||!a||"map"!==v)return"";if(!f._showingGlobe()){const B=f.getPitch();return B?`rotateX(${B}deg)`:""}const C=p.radToDeg(p.globeTiltAtLngLat(f.transform,this._lngLat)),M=a.sub(p.globeCenterToScreenPoint(f.transform)),O=Math.abs(M.x)+Math.abs(M.y);if(0===O)return"";const k=C/O;return`rotateX(${-M.y*k}deg) rotateY(${M.x*k}deg)`}_calculateZTransform(){const a=this._pos,f=this._map;if(!f||!a)return"";let v=0;const C=this.getRotationAlignment();if("map"===C)if(f._showingGlobe()){const M=f.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),O=f.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(M);v=p.radToDeg(Math.atan2(O.y,O.x))-90}else v=-f.getBearing();else if("horizon"===C){const M=p.smoothstep(4,6,f.getZoom()),O=p.globeCenterToScreenPoint(f.transform);O.y+=M*f.transform.height;const k=a.sub(O),B=p.radToDeg(Math.atan2(k.y,k.x));v=(B>90?B-270:B+90)*(1-M)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(a){p.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=Wl(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),!0===a?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=p.Point.convert(a),this._update(),this}_onMove(a){const f=this._map;if(!f)return;const v=this._pointerdownPos,C=this._positionDelta;if(v&&C){if(!this._isDragging){const M=this._clickTolerance||f._clickTolerance;if(a.point.dist(v)<M)return;this._isDragging=!0}this._pos=a.point.sub(C),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(a){const f=this._map,v=this._pos;f&&v&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(v),this._pointerdownPos=a.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const f=this._map;return f&&(a?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const yr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},R_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zm(_=new p.Point(0,0),a="bottom"){if("number"==typeof _){const f=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(a){case"top":return new p.Point(0,_);case"top-left":return new p.Point(f,f);case"top-right":return new p.Point(-f,f);case"bottom":return new p.Point(0,-_);case"bottom-left":return new p.Point(f,-f);case"bottom-right":return new p.Point(-f,-f);case"left":return new p.Point(_,0);case"right":return new p.Point(-_,0)}return new p.Point(0,0)}return _ instanceof p.Point||Array.isArray(_)?p.Point.convert(_):p.Point.convert(_[a]||[0,0])}class hp{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const f=p.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,f,v){this._start=this.getValue(f),this._end=a,this._startTime=f,this._endTime=f+v}}const qm={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Vo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},us={showCompass:!0,showZoom:!0,visualizePitch:!1};class Od{constructor(a,f,v=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new Id({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,v&&(this.mousePitch=new Zr({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(a,f){this.mouseRotate.mousedown(a,f),this.mousePitch&&this.mousePitch.mousedown(a,f),Wt()}move(a,f){const v=this.map,C=this.mouseRotate.mousemoveWindow(a,f),M=C&&C.bearingDelta;if(M&&v.setBearing(v.getBearing()+M),this.mousePitch){const O=this.mousePitch.mousemoveWindow(a,f),k=O&&O.pitchDelta;k&&v.setPitch(v.getPitch()+k)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){nn(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(p.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),cn(this.element,a)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,cn(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){1!==a.targetTouches.length?this.reset():(this._startPos=this._lastPos=Dn(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){1!==a.targetTouches.length?this.reset():(this._lastPos=Dn(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){0===a.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ar={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Fn={maxWidth:100,unit:"metric"},Eo={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Va={version:p.version,supported:Ye,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends Pd{constructor(_){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(_=p.extend({},Vo,_)).minZoom&&null!=_.maxZoom&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=_.minPitch&&null!=_.maxPitch&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=_.minPitch&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=_.maxPitch&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(_.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Tc(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._useWebGL2=_.useWebGL2,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._collectResourceTiming=_.collectResourceTiming,this._optimizeForTerrain=_.optimizeForTerrain,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new Gh,this._domRenderTaskQueue=new Gh,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},qm,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new hp(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,"string"==typeof _.container){if(this._container=p.window.document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new pa(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),this._hash=_.hash&&new da("string"==typeof _.hash&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,p.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),_.attributionControl&&this.addControl(new dn({customAttribution:_.customAttribution})),this._logoControl=new Rd,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update("style"===a.dataType),this.fire(new p.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new p.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(_,a){if(void 0===a&&(a=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=_.onAdd(this);this._controls.push(_);const v=this._controlPositions[a];return-1!==a.indexOf("bottom")?v.insertBefore(f,v.firstChild):v.appendChild(f),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(_);return a>-1&&this._controls.splice(a,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new p.Event("movestart",_)).fire(new p.Event("move",_)),this.fire(new p.Event("resize",_)),a&&this.fire(new p.Event("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(p.LngLatBounds.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return"auto"===_?p.window.navigator.language:Array.isArray(_)?0===_.length?void 0:_.map(a=>"auto"===a?p.window.navigator.language:a):_}setLanguage(_){const a=this._parseLanguage(_);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(_){return this._lazyInitEmptyStyle(),_?"string"==typeof _&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const _=this.transform,a=_.projection.name;let f;"globe"===a&&_.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(_.setMercatorFromTransition(),f=!0):"mercator"===a&&_.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(_.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,a){return this._updateProjection(_||a||{name:"mercator"})}_updateProjection(_){let a;if(a="globe"===_.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(_){return this.transform.locationPoint3D(p.LngLat.convert(_))}unproject(_){return this.transform.pointLocation3D(p.Point.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(_,a,f){if("mouseenter"===_||"mouseover"===_){let v=!1;const C=O=>{const k=a.filter($=>this.getLayer($)),B=k.length?this.queryRenderedFeatures(O.point,{layers:k}):[];B.length?v||(v=!0,f.call(this,new eo(_,this,O.originalEvent,{features:B}))):v=!1},M=()=>{v=!1};return{layers:new Set(a),listener:f,delegates:{mousemove:C,mouseout:M}}}if("mouseleave"===_||"mouseout"===_){let v=!1;const C=O=>{const k=a.filter(B=>this.getLayer(B));(k.length?this.queryRenderedFeatures(O.point,{layers:k}):[]).length?v=!0:v&&(v=!1,f.call(this,new eo(_,this,O.originalEvent)))},M=O=>{v&&(v=!1,f.call(this,new eo(_,this,O.originalEvent)))};return{layers:new Set(a),listener:f,delegates:{mousemove:C,mouseout:M}}}{const v=C=>{const M=a.filter(k=>this.getLayer(k)),O=M.length?this.queryRenderedFeatures(C.point,{layers:M}):[];O.length&&(C.features=O,f.call(this,C),delete C.features)};return{layers:new Set(a),listener:f,delegates:{[_]:v}}}}on(_,a,f){if(void 0===f)return super.on(_,a);Array.isArray(a)||(a=[a]);const v=this._createDelegatedListener(_,a,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(v);for(const C in v.delegates)this.on(C,v.delegates[C]);return this}once(_,a,f){if(void 0===f)return super.once(_,a);Array.isArray(a)||(a=[a]);const v=this._createDelegatedListener(_,a,f);for(const C in v.delegates)this.once(C,v.delegates[C]);return this}off(_,a,f){if(void 0===f)return super.off(_,a);a=new Set(Array.isArray(a)?a:[a]);const v=(M,O)=>{if(M.size!==O.size)return!1;for(const k of M)if(!O.has(k))return!1;return!0},C=this._delegatedListeners?this._delegatedListeners[_]:void 0;return C&&(M=>{for(let O=0;O<M.length;O++){const k=M[O];if(k.listener===f&&v(k.layers,a)){for(const B in k.delegates)this.off(B,k.delegates[B]);return M.splice(O,1),this}}})(C),this}queryRenderedFeatures(_,a){return this.style?(void 0!==a||void 0===_||_ instanceof p.Point||Array.isArray(_)||(a=_,_=void 0),this.style.queryRenderedFeatures(_=_||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(_,a){return this.style.querySourceFeatures(_,a)}isPointOnSurface(_){const{name:a}=this.transform.projection;return"globe"!==a&&"mercator"!==a&&p.warnOnce(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(_))}setStyle(_,a){return!1!==(a=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(_,a))}_getUIString(_){const a=this._locale[_];if(null==a)throw new Error(`Missing UI string '${_}'`);return a}_updateStyle(_,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_&&(this.style=new Bn(this,a||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof _?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Bn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,a){if("string"==typeof _){const f=this._requestManager.normalizeStyleURL(_),v=this._requestManager.transformRequest(f,p.ResourceType.Style);p.getJSON(v,(C,M)=>{C?this.fire(new p.ErrorEvent(C)):M&&this._updateDiff(M,a)})}else"object"==typeof _&&this._updateDiff(_,a)}_updateDiff(_,a){try{this.style.setState(_)&&this._update(!0)}catch(f){p.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(_,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(_,a){return this._lazyInitEmptyStyle(),this.style.addSource(_,a),this._update(!0)}isSourceLoaded(_){return!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){const _=this.style&&this.style._sourceCaches;for(const a in _){const f=_[a]._tiles;for(const v in f){const C=f[v];if("loaded"!==C.state&&"errored"!==C.state)return!1}}return!0}addSourceType(_,a,f){this._lazyInitEmptyStyle(),this.style.addSourceType(_,a,f)}removeSource(_){return this.style.removeSource(_),this._updateTerrain(),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,a,{pixelRatio:f=1,sdf:v=!1,stretchX:C,stretchY:M,content:O}={}){if(this._lazyInitEmptyStyle(),a instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&a instanceof p.window.ImageBitmap){const{width:k,height:B,data:$}=p.exported.getImageData(a);this.style.addImage(_,{data:new p.RGBAImage({width:k,height:B},$),pixelRatio:f,stretchX:C,stretchY:M,content:O,sdf:v,version:0})}else if(void 0===a.width||void 0===a.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:B}=a,$=a;this.style.addImage(_,{data:new p.RGBAImage({width:k,height:B},new Uint8Array($.data)),pixelRatio:f,stretchX:C,stretchY:M,content:O,sdf:v,version:0,userImage:$}),$.onAdd&&$.onAdd(this,_)}}updateImage(_,a){const f=this.style.getImage(_);if(!f)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=a instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&a instanceof p.window.ImageBitmap?p.exported.getImageData(a):a,{width:C,height:M}=v;void 0!==C&&void 0!==M?C===f.data.width&&M===f.data.height?(f.data.replace(v.data,!(a instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&a instanceof p.window.ImageBitmap)),this.style.updateImage(_,f)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${C}, ${M})\n                must be that same as the previous version of the image\n                (${f.data.width}, ${f.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,a){p.getImage(this._requestManager.transformRequest(_,p.ResourceType.Image),(f,v)=>{a(f,v instanceof p.window.HTMLImageElement?p.exported.getImageData(v):v)})}listImages(){return this.style.listImages()}addLayer(_,a){return this._lazyInitEmptyStyle(),this.style.addLayer(_,a),this._update(!0)}moveLayer(_,a){return this.style.moveLayer(_,a),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}setLayerZoomRange(_,a,f){return this.style.setLayerZoomRange(_,a,f),this._update(!0)}setFilter(_,a,f={}){return this.style.setFilter(_,a,f),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,a,f,v={}){return this.style.setPaintProperty(_,a,f,v),this._update(!0)}getPaintProperty(_,a){return this.style.getPaintProperty(_,a)}setLayoutProperty(_,a,f,v={}){return this.style.setLayoutProperty(_,a,f,v),this._update(!0)}getLayoutProperty(_,a){return this.style.getLayoutProperty(_,a)}setLight(_,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(_),this.transform):0}setFeatureState(_,a){return this.style.setFeatureState(_,a),this._update()}removeFeatureState(_,a){return this.style.removeFeatureState(_,a),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let f,v,C,M=this._container;for(;M&&(!v||!C);){const O=p.window.getComputedStyle(M).transform;O&&"none"!==O&&(f=O.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&"0"!==f[0]&&"1"!==f[0]&&(v=f[0]),f[3]&&"0"!==f[3]&&"1"!==f[3]&&(C=f[3])),M=M.parentElement}this._containerWidth=v?Math.abs(_/v):_,this._containerHeight=C?Math.abs(a/C):a}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ie("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=Ie("div","mapboxgl-canvas-container",_);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=Ie("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=Ie("div","mapboxgl-control-container",_),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{v[C]=Ie("div",`mapboxgl-ctrl-${C}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,a){const f=p.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(_),this._canvas.height=f*Math.ceil(a),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${a}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const a=this._markers.indexOf(_);-1!==a&&this._markers.splice(a,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){const a=this._popups.indexOf(_);-1!==a&&this._popups.splice(a,1)}_setupPainter(){const _=p.extend({},Ye.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._useWebGL2&&this._canvas.getContext("webgl2",_),f=a||this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);f?(this._useWebGL2&&!a&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(f,!0),this.painter=new Ec(f,this.transform,!!a),this.on("data",v=>{"source"===v.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(f)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let a;const f=this.painter.context.extTimerQuery,v=p.exported.now();if(this.listens("gpu-timing-frame")&&(a=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,B=this.transform.pitch,$=p.exported.now(),j=new p.EvaluationParameters(k,{now:$,fadeDuration:C,pitch:B,transition:this.style.getTransition()});this.style.update(j)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(v),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):M=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const k=p.exported.now()-v;f.endQueryEXT(f.TIME_ELAPSED_EXT,a),setTimeout(()=>{const B=f.getQueryObjectEXT(a,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(a),this.fire(new p.Event("gpu-timing-frame",{cpuTime:k,gpuTime:B})),p.window.performance.mark("frame-gpu",{startTime:v,detail:{gpuTime:B}})},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(k);this.fire(new p.Event("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(k);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:B}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(O||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(M=this._updateAverageElevation(v,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(const a of this._markers)_&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!_||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(_,a=!1){const f=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&f(0);if((a||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const v=this.transform.averageElevation;let C=this.transform.sampleAverageElevation(),M=!1;this.transform.elevation&&(M=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(C)?C=0:this._averageElevationLastSampledAt=_;const O=Math.abs(v-C);if(O>1){if(this._isInitialLoad||M)return this._averageElevation.jumpTo(C),f(C);this._averageElevation.easeTo(C,_,300)}else if(O>1e-4)return this._averageElevation.jumpTo(C),f(C)}return!!this._averageElevation.isEasing(_)&&f(this._averageElevation.getValue(_))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===p.AUTH_ERR_MSG||401===_.status)){const a=this.painter.context.gl;p.storeAuthState(a,!1),this._logoControl instanceof Rd&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const _=this._isDragging();this.painter.updateTerrain(this.style,_)}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const f=this.painter.context.gl,v=f.createFramebuffer();function C(M){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,M,0);const O=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,O),O}return f.bindFramebuffer(f.FRAMEBUFFER,v),this._canvasPixelComparison(C(_),a.canvasCopies.map(C),a.timeStamps)}_canvasPixelComparison(_,a,f){let v=f[1]-f[0];const C=_.length/4;for(let M=0;M<a.length;M++){const O=a[M];let k=0;for(let B=0;B<O.length;B+=4)O[B]===_[B]&&O[B+1]===_[B+1]&&O[B+2]===_[B+2]&&O[B+3]===_[B+3]&&(k+=1);v+=(f[M+2]-f[M+1])*(1-k/C)}return v}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=p.exported.frame(a=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(a)}))}_preloadTiles(_){const a=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(a,(f,v)=>f._preloadTiles(_,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,_&&this._update())}_setCacheLimits(_,a){p.setCacheLimits(_,a)}get version(){return p.version}},NavigationControl:class{constructor(_){this.options=p.extend({},us,_),this._container=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),Ie("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),Ie("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:a}):f.resetNorth({},{originalEvent:a}))}),this._compassIcon=Ie("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map;if(!_)return;const a=_.getZoom(),f=a===_.getMaxZoom(),v=a===_.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const _=this._map;if(!_)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Od(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){const _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,a){const f=Ie("button",_,this._container);return f.type="button",f.addEventListener("click",a),f}_setButtonTitle(_,a){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${a}`);_.setAttribute("aria-label",f),_.firstElementChild&&_.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends p.Evented{constructor(_){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},ar,_),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Mc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){const a=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,_(f)};void 0!==this._supportsGeolocation?_(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(f=>a("denied"!==f.state)).catch(()=>a()):a()}_isOutOfMapMaxBounds(_){const a=this._map.getMaxBounds(),f=_.coords;return!!a&&(f.longitude<a.getWest()||f.longitude>a.getEast()||f.latitude<a.getSouth()||f.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(_),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",_)),this._finish()}}_updateCamera(_){const a=new p.LngLat(_.coords.longitude,_.coords.latitude),f=_.coords.accuracy,v=this._map.getBearing(),C=p.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(f),C,{geolocateSource:!0})}_updateMarker(_){if(_){const a=new p.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map.transform,a=p.mercatorZfromAltitude(1,_._center.lat)*_.worldSize,f=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(1===_.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===_.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Ie("button","mapboxgl-ctrl-geolocate",this._container),Ie("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===_){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ie("div","mapboxgl-user-location"),this._dotElement.appendChild(Ie("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ie("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Xt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ie("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||"ACTIVE_LOCK"!==this._watchState||a.originalEvent&&"resize"===a.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:!0===_.absolute&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(a=>{"granted"===a&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:dn,ScaleControl:class{constructor(_){this.options=p.extend({},Fn,_),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const _=this.options.maxWidth||100,a=this._map,f=a._containerHeight/2,v=a._containerWidth/2-_/2,C=a.unproject([v,f]),M=a.unproject([v+_,f]),O=C.distanceTo(M);if("imperial"===this.options.unit){const k=3.2808*O;k>5280?this._setScale(_,k/5280,"mile"):this._setScale(_,k,"foot")}else"nautical"===this.options.unit?this._setScale(_,O/1852,"nautical-mile"):O>=1e3?this._setScale(_,O/1e3,"kilometer"):this._setScale(_,O,"meter")}_setScale(_,a,f){this._map._requestDomTask(()=>{const v=function(M){const O=Math.pow(10,`${Math.floor(M)}`.length-1);let k=M/O;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(B){const $=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*$)/$}(k),O*k}(a),C=v/a;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==f?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(v):`${v}&nbsp;${Eo[f]}`,this._container.style.width=_*C+"px"})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof p.window.HTMLElement?this._container=_.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=Ie("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ie("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(_){super(),this.options=p.extend(Object.create(yr),_),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=p.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(p.window.document.createTextNode(_))}setHTML(_){const a=p.window.document.createDocumentFragment(),f=p.window.document.createElement("body");let v;for(f.innerHTML=_;v=f.firstChild,v;)a.appendChild(v);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=Ie("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(_),this.options.closeButton){const f=this._closeButton=Ie("button","mapboxgl-popup-close-button",a);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let a;return this._classList.delete(_)?a=!1:(this._classList.add(_),a=!0),this._updateClassList(),a}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const a=this._map,f=this._container,v=this._pos;if(!a||!f||!v)return"bottom";const C=f.offsetWidth,M=f.offsetHeight,O=v.x<C/2,k=v.x>a.transform.width-C/2;if(v.y+_<M)return O?"top-left":k?"top-right":"top";if(v.y>a.transform.height-M){if(O)return"bottom-left";if(k)return"bottom-right"}return O?"left":k?"right":"bottom"}_updateClassList(){const _=this._container;if(!_)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),_.className=a.join(" ")}_update(_){const a=this._map,f=this._content;if(!a||!this._lngLat&&!this._trackPointer||!f)return;let v=this._container;if(v||(v=this._container=Ie("div","mapboxgl-popup",a.getContainer()),this._tip=Ie("div","mapboxgl-popup-tip",v),v.appendChild(f)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Wl(this._lngLat,this._pos,a.transform)),!this._trackPointer||_){const C=this._pos=this._trackPointer&&_?_:a.project(this._lngLat),M=Zm(this.options.offset),O=this._anchor=this._getAnchor(M.y),k=Zm(this.options.offset,O),B=C.add(k).round();a._requestDomTask(()=>{this._container&&O&&(this._container.style.transform=`${jr[O]} translate(${B.x}px,${B.y}px)`)})}if(!this._marker&&a._showingGlobe()){const C=p.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(C)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(R_);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:Xt,Style:Bn,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:Cc,Evented:p.Evented,config:p.config,prewarm:function(){ll().acquire(Ao)},clearPrewarmedResources:function(){const _=Jr;_&&(_.isPreloaded()&&1===_.numActive()?(_.release(Ao),Jr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(_){p.config.ACCESS_TOKEN=_},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(_){p.config.API_URL=_},get workerCount(){return pr.workerCount},set workerCount(_){pr.workerCount=_},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){p.config.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){p.clearTileCache(_)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Va}),E}()},5619:(Ue,Se,te)=>{"use strict";te.d(Se,{X:()=>Be});var E=te(8645);class Be extends E.x{constructor(p){super(),this._value=p}get value(){return this.getValue()}_subscribe(p){const ue=super._subscribe(p);return!ue.closed&&p.next(this._value),ue}getValue(){const{hasError:p,thrownError:ue,_value:Ye}=this;if(p)throw ue;return this._throwIfClosed(),Ye}next(p){super.next(this._value=p)}}},5592:(Ue,Se,te)=>{"use strict";te.d(Se,{y:()=>Le});var E=te(305),Be=te(7394),it=te(4850),p=te(8407),ue=te(2653),Ye=te(4674),Ge=te(1441);let Le=(()=>{class Qe{constructor(Wt){Wt&&(this._subscribe=Wt)}lift(Wt){const nn=new Qe;return nn.source=this,nn.operator=Wt,nn}subscribe(Wt,nn,Pt){const En=function $e(Qe){return Qe&&Qe instanceof E.Lv||function ke(Qe){return Qe&&(0,Ye.m)(Qe.next)&&(0,Ye.m)(Qe.error)&&(0,Ye.m)(Qe.complete)}(Qe)&&(0,Be.Nn)(Qe)}(Wt)?Wt:new E.Hp(Wt,nn,Pt);return(0,Ge.x)(()=>{const{operator:cn,source:Dn}=this;En.add(cn?cn.call(En,Dn):Dn?this._subscribe(En):this._trySubscribe(En))}),En}_trySubscribe(Wt){try{return this._subscribe(Wt)}catch(nn){Wt.error(nn)}}forEach(Wt,nn){return new(nn=Ie(nn))((Pt,En)=>{const cn=new E.Hp({next:Dn=>{try{Wt(Dn)}catch(pn){En(pn),cn.unsubscribe()}},error:En,complete:Pt});this.subscribe(cn)})}_subscribe(Wt){var nn;return null===(nn=this.source)||void 0===nn?void 0:nn.subscribe(Wt)}[it.L](){return this}pipe(...Wt){return(0,p.U)(Wt)(this)}toPromise(Wt){return new(Wt=Ie(Wt))((nn,Pt)=>{let En;this.subscribe(cn=>En=cn,cn=>Pt(cn),()=>nn(En))})}}return Qe.create=Tt=>new Qe(Tt),Qe})();function Ie(Qe){var Tt;return null!==(Tt=Qe??ue.config.Promise)&&void 0!==Tt?Tt:Promise}},7328:(Ue,Se,te)=>{"use strict";te.d(Se,{t:()=>it});var E=te(8645),Be=te(4552);class it extends E.x{constructor(ue=1/0,Ye=1/0,Ge=Be.l){super(),this._bufferSize=ue,this._windowTime=Ye,this._timestampProvider=Ge,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=Ye===1/0,this._bufferSize=Math.max(1,ue),this._windowTime=Math.max(1,Ye)}next(ue){const{isStopped:Ye,_buffer:Ge,_infiniteTimeWindow:Le,_timestampProvider:Ie,_windowTime:ke}=this;Ye||(Ge.push(ue),!Le&&Ge.push(Ie.now()+ke)),this._trimBuffer(),super.next(ue)}_subscribe(ue){this._throwIfClosed(),this._trimBuffer();const Ye=this._innerSubscribe(ue),{_infiniteTimeWindow:Ge,_buffer:Le}=this,Ie=Le.slice();for(let ke=0;ke<Ie.length&&!ue.closed;ke+=Ge?1:2)ue.next(Ie[ke]);return this._checkFinalizedStatuses(ue),Ye}_trimBuffer(){const{_bufferSize:ue,_timestampProvider:Ye,_buffer:Ge,_infiniteTimeWindow:Le}=this,Ie=(Le?1:2)*ue;if(ue<1/0&&Ie<Ge.length&&Ge.splice(0,Ge.length-Ie),!Le){const ke=Ye.now();let $e=0;for(let Qe=1;Qe<Ge.length&&Ge[Qe]<=ke;Qe+=2)$e=Qe;$e&&Ge.splice(0,$e+1)}}}},8645:(Ue,Se,te)=>{"use strict";te.d(Se,{x:()=>Ge});var E=te(5592),Be=te(7394);const p=(0,te(2306).d)(Ie=>function(){Ie(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var ue=te(9039),Ye=te(1441);let Ge=(()=>{class Ie extends E.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift($e){const Qe=new Le(this,this);return Qe.operator=$e,Qe}_throwIfClosed(){if(this.closed)throw new p}next($e){(0,Ye.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Qe of this.currentObservers)Qe.next($e)}})}error($e){(0,Ye.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=$e;const{observers:Qe}=this;for(;Qe.length;)Qe.shift().error($e)}})}complete(){(0,Ye.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:$e}=this;for(;$e.length;)$e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var $e;return(null===($e=this.observers)||void 0===$e?void 0:$e.length)>0}_trySubscribe($e){return this._throwIfClosed(),super._trySubscribe($e)}_subscribe($e){return this._throwIfClosed(),this._checkFinalizedStatuses($e),this._innerSubscribe($e)}_innerSubscribe($e){const{hasError:Qe,isStopped:Tt,observers:Wt}=this;return Qe||Tt?Be.Lc:(this.currentObservers=null,Wt.push($e),new Be.w0(()=>{this.currentObservers=null,(0,ue.P)(Wt,$e)}))}_checkFinalizedStatuses($e){const{hasError:Qe,thrownError:Tt,isStopped:Wt}=this;Qe?$e.error(Tt):Wt&&$e.complete()}asObservable(){const $e=new E.y;return $e.source=this,$e}}return Ie.create=(ke,$e)=>new Le(ke,$e),Ie})();class Le extends Ge{constructor(ke,$e){super(),this.destination=ke,this.source=$e}next(ke){var $e,Qe;null===(Qe=null===($e=this.destination)||void 0===$e?void 0:$e.next)||void 0===Qe||Qe.call($e,ke)}error(ke){var $e,Qe;null===(Qe=null===($e=this.destination)||void 0===$e?void 0:$e.error)||void 0===Qe||Qe.call($e,ke)}complete(){var ke,$e;null===($e=null===(ke=this.destination)||void 0===ke?void 0:ke.complete)||void 0===$e||$e.call(ke)}_subscribe(ke){var $e,Qe;return null!==(Qe=null===($e=this.source)||void 0===$e?void 0:$e.subscribe(ke))&&void 0!==Qe?Qe:Be.Lc}}},305:(Ue,Se,te)=>{"use strict";te.d(Se,{Hp:()=>Pt,Lv:()=>Qe});var E=te(4674),Be=te(7394),it=te(2653),p=te(3894),ue=te(2420);const Ye=Ie("C",void 0,void 0);function Ie(nt,Ne,Ft){return{kind:nt,value:Ne,error:Ft}}var ke=te(7599),$e=te(1441);class Qe extends Be.w0{constructor(Ne){super(),this.isStopped=!1,Ne?(this.destination=Ne,(0,Be.Nn)(Ne)&&Ne.add(this)):this.destination=pn}static create(Ne,Ft,jt){return new Pt(Ne,Ft,jt)}next(Ne){this.isStopped?Dn(function Le(nt){return Ie("N",nt,void 0)}(Ne),this):this._next(Ne)}error(Ne){this.isStopped?Dn(function Ge(nt){return Ie("E",void 0,nt)}(Ne),this):(this.isStopped=!0,this._error(Ne))}complete(){this.isStopped?Dn(Ye,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Ne){this.destination.next(Ne)}_error(Ne){try{this.destination.error(Ne)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Tt=Function.prototype.bind;function Wt(nt,Ne){return Tt.call(nt,Ne)}class nn{constructor(Ne){this.partialObserver=Ne}next(Ne){const{partialObserver:Ft}=this;if(Ft.next)try{Ft.next(Ne)}catch(jt){En(jt)}}error(Ne){const{partialObserver:Ft}=this;if(Ft.error)try{Ft.error(Ne)}catch(jt){En(jt)}else En(Ne)}complete(){const{partialObserver:Ne}=this;if(Ne.complete)try{Ne.complete()}catch(Ft){En(Ft)}}}class Pt extends Qe{constructor(Ne,Ft,jt){let kt;if(super(),(0,E.m)(Ne)||!Ne)kt={next:Ne??void 0,error:Ft??void 0,complete:jt??void 0};else{let Yt;this&&it.config.useDeprecatedNextContext?(Yt=Object.create(Ne),Yt.unsubscribe=()=>this.unsubscribe(),kt={next:Ne.next&&Wt(Ne.next,Yt),error:Ne.error&&Wt(Ne.error,Yt),complete:Ne.complete&&Wt(Ne.complete,Yt)}):kt=Ne}this.destination=new nn(kt)}}function En(nt){it.config.useDeprecatedSynchronousErrorHandling?(0,$e.O)(nt):(0,p.h)(nt)}function Dn(nt,Ne){const{onStoppedNotification:Ft}=it.config;Ft&&ke.z.setTimeout(()=>Ft(nt,Ne))}const pn={closed:!0,next:ue.Z,error:function cn(nt){throw nt},complete:ue.Z}},7394:(Ue,Se,te)=>{"use strict";te.d(Se,{Lc:()=>Ye,w0:()=>ue,Nn:()=>Ge});var E=te(4674);const it=(0,te(2306).d)(Ie=>function($e){Ie(this),this.message=$e?`${$e.length} errors occurred during unsubscription:\n${$e.map((Qe,Tt)=>`${Tt+1}) ${Qe.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=$e});var p=te(9039);class ue{constructor(ke){this.initialTeardown=ke,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let ke;if(!this.closed){this.closed=!0;const{_parentage:$e}=this;if($e)if(this._parentage=null,Array.isArray($e))for(const Wt of $e)Wt.remove(this);else $e.remove(this);const{initialTeardown:Qe}=this;if((0,E.m)(Qe))try{Qe()}catch(Wt){ke=Wt instanceof it?Wt.errors:[Wt]}const{_finalizers:Tt}=this;if(Tt){this._finalizers=null;for(const Wt of Tt)try{Le(Wt)}catch(nn){ke=ke??[],nn instanceof it?ke=[...ke,...nn.errors]:ke.push(nn)}}if(ke)throw new it(ke)}}add(ke){var $e;if(ke&&ke!==this)if(this.closed)Le(ke);else{if(ke instanceof ue){if(ke.closed||ke._hasParent(this))return;ke._addParent(this)}(this._finalizers=null!==($e=this._finalizers)&&void 0!==$e?$e:[]).push(ke)}}_hasParent(ke){const{_parentage:$e}=this;return $e===ke||Array.isArray($e)&&$e.includes(ke)}_addParent(ke){const{_parentage:$e}=this;this._parentage=Array.isArray($e)?($e.push(ke),$e):$e?[$e,ke]:ke}_removeParent(ke){const{_parentage:$e}=this;$e===ke?this._parentage=null:Array.isArray($e)&&(0,p.P)($e,ke)}remove(ke){const{_finalizers:$e}=this;$e&&(0,p.P)($e,ke),ke instanceof ue&&ke._removeParent(this)}}ue.EMPTY=(()=>{const Ie=new ue;return Ie.closed=!0,Ie})();const Ye=ue.EMPTY;function Ge(Ie){return Ie instanceof ue||Ie&&"closed"in Ie&&(0,E.m)(Ie.remove)&&(0,E.m)(Ie.add)&&(0,E.m)(Ie.unsubscribe)}function Le(Ie){(0,E.m)(Ie)?Ie():Ie.unsubscribe()}},2653:(Ue,Se,te)=>{"use strict";te.d(Se,{config:()=>E});const E={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},6232:(Ue,Se,te)=>{"use strict";te.d(Se,{E:()=>Be});const Be=new(te(5592).y)(ue=>ue.complete())},9666:(Ue,Se,te)=>{"use strict";te.d(Se,{D:()=>Ft});var E=te(4829),Be=te(3093),it=te(9360);function p(jt,kt=0){return(0,it.e)((Yt,ui)=>{ui.add(jt.schedule(()=>Yt.subscribe(ui),kt))})}var Ge=te(5592),Ie=te(4971),ke=te(4674),$e=te(7103);function Tt(jt,kt){if(!jt)throw new Error("Iterable cannot be null");return new Ge.y(Yt=>{(0,$e.f)(Yt,kt,()=>{const ui=jt[Symbol.asyncIterator]();(0,$e.f)(Yt,kt,()=>{ui.next().then(mi=>{mi.done?Yt.complete():Yt.next(mi.value)})},0,!0)})})}var Wt=te(8382),nn=te(4026),Pt=te(4266),En=te(3664),cn=te(5726),Dn=te(9853),pn=te(541);function Ft(jt,kt){return kt?function Ne(jt,kt){if(null!=jt){if((0,Wt.c)(jt))return function ue(jt,kt){return(0,E.Xf)(jt).pipe(p(kt),(0,Be.Q)(kt))}(jt,kt);if((0,Pt.z)(jt))return function Le(jt,kt){return new Ge.y(Yt=>{let ui=0;return kt.schedule(function(){ui===jt.length?Yt.complete():(Yt.next(jt[ui++]),Yt.closed||this.schedule())})})}(jt,kt);if((0,nn.t)(jt))return function Ye(jt,kt){return(0,E.Xf)(jt).pipe(p(kt),(0,Be.Q)(kt))}(jt,kt);if((0,cn.D)(jt))return Tt(jt,kt);if((0,En.T)(jt))return function Qe(jt,kt){return new Ge.y(Yt=>{let ui;return(0,$e.f)(Yt,kt,()=>{ui=jt[Ie.h](),(0,$e.f)(Yt,kt,()=>{let mi,ir;try{({value:mi,done:ir}=ui.next())}catch(Mo){return void Yt.error(Mo)}ir?Yt.complete():Yt.next(mi)},0,!0)}),()=>(0,ke.m)(ui?.return)&&ui.return()})}(jt,kt);if((0,pn.L)(jt))return function nt(jt,kt){return Tt((0,pn.Q)(jt),kt)}(jt,kt)}throw(0,Dn.z)(jt)}(jt,kt):(0,E.Xf)(jt)}},4829:(Ue,Se,te)=>{"use strict";te.d(Se,{Xf:()=>Tt});var E=te(7582),Be=te(4266),it=te(4026),p=te(5592),ue=te(8382),Ye=te(5726),Ge=te(9853),Le=te(3664),Ie=te(541),ke=te(4674),$e=te(3894),Qe=te(4850);function Tt(nt){if(nt instanceof p.y)return nt;if(null!=nt){if((0,ue.c)(nt))return function Wt(nt){return new p.y(Ne=>{const Ft=nt[Qe.L]();if((0,ke.m)(Ft.subscribe))return Ft.subscribe(Ne);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(nt);if((0,Be.z)(nt))return function nn(nt){return new p.y(Ne=>{for(let Ft=0;Ft<nt.length&&!Ne.closed;Ft++)Ne.next(nt[Ft]);Ne.complete()})}(nt);if((0,it.t)(nt))return function Pt(nt){return new p.y(Ne=>{nt.then(Ft=>{Ne.closed||(Ne.next(Ft),Ne.complete())},Ft=>Ne.error(Ft)).then(null,$e.h)})}(nt);if((0,Ye.D)(nt))return cn(nt);if((0,Le.T)(nt))return function En(nt){return new p.y(Ne=>{for(const Ft of nt)if(Ne.next(Ft),Ne.closed)return;Ne.complete()})}(nt);if((0,Ie.L)(nt))return function Dn(nt){return cn((0,Ie.Q)(nt))}(nt)}throw(0,Ge.z)(nt)}function cn(nt){return new p.y(Ne=>{(function pn(nt,Ne){var Ft,jt,kt,Yt;return(0,E.mG)(this,void 0,void 0,function*(){try{for(Ft=(0,E.KL)(nt);!(jt=yield Ft.next()).done;)if(Ne.next(jt.value),Ne.closed)return}catch(ui){kt={error:ui}}finally{try{jt&&!jt.done&&(Yt=Ft.return)&&(yield Yt.call(Ft))}finally{if(kt)throw kt.error}}Ne.complete()})})(nt,Ne).catch(Ft=>Ne.error(Ft))})}},3019:(Ue,Se,te)=>{"use strict";te.d(Se,{T:()=>Ye});var E=te(7537),Be=te(4829),it=te(6232),p=te(9940),ue=te(9666);function Ye(...Ge){const Le=(0,p.yG)(Ge),Ie=(0,p._6)(Ge,1/0),ke=Ge;return ke.length?1===ke.length?(0,Be.Xf)(ke[0]):(0,E.J)(Ie)((0,ue.D)(ke,Le)):it.E}},2096:(Ue,Se,te)=>{"use strict";te.d(Se,{of:()=>it});var E=te(9940),Be=te(9666);function it(...p){const ue=(0,E.yG)(p);return(0,Be.D)(p,ue)}},8251:(Ue,Se,te)=>{"use strict";te.d(Se,{Q:()=>it,x:()=>Be});var E=te(305);function Be(p,ue,Ye,Ge,Le){return new it(p,ue,Ye,Ge,Le)}class it extends E.Lv{constructor(ue,Ye,Ge,Le,Ie,ke){super(ue),this.onFinalize=Ie,this.shouldUnsubscribe=ke,this._next=Ye?function($e){try{Ye($e)}catch(Qe){ue.error(Qe)}}:super._next,this._error=Le?function($e){try{Le($e)}catch(Qe){ue.error(Qe)}finally{this.unsubscribe()}}:super._error,this._complete=Ge?function(){try{Ge()}catch($e){ue.error($e)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var ue;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Ye}=this;super.unsubscribe(),!Ye&&(null===(ue=this.onFinalize)||void 0===ue||ue.call(this))}}}},6306:(Ue,Se,te)=>{"use strict";te.d(Se,{K:()=>p});var E=te(4829),Be=te(8251),it=te(9360);function p(ue){return(0,it.e)((Ye,Ge)=>{let ke,Le=null,Ie=!1;Le=Ye.subscribe((0,Be.x)(Ge,void 0,void 0,$e=>{ke=(0,E.Xf)(ue($e,p(ue)(Ye))),Le?(Le.unsubscribe(),Le=null,ke.subscribe(Ge)):Ie=!0})),Ie&&(Le.unsubscribe(),Le=null,ke.subscribe(Ge))})}},6328:(Ue,Se,te)=>{"use strict";te.d(Se,{b:()=>it});var E=te(1631),Be=te(4674);function it(p,ue){return(0,Be.m)(ue)?(0,E.z)(p,ue,1):(0,E.z)(p,1)}},3620:(Ue,Se,te)=>{"use strict";te.d(Se,{b:()=>p});var E=te(6321),Be=te(9360),it=te(8251);function p(ue,Ye=E.z){return(0,Be.e)((Ge,Le)=>{let Ie=null,ke=null,$e=null;const Qe=()=>{if(Ie){Ie.unsubscribe(),Ie=null;const Wt=ke;ke=null,Le.next(Wt)}};function Tt(){const Wt=$e+ue,nn=Ye.now();if(nn<Wt)return Ie=this.schedule(void 0,Wt-nn),void Le.add(Ie);Qe()}Ge.subscribe((0,it.x)(Le,Wt=>{ke=Wt,$e=Ye.now(),Ie||(Ie=Ye.schedule(Tt,ue),Le.add(Ie))},()=>{Qe(),Le.complete()},void 0,()=>{ke=Ie=null}))})}},3997:(Ue,Se,te)=>{"use strict";te.d(Se,{x:()=>p});var E=te(2737),Be=te(9360),it=te(8251);function p(Ye,Ge=E.y){return Ye=Ye??ue,(0,Be.e)((Le,Ie)=>{let ke,$e=!0;Le.subscribe((0,it.x)(Ie,Qe=>{const Tt=Ge(Qe);($e||!Ye(ke,Tt))&&($e=!1,ke=Tt,Ie.next(Qe))}))})}function ue(Ye,Ge){return Ye===Ge}},2181:(Ue,Se,te)=>{"use strict";te.d(Se,{h:()=>it});var E=te(9360),Be=te(8251);function it(p,ue){return(0,E.e)((Ye,Ge)=>{let Le=0;Ye.subscribe((0,Be.x)(Ge,Ie=>p.call(ue,Ie,Le++)&&Ge.next(Ie)))})}},7398:(Ue,Se,te)=>{"use strict";te.d(Se,{U:()=>it});var E=te(9360),Be=te(8251);function it(p,ue){return(0,E.e)((Ye,Ge)=>{let Le=0;Ye.subscribe((0,Be.x)(Ge,Ie=>{Ge.next(p.call(ue,Ie,Le++))}))})}},7537:(Ue,Se,te)=>{"use strict";te.d(Se,{J:()=>it});var E=te(1631),Be=te(2737);function it(p=1/0){return(0,E.z)(Be.y,p)}},1631:(Ue,Se,te)=>{"use strict";te.d(Se,{z:()=>Le});var E=te(7398),Be=te(4829),it=te(9360),p=te(7103),ue=te(8251),Ge=te(4674);function Le(Ie,ke,$e=1/0){return(0,Ge.m)(ke)?Le((Qe,Tt)=>(0,E.U)((Wt,nn)=>ke(Qe,Wt,Tt,nn))((0,Be.Xf)(Ie(Qe,Tt))),$e):("number"==typeof ke&&($e=ke),(0,it.e)((Qe,Tt)=>function Ye(Ie,ke,$e,Qe,Tt,Wt,nn,Pt){const En=[];let cn=0,Dn=0,pn=!1;const nt=()=>{pn&&!En.length&&!cn&&ke.complete()},Ne=jt=>cn<Qe?Ft(jt):En.push(jt),Ft=jt=>{Wt&&ke.next(jt),cn++;let kt=!1;(0,Be.Xf)($e(jt,Dn++)).subscribe((0,ue.x)(ke,Yt=>{Tt?.(Yt),Wt?Ne(Yt):ke.next(Yt)},()=>{kt=!0},void 0,()=>{if(kt)try{for(cn--;En.length&&cn<Qe;){const Yt=En.shift();nn?(0,p.f)(ke,nn,()=>Ft(Yt)):Ft(Yt)}nt()}catch(Yt){ke.error(Yt)}}))};return Ie.subscribe((0,ue.x)(ke,Ne,()=>{pn=!0,nt()})),()=>{Pt?.()}}(Qe,Tt,Ie,$e)))}},3093:(Ue,Se,te)=>{"use strict";te.d(Se,{Q:()=>p});var E=te(7103),Be=te(9360),it=te(8251);function p(ue,Ye=0){return(0,Be.e)((Ge,Le)=>{Ge.subscribe((0,it.x)(Le,Ie=>(0,E.f)(Le,ue,()=>Le.next(Ie),Ye),()=>(0,E.f)(Le,ue,()=>Le.complete(),Ye),Ie=>(0,E.f)(Le,ue,()=>Le.error(Ie),Ye)))})}},6699:(Ue,Se,te)=>{"use strict";te.d(Se,{R:()=>p});var E=te(9360),Be=te(8251);function p(ue,Ye){return(0,E.e)(function it(ue,Ye,Ge,Le,Ie){return(ke,$e)=>{let Qe=Ge,Tt=Ye,Wt=0;ke.subscribe((0,Be.x)($e,nn=>{const Pt=Wt++;Tt=Qe?ue(Tt,nn,Pt):(Qe=!0,nn),Le&&$e.next(Tt)},Ie&&(()=>{Qe&&$e.next(Tt),$e.complete()})))}}(ue,Ye,arguments.length>=2,!0))}},3020:(Ue,Se,te)=>{"use strict";te.d(Se,{B:()=>ue});var E=te(4829),Be=te(8645),it=te(305),p=te(9360);function ue(Ge={}){const{connector:Le=(()=>new Be.x),resetOnError:Ie=!0,resetOnComplete:ke=!0,resetOnRefCountZero:$e=!0}=Ge;return Qe=>{let Tt,Wt,nn,Pt=0,En=!1,cn=!1;const Dn=()=>{Wt?.unsubscribe(),Wt=void 0},pn=()=>{Dn(),Tt=nn=void 0,En=cn=!1},nt=()=>{const Ne=Tt;pn(),Ne?.unsubscribe()};return(0,p.e)((Ne,Ft)=>{Pt++,!cn&&!En&&Dn();const jt=nn=nn??Le();Ft.add(()=>{Pt--,0===Pt&&!cn&&!En&&(Wt=Ye(nt,$e))}),jt.subscribe(Ft),!Tt&&Pt>0&&(Tt=new it.Hp({next:kt=>jt.next(kt),error:kt=>{cn=!0,Dn(),Wt=Ye(pn,Ie,kt),jt.error(kt)},complete:()=>{En=!0,Dn(),Wt=Ye(pn,ke),jt.complete()}}),(0,E.Xf)(Ne).subscribe(Tt))})(Qe)}}function Ye(Ge,Le,...Ie){if(!0===Le)return void Ge();if(!1===Le)return;const ke=new it.Hp({next:()=>{ke.unsubscribe(),Ge()}});return(0,E.Xf)(Le(...Ie)).subscribe(ke)}},836:(Ue,Se,te)=>{"use strict";te.d(Se,{T:()=>Be});var E=te(2181);function Be(it){return(0,E.h)((p,ue)=>it<=ue)}},4664:(Ue,Se,te)=>{"use strict";te.d(Se,{w:()=>p});var E=te(4829),Be=te(9360),it=te(8251);function p(ue,Ye){return(0,Be.e)((Ge,Le)=>{let Ie=null,ke=0,$e=!1;const Qe=()=>$e&&!Ie&&Le.complete();Ge.subscribe((0,it.x)(Le,Tt=>{Ie?.unsubscribe();let Wt=0;const nn=ke++;(0,E.Xf)(ue(Tt,nn)).subscribe(Ie=(0,it.x)(Le,Pt=>Le.next(Ye?Ye(Tt,Pt,nn,Wt++):Pt),()=>{Ie=null,Qe()}))},()=>{$e=!0,Qe()}))})}},8180:(Ue,Se,te)=>{"use strict";te.d(Se,{q:()=>p});var E=te(6232),Be=te(9360),it=te(8251);function p(ue){return ue<=0?()=>E.E:(0,Be.e)((Ye,Ge)=>{let Le=0;Ye.subscribe((0,it.x)(Ge,Ie=>{++Le<=ue&&(Ge.next(Ie),ue<=Le&&Ge.complete())}))})}},9773:(Ue,Se,te)=>{"use strict";te.d(Se,{R:()=>ue});var E=te(9360),Be=te(8251),it=te(4829),p=te(2420);function ue(Ye){return(0,E.e)((Ge,Le)=>{(0,it.Xf)(Ye).subscribe((0,Be.x)(Le,()=>Le.complete(),p.Z)),!Le.closed&&Ge.subscribe(Le)})}},5178:(Ue,Se,te)=>{"use strict";te.d(Se,{V:()=>Ie});var E=te(6321),Be=te(93),it=te(9360),p=te(4829),ue=te(2306),Ye=te(8251),Ge=te(7103);const Le=(0,ue.d)($e=>function(Tt=null){$e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=Tt});function Ie($e,Qe){const{first:Tt,each:Wt,with:nn=ke,scheduler:Pt=Qe??E.z,meta:En=null}=(0,Be.q)($e)?{first:$e}:"number"==typeof $e?{each:$e}:$e;if(null==Tt&&null==Wt)throw new TypeError("No timeout provided.");return(0,it.e)((cn,Dn)=>{let pn,nt,Ne=null,Ft=0;const jt=kt=>{nt=(0,Ge.f)(Dn,Pt,()=>{try{pn.unsubscribe(),(0,p.Xf)(nn({meta:En,lastValue:Ne,seen:Ft})).subscribe(Dn)}catch(Yt){Dn.error(Yt)}},kt)};pn=cn.subscribe((0,Ye.x)(Dn,kt=>{nt?.unsubscribe(),Ft++,Dn.next(Ne=kt),Wt>0&&jt(Wt)},void 0,void 0,()=>{nt?.closed||nt?.unsubscribe(),Ne=null})),!Ft&&jt(null!=Tt?"number"==typeof Tt?Tt:+Tt-Pt.now():Wt)})}function ke($e){throw new Le($e)}},2460:(Ue,Se,te)=>{"use strict";te.d(Se,{M:()=>Ge});var E=te(9360),Be=te(8251),it=te(4829),p=te(2737),ue=te(2420),Ye=te(9940);function Ge(...Le){const Ie=(0,Ye.jO)(Le);return(0,E.e)((ke,$e)=>{const Qe=Le.length,Tt=new Array(Qe);let Wt=Le.map(()=>!1),nn=!1;for(let Pt=0;Pt<Qe;Pt++)(0,it.Xf)(Le[Pt]).subscribe((0,Be.x)($e,En=>{Tt[Pt]=En,!nn&&!Wt[Pt]&&(Wt[Pt]=!0,(nn=Wt.every(p.y))&&(Wt=null))},ue.Z));ke.subscribe((0,Be.x)($e,Pt=>{if(nn){const En=[Pt,...Tt];$e.next(Ie?Ie(...En):En)}}))})}},1954:(Ue,Se,te)=>{"use strict";te.d(Se,{o:()=>ue});var E=te(7394);class Be extends E.w0{constructor(Ge,Le){super()}schedule(Ge,Le=0){return this}}const it={setInterval(Ye,Ge,...Le){const{delegate:Ie}=it;return Ie?.setInterval?Ie.setInterval(Ye,Ge,...Le):setInterval(Ye,Ge,...Le)},clearInterval(Ye){const{delegate:Ge}=it;return(Ge?.clearInterval||clearInterval)(Ye)},delegate:void 0};var p=te(9039);class ue extends Be{constructor(Ge,Le){super(Ge,Le),this.scheduler=Ge,this.work=Le,this.pending=!1}schedule(Ge,Le=0){var Ie;if(this.closed)return this;this.state=Ge;const ke=this.id,$e=this.scheduler;return null!=ke&&(this.id=this.recycleAsyncId($e,ke,Le)),this.pending=!0,this.delay=Le,this.id=null!==(Ie=this.id)&&void 0!==Ie?Ie:this.requestAsyncId($e,this.id,Le),this}requestAsyncId(Ge,Le,Ie=0){return it.setInterval(Ge.flush.bind(Ge,this),Ie)}recycleAsyncId(Ge,Le,Ie=0){if(null!=Ie&&this.delay===Ie&&!1===this.pending)return Le;null!=Le&&it.clearInterval(Le)}execute(Ge,Le){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const Ie=this._execute(Ge,Le);if(Ie)return Ie;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(Ge,Le){let ke,Ie=!1;try{this.work(Ge)}catch($e){Ie=!0,ke=$e||new Error("Scheduled action threw falsy error")}if(Ie)return this.unsubscribe(),ke}unsubscribe(){if(!this.closed){const{id:Ge,scheduler:Le}=this,{actions:Ie}=Le;this.work=this.state=this.scheduler=null,this.pending=!1,(0,p.P)(Ie,this),null!=Ge&&(this.id=this.recycleAsyncId(Le,Ge,null)),this.delay=null,super.unsubscribe()}}}},2631:(Ue,Se,te)=>{"use strict";te.d(Se,{v:()=>it});var E=te(4552);class Be{constructor(ue,Ye=Be.now){this.schedulerActionCtor=ue,this.now=Ye}schedule(ue,Ye=0,Ge){return new this.schedulerActionCtor(this,ue).schedule(Ge,Ye)}}Be.now=E.l.now;class it extends Be{constructor(ue,Ye=Be.now){super(ue,Ye),this.actions=[],this._active=!1}flush(ue){const{actions:Ye}=this;if(this._active)return void Ye.push(ue);let Ge;this._active=!0;do{if(Ge=ue.execute(ue.state,ue.delay))break}while(ue=Ye.shift());if(this._active=!1,Ge){for(;ue=Ye.shift();)ue.unsubscribe();throw Ge}}}},6321:(Ue,Se,te)=>{"use strict";te.d(Se,{P:()=>p,z:()=>it});var E=te(1954);const it=new(te(2631).v)(E.o),p=it},4552:(Ue,Se,te)=>{"use strict";te.d(Se,{l:()=>E});const E={now:()=>(E.delegate||Date).now(),delegate:void 0}},2381:(Ue,Se,te)=>{"use strict";te.d(Se,{N:()=>ue});var E=te(1954),it=te(2631);const ue=new class p extends it.v{}(class Be extends E.o{constructor(Le,Ie){super(Le,Ie),this.scheduler=Le,this.work=Ie}schedule(Le,Ie=0){return Ie>0?super.schedule(Le,Ie):(this.delay=Ie,this.state=Le,this.scheduler.flush(this),this)}execute(Le,Ie){return Ie>0||this.closed?super.execute(Le,Ie):this._execute(Le,Ie)}requestAsyncId(Le,Ie,ke=0){return null!=ke&&ke>0||null==ke&&this.delay>0?super.requestAsyncId(Le,Ie,ke):(Le.flush(this),0)}})},7599:(Ue,Se,te)=>{"use strict";te.d(Se,{z:()=>E});const E={setTimeout(Be,it,...p){const{delegate:ue}=E;return ue?.setTimeout?ue.setTimeout(Be,it,...p):setTimeout(Be,it,...p)},clearTimeout(Be){const{delegate:it}=E;return(it?.clearTimeout||clearTimeout)(Be)},delegate:void 0}},4971:(Ue,Se,te)=>{"use strict";te.d(Se,{h:()=>Be});const Be=function E(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},4850:(Ue,Se,te)=>{"use strict";te.d(Se,{L:()=>E});const E="function"==typeof Symbol&&Symbol.observable||"@@observable"},9940:(Ue,Se,te)=>{"use strict";te.d(Se,{_6:()=>Ye,jO:()=>p,yG:()=>ue});var E=te(4674),Be=te(671);function it(Ge){return Ge[Ge.length-1]}function p(Ge){return(0,E.m)(it(Ge))?Ge.pop():void 0}function ue(Ge){return(0,Be.K)(it(Ge))?Ge.pop():void 0}function Ye(Ge,Le){return"number"==typeof it(Ge)?Ge.pop():Le}},9039:(Ue,Se,te)=>{"use strict";function E(Be,it){if(Be){const p=Be.indexOf(it);0<=p&&Be.splice(p,1)}}te.d(Se,{P:()=>E})},2306:(Ue,Se,te)=>{"use strict";function E(Be){const p=Be(ue=>{Error.call(ue),ue.stack=(new Error).stack});return p.prototype=Object.create(Error.prototype),p.prototype.constructor=p,p}te.d(Se,{d:()=>E})},1441:(Ue,Se,te)=>{"use strict";te.d(Se,{O:()=>p,x:()=>it});var E=te(2653);let Be=null;function it(ue){if(E.config.useDeprecatedSynchronousErrorHandling){const Ye=!Be;if(Ye&&(Be={errorThrown:!1,error:null}),ue(),Ye){const{errorThrown:Ge,error:Le}=Be;if(Be=null,Ge)throw Le}}else ue()}function p(ue){E.config.useDeprecatedSynchronousErrorHandling&&Be&&(Be.errorThrown=!0,Be.error=ue)}},7103:(Ue,Se,te)=>{"use strict";function E(Be,it,p,ue=0,Ye=!1){const Ge=it.schedule(function(){p(),Ye?Be.add(this.schedule(null,ue)):this.unsubscribe()},ue);if(Be.add(Ge),!Ye)return Ge}te.d(Se,{f:()=>E})},2737:(Ue,Se,te)=>{"use strict";function E(Be){return Be}te.d(Se,{y:()=>E})},4266:(Ue,Se,te)=>{"use strict";te.d(Se,{z:()=>E});const E=Be=>Be&&"number"==typeof Be.length&&"function"!=typeof Be},5726:(Ue,Se,te)=>{"use strict";te.d(Se,{D:()=>Be});var E=te(4674);function Be(it){return Symbol.asyncIterator&&(0,E.m)(it?.[Symbol.asyncIterator])}},93:(Ue,Se,te)=>{"use strict";function E(Be){return Be instanceof Date&&!isNaN(Be)}te.d(Se,{q:()=>E})},4674:(Ue,Se,te)=>{"use strict";function E(Be){return"function"==typeof Be}te.d(Se,{m:()=>E})},8382:(Ue,Se,te)=>{"use strict";te.d(Se,{c:()=>it});var E=te(4850),Be=te(4674);function it(p){return(0,Be.m)(p[E.L])}},3664:(Ue,Se,te)=>{"use strict";te.d(Se,{T:()=>it});var E=te(4971),Be=te(4674);function it(p){return(0,Be.m)(p?.[E.h])}},4026:(Ue,Se,te)=>{"use strict";te.d(Se,{t:()=>Be});var E=te(4674);function Be(it){return(0,E.m)(it?.then)}},541:(Ue,Se,te)=>{"use strict";te.d(Se,{L:()=>p,Q:()=>it});var E=te(7582),Be=te(4674);function it(ue){return(0,E.FC)(this,arguments,function*(){const Ge=ue.getReader();try{for(;;){const{value:Le,done:Ie}=yield(0,E.qq)(Ge.read());if(Ie)return yield(0,E.qq)(void 0);yield yield(0,E.qq)(Le)}}finally{Ge.releaseLock()}})}function p(ue){return(0,Be.m)(ue?.getReader)}},671:(Ue,Se,te)=>{"use strict";te.d(Se,{K:()=>Be});var E=te(4674);function Be(it){return it&&(0,E.m)(it.schedule)}},9360:(Ue,Se,te)=>{"use strict";te.d(Se,{A:()=>Be,e:()=>it});var E=te(4674);function Be(p){return(0,E.m)(p?.lift)}function it(p){return ue=>{if(Be(ue))return ue.lift(function(Ye){try{return p(Ye,this)}catch(Ge){this.error(Ge)}});throw new TypeError("Unable to lift unknown Observable type")}}},2420:(Ue,Se,te)=>{"use strict";function E(){}te.d(Se,{Z:()=>E})},8407:(Ue,Se,te)=>{"use strict";te.d(Se,{U:()=>it,z:()=>Be});var E=te(2737);function Be(...p){return it(p)}function it(p){return 0===p.length?E.y:1===p.length?p[0]:function(Ye){return p.reduce((Ge,Le)=>Le(Ge),Ye)}}},3894:(Ue,Se,te)=>{"use strict";te.d(Se,{h:()=>it});var E=te(2653),Be=te(7599);function it(p){Be.z.setTimeout(()=>{const{onUnhandledError:ue}=E.config;if(!ue)throw p;ue(p)})}},9853:(Ue,Se,te)=>{"use strict";function E(Be){return new TypeError(`You provided ${null!==Be&&"object"==typeof Be?"an invalid object":`'${Be}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}te.d(Se,{z:()=>E})},5879:(Ue,Se,te)=>{"use strict";te.d(Se,{$8M:()=>Co,$WT:()=>Xo,$Z:()=>um,AFp:()=>sy,ALo:()=>gv,AaK:()=>Qe,CHM:()=>Sd,CRH:()=>Sw,EJc:()=>rT,EpF:()=>su,F4k:()=>Qg,FYo:()=>nm,FiY:()=>Xh,Flj:()=>ip,GfV:()=>Pg,Gpc:()=>nn,HDt:()=>dC,JOm:()=>jc,Jf7:()=>ah,KtG:()=>Id,LFG:()=>Jn,LSH:()=>yg,Lbi:()=>Hp,Lck:()=>xE,MMx:()=>Kx,MR2:()=>vf,NdJ:()=>Bb,Ojb:()=>na,OlP:()=>Fi,Oqu:()=>N0,P3R:()=>Q_,PXZ:()=>RT,Q6J:()=>kb,QGY:()=>Jg,QbO:()=>Gp,Qsj:()=>Ig,R0b:()=>Gr,RDi:()=>q_,Rgc:()=>d_,SBq:()=>Mf,Sil:()=>aT,Suo:()=>Ev,TTD:()=>Uh,TgZ:()=>Uy,VuI:()=>eM,X6Q:()=>DC,XFs:()=>Un,Xpm:()=>_e,Xq5:()=>Ke,Xts:()=>th,Y36:()=>Qu,YKP:()=>Yx,YNc:()=>w0,Yjl:()=>Zi,Yz7:()=>An,Z0I:()=>Ii,ZZ4:()=>Qw,_Bn:()=>qx,_UZ:()=>C0,_Vd:()=>Yu,_c5:()=>mb,_uU:()=>ax,aQg:()=>e1,c2e:()=>uC,cJS:()=>Vi,cg1:()=>j0,dDg:()=>MT,dqk:()=>Ui,eFA:()=>xC,eJc:()=>Iw,ekj:()=>L0,eoX:()=>_C,f3M:()=>si,g9A:()=>Cf,gHi:()=>Il,h0i:()=>Yf,hGG:()=>VC,iGM:()=>Mw,ifc:()=>Cs,ip1:()=>cC,jDz:()=>Qx,kL8:()=>wx,ktI:()=>wa,lG2:()=>or,lcZ:()=>hw,lqb:()=>Ja,lri:()=>mC,n5z:()=>ki,oAB:()=>Vt,oxw:()=>_1,qFp:()=>iM,qLn:()=>el,qOj:()=>P,qZA:()=>jy,rWj:()=>gC,rg0:()=>I_,s9C:()=>zb,sBO:()=>LT,s_b:()=>vv,soG:()=>ub,tBr:()=>Km,tb:()=>zw,tdS:()=>S_,tp0:()=>Kh,uIk:()=>Ut,vHH:()=>nt,vpe:()=>ac,wAp:()=>Mm,xp6:()=>cm,z2F:()=>Kf,zSh:()=>Up,zs3:()=>xa});var E=te(8645),Be=te(7394),it=te(5592),p=te(3019),ue=te(5619),Ye=te(2096),Ge=te(3020),Le=te(4664),Ie=te(3997);function ke(n){for(let l in n)if(n[l]===ke)return l;throw Error("Could not find renamed property on target object.")}function $e(n,l){for(const d in l)l.hasOwnProperty(d)&&!n.hasOwnProperty(d)&&(n[d]=l[d])}function Qe(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Qe).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const l=n.toString();if(null==l)return""+l;const d=l.indexOf("\n");return-1===d?l:l.substring(0,d)}function Tt(n,l){return null==n||""===n?null===l?"":l:null==l||""===l?n:n+" "+l}const Wt=ke({__forward_ref__:ke});function nn(n){return n.__forward_ref__=nn,n.toString=function(){return Qe(this())},n}function Pt(n){return En(n)?n():n}function En(n){return"function"==typeof n&&n.hasOwnProperty(Wt)&&n.__forward_ref__===nn}function cn(n){return n&&!!n.\u0275providers}const pn="https://g.co/ng/security#xss";class nt extends Error{constructor(l,d){super(function Ne(n,l){return`NG0${Math.abs(n)}${l?": "+l:""}`}(l,d)),this.code=l}}function Ft(n){return"string"==typeof n?n:null==n?"":String(n)}function mi(n,l){throw new nt(-201,!1)}function mt(n,l){null==n&&function gt(n,l,d,g){throw new Error(`ASSERTION ERROR: ${n}`+(null==g?"":` [Expected=> ${d} ${g} ${l} <=Actual]`))}(l,n,null,"!=")}function An(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Vi(n){return{providers:n.providers||[],imports:n.imports||[]}}function Xr(n){return rr(n,aa)||rr(n,So)}function Ii(n){return null!==Xr(n)}function rr(n,l){return n.hasOwnProperty(l)?n[l]:null}function ws(n){return n&&(n.hasOwnProperty(po)||n.hasOwnProperty(Bl))?n[po]:null}const aa=ke({\u0275prov:ke}),po=ke({\u0275inj:ke}),So=ke({ngInjectableDef:ke}),Bl=ke({ngInjectorDef:ke});var Un=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(Un||{});let ni;function ri(){return ni}function zr(n){const l=ni;return ni=n,l}function Io(n,l,d){const g=Xr(n);return g&&"root"==g.providedIn?void 0===g.value?g.value=g.factory():g.value:d&Un.Optional?null:void 0!==l?l:void mi(Qe(n))}const Ui=globalThis,je={},Pe="__NG_DI_FLAG__",et="ngTempTokenPath",Zt=/\n/gm,Zn="__source";let Nn;function jn(n){const l=Nn;return Nn=n,l}function Qn(n,l=Un.Default){if(void 0===Nn)throw new nt(-203,!1);return null===Nn?Io(n,void 0,l):Nn.get(n,l&Un.Optional?null:void 0,l)}function Jn(n,l=Un.Default){return(ri()||Qn)(Pt(n),l)}function si(n,l=Un.Default){return Jn(n,Xi(l))}function Xi(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function Ao(n){const l=[];for(let d=0;d<n.length;d++){const g=Pt(n[d]);if(Array.isArray(g)){if(0===g.length)throw new nt(900,!1);let b,T=Un.Default;for(let R=0;R<g.length;R++){const L=g[R],V=Jr(L);"number"==typeof V?-1===V?b=L.token:T|=V:b=L}l.push(Jn(b,T))}else l.push(Jn(g))}return l}function pr(n,l){return n[Pe]=l,n.prototype[Pe]=l,n}function Jr(n){return n[Pe]}function Es(n){return{toString:n}.toString()}var pi=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(pi||{}),Cs=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(Cs||{});const Qr={},xi=[],Ws=ke({\u0275cmp:ke}),go=ke({\u0275dir:ke}),_o=ke({\u0275pipe:ke}),gc=ke({\u0275mod:ke}),Zo=ke({\u0275fac:ke}),Po=ke({__NG_ELEMENT_ID__:ke}),qo=ke({__NG_ENV_ID__:ke});function ka(n,l,d){let g=n.length;for(;;){const b=n.indexOf(l,d);if(-1===b)return b;if(0===b||n.charCodeAt(b-1)<=32){const T=l.length;if(b+T===g||n.charCodeAt(b+T)<=32)return b}d=b+1}}function lt(n,l,d){let g=0;for(;g<d.length;){const b=d[g];if("number"==typeof b){if(0!==b)break;g++;const T=d[g++],R=d[g++],L=d[g++];n.setAttribute(l,R,L,T)}else{const T=b,R=d[++g];Ji(T)?n.setProperty(l,T,R):n.setAttribute(l,T,R),g++}}return g}function Ds(n){return 3===n||4===n||6===n}function Ji(n){return 64===n.charCodeAt(0)}function mr(n,l){if(null!==l&&0!==l.length)if(null===n||0===n.length)n=l.slice();else{let d=-1;for(let g=0;g<l.length;g++){const b=l[g];"number"==typeof b?d=b:0===d||_c(n,d,b,null,-1===d||2===d?l[++g]:null)}}return n}function _c(n,l,d,g,b){let T=0,R=n.length;if(-1===l)R=-1;else for(;T<n.length;){const L=n[T++];if("number"==typeof L){if(L===l){R=-1;break}if(L>l){R=T-1;break}}}for(;T<n.length;){const L=n[T];if("number"==typeof L)break;if(L===d){if(null===g)return void(null!==b&&(n[T+1]=b));if(g===n[T+1])return void(n[T+2]=b)}T++,null!==g&&T++,null!==b&&T++}-1!==R&&(n.splice(R,0,l),T=R+1),n.splice(T++,0,d),null!==g&&n.splice(T++,0,g),null!==b&&n.splice(T++,0,b)}const Ro="ng-template";function fd(n,l,d){let g=0,b=!0;for(;g<n.length;){let T=n[g++];if("string"==typeof T&&b){const R=n[g++];if(d&&"class"===T&&-1!==ka(R.toLowerCase(),l,0))return!0}else{if(1===T){for(;g<n.length&&"string"==typeof(T=n[g++]);)if(T.toLowerCase()===l)return!0;return!1}"number"==typeof T&&(b=!1)}}return!1}function La(n){return 4===n.type&&n.value!==Ro}function zl(n,l,d){return l===(4!==n.type||d?n.value:Ro)}function Jt(n,l,d){let g=4;const b=n.attrs||[],T=function ai(n){for(let l=0;l<n.length;l++)if(Ds(n[l]))return l;return n.length}(b);let R=!1;for(let L=0;L<l.length;L++){const V=l[L];if("number"!=typeof V){if(!R)if(4&g){if(g=2|1&g,""!==V&&!zl(n,V,d)||""===V&&1===l.length){if(Ln(g))return!1;R=!0}}else{const W=8&g?V:l[++L];if(8&g&&null!==n.attrs){if(!fd(n.attrs,W,d)){if(Ln(g))return!1;R=!0}continue}const me=ei(8&g?"class":V,b,La(n),d);if(-1===me){if(Ln(g))return!1;R=!0;continue}if(""!==W){let Fe;Fe=me>T?"":b[me+1].toLowerCase();const Ze=8&g?Fe:null;if(Ze&&-1!==ka(Ze,W,0)||2&g&&W!==Fe){if(Ln(g))return!1;R=!0}}}}else{if(!R&&!Ln(g)&&!Ln(V))return!1;if(R&&Ln(V))continue;R=!1,g=V|1&g}}return Ln(g)||R}function Ln(n){return 0==(1&n)}function ei(n,l,d,g){if(null===l)return-1;let b=0;if(g||!d){let T=!1;for(;b<l.length;){const R=l[b];if(R===n)return b;if(3===R||6===R)T=!0;else{if(1===R||2===R){let L=l[++b];for(;"string"==typeof L;)L=l[++b];continue}if(4===R)break;if(0===R){b+=4;continue}}b+=T?1:2}return-1}return function so(n,l){let d=n.indexOf(4);if(d>-1)for(d++;d<n.length;){const g=n[d];if("number"==typeof g)return-1;if(g===l)return d;d++}return-1}(l,n)}function Oo(n,l,d=!1){for(let g=0;g<l.length;g++)if(Jt(n,l[g],d))return!0;return!1}function la(n,l){return n?":not("+l.trim()+")":l}function as(n){let l=n[0],d=1,g=2,b="",T=!1;for(;d<n.length;){let R=n[d];if("string"==typeof R)if(2&g){const L=n[++d];b+="["+R+(L.length>0?'="'+L+'"':"")+"]"}else 8&g?b+="."+R:4&g&&(b+=" "+R);else""!==b&&!Ln(R)&&(l+=la(T,b),b=""),g=R,T=T||!Ln(g);d++}return""!==b&&(l+=la(T,b)),l}function _e(n){return Es(()=>{const l=yo(n),d={...l,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===pi.OnPush,directiveDefs:null,pipeDefs:null,dependencies:l.standalone&&n.dependencies||null,getStandaloneInjector:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Cs.Emulated,styles:n.styles||xi,_:null,schemas:n.schemas||null,tView:null,id:""};Oh(d);const g=n.dependencies;return d.directiveDefs=ul(g,!1),d.pipeDefs=ul(g,!0),d.id=function uu(n){let l=0;const d=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(const b of d)l=Math.imul(31,l)+b.charCodeAt(0)<<0;return l+=2147483648,"c"+l}(d),d})}function Et(n){return Cn(n)||xn(n)}function qe(n){return null!==n}function Vt(n){return Es(()=>({type:n.type,bootstrap:n.bootstrap||xi,declarations:n.declarations||xi,imports:n.imports||xi,exports:n.exports||xi,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Gn(n,l){if(null==n)return Qr;const d={};for(const g in n)if(n.hasOwnProperty(g)){let b=n[g],T=b;Array.isArray(b)&&(T=b[1],b=b[0]),d[b]=g,l&&(l[b]=T)}return d}function or(n){return Es(()=>{const l=yo(n);return Oh(l),l})}function Zi(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function Cn(n){return n[Ws]||null}function xn(n){return n[go]||null}function $i(n){return n[_o]||null}function Xo(n){const l=Cn(n)||xn(n)||$i(n);return null!==l&&l.standalone}function qi(n,l){const d=n[gc]||null;if(!d&&!0===l)throw new Error(`Type ${Qe(n)} does not have '\u0275mod' property.`);return d}function yo(n){const l={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:l,inputTransforms:null,inputConfig:n.inputs||Qr,exportAs:n.exportAs||null,standalone:!0===n.standalone,signals:!0===n.signals,selectors:n.selectors||xi,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Gn(n.inputs,l),outputs:Gn(n.outputs)}}function Oh(n){n.features?.forEach(l=>l(n))}function ul(n,l){if(!n)return null;const d=l?$i:Et;return()=>("function"==typeof n?n():n).map(g=>d(g)).filter(qe)}const hr=0,ln=1,Tn=2,sr=3,ko=4,Lo=5,Mr=6,dl=7,gr=8,Zs=9,qs=10,Bn=11,Vl=12,hl=13,Fo=14,_r=15,Ts=16,fl=17,No=18,Fa=19,kh=20,ca=21,Ms=22,du=23,Ys=24,yn=25,hu=1,Lh=2,Bo=7,Ul=9,Vr=11;function Or(n){return Array.isArray(n)&&"object"==typeof n[hu]}function kr(n){return Array.isArray(n)&&!0===n[hu]}function yc(n){return 0!=(4&n.flags)}function pl(n){return n.componentOffset>-1}function jl(n){return 1==(1&n.flags)}function Ss(n){return!!n.template}function pu(n){return 0!=(512&n[Tn])}function Na(n,l){return n.hasOwnProperty(Zo)?n[Zo]:null}const bc=Symbol("SIGNAL");function vo(n,l,d={}){return l[bc]=n,Object.assign(l,d)}function yd(n,l){return(null===n||"object"!=typeof n)&&Object.is(n,l)}let _u=Ui.WeakRef??class np{constructor(l){this.ref=l}deref(){return this.ref}},T_=0,Is=null,ml=!1;function Lr(n){const l=Is;return Is=n,l}class vd{constructor(){this.id=T_++,this.ref=function Bh(n){return new _u(n)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[l,d]of this.producers){const g=d.producerNode.deref();if(null!=g&&d.atTrackingVersion===this.trackingVersion){if(g.producerPollStatus(d.seenValueVersion))return!0}else this.producers.delete(l),g?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const l=ml;ml=!0;try{for(const[d,g]of this.consumers){const b=g.consumerNode.deref();null!=b&&b.trackingVersion===g.atTrackingVersion?b.onConsumerDependencyMayHaveChanged():(this.consumers.delete(d),b?.producers.delete(this.id))}}finally{ml=l}}producerAccessed(){if(ml)throw new Error("");if(null===Is)return;let l=Is.producers.get(this.id);void 0===l?(l={consumerNode:Is.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:Is.trackingVersion},Is.producers.set(this.id,l),this.consumers.set(Is.id,l)):(l.seenValueVersion=this.valueVersion,l.atTrackingVersion=Is.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==Is?.consumerAllowSignalWrites}producerPollStatus(l){return this.valueVersion!==l||(this.onProducerUpdateValueVersion(),this.valueVersion!==l)}}function ip(n,l){const d=new wd(n,l?.equal??yd);return vo(d,d.signal.bind(d))}const rp=Symbol("UNSET"),bd=Symbol("COMPUTING"),xd=Symbol("ERRORED");class wd extends vd{constructor(l,d){super(),this.computation=l,this.equal=d,this.value=rp,this.error=null,this.stale=!0,this.consumerAllowSignalWrites=!1}onConsumerDependencyMayHaveChanged(){this.stale||(this.stale=!0,this.producerMayHaveChanged())}onProducerUpdateValueVersion(){if(this.stale){if(this.value!==rp&&this.value!==bd&&!this.consumerPollProducersForChange())return void(this.stale=!1);this.recomputeValue()}}recomputeValue(){if(this.value===bd)throw new Error("Detected cycle in computations.");const l=this.value;this.value=bd,this.trackingVersion++;const d=Lr(this);let g;try{g=this.computation()}catch(b){g=xd,this.error=b}finally{Lr(d)}this.stale=!1,l!==rp&&l!==xd&&g!==xd&&this.equal(l,g)?this.value=l:(this.value=g,this.valueVersion++)}signal(){if(this.onProducerUpdateValueVersion(),this.producerAccessed(),this.value===xd)throw this.error;return this.value}}let yu=function $m(){throw new Error};function zh(){yu()}class M_ extends vd{constructor(l,d){super(),this.value=l,this.equal=d,this.consumerAllowSignalWrites=!1}onConsumerDependencyMayHaveChanged(){}onProducerUpdateValueVersion(){}set(l){this.producerUpdatesAllowed||zh(),this.equal(this.value,l)||(this.value=l,this.valueVersion++,this.producerMayHaveChanged())}update(l){this.producerUpdatesAllowed||zh(),this.set(l(this.value))}mutate(l){this.producerUpdatesAllowed||zh(),l(this.value),this.valueVersion++,this.producerMayHaveChanged()}asReadonly(){return void 0===this.readonlySignal&&(this.readonlySignal=vo(this,()=>this.signal())),this.readonlySignal}signal(){return this.producerAccessed(),this.value}}function S_(n,l){const d=new M_(n,l?.equal??yd);return vo(d,d.signal.bind(d),{set:d.set.bind(d),update:d.update.bind(d),mutate:d.mutate.bind(d),asReadonly:d.asReadonly.bind(d)})}function I_(n){const l=Lr(null);try{return n()}finally{Lr(l)}}const op=()=>{};class Vh extends vd{constructor(l,d,g){super(),this.watch=l,this.schedule=d,this.dirty=!1,this.cleanupFn=op,this.registerOnCleanup=b=>{this.cleanupFn=b},this.consumerAllowSignalWrites=g}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const l=Lr(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=op,this.watch(this.registerOnCleanup)}finally{Lr(l)}}cleanup(){this.cleanupFn()}}class vu{constructor(l,d,g){this.previousValue=l,this.currentValue=d,this.firstChange=g}isFirstChange(){return this.firstChange}}function Uh(){return sp}function sp(n){return n.type.prototype.ngOnChanges&&(n.setInput=$l),gl}function gl(){const n=wc(this),l=n?.current;if(l){const d=n.previous;if(d===Qr)n.previous=l;else for(let g in l)d[g]=l[g];n.current=null,this.ngOnChanges(l)}}function $l(n,l,d,g){const b=this.declaredInputs[d],T=wc(n)||function Cd(n,l){return n[As]=l}(n,{previous:Qr,current:null}),R=T.current||(T.current={}),L=T.previous,V=L[b];R[b]=new vu(V&&V.currentValue,l,L===Qr),n[g]=l}Uh.ngInherit=!0;const As="__ngSimpleChanges__";function wc(n){return n[As]||null}const bo=function(n,l,d){};function Hi(n){for(;Array.isArray(n);)n=n[hr];return n}function _l(n,l){return Hi(l[n])}function Ur(n,l){return Hi(l[n.index])}function Dc(n,l){return n.data[l]}function wo(n,l){const d=l[n];return Or(d)?d:d[hr]}function da(n,l){return null==l?null:n[l]}function Sc(n){n[fl]=0}function wu(n){1024&n[Tn]||(n[Tn]|=1024,Ic(n,1))}function Eu(n){1024&n[Tn]&&(n[Tn]&=-1025,Ic(n,-1))}function Ic(n,l){let d=n[sr];if(null===d)return;d[Lo]+=l;let g=d;for(d=d[sr];null!==d&&(1===l&&1===g[Lo]||-1===l&&0===g[Lo]);)d[Lo]+=l,g=d,d=d[sr]}function tn(n,l){if(256==(256&n[Tn]))throw new nt(911,!1);null===n[ca]&&(n[ca]=[]),n[ca].push(l)}const Xn={lFrame:Gl(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Td(){return Xn.bindingsEnabled}function Nt(){return Xn.lFrame.lView}function yi(){return Xn.lFrame.tView}function Sd(n){return Xn.lFrame.contextLView=n,n[gr]}function Id(n){return Xn.lFrame.contextLView=null,n}function Zr(){let n=Pc();for(;null!==n&&64===n.type;)n=n.parent;return n}function Pc(){return Xn.lFrame.currentTNode}function Ko(n,l){const d=Xn.lFrame;d.currentTNode=n,d.isParent=l}function Rc(){return Xn.lFrame.isParent}function yl(){return Xn.lFrame.bindingIndex++}function no(n,l){const d=Xn.lFrame;d.bindingIndex=d.bindingRootIndex=n,Hh(l)}function Hh(n){Xn.lFrame.currentDirectiveIndex=n}function Hm(){return Xn.lFrame.currentQueryIndex}function Jo(n){Xn.lFrame.currentQueryIndex=n}function Gm(n){const l=n[ln];return 2===l.type?l.declTNode:1===l.type?n[Mr]:null}function Wm(n,l,d){if(d&Un.SkipSelf){let b=l,T=n;for(;!(b=b.parent,null!==b||d&Un.Host||(b=Gm(T),null===b||(T=T[Fo],10&b.type))););if(null===b)return!1;l=b,n=T}const g=Xn.lFrame=pa();return g.currentTNode=l,g.lView=n,!0}function Ps(n){const l=pa(),d=n[ln];Xn.lFrame=l,l.currentTNode=d.firstChild,l.lView=n,l.tView=d,l.contextLView=n,l.bindingIndex=d.bindingStartIndex,l.inI18n=!1}function pa(){const n=Xn.lFrame,l=null===n?null:n.child;return null===l?Gl(n):l}function Gl(n){const l={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=l),l}function Pd(){const n=Xn.lFrame;return Xn.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const dn=Pd;function Rd(){const n=Pd();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function jr(){return Xn.lFrame.selectedIndex}function Xt(n){Xn.lFrame.selectedIndex=n}function yr(){const n=Xn.lFrame;return Dc(n.tView,n.selectedIndex)}let us=!0;function Od(){return us}function ar(n){us=n}function Eo(n,l){for(let d=l.directiveStart,g=l.directiveEnd;d<g;d++){const T=n.data[d].type.prototype,{ngAfterContentInit:R,ngAfterContentChecked:L,ngAfterViewInit:V,ngAfterViewChecked:W,ngOnDestroy:ne}=T;R&&(n.contentHooks??=[]).push(-d,R),L&&((n.contentHooks??=[]).push(d,L),(n.contentCheckHooks??=[]).push(d,L)),V&&(n.viewHooks??=[]).push(-d,V),W&&((n.viewHooks??=[]).push(d,W),(n.viewCheckHooks??=[]).push(d,W)),null!=ne&&(n.destroyHooks??=[]).push(d,ne)}}function Va(n,l,d){f(n,l,3,d)}function _(n,l,d,g){(3&n[Tn])===d&&f(n,l,d,g)}function a(n,l){let d=n[Tn];(3&d)===l&&(d&=8191,d+=1,n[Tn]=d)}function f(n,l,d,g){const T=g??-1,R=l.length-1;let L=0;for(let V=void 0!==g?65535&n[fl]:0;V<R;V++)if("number"==typeof l[V+1]){if(L=l[V],null!=g&&L>=g)break}else l[V]<0&&(n[fl]+=65536),(L<T||-1==T)&&(C(n,d,l,V),n[fl]=(4294901760&n[fl])+V+2),V++}function v(n,l){bo(4,n,l);const d=Lr(null);try{l.call(n)}finally{Lr(d),bo(5,n,l)}}function C(n,l,d,g){const b=d[g]<0,T=d[g+1],L=n[b?-d[g]:d[g]];b?n[Tn]>>13<n[fl]>>16&&(3&n[Tn])===l&&(n[Tn]+=8192,v(L,T)):v(L,T)}const M=-1;class O{constructor(l,d,g){this.factory=l,this.resolving=!1,this.canSeeViewProviders=d,this.injectImpl=g}}function ae(n){return n!==M}function ce(n){return 32767&n}function oe(n,l){let d=function X(n){return n>>16}(n),g=l;for(;d>0;)g=g[Fo],d--;return g}let fe=!0;function pe(n){const l=fe;return fe=n,l}const De=255,Me=5;let ze=0;const Oe={};function At(n,l){const d=ht(n,l);if(-1!==d)return d;const g=l[ln];g.firstCreatePass&&(n.injectorIndex=l.length,Ve(g.data,n),Ve(l,null),Ve(g.blueprint,null));const b=tt(n,l),T=n.injectorIndex;if(ae(b)){const R=ce(b),L=oe(b,l),V=L[ln].data;for(let W=0;W<8;W++)l[T+W]=L[R+W]|V[R+W]}return l[T+8]=b,T}function Ve(n,l){n.push(0,0,0,0,0,0,0,0,l)}function ht(n,l){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===l[n.injectorIndex+8]?-1:n.injectorIndex}function tt(n,l){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let d=0,g=null,b=l;for(;null!==b;){if(g=zn(b),null===g)return M;if(d++,b=b[Fo],-1!==g.injectorIndex)return g.injectorIndex|d<<16}return M}function _t(n,l,d){!function Xe(n,l,d){let g;"string"==typeof d?g=d.charCodeAt(0)||0:d.hasOwnProperty(Po)&&(g=d[Po]),null==g&&(g=d[Po]=ze++);const b=g&De;l.data[n+(b>>Me)]|=1<<b}(n,l,d)}function ct(n,l,d){if(d&Un.Optional||void 0!==n)return n;mi()}function Lt(n,l,d,g){if(d&Un.Optional&&void 0===g&&(g=null),!(d&(Un.Self|Un.Host))){const b=n[Zs],T=zr(void 0);try{return b?b.get(l,g,d&Un.Optional):Io(l,g,d&Un.Optional)}finally{zr(T)}}return ct(g,0,d)}function ft(n,l,d,g=Un.Default,b){if(null!==n){if(2048&l[Tn]&&!(g&Un.Self)){const R=function $r(n,l,d,g,b){let T=n,R=l;for(;null!==T&&null!==R&&2048&R[Tn]&&!(512&R[Tn]);){const L=Ct(T,R,d,g|Un.Self,Oe);if(L!==Oe)return L;let V=T.parent;if(!V){const W=R[kh];if(W){const ne=W.get(d,Oe,g);if(ne!==Oe)return ne}V=zn(R),R=R[Fo]}T=V}return b}(n,l,d,g,Oe);if(R!==Oe)return R}const T=Ct(n,l,d,g,Oe);if(T!==Oe)return T}return Lt(l,d,g,b)}function Ct(n,l,d,g,b){const T=function bn(n){if("string"==typeof n)return n.charCodeAt(0)||0;const l=n.hasOwnProperty(Po)?n[Po]:void 0;return"number"==typeof l?l>=0?l&De:Gi:l}(d);if("function"==typeof T){if(!Wm(l,n,g))return g&Un.Host?ct(b,0,g):Lt(l,d,g,b);try{let R;if(R=T(g),null!=R||g&Un.Optional)return R;mi()}finally{dn()}}else if("number"==typeof T){let R=null,L=ht(n,l),V=M,W=g&Un.Host?l[_r][Mr]:null;for((-1===L||g&Un.SkipSelf)&&(V=-1===L?tt(n,l):l[L+8],V!==M&&Mn(g,!1)?(R=l[ln],L=ce(V),l=oe(V,l)):L=-1);-1!==L;){const ne=l[ln];if(Kn(T,L,ne.data)){const me=vn(L,l,d,R,g,W);if(me!==Oe)return me}V=l[L+8],V!==M&&Mn(g,l[ln].data[L+8]===W)&&Kn(T,L,l)?(R=ne,L=ce(V),l=oe(V,l)):L=-1}}return b}function vn(n,l,d,g,b,T){const R=l[ln],L=R.data[n+8],ne=Rn(L,R,d,null==g?pl(L)&&fe:g!=R&&0!=(3&L.type),b&Un.Host&&T===L);return null!==ne?sn(l,R,ne,L):Oe}function Rn(n,l,d,g,b){const T=n.providerIndexes,R=l.data,L=1048575&T,V=n.directiveStart,ne=T>>20,Fe=b?L+ne:n.directiveEnd;for(let Ze=g?L:L+ne;Ze<Fe;Ze++){const Dt=R[Ze];if(Ze<V&&d===Dt||Ze>=V&&Dt.type===d)return Ze}if(b){const Ze=R[V];if(Ze&&Ss(Ze)&&Ze.type===d)return V}return null}function sn(n,l,d,g){let b=n[d];const T=l.data;if(function k(n){return n instanceof O}(b)){const R=b;R.resolving&&function kt(n,l){const d=l?`. Dependency path: ${l.join(" > ")} > ${n}`:"";throw new nt(-200,`Circular dependency in DI detected for ${n}${d}`)}(function jt(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Ft(n)}(T[d]));const L=pe(R.canSeeViewProviders);R.resolving=!0;const W=R.injectImpl?zr(R.injectImpl):null;Wm(n,g,Un.Default);try{b=n[d]=R.factory(void 0,T,n,g),l.firstCreatePass&&d>=g.directiveStart&&function Fn(n,l,d){const{ngOnChanges:g,ngOnInit:b,ngDoCheck:T}=l.type.prototype;if(g){const R=sp(l);(d.preOrderHooks??=[]).push(n,R),(d.preOrderCheckHooks??=[]).push(n,R)}b&&(d.preOrderHooks??=[]).push(0-n,b),T&&((d.preOrderHooks??=[]).push(n,T),(d.preOrderCheckHooks??=[]).push(n,T))}(d,T[d],l)}finally{null!==W&&zr(W),pe(L),R.resolving=!1,dn()}}return b}function Kn(n,l,d){return!!(d[l+(n>>Me)]&1<<n)}function Mn(n,l){return!(n&Un.Self||n&Un.Host&&l)}class ii{constructor(l,d){this._tNode=l,this._lView=d}get(l,d,g){return ft(this._tNode,this._lView,l,Xi(g),d)}}function Gi(){return new ii(Zr(),Nt())}function ki(n){return Es(()=>{const l=n.prototype.constructor,d=l[Zo]||Sr(l),g=Object.prototype;let b=Object.getPrototypeOf(n.prototype).constructor;for(;b&&b!==g;){const T=b[Zo]||Sr(b);if(T&&T!==d)return T;b=Object.getPrototypeOf(b)}return T=>new T})}function Sr(n){return En(n)?()=>{const l=Sr(Pt(n));return l&&l()}:Na(n)}function zn(n){const l=n[ln],d=l.type;return 2===d?l.declTNode:1===d?n[Mr]:null}function Co(n){return function He(n,l){if("class"===l)return n.classes;if("style"===l)return n.styles;const d=n.attrs;if(d){const g=d.length;let b=0;for(;b<g;){const T=d[b];if(Ds(T))break;if(0===T)b+=2;else if("number"==typeof T)for(b++;b<g&&"string"==typeof d[b];)b++;else{if(T===l)return d[b+1];b+=2}}}return null}(Zr(),n)}const gi="__parameters__";function Pi(n,l,d){return Es(()=>{const g=function lr(n){return function(...d){if(n){const g=n(...d);for(const b in g)this[b]=g[b]}}}(l);function b(...T){if(this instanceof b)return g.apply(this,T),this;const R=new b(...T);return L.annotation=R,L;function L(V,W,ne){const me=V.hasOwnProperty(gi)?V[gi]:Object.defineProperty(V,gi,{value:[]})[gi];for(;me.length<=ne;)me.push(null);return(me[ne]=me[ne]||[]).push(R),V}}return d&&(b.prototype=Object.create(d.prototype)),b.prototype.ngMetadataName=n,b.annotationCls=b,b})}function kc(n,l){n.forEach(d=>Array.isArray(d)?kc(d,l):l(d))}function Yl(n,l,d){l>=n.length?n.push(d):n.splice(l,0,d)}function Rs(n,l){return l>=n.length-1?n.pop():n.splice(l,1)[0]}function Js(n,l,d){let g=Qs(n,l);return g>=0?n[1|g]=d:(g=~g,function O_(n,l,d,g){let b=n.length;if(b==l)n.push(d,g);else if(1===b)n.push(g,n[0]),n[0]=d;else{for(b--,n.push(n[b-1],n[b]);b>l;)n[b]=n[b-2],b--;n[l]=d,n[l+1]=g}}(n,g,l,d)),g}function Iu(n,l){const d=Qs(n,l);if(d>=0)return n[1|d]}function Qs(n,l){return function $a(n,l,d){let g=0,b=n.length>>d;for(;b!==g;){const T=g+(b-g>>1),R=n[T<<d];if(l===R)return T<<d;R>l?b=T:g=T+1}return~(b<<d)}(n,l,1)}const Km=pr(Pi("Inject",n=>({token:n})),-1),Xh=pr(Pi("Optional"),8),Kh=pr(Pi("SkipSelf"),4);function wp(n){return 128==(128&n.flags)}var jc=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(jc||{});const bl=new Map;let Dp=0;const fs="__ngContext__";function Do(n,l){Or(l)?(n[fs]=l[Fa],function ng(n){bl.set(n[Fa],n)}(l)):n[fs]=l}let Ql;function Hc(n,l){return Ql(n,l)}function ec(n){const l=n[sr];return kr(l)?l[sr]:l}function ig(n){return Hd(n[Vl])}function j_(n){return Hd(n[ko])}function Hd(n){for(;null!==n&&!kr(n);)n=n[ko];return n}function ku(n,l,d,g,b){if(null!=g){let T,R=!1;kr(g)?T=g:Or(g)&&(R=!0,g=g[hr]);const L=Hi(g);0===n&&null!==d?null==b?Nu(l,d,L):ea(l,d,L,b||null,!0):1===n&&null!==d?ea(l,d,L,b||null,!0):2===n?function Wd(n,l,d){const g=rf(n,l);g&&function Uv(n,l,d,g){n.removeChild(l,d,g)}(n,g,l,d)}(l,L,R):3===n&&l.destroyNode(L),null!=T&&function cg(n,l,d,g,b){const T=d[Bo];T!==Hi(d)&&ku(l,n,g,T,b);for(let L=Vr;L<d.length;L++){const V=d[L];Zd(V[ln],V,n,l,g,T)}}(l,n,T,d,b)}}function Gd(n,l,d){return n.createElement(l,d)}function va(n,l){const d=n[Ul],g=d.indexOf(l);Eu(l),d.splice(g,1)}function $o(n,l){if(n.length<=Vr)return;const d=Vr+l,g=n[d];if(g){const b=g[Ts];null!==b&&b!==n&&va(b,g),l>0&&(n[d-1][ko]=g[ko]);const T=Rs(n,Vr+l);!function ps(n,l){Zd(n,l,l[Bn],2,null,null),l[hr]=null,l[Mr]=null}(g[ln],g);const R=T[No];null!==R&&R.detachView(T[ln]),g[sr]=null,g[ko]=null,g[Tn]&=-129}return g}function ms(n,l){if(!(256&l[Tn])){const d=l[Bn];l[du]?.destroy(),l[Ys]?.destroy(),d.destroyNode&&Zd(n,l,d,3,null,null),function Yi(n){let l=n[Vl];if(!l)return io(n[ln],n);for(;l;){let d=null;if(Or(l))d=l[Vl];else{const g=l[Vr];g&&(d=g)}if(!d){for(;l&&!l[ko]&&l!==n;)Or(l)&&io(l[ln],l),l=l[sr];null===l&&(l=n),Or(l)&&io(l[ln],l),d=l&&l[ko]}l=d}}(l)}}function io(n,l){if(!(256&l[Tn])){l[Tn]&=-129,l[Tn]|=256,function Hr(n,l){let d;if(null!=n&&null!=(d=n.destroyHooks))for(let g=0;g<d.length;g+=2){const b=l[d[g]];if(!(b instanceof O)){const T=d[g+1];if(Array.isArray(T))for(let R=0;R<T.length;R+=2){const L=b[T[R]],V=T[R+1];bo(4,L,V);try{V.call(L)}finally{bo(5,L,V)}}else{bo(4,b,T);try{T.call(b)}finally{bo(5,b,T)}}}}}(n,l),function Lu(n,l){const d=n.cleanup,g=l[dl];if(null!==d)for(let T=0;T<d.length-1;T+=2)if("string"==typeof d[T]){const R=d[T+3];R>=0?g[R]():g[-R].unsubscribe(),T+=2}else d[T].call(g[d[T+1]]);null!==g&&(l[dl]=null);const b=l[ca];if(null!==b){l[ca]=null;for(let T=0;T<b.length;T++)(0,b[T])()}}(n,l),1===l[ln].type&&l[Bn].destroy();const d=l[Ts];if(null!==d&&kr(l[sr])){d!==l[sr]&&va(d,l);const g=l[No];null!==g&&g.detachView(n)}!function Ka(n){bl.delete(n[Fa])}(l)}}function Sp(n,l,d){return function Fu(n,l,d){let g=l;for(;null!==g&&40&g.type;)g=(l=g).parent;if(null===g)return d[hr];{const{componentOffset:b}=g;if(b>-1){const{encapsulation:T}=n.data[g.directiveStart+b];if(T===Cs.None||T===Cs.Emulated)return null}return Ur(g,d)}}(n,l.parent,d)}function ea(n,l,d,g,b){n.insertBefore(l,d,g,b)}function Nu(n,l,d){n.appendChild(l,d)}function Ip(n,l,d,g,b){null!==g?ea(n,l,d,g,b):Nu(n,l,d)}function rf(n,l){return n.parentNode(l)}let zu,Ap,cf,sf=function Bu(n,l,d){return 40&n.type?Ur(n,d):null};function Cl(n,l,d,g){const b=Sp(n,g,l),T=l[Bn],L=function El(n,l,d){return sf(n,l,d)}(g.parent||l[Mr],g,l);if(null!=b)if(Array.isArray(d))for(let V=0;V<d.length;V++)Ip(T,b,d[V],L,!1);else Ip(T,b,d,L,!1);void 0!==zu&&zu(T,g,l,d,b)}function af(n,l){if(null!==l){const d=l.type;if(3&d)return Ur(l,n);if(4&d)return lg(-1,n[l.index]);if(8&d){const g=l.child;if(null!==g)return af(n,g);{const b=n[l.index];return kr(b)?lg(-1,b):Hi(b)}}if(32&d)return Hc(l,n)()||Hi(n[l.index]);{const g=ag(n,l);return null!==g?Array.isArray(g)?g[0]:af(ec(n[_r]),g):af(n,l.next)}}return null}function ag(n,l){return null!==l?n[_r][Mr].projection[l.projection]:null}function lg(n,l){const d=Vr+n+1;if(d<l.length){const g=l[d],b=g[ln].firstChild;if(null!==b)return af(g,b)}return l[Bo]}function lf(n,l,d,g,b,T,R){for(;null!=d;){const L=g[d.index],V=d.type;if(R&&0===l&&(L&&Do(Hi(L),g),d.flags|=2),32!=(32&d.flags))if(8&V)lf(n,l,d.child,g,b,T,!1),ku(l,n,b,L,T);else if(32&V){const W=Hc(d,g);let ne;for(;ne=W();)ku(l,n,b,ne,T);ku(l,n,b,L,T)}else 16&V?Gc(n,l,g,d,b,T):ku(l,n,b,L,T);d=R?d.projectionNext:d.next}}function Zd(n,l,d,g,b,T){lf(d,g,n.firstChild,l,b,T,!1)}function Gc(n,l,d,g,b,T){const R=d[_r],V=R[Mr].projection[g.projection];if(Array.isArray(V))for(let W=0;W<V.length;W++)ku(l,n,b,V[W],T);else{let W=V;const ne=R[sr];wp(g)&&(W.flags|=128),lf(n,l,W,ne,b,T,!0)}}function qd(n,l,d){""===d?n.removeAttribute(l,"class"):n.setAttribute(l,"class",d)}function Wc(n,l,d){const{mergedAttrs:g,classes:b,styles:T}=d;null!==g&&lt(n,l,g),null!==b&&qd(n,l,b),null!==T&&function tc(n,l,d){n.setAttribute(l,"style",d)}(n,l,T)}function q_(n){Ap=n}function Y_(n){return function uf(){if(void 0===cf&&(cf=null,Ui.trustedTypes))try{cf=Ui.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return cf}()?.createScriptURL(n)||n}class Pp{constructor(l){this.changingThisBreaksApplicationSecurity=l}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${pn})`}}function Dl(n){return n instanceof Pp?n.changingThisBreaksApplicationSecurity:n}function ba(n,l){const d=function df(n){return n instanceof Pp&&n.getTypeName()||null}(n);if(null!=d&&d!==l){if("ResourceURL"===d&&"URL"===l)return!0;throw new Error(`Required a safe ${l}, got a ${d} (see ${pn})`)}return d===l}const Kd=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Hu=function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n}(Hu||{});function yg(n){const l=_f();return l?l.sanitize(Hu.URL,n)||"":ba(n,"URL")?Dl(n):function Op(n){return(n=String(n)).match(Kd)?n:"unsafe:"+n}(Ft(n))}function Np(n){const l=_f();if(l)return Y_(l.sanitize(Hu.RESOURCE_URL,n)||"");if(ba(n,"ResourceURL"))return Y_(Dl(n));throw new nt(904,!1)}function Q_(n,l,d){return function ks(n,l){return"src"===l&&("embed"===n||"frame"===n||"iframe"===n||"media"===n||"script"===n)||"href"===l&&("base"===n||"link"===n)?Np:yg}(l,d)(n)}function _f(){const n=Nt();return n&&n[qs].sanitizer}class Fi{constructor(l,d){this._desc=l,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof d?this.__NG_ELEMENT_ID__=d:void 0!==d&&(this.\u0275prov=An({token:this,providedIn:d.providedIn||"root",factory:d.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const th=new Fi("ENVIRONMENT_INITIALIZER"),Bp=new Fi("INJECTOR",-1),ey=new Fi("INJECTOR_DEF_TYPES");class yf{get(l,d=je){if(d===je){const g=new Error(`NullInjectorError: No provider for ${Qe(l)}!`);throw g.name="NullInjectorError",g}return d}}function vf(n){return{\u0275providers:n}}function bf(...n){return{\u0275providers:ty(0,n),\u0275fromNgModule:!0}}function ty(n,...l){const d=[],g=new Set;let b;const T=R=>{d.push(R)};return kc(l,R=>{const L=R;Gu(L,T,[],g)&&(b||=[],b.push(L))}),void 0!==b&&Kv(b,T),d}function Kv(n,l){for(let d=0;d<n.length;d++){const{ngModule:g,providers:b}=n[d];zp(b,T=>{l(T,g)})}}function Gu(n,l,d,g){if(!(n=Pt(n)))return!1;let b=null,T=ws(n);const R=!T&&Cn(n);if(T||R){if(R&&!R.standalone)return!1;b=n}else{const V=n.ngModule;if(T=ws(V),!T)return!1;b=V}const L=g.has(b);if(R){if(L)return!1;if(g.add(b),R.dependencies){const V="function"==typeof R.dependencies?R.dependencies():R.dependencies;for(const W of V)Gu(W,l,d,g)}}else{if(!T)return!1;{if(null!=T.imports&&!L){let W;g.add(b);try{kc(T.imports,ne=>{Gu(ne,l,d,g)&&(W||=[],W.push(ne))})}finally{}void 0!==W&&Kv(W,l)}if(!L){const W=Na(b)||(()=>new b);l({provide:b,useFactory:W,deps:xi},b),l({provide:ey,useValue:b,multi:!0},b),l({provide:th,useValue:()=>Jn(b),multi:!0},b)}const V=T.providers;if(null!=V&&!L){const W=n;zp(V,ne=>{l(ne,W)})}}}return b!==n&&void 0!==n.providers}function zp(n,l){for(let d of n)cn(d)&&(d=d.\u0275providers),Array.isArray(d)?zp(d,l):l(d)}const Vp=ke({provide:String,useValue:ke});function xf(n){return null!==n&&"object"==typeof n&&Vp in n}function Tl(n){return"function"==typeof n}const Up=new Fi("Set Injector scope."),wf={},ry={};let wg;function Ef(){return void 0===wg&&(wg=new yf),wg}class Ja{}class nh extends Ja{get destroyed(){return this._destroyed}constructor(l,d,g,b){super(),this.parent=d,this.source=g,this.scopes=b,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Cg(l,R=>this.processProvider(R)),this.records.set(Bp,ic(void 0,this)),b.has("environment")&&this.records.set(Ja,ic(void 0,this));const T=this.records.get(Up);null!=T&&"string"==typeof T.value&&this.scopes.add(T.value),this.injectorDefTypes=new Set(this.get(ey.multi,xi,Un.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const d of this._ngOnDestroyHooks)d.ngOnDestroy();const l=this._onDestroyHooks;this._onDestroyHooks=[];for(const d of l)d()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(l){return this.assertNotDestroyed(),this._onDestroyHooks.push(l),()=>this.removeOnDestroy(l)}runInContext(l){this.assertNotDestroyed();const d=jn(this),g=zr(void 0);try{return l()}finally{jn(d),zr(g)}}get(l,d=je,g=Un.Default){if(this.assertNotDestroyed(),l.hasOwnProperty(qo))return l[qo](this);g=Xi(g);const T=jn(this),R=zr(void 0);try{if(!(g&Un.SkipSelf)){let V=this.records.get(l);if(void 0===V){const W=function oy(n){return"function"==typeof n||"object"==typeof n&&n instanceof Fi}(l)&&Xr(l);V=W&&this.injectableDefInScope(W)?ic(Eg(l),wf):null,this.records.set(l,V)}if(null!=V)return this.hydrate(l,V)}return(g&Un.Self?Ef():this.parent).get(l,d=g&Un.Optional&&d===je?null:d)}catch(L){if("NullInjectorError"===L.name){if((L[et]=L[et]||[]).unshift(Qe(l)),T)throw L;return function ll(n,l,d,g){const b=n[et];throw l[Zn]&&b.unshift(l[Zn]),n.message=function Rh(n,l,d,g=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let b=Qe(l);if(Array.isArray(l))b=l.map(Qe).join(" -> ");else if("object"==typeof l){let T=[];for(let R in l)if(l.hasOwnProperty(R)){let L=l[R];T.push(R+":"+("string"==typeof L?JSON.stringify(L):Qe(L)))}b=`{${T.join(", ")}}`}return`${d}${g?"("+g+")":""}[${b}]: ${n.replace(Zt,"\n  ")}`}("\n"+n.message,b,d,g),n.ngTokenPath=b,n[et]=null,n}(L,l,"R3InjectorError",this.source)}throw L}finally{zr(R),jn(T)}}resolveInjectorInitializers(){const l=jn(this),d=zr(void 0);try{const b=this.get(th.multi,xi,Un.Self);for(const T of b)T()}finally{jn(l),zr(d)}}toString(){const l=[],d=this.records;for(const g of d.keys())l.push(Qe(g));return`R3Injector[${l.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new nt(205,!1)}processProvider(l){let d=Tl(l=Pt(l))?l:Pt(l&&l.provide);const g=function jp(n){return xf(n)?ic(void 0,n.useValue):ic(ih(n),wf)}(l);if(Tl(l)||!0!==l.multi)this.records.get(d);else{let b=this.records.get(d);b||(b=ic(void 0,wf,!0),b.factory=()=>Ao(b.multi),this.records.set(d,b)),d=l,b.multi.push(l)}this.records.set(d,g)}hydrate(l,d){return d.value===wf&&(d.value=ry,d.value=d.factory()),"object"==typeof d.value&&d.value&&function $p(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(d.value)&&this._ngOnDestroyHooks.add(d.value),d.value}injectableDefInScope(l){if(!l.providedIn)return!1;const d=Pt(l.providedIn);return"string"==typeof d?"any"===d||this.scopes.has(d):this.injectorDefTypes.has(d)}removeOnDestroy(l){const d=this._onDestroyHooks.indexOf(l);-1!==d&&this._onDestroyHooks.splice(d,1)}}function Eg(n){const l=Xr(n),d=null!==l?l.factory:Na(n);if(null!==d)return d;if(n instanceof Fi)throw new nt(204,!1);if(n instanceof Function)return function _s(n){const l=n.length;if(l>0)throw function Lc(n,l){const d=[];for(let g=0;g<n;g++)d.push(l);return d}(l,"?"),new nt(204,!1);const d=function Wo(n){return n&&(n[aa]||n[So])||null}(n);return null!==d?()=>d.factory(n):()=>new n}(n);throw new nt(204,!1)}function ih(n,l,d){let g;if(Tl(n)){const b=Pt(n);return Na(b)||Eg(b)}if(xf(n))g=()=>Pt(n.useValue);else if(function xg(n){return!(!n||!n.useFactory)}(n))g=()=>n.useFactory(...Ao(n.deps||[]));else if(function ny(n){return!(!n||!n.useExisting)}(n))g=()=>Jn(Pt(n.useExisting));else{const b=Pt(n&&(n.useClass||n.provide));if(!function on(n){return!!n.deps}(n))return Na(b)||Eg(b);g=()=>new b(...Ao(n.deps))}return g}function ic(n,l,d=!1){return{factory:n,value:l,multi:d?[]:void 0}}function Cg(n,l){for(const d of n)Array.isArray(d)?Cg(d,l):d&&cn(d)?Cg(d.\u0275providers,l):l(d)}const sy=new Fi("AppId",{providedIn:"root",factory:()=>Mb}),Mb="ng",Cf=new Fi("Platform Initializer"),Hp=new Fi("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Gp=new Fi("AnimationModuleType"),na=new Fi("CSP nonce",{providedIn:"root",factory:()=>function Uu(){if(void 0!==Ap)return Ap;if(typeof document<"u")return document;throw new nt(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let qp=(n,l,d)=>null;function Xp(n,l,d=!1){return qp(n,l,d)}class cy{}class uy{}class r0{resolveComponentFactory(l){throw function dy(n){const l=Error(`No component factory found for ${Qe(n)}.`);return l.ngComponent=n,l}(l)}}let Yu=(()=>{class l{}return l.NULL=new r0,l})();function hy(){return Tf(Zr(),Nt())}function Tf(n,l){return new Mf(Ur(n,l))}let Mf=(()=>{class l{constructor(g){this.nativeElement=g}}return l.__NG_ELEMENT_ID__=hy,l})();function o0(n){return n instanceof Mf?n.nativeElement:n}class nm{}let Ig=(()=>{class l{constructor(){this.destroyNode=null}}return l.__NG_ELEMENT_ID__=()=>function Fs(){const n=Nt(),d=wo(Zr().index,n);return(Or(d)?d:n)[Bn]}(),l})(),Ag=(()=>{var n;class l{}return(n=l).\u0275prov=An({token:n,providedIn:"root",factory:()=>null}),l})();class Pg{constructor(l){this.full=l,this.major=l.split(".")[0],this.minor=l.split(".")[1],this.patch=l.split(".").slice(2).join(".")}}const Ns=new Pg("16.2.3"),sh={};function Il(n){if(!ri()&&!function Yn(){return Nn}())throw new nt(-203,!1)}function gy(n,l=null,d=null,g){const b=Og(n,l,d,g);return b.resolveInjectorInitializers(),b}function Og(n,l=null,d=null,g,b=new Set){const T=[d||xi,bf(n)];return g=g||("object"==typeof n?void 0:Qe(n)),new nh(T,l||Ef(),g||null,b)}let xa=(()=>{var n;class l{static create(g,b){if(Array.isArray(g))return gy({name:""},b,g,"");{const T=g.name??"";return gy({name:T},g.parent,g.providers,T)}}}return(n=l).THROW_IF_NOT_FOUND=je,n.NULL=new yf,n.\u0275prov=An({token:n,providedIn:"any",factory:()=>Jn(Bp)}),n.__NG_ELEMENT_ID__=-1,l})(),wa=(()=>{var n;class l{}return(n=l).__NG_ELEMENT_ID__=l0,n.__NG_ENV_ID__=d=>d,l})();class a0 extends wa{constructor(l){super(),this._lView=l}onDestroy(l){return tn(this._lView,l),()=>function cs(n,l){if(null===n[ca])return;const d=n[ca].indexOf(l);-1!==d&&n[ca].splice(d,1)}(this._lView,l)}}function l0(){return new a0(Nt())}function kg(n){return l=>{setTimeout(n,void 0,l)}}const ac=class c0 extends E.x{constructor(l=!1){super(),this.__isAsync=l}emit(l){super.next(l)}subscribe(l,d,g){let b=l,T=d||(()=>null),R=g;if(l&&"object"==typeof l){const V=l;b=V.next?.bind(V),T=V.error?.bind(V),R=V.complete?.bind(V)}this.__isAsync&&(T=kg(T),b&&(b=kg(b)),R&&(R=kg(R)));const L=super.subscribe({next:b,error:T,complete:R});return l instanceof Be.w0&&l.add(L),L}};function Lg(...n){}class Gr{constructor({enableLongStackTrace:l=!1,shouldCoalesceEventChangeDetection:d=!1,shouldCoalesceRunChangeDetection:g=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ac(!1),this.onMicrotaskEmpty=new ac(!1),this.onStable=new ac(!1),this.onError=new ac(!1),typeof Zone>"u")throw new nt(908,!1);Zone.assertZonePatched();const b=this;b._nesting=0,b._outer=b._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(b._inner=b._inner.fork(new Zone.TaskTrackingZoneSpec)),l&&Zone.longStackTraceZoneSpec&&(b._inner=b._inner.fork(Zone.longStackTraceZoneSpec)),b.shouldCoalesceEventChangeDetection=!g&&d,b.shouldCoalesceRunChangeDetection=g,b.lastRequestAnimationFrameId=-1,b.nativeRequestAnimationFrame=function u0(){const n="function"==typeof Ui.requestAnimationFrame;let l=Ui[n?"requestAnimationFrame":"setTimeout"],d=Ui[n?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&l&&d){const g=l[Zone.__symbol__("OriginalDelegate")];g&&(l=g);const b=d[Zone.__symbol__("OriginalDelegate")];b&&(d=b)}return{nativeRequestAnimationFrame:l,nativeCancelAnimationFrame:d}}().nativeRequestAnimationFrame,function Fg(n){const l=()=>{!function Qa(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Ui,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,Xu(n),n.isCheckStableRunning=!0,sm(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),Xu(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(d,g,b,T,R,L)=>{try{return Kc(n),d.invokeTask(b,T,R,L)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===T.type||n.shouldCoalesceRunChangeDetection)&&l(),Ng(n)}},onInvoke:(d,g,b,T,R,L,V)=>{try{return Kc(n),d.invoke(b,T,R,L,V)}finally{n.shouldCoalesceRunChangeDetection&&l(),Ng(n)}},onHasTask:(d,g,b,T)=>{d.hasTask(b,T),g===b&&("microTask"==T.change?(n._hasPendingMicrotasks=T.microTask,Xu(n),sm(n)):"macroTask"==T.change&&(n.hasPendingMacrotasks=T.macroTask))},onHandleError:(d,g,b,T)=>(d.handleError(b,T),n.runOutsideAngular(()=>n.onError.emit(T)),!1)})}(b)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Gr.isInAngularZone())throw new nt(909,!1)}static assertNotInAngularZone(){if(Gr.isInAngularZone())throw new nt(909,!1)}run(l,d,g){return this._inner.run(l,d,g)}runTask(l,d,g,b){const T=this._inner,R=T.scheduleEventTask("NgZoneEvent: "+b,l,_y,Lg,Lg);try{return T.runTask(R,d,g)}finally{T.cancelTask(R)}}runGuarded(l,d,g){return this._inner.runGuarded(l,d,g)}runOutsideAngular(l){return this._outer.run(l)}}const _y={};function sm(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function Xu(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function Kc(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function Ng(n){n._nesting--,sm(n)}class am{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ac,this.onMicrotaskEmpty=new ac,this.onStable=new ac,this.onError=new ac}run(l,d,g){return l.apply(d,g)}runGuarded(l,d,g){return l.apply(d,g)}runOutsideAngular(l){return l()}runTask(l,d,g,b){return l.apply(d,g)}}const Bg=new Fi("",{providedIn:"root",factory:If});function If(){const n=si(Gr);let l=!0;const d=new it.y(b=>{l=n.isStable&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks,n.runOutsideAngular(()=>{b.next(l),b.complete()})}),g=new it.y(b=>{let T;n.runOutsideAngular(()=>{T=n.onStable.subscribe(()=>{Gr.assertNotInAngularZone(),queueMicrotask(()=>{!l&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks&&(l=!0,b.next(!0))})})});const R=n.onUnstable.subscribe(()=>{Gr.assertInAngularZone(),l&&(l=!1,n.runOutsideAngular(()=>{b.next(!1)}))});return()=>{T.unsubscribe(),R.unsubscribe()}});return(0,p.T)(d,g.pipe((0,Ge.B)()))}function ah(n){return n.ownerDocument.defaultView}function Al(n){return n instanceof Function?n():n}let Vg=(()=>{var n;class l{constructor(){this.callbacks=new Set,this.deferredCallbacks=new Set,this.renderDepth=0,this.runningCallbacks=!1}begin(){if(this.runningCallbacks)throw new nt(102,!1);this.renderDepth++}end(){if(this.renderDepth--,0===this.renderDepth)try{this.runningCallbacks=!0;for(const g of this.callbacks)g.invoke()}finally{this.runningCallbacks=!1;for(const g of this.deferredCallbacks)this.callbacks.add(g);this.deferredCallbacks.clear()}}register(g){(this.runningCallbacks?this.deferredCallbacks:this.callbacks).add(g)}unregister(g){this.callbacks.delete(g),this.deferredCallbacks.delete(g)}ngOnDestroy(){this.callbacks.clear(),this.deferredCallbacks.clear()}}return(n=l).\u0275prov=An({token:n,providedIn:"root",factory:()=>new n}),l})();function uh(n){for(;n;){n[Tn]|=64;const l=ec(n);if(pu(n)&&!l)return n;n=l}return null}function Pl(n){return n.ngOriginalError}class el{constructor(){this._console=console}handleError(l){const d=this._findOriginalError(l);this._console.error("ERROR",l),d&&this._console.error("ORIGINAL ERROR",d)}_findOriginalError(l){let d=l&&Pl(l);for(;d&&Pl(d);)d=Pl(d);return d||null}}const Ug=new Fi("",{providedIn:"root",factory:()=>!1});class dh extends vd{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(l){this._lView=l}onConsumerDependencyMayHaveChanged(){uh(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(l,d,g){const b=Lr(this);this.trackingVersion++;try{l(d,g)}finally{Lr(b)}}destroy(){this.trackingVersion++}}let Of=null;function xy(){return Of??=new dh,Of}function Jc(n,l){return n[l]??xy()}function hh(n,l){const d=xy();d.hasReadASignal&&(n[l]=Of,d.lView=n,Of=new dh)}const li={};function cm(n){kf(yi(),Nt(),jr()+n,!1)}function kf(n,l,d,g){if(!g)if(3==(3&l[Tn])){const T=n.preOrderCheckHooks;null!==T&&Va(l,T,d)}else{const T=n.preOrderHooks;null!==T&&_(l,T,0,d)}Xt(d)}function Qu(n,l=Un.Default){const d=Nt();return null===d?Jn(n,l):ft(Zr(),d,Pt(n),l)}function um(){throw new Error("invalid")}function ed(n,l,d,g,b,T,R,L,V,W,ne){const me=l.blueprint.slice();return me[hr]=b,me[Tn]=140|g,(null!==W||n&&2048&n[Tn])&&(me[Tn]|=2048),Sc(me),me[sr]=me[Fo]=n,me[gr]=d,me[qs]=R||n&&n[qs],me[Bn]=L||n&&n[Bn],me[Zs]=V||n&&n[Zs]||null,me[Mr]=T,me[Fa]=function jo(){return Dp++}(),me[Ms]=ne,me[kh]=W,me[_r]=2==l.type?n[_r]:me,me}function dc(n,l,d,g,b){let T=n.data[l];if(null===T)T=function Lf(n,l,d,g,b){const T=Pc(),R=Rc(),V=n.data[l]=function Ib(n,l,d,g,b,T){let R=l?l.injectorIndex:-1,L=0;return function ha(){return null!==Xn.skipHydrationRootTNode}()&&(L|=128),{type:d,index:g,insertBeforeIndex:null,injectorIndex:R,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:L,providerIndexes:0,value:b,attrs:T,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:l,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,R?T:T&&T.parent,d,l,g,b);return null===n.firstChild&&(n.firstChild=V),null!==T&&(R?null==T.child&&null!==V.parent&&(T.child=V):null===T.next&&(T.next=V,V.prev=T)),V}(n,l,d,g,b),function cp(){return Xn.lFrame.inI18n}()&&(T.flags|=32);else if(64&T.type){T.type=d,T.value=g,T.attrs=b;const R=function Ba(){const n=Xn.lFrame,l=n.currentTNode;return n.isParent?l:l.parent}();T.injectorIndex=null===R?-1:R.injectorIndex}return Ko(T,!0),T}function fh(n,l,d,g){if(0===d)return-1;const b=l.length;for(let T=0;T<d;T++)l.push(g),n.blueprint.push(g),n.data.push(null);return b}function $g(n,l,d,g,b){const T=Jc(l,du),R=jr(),L=2&g;try{if(Xt(-1),L&&l.length>yn&&kf(n,l,yn,!1),bo(L?2:0,b),L)T.runInContext(d,g,b);else{const W=Lr(null);try{d(g,b)}finally{Lr(W)}}}finally{L&&null===l[du]&&hh(l,du),Xt(R),bo(L?3:1,b)}}function ro(n,l,d){if(yc(l)){const g=Lr(null);try{const T=l.directiveEnd;for(let R=l.directiveStart;R<T;R++){const L=n.data[R];L.contentQueries&&L.contentQueries(1,d[R],R)}}finally{Lr(g)}}}function ia(n,l,d){Td()&&(function il(n,l,d,g){const b=d.directiveStart,T=d.directiveEnd;pl(d)&&function Gg(n,l,d){const g=Ur(l,n),b=f0(d);let R=16;d.signals?R=4096:d.onPush&&(R=64);const L=fc(n,ed(n,b,null,R,g,l,null,n[qs].rendererFactory.createRenderer(g,d),null,null,null));n[l.index]=L}(l,d,n.data[b+d.componentOffset]),n.firstCreatePass||At(d,l),Do(g,l);const R=d.initialInputs;for(let L=b;L<T;L++){const V=n.data[L],W=sn(l,n,L,d);Do(W,l),null!==R&&y0(0,L-b,W,V,0,R),Ss(V)&&(wo(d.index,l)[gr]=sn(l,n,L,d))}}(n,l,d,Ur(d,l)),64==(64&d.flags)&&ns(n,l,d))}function td(n,l,d=Ur){const g=l.localNames;if(null!==g){let b=l.index+1;for(let T=0;T<g.length;T+=2){const R=g[T+1],L=-1===R?d(l,n):n[R];n[b++]=L}}}function f0(n){const l=n.tView;return null===l||l.incompleteFirstPass?n.tView=dm(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):l}function dm(n,l,d,g,b,T,R,L,V,W,ne){const me=yn+g,Fe=me+b,Ze=function ph(n,l){const d=[];for(let g=0;g<l;g++)d.push(g<n?null:li);return d}(me,Fe),Dt="function"==typeof W?W():W;return Ze[ln]={type:n,blueprint:Ze,template:d,queries:null,viewQuery:L,declTNode:l,data:Ze.slice().fill(null,me),bindingStartIndex:me,expandoStartIndex:Fe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof T?T():T,pipeRegistry:"function"==typeof R?R():R,firstChild:null,schemas:V,consts:Dt,incompleteFirstPass:!1,ssrId:ne}}let nd=n=>null;function m0(n,l,d,g){for(let b in n)if(n.hasOwnProperty(b)){d=null===d?{}:d;const T=n[b];null===g?g0(d,l,b,T):g.hasOwnProperty(b)&&g0(d,l,g[b],T)}return d}function g0(n,l,d,g){n.hasOwnProperty(d)?n[d].push(l,g):n[d]=[l,g]}function ts(n,l,d,g,b,T,R,L){const V=Ur(l,d);let ne,W=l.inputs;!L&&null!=W&&(ne=W[g])?(eu(n,d,ne,g,b),pl(l)&&function Pb(n,l){const d=wo(l,n);16&d[Tn]||(d[Tn]|=64)}(d,l.index)):3&l.type&&(g=function Ab(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(g),b=null!=R?R(b,l.value||"",g):b,T.setProperty(V,g,b))}function Ty(n,l,d,g){if(Td()){const b=null===g?null:{"":-1},T=function gh(n,l){const d=n.directiveRegistry;let g=null,b=null;if(d)for(let T=0;T<d.length;T++){const R=d[T];if(Oo(l,R.selectors,!1))if(g||(g=[]),Ss(R))if(null!==R.findHostDirectiveDefs){const L=[];b=b||new Map,R.findHostDirectiveDefs(R,L,b),g.unshift(...L,R),hm(n,l,L.length)}else g.unshift(R),hm(n,l,0);else b=b||new Map,R.findHostDirectiveDefs?.(R,g,b),g.push(R)}return null===g?null:[g,b]}(n,d);let R,L;null===T?R=L=null:[R,L]=T,null!==R&&My(n,l,d,R,b,L),b&&function fm(n,l,d){if(l){const g=n.localNames=[];for(let b=0;b<l.length;b+=2){const T=d[l[b+1]];if(null==T)throw new nt(-301,!1);g.push(l[b],T)}}}(d,g,b)}d.mergedAttrs=mr(d.mergedAttrs,d.attrs)}function My(n,l,d,g,b,T){for(let W=0;W<g.length;W++)_t(At(d,l),n,g[W].type);!function _h(n,l,d){n.flags|=1,n.directiveStart=l,n.directiveEnd=l+d,n.providerIndexes=l}(d,n.data.length,g.length);for(let W=0;W<g.length;W++){const ne=g[W];ne.providersResolver&&ne.providersResolver(ne)}let R=!1,L=!1,V=fh(n,l,g.length,null);for(let W=0;W<g.length;W++){const ne=g[W];d.mergedAttrs=mr(d.mergedAttrs,ne.hostAttrs),Iy(n,d,l,V,ne),Sy(V,ne,b),null!==ne.contentQueries&&(d.flags|=4),(null!==ne.hostBindings||null!==ne.hostAttrs||0!==ne.hostVars)&&(d.flags|=64);const me=ne.type.prototype;!R&&(me.ngOnChanges||me.ngOnInit||me.ngDoCheck)&&((n.preOrderHooks??=[]).push(d.index),R=!0),!L&&(me.ngOnChanges||me.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(d.index),L=!0),V++}!function Cy(n,l,d){const b=l.directiveEnd,T=n.data,R=l.attrs,L=[];let V=null,W=null;for(let ne=l.directiveStart;ne<b;ne++){const me=T[ne],Fe=d?d.get(me):null,Dt=Fe?Fe.outputs:null;V=m0(me.inputs,ne,V,Fe?Fe.inputs:null),W=m0(me.outputs,ne,W,Dt);const qt=null===V||null===R||La(l)?null:Py(V,ne,R);L.push(qt)}null!==V&&(V.hasOwnProperty("class")&&(l.flags|=8),V.hasOwnProperty("style")&&(l.flags|=16)),l.initialInputs=L,l.inputs=V,l.outputs=W}(n,d,T)}function ns(n,l,d){const g=d.directiveStart,b=d.directiveEnd,T=d.index,R=function up(){return Xn.lFrame.currentDirectiveIndex}();try{Xt(T);for(let L=g;L<b;L++){const V=n.data[L],W=l[L];Hh(L),(null!==V.hostBindings||0!==V.hostVars||null!==V.hostAttrs)&&Ca(V,W)}}finally{Xt(-1),Hh(R)}}function Ca(n,l){null!==n.hostBindings&&n.hostBindings(1,l)}function hm(n,l,d){l.componentOffset=d,(n.components??=[]).push(l.index)}function Sy(n,l,d){if(d){if(l.exportAs)for(let g=0;g<l.exportAs.length;g++)d[l.exportAs[g]]=n;Ss(l)&&(d[""]=n)}}function Iy(n,l,d,g,b){n.data[g]=b;const T=b.factory||(b.factory=Na(b.type)),R=new O(T,Ss(b),Qu);n.blueprint[g]=R,d[g]=R,function nl(n,l,d,g,b){const T=b.hostBindings;if(T){let R=n.hostBindingOpCodes;null===R&&(R=n.hostBindingOpCodes=[]);const L=~l.index;(function zs(n){let l=n.length;for(;l>0;){const d=n[--l];if("number"==typeof d&&d<0)return d}return 0})(R)!=L&&R.push(L),R.push(d,g,T)}}(n,l,g,fh(n,d,b.hostVars,li),b)}function Da(n,l,d,g,b,T){const R=Ur(n,l);!function hc(n,l,d,g,b,T,R){if(null==T)n.removeAttribute(l,b,d);else{const L=null==R?Ft(T):R(T,g||"",b);n.setAttribute(l,b,L,d)}}(l[Bn],R,T,n.value,d,g,b)}function y0(n,l,d,g,b,T){const R=T[l];if(null!==R)for(let L=0;L<R.length;)Ay(g,d,R[L++],R[L++],R[L++])}function Ay(n,l,d,g,b){const T=Lr(null);try{const R=n.inputTransforms;null!==R&&R.hasOwnProperty(g)&&(b=R[g].call(l,b)),null!==n.setInput?n.setInput(l,b,d,g):l[g]=b}finally{Lr(T)}}function Py(n,l,d){let g=null,b=0;for(;b<d.length;){const T=d[b];if(0!==T)if(5!==T){if("number"==typeof T)break;if(n.hasOwnProperty(T)){null===g&&(g=[]);const R=n[T];for(let L=0;L<R.length;L+=2)if(R[L]===l){g.push(T,R[L+1],d[b+1]);break}}b+=2}else b+=2;else b+=4}return g}function Ry(n,l,d,g){return[n,!0,!1,l,null,0,g,d,null,null,null]}function bs(n,l){const d=n.contentQueries;if(null!==d)for(let g=0;g<d.length;g+=2){const T=d[g+1];if(-1!==T){const R=n.data[T];Jo(d[g]),R.contentQueries(2,l[T],T)}}}function fc(n,l){return n[Vl]?n[hl][ko]=l:n[Vl]=l,n[hl]=l,l}function yh(n,l,d){Jo(0);const g=Lr(null);try{l(n,d)}finally{Lr(g)}}function Qc(n){return n[dl]||(n[dl]=[])}function Ff(n){return n.cleanup||(n.cleanup=[])}function vh(n,l){const d=n[Zs],g=d?d.get(el,null):null;g&&g.handleError(l)}function eu(n,l,d,g,b){for(let T=0;T<d.length;){const R=d[T++],L=d[T++];Ay(n.data[R],l[R],g,L,b)}}function Wg(n,l){const d=wo(l,n),g=d[ln];!function mm(n,l){for(let d=l.length;d<n.blueprint.length;d++)l.push(n.blueprint[d])}(g,d);const b=d[hr];null!==b&&null===d[Ms]&&(d[Ms]=Xp(b,d[Zs])),ra(g,d,d[gr])}function ra(n,l,d){Ps(l);try{const g=n.viewQuery;null!==g&&yh(1,g,d);const b=n.template;null!==b&&$g(n,l,b,1,d),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&bs(n,l),n.staticViewQueries&&yh(2,n.viewQuery,d);const T=n.components;null!==T&&function tu(n,l){for(let d=0;d<l.length;d++)Wg(n,l[d])}(l,T)}catch(g){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),g}finally{l[Tn]&=-5,Rd()}}let Zg=(()=>{var n;class l{constructor(){this.all=new Set,this.queue=new Map}create(g,b,T){const R=typeof Zone>"u"?null:Zone.current,L=new Vh(g,ne=>{this.all.has(ne)&&this.queue.set(ne,R)},T);let V;this.all.add(L),L.notify();const W=()=>{L.cleanup(),V?.(),this.all.delete(L),this.queue.delete(L)};return V=b?.onDestroy(W),{destroy:W}}flush(){if(0!==this.queue.size)for(const[g,b]of this.queue)this.queue.delete(g),b?b.run(()=>g.run()):g.run()}get isQueueEmpty(){return 0===this.queue.size}}return(n=l).\u0275prov=An({token:n,providedIn:"root",factory:()=>new n}),l})();function nu(n,l,d){let g=d?n.styles:null,b=d?n.classes:null,T=0;if(null!==l)for(let R=0;R<l.length;R++){const L=l[R];"number"==typeof L?T=L:1==T?b=Tt(b,L):2==T&&(g=Tt(g,L+": "+l[++R]+";"))}d?n.styles=g:n.stylesWithoutHost=g,d?n.classes=b:n.classesWithoutHost=b}function Ol(n,l,d,g,b=!1){for(;null!==d;){const T=l[d.index];null!==T&&g.push(Hi(T)),kr(T)&&Oy(T,g);const R=d.type;if(8&R)Ol(n,l,d.child,g);else if(32&R){const L=Hc(d,l);let V;for(;V=L();)g.push(V)}else if(16&R){const L=ag(l,d);if(Array.isArray(L))g.push(...L);else{const V=ec(l[_r]);Ol(V[ln],V,L,g,!0)}}d=b?d.projectionNext:d.next}return g}function Oy(n,l){for(let d=Vr;d<n.length;d++){const g=n[d],b=g[ln].firstChild;null!==b&&Ol(g[ln],g,b,l)}n[Bo]!==n[hr]&&l.push(n[Bo])}function gm(n,l,d,g=!0){const b=l[qs],T=b.rendererFactory,R=b.afterRenderEventManager;T.begin?.(),R?.begin();try{_m(n,l,n.template,d)}catch(V){throw g&&vh(l,V),V}finally{T.end?.(),b.effectManager?.flush(),R?.end()}}function _m(n,l,d,g){const b=l[Tn];if(256!=(256&b)){l[qs].effectManager?.flush(),Ps(l);try{Sc(l),function jh(n){return Xn.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==d&&$g(n,l,d,2,g);const R=3==(3&b);if(R){const W=n.preOrderCheckHooks;null!==W&&Va(l,W,null)}else{const W=n.preOrderHooks;null!==W&&_(l,W,0,null),a(l,0)}if(function b0(n){for(let l=ig(n);null!==l;l=j_(l)){if(!l[Lh])continue;const d=l[Ul];for(let g=0;g<d.length;g++){wu(d[g])}}}(l),Nf(l,2),null!==n.contentQueries&&bs(n,l),R){const W=n.contentCheckHooks;null!==W&&Va(l,W)}else{const W=n.contentHooks;null!==W&&_(l,W,1),a(l,1)}!function wy(n,l){const d=n.hostBindingOpCodes;if(null===d)return;const g=Jc(l,Ys);try{for(let b=0;b<d.length;b++){const T=d[b];if(T<0)Xt(~T);else{const R=T,L=d[++b],V=d[++b];no(L,R),g.runInContext(V,2,l[R])}}}finally{null===l[Ys]&&hh(l,Ys),Xt(-1)}}(n,l);const L=n.components;null!==L&&rd(l,L,0);const V=n.viewQuery;if(null!==V&&yh(2,V,g),R){const W=n.viewCheckHooks;null!==W&&Va(l,W)}else{const W=n.viewHooks;null!==W&&_(l,W,2),a(l,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),l[Tn]&=-73,Eu(l)}finally{Rd()}}}function Nf(n,l){for(let d=ig(n);null!==d;d=j_(d))for(let g=Vr;g<d.length;g++)qg(d[g],l)}function Fy(n,l,d){qg(wo(l,n),d)}function qg(n,l){if(!function Tc(n){return 128==(128&n[Tn])}(n))return;const d=n[ln];if(80&n[Tn]&&0===l||1024&n[Tn]||2===l)_m(d,n,d.template,n[gr]);else if(n[Lo]>0){Nf(n,1);const b=n[ln].components;null!==b&&rd(n,b,1)}}function rd(n,l,d){for(let g=0;g<l.length;g++)Fy(n,l[g],d)}class iu{get rootNodes(){const l=this._lView,d=l[ln];return Ol(d,l,d.firstChild,[])}constructor(l,d){this._lView=l,this._cdRefInjectingView=d,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[gr]}set context(l){this._lView[gr]=l}get destroyed(){return 256==(256&this._lView[Tn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const l=this._lView[sr];if(kr(l)){const d=l[8],g=d?d.indexOf(this):-1;g>-1&&($o(l,g),Rs(d,g))}this._attachedToViewContainer=!1}ms(this._lView[ln],this._lView)}onDestroy(l){tn(this._lView,l)}markForCheck(){uh(this._cdRefInjectingView||this._lView)}detach(){this._lView[Tn]&=-129}reattach(){this._lView[Tn]|=128}detectChanges(){gm(this._lView[ln],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new nt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function ya(n,l){Zd(n,l,l[Bn],2,null,null)}(this._lView[ln],this._lView)}attachToAppRef(l){if(this._attachedToViewContainer)throw new nt(902,!1);this._appRef=l}}class ym extends iu{constructor(l){super(l),this._view=l}detectChanges(){const l=this._view;gm(l[ln],l,l[gr],!1)}checkNoChanges(){}get context(){return null}}class Bf extends Yu{constructor(l){super(),this.ngModule=l}resolveComponentFactory(l){const d=Cn(l);return new od(d,this.ngModule)}}function rl(n){const l=[];for(let d in n)n.hasOwnProperty(d)&&l.push({propName:n[d],templateName:d});return l}class Yg{constructor(l,d){this.injector=l,this.parentInjector=d}get(l,d,g){g=Xi(g);const b=this.injector.get(l,sh,g);return b!==sh||d===sh?b:this.parentInjector.get(l,d,g)}}class od extends uy{get inputs(){const l=this.componentDef,d=l.inputTransforms,g=rl(l.inputs);if(null!==d)for(const b of g)d.hasOwnProperty(b.propName)&&(b.transform=d[b.propName]);return g}get outputs(){return rl(this.componentDef.outputs)}constructor(l,d){super(),this.componentDef=l,this.ngModule=d,this.componentType=l.type,this.selector=function Qi(n){return n.map(as).join(",")}(l.selectors),this.ngContentSelectors=l.ngContentSelectors?l.ngContentSelectors:[],this.isBoundToModule=!!d}create(l,d,g,b){let T=(b=b||this.ngModule)instanceof Ja?b:b?.injector;T&&null!==this.componentDef.getStandaloneInjector&&(T=this.componentDef.getStandaloneInjector(T)||T);const R=T?new Yg(l,T):l,L=R.get(nm,null);if(null===L)throw new nt(407,!1);const me={rendererFactory:L,sanitizer:R.get(Ag,null),effectManager:R.get(Zg,null),afterRenderEventManager:R.get(Vg,null)},Fe=L.createRenderer(null,this.componentDef),Ze=this.componentDef.selectors[0][0]||"div",Dt=g?function tl(n,l,d,g){const T=g.get(Ug,!1)||d===Cs.ShadowDom,R=n.selectRootElement(l,T);return function Hg(n){nd(n)}(R),R}(Fe,g,this.componentDef.encapsulation,R):Gd(Fe,Ze,function vm(n){const l=n.toLowerCase();return"svg"===l?"svg":"math"===l?"math":null}(Ze)),On=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let Bt=null;null!==Dt&&(Bt=Xp(Dt,R,!0));const hi=dm(0,null,null,1,0,null,null,null,null,null,null),Ti=ed(null,hi,null,On,null,null,me,Fe,R,null,Bt);let br,sa;Ps(Ti);try{const Sh=this.componentDef;let b_,s1=null;Sh.findHostDirectiveDefs?(b_=[],s1=new Map,Sh.findHostDirectiveDefs(Sh,b_,s1),b_.push(Sh)):b_=[Sh];const rM=function e(n,l){const d=n[ln],g=yn;return n[g]=l,dc(d,g,2,"#host",null)}(Ti,Dt),oM=function s(n,l,d,g,b,T,R){const L=b[ln];!function u(n,l,d,g){for(const b of n)l.mergedAttrs=mr(l.mergedAttrs,b.hostAttrs);null!==l.mergedAttrs&&(nu(l,l.mergedAttrs,!0),null!==d&&Wc(g,d,l))}(g,n,l,R);let V=null;null!==l&&(V=Xp(l,b[Zs]));const W=T.rendererFactory.createRenderer(l,d);let ne=16;d.signals?ne=4096:d.onPush&&(ne=64);const me=ed(b,f0(d),null,ne,b[n.index],n,T,W,null,null,V);return L.firstCreatePass&&hm(L,n,g.length-1),fc(b,me),b[n.index]=me}(rM,Dt,Sh,b_,Ti,me,Fe);sa=Dc(hi,yn),Dt&&function y(n,l,d,g){if(g)lt(n,d,["ng-version",Ns.full]);else{const{attrs:b,classes:T}=function Yo(n){const l=[],d=[];let g=1,b=2;for(;g<n.length;){let T=n[g];if("string"==typeof T)2===b?""!==T&&l.push(T,n[++g]):8===b&&d.push(T);else{if(!Ln(b))break;b=T}g++}return{attrs:l,classes:d}}(l.selectors[0]);b&&lt(n,d,b),T&&T.length>0&&qd(n,d,T.join(" "))}}(Fe,Sh,Dt,g),void 0!==d&&function x(n,l,d){const g=n.projection=[];for(let b=0;b<l.length;b++){const T=d[b];g.push(null!=T?Array.from(T):null)}}(sa,this.ngContentSelectors,d),br=function m(n,l,d,g,b,T){const R=Zr(),L=b[ln],V=Ur(R,b);My(L,b,R,d,null,g);for(let ne=0;ne<d.length;ne++)Do(sn(b,L,R.directiveStart+ne,R),b);ns(L,b,R),V&&Do(V,b);const W=sn(b,L,R.directiveStart+R.componentOffset,R);if(n[gr]=b[gr]=W,null!==T)for(const ne of T)ne(W,l);return ro(L,R,n),W}(oM,Sh,b_,s1,Ti,[D]),ra(hi,Ti,null)}finally{Rd()}return new r(this.componentType,br,Tf(sa,Ti),Ti,sa)}}class r extends cy{constructor(l,d,g,b,T){super(),this.location=g,this._rootLView=b,this._tNode=T,this.previousInputValues=null,this.instance=d,this.hostView=this.changeDetectorRef=new ym(b),this.componentType=l}setInput(l,d){const g=this._tNode.inputs;let b;if(null!==g&&(b=g[l])){if(this.previousInputValues??=new Map,this.previousInputValues.has(l)&&Object.is(this.previousInputValues.get(l),d))return;const T=this._rootLView;eu(T[ln],T,b,l,d),this.previousInputValues.set(l,d),uh(wo(this._tNode.index,T))}}get injector(){return new ii(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(l){this.hostView.onDestroy(l)}}function D(){const n=Zr();Eo(Nt()[ln],n)}function P(n){let l=function S(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),d=!0;const g=[n];for(;l;){let b;if(Ss(n))b=l.\u0275cmp||l.\u0275dir;else{if(l.\u0275cmp)throw new nt(903,!1);b=l.\u0275dir}if(b){if(d){g.push(b);const R=n;R.inputs=z(n.inputs),R.inputTransforms=z(n.inputTransforms),R.declaredInputs=z(n.declaredInputs),R.outputs=z(n.outputs);const L=b.hostBindings;L&&G(n,L);const V=b.viewQuery,W=b.contentQueries;if(V&&U(n,V),W&&H(n,W),$e(n.inputs,b.inputs),$e(n.declaredInputs,b.declaredInputs),$e(n.outputs,b.outputs),null!==b.inputTransforms&&(null===R.inputTransforms&&(R.inputTransforms={}),$e(R.inputTransforms,b.inputTransforms)),Ss(b)&&b.data.animation){const ne=n.data;ne.animation=(ne.animation||[]).concat(b.data.animation)}}const T=b.features;if(T)for(let R=0;R<T.length;R++){const L=T[R];L&&L.ngInherit&&L(n),L===P&&(d=!1)}}l=Object.getPrototypeOf(l)}!function F(n){let l=0,d=null;for(let g=n.length-1;g>=0;g--){const b=n[g];b.hostVars=l+=b.hostVars,b.hostAttrs=mr(b.hostAttrs,d=mr(d,b.hostAttrs))}}(g)}function z(n){return n===Qr?{}:n===xi?[]:n}function U(n,l){const d=n.viewQuery;n.viewQuery=d?(g,b)=>{l(g,b),d(g,b)}:l}function H(n,l){const d=n.contentQueries;n.contentQueries=d?(g,b,T)=>{l(g,b,T),d(g,b,T)}:l}function G(n,l){const d=n.hostBindings;n.hostBindings=d?(g,b)=>{l(g,b),d(g,b)}:l}function Ke(n){const l=n.inputConfig,d={};for(const g in l)if(l.hasOwnProperty(g)){const b=l[g];Array.isArray(b)&&b[2]&&(d[g]=b[2])}n.inputTransforms=d}function Ot(n){return!!yt(n)&&(Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n)}function yt(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Ht(n,l,d){return!Object.is(n[l],d)&&(n[l]=d,!0)}function Ut(n,l,d,g){const b=Nt();return Ht(b,yl(),l)&&(yi(),Da(yr(),b,n,l,d,g)),Ut}function $n(n,l,d,g){return Ht(n,yl(),d)?l+Ft(d)+g:li}function w0(n,l,d,g,b,T,R,L){const V=Nt(),W=yi(),ne=n+yn,me=W.firstCreatePass?function h1(n,l,d,g,b,T,R,L,V){const W=l.consts,ne=dc(l,n,4,R||null,da(W,L));Ty(l,d,ne,da(W,V)),Eo(l,ne);const me=ne.tView=dm(2,ne,g,b,T,l.directiveRegistry,l.pipeRegistry,null,l.schemas,W,null);return null!==l.queries&&(l.queries.template(l,ne),me.queries=l.queries.embeddedTView(ne)),ne}(ne,W,V,l,d,g,b,T,R):W.data[ne];Ko(me,!1);const Fe=zy(W,V,me,n);Od()&&Cl(W,V,Fe,me),Do(Fe,V),fc(V,V[ne]=Ry(Fe,V,Fe,me)),jl(me)&&ia(W,V,me),null!=R&&td(V,me,L)}let zy=function Vy(n,l,d,g){return ar(!0),l[Bn].createComment("")};function kb(n,l,d){const g=Nt();return Ht(g,yl(),l)&&ts(yi(),yr(),g,n,l,g[Bn],d,!1),kb}function E0(n,l,d,g,b){const R=b?"class":"style";eu(n,d,l.inputs[R],R,g)}function Uy(n,l,d,g){const b=Nt(),T=yi(),R=yn+n,L=b[Bn],V=T.firstCreatePass?function p1(n,l,d,g,b,T){const R=l.consts,V=dc(l,n,2,g,da(R,b));return Ty(l,d,V,da(R,T)),null!==V.attrs&&nu(V,V.attrs,!1),null!==V.mergedAttrs&&nu(V,V.mergedAttrs,!0),null!==l.queries&&l.queries.elementStart(l,V),V}(R,T,b,l,d,g):T.data[R],W=Lb(T,b,V,L,l,n);b[R]=W;const ne=jl(V);return Ko(V,!0),Wc(L,W,V),32!=(32&V.flags)&&Od()&&Cl(T,b,W,V),0===function eo(){return Xn.lFrame.elementDepthCount}()&&Do(W,b),function Hl(){Xn.lFrame.elementDepthCount++}(),ne&&(ia(T,b,V),ro(T,V,b)),null!==g&&td(b,V),Uy}function jy(){let n=Zr();Rc()?function Mu(){Xn.lFrame.isParent=!1}():(n=n.parent,Ko(n,!1));const l=n;(function ap(n){return Xn.skipHydrationRootTNode===n})(l)&&function A_(){Xn.skipHydrationRootTNode=null}(),function Tu(){Xn.lFrame.elementDepthCount--}();const d=yi();return d.firstCreatePass&&(Eo(d,n),yc(n)&&d.queries.elementEnd(n)),null!=l.classesWithoutHost&&function q(n){return 0!=(8&n.flags)}(l)&&E0(d,l,Nt(),l.classesWithoutHost,!0),null!=l.stylesWithoutHost&&function ee(n){return 0!=(16&n.flags)}(l)&&E0(d,l,Nt(),l.stylesWithoutHost,!1),jy}function C0(n,l,d,g){return Uy(n,l,d,g),jy(),C0}let Lb=(n,l,d,g,b,T)=>(ar(!0),Gd(g,b,function Vo(){return Xn.lFrame.currentNamespace}()));function su(){return Nt()}function Jg(n){return!!n&&"function"==typeof n.then}function Qg(n){return!!n&&"function"==typeof n.subscribe}function Bb(n,l,d,g){const b=Nt(),T=yi(),R=Zr();return function e_(n,l,d,g,b,T,R){const L=jl(g),W=n.firstCreatePass&&Ff(n),ne=l[gr],me=Qc(l);let Fe=!0;if(3&g.type||R){const qt=Ur(g,l),hn=R?R(qt):qt,On=me.length,Bt=R?Ti=>R(Hi(Ti[g.index])):g.index;let hi=null;if(!R&&L&&(hi=function ld(n,l,d,g){const b=n.cleanup;if(null!=b)for(let T=0;T<b.length-1;T+=2){const R=b[T];if(R===d&&b[T+1]===g){const L=l[dl],V=b[T+2];return L.length>V?L[V]:null}"string"==typeof R&&(T+=2)}return null}(n,l,b,g.index)),null!==hi)(hi.__ngLastListenerFn__||hi).__ngNextListenerFn__=T,hi.__ngLastListenerFn__=T,Fe=!1;else{T=t_(g,l,ne,T,!1);const Ti=d.listen(hn,b,T);me.push(T,Ti),W&&W.push(b,Bt,On,On+1)}}else T=t_(g,l,ne,T,!1);const Ze=g.outputs;let Dt;if(Fe&&null!==Ze&&(Dt=Ze[b])){const qt=Dt.length;if(qt)for(let hn=0;hn<qt;hn+=2){const br=l[Dt[hn]][Dt[hn+1]].subscribe(T),sa=me.length;me.push(T,br),W&&W.push(b,g.index,sa,-(sa+1))}}}(T,b,b[Bn],R,n,l,g),Bb}function g1(n,l,d,g){try{return bo(6,l,d),!1!==d(g)}catch(b){return vh(n,b),!1}finally{bo(7,l,d)}}function t_(n,l,d,g,b){return function T(R){if(R===Function)return g;uh(n.componentOffset>-1?wo(n.index,l):l);let V=g1(l,d,g,R),W=T.__ngNextListenerFn__;for(;W;)V=g1(l,d,W,R)&&V,W=W.__ngNextListenerFn__;return b&&!1===V&&R.preventDefault(),V}}function _1(n=1){return function Gh(n){return(Xn.lFrame.contextLView=function Wl(n,l){for(;n>0;)l=l[Fo],n--;return l}(n,Xn.lFrame.contextLView))[gr]}(n)}function zb(n,l,d){return Uf(n,"",l,"",d),zb}function Uf(n,l,d,g,b){const T=Nt(),R=$n(T,l,d,g);return R!==li&&ts(yi(),yr(),T,n,R,T[Bn],b,!1),Uf}function Zy(n,l){return n<<17|l<<2}function Eh(n){return n>>17&32767}function A0(n){return 2|n}function jf(n){return(131068&n)>>2}function Wb(n,l){return-131069&n|l<<2}function P0(n){return 1|n}function Zb(n,l,d,g,b){const T=n[d+1],R=null===l;let L=g?Eh(T):jf(T),V=!1;for(;0!==L&&(!1===V||R);){const ne=n[L+1];x1(n[L],l)&&(V=!0,n[L+1]=g?P0(ne):A0(ne)),L=g?Eh(ne):jf(ne)}V&&(n[d+1]=g?A0(T):P0(T))}function x1(n,l){return null===n||null==l||(Array.isArray(n)?n[1]:n)===l||!(!Array.isArray(n)||"string"!=typeof l)&&Qs(n,l)>=0}function L0(n,l){return function rs(n,l,d,g){const b=Nt(),T=yi(),R=function to(n){const l=Xn.lFrame,d=l.bindingIndex;return l.bindingIndex=l.bindingIndex+n,d}(2);T.firstUpdatePass&&function Yy(n,l,d,g){const b=n.data;if(null===b[d+1]){const T=b[jr()],R=function r_(n,l){return l>=n.expandoStartIndex}(n,d);(function sx(n,l){return 0!=(n.flags&(l?8:16))})(T,g)&&null===l&&!R&&(l=!1),l=function ex(n,l,d,g){const b=function dp(n){const l=Xn.lFrame.currentDirectiveIndex;return-1===l?null:n[l]}(n);let T=g?l.residualClasses:l.residualStyles;if(null===b)0===(g?l.classBindings:l.styleBindings)&&(d=o_(d=Xy(null,n,l,d,g),l.attrs,g),T=null);else{const R=l.directiveStylingLast;if(-1===R||n[R]!==b)if(d=Xy(b,n,l,d,g),null===T){let V=function tx(n,l,d){const g=d?l.classBindings:l.styleBindings;if(0!==jf(g))return n[Eh(g)]}(n,l,g);void 0!==V&&Array.isArray(V)&&(V=Xy(null,n,l,V[1],g),V=o_(V,l.attrs,g),function nx(n,l,d,g){n[Eh(d?l.classBindings:l.styleBindings)]=g}(n,l,g,V))}else T=function T1(n,l,d){let g;const b=l.directiveEnd;for(let T=1+l.directiveStylingLast;T<b;T++)g=o_(g,n[T].hostAttrs,d);return o_(g,l.attrs,d)}(n,l,g)}return void 0!==T&&(g?l.residualClasses=T:l.residualStyles=T),d}(b,T,l,g),function R0(n,l,d,g,b,T){let R=T?l.classBindings:l.styleBindings,L=Eh(R),V=jf(R);n[g]=d;let ne,W=!1;if(Array.isArray(d)?(ne=d[1],(null===ne||Qs(d,ne)>0)&&(W=!0)):ne=d,b)if(0!==V){const Fe=Eh(n[L+1]);n[g+1]=Zy(Fe,L),0!==Fe&&(n[Fe+1]=Wb(n[Fe+1],g)),n[L+1]=function v1(n,l){return 131071&n|l<<17}(n[L+1],g)}else n[g+1]=Zy(L,0),0!==L&&(n[L+1]=Wb(n[L+1],g)),L=g;else n[g+1]=Zy(V,0),0===L?L=g:n[V+1]=Wb(n[V+1],g),V=g;W&&(n[g+1]=A0(n[g+1])),Zb(n,ne,g,!0),Zb(n,ne,g,!1),function b1(n,l,d,g,b){const T=b?n.residualClasses:n.residualStyles;null!=T&&"string"==typeof l&&Qs(T,l)>=0&&(d[g+1]=P0(d[g+1]))}(l,ne,n,g,T),R=Zy(L,V),T?l.classBindings=R:l.styleBindings=R}(b,T,l,d,R,g)}}(T,n,R,g),l!==li&&Ht(b,R,l)&&function rx(n,l,d,g,b,T,R,L){if(!(3&l.type))return;const V=n.data,W=V[L+1],ne=function lD(n){return 1==(1&n)}(W)?ox(V,l,d,b,jf(W),R):void 0;Ky(ne)||(Ky(T)||function y1(n){return 2==(2&n)}(W)&&(T=ox(V,null,d,b,L,R)),function $v(n,l,d,g,b){if(l)b?n.addClass(d,g):n.removeClass(d,g);else{let T=-1===g.indexOf("-")?void 0:jc.DashCase;null==b?n.removeStyle(d,g,T):("string"==typeof b&&b.endsWith("!important")&&(b=b.slice(0,-10),T|=jc.Important),n.setStyle(d,g,b,T))}}(g,R,_l(jr(),d),b,T))}(T,T.data[jr()],b,b[Bn],n,b[R+1]=function A1(n,l){return null==n||""===n||("string"==typeof l?n+=l:"object"==typeof n&&(n=Qe(Dl(n)))),n}(l,d),g,R)}(n,l,null,!0),L0}function Xy(n,l,d,g,b){let T=null;const R=d.directiveEnd;let L=d.directiveStylingLast;for(-1===L?L=d.directiveStart:L++;L<R&&(T=l[L],g=o_(g,T.hostAttrs,b),T!==n);)L++;return null!==n&&(d.directiveStylingLast=L),g}function o_(n,l,d){const g=d?1:2;let b=-1;if(null!==l)for(let T=0;T<l.length;T++){const R=l[T];"number"==typeof R?b=R:b===g&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Js(n,R,!!d||l[++T]))}return void 0===n?null:n}function ox(n,l,d,g,b,T){const R=null===l;let L;for(;b>0;){const V=n[b],W=Array.isArray(V),ne=W?V[1]:V,me=null===ne;let Fe=d[b+1];Fe===li&&(Fe=me?xi:void 0);let Ze=me?Iu(Fe,g):ne===g?Fe:void 0;if(W&&!Ky(Ze)&&(Ze=Iu(V,g)),Ky(Ze)&&(L=Ze,R))return L;const Dt=n[b+1];b=R?Eh(Dt):jf(Dt)}if(null!==l){let V=T?l.residualClasses:l.residualStyles;null!=V&&(L=Iu(V,g))}return L}function Ky(n){return void 0!==n}function ax(n,l=""){const d=Nt(),g=yi(),b=n+yn,T=g.firstCreatePass?dc(g,b,1,l,null):g.data[b],R=Jy(g,d,T,l,n);d[b]=R,Od()&&Cl(g,d,R,T),Ko(T,!1)}let Jy=(n,l,d,g,b)=>(ar(!0),function nf(n,l){return n.createText(l)}(l[Bn],g));function N0(n){return s_("",n,""),N0}function s_(n,l,d){const g=Nt(),b=$n(g,n,l,d);return b!==li&&function To(n,l,d){const g=_l(l,n);!function rg(n,l,d){n.setValue(l,d)}(n[Bn],g,d)}(g,jr(),b),s_}const $f=void 0;var X1=["en",[["a","p"],["AM","PM"],$f],[["AM","PM"],$f,$f],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],$f,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],$f,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",$f,"{1} 'at' {0}",$f],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Y1(n){const d=Math.floor(Math.abs(n)),g=n.toString().replace(/^[^.]*\.?/,"").length;return 1===d&&0===g?1:5}];let Tm={};function j0(n){const l=function K1(n){return n.toLowerCase().replace(/_/g,"-")}(n);let d=Ex(l);if(d)return d;const g=l.split("-")[0];if(d=Ex(g),d)return d;if("en"===g)return X1;throw new nt(701,!1)}function wx(n){return j0(n)[Mm.PluralCase]}function Ex(n){return n in Tm||(Tm[n]=Ui.ng&&Ui.ng.common&&Ui.ng.common.locales&&Ui.ng.common.locales[n]),Tm[n]}var Mm=function(n){return n[n.LocaleId=0]="LocaleId",n[n.DayPeriodsFormat=1]="DayPeriodsFormat",n[n.DayPeriodsStandalone=2]="DayPeriodsStandalone",n[n.DaysFormat=3]="DaysFormat",n[n.DaysStandalone=4]="DaysStandalone",n[n.MonthsFormat=5]="MonthsFormat",n[n.MonthsStandalone=6]="MonthsStandalone",n[n.Eras=7]="Eras",n[n.FirstDayOfWeek=8]="FirstDayOfWeek",n[n.WeekendRange=9]="WeekendRange",n[n.DateFormat=10]="DateFormat",n[n.TimeFormat=11]="TimeFormat",n[n.DateTimeFormat=12]="DateTimeFormat",n[n.NumberSymbols=13]="NumberSymbols",n[n.NumberFormats=14]="NumberFormats",n[n.CurrencyCode=15]="CurrencyCode",n[n.CurrencySymbol=16]="CurrencySymbol",n[n.CurrencyName=17]="CurrencyName",n[n.Currencies=18]="Currencies",n[n.Directionality=19]="Directionality",n[n.PluralCase=20]="PluralCase",n[n.ExtraData=21]="ExtraData",n}(Mm||{});const Sm="en-US";let Cx=Sm;function Y0(n,l,d,g,b){if(n=Pt(n),Array.isArray(n))for(let T=0;T<n.length;T++)Y0(n[T],l,d,g,b);else{const T=yi(),R=Nt(),L=Zr();let V=Tl(n)?n:Pt(n.provide);const W=ih(n),ne=1048575&L.providerIndexes,me=L.directiveStart,Fe=L.providerIndexes>>20;if(Tl(n)||!n.multi){const Ze=new O(W,b,Qu),Dt=ud(V,l,b?ne:ne+Fe,me);-1===Dt?(_t(At(L,R),T,V),X0(T,n,l.length),l.push(V),L.directiveStart++,L.directiveEnd++,b&&(L.providerIndexes+=1048576),d.push(Ze),R.push(Ze)):(d[Dt]=Ze,R[Dt]=Ze)}else{const Ze=ud(V,l,ne+Fe,me),Dt=ud(V,l,ne,ne+Fe),hn=Dt>=0&&d[Dt];if(b&&!hn||!b&&!(Ze>=0&&d[Ze])){_t(At(L,R),T,V);const On=function bE(n,l,d,g,b){const T=new O(n,d,Qu);return T.multi=[],T.index=l,T.componentProviders=0,Zx(T,b,g&&!d),T}(b?J0:K0,d.length,b,g,W);!b&&hn&&(d[Dt].providerFactory=On),X0(T,n,l.length,0),l.push(V),L.directiveStart++,L.directiveEnd++,b&&(L.providerIndexes+=1048576),d.push(On),R.push(On)}else X0(T,n,Ze>-1?Ze:Dt,Zx(d[b?Dt:Ze],W,!b&&g));!b&&g&&hn&&d[Dt].componentProviders++}}}function X0(n,l,d,g){const b=Tl(l),T=function iy(n){return!!n.useClass}(l);if(b||T){const V=(T?Pt(l.useClass):l).prototype.ngOnDestroy;if(V){const W=n.destroyHooks||(n.destroyHooks=[]);if(!b&&l.multi){const ne=W.indexOf(d);-1===ne?W.push(d,[g,V]):W[ne+1].push(g,V)}else W.push(d,V)}}}function Zx(n,l,d){return d&&n.componentProviders++,n.multi.push(l)-1}function ud(n,l,d,g){for(let b=d;b<g;b++)if(l[b]===n)return b;return-1}function K0(n,l,d,g){return Rm(this.multi,[])}function J0(n,l,d,g){const b=this.multi;let T;if(this.providerFactory){const R=this.providerFactory.componentProviders,L=sn(d,d[ln],this.providerFactory.index,g);T=L.slice(0,R),Rm(b,T);for(let V=R;V<L.length;V++)T.push(L[V])}else T=[],Rm(b,T);return T}function Rm(n,l){for(let d=0;d<n.length;d++)l.push((0,n[d])());return l}function qx(n,l=[]){return d=>{d.providersResolver=(g,b)=>function vE(n,l,d){const g=yi();if(g.firstCreatePass){const b=Ss(n);Y0(d,g.data,g.blueprint,b,!0),Y0(l,g.data,g.blueprint,b,!1)}}(g,b?b(n):n,l)}}class Yf{}class Yx{}function xE(n,l){return new Q0(n,l??null,[])}class Q0 extends Yf{constructor(l,d,g){super(),this._parent=d,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Bf(this);const b=qi(l);this._bootstrapComponents=Al(b.bootstrap),this._r3Injector=Og(l,d,[{provide:Yf,useValue:this},{provide:Yu,useValue:this.componentFactoryResolver},...g],Qe(l),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(l)}get injector(){return this._r3Injector}destroy(){const l=this._r3Injector;!l.destroyed&&l.destroy(),this.destroyCbs.forEach(d=>d()),this.destroyCbs=null}onDestroy(l){this.destroyCbs.push(l)}}class Om extends Yx{constructor(l){super(),this.moduleType=l}create(l){return new Q0(this.moduleType,l,[])}}class u_ extends Yf{constructor(l){super(),this.componentFactoryResolver=new Bf(this),this.instance=null;const d=new nh([...l.providers,{provide:Yf,useValue:this},{provide:Yu,useValue:this.componentFactoryResolver}],l.parent||Ef(),l.debugName,new Set(["environment"]));this.injector=d,l.runEnvironmentInitializers&&d.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(l){this.injector.onDestroy(l)}}function Kx(n,l,d=null){return new u_({providers:n,parent:l,debugName:d,runEnvironmentInitializers:!0}).injector}let Jx=(()=>{var n;class l{constructor(g){this._injector=g,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(g){if(!g.standalone)return null;if(!this.cachedInjectors.has(g)){const b=ty(0,g.type),T=b.length>0?Kx([b],this._injector,`Standalone[${g.type.name}]`):null;this.cachedInjectors.set(g,T)}return this.cachedInjectors.get(g)}ngOnDestroy(){try{for(const g of this.cachedInjectors.values())null!==g&&g.destroy()}finally{this.cachedInjectors.clear()}}}return(n=l).\u0275prov=An({token:n,providedIn:"environment",factory:()=>new n(Jn(Ja))}),l})();function Qx(n){n.getStandaloneInjector=l=>l.get(Jx).getOrCreateStandaloneInjector(n)}function pv(n,l,d,g,b,T){const R=l+d;return Ht(n,R,b)?function Rt(n,l,d){return n[l]=d}(n,R+1,T?g.call(T,b):g(b)):function oa(n,l){const d=n[l];return d===li?void 0:d}(n,R+1)}function gv(n,l){const d=yi();let g;const b=n+yn;d.firstCreatePass?(g=function OE(n,l){if(l)for(let d=l.length-1;d>=0;d--){const g=l[d];if(n===g.name)return g}}(l,d.pipeRegistry),d.data[b]=g,g.onDestroy&&(d.destroyHooks??=[]).push(b,g.onDestroy)):g=d.data[b];const T=g.factory||(g.factory=Na(g.type)),L=zr(Qu);try{const V=pe(!1),W=T();return pe(V),function Ob(n,l,d,g){d>=n.data.length&&(n.data[d]=null,n.blueprint[d]=null),l[d]=g}(d,Nt(),b,W),W}finally{zr(L)}}function hw(n,l,d){const g=n+yn,b=Nt(),T=function xo(n,l){return n[l]}(b,g);return function lu(n,l){return n[ln].data[l].pure}(b,g)?pv(b,function zo(){const n=Xn.lFrame;let l=n.bindingRootIndex;return-1===l&&(l=n.bindingRootIndex=n.tView.bindingStartIndex),l}(),l,T.transform,d,T):T.transform(d)}function kE(){return this._results[Symbol.iterator]()}class rb{get changes(){return this._changes||(this._changes=new ac)}constructor(l=!1){this._emitDistinctChangesOnly=l,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const d=rb.prototype;d[Symbol.iterator]||(d[Symbol.iterator]=kE)}get(l){return this._results[l]}map(l){return this._results.map(l)}filter(l){return this._results.filter(l)}find(l){return this._results.find(l)}reduce(l,d){return this._results.reduce(l,d)}forEach(l){this._results.forEach(l)}some(l){return this._results.some(l)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(l,d){const g=this;g.dirty=!1;const b=function ao(n){return n.flat(Number.POSITIVE_INFINITY)}(l);(this._changesDetected=!function fp(n,l,d){if(n.length!==l.length)return!1;for(let g=0;g<n.length;g++){let b=n[g],T=l[g];if(d&&(b=d(b),T=d(T)),T!==b)return!1}return!0}(g._results,b,d))&&(g._results=b,g.length=b.length,g.last=b[this.length-1],g.first=b[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function _w(n,l,d,g=!0){const b=l[ln];if(function sg(n,l,d,g){const b=Vr+g,T=d.length;g>0&&(d[b-1][ko]=l),g<T-Vr?(l[ko]=d[b],Yl(d,Vr+g,l)):(d.push(l),l[ko]=null),l[sr]=d;const R=l[Ts];null!==R&&d!==R&&function wl(n,l){const d=n[Ul];l[_r]!==l[sr][sr][_r]&&(n[Lh]=!0),null===d?n[Ul]=[l]:d.push(l)}(R,l);const L=l[No];null!==L&&L.insertView(n),l[Tn]|=128}(b,l,n,d),g){const T=lg(d,n),R=l[Bn],L=rf(R,n[Bo]);null!==L&&function $_(n,l,d,g,b,T){g[hr]=b,g[Mr]=l,Zd(n,g,d,1,b,T)}(b,n[Mr],R,l,L,T)}}let d_=(()=>{class l{}return l.__NG_ELEMENT_ID__=FE,l})();const LE=d_,sb=class extends LE{constructor(l,d,g){super(),this._declarationLView=l,this._declarationTContainer=d,this.elementRef=g}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(l,d){return this.createEmbeddedViewImpl(l,d)}createEmbeddedViewImpl(l,d,g){const b=function gw(n,l,d,g){const b=l.tView,L=ed(n,b,d,4096&n[Tn]?4096:16,null,l,null,null,null,g?.injector??null,g?.hydrationInfo??null);L[Ts]=n[l.index];const W=n[No];return null!==W&&(L[No]=W.createEmbeddedView(b)),ra(b,L,d),L}(this._declarationLView,this._declarationTContainer,l,{injector:d,hydrationInfo:g});return new iu(b)}};function FE(){return h_(Zr(),Nt())}function h_(n,l){return 4&n.type?new sb(l,n,Tf(n,l)):null}let vv=(()=>{class l{}return l.__NG_ELEMENT_ID__=zE,l})();function zE(){return xv(Zr(),Nt())}const VE=vv,Ew=class extends VE{constructor(l,d,g){super(),this._lContainer=l,this._hostTNode=d,this._hostLView=g}get element(){return Tf(this._hostTNode,this._hostLView)}get injector(){return new ii(this._hostTNode,this._hostLView)}get parentInjector(){const l=tt(this._hostTNode,this._hostLView);if(ae(l)){const d=oe(l,this._hostLView),g=ce(l);return new ii(d[ln].data[g+8],d)}return new ii(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(l){const d=Cw(this._lContainer);return null!==d&&d[l]||null}get length(){return this._lContainer.length-Vr}createEmbeddedView(l,d,g){let b,T;"number"==typeof g?b=g:null!=g&&(b=g.index,T=g.injector);const L=l.createEmbeddedViewImpl(d||{},T,null);return this.insertImpl(L,b,false),L}createComponent(l,d,g,b,T){const R=l&&!function ja(n){return"function"==typeof n}(l);let L;if(R)L=d;else{const qt=d||{};L=qt.index,g=qt.injector,b=qt.projectableNodes,T=qt.environmentInjector||qt.ngModuleRef}const V=R?l:new od(Cn(l)),W=g||this.parentInjector;if(!T&&null==V.ngModule){const hn=(R?W:this.parentInjector).get(Ja,null);hn&&(T=hn)}Cn(V.componentType??{});const Ze=V.create(W,b,null,T);return this.insertImpl(Ze.hostView,L,false),Ze}insert(l,d){return this.insertImpl(l,d,!1)}insertImpl(l,d,g){const b=l._lView;if(function Mc(n){return kr(n[sr])}(b)){const V=this.indexOf(l);if(-1!==V)this.detach(V);else{const W=b[sr],ne=new Ew(W,W[Mr],W[sr]);ne.detach(ne.indexOf(l))}}const R=this._adjustIndex(d),L=this._lContainer;return _w(L,b,R,!g),l.attachToViewContainerRef(),Yl(bv(L),R,l),l}move(l,d){return this.insert(l,d)}indexOf(l){const d=Cw(this._lContainer);return null!==d?d.indexOf(l):-1}remove(l){const d=this._adjustIndex(l,-1),g=$o(this._lContainer,d);g&&(Rs(bv(this._lContainer),d),ms(g[ln],g))}detach(l){const d=this._adjustIndex(l,-1),g=$o(this._lContainer,d);return g&&null!=Rs(bv(this._lContainer),d)?new iu(g):null}_adjustIndex(l,d=0){return l??this.length+d}};function Cw(n){return n[8]}function bv(n){return n[8]||(n[8]=[])}function xv(n,l){let d;const g=l[n.index];return kr(g)?d=g:(d=Ry(g,l,null,n),l[n.index]=d,fc(l,d)),Tw(d,l,n,g),new Ew(d,n,l)}let Tw=function UE(n,l,d,g){if(n[Bo])return;let b;b=8&d.type?Hi(g):function Dw(n,l){const d=n[Bn],g=d.createComment(""),b=Ur(l,n);return ea(d,rf(d,b),g,function jv(n,l){return n.nextSibling(l)}(d,b),!1),g}(l,d),n[Bo]=b};class f_{constructor(l){this.queryList=l,this.matches=null}clone(){return new f_(this.queryList)}setDirty(){this.queryList.setDirty()}}class dd{constructor(l=[]){this.queries=l}createEmbeddedView(l){const d=l.queries;if(null!==d){const g=null!==l.contentQueries?l.contentQueries[0]:d.length,b=[];for(let T=0;T<g;T++){const R=d.getByIndex(T);b.push(this.queries[R.indexInDeclarationView].clone())}return new dd(b)}return null}insertView(l){this.dirtyQueriesWithMatches(l)}detachView(l){this.dirtyQueriesWithMatches(l)}dirtyQueriesWithMatches(l){for(let d=0;d<this.queries.length;d++)null!==GE(l,d).matches&&this.queries[d].setDirty()}}class jE{constructor(l,d,g=null){this.predicate=l,this.flags=d,this.read=g}}class Th{constructor(l=[]){this.queries=l}elementStart(l,d){for(let g=0;g<this.queries.length;g++)this.queries[g].elementStart(l,d)}elementEnd(l){for(let d=0;d<this.queries.length;d++)this.queries[d].elementEnd(l)}embeddedTView(l){let d=null;for(let g=0;g<this.length;g++){const b=null!==d?d.length:0,T=this.getByIndex(g).embeddedTView(l,b);T&&(T.indexInDeclarationView=g,null!==d?d.push(T):d=[T])}return null!==d?new Th(d):null}template(l,d){for(let g=0;g<this.queries.length;g++)this.queries[g].template(l,d)}getByIndex(l){return this.queries[l]}get length(){return this.queries.length}track(l){this.queries.push(l)}}class wv{constructor(l,d=-1){this.metadata=l,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=d}elementStart(l,d){this.isApplyingToNode(d)&&this.matchTNode(l,d)}elementEnd(l){this._declarationNodeIndex===l.index&&(this._appliesToNextNode=!1)}template(l,d){this.elementStart(l,d)}embeddedTView(l,d){return this.isApplyingToNode(l)?(this.crossesNgTemplate=!0,this.addMatch(-l.index,d),new wv(this.metadata)):null}isApplyingToNode(l){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const d=this._declarationNodeIndex;let g=l.parent;for(;null!==g&&8&g.type&&g.index!==d;)g=g.parent;return d===(null!==g?g.index:-1)}return this._appliesToNextNode}matchTNode(l,d){const g=this.metadata.predicate;if(Array.isArray(g))for(let b=0;b<g.length;b++){const T=g[b];this.matchTNodeWithReadOption(l,d,PD(d,T)),this.matchTNodeWithReadOption(l,d,Rn(d,l,T,!1,!1))}else g===d_?4&d.type&&this.matchTNodeWithReadOption(l,d,-1):this.matchTNodeWithReadOption(l,d,Rn(d,l,g,!1,!1))}matchTNodeWithReadOption(l,d,g){if(null!==g){const b=this.metadata.read;if(null!==b)if(b===Mf||b===vv||b===d_&&4&d.type)this.addMatch(d.index,-2);else{const T=Rn(d,l,b,!1,!1);null!==T&&this.addMatch(d.index,T)}else this.addMatch(d.index,g)}}addMatch(l,d){null===this.matches?this.matches=[l,d]:this.matches.push(l,d)}}function PD(n,l){const d=n.localNames;if(null!==d)for(let g=0;g<d.length;g+=2)if(d[g]===l)return d[g+1];return null}function $E(n,l,d,g){return-1===d?function p_(n,l){return 11&n.type?Tf(n,l):4&n.type?h_(n,l):null}(l,n):-2===d?function m_(n,l,d){return d===Mf?Tf(l,n):d===d_?h_(l,n):d===vv?xv(l,n):void 0}(n,l,g):sn(n,n[ln],d,l)}function g_(n,l,d,g){const b=l[No].queries[g];if(null===b.matches){const T=n.data,R=d.matches,L=[];for(let V=0;V<R.length;V+=2){const W=R[V];L.push(W<0?null:$E(l,T[W],R[V+1],d.metadata.read))}b.matches=L}return b.matches}function hd(n,l,d,g){const b=n.queries.getByIndex(d),T=b.matches;if(null!==T){const R=g_(n,l,b,d);for(let L=0;L<T.length;L+=2){const V=T[L];if(V>0)g.push(R[L/2]);else{const W=T[L+1],ne=l[-V];for(let me=Vr;me<ne.length;me++){const Fe=ne[me];Fe[Ts]===Fe[sr]&&hd(Fe[ln],Fe,W,g)}if(null!==ne[Ul]){const me=ne[Ul];for(let Fe=0;Fe<me.length;Fe++){const Ze=me[Fe];hd(Ze[ln],Ze,W,g)}}}}}return g}function Mw(n){const l=Nt(),d=yi(),g=Hm();Jo(g+1);const b=GE(d,g);if(n.dirty&&function xu(n){return 4==(4&n[Tn])}(l)===(2==(2&b.metadata.flags))){if(null===b.matches)n.reset([]);else{const T=b.crossesNgTemplate?hd(d,l,g,[]):g_(d,l,b,g);n.reset(T,o0),n.notifyOnChanges()}return!0}return!1}function Ev(n,l,d,g){const b=yi();if(b.firstCreatePass){const T=Zr();(function Cv(n,l,d){null===n.queries&&(n.queries=new Th),n.queries.track(new wv(l,d))})(b,new jE(l,d,g),T.index),function lb(n,l){const d=n.contentQueries||(n.contentQueries=[]);l!==(d.length?d[d.length-1]:-1)&&d.push(n.queries.length-1,l)}(b,n),2==(2&d)&&(b.staticContentQueries=!0)}!function HE(n,l,d){const g=new rb(4==(4&d));(function p0(n,l,d,g){const b=Qc(l);b.push(d),n.firstCreatePass&&Ff(n).push(g,b.length-1)})(n,l,g,g.destroy),null===l[No]&&(l[No]=new dd),l[No].queries.push(new f_(g))}(b,Nt(),d)}function Sw(){return function OD(n,l){return n[No].queries[l].queryList}(Nt(),Hm())}function GE(n,l){return n.queries.getByIndex(l)}function Iw(n){return!!qi(n)}const cC=new Fi("Application Initializer");let kw=(()=>{var n;class l{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((g,b)=>{this.resolve=g,this.reject=b}),this.appInits=si(cC,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const g=[];for(const T of this.appInits){const R=T();if(Jg(R))g.push(R);else if(Qg(R)){const L=new Promise((V,W)=>{R.subscribe({complete:V,error:W})});g.push(L)}}const b=()=>{this.done=!0,this.resolve()};Promise.all(g).then(()=>{b()}).catch(T=>{this.reject(T)}),0===g.length&&b(),this.initialized=!0}}return(n=l).\u0275fac=function(g){return new(g||n)},n.\u0275prov=An({token:n,factory:n.\u0275fac,providedIn:"root"}),l})(),uC=(()=>{var n;class l{log(g){console.log(g)}warn(g){console.warn(g)}}return(n=l).\u0275fac=function(g){return new(g||n)},n.\u0275prov=An({token:n,factory:n.\u0275fac,providedIn:"platform"}),l})();const ub=new Fi("LocaleId",{providedIn:"root",factory:()=>si(ub,Un.Optional|Un.SkipSelf)||function iT(){return typeof $localize<"u"&&$localize.locale||Sm}()}),rT=new Fi("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});let dC=(()=>{var n;class l{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ue.X(!1)}add(){this.hasPendingTasks.next(!0);const g=this.taskId++;return this.pendingTasks.add(g),g}remove(g){this.pendingTasks.delete(g),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return(n=l).\u0275fac=function(g){return new(g||n)},n.\u0275prov=An({token:n,factory:n.\u0275fac,providedIn:"root"}),l})();class sT{constructor(l,d){this.ngModuleFactory=l,this.componentFactories=d}}let aT=(()=>{var n;class l{compileModuleSync(g){return new Om(g)}compileModuleAsync(g){return Promise.resolve(this.compileModuleSync(g))}compileModuleAndAllComponentsSync(g){const b=this.compileModuleSync(g),R=Al(qi(g).declarations).reduce((L,V)=>{const W=Cn(V);return W&&L.push(new od(W)),L},[]);return new sT(b,R)}compileModuleAndAllComponentsAsync(g){return Promise.resolve(this.compileModuleAndAllComponentsSync(g))}clearCache(){}clearCacheFor(g){}getModuleId(g){}}return(n=l).\u0275fac=function(g){return new(g||n)},n.\u0275prov=An({token:n,factory:n.\u0275fac,providedIn:"root"}),l})();const mC=new Fi(""),gC=new Fi("");let Nw,MT=(()=>{var n;class l{constructor(g,b,T){this._ngZone=g,this.registry=b,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Nw||(function ST(n){Nw=n}(T),T.addToWindow(b)),this._watchAngularEvents(),g.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Gr.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let g=this._callbacks.pop();clearTimeout(g.timeoutId),g.doneCb(this._didWork)}this._didWork=!1});else{let g=this.getPendingTasks();this._callbacks=this._callbacks.filter(b=>!b.updateCb||!b.updateCb(g)||(clearTimeout(b.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(g=>({source:g.source,creationLocation:g.creationLocation,data:g.data})):[]}addCallback(g,b,T){let R=-1;b&&b>0&&(R=setTimeout(()=>{this._callbacks=this._callbacks.filter(L=>L.timeoutId!==R),g(this._didWork,this.getPendingTasks())},b)),this._callbacks.push({doneCb:g,timeoutId:R,updateCb:T})}whenStable(g,b,T){if(T&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(g,b,T),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(g){this.registry.registerApplication(g,this)}unregisterApplication(g){this.registry.unregisterApplication(g)}findProviders(g,b,T){return[]}}return(n=l).\u0275fac=function(g){return new(g||n)(Jn(Gr),Jn(_C),Jn(gC))},n.\u0275prov=An({token:n,factory:n.\u0275fac}),l})(),_C=(()=>{var n;class l{constructor(){this._applications=new Map}registerApplication(g,b){this._applications.set(g,b)}unregisterApplication(g){this._applications.delete(g)}unregisterAllApplications(){this._applications.clear()}getTestability(g){return this._applications.get(g)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(g,b=!0){return Nw?.findTestabilityInTree(this,g,b)??null}}return(n=l).\u0275fac=function(g){return new(g||n)},n.\u0275prov=An({token:n,factory:n.\u0275fac,providedIn:"platform"}),l})(),Xf=null;const yC=new Fi("AllowMultipleToken"),Bw=new Fi("PlatformDestroyListeners"),zw=new Fi("appBootstrapListener");class RT{constructor(l,d){this.name=l,this.token=d}}function xC(n,l,d=[]){const g=`Platform: ${l}`,b=new Fi(g);return(T=[])=>{let R=Sv();if(!R||R.injector.get(yC,!1)){const L=[...d,...T,{provide:b,useValue:!0}];n?n(L):function bC(n){if(Xf&&!Xf.get(yC,!1))throw new nt(400,!1);(function vC(){!function xc(n){yu=n}(()=>{throw new nt(600,!1)})})(),Xf=n;const l=n.get(Mh);(function ho(n){n.get(Cf,null)?.forEach(d=>d())})(n)}(function Uw(n=[],l){return xa.create({name:l,providers:[{provide:Up,useValue:"platform"},{provide:Bw,useValue:new Set([()=>Xf=null])},...n]})}(L,g))}return function wC(n){const l=Sv();if(!l)throw new nt(401,!1);return l}()}}function Sv(){return Xf?.get(Mh)??null}let Mh=(()=>{var n;class l{constructor(g){this._injector=g,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(g,b){const T=function EC(n="zone.js",l){return"noop"===n?new am:"zone.js"===n?new Gr(l):n}(b?.ngZone,function jw(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}({eventCoalescing:b?.ngZoneEventCoalescing,runCoalescing:b?.ngZoneRunCoalescing}));return T.run(()=>{const R=function eb(n,l,d){return new Q0(n,l,d)}(g.moduleType,this.injector,function Ww(n){return[{provide:Gr,useFactory:n},{provide:th,multi:!0,useFactory:()=>{const l=si(Gw,{optional:!0});return()=>l.initialize()}},{provide:CC,useFactory:OT},{provide:Bg,useFactory:If}]}(()=>T)),L=R.injector.get(el,null);return T.runOutsideAngular(()=>{const V=T.onError.subscribe({next:W=>{L.handleError(W)}});R.onDestroy(()=>{hb(this._modules,R),V.unsubscribe()})}),function $w(n,l,d){try{const g=d();return Jg(g)?g.catch(b=>{throw l.runOutsideAngular(()=>n.handleError(b)),b}):g}catch(g){throw l.runOutsideAngular(()=>n.handleError(g)),g}}(L,T,()=>{const V=R.injector.get(kw);return V.runInitializers(),V.donePromise.then(()=>(function Dx(n){mt(n,"Expected localeId to be defined"),"string"==typeof n&&(Cx=n.toLowerCase().replace(/_/g,"-"))}(R.injector.get(ub,Sm)||Sm),this._moduleDoBootstrap(R),R))})})}bootstrapModule(g,b=[]){const T=Hw({},b);return function IT(n,l,d){const g=new Om(d);return Promise.resolve(g)}(0,0,g).then(R=>this.bootstrapModuleFactory(R,T))}_moduleDoBootstrap(g){const b=g.injector.get(Kf);if(g._bootstrapComponents.length>0)g._bootstrapComponents.forEach(T=>b.bootstrap(T));else{if(!g.instance.ngDoBootstrap)throw new nt(-403,!1);g.instance.ngDoBootstrap(b)}this._modules.push(g)}onDestroy(g){this._destroyListeners.push(g)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new nt(404,!1);this._modules.slice().forEach(b=>b.destroy()),this._destroyListeners.forEach(b=>b());const g=this._injector.get(Bw,null);g&&(g.forEach(b=>b()),g.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return(n=l).\u0275fac=function(g){return new(g||n)(Jn(xa))},n.\u0275prov=An({token:n,factory:n.\u0275fac,providedIn:"platform"}),l})();function Hw(n,l){return Array.isArray(l)?l.reduce(Hw,n):{...n,...l}}let Kf=(()=>{var n;class l{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=si(CC),this.zoneIsStable=si(Bg),this.componentTypes=[],this.components=[],this.isStable=si(dC).hasPendingTasks.pipe((0,Le.w)(g=>g?(0,Ye.of)(!1):this.zoneIsStable),(0,Ie.x)(),(0,Ge.B)()),this._injector=si(Ja)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(g,b){const T=g instanceof uy;if(!this._injector.get(kw).done)throw!T&&Xo(g),new nt(405,!1);let L;L=T?g:this._injector.get(Yu).resolveComponentFactory(g),this.componentTypes.push(L.componentType);const V=function PT(n){return n.isBoundToModule}(L)?void 0:this._injector.get(Yf),ne=L.create(xa.NULL,[],b||L.selector,V),me=ne.location.nativeElement,Fe=ne.injector.get(mC,null);return Fe?.registerApplication(me),ne.onDestroy(()=>{this.detachView(ne.hostView),hb(this.components,ne),Fe?.unregisterApplication(me)}),this._loadComponent(ne),ne}tick(){if(this._runningTick)throw new nt(101,!1);try{this._runningTick=!0;for(let g of this._views)g.detectChanges()}catch(g){this.internalErrorHandler(g)}finally{this._runningTick=!1}}attachView(g){const b=g;this._views.push(b),b.attachToAppRef(this)}detachView(g){const b=g;hb(this._views,b),b.detachFromAppRef()}_loadComponent(g){this.attachView(g.hostView),this.tick(),this.components.push(g);const b=this._injector.get(zw,[]);b.push(...this._bootstrapListeners),b.forEach(T=>T(g))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(g=>g()),this._views.slice().forEach(g=>g.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(g){return this._destroyListeners.push(g),()=>hb(this._destroyListeners,g)}destroy(){if(this._destroyed)throw new nt(406,!1);const g=this._injector;g.destroy&&!g.destroyed&&g.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return(n=l).\u0275fac=function(g){return new(g||n)},n.\u0275prov=An({token:n,factory:n.\u0275fac,providedIn:"root"}),l})();function hb(n,l){const d=n.indexOf(l);d>-1&&n.splice(d,1)}const CC=new Fi("",{providedIn:"root",factory:()=>si(el).handleError.bind(void 0)});function OT(){const n=si(Gr),l=si(el);return d=>n.runOutsideAngular(()=>l.handleError(d))}let Gw=(()=>{var n;class l{constructor(){this.zone=si(Gr),this.applicationRef=si(Kf)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return(n=l).\u0275fac=function(g){return new(g||n)},n.\u0275prov=An({token:n,factory:n.\u0275fac,providedIn:"root"}),l})();function DC(){return!1}let LT=(()=>{class l{}return l.__NG_ELEMENT_ID__=FT,l})();function FT(n){return function NT(n,l,d){if(pl(n)&&!d){const g=wo(n.index,l);return new iu(g,g)}return 47&n.type?new iu(l[_r],l):null}(Zr(),Nt(),16==(16&n))}class Jw{constructor(){}supports(l){return Ot(l)}create(l){return new UT(l)}}const PC=(n,l)=>l;class UT{constructor(l){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=l||PC}forEachItem(l){let d;for(d=this._itHead;null!==d;d=d._next)l(d)}forEachOperation(l){let d=this._itHead,g=this._removalsHead,b=0,T=null;for(;d||g;){const R=!g||d&&d.currentIndex<OC(g,b,T)?d:g,L=OC(R,b,T),V=R.currentIndex;if(R===g)b--,g=g._nextRemoved;else if(d=d._next,null==R.previousIndex)b++;else{T||(T=[]);const W=L-b,ne=V-b;if(W!=ne){for(let Fe=0;Fe<W;Fe++){const Ze=Fe<T.length?T[Fe]:T[Fe]=0,Dt=Ze+Fe;ne<=Dt&&Dt<W&&(T[Fe]=Ze+1)}T[R.previousIndex]=ne-W}}L!==V&&l(R,L,V)}}forEachPreviousItem(l){let d;for(d=this._previousItHead;null!==d;d=d._nextPrevious)l(d)}forEachAddedItem(l){let d;for(d=this._additionsHead;null!==d;d=d._nextAdded)l(d)}forEachMovedItem(l){let d;for(d=this._movesHead;null!==d;d=d._nextMoved)l(d)}forEachRemovedItem(l){let d;for(d=this._removalsHead;null!==d;d=d._nextRemoved)l(d)}forEachIdentityChange(l){let d;for(d=this._identityChangesHead;null!==d;d=d._nextIdentityChange)l(d)}diff(l){if(null==l&&(l=[]),!Ot(l))throw new nt(900,!1);return this.check(l)?this:null}onDestroy(){}check(l){this._reset();let b,T,R,d=this._itHead,g=!1;if(Array.isArray(l)){this.length=l.length;for(let L=0;L<this.length;L++)T=l[L],R=this._trackByFn(L,T),null!==d&&Object.is(d.trackById,R)?(g&&(d=this._verifyReinsertion(d,T,R,L)),Object.is(d.item,T)||this._addIdentityChange(d,T)):(d=this._mismatch(d,T,R,L),g=!0),d=d._next}else b=0,function vt(n,l){if(Array.isArray(n))for(let d=0;d<n.length;d++)l(n[d]);else{const d=n[Symbol.iterator]();let g;for(;!(g=d.next()).done;)l(g.value)}}(l,L=>{R=this._trackByFn(b,L),null!==d&&Object.is(d.trackById,R)?(g&&(d=this._verifyReinsertion(d,L,R,b)),Object.is(d.item,L)||this._addIdentityChange(d,L)):(d=this._mismatch(d,L,R,b),g=!0),d=d._next,b++}),this.length=b;return this._truncate(d),this.collection=l,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let l;for(l=this._previousItHead=this._itHead;null!==l;l=l._next)l._nextPrevious=l._next;for(l=this._additionsHead;null!==l;l=l._nextAdded)l.previousIndex=l.currentIndex;for(this._additionsHead=this._additionsTail=null,l=this._movesHead;null!==l;l=l._nextMoved)l.previousIndex=l.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(l,d,g,b){let T;return null===l?T=this._itTail:(T=l._prev,this._remove(l)),null!==(l=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null))?(Object.is(l.item,d)||this._addIdentityChange(l,d),this._reinsertAfter(l,T,b)):null!==(l=null===this._linkedRecords?null:this._linkedRecords.get(g,b))?(Object.is(l.item,d)||this._addIdentityChange(l,d),this._moveAfter(l,T,b)):l=this._addAfter(new jT(d,g),T,b),l}_verifyReinsertion(l,d,g,b){let T=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null);return null!==T?l=this._reinsertAfter(T,l._prev,b):l.currentIndex!=b&&(l.currentIndex=b,this._addToMoves(l,b)),l}_truncate(l){for(;null!==l;){const d=l._next;this._addToRemovals(this._unlink(l)),l=d}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(l,d,g){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(l);const b=l._prevRemoved,T=l._nextRemoved;return null===b?this._removalsHead=T:b._nextRemoved=T,null===T?this._removalsTail=b:T._prevRemoved=b,this._insertAfter(l,d,g),this._addToMoves(l,g),l}_moveAfter(l,d,g){return this._unlink(l),this._insertAfter(l,d,g),this._addToMoves(l,g),l}_addAfter(l,d,g){return this._insertAfter(l,d,g),this._additionsTail=null===this._additionsTail?this._additionsHead=l:this._additionsTail._nextAdded=l,l}_insertAfter(l,d,g){const b=null===d?this._itHead:d._next;return l._next=b,l._prev=d,null===b?this._itTail=l:b._prev=l,null===d?this._itHead=l:d._next=l,null===this._linkedRecords&&(this._linkedRecords=new RC),this._linkedRecords.put(l),l.currentIndex=g,l}_remove(l){return this._addToRemovals(this._unlink(l))}_unlink(l){null!==this._linkedRecords&&this._linkedRecords.remove(l);const d=l._prev,g=l._next;return null===d?this._itHead=g:d._next=g,null===g?this._itTail=d:g._prev=d,l}_addToMoves(l,d){return l.previousIndex===d||(this._movesTail=null===this._movesTail?this._movesHead=l:this._movesTail._nextMoved=l),l}_addToRemovals(l){return null===this._unlinkedRecords&&(this._unlinkedRecords=new RC),this._unlinkedRecords.put(l),l.currentIndex=null,l._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=l,l._prevRemoved=null):(l._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=l),l}_addIdentityChange(l,d){return l.item=d,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=l:this._identityChangesTail._nextIdentityChange=l,l}}class jT{constructor(l,d){this.item=l,this.trackById=d,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class $T{constructor(){this._head=null,this._tail=null}add(l){null===this._head?(this._head=this._tail=l,l._nextDup=null,l._prevDup=null):(this._tail._nextDup=l,l._prevDup=this._tail,l._nextDup=null,this._tail=l)}get(l,d){let g;for(g=this._head;null!==g;g=g._nextDup)if((null===d||d<=g.currentIndex)&&Object.is(g.trackById,l))return g;return null}remove(l){const d=l._prevDup,g=l._nextDup;return null===d?this._head=g:d._nextDup=g,null===g?this._tail=d:g._prevDup=d,null===this._head}}class RC{constructor(){this.map=new Map}put(l){const d=l.trackById;let g=this.map.get(d);g||(g=new $T,this.map.set(d,g)),g.add(l)}get(l,d){const b=this.map.get(l);return b?b.get(l,d):null}remove(l){const d=l.trackById;return this.map.get(d).remove(l)&&this.map.delete(d),l}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function OC(n,l,d){const g=n.previousIndex;if(null===g)return g;let b=0;return d&&g<d.length&&(b=d[g]),g+l+b}class kC{constructor(){}supports(l){return l instanceof Map||yt(l)}create(){return new LC}}class LC{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(l){let d;for(d=this._mapHead;null!==d;d=d._next)l(d)}forEachPreviousItem(l){let d;for(d=this._previousMapHead;null!==d;d=d._nextPrevious)l(d)}forEachChangedItem(l){let d;for(d=this._changesHead;null!==d;d=d._nextChanged)l(d)}forEachAddedItem(l){let d;for(d=this._additionsHead;null!==d;d=d._nextAdded)l(d)}forEachRemovedItem(l){let d;for(d=this._removalsHead;null!==d;d=d._nextRemoved)l(d)}diff(l){if(l){if(!(l instanceof Map||yt(l)))throw new nt(900,!1)}else l=new Map;return this.check(l)?this:null}onDestroy(){}check(l){this._reset();let d=this._mapHead;if(this._appendAfter=null,this._forEach(l,(g,b)=>{if(d&&d.key===b)this._maybeAddToChanges(d,g),this._appendAfter=d,d=d._next;else{const T=this._getOrCreateRecordForKey(b,g);d=this._insertBeforeOrAppend(d,T)}}),d){d._prev&&(d._prev._next=null),this._removalsHead=d;for(let g=d;null!==g;g=g._nextRemoved)g===this._mapHead&&(this._mapHead=null),this._records.delete(g.key),g._nextRemoved=g._next,g.previousValue=g.currentValue,g.currentValue=null,g._prev=null,g._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(l,d){if(l){const g=l._prev;return d._next=l,d._prev=g,l._prev=d,g&&(g._next=d),l===this._mapHead&&(this._mapHead=d),this._appendAfter=l,l}return this._appendAfter?(this._appendAfter._next=d,d._prev=this._appendAfter):this._mapHead=d,this._appendAfter=d,null}_getOrCreateRecordForKey(l,d){if(this._records.has(l)){const b=this._records.get(l);this._maybeAddToChanges(b,d);const T=b._prev,R=b._next;return T&&(T._next=R),R&&(R._prev=T),b._next=null,b._prev=null,b}const g=new HT(l);return this._records.set(l,g),g.currentValue=d,this._addToAdditions(g),g}_reset(){if(this.isDirty){let l;for(this._previousMapHead=this._mapHead,l=this._previousMapHead;null!==l;l=l._next)l._nextPrevious=l._next;for(l=this._changesHead;null!==l;l=l._nextChanged)l.previousValue=l.currentValue;for(l=this._additionsHead;null!=l;l=l._nextAdded)l.previousValue=l.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(l,d){Object.is(d,l.currentValue)||(l.previousValue=l.currentValue,l.currentValue=d,this._addToChanges(l))}_addToAdditions(l){null===this._additionsHead?this._additionsHead=this._additionsTail=l:(this._additionsTail._nextAdded=l,this._additionsTail=l)}_addToChanges(l){null===this._changesHead?this._changesHead=this._changesTail=l:(this._changesTail._nextChanged=l,this._changesTail=l)}_forEach(l,d){l instanceof Map?l.forEach(d):Object.keys(l).forEach(g=>d(l[g],g))}}class HT{constructor(l){this.key=l,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function FC(){return new Qw([new Jw])}let Qw=(()=>{var n;class l{constructor(g){this.factories=g}static create(g,b){if(null!=b){const T=b.factories.slice();g=g.concat(T)}return new l(g)}static extend(g){return{provide:l,useFactory:b=>l.create(g,b||FC()),deps:[[l,new Kh,new Xh]]}}find(g){const b=this.factories.find(T=>T.supports(g));if(null!=b)return b;throw new nt(901,!1)}}return(n=l).\u0275prov=An({token:n,providedIn:"root",factory:FC}),l})();function NC(){return new e1([new kC])}let e1=(()=>{var n;class l{constructor(g){this.factories=g}static create(g,b){if(b){const T=b.factories.slice();g=g.concat(T)}return new l(g)}static extend(g){return{provide:l,useFactory:b=>l.create(g,b||NC()),deps:[[l,new Kh,new Xh]]}}find(g){const b=this.factories.find(T=>T.supports(g));if(b)return b;throw new nt(901,!1)}}return(n=l).\u0275prov=An({token:n,providedIn:"root",factory:NC}),l})();const mb=xC(null,"core",[]);let VC=(()=>{var n;class l{constructor(g){}}return(n=l).\u0275fac=function(g){return new(g||n)(Jn(Kf))},n.\u0275mod=Vt({type:n}),n.\u0275inj=Vi({}),l})();function eM(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}function iM(n){const l=Cn(n);if(!l)return null;const d=new od(l);return{get selector(){return d.selector},get type(){return d.componentType},get inputs(){return d.inputs},get outputs(){return d.outputs},get ngContentSelectors(){return d.ngContentSelectors},get isStandalone(){return l.standalone},get isSignal(){return l.signals}}}},1993:(Ue,Se,te)=>{"use strict";te.d(Se,{O4:()=>Gt});var E=te(5879);class Ye extends Error{constructor(mt,gt){super(function Ge(pt,mt){return`NG0${Math.abs(pt)}${mt?": "+mt:""}`}(mt,gt)),this.code=mt}}function Gt(pt,mt){const gt=!mt?.manualCleanup;gt&&!mt?.injector&&(0,E.gHi)(Gt);const un=gt?mt?.injector?.get(E.ktI)??(0,E.f3M)(E.ktI):null;let _n;_n=(0,E.tdS)(mt?.requireSync?{kind:0}:{kind:1,value:mt?.initialValue});const oi=pt.subscribe({next:An=>_n.set({kind:1,value:An}),error:An=>_n.set({kind:2,error:An})});return un?.onDestroy(oi.unsubscribe.bind(oi)),(0,E.Flj)(()=>{const An=_n();switch(An.kind){case 1:return An.value;case 2:throw An.error;case 0:throw new Ye(601,"`toSignal()` called with `requireSync` but `Observable` did not emit synchronously.")}})}globalThis},7632:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{FT:()=>StoreDevtoolsModule});var _angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5879),_ngrx_store__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4221),rxjs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6232),rxjs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5592),rxjs__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(2096),rxjs__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(3019),rxjs__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(2381),rxjs__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(7328),rxjs_operators__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3020),rxjs_operators__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2181),rxjs_operators__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(7398),rxjs_operators__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(6328),rxjs_operators__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(5178),rxjs_operators__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(3620),rxjs_operators__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(6306),rxjs_operators__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(8180),rxjs_operators__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(9773),rxjs_operators__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(4664),rxjs_operators__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(836),rxjs_operators__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(3093),rxjs_operators__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(2460),rxjs_operators__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(6699),_angular_core_rxjs_interop__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(1993);const PERFORM_ACTION="PERFORM_ACTION",REFRESH="REFRESH",RESET="RESET",ROLLBACK="ROLLBACK",COMMIT="COMMIT",SWEEP="SWEEP",TOGGLE_ACTION="TOGGLE_ACTION",SET_ACTIONS_ACTIVE="SET_ACTIONS_ACTIVE",JUMP_TO_STATE="JUMP_TO_STATE",JUMP_TO_ACTION="JUMP_TO_ACTION",IMPORT_STATE="IMPORT_STATE",LOCK_CHANGES="LOCK_CHANGES",PAUSE_RECORDING="PAUSE_RECORDING";class PerformAction{constructor(Se,te){if(this.action=Se,this.timestamp=te,this.type=PERFORM_ACTION,typeof Se.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')}}class Refresh{constructor(){this.type=REFRESH}}class Reset{constructor(Se){this.timestamp=Se,this.type=RESET}}class Rollback{constructor(Se){this.timestamp=Se,this.type=ROLLBACK}}class Commit{constructor(Se){this.timestamp=Se,this.type=COMMIT}}class Sweep{constructor(){this.type=SWEEP}}class ToggleAction{constructor(Se){this.id=Se,this.type=TOGGLE_ACTION}}class SetActionsActive{constructor(Se,te,E=!0){this.start=Se,this.end=te,this.active=E,this.type=SET_ACTIONS_ACTIVE}}class JumpToState{constructor(Se){this.index=Se,this.type=JUMP_TO_STATE}}class JumpToAction{constructor(Se){this.actionId=Se,this.type=JUMP_TO_ACTION}}class ImportState{constructor(Se){this.nextLiftedState=Se,this.type=IMPORT_STATE}}class LockChanges{constructor(Se){this.status=Se,this.type=LOCK_CHANGES}}class PauseRecording{constructor(Se){this.status=Se,this.type=PAUSE_RECORDING}}class StoreDevtoolsConfig{constructor(){this.maxAge=!1}}const STORE_DEVTOOLS_CONFIG=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.OlP("@ngrx/store-devtools Options"),INITIAL_OPTIONS=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.OlP("@ngrx/store-devtools Initial Config");function noMonitor(){return null}const DEFAULT_NAME="NgRx Store DevTools";function createConfig(Ue){const Se={maxAge:!1,monitor:noMonitor,actionSanitizer:void 0,stateSanitizer:void 0,name:DEFAULT_NAME,serialize:!1,logOnly:!1,autoPause:!1,trace:!1,traceLimit:75,features:{pause:!0,lock:!0,persist:!0,export:!0,import:"custom",jump:!0,skip:!0,reorder:!0,dispatch:!0,test:!0},connectOutsideZone:!1},te="function"==typeof Ue?Ue():Ue,Be=te.features||!!te.logOnly&&{pause:!0,export:!0,test:!0}||Se.features;!0===Be.import&&(Be.import="custom");const it=Object.assign({},Se,{features:Be},te);if(it.maxAge&&it.maxAge<2)throw new Error(`Devtools 'maxAge' cannot be less than 2, got ${it.maxAge}`);return it}function difference(Ue,Se){return Ue.filter(te=>Se.indexOf(te)<0)}function unliftState(Ue){const{computedStates:Se,currentStateIndex:te}=Ue;if(te>=Se.length){const{state:Be}=Se[Se.length-1];return Be}const{state:E}=Se[te];return E}function unliftAction(Ue){return Ue.actionsById[Ue.nextActionId-1]}function liftAction(Ue){return new PerformAction(Ue,+Date.now())}function sanitizeActions(Ue,Se){return Object.keys(Se).reduce((te,E)=>{const Be=Number(E);return te[Be]=sanitizeAction(Ue,Se[Be],Be),te},{})}function sanitizeAction(Ue,Se,te){return{...Se,action:Ue(Se.action,te)}}function sanitizeStates(Ue,Se){return Se.map((te,E)=>({state:sanitizeState(Ue,te.state,E),error:te.error}))}function sanitizeState(Ue,Se,te){return Ue(Se,te)}function shouldFilterActions(Ue){return Ue.predicate||Ue.actionsSafelist||Ue.actionsBlocklist}function filterLiftedState(Ue,Se,te,E){const Be=[],it={},p=[];return Ue.stagedActionIds.forEach((ue,Ye)=>{const Ge=Ue.actionsById[ue];Ge&&(Ye&&isActionFiltered(Ue.computedStates[Ye],Ge,Se,te,E)||(it[ue]=Ge,Be.push(ue),p.push(Ue.computedStates[Ye])))}),{...Ue,stagedActionIds:Be,actionsById:it,computedStates:p}}function isActionFiltered(Ue,Se,te,E,Be){const it=te&&!te(Ue,Se.action),p=E&&!Se.action.type.match(E.map(Ye=>escapeRegExp(Ye)).join("|")),ue=Be&&Se.action.type.match(Be.map(Ye=>escapeRegExp(Ye)).join("|"));return it||p||ue}function escapeRegExp(Ue){return Ue.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function injectZoneConfig(Ue){return{ngZone:Ue?(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.f3M)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.R0b):null,connectOutsideZone:Ue}}let DevtoolsDispatcher=(()=>{var Ue;class Se extends _ngrx_store__WEBPACK_IMPORTED_MODULE_1__.UO{}return(Ue=Se).\u0275fac=function(){let te;return function(Be){return(te||(te=_angular_core__WEBPACK_IMPORTED_MODULE_0__.n5z(Ue)))(Be||Ue)}}(),Ue.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yz7({token:Ue,factory:Ue.\u0275fac}),Se})();const ExtensionActionTypes={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},REDUX_DEVTOOLS_EXTENSION=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.OlP("@ngrx/store-devtools Redux Devtools Extension");let DevtoolsExtension=(()=>{var _class2;class DevtoolsExtension{constructor(Ue,Se,te){this.config=Se,this.dispatcher=te,this.zoneConfig=injectZoneConfig(this.config.connectOutsideZone),this.devtoolsExtension=Ue,this.createActionStreams()}notify(Ue,Se){if(this.devtoolsExtension)if(Ue.type===PERFORM_ACTION){if(Se.isLocked||Se.isPaused)return;const te=unliftState(Se);if(shouldFilterActions(this.config)&&isActionFiltered(te,Ue,this.config.predicate,this.config.actionsSafelist,this.config.actionsBlocklist))return;const E=this.config.stateSanitizer?sanitizeState(this.config.stateSanitizer,te,Se.currentStateIndex):te,Be=this.config.actionSanitizer?sanitizeAction(this.config.actionSanitizer,Ue,Se.nextActionId):Ue;this.sendToReduxDevtools(()=>this.extensionConnection.send(Be,E))}else{const te={...Se,stagedActionIds:Se.stagedActionIds,actionsById:this.config.actionSanitizer?sanitizeActions(this.config.actionSanitizer,Se.actionsById):Se.actionsById,computedStates:this.config.stateSanitizer?sanitizeStates(this.config.stateSanitizer,Se.computedStates):Se.computedStates};this.sendToReduxDevtools(()=>this.devtoolsExtension.send(null,te,this.getExtensionConfig(this.config)))}}createChangesObservable(){return this.devtoolsExtension?new rxjs__WEBPACK_IMPORTED_MODULE_3__.y(Ue=>{const Se=this.zoneConfig.connectOutsideZone?this.zoneConfig.ngZone.runOutsideAngular(()=>this.devtoolsExtension.connect(this.getExtensionConfig(this.config))):this.devtoolsExtension.connect(this.getExtensionConfig(this.config));return this.extensionConnection=Se,Se.init(),Se.subscribe(te=>Ue.next(te)),Se.unsubscribe}):rxjs__WEBPACK_IMPORTED_MODULE_2__.E}createActionStreams(){const Ue=this.createChangesObservable().pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_4__.B)()),Se=Ue.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(ue=>ue.type===ExtensionActionTypes.START)),te=Ue.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(ue=>ue.type===ExtensionActionTypes.STOP)),E=Ue.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(ue=>ue.type===ExtensionActionTypes.DISPATCH),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(ue=>this.unwrapAction(ue.payload)),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_7__.b)(ue=>ue.type===IMPORT_STATE?this.dispatcher.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(Ye=>Ye.type===_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.wb),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_8__.V)(1e3),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_9__.b)(1e3),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(()=>ue),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_10__.K)(()=>(0,rxjs__WEBPACK_IMPORTED_MODULE_11__.of)(ue)),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_12__.q)(1)):(0,rxjs__WEBPACK_IMPORTED_MODULE_11__.of)(ue))),it=Ue.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(ue=>ue.type===ExtensionActionTypes.ACTION),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(ue=>this.unwrapAction(ue.payload))).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_13__.R)(te)),p=E.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_13__.R)(te));this.start$=Se.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_13__.R)(te)),this.actions$=this.start$.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_14__.w)(()=>it)),this.liftedActions$=this.start$.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_14__.w)(()=>p))}unwrapAction(action){return"string"==typeof action?eval(`(${action})`):action}getExtensionConfig(Ue){const Se={name:Ue.name,features:Ue.features,serialize:Ue.serialize,autoPause:Ue.autoPause??!1,trace:Ue.trace??!1,traceLimit:Ue.traceLimit??75};return!1!==Ue.maxAge&&(Se.maxAge=Ue.maxAge),Se}sendToReduxDevtools(Ue){try{Ue()}catch(Se){console.warn("@ngrx/store-devtools: something went wrong inside the redux devtools",Se)}}}return _class2=DevtoolsExtension,_class2.\u0275fac=function Ue(Se){return new(Se||_class2)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(REDUX_DEVTOOLS_EXTENSION),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(STORE_DEVTOOLS_CONFIG),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(DevtoolsDispatcher))},_class2.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yz7({token:_class2,factory:_class2.\u0275fac}),DevtoolsExtension})();const INIT_ACTION={type:_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.qg},RECOMPUTE="@ngrx/store-devtools/recompute",RECOMPUTE_ACTION={type:RECOMPUTE};function computeNextEntry(Ue,Se,te,E,Be){if(E)return{state:te,error:"Interrupted by an error up the chain"};let p,it=te;try{it=Ue(te,Se)}catch(ue){p=ue.toString(),Be.handleError(ue)}return{state:it,error:p}}function recomputeStates(Ue,Se,te,E,Be,it,p,ue,Ye){if(Se>=Ue.length&&Ue.length===it.length)return Ue;const Ge=Ue.slice(0,Se),Le=it.length-(Ye?1:0);for(let Ie=Se;Ie<Le;Ie++){const ke=it[Ie],$e=Be[ke].action,Qe=Ge[Ie-1],Tt=Qe?Qe.state:E,Wt=Qe?Qe.error:void 0,Pt=p.indexOf(ke)>-1?Qe:computeNextEntry(te,$e,Tt,Wt,ue);Ge.push(Pt)}return Ye&&Ge.push(Ue[Ue.length-1]),Ge}function liftInitialState(Ue,Se){return{monitorState:Se(void 0,{}),nextActionId:1,actionsById:{0:liftAction(INIT_ACTION)},stagedActionIds:[0],skippedActionIds:[],committedState:Ue,currentStateIndex:0,computedStates:[],isLocked:!1,isPaused:!1}}function liftReducerWith(Ue,Se,te,E,Be={}){return it=>(p,ue)=>{let{monitorState:Ye,actionsById:Ge,nextActionId:Le,stagedActionIds:Ie,skippedActionIds:ke,committedState:$e,currentStateIndex:Qe,computedStates:Tt,isLocked:Wt,isPaused:nn}=p||Se;function Pt(Dn){let pn=Dn,nt=Ie.slice(1,pn+1);for(let Ne=0;Ne<nt.length;Ne++){if(Tt[Ne+1].error){pn=Ne,nt=Ie.slice(1,pn+1);break}delete Ge[nt[Ne]]}ke=ke.filter(Ne=>-1===nt.indexOf(Ne)),Ie=[0,...Ie.slice(pn+1)],$e=Tt[pn].state,Tt=Tt.slice(pn),Qe=Qe>pn?Qe-pn:0}function En(){Ge={0:liftAction(INIT_ACTION)},Le=1,Ie=[0],ke=[],$e=Tt[Qe].state,Qe=0,Tt=[]}p||(Ge=Object.create(Ge));let cn=0;switch(ue.type){case LOCK_CHANGES:Wt=ue.status,cn=1/0;break;case PAUSE_RECORDING:nn=ue.status,nn?(Ie=[...Ie,Le],Ge[Le]=new PerformAction({type:"@ngrx/devtools/pause"},+Date.now()),Le++,cn=Ie.length-1,Tt=Tt.concat(Tt[Tt.length-1]),Qe===Ie.length-2&&Qe++,cn=1/0):En();break;case RESET:Ge={0:liftAction(INIT_ACTION)},Le=1,Ie=[0],ke=[],$e=Ue,Qe=0,Tt=[];break;case COMMIT:En();break;case ROLLBACK:Ge={0:liftAction(INIT_ACTION)},Le=1,Ie=[0],ke=[],Qe=0,Tt=[];break;case TOGGLE_ACTION:{const{id:Dn}=ue;ke=-1===ke.indexOf(Dn)?[Dn,...ke]:ke.filter(nt=>nt!==Dn),cn=Ie.indexOf(Dn);break}case SET_ACTIONS_ACTIVE:{const{start:Dn,end:pn,active:nt}=ue,Ne=[];for(let Ft=Dn;Ft<pn;Ft++)Ne.push(Ft);ke=nt?difference(ke,Ne):[...ke,...Ne],cn=Ie.indexOf(Dn);break}case JUMP_TO_STATE:Qe=ue.index,cn=1/0;break;case JUMP_TO_ACTION:{const Dn=Ie.indexOf(ue.actionId);-1!==Dn&&(Qe=Dn),cn=1/0;break}case SWEEP:Ie=difference(Ie,ke),ke=[],Qe=Math.min(Qe,Ie.length-1);break;case PERFORM_ACTION:{if(Wt)return p||Se;if(nn||p&&isActionFiltered(p.computedStates[Qe],ue,Be.predicate,Be.actionsSafelist,Be.actionsBlocklist)){const pn=Tt[Tt.length-1];Tt=[...Tt.slice(0,-1),computeNextEntry(it,ue.action,pn.state,pn.error,te)],cn=1/0;break}Be.maxAge&&Ie.length===Be.maxAge&&Pt(1),Qe===Ie.length-1&&Qe++;const Dn=Le++;Ge[Dn]=ue,Ie=[...Ie,Dn],cn=Ie.length-1;break}case IMPORT_STATE:({monitorState:Ye,actionsById:Ge,nextActionId:Le,stagedActionIds:Ie,skippedActionIds:ke,committedState:$e,currentStateIndex:Qe,computedStates:Tt,isLocked:Wt,isPaused:nn}=ue.nextLiftedState);break;case _ngrx_store__WEBPACK_IMPORTED_MODULE_1__.qg:cn=0,Be.maxAge&&Ie.length>Be.maxAge&&(Tt=recomputeStates(Tt,cn,it,$e,Ge,Ie,ke,te,nn),Pt(Ie.length-Be.maxAge),cn=1/0);break;case _ngrx_store__WEBPACK_IMPORTED_MODULE_1__.wb:if(Tt.filter(pn=>pn.error).length>0)cn=0,Be.maxAge&&Ie.length>Be.maxAge&&(Tt=recomputeStates(Tt,cn,it,$e,Ge,Ie,ke,te,nn),Pt(Ie.length-Be.maxAge),cn=1/0);else{if(!nn&&!Wt){Qe===Ie.length-1&&Qe++;const pn=Le++;Ge[pn]=new PerformAction(ue,+Date.now()),Ie=[...Ie,pn],cn=Ie.length-1,Tt=recomputeStates(Tt,cn,it,$e,Ge,Ie,ke,te,nn)}Tt=Tt.map(pn=>({...pn,state:it(pn.state,RECOMPUTE_ACTION)})),Qe=Ie.length-1,Be.maxAge&&Ie.length>Be.maxAge&&Pt(Ie.length-Be.maxAge),cn=1/0}break;default:cn=1/0}return Tt=recomputeStates(Tt,cn,it,$e,Ge,Ie,ke,te,nn),Ye=E(Ye,ue),{monitorState:Ye,actionsById:Ge,nextActionId:Le,stagedActionIds:Ie,skippedActionIds:ke,committedState:$e,currentStateIndex:Qe,computedStates:Tt,isLocked:Wt,isPaused:nn}}}let StoreDevtools=(()=>{var Ue;class Se{constructor(E,Be,it,p,ue,Ye,Ge,Le){const Ie=liftInitialState(Ge,Le.monitor),ke=liftReducerWith(Ge,Ie,Ye,Le.monitor,Le),$e=(0,rxjs__WEBPACK_IMPORTED_MODULE_15__.T)((0,rxjs__WEBPACK_IMPORTED_MODULE_15__.T)(Be.asObservable().pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_16__.T)(1)),p.actions$).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(liftAction)),E,p.liftedActions$).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_17__.Q)(rxjs__WEBPACK_IMPORTED_MODULE_18__.N)),Qe=it.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(ke)),Tt=injectZoneConfig(Le.connectOutsideZone),Wt=new rxjs__WEBPACK_IMPORTED_MODULE_19__.t(1);this.liftedStateSubscription=$e.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_20__.M)(Qe),emitInZone(Tt),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_21__.R)(({state:En},[cn,Dn])=>{let pn=Dn(En,cn);return cn.type!==PERFORM_ACTION&&shouldFilterActions(Le)&&(pn=filterLiftedState(pn,Le.predicate,Le.actionsSafelist,Le.actionsBlocklist)),p.notify(cn,pn),{state:pn,action:cn}},{state:Ie,action:null})).subscribe(({state:En,action:cn})=>{Wt.next(En),cn.type===PERFORM_ACTION&&ue.next(cn.action)}),this.extensionStartSubscription=p.start$.pipe(emitInZone(Tt)).subscribe(()=>{this.refresh()});const nn=Wt.asObservable(),Pt=nn.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(unliftState));Object.defineProperty(Pt,"state",{value:(0,_angular_core_rxjs_interop__WEBPACK_IMPORTED_MODULE_22__.O4)(Pt,{manualCleanup:!0,requireSync:!0})}),this.dispatcher=E,this.liftedState=nn,this.state=Pt}ngOnDestroy(){this.liftedStateSubscription.unsubscribe(),this.extensionStartSubscription.unsubscribe()}dispatch(E){this.dispatcher.next(E)}next(E){this.dispatcher.next(E)}error(E){}complete(){}performAction(E){this.dispatch(new PerformAction(E,+Date.now()))}refresh(){this.dispatch(new Refresh)}reset(){this.dispatch(new Reset(+Date.now()))}rollback(){this.dispatch(new Rollback(+Date.now()))}commit(){this.dispatch(new Commit(+Date.now()))}sweep(){this.dispatch(new Sweep)}toggleAction(E){this.dispatch(new ToggleAction(E))}jumpToAction(E){this.dispatch(new JumpToAction(E))}jumpToState(E){this.dispatch(new JumpToState(E))}importState(E){this.dispatch(new ImportState(E))}lockChanges(E){this.dispatch(new LockChanges(E))}pauseRecording(E){this.dispatch(new PauseRecording(E))}}return(Ue=Se).\u0275fac=function(E){return new(E||Ue)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(DevtoolsDispatcher),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.UO),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.n$),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(DevtoolsExtension),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.Y$),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_angular_core__WEBPACK_IMPORTED_MODULE_0__.qLn),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.Y6),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(STORE_DEVTOOLS_CONFIG))},Ue.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yz7({token:Ue,factory:Ue.\u0275fac}),Se})();function emitInZone({ngZone:Ue,connectOutsideZone:Se}){return te=>Se?new rxjs__WEBPACK_IMPORTED_MODULE_3__.y(E=>te.subscribe({next:Be=>Ue.run(()=>E.next(Be)),error:Be=>Ue.run(()=>E.error(Be)),complete:()=>Ue.run(()=>E.complete())})):te}const IS_EXTENSION_OR_MONITOR_PRESENT=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.OlP("@ngrx/store-devtools Is Devtools Extension or Monitor Present");function createIsExtensionOrMonitorPresent(Ue,Se){return!!Ue||Se.monitor!==noMonitor}function createReduxDevtoolsExtension(){const Ue="__REDUX_DEVTOOLS_EXTENSION__";return"object"==typeof window&&typeof window[Ue]<"u"?window[Ue]:null}function provideStoreDevtools(Ue={}){return(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.MR2)([DevtoolsExtension,DevtoolsDispatcher,StoreDevtools,{provide:INITIAL_OPTIONS,useValue:Ue},{provide:IS_EXTENSION_OR_MONITOR_PRESENT,deps:[REDUX_DEVTOOLS_EXTENSION,STORE_DEVTOOLS_CONFIG],useFactory:createIsExtensionOrMonitorPresent},{provide:REDUX_DEVTOOLS_EXTENSION,useFactory:createReduxDevtoolsExtension},{provide:STORE_DEVTOOLS_CONFIG,deps:[INITIAL_OPTIONS],useFactory:createConfig},{provide:_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.FR,deps:[StoreDevtools],useFactory:createStateObservable},{provide:_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.mK,useExisting:DevtoolsDispatcher}])}function createStateObservable(Ue){return Ue.state}let StoreDevtoolsModule=(()=>{var Ue;class Se{static instrument(E={}){return{ngModule:Se,providers:[provideStoreDevtools(E)]}}}return(Ue=Se).\u0275fac=function(E){return new(E||Ue)},Ue.\u0275mod=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oAB({type:Ue}),Ue.\u0275inj=_angular_core__WEBPACK_IMPORTED_MODULE_0__.cJS({}),Se})()},4221:(Ue,Se,te)=>{"use strict";te.d(Se,{UO:()=>Yt,qg:()=>kt,Y6:()=>Mo,mK:()=>So,n$:()=>po,Y$:()=>ri,FR:()=>Io,yh:()=>os,CK:()=>la,Aw:()=>as,cr:()=>cl,wb:()=>Bl,PH:()=>nn,ZF:()=>Xi,Lq:()=>Yo,P1:()=>Jn,on:()=>Qi,Ky:()=>Pt});var E=te(5879),Be=te(5619),it=te(5592),p=te(8645),ue=te(2381),Ye=te(3093),Ge=te(2460),Le=te(6699),Ie=te(7398),$e=te(3997),Qe=te(1993);const Tt={};function nn(_e,st){if(Tt[_e]=(Tt[_e]||0)+1,"function"==typeof st)return cn(_e,(...qe)=>({...st(...qe),type:_e}));switch(st?st._as:"empty"){case"empty":return cn(_e,()=>({type:_e}));case"props":return cn(_e,qe=>({...qe,type:_e}));default:throw new Error("Unexpected config.")}}function Pt(){return{_as:"props",_p:void 0}}function cn(_e,st){return Object.defineProperty(st,"type",{value:_e,writable:!1})}const kt="@ngrx/store/init";let Yt=(()=>{var _e;class st extends Be.X{constructor(){super({type:kt})}next(qe){if("function"==typeof qe)throw new TypeError("\n        Dispatch expected an object, instead it received a function.\n        If you're using the createAction function, make sure to invoke the function\n        before dispatching the action. For example, someAction should be someAction().");if(typeof qe>"u")throw new TypeError("Actions must be objects");if(typeof qe.type>"u")throw new TypeError("Actions must have a type property");super.next(qe)}complete(){}ngOnDestroy(){super.complete()}}return(_e=st).\u0275fac=function(qe){return new(qe||_e)},_e.\u0275prov=E.Yz7({token:_e,factory:_e.\u0275fac}),st})();const ui=[Yt],mi=new E.OlP("@ngrx/store Internal Root Guard"),ir=new E.OlP("@ngrx/store Internal Initial State"),Mo=new E.OlP("@ngrx/store Initial State"),Wn=new E.OlP("@ngrx/store Reducer Factory"),$s=new E.OlP("@ngrx/store Internal Reducer Factory Provider"),Ci=new E.OlP("@ngrx/store Initial Reducers"),dr=new E.OlP("@ngrx/store Internal Initial Reducers"),Hs=new E.OlP("@ngrx/store Store Features"),ot=new E.OlP("@ngrx/store Internal Store Reducers"),ut=new E.OlP("@ngrx/store Internal Feature Reducers"),xt=new E.OlP("@ngrx/store Internal Feature Configs"),bt=new E.OlP("@ngrx/store Internal Store Features"),Gt=new E.OlP("@ngrx/store Internal Feature Reducers Token"),pt=new E.OlP("@ngrx/store Feature Reducers"),mt=new E.OlP("@ngrx/store User Provided Meta Reducers"),gt=new E.OlP("@ngrx/store Meta Reducers"),un=new E.OlP("@ngrx/store Internal Resolved Meta Reducers"),_n=new E.OlP("@ngrx/store User Runtime Checks Config"),oi=new E.OlP("@ngrx/store Internal User Runtime Checks Config"),An=new E.OlP("@ngrx/store Internal Runtime Checks"),qn=new E.OlP("@ngrx/store Check if Action types are unique");function Ii(_e,st={}){const Et=Object.keys(_e),qe={};for(let en=0;en<Et.length;en++){const Gn=Et[en];"function"==typeof _e[Gn]&&(qe[Gn]=_e[Gn])}const Vt=Object.keys(qe);return function(Gn,or){Gn=void 0===Gn?st:Gn;let Zi=!1;const Cn={};for(let xn=0;xn<Vt.length;xn++){const $i=Vt[xn],qi=Gn[$i],yo=(0,qe[$i])(qi,or);Cn[$i]=yo,Zi=Zi||yo!==qi}return Zi?Cn:Gn}}function Wo(..._e){return function(st){if(0===_e.length)return st;const Et=_e[_e.length-1];return _e.slice(0,-1).reduceRight((Vt,en)=>en(Vt),Et(st))}}function ws(_e,st){return Array.isArray(st)&&st.length>0&&(_e=Wo.apply(null,[...st,_e])),(Et,qe)=>{const Vt=_e(Et);return(en,Gn)=>Vt(en=void 0===en?qe:en,Gn)}}new E.OlP("@ngrx/store Root Store Provider"),new E.OlP("@ngrx/store Feature State Provider");class po extends it.y{}class So extends Yt{}const Bl="@ngrx/store/update-reducers";let Un=(()=>{var _e;class st extends Be.X{get currentReducers(){return this.reducers}constructor(qe,Vt,en,Gn){super(Gn(en,Vt)),this.dispatcher=qe,this.initialState=Vt,this.reducers=en,this.reducerFactory=Gn}addFeature(qe){this.addFeatures([qe])}addFeatures(qe){const Vt=qe.reduce((en,{reducers:Gn,reducerFactory:or,metaReducers:Zi,initialState:Cn,key:xn})=>{const $i="function"==typeof Gn?function aa(_e){const st=Array.isArray(_e)&&_e.length>0?Wo(..._e):Et=>Et;return(Et,qe)=>(Et=st(Et),(Vt,en)=>Et(Vt=void 0===Vt?qe:Vt,en))}(Zi)(Gn,Cn):ws(or,Zi)(Gn,Cn);return en[xn]=$i,en},{});this.addReducers(Vt)}removeFeature(qe){this.removeFeatures([qe])}removeFeatures(qe){this.removeReducers(qe.map(Vt=>Vt.key))}addReducer(qe,Vt){this.addReducers({[qe]:Vt})}addReducers(qe){this.reducers={...this.reducers,...qe},this.updateReducers(Object.keys(qe))}removeReducer(qe){this.removeReducers([qe])}removeReducers(qe){qe.forEach(Vt=>{this.reducers=function rr(_e,st){return Object.keys(_e).filter(Et=>Et!==st).reduce((Et,qe)=>Object.assign(Et,{[qe]:_e[qe]}),{})}(this.reducers,Vt)}),this.updateReducers(qe)}updateReducers(qe){this.next(this.reducerFactory(this.reducers,this.initialState)),this.dispatcher.next({type:Bl,features:qe})}ngOnDestroy(){this.complete()}}return(_e=st).\u0275fac=function(qe){return new(qe||_e)(E.LFG(So),E.LFG(Mo),E.LFG(Ci),E.LFG(Wn))},_e.\u0275prov=E.Yz7({token:_e,factory:_e.\u0275fac}),st})();const ni=[Un,{provide:po,useExisting:Un},{provide:So,useExisting:Yt}];let ri=(()=>{var _e;class st extends p.x{ngOnDestroy(){this.complete()}}return(_e=st).\u0275fac=function(){let Et;return function(Vt){return(Et||(Et=E.n5z(_e)))(Vt||_e)}}(),_e.\u0275prov=E.Yz7({token:_e,factory:_e.\u0275fac}),st})();const zr=[ri];class Io extends it.y{}let mo=(()=>{var _e;class st extends Be.X{constructor(qe,Vt,en,Gn){super(Gn);const xn=qe.pipe((0,Ye.Q)(ue.N)).pipe((0,Ge.M)(Vt)).pipe((0,Le.R)(Ui,{state:Gn}));this.stateSubscription=xn.subscribe(({state:$i,action:Xo})=>{this.next($i),en.next(Xo)}),this.state=(0,Qe.O4)(this,{manualCleanup:!0,requireSync:!0})}ngOnDestroy(){this.stateSubscription.unsubscribe(),this.complete()}}return(_e=st).INIT=kt,_e.\u0275fac=function(qe){return new(qe||_e)(E.LFG(Yt),E.LFG(po),E.LFG(ri),E.LFG(Mo))},_e.\u0275prov=E.Yz7({token:_e,factory:_e.\u0275fac}),st})();function Ui(_e={state:void 0},[st,Et]){const{state:qe}=_e;return{state:Et(qe,st),action:st}}const Kr=[mo,{provide:Io,useExisting:mo}];let os=(()=>{var _e;class st extends it.y{constructor(qe,Vt,en){super(),this.actionsObserver=Vt,this.reducerManager=en,this.source=qe,this.state=qe.state}select(qe,...Vt){return Gs.call(null,qe,...Vt)(this)}selectSignal(qe,Vt){return(0,E.Flj)(()=>qe(this.state()),{equal:Vt?.equal||((en,Gn)=>en===Gn)})}lift(qe){const Vt=new st(this,this.actionsObserver,this.reducerManager);return Vt.operator=qe,Vt}dispatch(qe){this.actionsObserver.next(qe)}next(qe){this.actionsObserver.next(qe)}error(qe){this.actionsObserver.error(qe)}complete(){this.actionsObserver.complete()}addReducer(qe,Vt){this.reducerManager.addReducer(qe,Vt)}removeReducer(qe){this.reducerManager.removeReducer(qe)}}return(_e=st).\u0275fac=function(qe){return new(qe||_e)(E.LFG(Io),E.LFG(Yt),E.LFG(Un))},_e.\u0275prov=E.Yz7({token:_e,factory:_e.\u0275fac}),st})();const ji=[os];function Gs(_e,st,...Et){return function(Vt){let en;if("string"==typeof _e){const Gn=[st,...Et].filter(Boolean);en=Vt.pipe(function ke(..._e){const st=_e.length;if(0===st)throw new Error("list of properties cannot be empty.");return(0,Ie.U)(Et=>{let qe=Et;for(let Vt=0;Vt<st;Vt++){const en=qe?.[_e[Vt]];if(!(typeof en<"u"))return;qe=en}return qe})}(_e,...Gn))}else{if("function"!=typeof _e)throw new TypeError(`Unexpected type '${typeof _e}' in select operator, expected 'string' or 'function'`);en=Vt.pipe((0,Ie.U)(Gn=>_e(Gn,st)))}return en.pipe((0,$e.x)())}}const bi="https://ngrx.io/guide/store/configuration/runtime-checks";function Oa(_e){return void 0===_e}function ye(_e){return null===_e}function Q(_e){return Array.isArray(_e)}function Re(_e){return"object"==typeof _e&&null!==_e}function Pe(_e){return"function"==typeof _e}let Zt=!1;function Nn(_e,st){return _e===st}function Qn(_e,st=Nn,Et=Nn){let en,qe=null,Vt=null;return{memoized:function Cn(){if(void 0!==en)return en.result;if(!qe)return Vt=_e.apply(null,arguments),qe=arguments,Vt;if(!function Yn(_e,st,Et){for(let qe=0;qe<_e.length;qe++)if(!Et(_e[qe],st[qe]))return!0;return!1}(arguments,qe,st))return Vt;const xn=_e.apply(null,arguments);return qe=arguments,Et(Vt,xn)?Vt:(Vt=xn,xn)},reset:function Gn(){qe=null,Vt=null},setResult:function or(xn=void 0){en={result:xn}},clearResult:function Zi(){en=void 0}}}function Jn(..._e){return function si(_e,st={stateFn:fr}){return function(...Et){let qe=Et;if(Array.isArray(qe[0])){const[xn,...$i]=qe;qe=[...xn,...$i]}else 1===qe.length&&function Ao(_e){return!!_e&&"object"==typeof _e&&Object.values(_e).every(st=>"function"==typeof st)}(qe[0])&&(qe=function pr(_e){const st=Object.values(_e),Et=Object.keys(_e);return[...st,(...Vt)=>Et.reduce((en,Gn,or)=>({...en,[Gn]:Vt[or]}),{})]}(qe[0]));const Vt=qe.slice(0,qe.length-1),en=qe[qe.length-1],Gn=Vt.filter(xn=>xn.release&&"function"==typeof xn.release),or=_e(function(...xn){return en.apply(null,xn)}),Zi=Qn(function(xn,$i){return st.stateFn.apply(null,[xn,Vt,$i,or])});return Object.assign(Zi.memoized,{release:function Cn(){Zi.reset(),or.reset(),Gn.forEach(xn=>xn.release())},projector:or.memoized,setResult:Zi.setResult,clearResult:Zi.clearResult})}}(Qn)(..._e)}function fr(_e,st,Et,qe){if(void 0===Et){const en=st.map(Gn=>Gn(_e));return qe.memoized.apply(null,en)}const Vt=st.map(en=>en(_e,Et));return qe.memoized.apply(null,[...Vt,Et])}function Xi(_e){return Jn(st=>{const Et=st[_e];return!function Zn(){return Zt}()&&(0,E.X6Q)()&&!(_e in st)&&console.warn(`@ngrx/store: The feature name "${_e}" does not exist in the state, therefore createFeatureSelector cannot access it.  Be sure it is imported in a loaded module using StoreModule.forRoot('${_e}', ...) or StoreModule.forFeature('${_e}', ...).  If the default state is intended to be undefined, as is the case with router state, this development-only warning message can be ignored.`),Et},st=>st)}function Es(_e){return _e instanceof E.OlP?(0,E.f3M)(_e):_e}function pi(_e,st){return st.map((Et,qe)=>{if(_e[qe]instanceof E.OlP){const Vt=(0,E.f3M)(_e[qe]);return{key:Et.key,reducerFactory:Vt.reducerFactory?Vt.reducerFactory:Ii,metaReducers:Vt.metaReducers?Vt.metaReducers:[],initialState:Vt.initialState}}return Et})}function Cs(_e){return _e.map(st=>st instanceof E.OlP?(0,E.f3M)(st):st)}function Qr(_e){return"function"==typeof _e?_e():_e}function xi(_e,st){return _e.concat(st)}function Ws(){if((0,E.f3M)(os,{optional:!0,skipSelf:!0}))throw new TypeError("The root Store has been provided more than once. Feature modules should provide feature states instead.");return"guarded"}function _o(_e){Object.freeze(_e);const st=Pe(_e);return Object.getOwnPropertyNames(_e).forEach(Et=>{if(!Et.startsWith("\u0275")&&function $t(_e,st){return Object.prototype.hasOwnProperty.call(_e,st)}(_e,Et)&&(!st||"caller"!==Et&&"callee"!==Et&&"arguments"!==Et)){const qe=_e[Et];(Re(qe)||Pe(qe))&&!Object.isFrozen(qe)&&_o(qe)}}),_e}function Zo(_e,st=[]){return(Oa(_e)||ye(_e))&&0===st.length?{path:["root"],value:_e}:Object.keys(_e).reduce((qe,Vt)=>{if(qe)return qe;const en=_e[Vt];return function et(_e){return Pe(_e)&&_e.hasOwnProperty("\u0275cmp")}(en)?qe:!(Oa(en)||ye(en)||function Ce(_e){return"number"==typeof _e}(en)||function ge(_e){return"boolean"==typeof _e}(en)||function ie(_e){return"string"==typeof _e}(en)||Q(en))&&(function je(_e){if(!function We(_e){return Re(_e)&&!Q(_e)}(_e))return!1;const st=Object.getPrototypeOf(_e);return st===Object.prototype||null===st}(en)?Zo(en,[...st,Vt]):{path:[...st,Vt],value:en})},!1)}function Po(_e,st){if(!1===_e)return;const Et=_e.path.join("."),qe=new Error(`Detected unserializable ${st} at "${Et}". ${bi}#strict${st}serializability`);throw qe.value=_e.value,qe.unserializablePath=Et,qe}function ka(_e){return(0,E.X6Q)()?{strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!0,strictActionImmutability:!0,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1,..._e}:{strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!1,strictActionImmutability:!1,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1}}function lt({strictActionSerializability:_e,strictStateSerializability:st}){return Et=>_e||st?function gc(_e,st){return function(Et,qe){st.action(qe)&&Po(Zo(qe),"action");const Vt=_e(Et,qe);return st.state()&&Po(Zo(Vt),"state"),Vt}}(Et,{action:qe=>_e&&!Ji(qe),state:()=>st}):Et}function Ds({strictActionImmutability:_e,strictStateImmutability:st}){return Et=>_e||st?function go(_e,st){return function(Et,qe){const Vt=st.action(qe)?_o(qe):qe,en=_e(Et,Vt);return st.state()?_o(en):en}}(Et,{action:qe=>_e&&!Ji(qe),state:()=>st}):Et}function Ji(_e){return _e.type.startsWith("@ngrx")}function mr({strictActionWithinNgZone:_e}){return st=>_e?function qo(_e,st){return function(Et,qe){if(st.action(qe)&&!E.R0b.isInAngularZone())throw new Error(`Action '${qe.type}' running outside NgZone. ${bi}#strictactionwithinngzone`);return _e(Et,qe)}}(st,{action:Et=>_e&&!Ji(Et)}):st}function _c(_e){return[{provide:oi,useValue:_e},{provide:_n,useFactory:fd,deps:[oi]},{provide:An,deps:[_n],useFactory:ka},{provide:gt,multi:!0,deps:[An],useFactory:Ds},{provide:gt,multi:!0,deps:[An],useFactory:lt},{provide:gt,multi:!0,deps:[An],useFactory:mr}]}function Ro(){return[{provide:qn,multi:!0,deps:[An],useFactory:La}]}function fd(_e){return _e}function La(_e){if(!_e.strictActionTypeUniqueness)return;const st=Object.entries(Tt).filter(([,Et])=>Et>1).map(([Et])=>Et);if(st.length)throw new Error(`Action types are registered more than once, ${st.map(Et=>`"${Et}"`).join(", ")}. ${bi}#strictactiontypeuniqueness`)}function Jt(_e={},st={}){return[{provide:mi,useFactory:Ws},{provide:ir,useValue:st.initialState},{provide:Mo,useFactory:Qr,deps:[ir]},{provide:dr,useValue:_e},{provide:ot,useExisting:_e instanceof E.OlP?_e:dr},{provide:Ci,deps:[dr,[new E.tBr(ot)]],useFactory:Es},{provide:mt,useValue:st.metaReducers?st.metaReducers:[]},{provide:un,deps:[gt,mt],useFactory:xi},{provide:$s,useValue:st.reducerFactory?st.reducerFactory:Ii},{provide:Wn,deps:[$s,un],useFactory:ws},ui,ni,zr,Kr,ji,_c(st.runtimeChecks),Ro()]}function so(_e,st,Et={}){return[{provide:xt,multi:!0,useValue:_e instanceof Object?{}:Et},{provide:Hs,multi:!0,useValue:{key:_e instanceof Object?_e.name:_e,reducerFactory:Et instanceof E.OlP||!Et.reducerFactory?Ii:Et.reducerFactory,metaReducers:Et instanceof E.OlP||!Et.metaReducers?[]:Et.metaReducers,initialState:Et instanceof E.OlP||!Et.initialState?void 0:Et.initialState}},{provide:bt,deps:[xt,Hs],useFactory:pi},{provide:ut,multi:!0,useValue:_e instanceof Object?_e.reducer:st},{provide:Gt,multi:!0,useExisting:st instanceof E.OlP?st:ut},{provide:pt,multi:!0,deps:[ut,[new E.tBr(Gt)]],useFactory:Cs},Ro()]}let cl=(()=>{var _e;class st{constructor(qe,Vt,en,Gn,or,Zi){}}return(_e=st).\u0275fac=function(qe){return new(qe||_e)(E.LFG(Yt),E.LFG(po),E.LFG(ri),E.LFG(os),E.LFG(mi,8),E.LFG(qn,8))},_e.\u0275mod=E.oAB({type:_e}),_e.\u0275inj=E.cJS({}),st})(),la=(()=>{var _e;class st{constructor(qe,Vt,en,Gn,or){this.features=qe,this.featureReducers=Vt,this.reducerManager=en;const Zi=qe.map((Cn,xn)=>{const Xo=Vt.shift()[xn];return{...Cn,reducers:Xo,initialState:Qr(Cn.initialState)}});en.addFeatures(Zi)}ngOnDestroy(){this.reducerManager.removeFeatures(this.features)}}return(_e=st).\u0275fac=function(qe){return new(qe||_e)(E.LFG(bt),E.LFG(pt),E.LFG(Un),E.LFG(cl),E.LFG(qn,8))},_e.\u0275mod=E.oAB({type:_e}),_e.\u0275inj=E.cJS({}),st})(),as=(()=>{var _e;class st{static forRoot(qe,Vt){return{ngModule:cl,providers:[...Jt(qe,Vt)]}}static forFeature(qe,Vt,en={}){return{ngModule:la,providers:[...so(qe,Vt,en)]}}}return(_e=st).\u0275fac=function(qe){return new(qe||_e)},_e.\u0275mod=E.oAB({type:_e}),_e.\u0275inj=E.cJS({}),st})();function Qi(..._e){return{reducer:_e.pop(),types:_e.map(qe=>qe.type)}}function Yo(_e,...st){const Et=new Map;for(const qe of st)for(const Vt of qe.types){const en=Et.get(Vt);Et.set(Vt,en?(or,Zi)=>qe.reducer(en(or,Zi),Zi):qe.reducer)}return function(qe=_e,Vt){const en=Et.get(Vt.type);return en?en(qe,Vt):qe}}},7582:(Ue,Se,te)=>{"use strict";function Qe(ot,ut,xt,bt){return new(xt||(xt=Promise))(function(pt,mt){function gt(oi){try{_n(bt.next(oi))}catch(An){mt(An)}}function un(oi){try{_n(bt.throw(oi))}catch(An){mt(An)}}function _n(oi){oi.done?pt(oi.value):function Gt(pt){return pt instanceof xt?pt:new xt(function(mt){mt(pt)})}(oi.value).then(gt,un)}_n((bt=bt.apply(ot,ut||[])).next())})}function nt(ot){return this instanceof nt?(this.v=ot,this):new nt(ot)}function Ne(ot,ut,xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Gt,bt=xt.apply(ot,ut||[]),pt=[];return Gt={},mt("next"),mt("throw"),mt("return"),Gt[Symbol.asyncIterator]=function(){return this},Gt;function mt(qn){bt[qn]&&(Gt[qn]=function(Vi){return new Promise(function(Xr,Ii){pt.push([qn,Vi,Xr,Ii])>1||gt(qn,Vi)})})}function gt(qn,Vi){try{!function un(qn){qn.value instanceof nt?Promise.resolve(qn.value.v).then(_n,oi):An(pt[0][2],qn)}(bt[qn](Vi))}catch(Xr){An(pt[0][3],Xr)}}function _n(qn){gt("next",qn)}function oi(qn){gt("throw",qn)}function An(qn,Vi){qn(Vi),pt.shift(),pt.length&&gt(pt[0][0],pt[0][1])}}function jt(ot){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var xt,ut=ot[Symbol.asyncIterator];return ut?ut.call(ot):(ot=function Pt(ot){var ut="function"==typeof Symbol&&Symbol.iterator,xt=ut&&ot[ut],bt=0;if(xt)return xt.call(ot);if(ot&&"number"==typeof ot.length)return{next:function(){return ot&&bt>=ot.length&&(ot=void 0),{value:ot&&ot[bt++],done:!ot}}};throw new TypeError(ut?"Object is not iterable.":"Symbol.iterator is not defined.")}(ot),xt={},bt("next"),bt("throw"),bt("return"),xt[Symbol.asyncIterator]=function(){return this},xt);function bt(pt){xt[pt]=ot[pt]&&function(mt){return new Promise(function(gt,un){!function Gt(pt,mt,gt,un){Promise.resolve(un).then(function(_n){pt({value:_n,done:gt})},mt)}(gt,un,(mt=ot[pt](mt)).done,mt.value)})}}}te.d(Se,{FC:()=>Ne,KL:()=>jt,mG:()=>Qe,qq:()=>nt}),"function"==typeof SuppressedError&&SuppressedError}},Ue=>{Ue(Ue.s=7344)}]);