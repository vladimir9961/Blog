(self.webpackChunkfe_blog=self.webpackChunkfe_blog||[]).push([[179],{6368:(Ue,Ie,ne)=>{"use strict";var E=ne(5879);let Be=null;function rt(){return Be}class ue{}const Ye=new E.OlP("DocumentToken");let Ge=(()=>{var i;class e{historyGo(n){throw new Error("Not implemented")}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:function(){return(0,E.f3M)(Ae)},providedIn:"platform"}),e})();const Le=new E.OlP("Location Initialized");let Ae=(()=>{var i;class e extends Ge{constructor(){super(),this._doc=(0,E.f3M)(Ye),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return rt().getBaseHref(this._doc)}onPopState(n){const d=rt().getGlobalEventTarget(this._doc,"window");return d.addEventListener("popstate",n,!1),()=>d.removeEventListener("popstate",n)}onHashChange(n){const d=rt().getGlobalEventTarget(this._doc,"window");return d.addEventListener("hashchange",n,!1),()=>d.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,d,b){this._history.pushState(n,d,b)}replaceState(n,d,b){this._history.replaceState(n,d,b)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:function(){return new i},providedIn:"platform"}),e})();function ke(i,e){if(0==i.length)return e;if(0==e.length)return i;let s=0;return i.endsWith("/")&&s++,e.startsWith("/")&&s++,2==s?i+e.substring(1):1==s?i+e:i+"/"+e}function $e(i){const e=i.match(/#|\?|$/),s=e&&e.index||i.length;return i.slice(0,s-("/"===i[s-1]?1:0))+i.slice(s)}function Qe(i){return i&&"?"!==i[0]?"?"+i:i}let It=(()=>{var i;class e{historyGo(n){throw new Error("Not implemented")}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:function(){return(0,E.f3M)(on)},providedIn:"root"}),e})();const Wt=new E.OlP("appBaseHref");let on=(()=>{var i;class e extends It{constructor(n,d){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=d??this._platformLocation.getBaseHrefFromDOM()??(0,E.f3M)(Ye).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return ke(this._baseHref,n)}path(n=!1){const d=this._platformLocation.pathname+Qe(this._platformLocation.search),b=this._platformLocation.hash;return b&&n?`${d}${b}`:d}pushState(n,d,b,D){const k=this.prepareExternalUrl(b+Qe(D));this._platformLocation.pushState(n,d,k)}replaceState(n,d,b,D){const k=this.prepareExternalUrl(b+Qe(D));this._platformLocation.replaceState(n,d,k)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ge),E.LFG(Wt,8))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),Ot=(()=>{var i;class e extends It{constructor(n,d){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=d&&(this._baseHref=d)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let d=this._platformLocation.hash;return null==d&&(d="#"),d.length>0?d.substring(1):d}prepareExternalUrl(n){const d=ke(this._baseHref,n);return d.length>0?"#"+d:d}pushState(n,d,b,D){let k=this.prepareExternalUrl(b+Qe(D));0==k.length&&(k=this._platformLocation.pathname),this._platformLocation.pushState(n,d,k)}replaceState(n,d,b,D){let k=this.prepareExternalUrl(b+Qe(D));0==k.length&&(k=this._platformLocation.pathname),this._platformLocation.replaceState(n,d,k)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ge),E.LFG(Wt,8))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})(),Cn=(()=>{var i;class e{constructor(n){this._subject=new E.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const d=this._locationStrategy.getBaseHref();this._basePath=function it(i){if(new RegExp("^(https?:)?//").test(i)){const[,s]=i.split(/\/\/[^\/]+/);return s}return i}($e(gn(d))),this._locationStrategy.onPopState(b=>{this._subject.emit({url:this.path(!0),pop:!0,state:b.state,type:b.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,d=""){return this.path()==this.normalize(n+Qe(d))}normalize(n){return e.stripTrailingSlash(function Sn(i,e){if(!i||!e.startsWith(i))return e;const s=e.substring(i.length);return""===s||["/",";","?","#"].includes(s[0])?s:e}(this._basePath,gn(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,d="",b=null){this._locationStrategy.pushState(b,"",n,d),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Qe(d)),b)}replaceState(n,d="",b=null){this._locationStrategy.replaceState(b,"",n,d),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Qe(d)),b)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(d=>{this._notifyUrlChangeListeners(d.url,d.state)})),()=>{const d=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(d,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",d){this._urlChangeListeners.forEach(b=>b(n,d))}subscribe(n,d,b){return this._subject.subscribe({next:n,error:d,complete:b})}}return(i=e).normalizeQueryParams=Qe,i.joinWithSlash=ke,i.stripTrailingSlash=$e,i.\u0275fac=function(n){return new(n||i)(E.LFG(It))},i.\u0275prov=E.Yz7({token:i,factory:function(){return function un(){return new Cn((0,E.LFG)(It))}()},providedIn:"root"}),e})();function gn(i){return i.replace(/\/index.html$/,"")}function Uo(i,e){e=encodeURIComponent(e);for(const s of i.split(";")){const n=s.indexOf("="),[d,b]=-1==n?[s,""]:[s.slice(0,n),s.slice(n+1)];if(d.trim()===e)return decodeURIComponent(b)}return null}class Cr{constructor(e,s,n,d){this.$implicit=e,this.ngForOf=s,this.index=n,this.count=d}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Jl=(()=>{var i;class e{set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}constructor(n,d,b){this._viewContainer=n,this._template=d,this._differs=b,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const d=this._viewContainer;n.forEachOperation((b,D,k)=>{if(null==b.previousIndex)d.createEmbeddedView(this._template,new Cr(b.item,this._ngForOf,-1,-1),null===k?void 0:k);else if(null==k)d.remove(null===D?void 0:D);else if(null!==D){const H=d.get(D);d.move(H,k),jo(H,b)}});for(let b=0,D=d.length;b<D;b++){const H=d.get(b).context;H.index=b,H.count=D,H.ngForOf=this._ngForOf}n.forEachIdentityChange(b=>{jo(d.get(b.currentIndex),b)})}static ngTemplateContextGuard(n,d){return!0}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(E.s_b),E.Y36(E.Rgc),E.Y36(E.ZZ4))},i.\u0275dir=E.lG2({type:i,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),e})();function jo(i,e){i.context.$implicit=e.item}let wa=(()=>{var i;class e{constructor(n,d){this._viewContainer=n,this._context=new Ql,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=d}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){en("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){en("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,d){return!0}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(E.s_b),E.Y36(E.Rgc))},i.\u0275dir=E.lG2({type:i,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),e})();class Ql{constructor(){this.$implicit=null,this.ngIf=null}}function en(i,e){if(e&&!e.createEmbeddedView)throw new Error(`${i} must be a TemplateRef, but received '${(0,E.AaK)(e)}'.`)}class ye{createSubscription(e,s){return(0,E.rg0)(()=>e.subscribe({next:s,error:n=>{throw n}}))}dispose(e){(0,E.rg0)(()=>e.unsubscribe())}}class at{createSubscription(e,s){return e.then(s,n=>{throw n})}dispose(e){}}const Dt=new at,We=new ye;let zt=(()=>{var i;class e{constructor(n){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=n}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(n){return this._obj?n!==this._obj?(this._dispose(),this.transform(n)):this._latestValue:(n&&this._subscribe(n),this._latestValue)}_subscribe(n){this._obj=n,this._strategy=this._selectStrategy(n),this._subscription=this._strategy.createSubscription(n,d=>this._updateLatestValue(n,d))}_selectStrategy(n){if((0,E.QGY)(n))return Dt;if((0,E.F4k)(n))return We;throw function ss(i,e){return new E.vHH(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(n,d){n===this._obj&&(this._latestValue=d,this._ref.markForCheck())}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(E.sBO,16))},i.\u0275pipe=E.Yjl({name:"async",type:i,pure:!1,standalone:!0}),e})(),br=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({}),e})();const aa="browser";function Zo(i){return"server"===i}let Wo=(()=>{var i;class e{}return(i=e).\u0275prov=(0,E.Yz7)({token:i,providedIn:"root",factory:()=>new Wa((0,E.LFG)(Ye),window)}),e})();class Wa{constructor(e,s){this.document=e,this.window=s,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const s=function hf(i,e){const s=i.getElementById(e)||i.getElementsByName(e)[0];if(s)return s;if("function"==typeof i.createTreeWalker&&i.body&&"function"==typeof i.body.attachShadow){const n=i.createTreeWalker(i.body,NodeFilter.SHOW_ELEMENT);let d=n.currentNode;for(;d;){const b=d.shadowRoot;if(b){const D=b.getElementById(e)||b.querySelector(`[name="${e}"]`);if(D)return D}d=n.nextNode()}}return null}(this.document,e);s&&(this.scrollToElement(s),s.focus())}setHistoryScrollRestoration(e){this.supportsScrolling()&&(this.window.history.scrollRestoration=e)}scrollToElement(e){const s=e.getBoundingClientRect(),n=s.left+this.window.pageXOffset,d=s.top+this.window.pageYOffset,b=this.offset();this.window.scrollTo(n-b[0],d-b[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class $s{}class Bc extends ue{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Kd extends Bc{static makeCurrent(){!function p(i){Be||(Be=i)}(new Kd)}onAndCancel(e,s,n){return e.addEventListener(s,n),()=>{e.removeEventListener(s,n)}}dispatchEvent(e,s){e.dispatchEvent(s)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,s){return(s=s||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,s){return"window"===s?window:"document"===s?e:"body"===s?e.body:null}getBaseHref(e){const s=function zc(){return ws=ws||document.querySelector("base"),ws?ws.getAttribute("href"):null}();return null==s?null:function Zu(i){So=So||document.createElement("a"),So.setAttribute("href",i);const e=So.pathname;return"/"===e.charAt(0)?e:`/${e}`}(s)}resetBaseElement(){ws=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Uo(document.cookie,e)}}let So,ws=null,Zi=(()=>{var i;class e{build(){return new XMLHttpRequest}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();const Vc=new E.OlP("EventManagerPlugins");let Sl=(()=>{var i;class e{constructor(n,d){this._zone=d,this._eventNameToPlugin=new Map,n.forEach(b=>{b.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,d,b){return this._findPluginFor(d).addEventListener(n,d,b)}getZone(){return this._zone}_findPluginFor(n){let d=this._eventNameToPlugin.get(n);if(d)return d;if(d=this._plugins.find(D=>D.supports(n)),!d)throw new E.vHH(5101,!1);return this._eventNameToPlugin.set(n,d),d}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Vc),E.LFG(E.R0b))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();class Zr{constructor(e){this._doc=e}}const Jd="ng-app-id";let Uc=(()=>{var i;class e{constructor(n,d,b,D={}){this.doc=n,this.appId=d,this.nonce=b,this.platformId=D,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Zo(D),this.resetHostNodes()}addStyles(n){for(const d of n)1===this.changeUsageCount(d,1)&&this.onStyleAdded(d)}removeStyles(n){for(const d of n)this.changeUsageCount(d,-1)<=0&&this.onStyleRemoved(d)}ngOnDestroy(){const n=this.styleNodesInDOM;n&&(n.forEach(d=>d.remove()),n.clear());for(const d of this.getAllStyles())this.onStyleRemoved(d);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const d of this.getAllStyles())this.addStyleToHost(n,d)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(const d of this.hostNodes)this.addStyleToHost(d,n)}onStyleRemoved(n){const d=this.styleRef;d.get(n)?.elements?.forEach(b=>b.remove()),d.delete(n)}collectServerRenderedStyles(){const n=this.doc.head?.querySelectorAll(`style[${Jd}="${this.appId}"]`);if(n?.length){const d=new Map;return n.forEach(b=>{null!=b.textContent&&d.set(b.textContent,b)}),d}return null}changeUsageCount(n,d){const b=this.styleRef;if(b.has(n)){const D=b.get(n);return D.usage+=d,D.usage}return b.set(n,{usage:d,elements:[]}),d}getStyleElement(n,d){const b=this.styleNodesInDOM,D=b?.get(d);if(D?.parentNode===n)return b.delete(d),D.removeAttribute(Jd),D;{const k=this.doc.createElement("style");return this.nonce&&k.setAttribute("nonce",this.nonce),k.textContent=d,this.platformIsServer&&k.setAttribute(Jd,this.appId),k}}addStyleToHost(n,d){const b=this.getStyleElement(n,d);n.appendChild(b);const D=this.styleRef,k=D.get(d)?.elements;k?k.push(b):D.set(d,{elements:[b],usage:1})}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ye),E.LFG(E.AFp),E.LFG(E.Ojb,8),E.LFG(E.Lbi))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();const Io={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Ao=/%COMP%/g,Hc=new E.OlP("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function Gc(i,e){return e.map(s=>s.replace(Ao,i))}let rn=(()=>{var i;class e{constructor(n,d,b,D,k,H,W,fe=null){this.eventManager=n,this.sharedStylesHost=d,this.appId=b,this.removeStylesOnCompDestroy=D,this.doc=k,this.platformId=H,this.ngZone=W,this.nonce=fe,this.rendererByCompId=new Map,this.platformIsServer=Zo(H),this.defaultRenderer=new Es(n,k,W,this.platformIsServer)}createRenderer(n,d){if(!n||!d)return this.defaultRenderer;this.platformIsServer&&d.encapsulation===E.ifc.ShadowDom&&(d={...d,encapsulation:E.ifc.Emulated});const b=this.getOrCreateRenderer(n,d);return b instanceof Ju?b.applyToHost(n):b instanceof rc&&b.applyStyles(),b}getOrCreateRenderer(n,d){const b=this.rendererByCompId;let D=b.get(d.id);if(!D){const k=this.doc,H=this.ngZone,W=this.eventManager,fe=this.sharedStylesHost,we=this.removeStylesOnCompDestroy,ft=this.platformIsServer;switch(d.encapsulation){case E.ifc.Emulated:D=new Ju(W,fe,d,this.appId,we,k,H,ft);break;case E.ifc.ShadowDom:return new uo(W,fe,n,d,k,H,this.nonce,ft);default:D=new rc(W,fe,d,we,k,H,ft)}b.set(d.id,D)}return D}ngOnDestroy(){this.rendererByCompId.clear()}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Sl),E.LFG(Uc),E.LFG(E.AFp),E.LFG(Hc),E.LFG(Ye),E.LFG(E.Lbi),E.LFG(E.R0b),E.LFG(E.Ojb))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();class Es{constructor(e,s,n,d){this.eventManager=e,this.doc=s,this.ngZone=n,this.platformIsServer=d,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,s){return s?this.doc.createElementNS(Io[s]||s,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,s){(Ku(e)?e.content:e).appendChild(s)}insertBefore(e,s,n){e&&(Ku(e)?e.content:e).insertBefore(s,n)}removeChild(e,s){e&&e.removeChild(s)}selectRootElement(e,s){let n="string"==typeof e?this.doc.querySelector(e):e;if(!n)throw new E.vHH(-5104,!1);return s||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,s,n,d){if(d){s=d+":"+s;const b=Io[d];b?e.setAttributeNS(b,s,n):e.setAttribute(s,n)}else e.setAttribute(s,n)}removeAttribute(e,s,n){if(n){const d=Io[n];d?e.removeAttributeNS(d,s):e.removeAttribute(`${n}:${s}`)}else e.removeAttribute(s)}addClass(e,s){e.classList.add(s)}removeClass(e,s){e.classList.remove(s)}setStyle(e,s,n,d){d&(E.JOm.DashCase|E.JOm.Important)?e.style.setProperty(s,n,d&E.JOm.Important?"important":""):e.style[s]=n}removeStyle(e,s,n){n&E.JOm.DashCase?e.style.removeProperty(s):e.style[s]=""}setProperty(e,s,n){e[s]=n}setValue(e,s){e.nodeValue=s}listen(e,s,n){if("string"==typeof e&&!(e=rt().getGlobalEventTarget(this.doc,e)))throw new Error(`Unsupported event target ${e} for event ${s}`);return this.eventManager.addEventListener(e,s,this.decoratePreventDefault(n))}decoratePreventDefault(e){return s=>{if("__ngUnwrap__"===s)return e;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>e(s)):e(s))&&s.preventDefault()}}}function Ku(i){return"TEMPLATE"===i.tagName&&void 0!==i.content}class uo extends Es{constructor(e,s,n,d,b,D,k,H){super(e,b,D,H),this.sharedStylesHost=s,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const W=Gc(d.id,d.styles);for(const fe of W){const we=document.createElement("style");k&&we.setAttribute("nonce",k),we.textContent=fe,this.shadowRoot.appendChild(we)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,s){return super.appendChild(this.nodeOrShadowRoot(e),s)}insertBefore(e,s,n){return super.insertBefore(this.nodeOrShadowRoot(e),s,n)}removeChild(e,s){return super.removeChild(this.nodeOrShadowRoot(e),s)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class rc extends Es{constructor(e,s,n,d,b,D,k,H){super(e,b,D,k),this.sharedStylesHost=s,this.removeStylesOnCompDestroy=d,this.styles=H?Gc(H,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class Ju extends rc{constructor(e,s,n,d,b,D,k,H){const W=d+"-"+n.id;super(e,s,n,b,D,k,H,W),this.contentAttr=function qu(i){return"_ngcontent-%COMP%".replace(Ao,i)}(W),this.hostAttr=function Yu(i){return"_nghost-%COMP%".replace(Ao,i)}(W)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,s){const n=super.createElement(e,s);return super.setAttribute(n,this.contentAttr,""),n}}let Qd=(()=>{var i;class e extends Zr{constructor(n){super(n)}supports(n){return!0}addEventListener(n,d,b){return n.addEventListener(d,b,!1),()=>this.removeEventListener(n,d,b)}removeEventListener(n,d,b){return n.removeEventListener(d,b)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ye))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();const Da=["alt","control","meta","shift"],Jp={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},eh={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey};let Zc=(()=>{var i;class e extends Zr{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,d,b){const D=e.parseEventName(d),k=e.eventCallback(D.fullKey,b,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>rt().onAndCancel(n,D.domEventName,k))}static parseEventName(n){const d=n.toLowerCase().split("."),b=d.shift();if(0===d.length||"keydown"!==b&&"keyup"!==b)return null;const D=e._normalizeKey(d.pop());let k="",H=d.indexOf("code");if(H>-1&&(d.splice(H,1),k="code."),Da.forEach(fe=>{const we=d.indexOf(fe);we>-1&&(d.splice(we,1),k+=fe+".")}),k+=D,0!=d.length||0===D.length)return null;const W={};return W.domEventName=b,W.fullKey=k,W}static matchEventFullKeyCode(n,d){let b=Jp[n.key]||n.key,D="";return d.indexOf("code.")>-1&&(b=n.code,D="code."),!(null==b||!b)&&(b=b.toLowerCase()," "===b?b="space":"."===b&&(b="dot"),Da.forEach(k=>{k!==b&&(0,eh[k])(n)&&(D+=k+".")}),D+=b,D===d)}static eventCallback(n,d,b){return D=>{e.matchEventFullKeyCode(D,n)&&b.runGuarded(()=>d(D))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ye))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();const Ya=(0,E.eFA)(E._c5,"browser",[{provide:E.Lbi,useValue:aa},{provide:E.g9A,useValue:function th(){Kd.makeCurrent()},multi:!0},{provide:Ye,useFactory:function Qr(){return(0,E.RDi)(document),document},deps:[]}]),ls=new E.OlP(""),qc=[{provide:E.rWj,useClass:class xi{addToWindow(e){E.dqk.getAngularTestability=(n,d=!0)=>{const b=e.findTestabilityInTree(n,d);if(null==b)throw new E.vHH(5103,!1);return b},E.dqk.getAllAngularTestabilities=()=>e.getAllTestabilities(),E.dqk.getAllAngularRootElements=()=>e.getAllRootElements(),E.dqk.frameworkStabilizers||(E.dqk.frameworkStabilizers=[]),E.dqk.frameworkStabilizers.push(n=>{const d=E.dqk.getAllAngularTestabilities();let b=d.length,D=!1;const k=function(H){D=D||H,b--,0==b&&n(D)};d.forEach(H=>{H.whenStable(k)})})}findTestabilityInTree(e,s,n){return null==s?null:e.getTestability(s)??(n?rt().isShadowRoot(s)?this.findTestabilityInTree(e,s.host,!0):this.findTestabilityInTree(e,s.parentElement,!0):null)}},deps:[]},{provide:E.lri,useClass:E.dDg,deps:[E.R0b,E.eoX,E.rWj]},{provide:E.dDg,useClass:E.dDg,deps:[E.R0b,E.eoX,E.rWj]}],Qu=[{provide:E.zSh,useValue:"root"},{provide:E.qLn,useFactory:function nh(){return new E.qLn},deps:[]},{provide:Vc,useClass:Qd,multi:!0,deps:[Ye,E.R0b,E.Lbi]},{provide:Vc,useClass:Zc,multi:!0,deps:[Ye]},rn,Uc,Sl,{provide:E.FYo,useExisting:rn},{provide:$s,useClass:Zi,deps:[]},[]];let ih=(()=>{var i;class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:E.AFp,useValue:n.appId}]}}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(ls,12))},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({providers:[...Qu,...qc],imports:[br,E.hGG]}),e})(),bf=(()=>{var i;class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ye))},i.\u0275prov=E.Yz7({token:i,factory:function(n){let d=null;return d=n?new n:function Sa(){return new bf((0,E.LFG)(Ye))}(),d},providedIn:"root"}),e})();typeof window<"u"&&window;var Xo=ne(5592),Cs=ne(4674),fr=ne(9666),Nn=ne(2096),Po=ne(5619);const{isArray:Ka}=Array,{getPrototypeOf:_,prototype:l,keys:f}=Object;function v(i){if(1===i.length){const e=i[0];if(Ka(e))return{args:e,keys:null};if(function C(i){return i&&"object"==typeof i&&_(i)===l}(e)){const s=f(e);return{args:s.map(n=>e[n]),keys:s}}}return{args:i,keys:null}}var S=ne(2737),R=ne(7398);const{isArray:F}=Array;function $(i){return(0,R.U)(e=>function B(i,e){return F(e)?i(...e):i(e)}(i,e))}var j=ne(9940);function X(i,e){return i.reduce((s,n,d)=>(s[n]=e[d],s),{})}var ee=ne(8251),se=ne(7103);function le(...i){const e=(0,j.yG)(i),s=(0,j.jO)(i),{args:n,keys:d}=v(i);if(0===n.length)return(0,fr.D)([],e);const b=new Xo.y(function ae(i,e,s=S.y){return n=>{ce(e,()=>{const{length:d}=i,b=new Array(d);let D=d,k=d;for(let H=0;H<d;H++)ce(e,()=>{const W=(0,fr.D)(i[H],e);let fe=!1;W.subscribe((0,ee.x)(n,we=>{b[H]=we,fe||(fe=!0,k--),k||n.next(s(b.slice()))},()=>{--D||n.complete()}))},n)},n)}}(n,e,d?D=>X(d,D):S.y));return s?b.pipe($(s)):b}function ce(i,e,s){i?(0,se.f)(s,i,e):e()}const oe=(0,ne(2306).d)(i=>function(){i(this),this.name="EmptyError",this.message="no elements in sequence"});var pe=ne(7537);function De(...i){return function ge(){return(0,pe.J)(1)}()((0,fr.D)(i,(0,j.yG)(i)))}var Me=ne(4829);function Se(i){return new Xo.y(e=>{(0,Me.Xf)(i()).subscribe(e)})}var ze=ne(8407);function Re(i,e){const s=(0,Cs.m)(i)?i:()=>i,n=d=>d.error(s());return new Xo.y(e?d=>e.schedule(n,0,d):n)}var Xe=ne(6232),At=ne(7394),Ve=ne(9360);function mt(){return(0,Ve.e)((i,e)=>{let s=null;i._refCount++;const n=(0,ee.x)(e,void 0,void 0,void 0,()=>{if(!i||i._refCount<=0||0<--i._refCount)return void(s=null);const d=i._connection,b=s;s=null,d&&(!b||d===b)&&d.unsubscribe(),e.unsubscribe()});i.subscribe(n),n.closed||(s=i.connect())})}class nt extends Xo.y{constructor(e,s){super(),this.source=e,this.subjectFactory=s,this._subject=null,this._refCount=0,this._connection=null,(0,Ve.A)(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new At.w0;const s=this.getSubject();e.add(this.source.subscribe((0,ee.x)(s,void 0,()=>{this._teardown(),s.complete()},n=>{this._teardown(),s.error(n)},()=>this._teardown()))),e.closed&&(this._connection=null,e=At.w0.EMPTY)}return e}refCount(){return mt()(this)}}var bt=ne(8645),He=ne(4664),ut=ne(8180);function Lt(...i){const e=(0,j.yG)(i);return(0,Ve.e)((s,n)=>{(e?De(i,s,e):De(i,s)).subscribe(n)})}var gt=ne(2181),wt=ne(1631);function bn(i){return(0,Ve.e)((e,s)=>{let n=!1;e.subscribe((0,ee.x)(s,d=>{n=!0,s.next(d)},()=>{n||s.next(i),s.complete()}))})}function Rn(i=an){return(0,Ve.e)((e,s)=>{let n=!1;e.subscribe((0,ee.x)(s,d=>{n=!0,s.next(d)},()=>n?s.complete():s.error(i())))})}function an(){return new oe}function xn(i,e){const s=arguments.length>=2;return n=>n.pipe(i?(0,gt.h)((d,b)=>i(d,b,n)):S.y,(0,ut.q)(1),s?bn(e):Rn(()=>new oe))}var Jn=ne(6328);function An(i,e,s){const n=(0,Cs.m)(i)||e||s?{next:i,error:e,complete:s}:i;return n?(0,Ve.e)((d,b)=>{var D;null===(D=n.subscribe)||void 0===D||D.call(n);let k=!0;d.subscribe((0,ee.x)(b,H=>{var W;null===(W=n.next)||void 0===W||W.call(n,H),b.next(H)},()=>{var H;k=!1,null===(H=n.complete)||void 0===H||H.call(n),b.complete()},H=>{var W;k=!1,null===(W=n.error)||void 0===W||W.call(n,H),b.error(H)},()=>{var H,W;k&&(null===(H=n.unsubscribe)||void 0===H||H.call(n)),null===(W=n.finalize)||void 0===W||W.call(n)}))}):S.y}var ln=ne(6306),Oi=ne(6699);function ri(i){return i<=0?()=>Xe.E:(0,Ve.e)((e,s)=>{let n=[];e.subscribe((0,ee.x)(s,d=>{n.push(d),i<n.length&&n.shift()},()=>{for(const d of n)s.next(d);s.complete()},void 0,()=>{n=null}))})}function Pr(i){return(0,Ve.e)((e,s)=>{try{e.subscribe(s)}finally{s.add(i)}})}var qr=ne(9773);const jn="primary",Oo=Symbol("RouteTitle");class Bi{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const s=this.params[e];return Array.isArray(s)?s[0]:s}return null}getAll(e){if(this.has(e)){const s=this.params[e];return Array.isArray(s)?s:[s]}return[]}get keys(){return Object.keys(this.params)}}function _i(i){return new Bi(i)}function yi(i,e,s){const n=s.path.split("/");if(n.length>i.length||"full"===s.pathMatch&&(e.hasChildren()||n.length<i.length))return null;const d={};for(let b=0;b<n.length;b++){const D=n[b],k=i[b];if(D.startsWith(":"))d[D.substring(1)]=k;else if(D!==k.path)return null}return{consumed:i.slice(0,n.length),posParams:d}}function pr(i,e){const s=i?Object.keys(i):void 0,n=e?Object.keys(e):void 0;if(!s||!n||s.length!=n.length)return!1;let d;for(let b=0;b<s.length;b++)if(d=s[b],!Ri(i[d],e[d]))return!1;return!0}function Ri(i,e){if(Array.isArray(i)&&Array.isArray(e)){if(i.length!==e.length)return!1;const s=[...i].sort(),n=[...e].sort();return s.every((d,b)=>n[b]===d)}return i===e}function us(i){return i.length>0?i[i.length-1]:null}function ua(i){return function sh(i){return!!i&&(i instanceof Xo.y||(0,Cs.m)(i.lift)&&(0,Cs.m)(i.subscribe))}(i)?i:(0,E.QGY)(i)?(0,fr.D)(Promise.resolve(i)):(0,Nn.of)(i)}const Yc={exact:function lc(i,e,s){if(!go(i.segments,e.segments)||!Mf(i.segments,e.segments,s)||i.numberOfChildren!==e.numberOfChildren)return!1;for(const n in e.children)if(!i.children[n]||!lc(i.children[n],e.children[n],s))return!1;return!0},subset:da},ed={exact:function ac(i,e){return pr(i,e)},subset:function Tf(i,e){return Object.keys(e).length<=Object.keys(i).length&&Object.keys(e).every(s=>Ri(i[s],e[s]))},ignored:()=>!0};function Ja(i,e,s){return Yc[s.paths](i.root,e.root,s.matrixParams)&&ed[s.queryParams](i.queryParams,e.queryParams)&&!("exact"===s.fragment&&i.fragment!==e.fragment)}function da(i,e,s){return ah(i,e,e.segments,s)}function ah(i,e,s,n){if(i.segments.length>s.length){const d=i.segments.slice(0,s.length);return!(!go(d,s)||e.hasChildren()||!Mf(d,s,n))}if(i.segments.length===s.length){if(!go(i.segments,s)||!Mf(i.segments,s,n))return!1;for(const d in e.children)if(!i.children[d]||!da(i.children[d],e.children[d],n))return!1;return!0}{const d=s.slice(0,i.segments.length),b=s.slice(i.segments.length);return!!(go(i.segments,d)&&Mf(i.segments,d,n)&&i.children[jn])&&ah(i.children[jn],e,b,n)}}function Mf(i,e,s){return e.every((n,d)=>ed[s](i[d].parameters,n.parameters))}class Ir{constructor(e=new sr([],{}),s={},n=null){this.root=e,this.queryParams=s,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=_i(this.queryParams)),this._queryParamMap}toString(){return Kc.serialize(this)}}class sr{constructor(e,s){this.segments=e,this.children=s,this.parent=null,Object.values(s).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Df(this)}}class Qa{constructor(e,s){this.path=e,this.parameters=s}get parameterMap(){return this._parameterMap||(this._parameterMap=_i(this.parameters)),this._parameterMap}toString(){return el(this)}}function go(i,e){return i.length===e.length&&i.every((s,n)=>s.path===e[n].path)}let cc=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:function(){return new qs},providedIn:"root"}),e})();class qs{parse(e){const s=new nl(e);return new Ir(s.parseRootSegment(),s.parseQueryParams(),s.parseFragment())}serialize(e){const s=`/${Sf(e.root,!0)}`,n=function Jc(i){const e=Object.keys(i).map(s=>{const n=i[s];return Array.isArray(n)?n.map(d=>`${Hg(s)}=${Hg(d)}`).join("&"):`${Hg(s)}=${Hg(n)}`}).filter(s=>!!s);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${s}${n}${"string"==typeof e.fragment?`#${function ha(i){return encodeURI(i)}(e.fragment)}`:""}`}}const Kc=new qs;function Df(i){return i.segments.map(e=>el(e)).join("/")}function Sf(i,e){if(!i.hasChildren())return Df(i);if(e){const s=i.children[jn]?Sf(i.children[jn],!1):"",n=[];return Object.entries(i.children).forEach(([d,b])=>{d!==jn&&n.push(`${d}:${Sf(b,!1)}`)}),n.length>0?`${s}(${n.join("//")})`:s}{const s=function Xc(i,e){let s=[];return Object.entries(i.children).forEach(([n,d])=>{n===jn&&(s=s.concat(e(d,n)))}),Object.entries(i.children).forEach(([n,d])=>{n!==jn&&(s=s.concat(e(d,n)))}),s}(i,(n,d)=>d===jn?[Sf(i.children[jn],!1)]:[`${d}:${Sf(n,!1)}`]);return 1===Object.keys(i.children).length&&null!=i.children[jn]?`${Df(i)}/${s[0]}`:`${Df(i)}/(${s.join("//")})`}}function jy(i){return encodeURIComponent(i).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Hg(i){return jy(i).replace(/%3B/gi,";")}function td(i){return jy(i).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function fa(i){return decodeURIComponent(i)}function lh(i){return fa(i.replace(/\+/g,"%20"))}function el(i){return`${td(i.path)}${function tl(i){return Object.keys(i).map(e=>`;${td(e)}=${td(i[e])}`).join("")}(i.parameters)}`}const Qc=/^[^\/()?;#]+/;function uc(i){const e=i.match(Qc);return e?e[0]:""}const J0=/^[^\/()?;=#]+/,Gg=/^[^=?&#]+/,Zg=/^[^&#]+/;class nl{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new sr([],{}):new sr([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let s={};this.peekStartsWith("/(")&&(this.capture("/"),s=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(s).length>0)&&(n[jn]=new sr(e,s)),n}parseSegment(){const e=uc(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new E.vHH(4009,!1);return this.capture(e),new Qa(fa(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const s=function Q0(i){const e=i.match(J0);return e?e[0]:""}(this.remaining);if(!s)return;this.capture(s);let n="";if(this.consumeOptional("=")){const d=uc(this.remaining);d&&(n=d,this.capture(n))}e[fa(s)]=fa(n)}parseQueryParam(e){const s=function rm(i){const e=i.match(Gg);return e?e[0]:""}(this.remaining);if(!s)return;this.capture(s);let n="";if(this.consumeOptional("=")){const D=function If(i){const e=i.match(Zg);return e?e[0]:""}(this.remaining);D&&(n=D,this.capture(n))}const d=lh(s),b=lh(n);if(e.hasOwnProperty(d)){let D=e[d];Array.isArray(D)||(D=[D],e[d]=D),D.push(b)}else e[d]=b}parseParens(e){const s={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=uc(this.remaining),d=this.remaining[n.length];if("/"!==d&&")"!==d&&";"!==d)throw new E.vHH(4010,!1);let b;n.indexOf(":")>-1?(b=n.slice(0,n.indexOf(":")),this.capture(b),this.capture(":")):e&&(b=jn);const D=this.parseChildren();s[b]=1===Object.keys(D).length?D[jn]:new sr([],D),this.consumeOptional("//")}return s}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new E.vHH(4011,!1)}}function Af(i){return i.segments.length>0?new sr([],{[jn]:i}):i}function $y(i){const e={};for(const n of Object.keys(i.children)){const b=$y(i.children[n]);if(n===jn&&0===b.segments.length&&b.hasChildren())for(const[D,k]of Object.entries(b.children))e[D]=k;else(b.segments.length>0||b.hasChildren())&&(e[n]=b)}return function Rr(i){if(1===i.numberOfChildren&&i.children[jn]){const e=i.children[jn];return new sr(i.segments.concat(e.segments),e.children)}return i}(new sr(i.segments,e))}function _n(i){return i instanceof Ir}function ch(i){let e;const d=Af(function s(b){const D={};for(const H of b.children){const W=s(H);D[H.outlet]=W}const k=new sr(b.url,D);return b===i&&(e=k),k}(i.root));return e??d}function Ts(i,e,s,n){let d=i;for(;d.parent;)d=d.parent;if(0===e.length)return Ko(d,d,d,s,n);const b=function uh(i){if("string"==typeof i[0]&&1===i.length&&"/"===i[0])return new nd(!0,0,i);let e=0,s=!1;const n=i.reduce((d,b,D)=>{if("object"==typeof b&&null!=b){if(b.outlets){const k={};return Object.entries(b.outlets).forEach(([H,W])=>{k[H]="string"==typeof W?W.split("/"):W}),[...d,{outlets:k}]}if(b.segmentPath)return[...d,b.segmentPath]}return"string"!=typeof b?[...d,b]:0===D?(b.split("/").forEach((k,H)=>{0==H&&"."===k||(0==H&&""===k?s=!0:".."===k?e++:""!=k&&d.push(k))}),d):[...d,b]},[]);return new nd(s,e,n)}(e);if(b.toRoot())return Ko(d,d,new sr([],{}),s,n);const D=function Hy(i,e,s){if(i.isAbsolute)return new Al(e,!0,0);if(!s)return new Al(e,!1,NaN);if(null===s.parent)return new Al(s,!0,0);const n=Pf(i.commands[0])?0:1;return function sm(i,e,s){let n=i,d=e,b=s;for(;b>d;){if(b-=d,n=n.parent,!n)throw new E.vHH(4005,!1);d=n.segments.length}return new Al(n,!1,d-b)}(s,s.segments.length-1+n,i.numberOfDoubleDots)}(b,d,i),k=D.processChildren?eu(D.segmentGroup,D.index,b.commands):Wg(D.segmentGroup,D.index,b.commands);return Ko(d,D.segmentGroup,k,s,n)}function Pf(i){return"object"==typeof i&&null!=i&&!i.outlets&&!i.segmentPath}function rl(i){return"object"==typeof i&&null!=i&&i.outlets}function Ko(i,e,s,n,d){let D,b={};n&&Object.entries(n).forEach(([H,W])=>{b[H]=Array.isArray(W)?W.map(fe=>`${fe}`):`${W}`}),D=i===e?s:om(i,e,s);const k=Af($y(D));return new Ir(k,b,d)}function om(i,e,s){const n={};return Object.entries(i.children).forEach(([d,b])=>{n[d]=b===e?s:om(b,e,s)}),new sr(i.segments,n)}class nd{constructor(e,s,n){if(this.isAbsolute=e,this.numberOfDoubleDots=s,this.commands=n,e&&n.length>0&&Pf(n[0]))throw new E.vHH(4003,!1);const d=n.find(rl);if(d&&d!==us(n))throw new E.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Al{constructor(e,s,n){this.segmentGroup=e,this.processChildren=s,this.index=n}}function Wg(i,e,s){if(i||(i=new sr([],{})),0===i.segments.length&&i.hasChildren())return eu(i,e,s);const n=function am(i,e,s){let n=0,d=e;const b={match:!1,pathIndex:0,commandIndex:0};for(;d<i.segments.length;){if(n>=s.length)return b;const D=i.segments[d],k=s[n];if(rl(k))break;const H=`${k}`,W=n<s.length-1?s[n+1]:null;if(d>0&&void 0===H)break;if(H&&W&&"object"==typeof W&&void 0===W.outlets){if(!ol(H,W,D))return b;n+=2}else{if(!ol(H,{},D))return b;n++}d++}return{match:!0,pathIndex:d,commandIndex:n}}(i,e,s),d=s.slice(n.commandIndex);if(n.match&&n.pathIndex<i.segments.length){const b=new sr(i.segments.slice(0,n.pathIndex),{});return b.children[jn]=new sr(i.segments.slice(n.pathIndex),i.children),eu(b,0,d)}return n.match&&0===d.length?new sr(i.segments,{}):n.match&&!i.hasChildren()?lm(i,e,s):n.match?eu(i,0,d):lm(i,e,s)}function eu(i,e,s){if(0===s.length)return new sr(i.segments,{});{const n=function Gy(i){return rl(i[0])?i[0].outlets:{[jn]:i}}(s),d={};if(Object.keys(n).some(b=>b!==jn)&&i.children[jn]&&1===i.numberOfChildren&&0===i.children[jn].segments.length){const b=eu(i.children[jn],e,s);return new sr(i.segments,b.children)}return Object.entries(n).forEach(([b,D])=>{"string"==typeof D&&(D=[D]),null!==D&&(d[b]=Wg(i.children[b],e,D))}),Object.entries(i.children).forEach(([b,D])=>{void 0===n[b]&&(d[b]=D)}),new sr(i.segments,d)}}function lm(i,e,s){const n=i.segments.slice(0,e);let d=0;for(;d<s.length;){const b=s[d];if(rl(b)){const H=dh(b.outlets);return new sr(n,H)}if(0===d&&Pf(s[0])){n.push(new Qa(i.segments[e].path,hh(s[0]))),d++;continue}const D=rl(b)?b.outlets[jn]:`${b}`,k=d<s.length-1?s[d+1]:null;D&&k&&Pf(k)?(n.push(new Qa(D,hh(k))),d+=2):(n.push(new Qa(D,{})),d++)}return new sr(n,{})}function dh(i){const e={};return Object.entries(i).forEach(([s,n])=>{"string"==typeof n&&(n=[n]),null!==n&&(e[s]=lm(new sr([],{}),0,n))}),e}function hh(i){const e={};return Object.entries(i).forEach(([s,n])=>e[s]=`${n}`),e}function ol(i,e,s){return i==s.path&&pr(e,s.parameters)}const fh="imperative";class sl{constructor(e,s){this.id=e,this.url=s}}class tu extends sl{constructor(e,s,n="imperative",d=null){super(e,s),this.type=0,this.navigationTrigger=n,this.restoredState=d}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Ys extends sl{constructor(e,s,n){super(e,s),this.urlAfterRedirects=n,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ds extends sl{constructor(e,s,n,d){super(e,s),this.reason=n,this.code=d,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class dc extends sl{constructor(e,s,n,d){super(e,s),this.reason=n,this.code=d,this.type=16}}class eo extends sl{constructor(e,s,n,d){super(e,s),this.error=n,this.target=d,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Aa extends sl{constructor(e,s,n,d){super(e,s),this.urlAfterRedirects=n,this.state=d,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Zy extends sl{constructor(e,s,n,d){super(e,s),this.urlAfterRedirects=n,this.state=d,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Vr extends sl{constructor(e,s,n,d,b){super(e,s),this.urlAfterRedirects=n,this.state=d,this.shouldActivate=b,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class eb extends sl{constructor(e,s,n,d){super(e,s),this.urlAfterRedirects=n,this.state=d,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class cm extends sl{constructor(e,s,n,d){super(e,s),this.urlAfterRedirects=n,this.state=d,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class al{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class um{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class dm{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class qg{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Yg{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class nu{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class iu{constructor(e,s,n){this.routerEvent=e,this.position=s,this.anchor=n,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Of{}class Rf{constructor(e){this.url=e}}class fm{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new ru,this.attachRef=null}}let ru=(()=>{var i;class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,d){const b=this.getOrCreateContext(n);b.outlet=d,this.contexts.set(n,b)}onChildOutletDestroyed(n){const d=this.getContext(n);d&&(d.outlet=null,d.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let d=this.getContext(n);return d||(d=new fm,this.contexts.set(n,d)),d}getContext(n){return this.contexts.get(n)||null}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();class Xg{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const s=this.pathFromRoot(e);return s.length>1?s[s.length-2]:null}children(e){const s=pm(e,this._root);return s?s.children.map(n=>n.value):[]}firstChild(e){const s=pm(e,this._root);return s&&s.children.length>0?s.children[0].value:null}siblings(e){const s=id(e,this._root);return s.length<2?[]:s[s.length-2].children.map(d=>d.value).filter(d=>d!==e)}pathFromRoot(e){return id(e,this._root).map(s=>s.value)}}function pm(i,e){if(i===e.value)return e;for(const s of e.children){const n=pm(i,s);if(n)return n}return null}function id(i,e){if(i===e.value)return[e];for(const s of e.children){const n=id(i,s);if(n.length)return n.unshift(e),n}return[]}class Pa{constructor(e,s){this.value=e,this.children=s}toString(){return`TreeNode(${this.value})`}}function Pl(i){const e={};return i&&i.children.forEach(s=>e[s.value.outlet]=s),e}class mm extends Xg{constructor(e,s){super(e),this.snapshot=s,Ms(this,e)}toString(){return this.snapshot.toString()}}function Jo(i,e){const s=function Kg(i,e){const D=new Ur([],{},{},"",{},jn,e,null,{});return new ou("",new Pa(D,[]))}(0,e),n=new Po.X([new Qa("",{})]),d=new Po.X({}),b=new Po.X({}),D=new Po.X({}),k=new Po.X(""),H=new hc(n,d,D,k,b,jn,e,s.root);return H.snapshot=s.root,new mm(new Pa(H,[]),s)}class hc{constructor(e,s,n,d,b,D,k,H){this.urlSubject=e,this.paramsSubject=s,this.queryParamsSubject=n,this.fragmentSubject=d,this.dataSubject=b,this.outlet=D,this.component=k,this._futureSnapshot=H,this.title=this.dataSubject?.pipe((0,R.U)(W=>W[Oo]))??(0,Nn.of)(void 0),this.url=e,this.params=s,this.queryParams=n,this.fragment=d,this.data=b}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,R.U)(e=>_i(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,R.U)(e=>_i(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function ll(i,e="emptyOnly"){const s=i.pathFromRoot;let n=0;if("always"!==e)for(n=s.length-1;n>=1;){const d=s[n],b=s[n-1];if(d.routeConfig&&""===d.routeConfig.path)n--;else{if(b.component)break;n--}}return function tb(i){return i.reduce((e,s)=>({params:{...e.params,...s.params},data:{...e.data,...s.data},resolve:{...s.data,...e.resolve,...s.routeConfig?.data,...s._resolvedData}}),{params:{},data:{},resolve:{}})}(s.slice(n))}class Ur{get title(){return this.data?.[Oo]}constructor(e,s,n,d,b,D,k,H,W){this.url=e,this.params=s,this.queryParams=n,this.fragment=d,this.data=b,this.outlet=D,this.component=k,this.routeConfig=H,this._resolve=W}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=_i(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=_i(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class ou extends Xg{constructor(e,s){super(s),this.url=e,Ms(this,s)}toString(){return Ds(this._root)}}function Ms(i,e){e.value._routerState=i,e.children.forEach(s=>Ms(i,s))}function Ds(i){const e=i.children.length>0?` { ${i.children.map(Ds).join(", ")} } `:"";return`${i.value}${e}`}function Ro(i){if(i.snapshot){const e=i.snapshot,s=i._futureSnapshot;i.snapshot=s,pr(e.queryParams,s.queryParams)||i.queryParamsSubject.next(s.queryParams),e.fragment!==s.fragment&&i.fragmentSubject.next(s.fragment),pr(e.params,s.params)||i.paramsSubject.next(s.params),function Or(i,e){if(i.length!==e.length)return!1;for(let s=0;s<i.length;++s)if(!pr(i[s],e[s]))return!1;return!0}(e.url,s.url)||i.urlSubject.next(s.url),pr(e.data,s.data)||i.dataSubject.next(s.data)}else i.snapshot=i._futureSnapshot,i.dataSubject.next(i._futureSnapshot.data)}function Ol(i,e){const s=pr(i.params,e.params)&&function im(i,e){return go(i,e)&&i.every((s,n)=>pr(s.parameters,e[n].parameters))}(i.url,e.url);return s&&!(!i.parent!=!e.parent)&&(!i.parent||Ol(i.parent,e.parent))}let kf=(()=>{var i;class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=jn,this.activateEvents=new E.vpe,this.deactivateEvents=new E.vpe,this.attachEvents=new E.vpe,this.detachEvents=new E.vpe,this.parentContexts=(0,E.f3M)(ru),this.location=(0,E.f3M)(E.s_b),this.changeDetector=(0,E.f3M)(E.sBO),this.environmentInjector=(0,E.f3M)(E.lqb),this.inputBinder=(0,E.f3M)(ph,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){const{firstChange:d,previousValue:b}=n.name;if(d)return;this.isTrackedInParentContexts(b)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(b)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new E.vHH(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new E.vHH(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new E.vHH(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,d){this.activated=n,this._activatedRoute=d,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,d){if(this.isActivated)throw new E.vHH(4013,!1);this._activatedRoute=n;const b=this.location,k=n.snapshot.component,H=this.parentContexts.getOrCreateContext(this.name).children,W=new Wy(n,H,b.injector);this.activated=b.createComponent(k,{index:b.length,injector:W,environmentInjector:d??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275dir=E.lG2({type:i,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[E.TTD]}),e})();class Wy{constructor(e,s,n){this.route=e,this.childContexts=s,this.parent=n}get(e,s){return e===hc?this.route:e===ru?this.childContexts:this.parent.get(e,s)}}const ph=new E.OlP("");let Oa=(()=>{var i;class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){const{activatedRoute:d}=n,b=le([d.queryParams,d.params,d.data]).pipe((0,He.w)(([D,k,H],W)=>(H={...D,...k,...H},0===W?(0,Nn.of)(H):Promise.resolve(H)))).subscribe(D=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==d||null===d.component)return void this.unsubscribeFromRouteData(n);const k=(0,E.qFp)(d.component);if(k)for(const{templateName:H}of k.inputs)n.activatedComponentRef.setInput(H,D[H]);else this.unsubscribeFromRouteData(n)});this.outletDataSubscriptions.set(n,b)}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();function od(i,e,s){if(s&&i.shouldReuseRoute(e.value,s.value.snapshot)){const n=s.value;n._futureSnapshot=e.value;const d=function qy(i,e,s){return e.children.map(n=>{for(const d of s.children)if(i.shouldReuseRoute(n.value,d.value.snapshot))return od(i,n,d);return od(i,n)})}(i,e,s);return new Pa(n,d)}{if(i.shouldAttach(e.value)){const b=i.retrieve(e.value);if(null!==b){const D=b.route;return D.value._futureSnapshot=e.value,D.children=e.children.map(k=>od(i,k)),D}}const n=function Yy(i){return new hc(new Po.X(i.url),new Po.X(i.params),new Po.X(i.queryParams),new Po.X(i.fragment),new Po.X(i.data),i.outlet,i.component,i)}(e.value),d=e.children.map(b=>od(i,b));return new Pa(n,d)}}const mh="ngNavigationCancelingError";function gm(i,e){const{redirectTo:s,navigationBehaviorOptions:n}=_n(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,d=fc(!1,0,e);return d.url=s,d.navigationBehaviorOptions=n,d}function fc(i,e,s){const n=new Error("NavigationCancelingError: "+(i||""));return n[mh]=!0,n.cancellationCode=e,s&&(n.url=s),n}function gh(i){return i&&i[mh]}let pc=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=E.Xpm({type:i,selectors:[["ng-component"]],standalone:!0,features:[E.jDz],decls:1,vars:0,template:function(n,d){1&n&&E._UZ(0,"router-outlet")},dependencies:[kf],encapsulation:2}),e})();function yh(i){const e=i.children&&i.children.map(yh),s=e?{...i,children:e}:{...i};return!s.component&&!s.loadComponent&&(e||s.loadChildren)&&s.outlet&&s.outlet!==jn&&(s.component=pc),s}function Ss(i){return i.outlet||jn}function Ra(i){if(!i)return null;if(i.routeConfig?._injector)return i.routeConfig._injector;for(let e=i.parent;e;e=e.parent){const s=e.routeConfig;if(s?._loadedInjector)return s._loadedInjector;if(s?._injector)return s._injector}return null}class Rl{constructor(e,s,n,d,b){this.routeReuseStrategy=e,this.futureState=s,this.currState=n,this.forwardEvent=d,this.inputBindingEnabled=b}activate(e){const s=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(s,n,e),Ro(this.futureState.root),this.activateChildRoutes(s,n,e)}deactivateChildRoutes(e,s,n){const d=Pl(s);e.children.forEach(b=>{const D=b.value.outlet;this.deactivateRoutes(b,d[D],n),delete d[D]}),Object.values(d).forEach(b=>{this.deactivateRouteAndItsChildren(b,n)})}deactivateRoutes(e,s,n){const d=e.value,b=s?s.value:null;if(d===b)if(d.component){const D=n.getContext(d.outlet);D&&this.deactivateChildRoutes(e,s,D.children)}else this.deactivateChildRoutes(e,s,n);else b&&this.deactivateRouteAndItsChildren(s,n)}deactivateRouteAndItsChildren(e,s){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,s):this.deactivateRouteAndOutlet(e,s)}detachAndStoreRouteSubtree(e,s){const n=s.getContext(e.value.outlet),d=n&&e.value.component?n.children:s,b=Pl(e);for(const D of Object.keys(b))this.deactivateRouteAndItsChildren(b[D],d);if(n&&n.outlet){const D=n.outlet.detach(),k=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:D,route:e,contexts:k})}}deactivateRouteAndOutlet(e,s){const n=s.getContext(e.value.outlet),d=n&&e.value.component?n.children:s,b=Pl(e);for(const D of Object.keys(b))this.deactivateRouteAndItsChildren(b[D],d);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(e,s,n){const d=Pl(s);e.children.forEach(b=>{this.activateRoutes(b,d[b.value.outlet],n),this.forwardEvent(new nu(b.value.snapshot))}),e.children.length&&this.forwardEvent(new qg(e.value.snapshot))}activateRoutes(e,s,n){const d=e.value,b=s?s.value:null;if(Ro(d),d===b)if(d.component){const D=n.getOrCreateContext(d.outlet);this.activateChildRoutes(e,s,D.children)}else this.activateChildRoutes(e,s,n);else if(d.component){const D=n.getOrCreateContext(d.outlet);if(this.routeReuseStrategy.shouldAttach(d.snapshot)){const k=this.routeReuseStrategy.retrieve(d.snapshot);this.routeReuseStrategy.store(d.snapshot,null),D.children.onOutletReAttached(k.contexts),D.attachRef=k.componentRef,D.route=k.route.value,D.outlet&&D.outlet.attach(k.componentRef,k.route.value),Ro(k.route.value),this.activateChildRoutes(e,null,D.children)}else{const k=Ra(d.snapshot);D.attachRef=null,D.route=d,D.injector=k,D.outlet&&D.outlet.activateWith(d,D.injector),this.activateChildRoutes(e,null,D.children)}}else this.activateChildRoutes(e,null,n)}}class ka{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Qo{constructor(e,s){this.component=e,this.route=s}}function Is(i,e,s){const n=i._root;return Yr(n,e?e._root:null,s,[n.value])}function ad(i,e){const s=Symbol(),n=e.get(i,s);return n===s?"function"!=typeof i||(0,E.Z0I)(i)?e.get(i):i:n}function Yr(i,e,s,n,d={canDeactivateChecks:[],canActivateChecks:[]}){const b=Pl(e);return i.children.forEach(D=>{(function ym(i,e,s,n,d={canDeactivateChecks:[],canActivateChecks:[]}){const b=i.value,D=e?e.value:null,k=s?s.getContext(i.value.outlet):null;if(D&&b.routeConfig===D.routeConfig){const H=function ld(i,e,s){if("function"==typeof s)return s(i,e);switch(s){case"pathParamsChange":return!go(i.url,e.url);case"pathParamsOrQueryParamsChange":return!go(i.url,e.url)||!pr(i.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Ol(i,e)||!pr(i.queryParams,e.queryParams);default:return!Ol(i,e)}}(D,b,b.routeConfig.runGuardsAndResolvers);H?d.canActivateChecks.push(new ka(n)):(b.data=D.data,b._resolvedData=D._resolvedData),Yr(i,e,b.component?k?k.children:null:s,n,d),H&&k&&k.outlet&&k.outlet.isActivated&&d.canDeactivateChecks.push(new Qo(k.outlet.component,D))}else D&&pa(e,k,d),d.canActivateChecks.push(new ka(n)),Yr(i,null,b.component?k?k.children:null:s,n,d)})(D,b[D.value.outlet],s,n.concat([D.value]),d),delete b[D.value.outlet]}),Object.entries(b).forEach(([D,k])=>pa(k,s.getContext(D),d)),d}function pa(i,e,s){const n=Pl(i),d=i.value;Object.entries(n).forEach(([b,D])=>{pa(D,d.component?e?e.children.getContext(b):null:e,s)}),s.canDeactivateChecks.push(new Qo(d.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,d))}function cd(i){return"function"==typeof i}function dd(i){return i instanceof oe||"EmptyError"===i?.name}const hd=Symbol("INITIAL_VALUE");function Fl(){return(0,He.w)(i=>le(i.map(e=>e.pipe((0,ut.q)(1),Lt(hd)))).pipe((0,R.U)(e=>{for(const s of e)if(!0!==s){if(s===hd)return hd;if(!1===s||s instanceof Ir)return s}return!0}),(0,gt.h)(e=>e!==hd),(0,ut.q)(1)))}function r_(i){return(0,ze.z)(An(e=>{if(_n(e))throw gm(0,e)}),(0,R.U)(e=>!0===e))}class mc{constructor(e){this.segmentGroup=e||null}}class xh{constructor(e){this.urlTree=e}}function lu(i){return Re(new mc(i))}function wh(i){return Re(new xh(i))}class nv{constructor(e,s){this.urlSerializer=e,this.urlTree=s}noMatchError(e){return new E.vHH(4002,!1)}lineralizeSegments(e,s){let n=[],d=s.root;for(;;){if(n=n.concat(d.segments),0===d.numberOfChildren)return(0,Nn.of)(n);if(d.numberOfChildren>1||!d.children[jn])return Re(new E.vHH(4e3,!1));d=d.children[jn]}}applyRedirectCommands(e,s,n){return this.applyRedirectCreateUrlTree(s,this.urlSerializer.parse(s),e,n)}applyRedirectCreateUrlTree(e,s,n,d){const b=this.createSegmentGroup(e,s.root,n,d);return new Ir(b,this.createQueryParams(s.queryParams,this.urlTree.queryParams),s.fragment)}createQueryParams(e,s){const n={};return Object.entries(e).forEach(([d,b])=>{if("string"==typeof b&&b.startsWith(":")){const k=b.substring(1);n[d]=s[k]}else n[d]=b}),n}createSegmentGroup(e,s,n,d){const b=this.createSegments(e,s.segments,n,d);let D={};return Object.entries(s.children).forEach(([k,H])=>{D[k]=this.createSegmentGroup(e,H,n,d)}),new sr(b,D)}createSegments(e,s,n,d){return s.map(b=>b.path.startsWith(":")?this.findPosParam(e,b,d):this.findOrReturn(b,n))}findPosParam(e,s,n){const d=n[s.path.substring(1)];if(!d)throw new E.vHH(4001,!1);return d}findOrReturn(e,s){let n=0;for(const d of s){if(d.path===e.path)return s.splice(n),d;n++}return e}}const s_={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function ob(i,e,s,n,d){const b=a_(i,e,s);return b.matched?(n=function Xy(i,e){return i.providers&&!i._injector&&(i._injector=(0,E.MMx)(i.providers,e,`Route: ${i.path}`)),i._injector??e}(e,n),function rb(i,e,s,n){const d=e.canMatch;if(!d||0===d.length)return(0,Nn.of)(!0);const b=d.map(D=>{const k=ad(D,i);return ua(function kl(i){return i&&cd(i.canMatch)}(k)?k.canMatch(e,s):i.runInContext(()=>k(e,s)))});return(0,Nn.of)(b).pipe(Fl(),r_())}(n,e,s).pipe((0,R.U)(D=>!0===D?b:{...s_}))):(0,Nn.of)(b)}function a_(i,e,s){if(""===e.path)return"full"===e.pathMatch&&(i.hasChildren()||s.length>0)?{...s_}:{matched:!0,consumedSegments:[],remainingSegments:s,parameters:{},positionalParamSegments:{}};const d=(e.matcher||yi)(s,i,e);if(!d)return{...s_};const b={};Object.entries(d.posParams??{}).forEach(([k,H])=>{b[k]=H.path});const D=d.consumed.length>0?{...b,...d.consumed[d.consumed.length-1].parameters}:b;return{matched:!0,consumedSegments:d.consumed,remainingSegments:s.slice(d.consumed.length),parameters:D,positionalParamSegments:d.posParams??{}}}function bm(i,e,s,n){return s.length>0&&function Vf(i,e,s){return s.some(n=>ma(i,e,n)&&Ss(n)!==jn)}(i,s,n)?{segmentGroup:new sr(e,fd(n,new sr(s,i.children))),slicedSegments:[]}:0===s.length&&function Uf(i,e,s){return s.some(n=>ma(i,e,n))}(i,s,n)?{segmentGroup:new sr(i.segments,iv(i,0,s,n,i.children)),slicedSegments:s}:{segmentGroup:new sr(i.segments,i.children),slicedSegments:s}}function iv(i,e,s,n,d){const b={};for(const D of n)if(ma(i,s,D)&&!d[Ss(D)]){const k=new sr([],{});b[Ss(D)]=k}return{...d,...b}}function fd(i,e){const s={};s[jn]=e;for(const n of i)if(""===n.path&&Ss(n)!==jn){const d=new sr([],{});s[Ss(n)]=d}return s}function ma(i,e,s){return(!(i.hasChildren()||e.length>0)||"full"!==s.pathMatch)&&""===s.path}class sb{constructor(e,s,n,d,b,D,k){this.injector=e,this.configLoader=s,this.rootComponentType=n,this.config=d,this.urlTree=b,this.paramsInheritanceStrategy=D,this.urlSerializer=k,this.allowRedirects=!0,this.applyRedirects=new nv(this.urlSerializer,this.urlTree)}noMatchError(e){return new E.vHH(4002,!1)}recognize(){const e=bm(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,e,jn).pipe((0,ln.K)(s=>{if(s instanceof xh)return this.allowRedirects=!1,this.urlTree=s.urlTree,this.match(s.urlTree);throw s instanceof mc?this.noMatchError(s):s}),(0,R.U)(s=>{const n=new Ur([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},jn,this.rootComponentType,null,{}),d=new Pa(n,s),b=new ou("",d),D=function il(i,e,s=null,n=null){return Ts(ch(i),e,s,n)}(n,[],this.urlTree.queryParams,this.urlTree.fragment);return D.queryParams=this.urlTree.queryParams,b.url=this.urlSerializer.serialize(D),this.inheritParamsAndData(b._root),{state:b,tree:D}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e.root,jn).pipe((0,ln.K)(n=>{throw n instanceof mc?this.noMatchError(n):n}))}inheritParamsAndData(e){const s=e.value,n=ll(s,this.paramsInheritanceStrategy);s.params=Object.freeze(n.params),s.data=Object.freeze(n.data),e.children.forEach(d=>this.inheritParamsAndData(d))}processSegmentGroup(e,s,n,d){return 0===n.segments.length&&n.hasChildren()?this.processChildren(e,s,n):this.processSegment(e,s,n,n.segments,d,!0)}processChildren(e,s,n){const d=[];for(const b of Object.keys(n.children))"primary"===b?d.unshift(b):d.push(b);return(0,fr.D)(d).pipe((0,Jn.b)(b=>{const D=n.children[b],k=function Jy(i,e){const s=i.filter(n=>Ss(n)===e);return s.push(...i.filter(n=>Ss(n)!==e)),s}(s,b);return this.processSegmentGroup(e,k,D,b)}),(0,Oi.R)((b,D)=>(b.push(...D),b)),bn(null),function Wi(i,e){const s=arguments.length>=2;return n=>n.pipe(i?(0,gt.h)((d,b)=>i(d,b,n)):S.y,ri(1),s?bn(e):Rn(()=>new oe))}(),(0,wt.z)(b=>{if(null===b)return lu(n);const D=wm(b);return function ab(i){i.sort((e,s)=>e.value.outlet===jn?-1:s.value.outlet===jn?1:e.value.outlet.localeCompare(s.value.outlet))}(D),(0,Nn.of)(D)}))}processSegment(e,s,n,d,b,D){return(0,fr.D)(s).pipe((0,Jn.b)(k=>this.processSegmentAgainstRoute(k._injector??e,s,k,n,d,b,D).pipe((0,ln.K)(H=>{if(H instanceof mc)return(0,Nn.of)(null);throw H}))),xn(k=>!!k),(0,ln.K)(k=>{if(dd(k))return function rv(i,e,s){return 0===e.length&&!i.children[s]}(n,d,b)?(0,Nn.of)([]):lu(n);throw k}))}processSegmentAgainstRoute(e,s,n,d,b,D,k){return function As(i,e,s,n){return!!(Ss(i)===n||n!==jn&&ma(e,s,i))&&("**"===i.path||a_(e,i,s).matched)}(n,d,b,D)?void 0===n.redirectTo?this.matchSegmentAgainstRoute(e,d,n,b,D,k):k&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,d,s,n,b,D):lu(d):lu(d)}expandSegmentAgainstRouteUsingRedirect(e,s,n,d,b,D){return"**"===d.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,d,D):this.expandRegularSegmentAgainstRouteUsingRedirect(e,s,n,d,b,D)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,s,n,d){const b=this.applyRedirects.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?wh(b):this.applyRedirects.lineralizeSegments(n,b).pipe((0,wt.z)(D=>{const k=new sr(D,{});return this.processSegment(e,s,k,D,d,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,s,n,d,b,D){const{matched:k,consumedSegments:H,remainingSegments:W,positionalParamSegments:fe}=a_(s,d,b);if(!k)return lu(s);const we=this.applyRedirects.applyRedirectCommands(H,d.redirectTo,fe);return d.redirectTo.startsWith("/")?wh(we):this.applyRedirects.lineralizeSegments(d,we).pipe((0,wt.z)(ft=>this.processSegment(e,n,s,ft.concat(W),D,!1)))}matchSegmentAgainstRoute(e,s,n,d,b,D){let k;if("**"===n.path){const H=d.length>0?us(d).parameters:{},W=new Ur(d,H,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Ll(n),Ss(n),n.component??n._loadedComponent??null,n,Fa(n));k=(0,Nn.of)({snapshot:W,consumedSegments:[],remainingSegments:[]}),s.children={}}else k=ob(s,n,d,e).pipe((0,R.U)(({matched:H,consumedSegments:W,remainingSegments:fe,parameters:we})=>H?{snapshot:new Ur(W,we,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Ll(n),Ss(n),n.component??n._loadedComponent??null,n,Fa(n)),consumedSegments:W,remainingSegments:fe}:null));return k.pipe((0,He.w)(H=>null===H?lu(s):this.getChildConfig(e=n._injector??e,n,d).pipe((0,He.w)(({routes:W})=>{const fe=n._loadedInjector??e,{snapshot:we,consumedSegments:ft,remainingSegments:Je}=H,{segmentGroup:ht,slicedSegments:qt}=bm(s,ft,Je,W);if(0===qt.length&&ht.hasChildren())return this.processChildren(fe,W,ht).pipe((0,R.U)(Dn=>null===Dn?null:[new Pa(we,Dn)]));if(0===W.length&&0===qt.length)return(0,Nn.of)([new Pa(we,[])]);const sn=Ss(n)===b;return this.processSegment(fe,W,ht,qt,sn?jn:b,!0).pipe((0,R.U)(Dn=>[new Pa(we,Dn)]))}))))}getChildConfig(e,s,n){return s.children?(0,Nn.of)({routes:s.children,injector:e}):s.loadChildren?void 0!==s._loadedRoutes?(0,Nn.of)({routes:s._loadedRoutes,injector:s._loadedInjector}):function au(i,e,s,n){const d=e.canLoad;if(void 0===d||0===d.length)return(0,Nn.of)(!0);const b=d.map(D=>{const k=ad(D,i);return ua(function nb(i){return i&&cd(i.canLoad)}(k)?k.canLoad(e,s):i.runInContext(()=>k(e,s)))});return(0,Nn.of)(b).pipe(Fl(),r_())}(e,s,n).pipe((0,wt.z)(d=>d?this.configLoader.loadChildren(e,s).pipe(An(b=>{s._loadedRoutes=b.routes,s._loadedInjector=b.injector})):function Eh(i){return Re(fc(!1,3))}())):(0,Nn.of)({routes:[],injector:e})}}function lb(i){const e=i.value.routeConfig;return e&&""===e.path}function wm(i){const e=[],s=new Set;for(const n of i){if(!lb(n)){e.push(n);continue}const d=e.find(b=>n.value.routeConfig===b.value.routeConfig);void 0!==d?(d.children.push(...n.children),s.add(d)):e.push(n)}for(const n of s){const d=wm(n.children);e.push(new Pa(n.value,d))}return e.filter(n=>!s.has(n))}function Ll(i){return i.data||{}}function Fa(i){return i.resolve||{}}function c_(i){return"string"==typeof i.title||null===i.title}function u_(i){return(0,He.w)(e=>{const s=i(e);return s?(0,fr.D)(s).pipe((0,R.U)(()=>e)):(0,Nn.of)(e)})}const cu=new E.OlP("ROUTES");let d_=(()=>{var i;class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,E.f3M)(E.Sil)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return(0,Nn.of)(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const d=ua(n.loadComponent()).pipe((0,R.U)(Em),An(D=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=D}),Pr(()=>{this.componentLoaders.delete(n)})),b=new nt(d,()=>new bt.x).pipe(mt());return this.componentLoaders.set(n,b),b}loadChildren(n,d){if(this.childrenLoaders.get(d))return this.childrenLoaders.get(d);if(d._loadedRoutes)return(0,Nn.of)({routes:d._loadedRoutes,injector:d._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(d);const D=this.loadModuleFactoryOrRoutes(d.loadChildren).pipe((0,R.U)(H=>{this.onLoadEndListener&&this.onLoadEndListener(d);let W,fe;return Array.isArray(H)?fe=H:(W=H.create(n).injector,fe=W.get(cu,[],E.XFs.Self|E.XFs.Optional).flat()),{routes:fe.map(yh),injector:W}}),Pr(()=>{this.childrenLoaders.delete(d)})),k=new nt(D,()=>new bt.x).pipe(mt());return this.childrenLoaders.set(d,k),k}loadModuleFactoryOrRoutes(n){return ua(n()).pipe((0,R.U)(Em),(0,wt.z)(d=>d instanceof E.YKP||Array.isArray(d)?(0,Nn.of)(d):(0,fr.D)(this.compiler.compileModuleAsync(d))))}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();function Em(i){return function Ch(i){return i&&"object"==typeof i&&"default"in i}(i)?i.default:i}let ki=(()=>{var i;class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new bt.x,this.transitionAbortSubject=new bt.x,this.configLoader=(0,E.f3M)(d_),this.environmentInjector=(0,E.f3M)(E.lqb),this.urlSerializer=(0,E.f3M)(cc),this.rootContexts=(0,E.f3M)(ru),this.inputBindingEnabled=null!==(0,E.f3M)(ph,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>(0,Nn.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=b=>this.events.next(new um(b)),this.configLoader.onLoadStartListener=b=>this.events.next(new al(b))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const d=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:d})}setupNavigations(n,d,b){return this.transitions=new Po.X({id:0,currentUrlTree:d,currentRawUrl:d,currentBrowserUrl:d,extractedUrl:n.urlHandlingStrategy.extract(d),urlAfterRedirects:n.urlHandlingStrategy.extract(d),rawUrl:d,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:fh,restoredState:null,currentSnapshot:b.snapshot,targetSnapshot:null,currentRouterState:b,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,gt.h)(D=>0!==D.id),(0,R.U)(D=>({...D,extractedUrl:n.urlHandlingStrategy.extract(D.rawUrl)})),(0,He.w)(D=>{this.currentTransition=D;let k=!1,H=!1;return(0,Nn.of)(D).pipe(An(W=>{this.currentNavigation={id:W.id,initialUrl:W.rawUrl,extractedUrl:W.extractedUrl,trigger:W.source,extras:W.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,He.w)(W=>{const fe=W.currentBrowserUrl.toString(),we=!n.navigated||W.extractedUrl.toString()!==fe||fe!==W.currentUrlTree.toString();if(!we&&"reload"!==(W.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const Je="";return this.events.next(new dc(W.id,this.urlSerializer.serialize(W.rawUrl),Je,0)),W.resolve(null),Xe.E}if(n.urlHandlingStrategy.shouldProcessUrl(W.rawUrl))return(0,Nn.of)(W).pipe((0,He.w)(Je=>{const ht=this.transitions?.getValue();return this.events.next(new tu(Je.id,this.urlSerializer.serialize(Je.extractedUrl),Je.source,Je.restoredState)),ht!==this.transitions?.getValue()?Xe.E:Promise.resolve(Je)}),function jf(i,e,s,n,d,b){return(0,wt.z)(D=>function xm(i,e,s,n,d,b,D="emptyOnly"){return new sb(i,e,s,n,d,D,b).recognize()}(i,e,s,n,D.extractedUrl,d,b).pipe((0,R.U)(({state:k,tree:H})=>({...D,targetSnapshot:k,urlAfterRedirects:H}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),An(Je=>{D.targetSnapshot=Je.targetSnapshot,D.urlAfterRedirects=Je.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:Je.urlAfterRedirects};const ht=new Aa(Je.id,this.urlSerializer.serialize(Je.extractedUrl),this.urlSerializer.serialize(Je.urlAfterRedirects),Je.targetSnapshot);this.events.next(ht)}));if(we&&n.urlHandlingStrategy.shouldProcessUrl(W.currentRawUrl)){const{id:Je,extractedUrl:ht,source:qt,restoredState:sn,extras:Dn}=W,oi=new tu(Je,this.urlSerializer.serialize(ht),qt,sn);this.events.next(oi);const _r=Jo(0,this.rootComponentType).snapshot;return this.currentTransition=D={...W,targetSnapshot:_r,urlAfterRedirects:ht,extras:{...Dn,skipLocationChange:!1,replaceUrl:!1}},(0,Nn.of)(D)}{const Je="";return this.events.next(new dc(W.id,this.urlSerializer.serialize(W.extractedUrl),Je,1)),W.resolve(null),Xe.E}}),An(W=>{const fe=new Zy(W.id,this.urlSerializer.serialize(W.extractedUrl),this.urlSerializer.serialize(W.urlAfterRedirects),W.targetSnapshot);this.events.next(fe)}),(0,R.U)(W=>(this.currentTransition=D={...W,guards:Is(W.targetSnapshot,W.currentSnapshot,this.rootContexts)},D)),function Bf(i,e){return(0,wt.z)(s=>{const{targetSnapshot:n,currentSnapshot:d,guards:{canActivateChecks:b,canDeactivateChecks:D}}=s;return 0===D.length&&0===b.length?(0,Nn.of)({...s,guardsResult:!0}):function n_(i,e,s,n){return(0,fr.D)(i).pipe((0,wt.z)(d=>function tv(i,e,s,n,d){const b=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!b||0===b.length)return(0,Nn.of)(!0);const D=b.map(k=>{const H=Ra(e)??d,W=ad(k,H);return ua(function ib(i){return i&&cd(i.canDeactivate)}(W)?W.canDeactivate(i,e,s,n):H.runInContext(()=>W(i,e,s,n))).pipe(xn())});return(0,Nn.of)(D).pipe(Fl())}(d.component,d.route,s,e,n)),xn(d=>!0!==d,!0))}(D,n,d,i).pipe((0,wt.z)(k=>k&&function vm(i){return"boolean"==typeof i}(k)?function i_(i,e,s,n){return(0,fr.D)(e).pipe((0,Jn.b)(d=>De(function ev(i,e){return null!==i&&e&&e(new dm(i)),(0,Nn.of)(!0)}(d.route.parent,n),function vh(i,e){return null!==i&&e&&e(new Yg(i)),(0,Nn.of)(!0)}(d.route,n),function bh(i,e,s){const n=e[e.length-1],b=e.slice(0,e.length-1).reverse().map(D=>function po(i){const e=i.routeConfig?i.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:i,guards:e}:null}(D)).filter(D=>null!==D).map(D=>Se(()=>{const k=D.guards.map(H=>{const W=Ra(D.node)??s,fe=ad(H,W);return ua(function Lf(i){return i&&cd(i.canActivateChild)}(fe)?fe.canActivateChild(n,i):W.runInContext(()=>fe(n,i))).pipe(xn())});return(0,Nn.of)(k).pipe(Fl())}));return(0,Nn.of)(b).pipe(Fl())}(i,d.path,s),function zf(i,e,s){const n=e.routeConfig?e.routeConfig.canActivate:null;if(!n||0===n.length)return(0,Nn.of)(!0);const d=n.map(b=>Se(()=>{const D=Ra(e)??s,k=ad(b,D);return ua(function Qy(i){return i&&cd(i.canActivate)}(k)?k.canActivate(e,i):D.runInContext(()=>k(e,i))).pipe(xn())}));return(0,Nn.of)(d).pipe(Fl())}(i,d.route,s))),xn(d=>!0!==d,!0))}(n,b,i,e):(0,Nn.of)(k)),(0,R.U)(k=>({...s,guardsResult:k})))})}(this.environmentInjector,W=>this.events.next(W)),An(W=>{if(D.guardsResult=W.guardsResult,_n(W.guardsResult))throw gm(0,W.guardsResult);const fe=new Vr(W.id,this.urlSerializer.serialize(W.extractedUrl),this.urlSerializer.serialize(W.urlAfterRedirects),W.targetSnapshot,!!W.guardsResult);this.events.next(fe)}),(0,gt.h)(W=>!!W.guardsResult||(this.cancelNavigationTransition(W,"",3),!1)),u_(W=>{if(W.guards.canActivateChecks.length)return(0,Nn.of)(W).pipe(An(fe=>{const we=new eb(fe.id,this.urlSerializer.serialize(fe.extractedUrl),this.urlSerializer.serialize(fe.urlAfterRedirects),fe.targetSnapshot);this.events.next(we)}),(0,He.w)(fe=>{let we=!1;return(0,Nn.of)(fe).pipe(function sw(i,e){return(0,wt.z)(s=>{const{targetSnapshot:n,guards:{canActivateChecks:d}}=s;if(!d.length)return(0,Nn.of)(s);let b=0;return(0,fr.D)(d).pipe((0,Jn.b)(D=>function aw(i,e,s,n){const d=i.routeConfig,b=i._resolve;return void 0!==d?.title&&!c_(d)&&(b[Oo]=d.title),function lw(i,e,s,n){const d=function cw(i){return[...Object.keys(i),...Object.getOwnPropertySymbols(i)]}(i);if(0===d.length)return(0,Nn.of)({});const b={};return(0,fr.D)(d).pipe((0,wt.z)(D=>function uw(i,e,s,n){const d=Ra(e)??n,b=ad(i,d);return ua(b.resolve?b.resolve(e,s):d.runInContext(()=>b(e,s)))}(i[D],e,s,n).pipe(xn(),An(k=>{b[D]=k}))),ri(1),function Ni(i){return(0,R.U)(()=>i)}(b),(0,ln.K)(D=>dd(D)?Xe.E:Re(D)))}(b,i,e,n).pipe((0,R.U)(D=>(i._resolvedData=D,i.data=ll(i,s).resolve,d&&c_(d)&&(i.data[Oo]=d.title),null)))}(D.route,n,i,e)),An(()=>b++),ri(1),(0,wt.z)(D=>b===d.length?(0,Nn.of)(s):Xe.E))})}(n.paramsInheritanceStrategy,this.environmentInjector),An({next:()=>we=!0,complete:()=>{we||this.cancelNavigationTransition(fe,"",2)}}))}),An(fe=>{const we=new cm(fe.id,this.urlSerializer.serialize(fe.extractedUrl),this.urlSerializer.serialize(fe.urlAfterRedirects),fe.targetSnapshot);this.events.next(we)}))}),u_(W=>{const fe=we=>{const ft=[];we.routeConfig?.loadComponent&&!we.routeConfig._loadedComponent&&ft.push(this.configLoader.loadComponent(we.routeConfig).pipe(An(Je=>{we.component=Je}),(0,R.U)(()=>{})));for(const Je of we.children)ft.push(...fe(Je));return ft};return le(fe(W.targetSnapshot.root)).pipe(bn(),(0,ut.q)(1))}),u_(()=>this.afterPreactivation()),(0,R.U)(W=>{const fe=function rd(i,e,s){const n=od(i,e._root,s?s._root:void 0);return new mm(n,e)}(n.routeReuseStrategy,W.targetSnapshot,W.currentRouterState);return this.currentTransition=D={...W,targetRouterState:fe},D}),An(()=>{this.events.next(new Of)}),((i,e,s,n)=>(0,R.U)(d=>(new Rl(e,d.targetRouterState,d.currentRouterState,s,n).activate(i),d)))(this.rootContexts,n.routeReuseStrategy,W=>this.events.next(W),this.inputBindingEnabled),(0,ut.q)(1),An({next:W=>{k=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ys(W.id,this.urlSerializer.serialize(W.extractedUrl),this.urlSerializer.serialize(W.urlAfterRedirects))),n.titleStrategy?.updateTitle(W.targetRouterState.snapshot),W.resolve(!0)},complete:()=>{k=!0}}),(0,qr.R)(this.transitionAbortSubject.pipe(An(W=>{throw W}))),Pr(()=>{k||H||this.cancelNavigationTransition(D,"",1),this.currentNavigation?.id===D.id&&(this.currentNavigation=null)}),(0,ln.K)(W=>{if(H=!0,gh(W))this.events.next(new ds(D.id,this.urlSerializer.serialize(D.extractedUrl),W.message,W.cancellationCode)),function su(i){return gh(i)&&_n(i.url)}(W)?this.events.next(new Rf(W.url)):D.resolve(!1);else{this.events.next(new eo(D.id,this.urlSerializer.serialize(D.extractedUrl),W,D.targetSnapshot??void 0));try{D.resolve(n.errorHandler(W))}catch(fe){D.reject(fe)}}return Xe.E}))}))}cancelNavigationTransition(n,d,b){const D=new ds(n.id,this.urlSerializer.serialize(n.extractedUrl),d,b);this.events.next(D),n.resolve(!1)}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();function gc(i){return i!==fh}let Cm=(()=>{var i;class e{buildTitle(n){let d,b=n.root;for(;void 0!==b;)d=this.getResolvedTitleForRoute(b)??d,b=b.children.find(D=>D.outlet===jn);return d}getResolvedTitleForRoute(n){return n.data[Oo]}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:function(){return(0,E.f3M)($f)},providedIn:"root"}),e})(),$f=(()=>{var i;class e extends Cm{constructor(n){super(),this.title=n}updateTitle(n){const d=this.buildTitle(n);void 0!==d&&this.title.setTitle(d)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(bf))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),Hf=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:function(){return(0,E.f3M)(cb)},providedIn:"root"}),e})();class Tm{shouldDetach(e){return!1}store(e,s){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,s){return e.routeConfig===s.routeConfig}}let cb=(()=>{var i;class e extends Tm{}return(i=e).\u0275fac=function(){let s;return function(d){return(s||(s=E.n5z(i)))(d||i)}}(),i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();const Mm=new E.OlP("",{providedIn:"root",factory:()=>({})});let pd=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:function(){return(0,E.f3M)(Gf)},providedIn:"root"}),e})(),Gf=(()=>{var i;class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,d){return n}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();var Th=function(i){return i[i.COMPLETE=0]="COMPLETE",i[i.FAILED=1]="FAILED",i[i.REDIRECTING=2]="REDIRECTING",i}(Th||{});function h_(i,e){i.events.pipe((0,gt.h)(s=>s instanceof Ys||s instanceof ds||s instanceof eo||s instanceof dc),(0,R.U)(s=>s instanceof Ys||s instanceof dc?Th.COMPLETE:s instanceof ds&&(0===s.code||1===s.code)?Th.REDIRECTING:Th.FAILED),(0,gt.h)(s=>s!==Th.REDIRECTING),(0,ut.q)(1)).subscribe(()=>{e()})}function ov(i){throw i}function sv(i,e,s){return e.parse("/")}const Zf={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ub={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let _o=(()=>{var i;class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,E.f3M)(E.c2e),this.isNgZoneEnabled=!1,this._events=new bt.x,this.options=(0,E.f3M)(Mm,{optional:!0})||{},this.pendingTasks=(0,E.f3M)(E.HDt),this.errorHandler=this.options.errorHandler||ov,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||sv,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,E.f3M)(pd),this.routeReuseStrategy=(0,E.f3M)(Hf),this.titleStrategy=(0,E.f3M)(Cm),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=(0,E.f3M)(cu,{optional:!0})?.flat()??[],this.navigationTransitions=(0,E.f3M)(ki),this.urlSerializer=(0,E.f3M)(cc),this.location=(0,E.f3M)(Cn),this.componentInputBindingEnabled=!!(0,E.f3M)(ph,{optional:!0}),this.eventsSubscription=new At.w0,this.isNgZoneEnabled=(0,E.f3M)(E.R0b)instanceof E.R0b&&E.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Ir,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=Jo(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const n=this.navigationTransitions.events.subscribe(d=>{try{const{currentTransition:b}=this.navigationTransitions;if(null===b)return void(md(d)&&this._events.next(d));if(d instanceof tu)gc(b.source)&&(this.browserUrlTree=b.extractedUrl);else if(d instanceof dc)this.rawUrlTree=b.rawUrl;else if(d instanceof Aa){if("eager"===this.urlUpdateStrategy){if(!b.extras.skipLocationChange){const D=this.urlHandlingStrategy.merge(b.urlAfterRedirects,b.rawUrl);this.setBrowserUrl(D,b)}this.browserUrlTree=b.urlAfterRedirects}}else if(d instanceof Of)this.currentUrlTree=b.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(b.urlAfterRedirects,b.rawUrl),this.routerState=b.targetRouterState,"deferred"===this.urlUpdateStrategy&&(b.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,b),this.browserUrlTree=b.urlAfterRedirects);else if(d instanceof ds)0!==d.code&&1!==d.code&&(this.navigated=!0),(3===d.code||2===d.code)&&this.restoreHistory(b);else if(d instanceof Rf){const D=this.urlHandlingStrategy.merge(d.url,b.currentRawUrl),k={skipLocationChange:b.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||gc(b.source)};this.scheduleNavigation(D,fh,null,k,{resolve:b.resolve,reject:b.reject,promise:b.promise})}d instanceof eo&&this.restoreHistory(b,!0),d instanceof Ys&&(this.navigated=!0),md(d)&&this._events.next(d)}catch(b){this.navigationTransitions.transitionAbortSubject.next(b)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const n=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),fh,n)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const d="popstate"===n.type?"popstate":"hashchange";"popstate"===d&&setTimeout(()=>{this.navigateToSyncWithBrowser(n.url,d,n.state)},0)}))}navigateToSyncWithBrowser(n,d,b){const D={replaceUrl:!0},k=b?.navigationId?b:null;if(b){const W={...b};delete W.navigationId,delete W.\u0275routerPageId,0!==Object.keys(W).length&&(D.state=W)}const H=this.parseUrl(n);this.scheduleNavigation(H,d,k,D)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(yh),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,d={}){const{relativeTo:b,queryParams:D,fragment:k,queryParamsHandling:H,preserveFragment:W}=d,fe=W?this.currentUrlTree.fragment:k;let ft,we=null;switch(H){case"merge":we={...this.currentUrlTree.queryParams,...D};break;case"preserve":we=this.currentUrlTree.queryParams;break;default:we=D||null}null!==we&&(we=this.removeEmptyProps(we));try{ft=ch(b?b.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||!n[0].startsWith("/"))&&(n=[]),ft=this.currentUrlTree.root}return Ts(ft,n,we,fe??null)}navigateByUrl(n,d={skipLocationChange:!1}){const b=_n(n)?n:this.parseUrl(n),D=this.urlHandlingStrategy.merge(b,this.rawUrlTree);return this.scheduleNavigation(D,fh,null,d)}navigate(n,d={skipLocationChange:!1}){return function av(i){for(let e=0;e<i.length;e++)if(null==i[e])throw new E.vHH(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,d),d)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let d;try{d=this.urlSerializer.parse(n)}catch(b){d=this.malformedUriErrorHandler(b,this.urlSerializer,n)}return d}isActive(n,d){let b;if(b=!0===d?{...Zf}:!1===d?{...ub}:d,_n(n))return Ja(this.currentUrlTree,n,b);const D=this.parseUrl(n);return Ja(this.currentUrlTree,D,b)}removeEmptyProps(n){return Object.keys(n).reduce((d,b)=>{const D=n[b];return null!=D&&(d[b]=D),d},{})}scheduleNavigation(n,d,b,D,k){if(this.disposed)return Promise.resolve(!1);let H,W,fe;k?(H=k.resolve,W=k.reject,fe=k.promise):fe=new Promise((ft,Je)=>{H=ft,W=Je});const we=this.pendingTasks.add();return h_(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(we))}),this.navigationTransitions.handleNavigationRequest({source:d,restoredState:b,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:n,extras:D,resolve:H,reject:W,promise:fe,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),fe.catch(ft=>Promise.reject(ft))}setBrowserUrl(n,d){const b=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(b)||d.extras.replaceUrl){const k={...d.extras.state,...this.generateNgRouterState(d.id,this.browserPageId)};this.location.replaceState(b,"",k)}else{const D={...d.extras.state,...this.generateNgRouterState(d.id,this.browserPageId+1)};this.location.go(b,"",D)}}restoreHistory(n,d=!1){if("computed"===this.canceledNavigationResolution){const D=this.currentPageId-this.browserPageId;0!==D?this.location.historyGo(D):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===D&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(d&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,d){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:d}:{navigationId:n}}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();function md(i){return!(i instanceof Of||i instanceof Rf)}let Mh=(()=>{var i;class e{constructor(n,d,b,D,k,H){this.router=n,this.route=d,this.tabIndexAttribute=b,this.renderer=D,this.el=k,this.locationStrategy=H,this.href=null,this.commands=null,this.onChanges=new bt.x,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const W=k.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===W||"area"===W,this.isAnchorElement?this.subscription=n.events.subscribe(fe=>{fe instanceof Ys&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(n,d,b,D,k){return!!(null===this.urlTree||this.isAnchorElement&&(0!==n||d||b||D||k||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const n=null===this.href?null:(0,E.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",n)}applyAttributeValue(n,d){const b=this.renderer,D=this.el.nativeElement;null!==d?b.setAttribute(D,n,d):b.removeAttribute(D,n)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(_o),E.Y36(hc),E.$8M("tabindex"),E.Y36(E.Qsj),E.Y36(E.SBq),E.Y36(It))},i.\u0275dir=E.lG2({type:i,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(n,d){1&n&&E.NdJ("click",function(D){return d.onClick(D.button,D.ctrlKey,D.shiftKey,D.altKey,D.metaKey)}),2&n&&E.uIk("target",d.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",E.VuI],skipLocationChange:["skipLocationChange","skipLocationChange",E.VuI],replaceUrl:["replaceUrl","replaceUrl",E.VuI],routerLink:"routerLink"},standalone:!0,features:[E.Xq5,E.TTD]}),e})();class gd{}let f_=(()=>{var i;class e{constructor(n,d,b,D,k){this.router=n,this.injector=b,this.preloadingStrategy=D,this.loader=k}setUpPreloading(){this.subscription=this.router.events.pipe((0,gt.h)(n=>n instanceof Ys),(0,Jn.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,d){const b=[];for(const D of d){D.providers&&!D._injector&&(D._injector=(0,E.MMx)(D.providers,n,`Route: ${D.path}`));const k=D._injector??n,H=D._loadedInjector??k;(D.loadChildren&&!D._loadedRoutes&&void 0===D.canLoad||D.loadComponent&&!D._loadedComponent)&&b.push(this.preloadConfig(k,D)),(D.children||D._loadedRoutes)&&b.push(this.processRoutes(H,D.children??D._loadedRoutes))}return(0,fr.D)(b).pipe((0,pe.J)())}preloadConfig(n,d){return this.preloadingStrategy.preload(d,()=>{let b;b=d.loadChildren&&void 0===d.canLoad?this.loader.loadChildren(n,d):(0,Nn.of)(null);const D=b.pipe((0,wt.z)(k=>null===k?(0,Nn.of)(void 0):(d._loadedRoutes=k.routes,d._loadedInjector=k.injector,this.processRoutes(k.injector??n,k.routes))));if(d.loadComponent&&!d._loadedComponent){const k=this.loader.loadComponent(d);return(0,fr.D)([D,k]).pipe((0,pe.J)())}return D})}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(_o),E.LFG(E.Sil),E.LFG(E.lqb),E.LFG(gd),E.LFG(d_))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();const Dm=new E.OlP("");let Wf=(()=>{var i;class e{constructor(n,d,b,D,k={}){this.urlSerializer=n,this.transitions=d,this.viewportScroller=b,this.zone=D,this.options=k,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},k.scrollPositionRestoration=k.scrollPositionRestoration||"disabled",k.anchorScrolling=k.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof tu?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Ys?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof dc&&0===n.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof iu&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,d){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new iu(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,d))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return(i=e).\u0275fac=function(n){E.$Z()},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();function Xs(i,e){return{\u0275kind:i,\u0275providers:e}}function zi(){const i=(0,E.f3M)(E.zs3);return e=>{const s=i.get(E.z2F);if(e!==s.components[0])return;const n=i.get(_o),d=i.get(Sh);1===i.get(Sm)&&n.initialNavigation(),i.get(Kf,null,E.XFs.Optional)?.setUpPreloading(),i.get(Dm,null,E.XFs.Optional)?.init(),n.resetRootComponentType(s.componentTypes[0]),d.closed||(d.next(),d.complete(),d.unsubscribe())}}const Sh=new E.OlP("",{factory:()=>new bt.x}),Sm=new E.OlP("",{providedIn:"root",factory:()=>1}),Kf=new E.OlP("");function uv(i){return Xs(0,[{provide:Kf,useExisting:f_},{provide:gd,useExisting:i}])}const Jf=new E.OlP("ROUTER_FORROOT_GUARD"),dv=[Cn,{provide:cc,useClass:qs},_o,ru,{provide:hc,useFactory:function p_(i){return i.routerState.root},deps:[_o]},d_,[]];function g_(){return new E.PXZ("Router",_o)}let Nl=(()=>{var i;class e{constructor(n){}static forRoot(n,d){return{ngModule:e,providers:[dv,[],{provide:cu,multi:!0,useValue:n},{provide:Jf,useFactory:fv,deps:[[_o,new E.FiY,new E.tp0]]},{provide:Mm,useValue:d||{}},d?.useHash?{provide:It,useClass:Ot}:{provide:It,useClass:on},{provide:Dm,useFactory:()=>{const i=(0,E.f3M)(Wo),e=(0,E.f3M)(E.R0b),s=(0,E.f3M)(Mm),n=(0,E.f3M)(ki),d=(0,E.f3M)(cc);return s.scrollOffset&&i.setOffset(s.scrollOffset),new Wf(d,n,i,e,s)}},d?.preloadingStrategy?uv(d.preloadingStrategy).\u0275providers:[],{provide:E.PXZ,multi:!0,useFactory:g_},d?.initialNavigation?__(d):[],d?.bindToComponentInputs?Xs(8,[Oa,{provide:ph,useExisting:Oa}]).\u0275providers:[],[{provide:ep,useFactory:zi},{provide:E.tb,multi:!0,useExisting:ep}]]}}static forChild(n){return{ngModule:e,providers:[{provide:cu,multi:!0,useValue:n}]}}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Jf,8))},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({}),e})();function fv(i){return"guarded"}function __(i){return["disabled"===i.initialNavigation?Xs(3,[{provide:E.ip1,multi:!0,useFactory:()=>{const e=(0,E.f3M)(_o);return()=>{e.setUpLocationChangeListener()}}},{provide:Sm,useValue:2}]).\u0275providers:[],"enabledBlocking"===i.initialNavigation?Xs(2,[{provide:Sm,useValue:0},{provide:E.ip1,multi:!0,deps:[E.zs3],useFactory:e=>{const s=e.get(Le,Promise.resolve());return()=>s.then(()=>new Promise(n=>{const d=e.get(_o),b=e.get(Sh);h_(d,()=>{n(!0)}),e.get(ki).afterPreactivation=()=>(n(!0),b.closed?(0,Nn.of)(void 0):b),d.initialNavigation()}))}}]).\u0275providers:[]]}const ep=new E.OlP("");var Ct=ne(4221);const Rm=(0,Ct.ZF)("blogs"),pv=(0,Ct.P1)(Rm,i=>i.blogs),v_=(0,Ct.P1)(Rm,i=>i.loading),mv=(0,Ct.P1)(Rm,i=>i.error),gv=((0,Ct.P1)(pv,i=>{const e=localStorage.getItem("userId");return e?i.filter(s=>s.userId===e):[]}),(0,Ct.ZF)("getComments")),b_=(0,Ct.P1)(gv,i=>i.message),x_=(0,Ct.ZF)("getBlogById"),fb=(0,Ct.P1)(x_,i=>i),Ph=(0,Ct.PH)("[Blog] Load Blogs"),km=(0,Ct.PH)("[Blog] Load Blogs Success",(0,Ct.Ky)()),_v=(0,Ct.PH)("[Blog] Load Blogs Failure",(0,Ct.Ky)()),Oh=((0,Ct.PH)("[Blog] Load Blogs By User Id",(0,Ct.Ky)()),(0,Ct.PH)("[Get Blog By Id] Get Blog By Id",(0,Ct.Ky)())),yv=(0,Ct.PH)("[Get Blog By Id Success] Get Blog By Id Success",(0,Ct.Ky)()),tp=(0,Ct.PH)("[Like] Like Blog",(0,Ct.Ky)()),Fm=(0,Ct.PH)("[Like Success] Like Success Blog",(0,Ct.Ky)()),yc=(0,Ct.PH)("[Dislike] Dislike Blog",(0,Ct.Ky)()),Lm=(0,Ct.PH)("[Dislike Success] Dislike Success Blog",(0,Ct.Ky)()),kr=(0,Ct.PH)("[Get Comments] Get Comments",(0,Ct.Ky)()),hs=(0,Ct.PH)("[Get Comments Success] Get Comments Success",(0,Ct.Ky)()),uu=(0,Ct.PH)("[Add Comment] Add Comment",(0,Ct.Ky)()),Bl=(0,Ct.PH)("[Add Comment Success] Add Comment Success",(0,Ct.Ky)()),ul_apiUrl="https://erin-awful-turkey.cyclic.cloud";class Nm{constructor(e,s,n,d){this.username=e,this.token=s,this.userId=n,this.expiresIn=d}get expireDate(){return this.expiresIn}get userToken(){return this.token}}class yd{}class vd{}class Ks{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?"string"==typeof e?this.lazyInit=()=>{this.headers=new Map,e.split("\n").forEach(s=>{const n=s.indexOf(":");if(n>0){const d=s.slice(0,n),b=d.toLowerCase(),D=s.slice(n+1).trim();this.maybeSetNormalizedName(d,b),this.headers.has(b)?this.headers.get(b).push(D):this.headers.set(b,[D])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((s,n)=>{this.setHeaderEntries(n,s)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([s,n])=>{this.setHeaderEntries(s,n)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const s=this.headers.get(e.toLowerCase());return s&&s.length>0?s[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,s){return this.clone({name:e,value:s,op:"a"})}set(e,s){return this.clone({name:e,value:s,op:"s"})}delete(e,s){return this.clone({name:e,value:s,op:"d"})}maybeSetNormalizedName(e,s){this.normalizedNames.has(s)||this.normalizedNames.set(s,e)}init(){this.lazyInit&&(this.lazyInit instanceof Ks?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(s=>{this.headers.set(s,e.headers.get(s)),this.normalizedNames.set(s,e.normalizedNames.get(s))})}clone(e){const s=new Ks;return s.lazyInit=this.lazyInit&&this.lazyInit instanceof Ks?this.lazyInit:this,s.lazyUpdate=(this.lazyUpdate||[]).concat([e]),s}applyUpdate(e){const s=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(e.name,s);const d=("a"===e.op?this.headers.get(s):void 0)||[];d.push(...n),this.headers.set(s,d);break;case"d":const b=e.value;if(b){let D=this.headers.get(s);if(!D)return;D=D.filter(k=>-1===b.indexOf(k)),0===D.length?(this.headers.delete(s),this.normalizedNames.delete(s)):this.headers.set(s,D)}else this.headers.delete(s),this.normalizedNames.delete(s)}}setHeaderEntries(e,s){const n=(Array.isArray(s)?s:[s]).map(b=>b.toString()),d=e.toLowerCase();this.headers.set(d,n),this.maybeSetNormalizedName(e,d)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(s=>e(this.normalizedNames.get(s),this.headers.get(s)))}}class vv{encodeKey(e){return Rh(e)}encodeValue(e){return Rh(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const bv=/%(\d[a-f0-9])/gi,Ji={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Rh(i){return encodeURIComponent(i).replace(bv,(e,s)=>Ji[s]??e)}function kh(i){return`${i}`}class vc{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new vv,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function w_(i,e){const s=new Map;return i.length>0&&i.replace(/^\?/,"").split("&").forEach(d=>{const b=d.indexOf("="),[D,k]=-1==b?[e.decodeKey(d),""]:[e.decodeKey(d.slice(0,b)),e.decodeValue(d.slice(b+1))],H=s.get(D)||[];H.push(k),s.set(D,H)}),s}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(s=>{const n=e.fromObject[s],d=Array.isArray(n)?n.map(kh):[kh(n)];this.map.set(s,d)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const s=this.map.get(e);return s?s[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,s){return this.clone({param:e,value:s,op:"a"})}appendAll(e){const s=[];return Object.keys(e).forEach(n=>{const d=e[n];Array.isArray(d)?d.forEach(b=>{s.push({param:n,value:b,op:"a"})}):s.push({param:n,value:d,op:"a"})}),this.clone(s)}set(e,s){return this.clone({param:e,value:s,op:"s"})}delete(e,s){return this.clone({param:e,value:s,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const s=this.encoder.encodeKey(e);return this.map.get(e).map(n=>s+"="+this.encoder.encodeValue(n)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const s=new vc({encoder:this.encoder});return s.cloneFrom=this.cloneFrom||this,s.updates=(this.updates||[]).concat(e),s}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const s=("a"===e.op?this.map.get(e.param):void 0)||[];s.push(kh(e.value)),this.map.set(e.param,s);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let n=this.map.get(e.param)||[];const d=n.indexOf(kh(e.value));-1!==d&&n.splice(d,1),n.length>0?this.map.set(e.param,n):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class np{constructor(){this.map=new Map}set(e,s){return this.map.set(e,s),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function ip(i){return typeof ArrayBuffer<"u"&&i instanceof ArrayBuffer}function zm(i){return typeof Blob<"u"&&i instanceof Blob}function wv(i){return typeof FormData<"u"&&i instanceof FormData}class bd{constructor(e,s,n,d){let b;if(this.url=s,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function xv(i){switch(i){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||d?(this.body=void 0!==n?n:null,b=d):b=n,b&&(this.reportProgress=!!b.reportProgress,this.withCredentials=!!b.withCredentials,b.responseType&&(this.responseType=b.responseType),b.headers&&(this.headers=b.headers),b.context&&(this.context=b.context),b.params&&(this.params=b.params)),this.headers||(this.headers=new Ks),this.context||(this.context=new np),this.params){const D=this.params.toString();if(0===D.length)this.urlWithParams=s;else{const k=s.indexOf("?");this.urlWithParams=s+(-1===k?"?":k<s.length-1?"&":"")+D}}else this.params=new vc,this.urlWithParams=s}serializeBody(){return null===this.body?null:ip(this.body)||zm(this.body)||wv(this.body)||function Ev(i){return typeof URLSearchParams<"u"&&i instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof vc?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||wv(this.body)?null:zm(this.body)?this.body.type||null:ip(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof vc?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const s=e.method||this.method,n=e.url||this.url,d=e.responseType||this.responseType,b=void 0!==e.body?e.body:this.body,D=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,k=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let H=e.headers||this.headers,W=e.params||this.params;const fe=e.context??this.context;return void 0!==e.setHeaders&&(H=Object.keys(e.setHeaders).reduce((we,ft)=>we.set(ft,e.setHeaders[ft]),H)),e.setParams&&(W=Object.keys(e.setParams).reduce((we,ft)=>we.set(ft,e.setParams[ft]),W)),new bd(s,n,b,{params:W,headers:H,context:fe,reportProgress:k,responseType:d,withCredentials:D})}}var bc=function(i){return i[i.Sent=0]="Sent",i[i.UploadProgress=1]="UploadProgress",i[i.ResponseHeader=2]="ResponseHeader",i[i.DownloadProgress=3]="DownloadProgress",i[i.Response=4]="Response",i[i.User=5]="User",i}(bc||{});class E_{constructor(e,s=200,n="OK"){this.headers=e.headers||new Ks,this.status=void 0!==e.status?e.status:s,this.statusText=e.statusText||n,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class Vm extends E_{constructor(e={}){super(e),this.type=bc.ResponseHeader}clone(e={}){return new Vm({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class Fh extends E_{constructor(e={}){super(e),this.type=bc.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new Fh({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class Lh extends E_{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function xd(i,e){return{body:e,headers:i.headers,context:i.context,observe:i.observe,params:i.params,reportProgress:i.reportProgress,responseType:i.responseType,withCredentials:i.withCredentials}}let Nh=(()=>{var i;class e{constructor(n){this.handler=n}request(n,d,b={}){let D;if(n instanceof bd)D=n;else{let W,fe;W=b.headers instanceof Ks?b.headers:new Ks(b.headers),b.params&&(fe=b.params instanceof vc?b.params:new vc({fromObject:b.params})),D=new bd(n,d,void 0!==b.body?b.body:null,{headers:W,context:b.context,params:fe,reportProgress:b.reportProgress,responseType:b.responseType||"json",withCredentials:b.withCredentials})}const k=(0,Nn.of)(D).pipe((0,Jn.b)(W=>this.handler.handle(W)));if(n instanceof bd||"events"===b.observe)return k;const H=k.pipe((0,gt.h)(W=>W instanceof Fh));switch(b.observe||"body"){case"body":switch(D.responseType){case"arraybuffer":return H.pipe((0,R.U)(W=>{if(null!==W.body&&!(W.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return W.body}));case"blob":return H.pipe((0,R.U)(W=>{if(null!==W.body&&!(W.body instanceof Blob))throw new Error("Response is not a Blob.");return W.body}));case"text":return H.pipe((0,R.U)(W=>{if(null!==W.body&&"string"!=typeof W.body)throw new Error("Response is not a string.");return W.body}));default:return H.pipe((0,R.U)(W=>W.body))}case"response":return H;default:throw new Error(`Unreachable: unhandled observe type ${b.observe}}`)}}delete(n,d={}){return this.request("DELETE",n,d)}get(n,d={}){return this.request("GET",n,d)}head(n,d={}){return this.request("HEAD",n,d)}jsonp(n,d){return this.request("JSONP",n,{params:(new vc).append(d,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,d={}){return this.request("OPTIONS",n,d)}patch(n,d,b={}){return this.request("PATCH",n,xd(b,d))}post(n,d,b={}){return this.request("POST",n,xd(b,d))}put(n,d,b={}){return this.request("PUT",n,xd(b,d))}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(yd))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();function fs(i,e){return e(i)}function T_(i,e){return(s,n)=>e.intercept(s,{handle:d=>i(d,n)})}const Js=new E.OlP(""),hu=new E.OlP(""),op=new E.OlP("");function xc(){let i=null;return(e,s)=>{null===i&&(i=((0,E.f3M)(Js,{optional:!0})??[]).reduceRight(T_,fs));const n=(0,E.f3M)(E.HDt),d=n.add();return i(e,s).pipe(Pr(()=>n.remove(d)))}}let sp=(()=>{var i;class e extends yd{constructor(n,d){super(),this.backend=n,this.injector=d,this.chain=null,this.pendingTasks=(0,E.f3M)(E.HDt)}handle(n){if(null===this.chain){const b=Array.from(new Set([...this.injector.get(hu),...this.injector.get(op,[])]));this.chain=b.reduceRight((D,k)=>function M_(i,e,s){return(n,d)=>s.runInContext(()=>e(n,b=>i(b,d)))}(D,k,this.injector),fs)}const d=this.pendingTasks.add();return this.chain(n,b=>this.backend.handle(b)).pipe(Pr(()=>this.pendingTasks.remove(d)))}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(vd),E.LFG(E.lqb))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();const ga=/^\)\]\}',?\n/;let S_=(()=>{var i;class e{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new E.vHH(-2800,!1);const d=this.xhrFactory;return(d.\u0275loadImpl?(0,fr.D)(d.\u0275loadImpl()):(0,Nn.of)(null)).pipe((0,He.w)(()=>new Xo.y(D=>{const k=d.build();if(k.open(n.method,n.urlWithParams),n.withCredentials&&(k.withCredentials=!0),n.headers.forEach((sn,Dn)=>k.setRequestHeader(sn,Dn.join(","))),n.headers.has("Accept")||k.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const sn=n.detectContentTypeHeader();null!==sn&&k.setRequestHeader("Content-Type",sn)}if(n.responseType){const sn=n.responseType.toLowerCase();k.responseType="json"!==sn?sn:"text"}const H=n.serializeBody();let W=null;const fe=()=>{if(null!==W)return W;const sn=k.statusText||"OK",Dn=new Ks(k.getAllResponseHeaders()),oi=function Iv(i){return"responseURL"in i&&i.responseURL?i.responseURL:/^X-Request-URL:/m.test(i.getAllResponseHeaders())?i.getResponseHeader("X-Request-URL"):null}(k)||n.url;return W=new Vm({headers:Dn,status:k.status,statusText:sn,url:oi}),W},we=()=>{let{headers:sn,status:Dn,statusText:oi,url:_r}=fe(),wi=null;204!==Dn&&(wi=typeof k.response>"u"?k.responseText:k.response),0===Dn&&(Dn=wi?200:0);let ys=Dn>=200&&Dn<300;if("json"===n.responseType&&"string"==typeof wi){const yl=wi;wi=wi.replace(ga,"");try{wi=""!==wi?JSON.parse(wi):null}catch(bo){wi=yl,ys&&(ys=!1,wi={error:bo,text:wi})}}ys?(D.next(new Fh({body:wi,headers:sn,status:Dn,statusText:oi,url:_r||void 0})),D.complete()):D.error(new Lh({error:wi,headers:sn,status:Dn,statusText:oi,url:_r||void 0}))},ft=sn=>{const{url:Dn}=fe(),oi=new Lh({error:sn,status:k.status||0,statusText:k.statusText||"Unknown Error",url:Dn||void 0});D.error(oi)};let Je=!1;const ht=sn=>{Je||(D.next(fe()),Je=!0);let Dn={type:bc.DownloadProgress,loaded:sn.loaded};sn.lengthComputable&&(Dn.total=sn.total),"text"===n.responseType&&k.responseText&&(Dn.partialText=k.responseText),D.next(Dn)},qt=sn=>{let Dn={type:bc.UploadProgress,loaded:sn.loaded};sn.lengthComputable&&(Dn.total=sn.total),D.next(Dn)};return k.addEventListener("load",we),k.addEventListener("error",ft),k.addEventListener("timeout",ft),k.addEventListener("abort",ft),n.reportProgress&&(k.addEventListener("progress",ht),null!==H&&k.upload&&k.upload.addEventListener("progress",qt)),k.send(H),D.next({type:bc.Sent}),()=>{k.removeEventListener("error",ft),k.removeEventListener("abort",ft),k.removeEventListener("load",we),k.removeEventListener("timeout",ft),n.reportProgress&&(k.removeEventListener("progress",ht),null!==H&&k.upload&&k.upload.removeEventListener("progress",qt)),k.readyState!==k.DONE&&k.abort()}})))}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG($s))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();const $m=new E.OlP("XSRF_ENABLED"),hl=new E.OlP("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),I_=new E.OlP("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class Pv{}let Xr=(()=>{var i;class e{constructor(n,d,b){this.doc=n,this.platform=d,this.cookieName=b,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=Uo(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ye),E.LFG(E.Lbi),E.LFG(hl))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();function Ov(i,e){const s=i.url.toLowerCase();if(!(0,E.f3M)($m)||"GET"===i.method||"HEAD"===i.method||s.startsWith("http://")||s.startsWith("https://"))return e(i);const n=(0,E.f3M)(Pv).getToken(),d=(0,E.f3M)(I_);return null!=n&&!i.headers.has(d)&&(i=i.clone({headers:i.headers.set(d,n)})),e(i)}var ko=function(i){return i[i.Interceptors=0]="Interceptors",i[i.LegacyInterceptors=1]="LegacyInterceptors",i[i.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",i[i.NoXsrfProtection=3]="NoXsrfProtection",i[i.JsonpSupport=4]="JsonpSupport",i[i.RequestsMadeViaParent=5]="RequestsMadeViaParent",i[i.Fetch=6]="Fetch",i}(ko||{});function wc(i,e){return{\u0275kind:i,\u0275providers:e}}function fu(...i){const e=[Nh,S_,sp,{provide:yd,useExisting:sp},{provide:vd,useExisting:S_},{provide:hu,useValue:Ov,multi:!0},{provide:$m,useValue:!0},{provide:Pv,useClass:Xr}];for(const s of i)e.push(...s.\u0275providers);return(0,E.MR2)(e)}const Gm=new E.OlP("LEGACY_INTERCEPTOR_FN");let zl=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({providers:[fu(wc(ko.LegacyInterceptors,[{provide:Gm,useFactory:xc},{provide:hu,useExisting:Gm,multi:!0}]))]}),e})(),cp=(()=>{var i;class e{constructor(n){this.http=n,this.apiUrl=ul_apiUrl}login(n,d){return this.http.post(`${this.apiUrl}/login`,{email:n,password:d})}register(n){return this.http.post(`${this.apiUrl}/register`,n)}formatUser(n){const d=new Date((new Date).getTime()+1e3*+n.expiresIn);return new Nm(n.username,n.token,n.userId,d)}runTimeoutInterval(n){const d=(new Date).getTime(),D=n.expireDate.getTime()-d;this.timeoutInterval=setTimeout(()=>{},D)}setUserInLocalStorage(n){localStorage.setItem("userData",JSON.stringify(n)),this.runTimeoutInterval(n)}getUserFromLocalStorage(){const n=localStorage.getItem("userData");if(n){const d=JSON.parse(n),b=new Date(d.expirationDate),D=new Nm(d.username,d.token,d.userId,b);return this.runTimeoutInterval(D),D}return null}getUserId(){const n=localStorage.getItem("userData");return n?JSON.parse(n).userId:null}logout(){localStorage.removeItem("userData"),this.timeoutInterval&&(clearTimeout(this.timeoutInterval),this.timeoutInterval=null)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Nh))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),La=(()=>{var i;class e{constructor(n,d){this._renderer=n,this._elementRef=d,this.onChange=b=>{},this.onTouched=()=>{}}setProperty(n,d){this._renderer.setProperty(this._elementRef.nativeElement,n,d)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(E.Qsj),E.Y36(E.SBq))},i.\u0275dir=E.lG2({type:i}),e})(),Cc=(()=>{var i;class e extends La{}return(i=e).\u0275fac=function(){let s;return function(d){return(s||(s=E.n5z(i)))(d||i)}}(),i.\u0275dir=E.lG2({type:i,features:[E.qOj]}),e})();const Na=new E.OlP("NgValueAccessor"),vb={provide:Na,useExisting:(0,E.Gpc)(()=>jh),multi:!0},pu=new E.OlP("CompositionEventMode");let jh=(()=>{var i;class e extends La{constructor(n,d,b){super(n,d),this._compositionMode=b,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Fv(){const i=rt()?rt().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}())}writeValue(n){this.setProperty("value",n??"")}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(E.Qsj),E.Y36(E.SBq),E.Y36(pu,8))},i.\u0275dir=E.lG2({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,d){1&n&&E.NdJ("input",function(D){return d._handleInput(D.target.value)})("blur",function(){return d.onTouched()})("compositionstart",function(){return d._compositionStart()})("compositionend",function(D){return d._compositionEnd(D.target.value)})},features:[E._Bn([vb]),E.qOj]}),e})();function Os(i){return null==i||("string"==typeof i||Array.isArray(i))&&0===i.length}function bb(i){return null!=i&&"number"==typeof i.length}const yo=new E.OlP("NgValidators"),_a=new E.OlP("NgAsyncValidators"),$h=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Rs{static min(e){return function Hh(i){return e=>{if(Os(e.value)||Os(i))return null;const s=parseFloat(e.value);return!isNaN(s)&&s<i?{min:{min:i,actual:e.value}}:null}}(e)}static max(e){return function up(i){return e=>{if(Os(e.value)||Os(i))return null;const s=parseFloat(e.value);return!isNaN(s)&&s>i?{max:{max:i,actual:e.value}}:null}}(e)}static required(e){return O_(e)}static requiredTrue(e){return function mu(i){return!0===i.value?null:{required:!0}}(e)}static email(e){return function Gh(i){return Os(i.value)||$h.test(i.value)?null:{email:!0}}(e)}static minLength(e){return function di(i){return e=>Os(e.value)||!bb(e.value)?null:e.value.length<i?{minlength:{requiredLength:i,actualLength:e.value.length}}:null}(e)}static maxLength(e){return function Jm(i){return e=>bb(e.value)&&e.value.length>i?{maxlength:{requiredLength:i,actualLength:e.value.length}}:null}(e)}static pattern(e){return function Qm(i){if(!i)return Tc;let e,s;return"string"==typeof i?(s="","^"!==i.charAt(0)&&(s+="^"),s+=i,"$"!==i.charAt(i.length-1)&&(s+="$"),e=new RegExp(s)):(s=i.toString(),e=i),n=>{if(Os(n.value))return null;const d=n.value;return e.test(d)?null:{pattern:{requiredPattern:s,actualValue:d}}}}(e)}static nullValidator(e){return null}static compose(e){return R_(e)}static composeAsync(e){return Cd(e)}}function O_(i){return Os(i.value)?{required:!0}:null}function Tc(i){return null}function eg(i){return null!=i}function Lv(i){return(0,E.QGY)(i)?(0,fr.D)(i):i}function Zh(i){let e={};return i.forEach(s=>{e=null!=s?{...e,...s}:e}),0===Object.keys(e).length?null:e}function Ed(i,e){return e.map(s=>s(i))}function Wh(i){return i.map(e=>function tg(i){return!i.validate}(e)?e:s=>e.validate(s))}function R_(i){if(!i)return null;const e=i.filter(eg);return 0==e.length?null:function(s){return Zh(Ed(s,e))}}function gu(i){return null!=i?R_(Wh(i)):null}function Cd(i){if(!i)return null;const e=i.filter(eg);return 0==e.length?null:function(s){return function Vl(...i){const e=(0,j.jO)(i),{args:s,keys:n}=v(i),d=new Xo.y(b=>{const{length:D}=s;if(!D)return void b.complete();const k=new Array(D);let H=D,W=D;for(let fe=0;fe<D;fe++){let we=!1;(0,Me.Xf)(s[fe]).subscribe((0,ee.x)(b,ft=>{we||(we=!0,W--),k[fe]=ft},()=>H--,void 0,()=>{(!H||!we)&&(W||b.next(n?X(n,k):k),b.complete())}))}});return e?d.pipe($(e)):d}(Ed(s,e).map(Lv)).pipe((0,R.U)(Zh))}}function _u(i){return null!=i?Cd(Wh(i)):null}function k_(i,e){return null===i?[e]:Array.isArray(i)?[...i,e]:[i,e]}function qh(i){return i._rawValidators}function ng(i){return i._rawAsyncValidators}function Ul(i){return i?Array.isArray(i)?i:[i]:[]}function ig(i,e){return Array.isArray(i)?i.includes(e):i===e}function dp(i,e){const s=Ul(e);return Ul(i).forEach(d=>{ig(s,d)||s.push(d)}),s}function F_(i,e){return Ul(e).filter(s=>!ig(i,s))}class hp{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=gu(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=_u(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,s){return!!this.control&&this.control.hasError(e,s)}getError(e,s){return this.control?this.control.getError(e,s):null}}class ks extends hp{get formDirective(){return null}get path(){return null}}class yu extends hp{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class L_{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let fp=(()=>{var i;class e extends L_{constructor(n){super(n)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(yu,2))},i.\u0275dir=E.lG2({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,d){2&n&&E.ekj("ng-untouched",d.isUntouched)("ng-touched",d.isTouched)("ng-pristine",d.isPristine)("ng-dirty",d.isDirty)("ng-valid",d.isValid)("ng-invalid",d.isInvalid)("ng-pending",d.isPending)},features:[E.qOj]}),e})(),to=(()=>{var i;class e extends L_{constructor(n){super(n)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(ks,10))},i.\u0275dir=E.lG2({type:i,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,d){2&n&&E.ekj("ng-untouched",d.isUntouched)("ng-touched",d.isTouched)("ng-pristine",d.isPristine)("ng-dirty",d.isDirty)("ng-valid",d.isValid)("ng-invalid",d.isInvalid)("ng-pending",d.isPending)("ng-submitted",d.isSubmitted)},features:[E.qOj]}),e})();const Fs="VALID",Dd="INVALID",Sd="PENDING",Id="DISABLED";function og(i){return(Yh(i)?i.validators:i)||null}function pl(i,e){return(Yh(e)?e.asyncValidators:i)||null}function Yh(i){return null!=i&&!Array.isArray(i)&&"object"==typeof i}class $_{constructor(e,s){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(s)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Fs}get invalid(){return this.status===Dd}get pending(){return this.status==Sd}get disabled(){return this.status===Id}get enabled(){return this.status!==Id}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(dp(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(dp(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(F_(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(F_(e,this._rawAsyncValidators))}hasValidator(e){return ig(this._rawValidators,e)}hasAsyncValidator(e){return ig(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(s=>{s.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(s=>{s.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Sd,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const s=this._parentMarkedDirty(e.onlySelf);this.status=Id,this.errors=null,this._forEachChild(n=>{n.disable({...e,onlySelf:!0})}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...e,skipPristineCheck:s}),this._onDisabledChange.forEach(n=>n(!0))}enable(e={}){const s=this._parentMarkedDirty(e.onlySelf);this.status=Fs,this._forEachChild(n=>{n.enable({...e,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors({...e,skipPristineCheck:s}),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Fs||this.status===Sd)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(s=>s._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Id:Fs}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Sd,this._hasOwnPendingAsyncValidator=!0;const s=Lv(this.asyncValidator(this));this._asyncValidationSubscription=s.subscribe(n=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(n,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,s={}){this.errors=e,this._updateControlsErrors(!1!==s.emitEvent)}get(e){let s=e;return null==s||(Array.isArray(s)||(s=s.split(".")),0===s.length)?null:s.reduce((n,d)=>n&&n._find(d),this)}getError(e,s){const n=s?this.get(s):this;return n&&n.errors?n.errors[e]:null}hasError(e,s){return!!this.getError(e,s)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new E.vpe,this.statusChanges=new E.vpe}_calculateStatus(){return this._allControlsDisabled()?Id:this.errors?Dd:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Sd)?Sd:this._anyControlsHaveStatus(Dd)?Dd:Fs}_anyControlsHaveStatus(e){return this._anyControls(s=>s.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Yh(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=function j_(i){return Array.isArray(i)?gu(i):i||null}(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=function mp(i){return Array.isArray(i)?_u(i):i||null}(this._rawAsyncValidators)}}class ya extends $_{constructor(e,s,n){super(og(s),pl(n,s)),this.controls=e,this._initObservables(),this._setUpdateStrategy(s),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,s){return this.controls[e]?this.controls[e]:(this.controls[e]=s,s.setParent(this),s._registerOnCollectionChange(this._onCollectionChange),s)}addControl(e,s,n={}){this.registerControl(e,s),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,s={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}setControl(e,s,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],s&&this.registerControl(e,s),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,s={}){(function Xh(i,e,s){i._forEachChild((n,d)=>{if(void 0===s[d])throw new E.vHH(1002,"")})})(this,0,e),Object.keys(e).forEach(n=>{(function Cb(i,e,s){const n=i.controls;if(!(e?Object.keys(n):n).length)throw new E.vHH(1e3,"");if(!n[s])throw new E.vHH(1001,"")})(this,!0,n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:s.emitEvent})}),this.updateValueAndValidity(s)}patchValue(e,s={}){null!=e&&(Object.keys(e).forEach(n=>{const d=this.controls[n];d&&d.patchValue(e[n],{onlySelf:!0,emitEvent:s.emitEvent})}),this.updateValueAndValidity(s))}reset(e={},s={}){this._forEachChild((n,d)=>{n.reset(e[d],{onlySelf:!0,emitEvent:s.emitEvent})}),this._updatePristine(s),this._updateTouched(s),this.updateValueAndValidity(s)}getRawValue(){return this._reduceChildren({},(e,s,n)=>(e[n]=s.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(s,n)=>!!n._syncPendingControls()||s);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(s=>{const n=this.controls[s];n&&e(n,s)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const[s,n]of Object.entries(this.controls))if(this.contains(s)&&e(n))return!0;return!1}_reduceValue(){return this._reduceChildren({},(s,n,d)=>((n.enabled||this.disabled)&&(s[d]=n.value),s))}_reduceChildren(e,s){let n=e;return this._forEachChild((d,b)=>{n=s(n,d,b)}),n}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}}const Dc=new E.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>es}),es="always";function Ad(i,e,s=es){_p(i,e),e.valueAccessor.writeValue(i.value),(i.disabled||"always"===s)&&e.valueAccessor.setDisabledState?.(i.disabled),function vw(i,e){e.valueAccessor.registerOnChange(s=>{i._pendingValue=s,i._pendingChange=!0,i._pendingDirty=!0,"change"===i.updateOn&&ag(i,e)})}(i,e),function G_(i,e){const s=(n,d)=>{e.valueAccessor.writeValue(n),d&&e.viewToModelUpdate(n)};i.registerOnChange(s),e._registerOnDestroy(()=>{i._unregisterOnChange(s)})}(i,e),function Uv(i,e){e.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,"blur"===i.updateOn&&i._pendingChange&&ag(i,e),"submit"!==i.updateOn&&i.markAsTouched()})}(i,e),function vu(i,e){if(e.valueAccessor.setDisabledState){const s=n=>{e.valueAccessor.setDisabledState(n)};i.registerOnDisabledChange(s),e._registerOnDestroy(()=>{i._unregisterOnDisabledChange(s)})}}(i,e)}function gp(i,e,s=!0){const n=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(n),e.valueAccessor.registerOnTouched(n)),bu(i,e),i&&(e._invokeOnDestroyCallbacks(),i._registerOnCollectionChange(()=>{}))}function ml(i,e){i.forEach(s=>{s.registerOnValidatorChange&&s.registerOnValidatorChange(e)})}function _p(i,e){const s=qh(i);null!==e.validator?i.setValidators(k_(s,e.validator)):"function"==typeof s&&i.setValidators([s]);const n=ng(i);null!==e.asyncValidator?i.setAsyncValidators(k_(n,e.asyncValidator)):"function"==typeof n&&i.setAsyncValidators([n]);const d=()=>i.updateValueAndValidity();ml(e._rawValidators,d),ml(e._rawAsyncValidators,d)}function bu(i,e){let s=!1;if(null!==i){if(null!==e.validator){const d=qh(i);if(Array.isArray(d)&&d.length>0){const b=d.filter(D=>D!==e.validator);b.length!==d.length&&(s=!0,i.setValidators(b))}}if(null!==e.asyncValidator){const d=ng(i);if(Array.isArray(d)&&d.length>0){const b=d.filter(D=>D!==e.asyncValidator);b.length!==d.length&&(s=!0,i.setAsyncValidators(b))}}}const n=()=>{};return ml(e._rawValidators,n),ml(e._rawAsyncValidators,n),s}function ag(i,e){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function y(i,e){const s=i.indexOf(e);s>-1&&i.splice(s,1)}function w(i){return"object"==typeof i&&null!==i&&2===Object.keys(i).length&&"value"in i&&"disabled"in i}const T=class extends $_{constructor(e=null,s,n){super(og(s),pl(n,s)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(s),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Yh(s)&&(s.nonNullable||s.initialValueIsDefault)&&(this.defaultValue=w(e)?e.value:e)}setValue(e,s={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==s.emitModelToViewChange&&this._onChange.forEach(n=>n(this.value,!1!==s.emitViewToModelChange)),this.updateValueAndValidity(s)}patchValue(e,s={}){this.setValue(e,s)}reset(e=this.defaultValue,s={}){this._applyFormState(e),this.markAsPristine(s),this.markAsUntouched(s),this.setValue(this.value,s),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){y(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){y(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){w(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};let ve=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275dir=E.lG2({type:i,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),e})(),pt=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({}),e})();const Pt=new E.OlP("NgModelWithFormControlWarning"),Gt={provide:ks,useExisting:(0,E.Gpc)(()=>tn)};let tn=(()=>{var i;class e extends ks{constructor(n,d,b){super(),this.callSetDisabledState=b,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new E.vpe,this._setValidators(n),this._setAsyncValidators(d)}ngOnChanges(n){this._checkFormPresent(),n.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(bu(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(n){const d=this.form.get(n.path);return Ad(d,n,this.callSetDisabledState),d.updateValueAndValidity({emitEvent:!1}),this.directives.push(n),d}getControl(n){return this.form.get(n.path)}removeControl(n){gp(n.control||null,n,!1),function o(i,e){const s=i.indexOf(e);s>-1&&i.splice(s,1)}(this.directives,n)}addFormGroup(n){this._setUpFormContainer(n)}removeFormGroup(n){this._cleanUpFormContainer(n)}getFormGroup(n){return this.form.get(n.path)}addFormArray(n){this._setUpFormContainer(n)}removeFormArray(n){this._cleanUpFormContainer(n)}getFormArray(n){return this.form.get(n.path)}updateModel(n,d){this.form.get(n.path).setValue(d)}onSubmit(n){return this.submitted=!0,function lg(i,e){i._syncPendingControls(),e.forEach(s=>{const n=s.control;"submit"===n.updateOn&&n._pendingChange&&(s.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(n),"dialog"===n?.target?.method}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submitted=!1}_updateDomValue(){this.directives.forEach(n=>{const d=n.control,b=this.form.get(n.path);d!==b&&(gp(d||null,n),(i=>i instanceof T)(b)&&(Ad(b,n,this.callSetDisabledState),n.control=b))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(n){const d=this.form.get(n.path);(function jv(i,e){_p(i,e)})(d,n),d.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(n){if(this.form){const d=this.form.get(n.path);d&&function Z_(i,e){return bu(i,e)}(d,n)&&d.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){_p(this.form,this),this._oldForm&&bu(this._oldForm,this)}_checkFormPresent(){}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(yo,10),E.Y36(_a,10),E.Y36(Dc,8))},i.\u0275dir=E.lG2({type:i,selectors:[["","formGroup",""]],hostBindings:function(n,d){1&n&&E.NdJ("submit",function(D){return d.onSubmit(D)})("reset",function(){return d.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[E._Bn([Gt]),E.qOj,E.TTD]}),e})();const mi={provide:yu,useExisting:(0,E.Gpc)(()=>Pn)};let Pn=(()=>{var i;class e extends yu{set isDisabled(n){}constructor(n,d,b,D,k){super(),this._ngModelWarningConfig=k,this._added=!1,this.name=null,this.update=new E.vpe,this._ngModelWarningSent=!1,this._parent=n,this._setValidators(d),this._setAsyncValidators(b),this.valueAccessor=function wu(i,e){if(!e)return null;let s,n,d;return Array.isArray(e),e.forEach(b=>{b.constructor===jh?s=b:function vp(i){return Object.getPrototypeOf(i.constructor)===Cc}(b)?n=b:d=b}),d||n||s||null}(0,D)}ngOnChanges(n){this._added||this._setUpControl(),function yp(i,e){if(!i.hasOwnProperty("model"))return!1;const s=i.model;return!!s.isFirstChange()||!Object.is(e,s.currentValue)}(n,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}get path(){return function $l(i,e){return[...e.path,i]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return(i=e)._ngModelWarningSentOnce=!1,i.\u0275fac=function(n){return new(n||i)(E.Y36(ks,13),E.Y36(yo,10),E.Y36(_a,10),E.Y36(Na,10),E.Y36(Pt,8))},i.\u0275dir=E.lG2({type:i,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[E._Bn([mi]),E.qOj,E.TTD]}),e})(),nr=(()=>{var i;class e{constructor(){this._validator=Tc}ngOnChanges(n){if(this.inputName in n){const d=this.normalizeInput(n[this.inputName].currentValue);this._enabled=this.enabled(d),this._validator=this._enabled?this.createValidator(d):Tc,this._onChange&&this._onChange()}}validate(n){return this._validator(n)}registerOnValidatorChange(n){this._onChange=n}enabled(n){return null!=n}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275dir=E.lG2({type:i,features:[E.TTD]}),e})();const ps={provide:yo,useExisting:(0,E.Gpc)(()=>Jr),multi:!0};let Jr=(()=>{var i;class e extends nr{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=E.VuI,this.createValidator=n=>O_}enabled(n){return n}}return(i=e).\u0275fac=function(){let s;return function(d){return(s||(s=E.n5z(i)))(d||i)}}(),i.\u0275dir=E.lG2({type:i,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(n,d){2&n&&E.uIk("required",d._enabled?"":null)},inputs:{required:"required"},features:[E._Bn([ps]),E.qOj]}),e})(),ug=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[pt]}),e})(),Ns=(()=>{var i;class e{static withConfig(n){return{ngModule:e,providers:[{provide:Dc,useValue:n.callSetDisabledState??es}]}}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[ug]}),e})(),ms=(()=>{var i;class e{static withConfig(n){return{ngModule:e,providers:[{provide:Pt,useValue:n.warnOnNgModelWithFormControl??"always"},{provide:Dc,useValue:n.callSetDisabledState??es}]}}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[ug]}),e})();function wp(i,e){if(1&i&&(E.TgZ(0,"ul",19)(1,"li",20)(2,"div",21)(3,"div",22)(4,"div",23),E._UZ(5,"img",24),E.qZA()(),E.TgZ(6,"div",25)(7,"h5"),E._uU(8),E.qZA(),E.TgZ(9,"p"),E._uU(10),E.qZA()()()()()),2&i){const s=e.$implicit;E.xp6(8),E.Oqu(s.userId.username),E.xp6(2),E.hij(" ",s.text," ")}}function Ep(i,e){if(1&i){const s=E.EpF();E.TgZ(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h5"),E._uU(5),E.qZA()(),E._UZ(6,"button",6),E.qZA(),E.TgZ(7,"div",7)(8,"div",8),E._UZ(9,"img",9),E.qZA()(),E.TgZ(10,"div",10)(11,"div",11)(12,"div",12)(13,"h4",13),E._uU(14),E.qZA(),E.TgZ(15,"p"),E._uU(16),E.qZA()(),E.TgZ(17,"div",14),E.YNc(18,wp,11,2,"ul",15),E.ALo(19,"async"),E.qZA(),E.TgZ(20,"div",16)(21,"form",17),E.NdJ("ngSubmit",function(){E.CHM(s);const d=E.oxw();return E.KtG(d.onSubmit())}),E._UZ(22,"input",18),E.qZA()()()()()()}if(2&i){const s=e.ngIf,n=E.oxw();E.xp6(5),E.Oqu(s.author),E.xp6(9),E.Oqu(s.title),E.xp6(2),E.hij(" ",s.content," "),E.xp6(2),E.Q6J("ngForOf",E.lcZ(19,5,n.comments$)),E.xp6(3),E.Q6J("formGroup",n.CommentForm)}}let K_=(()=>{var i;class e{constructor(n){this.store=n,this.isModalOpen=!1,this.CommentForm=new ya({comment:new T("",[Rs.required])}),this.blog="",this.blogId="",this.comments$=this.store.select(b_),this.blog$=this.store.select(fb).pipe((0,R.U)(d=>d.blog))}ngOnChanges(n){const d=n.openModale;null!=d.currentValue&&(this.blogId=d.currentValue,this.store.dispatch(Oh({blogId:d.currentValue})),this.store.dispatch(kr({blogId:d.currentValue})))}getBlog(){this.comments$.subscribe(n=>console.log(n))}onSubmit(){this.CommentForm.valid&&(this.store.dispatch(uu({blogId:this.blogId,text:this.CommentForm.value.comment||""})),this.store.dispatch(kr({blogId:this.blogId})),this.CommentForm.reset())}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(Ct.yh))},i.\u0275cmp=E.Xpm({type:i,selectors:[["app-blog-modal"]],inputs:{blog:"blog",openModale:"openModale"},standalone:!0,features:[E.TTD,E.jDz],decls:3,vars:3,consts:[["id","exampleModalToggle","aria-hidden","true","aria-labelledby","exampleModalToggleLabel","tabindex","-1",1,"modal","fade"],["class","modal-dialog modal-dialog-centered",4,"ngIf"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalToggleLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"card-user-image"],["src","https://source.unsplash.com/600x400/?car,automobile","alt","card__image","width","600",1,"card__image"],[1,"modal-footer"],[1,"footer-body"],[1,"content"],[1,"card-title"],[1,"comments"],["class","comment-container",4,"ngFor","ngForOf"],[1,"add-comment"],[3,"formGroup","ngSubmit"],["type","text","placeholder","Add comment","aria-label","Add comment","formControlName","comment",1,"form-control"],[1,"comment-container"],[1,"comment"],[1,"wrap"],[1,"wrap-user"],[1,"user-avatar"],["src","../../../../assets/icons/user.png","alt",""],[1,"data"]],template:function(n,d){1&n&&(E.TgZ(0,"div",0),E.YNc(1,Ep,23,7,"div",1),E.ALo(2,"async"),E.qZA()),2&n&&(E.xp6(1),E.Q6J("ngIf",E.lcZ(2,1,d.blog$)))},dependencies:[br,Jl,wa,zt,Ns,ve,jh,fp,to,ms,tn,Pn],styles:[".card__image[_ngcontent-%COMP%], .footer-body[_ngcontent-%COMP%]{width:100%}.footer-body[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;padding:20px 10px;border-radius:6px;box-shadow:0 0 1px #000000bf}.footer-body[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment-container[_ngcontent-%COMP%]{list-style:none;padding:10px;border-radius:15px;background:#dddddd;width:-moz-fit-content;width:fit-content;max-width:100%}.footer-body[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment-container[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]{display:flex}.footer-body[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment-container[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]   .wrap[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-start}.footer-body[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment-container[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]   .wrap[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]{width:40px;height:40px;overflow:hidden;display:flex;border-radius:50%}.footer-body[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment-container[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]   .wrap[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:40px;height:auto}.footer-body[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment-container[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]   .wrap[_ngcontent-%COMP%]   .data[_ngcontent-%COMP%]{display:grid}.footer-body[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment-container[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]   .wrap[_ngcontent-%COMP%]   .data[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%], .footer-body[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment-container[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]   .wrap[_ngcontent-%COMP%]   .data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.footer-body[_ngcontent-%COMP%]   .add-comment[_ngcontent-%COMP%]{padding:20px 0 0}.footer-body[_ngcontent-%COMP%]   .add-comment[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:45px}.footer-body[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:10px;background-color:#f5f5f5}.footer-body[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]::-webkit-scrollbar{width:12px;background-color:#f5f5f5}.footer-body[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:10px;-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#555}.comments-btn[_ngcontent-%COMP%]{width:20px;display:flex;height:20px}.comments-btn[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}"],changeDetection:0}),e})();function Eu(i,e){if(1&i){const s=E.EpF();E.TgZ(0,"div",14)(1,"button",36),E.NdJ("click",function(){E.CHM(s);const d=E.oxw().$implicit,b=E.oxw();return E.KtG(b.goToEditPage(d.post_id))}),E._uU(2," Edit "),E.qZA()()}}function bC(i,e){if(1&i){const s=E.EpF();E.TgZ(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6),E._UZ(4,"img",7),E.TgZ(5,"div",8)(6,"h5"),E._uU(7),E.qZA(),E.TgZ(8,"small"),E._uU(9),E.qZA()()()(),E.TgZ(10,"div",9),E._UZ(11,"img",10),E.qZA()(),E.TgZ(12,"div",11)(13,"h4",12),E._uU(14),E.qZA(),E.TgZ(15,"p"),E._uU(16),E.qZA()(),E.TgZ(17,"div",13)(18,"div",14)(19,"div",15)(20,"div",16)(21,"div",17)(22,"input",18),E.NdJ("change",function(d){const D=E.CHM(s).$implicit,k=E.oxw();return E.KtG(k.onCheckboxChange(d,D.post_id))}),E.qZA(),E.TgZ(23,"div",19),E.O4$(),E.TgZ(24,"svg",20),E._UZ(25,"path",21),E.qZA(),E.TgZ(26,"svg",22),E._UZ(27,"path",23),E.qZA(),E.TgZ(28,"svg",24),E._UZ(29,"polygon",25)(30,"polygon",26)(31,"polygon",27)(32,"polygon",28)(33,"polygon",29)(34,"polygon",30),E.qZA()()(),E.kcU(),E.TgZ(35,"div",31)(36,"small"),E._uU(37),E.qZA()()(),E.TgZ(38,"div",32),E.NdJ("click",function(){const b=E.CHM(s).$implicit,D=E.oxw();return E.KtG(D.openModal(b.post_id))}),E.TgZ(39,"a",33),E._UZ(40,"img",34),E.qZA(),E.TgZ(41,"small"),E._uU(42),E.qZA()()()(),E.YNc(43,Eu,3,0,"div",35),E.qZA()()}if(2&i){const s=e.$implicit,n=E.oxw();E.xp6(7),E.Oqu(s.username),E.xp6(2),E.Oqu(s.created_at),E.xp6(5),E.Oqu(s.title),E.xp6(2),E.hij(" ",s.content," "),E.xp6(6),E.Q6J("checked",s.liked),E.xp6(15),E.Oqu(s.likes.length),E.xp6(5),E.Oqu(s.comments.length),E.xp6(1),E.Q6J("ngIf",s.userId===n.userId)}}let xC=(()=>{var i;class e{constructor(n,d,b){this.store=n,this.router=d,this.userService=b,this.selectedBlog="",this.isModal=!1,this.blogs$=this.store.select(pv),this.loading$=this.store.select(v_),this.error$=this.store.select(mv),this.userId=this.userService.getUserId()}ngOnInit(){}onCheckboxChange(n,d){const b=n.target.checked;!1===b?(console.log(b,d),this.store.dispatch(yc({blogId:d}))):(console.log(b,d),this.store.dispatch(tp({blogId:d})))}openModal(n){this.blogId=n}goToEditPage(n){this.router.navigate(["/posts/"+n])}trackById(n,d){return n}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(Ct.yh),E.Y36(_o),E.Y36(cp))},i.\u0275cmp=E.Xpm({type:i,selectors:[["app-blogs"]],decls:4,vars:6,consts:[[1,"container"],["class","card",4,"ngFor","ngForOf","ngForTrackBy"],[3,"blog","openModale"],[1,"card"],[1,"card__header"],[1,"card-user"],[1,"user"],["src","https://i.pravatar.cc/40?img=3","alt","user__image",1,"user__image"],[1,"user__info"],[1,"card-user-image"],["src","https://source.unsplash.com/600x400/?car,automobile","alt","card__image","width","600",1,"card__image"],[1,"card__body"],[1,"card-title"],[1,"card__footer"],[1,"edit-btn"],[1,"user-actions"],[1,"likes-container"],["title","Like",1,"heart-container"],["type","checkbox","id","Give-It-An-Id",1,"checkbox",3,"checked","change"],[1,"svg-container"],["viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"svg-outline"],["d","M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Zm-3.585,18.4a2.973,2.973,0,0,1-3.83,0C4.947,16.006,2,11.87,2,8.967a4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,11,8.967a1,1,0,0,0,2,0,4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,22,8.967C22,11.87,19.053,16.006,13.915,20.313Z"],["viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"svg-filled"],["d","M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Z"],["width","100","height","100","xmlns","http://www.w3.org/2000/svg",1,"svg-celebrate"],["points","10,10 20,20"],["points","10,50 20,50"],["points","20,80 30,70"],["points","90,10 80,20"],["points","90,50 80,50"],["points","80,80 70,70"],[1,"number-likes"],[1,"comments-container",3,"click"],["data-bs-toggle","modal","href","#exampleModalToggle","role","button",1,"comments-btn"],["src","../../../../assets/icons/comments.png","alt","My PNG Image",1,"comment-icon"],["class","edit-btn",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(n,d){1&n&&(E.TgZ(0,"div",0),E.YNc(1,bC,44,8,"div",1),E.ALo(2,"async"),E.qZA(),E._UZ(3,"app-blog-modal",2)),2&n&&(E.xp6(1),E.Q6J("ngForOf",E.lcZ(2,4,d.blogs$))("ngForTrackBy",d.trackById),E.xp6(2),E.Q6J("blog",d.selectedBlog)("openModale",d.blogId))},dependencies:[Jl,wa,K_,zt],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;max-width:1200px;margin-block:2rem;gap:2rem}img[_ngcontent-%COMP%]{max-width:100%;display:block;object-fit:cover}.card[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:600px;overflow:hidden;box-shadow:0 .1rem 1rem #0000001a;background:#ece9e6;background:linear-gradient(to right,#ffffff,#ece9e6)}.card[_ngcontent-%COMP%]   .card__header[_ngcontent-%COMP%]   .card-user[_ngcontent-%COMP%]{padding:15px}.card__body[_ngcontent-%COMP%]{padding:1rem;display:flex;flex-direction:column;gap:.5rem}.tag[_ngcontent-%COMP%]{align-self:flex-start;padding:.25em .75em;border-radius:1em;font-size:.75rem}.tag[_ngcontent-%COMP%] + .tag[_ngcontent-%COMP%]{margin-left:.5em}.tag-blue[_ngcontent-%COMP%]{background:#56ccf2;background:linear-gradient(to bottom,#2f80ed,#56ccf2);color:#fafafa}.tag-brown[_ngcontent-%COMP%]{background:#d1913c;background:linear-gradient(to bottom,#ffd194,#d1913c);color:#fafafa}.tag-red[_ngcontent-%COMP%]{background:#cb2d3e;background:linear-gradient(to bottom,#ef473a,#cb2d3e);color:#fafafa}.card__body[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.5rem;text-transform:capitalize}.card__footer[_ngcontent-%COMP%]{display:flex;padding:1rem;margin-top:auto;justify-content:space-between}.card__footer[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]{display:flex;align-items:flex-end}.user-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-content:center;align-items:center;padding:0 2px;gap:1rem}.user-actions[_ngcontent-%COMP%]   .likes-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px}.user-actions[_ngcontent-%COMP%]   .likes-container[_ngcontent-%COMP%]   .comments-container[_ngcontent-%COMP%]{display:flex;align-items:center}.user-actions[_ngcontent-%COMP%]   .comments-container[_ngcontent-%COMP%]{display:flex;gap:5px}.user-actions[_ngcontent-%COMP%]   .comments-container[_ngcontent-%COMP%]   .comments-btn[_ngcontent-%COMP%]   .comment-icon[_ngcontent-%COMP%]{width:25px}.user-actions[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#666}.user[_ngcontent-%COMP%]{display:flex;gap:.5rem}.user__image[_ngcontent-%COMP%]{border-radius:50%}.user__info[_ngcontent-%COMP%] > small[_ngcontent-%COMP%]{color:#666}.heart-container[_ngcontent-%COMP%]{--heart-color: rgb(141 141 141);position:relative;width:20px;height:20px;transition:.3s}.heart-container[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;opacity:0;z-index:20;cursor:pointer}.heart-container[_ngcontent-%COMP%]   .svg-container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center}.heart-container[_ngcontent-%COMP%]   .svg-outline[_ngcontent-%COMP%], .heart-container[_ngcontent-%COMP%]   .svg-filled[_ngcontent-%COMP%]{fill:var(--heart-color);position:absolute}.heart-container[_ngcontent-%COMP%]   .svg-filled[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_keyframes-svg-filled 1s;display:none}.heart-container[_ngcontent-%COMP%]   .svg-celebrate[_ngcontent-%COMP%]{position:absolute;animation:_ngcontent-%COMP%_keyframes-svg-celebrate .5s;animation-fill-mode:forwards;display:none;stroke:var(--heart-color);fill:var(--heart-color);stroke-width:2px}.heart-container[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]:checked ~ .svg-container[_ngcontent-%COMP%]   .svg-filled[_ngcontent-%COMP%]{display:block}.heart-container[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]:checked ~ .svg-container[_ngcontent-%COMP%]   .svg-celebrate[_ngcontent-%COMP%]{display:block}@keyframes _ngcontent-%COMP%_keyframes-svg-filled{0%{transform:scale(0)}25%{transform:scale(1.2)}50%{transform:scale(1);filter:brightness(1.5)}}@keyframes _ngcontent-%COMP%_keyframes-svg-celebrate{0%{transform:scale(0)}50%{opacity:1;filter:brightness(1.5)}to{transform:scale(1.4);opacity:0;display:none}}"]}),e})(),bw=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=E.Xpm({type:i,selectors:[["app-home"]],decls:1,vars:0,template:function(n,d){1&n&&E._UZ(0,"app-blogs")},dependencies:[xC]}),e})();const Mb=(0,Ct.PH)("[Blog] Add Blog",(0,Ct.Ky)()),Db=(0,Ct.PH)("[Blog] Add Blog Success",(0,Ct.Ky)()),xw=(0,Ct.PH)("[Blog] Add Blog Failure",(0,Ct.Ky)());let wC=(()=>{var i;class e{constructor(n,d){this.store=n,this.router=d,this.addPost=new ya({title:new T("",[Rs.minLength(4)]),content:new T("",[Rs.minLength(4)])})}onSubmit(){if(this.addPost.valid){const n=this.addPost.get("title")?.value||"",d=this.addPost.get("content")?.value||"";this.store.dispatch(Mb({title:n,content:d}))}else console.log("Form is not valid")}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(Ct.yh),E.Y36(_o))},i.\u0275cmp=E.Xpm({type:i,selectors:[["app-add-blog"]],decls:14,vars:1,consts:[[1,"container","center-form"],[1,"row"],[1,"col-md-12"],[1,"custom-form",3,"formGroup"],[1,"mb-3"],[1,"form-label"],["type","email","id","exampleInputEmail1","formControlName","title",1,"form-control"],["type","text","id","exampleInputPassword1","formControlName","content",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(n,d){1&n&&(E.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3)(4,"div",4)(5,"label",5),E._uU(6,"Title"),E.qZA(),E._UZ(7,"input",6),E.qZA(),E.TgZ(8,"div",4)(9,"label",5),E._uU(10,"Content"),E.qZA(),E._UZ(11,"input",7),E.qZA(),E.TgZ(12,"button",8),E.NdJ("click",function(){return d.onSubmit()}),E._uU(13," Submit "),E.qZA()()()()()),2&n&&(E.xp6(3),E.Q6J("formGroup",d.addPost))},dependencies:[ve,jh,fp,to,tn,Pn]}),e})();const EC=(0,Ct.ZF)("getBlog"),CC=(0,Ct.P1)(EC,i=>i),qv=(0,Ct.PH)("[Get Post] Get Post",(0,Ct.Ky)()),Yv=(0,Ct.PH)("[Get Post Success] Get Post Success",(0,Ct.Ky)()),ww=(0,Ct.PH)("[Edit Post] Edit Post",(0,Ct.Ky)()),Xv=(0,Ct.PH)("[Edit Post] Edit Post",(0,Ct.Ky)());function Kv(i,e){if(1&i){const s=E.EpF();E.TgZ(0,"div",2),E._UZ(1,"img",3),E.TgZ(2,"div",4)(3,"h5",5),E._uU(4),E.qZA(),E.TgZ(5,"p",6),E._uU(6),E.qZA(),E._UZ(7,"input",7),E.TgZ(8,"button",8),E.NdJ("click",function(){E.CHM(s);const d=E.oxw();return E.KtG(d.saveBlog())}),E._uU(9,"Save"),E.qZA()()()}if(2&i){const s=e.ngIf;E.xp6(1),E.Q6J("src","http://localhost:3000"+s.imageUrl,E.LSH),E.xp6(3),E.Oqu(s.title),E.xp6(2),E.Oqu(s.content),E.xp6(1),E.s9C("value",s.title)}}let Sb=(()=>{var i;class e{constructor(n,d){this.store=n,this.route=d,this.blog$=this.store.select(CC)}ngOnInit(){const n=this.route.snapshot.paramMap.get("id");null!==n&&this.store.dispatch(qv({blogId:n}))}saveBlog(){this.store.dispatch(ww({_id:"test",title:"test",content:"",imageUrl:""}))}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(Ct.yh),E.Y36(hc))},i.\u0275cmp=E.Xpm({type:i,selectors:[["app-edit-blog"]],decls:3,vars:3,consts:[[1,"container","d-flex","justify-content-center"],["class","card","style","width: 18rem",4,"ngIf"],[1,"card",2,"width","18rem"],["alt","Blog Image",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["type","text",3,"value"],[1,"btn","btn-primary",3,"click"]],template:function(n,d){1&n&&(E.TgZ(0,"div",0),E.YNc(1,Kv,10,4,"div",1),E.ALo(2,"async"),E.qZA()),2&n&&(E.xp6(1),E.Q6J("ngIf",E.lcZ(2,1,d.blog$)))},dependencies:[wa,zt]}),e})();const dg=(0,Ct.ZF)("auth"),Ew=((0,Ct.P1)(dg,i=>i),(0,Ct.P1)(dg,i=>!!i.user)),Ib=((0,Ct.P1)(dg,i=>i),(0,Ct.P1)(dg,i=>i.user)),Tw=((0,Ct.P1)(dg,i=>i),(0,Ct.P1)(dg,i=>i.user?i.user.userToken:null));let Mw=(()=>{var i;class e{constructor(n,d){this.store=n,this.router=d}canActivate(){return this.store.select(Ew).pipe((0,R.U)(n=>!!n))}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ct.yh),E.LFG(_o))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),Dw=(()=>{var i;class e{constructor(n){this.store=n}resolve(){const n=localStorage.getItem("blogs");if(n){const d=JSON.parse(n);this.store.dispatch(km({blogs:d}))}else this.store.dispatch(Ph())}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ct.yh))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();var Sw=ne(2574);const Aw=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"home",component:bw,canActivate:[Mw],resolve:{blogs:Dw}},{path:"new-post",component:wC,canActivate:[Mw]},{path:"posts/:id",component:Sb},{path:"map",component:(()=>{var i;class e{constructor(){}ngOnInit(){this.initializeMap()}initializeMap(){this.map=new Sw.Map({accessToken:"pk.eyJ1IjoiZ29sZGd1biIsImEiOiJjbG0wbmN1djIxYnVvM2RwNjBjY2ZqdTJoIn0.IRn0RbczCcxZL0RKkO2Z2g",container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-74.5,40],zoom:9}),this.map.on("load",()=>{this.map.addLayer({id:"maptiler-layer",type:"raster",source:{type:"raster",tileSize:256},minzoom:0,maxzoom:22})})}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=E.Xpm({type:i,selectors:[["app-map"]],decls:1,vars:0,consts:[["id","map",1,"match-parent"]],template:function(n,d){1&n&&E._UZ(0,"div",0)},styles:[".map_box_container[_ngcontent-%COMP%]{position:relative;height:100%!important;width:100%!important}#map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%}"]}),e})()}];let Ab=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[Nl.forRoot(Aw),Nl]}),e})();const Pb=(0,Ct.PH)("[auth page] login start",(0,Ct.Ky)()),Jv=(0,Ct.PH)("[auth page] login Success",(0,Ct.Ky)()),Ob=(0,Ct.PH)("[Registration] Register",(0,Ct.Ky)()),kw=(0,Ct.PH)("[Registration] Register Success",(0,Ct.Ky)()),Fw=(0,Ct.PH)("[Registration] Register Failure",(0,Ct.Ky)()),Qv=(0,Ct.PH)("[auth page] auto login"),J_=(0,Ct.PH)("[auth page] logout");class Rb{}class Lw{}const Cu="*";function kb(i,e=null){return{type:2,steps:i,options:e}}function Tu(i){return{type:6,styles:i,offset:null}}function Cp(i,e,s){return{type:0,name:i,styles:e,options:s}}class Mp{constructor(e=0,s=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+s}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const s="start"==e?this._onStartFns:this._onDoneFns;s.forEach(n=>n()),s.length=0}}class IC{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let s=0,n=0,d=0;const b=this.players.length;0==b?queueMicrotask(()=>this._onFinish()):this.players.forEach(D=>{D.onDone(()=>{++s==b&&this._onFinish()}),D.onDestroy(()=>{++n==b&&this._onDestroy()}),D.onStart(()=>{++d==b&&this._onStart()})}),this.totalTime=this.players.reduce((D,k)=>Math.max(D,k.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const s=e*this.totalTime;this.players.forEach(n=>{const d=n.totalTime?Math.min(1,s/n.totalTime):1;n.setPosition(d)})}getPosition(){const e=this.players.reduce((s,n)=>null===s||n.totalTime>s.totalTime?n:s,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const s="start"==e?this._onStartFns:this._onDoneFns;s.forEach(n=>n()),s.length=0}}const AC=function e0(i,e){return{type:7,name:i,definitions:e,options:{}}}("navbarAnimation",[Cp("collapsed",Tu({height:"0",opacity:"0"})),Cp("expanded",Tu({height:"*",opacity:"1"})),function t0(i,e,s=null){return{type:1,expr:i,animation:e,options:s}}("collapsed <=> expanded",function Q_(i,e=null){return{type:4,styles:e,timings:i}}("300ms ease-in-out"))]);function PC(i,e){1&i&&(E.TgZ(0,"a",12),E._uU(1,"Blogs"),E.qZA())}function Vw(i,e){1&i&&(E.TgZ(0,"a",13),E._uU(1,"New Post"),E.qZA())}function OC(i,e){1&i&&(E.TgZ(0,"li",7)(1,"a",14),E._uU(2,"Register"),E.qZA()())}function ts(i,e){1&i&&(E.TgZ(0,"li",7)(1,"a",15),E._uU(2,"Login"),E.qZA()())}function Uw(i,e){if(1&i&&(E.TgZ(0,"li",7)(1,"a",16),E._uU(2),E.ALo(3,"async"),E.qZA()()),2&i){const s=E.oxw();let n;E.xp6(2),E.hij(" ",null==(n=E.lcZ(3,1,s.username))?null:n.username," ")}}function RC(i,e){if(1&i){const s=E.EpF();E.TgZ(0,"li",7)(1,"a",17),E.NdJ("click",function(d){E.CHM(s);const b=E.oxw();return E.KtG(b.logout(d))}),E._uU(2,"Logout"),E.qZA()()}}let kC=(()=>{var i;class e{constructor(n){this.store=n,this.navbarState="expanded",this.lastScrollTop=0}ngOnInit(){this.isAuthenticated=this.store.select(Ew),this.username=this.store.select(Ib)}onScroll(n){const d=window.pageYOffset||document.documentElement.scrollTop;this.navbarState=d>this.lastScrollTop?"collapsed":"expanded",this.lastScrollTop=d}logout(n){n.preventDefault(),this.store.dispatch(J_())}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(Ct.yh))},i.\u0275cmp=E.Xpm({type:i,selectors:[["app-navbar"]],hostBindings:function(n,d){1&n&&E.NdJ("scroll",function(D){return d.onScroll(D)},!1,E.Jf7)},decls:26,vars:19,consts:[[1,"navbar","navbar-expand-md","navbar-light","bg-light","fixed-top"],[1,"container-fluid"],["href","#",1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarNav","aria-controls","navbarNav","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarNav",1,"collapse","navbar-collapse"],[1,"navbar-nav"],[1,"nav-item"],["class","nav-link","routerLink","/home",4,"ngIf"],["class","nav-link","routerLink","/new-post",4,"ngIf"],["routerLink","/map",1,"nav-link"],["class","nav-item",4,"ngIf"],["routerLink","/home",1,"nav-link"],["routerLink","/new-post",1,"nav-link"],["routerLink","/register",1,"nav-link"],["routerLink","/login",1,"nav-link"],[1,"nav-link"],["routerLink","/login",1,"nav-link",3,"click"]],template:function(n,d){1&n&&(E.TgZ(0,"nav",0)(1,"div",1)(2,"a",2),E._uU(3,"Navbar"),E.qZA(),E.TgZ(4,"button",3),E._UZ(5,"span",4),E.qZA(),E.TgZ(6,"div",5)(7,"ul",6),E._UZ(8,"li",7),E.TgZ(9,"li",7),E.YNc(10,PC,2,0,"a",8),E.ALo(11,"async"),E.qZA(),E.TgZ(12,"li",7),E.YNc(13,Vw,2,0,"a",9),E.ALo(14,"async"),E.qZA(),E.TgZ(15,"li",7)(16,"a",10),E._uU(17,"Map"),E.qZA()(),E.YNc(18,OC,3,0,"li",11),E.ALo(19,"async"),E.YNc(20,ts,3,0,"li",11),E.ALo(21,"async"),E.YNc(22,Uw,4,3,"li",11),E.ALo(23,"async"),E.YNc(24,RC,3,0,"li",11),E.ALo(25,"async"),E.qZA()()()()),2&n&&(E.Q6J("@navbarAnimation",d.navbarState),E.xp6(10),E.Q6J("ngIf",E.lcZ(11,7,d.isAuthenticated)),E.xp6(3),E.Q6J("ngIf",E.lcZ(14,9,d.isAuthenticated)),E.xp6(5),E.Q6J("ngIf",!E.lcZ(19,11,d.isAuthenticated)),E.xp6(2),E.Q6J("ngIf",!E.lcZ(21,13,d.isAuthenticated)),E.xp6(2),E.Q6J("ngIf",E.lcZ(23,15,d.isAuthenticated)),E.xp6(2),E.Q6J("ngIf",E.lcZ(25,17,d.isAuthenticated)))},dependencies:[wa,Mh,zt],styles:[".navbar[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;transition:top .3s}.navbar.navbar-hidden[_ngcontent-%COMP%]{top:-100px}"],data:{animation:[AC]}}),e})(),jw=(()=>{var i;class e{constructor(n){this.store=n}ngOnInit(){this.store.dispatch(Qv())}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(Ct.yh))},i.\u0275cmp=E.Xpm({type:i,selectors:[["app-root"]],decls:2,vars:0,template:function(n,d){1&n&&E._UZ(0,"app-navbar")(1,"router-outlet")},dependencies:[kf,kC]}),e})();function FC(i,e){1&i&&(E.TgZ(0,"span",11),E._uU(1," Username is required."),E.qZA())}function $w(i,e){1&i&&(E.TgZ(0,"div",11),E._uU(1," Username must be at least 4 characters long. "),E.qZA())}function Hw(i,e){1&i&&(E.TgZ(0,"span",11),E._uU(1," Email is required."),E.qZA())}function fg(i,e){1&i&&(E.TgZ(0,"span",11),E._uU(1," Email not valid."),E.qZA())}const Gw=[{path:"",children:[{path:"login",component:(()=>{var i;class e{constructor(n){this.store=n,this.loginForm=new ya({email:new T("",[Rs.required,Rs.email]),password:new T("",[Rs.required])})}onSubmit(){this.loginForm.valid&&(this.store.dispatch(Pb({email:this.loginForm.value.email||"",password:this.loginForm.value.password||""})),this.loginForm.reset())}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(Ct.yh))},i.\u0275cmp=E.Xpm({type:i,selectors:[["app-login"]],decls:16,vars:1,consts:[[1,"center-form"],[1,"form",3,"formGroup"],[1,"title"],[1,"message"],["required","","placeholder","","type","email","formControlName","email",1,"input"],["required","","placeholder","","type","password","formControlName","password",1,"input"],[1,"submit",3,"click"]],template:function(n,d){1&n&&(E.TgZ(0,"div",0)(1,"form",1)(2,"p",2),E._uU(3,"Login"),E.qZA(),E.TgZ(4,"p",3),E._uU(5,"Signup now and get full access to our app."),E.qZA(),E.TgZ(6,"label"),E._UZ(7,"input",4),E.TgZ(8,"span"),E._uU(9,"Email"),E.qZA()(),E.TgZ(10,"label"),E._UZ(11,"input",5),E.TgZ(12,"span"),E._uU(13,"Password"),E.qZA()(),E.TgZ(14,"button",6),E.NdJ("click",function(){return d.onSubmit()}),E._uU(15,"Sign in"),E.qZA()()()),2&n&&(E.xp6(1),E.Q6J("formGroup",d.loginForm))},dependencies:[ve,jh,fp,to,Jr,tn,Pn],styles:['.btn-primary[_ngcontent-%COMP%]{background-color:#333d51;border:none;font-size:13px;width:80px;line-height:24px}.center-form[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;max-width:350px;background-color:#fff;padding:20px;border-radius:20px;position:relative}.title[_ngcontent-%COMP%]{font-size:28px;color:#4169e1;font-weight:600;letter-spacing:-1px;position:relative;display:flex;align-items:center;padding-left:30px}.title[_ngcontent-%COMP%]:before, .title[_ngcontent-%COMP%]:after{position:absolute;content:"";height:16px;width:16px;border-radius:50%;left:0;background-color:#4169e1}.title[_ngcontent-%COMP%]:before{width:18px;height:18px;background-color:#4169e1}.title[_ngcontent-%COMP%]:after{width:18px;height:18px;animation:_ngcontent-%COMP%_pulse 1s linear infinite}.message[_ngcontent-%COMP%], .signin[_ngcontent-%COMP%]{color:#585757d2;font-size:14px}.signin[_ngcontent-%COMP%]{text-align:center}.signin[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#4169e1}.signin[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{-webkit-text-decoration:underline royalblue;text-decoration:underline royalblue}.flex[_ngcontent-%COMP%]{display:flex;width:100%;gap:6px}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{position:relative}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]{width:100%;padding:10px 10px 20px;outline:0;border:1px solid rgba(105,105,105,.397);border-radius:10px}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{position:absolute;left:10px;top:15px;color:gray;font-size:.9em;cursor:text;transition:.3s ease}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]:placeholder-shown + span[_ngcontent-%COMP%]{top:15px;font-size:.9em}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]:focus + span[_ngcontent-%COMP%], .form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]:valid + span[_ngcontent-%COMP%]{top:30px;font-size:.7em;font-weight:600}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]:valid + span[_ngcontent-%COMP%]{color:green}.submit[_ngcontent-%COMP%]{border:none;outline:none;background-color:#4169e1;padding:10px;border-radius:10px;color:#fff;font-size:16px;transform:.3s ease}.submit[_ngcontent-%COMP%]:hover{background-color:#385ac2}@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(.9);opacity:1}to{transform:scale(1.8);opacity:0}}']}),e})()},{path:"register",component:(()=>{var i;class e{constructor(n,d){this.store=n,this.router=d,this.emailForm=new ya({username:new T("",[Rs.required,Rs.minLength(4)]),email:new T("",[Rs.required,Rs.email]),password:new T("",[Rs.required,Rs.minLength(4)])})}OnInit(){}onSubmit(){this.emailForm.valid&&(this.store.dispatch(Ob({userData:{username:this.emailForm.value.username,email:this.emailForm.value.email,password:this.emailForm.value.password}})),this.router.navigate(["/login"]),this.emailForm.reset())}}return(i=e).\u0275fac=function(n){return new(n||i)(E.Y36(Ct.yh),E.Y36(_o))},i.\u0275cmp=E.Xpm({type:i,selectors:[["app-register"]],decls:28,vars:6,consts:[[1,"container","center-form"],[1,"form",3,"formGroup","ngSubmit"],[1,"title"],[1,"message"],["required","","placeholder","","type","text","formControlName","username",1,"input"],["class","invalid-feedback",4,"ngIf"],["required","","placeholder","","type","email","formControlName","email",1,"input"],["required","","placeholder","","type","password","formControlName","password",1,"input"],["type","submit",1,"submit",3,"disabled"],[1,"signin"],["href","#"],[1,"invalid-feedback"]],template:function(n,d){if(1&n&&(E.TgZ(0,"div",0)(1,"form",1),E.NdJ("ngSubmit",function(){return d.onSubmit()}),E.TgZ(2,"p",2),E._uU(3,"Register"),E.qZA(),E.TgZ(4,"p",3),E._uU(5,"Signup now and get full access to our app."),E.qZA(),E.TgZ(6,"label"),E._UZ(7,"input",4),E.TgZ(8,"span"),E._uU(9,"Username"),E.qZA(),E.YNc(10,FC,2,0,"span",5),E.YNc(11,$w,2,0,"div",5),E.qZA(),E.TgZ(12,"label"),E._UZ(13,"input",6),E.TgZ(14,"span"),E._uU(15,"Email"),E.qZA(),E.YNc(16,Hw,2,0,"span",5),E.YNc(17,fg,2,0,"span",5),E.qZA(),E.TgZ(18,"label"),E._UZ(19,"input",7),E.TgZ(20,"span"),E._uU(21,"Password"),E.qZA()(),E.TgZ(22,"button",8),E._uU(23," Submit "),E.qZA(),E.TgZ(24,"p",9),E._uU(25,"Already have an acount ? "),E.TgZ(26,"a",10),E._uU(27,"Signin"),E.qZA()()()()),2&n){let b,D,k,H;E.xp6(1),E.Q6J("formGroup",d.emailForm),E.xp6(9),E.Q6J("ngIf",(null==(b=d.emailForm.get("username"))?null:b.hasError("required"))&&(null==(b=d.emailForm.get("username"))?null:b.touched)),E.xp6(1),E.Q6J("ngIf",((null==(D=d.emailForm.get("username"))?null:D.hasError("minlength"))||(null==(D=d.emailForm.get("username"))?null:D.hasError("required")))&&(null==(D=d.emailForm.get("username"))?null:D.touched)),E.xp6(5),E.Q6J("ngIf",(null==(k=d.emailForm.get("email"))?null:k.hasError("required"))&&(null==(k=d.emailForm.get("email"))?null:k.touched)),E.xp6(1),E.Q6J("ngIf",(null==(H=d.emailForm.get("email"))?null:H.hasError("email"))&&(null==(H=d.emailForm.get("email"))?null:H.touched)),E.xp6(5),E.Q6J("disabled",!d.emailForm.valid)}},dependencies:[wa,ve,jh,fp,to,Jr,tn,Pn],styles:['.btn-primary[_ngcontent-%COMP%]{background-color:#333d51;border:none;font-size:13px;width:80px;line-height:24px}.center-form[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;max-width:350px;background-color:#fff;padding:20px;border-radius:20px;position:relative}.title[_ngcontent-%COMP%]{font-size:28px;color:#4169e1;font-weight:600;letter-spacing:-1px;position:relative;display:flex;align-items:center;padding-left:30px}.title[_ngcontent-%COMP%]:before, .title[_ngcontent-%COMP%]:after{position:absolute;content:"";height:16px;width:16px;border-radius:50%;left:0;background-color:#4169e1}.title[_ngcontent-%COMP%]:before{width:18px;height:18px;background-color:#4169e1}.title[_ngcontent-%COMP%]:after{width:18px;height:18px;animation:_ngcontent-%COMP%_pulse 1s linear infinite}.message[_ngcontent-%COMP%], .signin[_ngcontent-%COMP%]{color:#585757d2;font-size:14px}.signin[_ngcontent-%COMP%]{text-align:center}.signin[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#4169e1}.signin[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{-webkit-text-decoration:underline royalblue;text-decoration:underline royalblue}.flex[_ngcontent-%COMP%]{display:flex;width:100%;gap:6px}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{position:relative}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]{width:100%;padding:10px 10px 20px;outline:0;border:1px solid rgba(105,105,105,.397);border-radius:10px}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{position:absolute;left:10px;top:15px;color:gray;font-size:.9em;cursor:text;transition:.3s ease}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]:placeholder-shown + span[_ngcontent-%COMP%]{top:15px;font-size:.9em}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]:focus + span[_ngcontent-%COMP%], .form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]:valid + span[_ngcontent-%COMP%]{top:30px;font-size:.7em;font-weight:600}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]:valid + span[_ngcontent-%COMP%]{color:green}.submit[_ngcontent-%COMP%]{border:none;outline:none;background-color:#4169e1;padding:10px;border-radius:10px;color:#fff;font-size:16px;transform:.3s ease}.submit[_ngcontent-%COMP%]:hover{background-color:#385ac2}@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(.9);opacity:1}to{transform:scale(1.8);opacity:0}}']}),e})()}]}];let LC=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[br,Ns,ms,zl,Nl.forChild(Gw)]}),e})();var Zw=ne(7632),Ww=ne(3019),qw=ne(2420);class Rd{constructor(e,s,n){this.kind=e,this.value=s,this.error=n,this.hasValue="N"===e}observe(e){return Yw(this,e)}do(e,s,n){const{kind:d,value:b,error:D}=this;return"N"===d?e?.(b):"E"===d?s?.(D):n?.()}accept(e,s,n){var d;return(0,Cs.m)(null===(d=e)||void 0===d?void 0:d.next)?this.observe(e):this.do(e,s,n)}toObservable(){const{kind:e,value:s,error:n}=this,d="N"===e?(0,Nn.of)(s):"E"===e?Re(()=>n):"C"===e?Xe.E:0;if(!d)throw new TypeError(`Unexpected notification kind ${e}`);return d}static createNext(e){return new Rd("N",e)}static createError(e){return new Rd("E",void 0,e)}static createComplete(){return Rd.completeNotification}}function Yw(i,e){var s,n,d;const{kind:b,value:D,error:k}=i;if("string"!=typeof b)throw new TypeError('Invalid notification, missing "kind"');"N"===b?null===(s=e.next)||void 0===s||s.call(e,D):"E"===b?null===(n=e.error)||void 0===n||n.call(e,k):null===(d=e.complete)||void 0===d||d.call(e)}function Gl(i,e,s,n){return(0,Ve.e)((d,b)=>{let D;e&&"function"!=typeof e?({duration:s,element:D,connector:n}=e):D=e;const k=new Map,H=ht=>{k.forEach(ht),ht(b)},W=ht=>H(qt=>qt.error(ht));let fe=0,we=!1;const ft=new ee.Q(b,ht=>{try{const qt=i(ht);let sn=k.get(qt);if(!sn){k.set(qt,sn=n?n():new bt.x);const Dn=function Je(ht,qt){const sn=new Xo.y(Dn=>{fe++;const oi=qt.subscribe(Dn);return()=>{oi.unsubscribe(),0==--fe&&we&&ft.unsubscribe()}});return sn.key=ht,sn}(qt,sn);if(b.next(Dn),s){const oi=(0,ee.x)(sn,()=>{sn.complete(),oi?.unsubscribe()},void 0,void 0,()=>k.delete(qt));ft.add((0,Me.Xf)(s(Dn)).subscribe(oi))}}sn.next(D?D(ht):ht)}catch(qt){W(qt)}},()=>H(ht=>ht.complete()),W,()=>k.clear(),()=>(we=!0,0===fe));d.subscribe(ft)})}function Ba(i,e){return e?s=>s.pipe(Ba((n,d)=>(0,Me.Xf)(i(n,d)).pipe((0,R.U)((b,D)=>e(n,b,d,D))))):(0,Ve.e)((s,n)=>{let d=0,b=null,D=!1;s.subscribe((0,ee.x)(n,k=>{b||(b=(0,ee.x)(n,void 0,()=>{b=null,D&&n.complete()}),(0,Me.Xf)(i(k,d++)).subscribe(b))},()=>{D=!0,!b&&n.complete()}))})}Rd.completeNotification=new Rd("C");const Kw={dispatch:!0,functional:!1,useEffectsErrorHandler:!0},n0="__@ngrx/effects_create__";function _l(i,e={}){const s=e.functional?i:i(),n={...Kw,...e};return Object.defineProperty(s,n0,{value:n}),s}function pg(i){return Object.getPrototypeOf(i)}function o0(i){return"function"==typeof i}function Lb(i){return i.filter(o0)}function Jw(i,e,s){const n=pg(i),b=n&&"Object"!==n.constructor.name?n.constructor.name:null,D=function r0(i){return function NC(i){return Object.getOwnPropertyNames(i).filter(n=>!(!i[n]||!i[n].hasOwnProperty(n0))&&i[n][n0].hasOwnProperty("dispatch")).map(n=>({propertyName:n,...i[n][n0]}))}(i)}(i).map(({propertyName:k,dispatch:H,useEffectsErrorHandler:W})=>{const fe="function"==typeof i[k]?i[k]():i[k],we=W?s(fe,e):fe;return!1===H?we.pipe(function Fb(){return(0,Ve.e)((i,e)=>{i.subscribe((0,ee.x)(e,qw.Z))})}()):we.pipe(function Du(){return(0,Ve.e)((i,e)=>{i.subscribe((0,ee.x)(e,s=>{e.next(Rd.createNext(s))},()=>{e.next(Rd.createComplete()),e.complete()},s=>{e.next(Rd.createError(s)),e.complete()}))})}()).pipe((0,R.U)(Je=>({effect:i[k],notification:Je,propertyName:k,sourceName:b,sourceInstance:i})))});return(0,Ww.T)(...D)}function ey(i,e,s=10){return i.pipe((0,ln.K)(n=>(e&&e.handleError(n),s<=1?i:ey(i,e,s-1))))}let ty=(()=>{var i;class e extends Xo.y{constructor(n){super(),n&&(this.source=n)}lift(n){const d=new e;return d.source=this,d.operator=n,d}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ct.Y$))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();function za(...i){return(0,gt.h)(e=>i.some(s=>"string"==typeof s?s===e.type:s.type===e.type))}const Nb=new E.OlP("@ngrx/effects Internal Root Guard"),ny=new E.OlP("@ngrx/effects User Provided Effects"),Bb=new E.OlP("@ngrx/effects Internal Root Effects"),e1=new E.OlP("@ngrx/effects Internal Root Effects Instances"),s0=new E.OlP("@ngrx/effects Internal Feature Effects"),iy=new E.OlP("@ngrx/effects Internal Feature Effects Instance Groups"),t1=new E.OlP("@ngrx/effects Effects Error Handler",{providedIn:"root",factory:()=>ey}),zb="@ngrx/effects/init";(0,Ct.PH)(zb);function HC(i){return Vb(i,"ngrxOnInitEffects")}function Vb(i,e){return i&&e in i&&"function"==typeof i[e]}let Ub=(()=>{var i;class e extends bt.x{constructor(n,d){super(),this.errorHandler=n,this.effectsErrorHandler=d}addEffects(n){this.next(n)}toActions(){return this.pipe(Gl(n=>function BC(i){return!!i.constructor&&"Object"!==i.constructor.name&&"Function"!==i.constructor.name}(n)?pg(n):n),(0,wt.z)(n=>n.pipe(Gl(GC))),(0,wt.z)(n=>{const d=n.pipe(Ba(D=>function ZC(i,e){return s=>{const n=Jw(s,i,e);return function jC(i){return Vb(i,"ngrxOnRunEffects")}(s)?s.ngrxOnRunEffects(n):n}}(this.errorHandler,this.effectsErrorHandler)(D)),(0,R.U)(D=>(function r1(i,e){if("N"===i.notification.kind){const s=i.notification.value;!function o1(i){return"function"!=typeof i&&i&&i.type&&"string"==typeof i.type}(s)&&e.handleError(new Error(`Effect ${function s1({propertyName:i,sourceInstance:e,sourceName:s}){const n="function"==typeof e[i];return s?`"${s}.${String(i)}${n?"()":""}"`:`"${String(i)}()"`}(i)} dispatched an invalid action: ${function a1(i){try{return JSON.stringify(i)}catch{return i}}(s)}`))}}(D,this.errorHandler),D.notification)),(0,gt.h)(D=>"N"===D.kind&&null!=D.value),function Xw(){return(0,Ve.e)((i,e)=>{i.subscribe((0,ee.x)(e,s=>Yw(s,e)))})}()),b=n.pipe((0,ut.q)(1),(0,gt.h)(HC),(0,R.U)(D=>D.ngrxOnInitEffects()));return(0,Ww.T)(d,b)}))}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(E.qLn),E.LFG(t1))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();function GC(i){return function VC(i){return Vb(i,"ngrxOnIdentifyEffects")}(i)?i.ngrxOnIdentifyEffects():""}let jb=(()=>{var i;class e{get isStarted(){return!!this.effectsSubscription}constructor(n,d){this.effectSources=n,this.store=d,this.effectsSubscription=null}start(){this.effectsSubscription||(this.effectsSubscription=this.effectSources.toActions().subscribe(this.store))}ngOnDestroy(){this.effectsSubscription&&(this.effectsSubscription.unsubscribe(),this.effectsSubscription=null)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ub),E.LFG(Ct.yh))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),c1=(()=>{var i;class e{constructor(n,d,b,D,k,H,W){this.sources=n,d.start();for(const fe of D)n.addEffects(fe);b.dispatch({type:zb})}addEffects(n){this.sources.addEffects(n)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ub),E.LFG(jb),E.LFG(Ct.yh),E.LFG(e1),E.LFG(Ct.cr,8),E.LFG(Ct.CK,8),E.LFG(Nb,8))},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({}),e})(),WC=(()=>{var i;class e{constructor(n,d,b,D){const k=d.flat();for(const H of k)n.addEffects(H)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(c1),E.LFG(iy),E.LFG(Ct.cr,8),E.LFG(Ct.CK,8))},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({}),e})(),ry=(()=>{var i;class e{static forFeature(...n){const d=n.flat(),b=Lb(d);return{ngModule:WC,providers:[b,{provide:s0,multi:!0,useValue:d},{provide:ny,multi:!0,useValue:[]},{provide:iy,multi:!0,useFactory:u1,deps:[s0,ny]}]}}static forRoot(...n){const d=n.flat(),b=Lb(d);return{ngModule:c1,providers:[b,{provide:Bb,useValue:[d]},{provide:Nb,useFactory:qC},{provide:ny,multi:!0,useValue:[]},{provide:e1,useFactory:u1,deps:[Bb,ny]}]}}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({}),e})();function u1(i,e){const s=[];for(const n of i)s.push(...n);for(const n of e)s.push(...n);return s.map(n=>function zC(i){return i instanceof E.OlP||o0(i)}(n)?(0,E.f3M)(n):n)}function qC(){const i=(0,E.f3M)(jb,{optional:!0,skipSelf:!0}),e=(0,E.f3M)(Bb,{self:!0});if((1!==e.length||0!==e[0].length)&&i)throw new TypeError("EffectsModule.forRoot() called twice. Feature modules should use EffectsModule.forFeature() instead.");return"guarded"}const h1=(0,Ct.Lq)({email:null,password:"",token:null,loading:!1,error:null,success:!1},(0,Ct.on)(Jv,(i,e)=>({...i,user:e.user})),(0,Ct.on)(J_,i=>({...i,user:null})),(0,Ct.on)(Ob,i=>({...i,loading:!0,error:null,success:!1})),(0,Ct.on)(kw,i=>({...i,loading:!1,success:!0})),(0,Ct.on)(Fw,(i,{error:e})=>({...i,loading:!1,error:e,success:!1})));let f1=(()=>{var i;class e{constructor(n,d,b){this.actions$=n,this.loginService=d,this.router=b,this.login$=_l(()=>this.actions$.pipe(za(Pb),Ba(D=>this.loginService.login(D.email,D.password).pipe((0,R.U)(k=>{const H=this.loginService.formatUser(k);return this.loginService.setUserInLocalStorage(H),this.router.navigate(["home"]),Jv({user:H,redirect:!0})}))))),this.register$=_l(()=>this.actions$.pipe(za(Ob),(0,He.w)(({userData:D})=>this.loginService.register(D).pipe((0,R.U)(k=>kw({user:k})),(0,ln.K)(k=>(console.error("HTTP Error:",k),(0,Nn.of)(Fw({error:k})))))))),this.autoLogin$=_l(()=>this.actions$.pipe(za(Qv),(0,wt.z)(()=>{const D=this.loginService.getUserFromLocalStorage();return(0,Nn.of)(Jv({user:D,redirect:!1}))}))),this.logout$=_l(()=>this.actions$.pipe(za(J_),(0,R.U)(D=>{this.loginService.logout(),this.router.navigate(["login"])})),{dispatch:!1})}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(ty),E.LFG(cp),E.LFG(_o))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})(),$b=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[Ct.Aw.forFeature("auth",h1),ry.forFeature([f1])]}),e})();const Hb={message:"",blogId:"",loading:!1},_1=(0,Ct.Lq)({blogs:[],loading:!1,error:null},(0,Ct.on)(Ph,i=>({...i,loading:!0})),(0,Ct.on)(km,(i,{blogs:e})=>({...i,blogs:e,loading:!1})),(0,Ct.on)(_v,(i,{error:e})=>({...i,error:e,loading:!1}))),KC=(0,Ct.Lq)({blog:[],loading:!1},(0,Ct.on)(Oh,i=>({...i,loading:!0})),(0,Ct.on)(yv,(i,e)=>({...i,blog:e,loading:!1}))),JC=(0,Ct.Lq)(Hb,(0,Ct.on)(yc,(i,{blogId:e})=>({...i,blogId:e,loading:!0})),(0,Ct.on)(Lm,(i,e)=>({...i,message:e,loading:!1}))),mg=(0,Ct.Lq)(Hb,(0,Ct.on)(tp,(i,{blogId:e})=>({...i,blogId:e,loading:!0})),(0,Ct.on)(Fm,(i,e)=>({...i,message:e,loading:!1}))),CD=(0,Ct.Lq)({_id:""},(0,Ct.on)(kr,(i,{blogId:e})=>({...i,blogId:e,loading:!0})),(0,Ct.on)(hs,(i,{message:e})=>({...i,message:e,loading:!1}))),Gb=(0,Ct.Lq)({text:"",blogId:"",loading:!1},(0,Ct.on)(uu,(i,{blogId:e,text:s})=>({...i,blogId:e,text:s,loading:!0})),(0,Ct.on)(Bl,(i,e)=>({...i,message:e,loading:!1})));class gg extends Error{}class y1 extends gg{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class v1 extends gg{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class TD extends gg{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class Su extends gg{}class b1 extends gg{constructor(e){super(`Invalid unit ${e}`)}}class Zl extends gg{}class Qh extends gg{constructor(){super("Zone is an abstract class")}}const fn="numeric",Ic="short",ea="long",Sp={year:fn,month:fn,day:fn},va={year:fn,month:Ic,day:fn},MD={year:fn,month:Ic,day:fn,weekday:Ic},Zb={year:fn,month:ea,day:fn},Wb={year:fn,month:ea,day:fn,weekday:ea},x1={hour:fn,minute:fn},qb={hour:fn,minute:fn,second:fn},Yb={hour:fn,minute:fn,second:fn,timeZoneName:Ic},Xb={hour:fn,minute:fn,second:fn,timeZoneName:ea},Kb={hour:fn,minute:fn,hourCycle:"h23"},w1={hour:fn,minute:fn,second:fn,hourCycle:"h23"},E1={hour:fn,minute:fn,second:fn,hourCycle:"h23",timeZoneName:Ic},C1={hour:fn,minute:fn,second:fn,hourCycle:"h23",timeZoneName:ea},_g={year:fn,month:fn,day:fn,hour:fn,minute:fn},T1={year:fn,month:fn,day:fn,hour:fn,minute:fn,second:fn},M1={year:fn,month:Ic,day:fn,hour:fn,minute:fn},D1={year:fn,month:Ic,day:fn,hour:fn,minute:fn,second:fn},a0={year:fn,month:Ic,day:fn,weekday:Ic,hour:fn,minute:fn},Jb={year:fn,month:ea,day:fn,hour:fn,minute:fn,timeZoneName:Ic},Qb={year:fn,month:ea,day:fn,hour:fn,minute:fn,second:fn,timeZoneName:Ic},ex={year:fn,month:ea,day:fn,weekday:ea,hour:fn,minute:fn,timeZoneName:ea},S1={year:fn,month:ea,day:fn,weekday:ea,hour:fn,minute:fn,second:fn,timeZoneName:ea};class kd{get type(){throw new Qh}get name(){throw new Qh}get ianaName(){return this.name}get isUniversal(){throw new Qh}offsetName(e,s){throw new Qh}formatOffset(e,s){throw new Qh}offset(e){throw new Qh}equals(e){throw new Qh}get isValid(){throw new Qh}}let Ip=null;class l0 extends kd{static get instance(){return null===Ip&&(Ip=new l0),Ip}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:s,locale:n}){return G1(e,s,n)}formatOffset(e,s){return Op(this.offset(e),s)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return"system"===e.type}get isValid(){return!0}}let c0={};const I1={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};let u0={};class Iu extends kd{static create(e){return u0[e]||(u0[e]=new Iu(e)),u0[e]}static resetCache(){u0={},c0={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Iu.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:s,locale:n}){return G1(e,s,n,this.name)}formatOffset(e,s){return Op(this.offset(e),s)}offset(e){const s=new Date(e);if(isNaN(s))return NaN;const n=function QC(i){return c0[i]||(c0[i]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:i,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),c0[i]}(this.name);let[d,b,D,k,H,W,fe]=n.formatToParts?function P1(i,e){const s=i.formatToParts(e),n=[];for(let d=0;d<s.length;d++){const{type:b,value:D}=s[d],k=I1[b];"era"===b?n[k]=D:Li(k)||(n[k]=parseInt(D,10))}return n}(n,s):function A1(i,e){const s=i.format(e).replace(/\u200E/g,""),n=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(s),[,d,b,D,k,H,W,fe]=n;return[D,d,b,k,H,W,fe]}(n,s);"BC"===k&&(d=1-Math.abs(d));let Je=+s;const ht=Je%1e3;return Je-=ht>=0?ht:1e3+ht,(y0({year:d,month:b,day:D,hour:24===H?0:H,minute:W,second:fe,millisecond:0})-Je)/6e4}equals(e){return"iana"===e.type&&e.name===this.name}get isValid(){return this.valid}}let O1={},R1={};function k1(i,e={}){const s=JSON.stringify([i,e]);let n=R1[s];return n||(n=new Intl.DateTimeFormat(i,e),R1[s]=n),n}let F1={},d0={},oy=null;function f0(i,e,s,n){const d=i.listingMode();return"error"===d?null:"en"===d?s(e):n(e)}class SD{constructor(e,s,n){this.padTo=n.padTo||0,this.floor=n.floor||!1;const{padTo:d,floor:b,...D}=n;if(!s||Object.keys(D).length>0){const k={useGrouping:!1,...n};n.padTo>0&&(k.minimumIntegerDigits=n.padTo),this.inf=function DD(i,e={}){const s=JSON.stringify([i,e]);let n=F1[s];return n||(n=new Intl.NumberFormat(i,e),F1[s]=n),n}(e,k)}}format(e){if(this.inf){const s=this.floor?Math.floor(e):e;return this.inf.format(s)}return Lo(this.floor?Math.floor(e):_0(e,3),this.padTo)}}class oT{constructor(e,s,n){let d;if(this.opts=n,this.originalZone=void 0,this.opts.timeZone)this.dt=e;else if("fixed"===e.zone.type){const D=e.offset/60*-1,k=D>=0?`Etc/GMT+${D}`:`Etc/GMT${D}`;0!==e.offset&&Iu.create(k).valid?(d=k,this.dt=e):(d="UTC",this.dt=0===e.offset?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else"system"===e.zone.type?this.dt=e:"iana"===e.zone.type?(this.dt=e,d=e.zone.name):(d="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const b={...this.opts};b.timeZone=b.timeZone||d,this.dtf=k1(s,b)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(s=>{if("timeZoneName"===s.type){const n=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...s,value:n}}return s}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class N1{constructor(e,s,n){this.opts={style:"long",...n},!s&&j1()&&(this.rtf=function h0(i,e={}){const{base:s,...n}=e,d=JSON.stringify([i,n]);let b=d0[d];return b||(b=new Intl.RelativeTimeFormat(i,e),d0[d]=b),b}(e,n))}format(e,s){return this.rtf?this.rtf.format(e,s):function tE(i,e,s="always",n=!1){const d={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},b=-1===["hours","minutes","seconds"].indexOf(i);if("auto"===s&&b){const we="days"===i;switch(e){case 1:return we?"tomorrow":`next ${d[i][0]}`;case-1:return we?"yesterday":`last ${d[i][0]}`;case 0:return we?"today":`this ${d[i][0]}`}}const D=Object.is(e,-0)||e<0,k=Math.abs(e),H=1===k,W=d[i],fe=n?H?W[1]:W[2]||W[1]:H?d[i][0]:i;return D?`${k} ${fe} ago`:`in ${k} ${fe}`}(s,e,this.opts.numeric,"long"!==this.opts.style)}formatToParts(e,s){return this.rtf?this.rtf.formatToParts(e,s):[]}}class $r{static fromOpts(e){return $r.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,s,n,d=!1){const b=e||vo.defaultLocale,D=b||(d?"en-US":function tT(){return oy||(oy=(new Intl.DateTimeFormat).resolvedOptions().locale,oy)}());return new $r(D,s||vo.defaultNumberingSystem,n||vo.defaultOutputCalendar,b)}static resetCache(){oy=null,R1={},F1={},d0={}}static fromObject({locale:e,numberingSystem:s,outputCalendar:n}={}){return $r.create(e,s,n)}constructor(e,s,n,d){const[b,D,k]=function L1(i){const e=i.indexOf("-x-");-1!==e&&(i=i.substring(0,e));const s=i.indexOf("-u-");if(-1===s)return[i];{let n,d;try{n=k1(i).resolvedOptions(),d=i}catch{const H=i.substring(0,s);n=k1(H).resolvedOptions(),d=H}const{numberingSystem:b,calendar:D}=n;return[d,b,D]}}(e);this.locale=b,this.numberingSystem=s||D||null,this.outputCalendar=n||k||null,this.intl=function sy(i,e,s){return(s||e)&&(i.includes("-u-")||(i+="-u"),s&&(i+=`-ca-${s}`),e&&(i+=`-nu-${e}`)),i}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=d,this.fastNumbersCached=null}get fastNumbers(){return null==this.fastNumbersCached&&(this.fastNumbersCached=function rT(i){return(!i.numberingSystem||"latn"===i.numberingSystem)&&("latn"===i.numberingSystem||!i.locale||i.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(i.intl).resolvedOptions().numberingSystem)}(this)),this.fastNumbersCached}listingMode(){return this.isEnglish()&&!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar)?"en":"intl"}clone(e){return e&&0!==Object.getOwnPropertyNames(e).length?$r.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1):this}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,s=!1){return f0(this,e,tf,()=>{const n=s?{month:e,day:"numeric"}:{month:e},d=s?"format":"standalone";return this.monthsCache[d][e]||(this.monthsCache[d][e]=function nT(i){const e=[];for(let s=1;s<=12;s++){const n=bi.utc(2009,s,1);e.push(i(n))}return e}(b=>this.extract(b,n,"month"))),this.monthsCache[d][e]})}weekdays(e,s=!1){return f0(this,e,w0,()=>{const n=s?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},d=s?"format":"standalone";return this.weekdaysCache[d][e]||(this.weekdaysCache[d][e]=function iT(i){const e=[];for(let s=1;s<=7;s++){const n=bi.utc(2016,11,13+s);e.push(i(n))}return e}(b=>this.extract(b,n,"weekday"))),this.weekdaysCache[d][e]})}meridiems(){return f0(this,void 0,()=>E0,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[bi.utc(2016,11,13,9),bi.utc(2016,11,13,19)].map(s=>this.extract(s,e,"dayperiod"))}return this.meridiemCache})}eras(e){return f0(this,e,K1,()=>{const s={era:e};return this.eraCache[e]||(this.eraCache[e]=[bi.utc(-40,1,1),bi.utc(2017,1,1)].map(n=>this.extract(n,s,"era"))),this.eraCache[e]})}extract(e,s,n){const D=this.dtFormatter(e,s).formatToParts().find(k=>k.type.toLowerCase()===n);return D?D.value:null}numberFormatter(e={}){return new SD(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,s={}){return new oT(e,this.intl,s)}relFormatter(e={}){return new N1(this.intl,this.isEnglish(),e)}listFormatter(e={}){return function eT(i,e={}){const s=JSON.stringify([i,e]);let n=O1[s];return n||(n=new Intl.ListFormat(i,e),O1[s]=n),n}(this.intl,e)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let tx=null;class ns extends kd{static get utcInstance(){return null===tx&&(tx=new ns(0)),tx}static instance(e){return 0===e?ns.utcInstance:new ns(e)}static parseSpecifier(e){if(e){const s=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(s)return new ns(vg(s[1],s[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${Op(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${Op(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,s){return Op(this.fixed,s)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return"fixed"===e.type&&e.fixed===this.fixed}get isValid(){return!0}}class sT extends kd{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Fd(i,e){if(Li(i)||null===i)return e;if(i instanceof kd)return i;if(function aT(i){return"string"==typeof i}(i)){const n=i.toLowerCase();return"default"===n?e:"local"===n||"system"===n?l0.instance:"utc"===n||"gmt"===n?ns.utcInstance:ns.parseSpecifier(n)||Iu.create(i)}return Ap(i)?ns.instance(i):"object"==typeof i&&"offset"in i&&"function"==typeof i.offset?i:new sT(i)}let U1,B1=()=>Date.now(),nx="system",z1=null,ix=null,V1=null,p0=60;class vo{static get now(){return B1}static set now(e){B1=e}static set defaultZone(e){nx=e}static get defaultZone(){return Fd(nx,l0.instance)}static get defaultLocale(){return z1}static set defaultLocale(e){z1=e}static get defaultNumberingSystem(){return ix}static set defaultNumberingSystem(e){ix=e}static get defaultOutputCalendar(){return V1}static set defaultOutputCalendar(e){V1=e}static get twoDigitCutoffYear(){return p0}static set twoDigitCutoffYear(e){p0=e%100}static get throwOnInvalid(){return U1}static set throwOnInvalid(e){U1=e}static resetCaches(){$r.resetCache(),Iu.resetCache()}}function Li(i){return typeof i>"u"}function Ap(i){return"number"==typeof i}function m0(i){return"number"==typeof i&&i%1==0}function j1(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function H1(i,e,s){if(0!==i.length)return i.reduce((n,d)=>{const b=[e(d),d];return n&&s(n[0],b[0])===n[0]?n:b},null)[1]}function yg(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function Ld(i,e,s){return m0(i)&&i>=e&&i<=s}function Lo(i,e=2){let n;return n=i<0?"-"+(""+-i).padStart(e,"0"):(""+i).padStart(e,"0"),n}function ef(i){if(!Li(i)&&null!==i&&""!==i)return parseInt(i,10)}function Pp(i){if(!Li(i)&&null!==i&&""!==i)return parseFloat(i)}function g0(i){if(!Li(i)&&null!==i&&""!==i){const e=1e3*parseFloat("0."+i);return Math.floor(e)}}function _0(i,e,s=!1){const n=10**e;return(s?Math.trunc:Math.round)(i*n)/n}function ay(i){return i%4==0&&(i%100!=0||i%400==0)}function ly(i){return ay(i)?366:365}function cy(i,e){const s=function cT(i,e){return i-e*Math.floor(i/e)}(e-1,12)+1;return 2===s?ay(i+(e-s)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][s-1]}function y0(i){let e=Date.UTC(i.year,i.month-1,i.day,i.hour,i.minute,i.second,i.millisecond);return i.year<100&&i.year>=0&&(e=new Date(e),e.setUTCFullYear(i.year,i.month-1,i.day)),+e}function v0(i){const e=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7,s=i-1,n=(s+Math.floor(s/4)-Math.floor(s/100)+Math.floor(s/400))%7;return 4===e||3===n?53:52}function ox(i){return i>99?i:i>vo.twoDigitCutoffYear?1900+i:2e3+i}function G1(i,e,s,n=null){const d=new Date(i),b={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};n&&(b.timeZone=n);const D={timeZoneName:e,...b},k=new Intl.DateTimeFormat(s,D).formatToParts(d).find(H=>"timezonename"===H.type.toLowerCase());return k?k.value:null}function vg(i,e){let s=parseInt(i,10);Number.isNaN(s)&&(s=0);const n=parseInt(e,10)||0;return 60*s+(s<0||Object.is(s,-0)?-n:n)}function b0(i){const e=Number(i);if("boolean"==typeof i||""===i||Number.isNaN(e))throw new Zl(`Invalid unit value ${i}`);return e}function uy(i,e){const s={};for(const n in i)if(yg(i,n)){const d=i[n];if(null==d)continue;s[e(n)]=b0(d)}return s}function Op(i,e){const s=Math.trunc(Math.abs(i/60)),n=Math.trunc(Math.abs(i%60)),d=i>=0?"+":"-";switch(e){case"short":return`${d}${Lo(s,2)}:${Lo(n,2)}`;case"narrow":return`${d}${s}${n>0?`:${n}`:""}`;case"techie":return`${d}${Lo(s,2)}${Lo(n,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function x0(i){return function lT(i,e){return e.reduce((s,n)=>(s[n]=i[n],s),{})}(i,["hour","minute","second","millisecond"])}const sx=["January","February","March","April","May","June","July","August","September","October","November","December"],Z1=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],W1=["J","F","M","A","M","J","J","A","S","O","N","D"];function tf(i){switch(i){case"narrow":return[...W1];case"short":return[...Z1];case"long":return[...sx];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const ax=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],q1=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ID=["M","T","W","T","F","S","S"];function w0(i){switch(i){case"narrow":return[...ID];case"short":return[...q1];case"long":return[...ax];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const E0=["AM","PM"],uT=["Before Christ","Anno Domini"],Y1=["BC","AD"],X1=["B","A"];function K1(i){switch(i){case"narrow":return[...X1];case"short":return[...Y1];case"long":return[...uT];default:return null}}function nE(i,e){let s="";for(const n of i)s+=n.literal?n.val:e(n.val);return s}const hT={D:Sp,DD:va,DDD:Zb,DDDD:Wb,t:x1,tt:qb,ttt:Yb,tttt:Xb,T:Kb,TT:w1,TTT:E1,TTTT:C1,f:_g,ff:M1,fff:Jb,ffff:ex,F:T1,FF:D1,FFF:Qb,FFFF:S1};class ta{static create(e,s={}){return new ta(e,s)}static parseFormat(e){let s=null,n="",d=!1;const b=[];for(let D=0;D<e.length;D++){const k=e.charAt(D);"'"===k?(n.length>0&&b.push({literal:d||/^\s+$/.test(n),val:n}),s=null,n="",d=!d):d||k===s?n+=k:(n.length>0&&b.push({literal:/^\s+$/.test(n),val:n}),n=k,s=k)}return n.length>0&&b.push({literal:d||/^\s+$/.test(n),val:n}),b}static macroTokenToFormatOpts(e){return hT[e]}constructor(e,s){this.opts=s,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,s){return null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...s}).format()}dtFormatter(e,s={}){return this.loc.dtFormatter(e,{...this.opts,...s})}formatDateTime(e,s){return this.dtFormatter(e,s).format()}formatDateTimeParts(e,s){return this.dtFormatter(e,s).formatToParts()}formatInterval(e,s){return this.dtFormatter(e.start,s).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,s){return this.dtFormatter(e,s).resolvedOptions()}num(e,s=0){if(this.opts.forceSimple)return Lo(e,s);const n={...this.opts};return s>0&&(n.padTo=s),this.loc.numberFormatter(n).format(e)}formatDateTimeFromString(e,s){const n="en"===this.loc.listingMode(),d=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,b=(Je,ht)=>this.loc.extract(e,Je,ht),D=Je=>e.isOffsetFixed&&0===e.offset&&Je.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,Je.format):"",H=(Je,ht)=>n?function Q1(i,e){return tf(e)[i.month-1]}(e,Je):b(ht?{month:Je}:{month:Je,day:"numeric"},"month"),W=(Je,ht)=>n?function lx(i,e){return w0(e)[i.weekday-1]}(e,Je):b(ht?{weekday:Je}:{weekday:Je,month:"long",day:"numeric"},"weekday"),fe=Je=>{const ht=ta.macroTokenToFormatOpts(Je);return ht?this.formatWithSystemDefault(e,ht):Je},we=Je=>n?function eE(i,e){return K1(e)[i.year<0?0:1]}(e,Je):b({era:Je},"era");return nE(ta.parseFormat(s),Je=>{switch(Je){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12==0?12:e.hour%12);case"hh":return this.num(e.hour%12==0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return D({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return D({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return D({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return n?function J1(i){return E0[i.hour<12?0:1]}(e):b({hour:"numeric",hourCycle:"h12"},"dayperiod");case"d":return d?b({day:"numeric"},"day"):this.num(e.day);case"dd":return d?b({day:"2-digit"},"day"):this.num(e.day,2);case"c":case"E":return this.num(e.weekday);case"ccc":return W("short",!0);case"cccc":return W("long",!0);case"ccccc":return W("narrow",!0);case"EEE":return W("short",!1);case"EEEE":return W("long",!1);case"EEEEE":return W("narrow",!1);case"L":return d?b({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return d?b({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return H("short",!0);case"LLLL":return H("long",!0);case"LLLLL":return H("narrow",!0);case"M":return d?b({month:"numeric"},"month"):this.num(e.month);case"MM":return d?b({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return H("short",!1);case"MMMM":return H("long",!1);case"MMMMM":return H("narrow",!1);case"y":return d?b({year:"numeric"},"year"):this.num(e.year);case"yy":return d?b({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return d?b({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return d?b({year:"numeric"},"year"):this.num(e.year,6);case"G":return we("short");case"GG":return we("long");case"GGGGG":return we("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return fe(Je)}})}formatDurationFromString(e,s){const n=H=>{switch(H[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},b=ta.parseFormat(s),D=b.reduce((H,{literal:W,val:fe})=>W?H:H.concat(fe),[]);return nE(b,(H=>W=>{const fe=n(W);return fe?this.num(H.get(fe),W.length):W})(e.shiftTo(...D.map(n).filter(H=>H))))}}class Ac{constructor(e,s){this.reason=e,this.explanation=s}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const cx=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function dy(...i){const e=i.reduce((s,n)=>s+n.source,"");return RegExp(`^${e}$`)}function Rp(...i){return e=>i.reduce(([s,n,d],b)=>{const[D,k,H]=b(e,d);return[{...s,...D},k||n,H]},[{},null,1]).slice(0,2)}function bg(i,...e){if(null==i)return[null,null];for(const[s,n]of e){const d=s.exec(i);if(d)return n(d)}return[null,null]}function iE(...i){return(e,s)=>{const n={};let d;for(d=0;d<i.length;d++)n[i[d]]=ef(e[s+d]);return[n,null,s+d]}}const fT=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,ux=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,rE=RegExp(`${ux.source}(?:${fT.source}?(?:\\[(${cx.source})\\])?)?`),dx=RegExp(`(?:T${rE.source})?`),yT=iE("weekYear","weekNumber","weekDay"),vT=iE("year","ordinal"),oE=RegExp(`${ux.source} ?(?:${fT.source}|(${cx.source}))?`),xT=RegExp(`(?: ${oE.source})?`);function Au(i,e,s){const n=i[e];return Li(n)?s:ef(n)}function kp(i,e){return[{hours:Au(i,e,0),minutes:Au(i,e+1,0),seconds:Au(i,e+2,0),milliseconds:g0(i[e+3])},null,e+4]}function xg(i,e){const s=!i[e]&&!i[e+1],n=vg(i[e+1],i[e+2]);return[{},s?null:ns.instance(n),e+3]}function wg(i,e){return[{},i[e]?Iu.create(i[e]):null,e+1]}const aE=RegExp(`^T?${ux.source}$`),lE=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function wT(i){const[e,s,n,d,b,D,k,H,W]=i,fe="-"===e[0],we=H&&"-"===H[0],ft=(Je,ht=!1)=>void 0!==Je&&(ht||Je&&fe)?-Je:Je;return[{years:ft(Pp(s)),months:ft(Pp(n)),weeks:ft(Pp(d)),days:ft(Pp(b)),hours:ft(Pp(D)),minutes:ft(Pp(k)),seconds:ft(Pp(H),"-0"===H),milliseconds:ft(g0(W),we)}]}const AD={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function cE(i,e,s,n,d,b,D){const k={year:2===e.length?ox(ef(e)):ef(e),month:Z1.indexOf(s)+1,day:ef(n),hour:ef(d),minute:ef(b)};return D&&(k.second=ef(D)),i&&(k.weekday=i.length>3?ax.indexOf(i)+1:q1.indexOf(i)+1),k}const uE=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function ET(i){const[,e,s,n,d,b,D,k,H,W,fe,we]=i,ft=cE(e,d,n,s,b,D,k);let Je;return Je=H?AD[H]:W?0:vg(fe,we),[ft,new ns(Je)]}const TT=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,MT=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,hy=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function dE(i){const[,e,s,n,d,b,D,k]=i;return[cE(e,d,n,s,b,D,k),ns.utcInstance]}function hx(i){const[,e,s,n,d,b,D,k]=i;return[cE(e,k,s,n,d,b,D),ns.utcInstance]}const DT=dy(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,dx),PD=dy(/(\d{4})-?W(\d\d)(?:-?(\d))?/,dx),ST=dy(/(\d{4})-?(\d{3})/,dx),OD=dy(rE),Eg=Rp(function sE(i,e){return[{year:Au(i,e),month:Au(i,e+1,1),day:Au(i,e+2,1)},null,e+3]},kp,xg,wg),IT=Rp(yT,kp,xg,wg),AT=Rp(vT,kp,xg,wg),PT=Rp(kp,xg,wg),T0=Rp(kp),kT=dy(/(\d{4})-(\d\d)-(\d\d)/,xT),pE=dy(oE),FT=Rp(kp,xg,wg),fx="Invalid Duration",fy={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},NT={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...fy},Wl=365.2425,Fp=30.436875,mE={years:{quarters:4,months:12,weeks:Wl/7,days:Wl,hours:24*Wl,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:Wl/28,days:Wl/4,hours:24*Wl/4,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:Fp/7,days:Fp,hours:24*Fp,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...fy},Nd=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],gE=Nd.slice(0).reverse();function nf(i,e,s=!1){const n={values:s?e.values:{...i.values,...e.values||{}},loc:i.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||i.conversionAccuracy,matrix:e.matrix||i.matrix};return new er(n)}function px(i,e){let s=e.milliseconds??0;for(const n of gE.slice(1))e[n]&&(s+=e[n]*i[n].milliseconds);return s}function mx(i,e){const s=px(i,e)<0?-1:1;Nd.reduceRight((n,d)=>{if(Li(e[d]))return n;if(n){const D=i[d][n],k=Math.floor(e[n]*s/D);e[d]+=k*s,e[n]-=k*D*s}return d},null),Nd.reduce((n,d)=>{if(Li(e[d]))return n;if(n){const b=e[n]%1;e[n]-=b,e[d]+=b*i[n][d]}return d},null)}class er{constructor(e){const s="longterm"===e.conversionAccuracy||!1;let n=s?mE:NT;e.matrix&&(n=e.matrix),this.values=e.values,this.loc=e.loc||$r.create(),this.conversionAccuracy=s?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=n,this.isLuxonDuration=!0}static fromMillis(e,s){return er.fromObject({milliseconds:e},s)}static fromObject(e,s={}){if(null==e||"object"!=typeof e)throw new Zl("Duration.fromObject: argument expected to be an object, got "+(null===e?"null":typeof e));return new er({values:uy(e,er.normalizeUnit),loc:$r.fromObject(s),conversionAccuracy:s.conversionAccuracy,matrix:s.matrix})}static fromDurationLike(e){if(Ap(e))return er.fromMillis(e);if(er.isDuration(e))return e;if("object"==typeof e)return er.fromObject(e);throw new Zl(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,s){const[n]=function fE(i){return bg(i,[lE,wT])}(e);return n?er.fromObject(n,s):er.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,s){const[n]=function RT(i){return bg(i,[aE,T0])}(e);return n?er.fromObject(n,s):er.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,s=null){if(!e)throw new Zl("need to specify a reason the Duration is invalid");const n=e instanceof Ac?e:new Ac(e,s);if(vo.throwOnInvalid)throw new TD(n);return new er({invalid:n})}static normalizeUnit(e){const s={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!s)throw new b1(e);return s}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,s={}){const n={...s,floor:!1!==s.round&&!1!==s.floor};return this.isValid?ta.create(this.loc,n).formatDurationFromString(this,e):fx}toHuman(e={}){if(!this.isValid)return fx;const s=Nd.map(n=>{const d=this.values[n];return Li(d)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:n.slice(0,-1)}).format(d)}).filter(n=>n);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(s)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return 0!==this.years&&(e+=this.years+"Y"),(0!==this.months||0!==this.quarters)&&(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),(0!==this.hours||0!==this.minutes||0!==this.seconds||0!==this.milliseconds)&&(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),(0!==this.seconds||0!==this.milliseconds)&&(e+=_0(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const s=this.toMillis();return s<0||s>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},bi.fromMillis(s,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.isValid?px(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const s=er.fromDurationLike(e),n={};for(const d of Nd)(yg(s.values,d)||yg(this.values,d))&&(n[d]=s.get(d)+this.get(d));return nf(this,{values:n},!0)}minus(e){if(!this.isValid)return this;const s=er.fromDurationLike(e);return this.plus(s.negate())}mapUnits(e){if(!this.isValid)return this;const s={};for(const n of Object.keys(this.values))s[n]=b0(e(this.values[n],n));return nf(this,{values:s},!0)}get(e){return this[er.normalizeUnit(e)]}set(e){return this.isValid?nf(this,{values:{...this.values,...uy(e,er.normalizeUnit)}}):this}reconfigure({locale:e,numberingSystem:s,conversionAccuracy:n,matrix:d}={}){return nf(this,{loc:this.loc.clone({locale:e,numberingSystem:s}),matrix:d,conversionAccuracy:n})}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return mx(this.matrix,e),nf(this,{values:e},!0)}rescale(){return this.isValid?nf(this,{values:function BT(i){const e={};for(const[s,n]of Object.entries(i))0!==n&&(e[s]=n);return e}(this.normalize().shiftToAll().toObject())},!0):this}shiftTo(...e){if(!this.isValid)return this;if(0===e.length)return this;e=e.map(D=>er.normalizeUnit(D));const s={},n={},d=this.toObject();let b;for(const D of Nd)if(e.indexOf(D)>=0){b=D;let k=0;for(const W in n)k+=this.matrix[W][D]*n[W],n[W]=0;Ap(d[D])&&(k+=d[D]);const H=Math.trunc(k);s[D]=H,n[D]=(1e3*k-1e3*H)/1e3}else Ap(d[D])&&(n[D]=d[D]);for(const D in n)0!==n[D]&&(s[b]+=D===b?n[D]:n[D]/this.matrix[b][D]);return mx(this.matrix,s),nf(this,{values:s},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const s of Object.keys(this.values))e[s]=0===this.values[s]?0:-this.values[s];return nf(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function s(n,d){return void 0===n||0===n?void 0===d||0===d:n===d}for(const n of Nd)if(!s(this.values[n],e.values[n]))return!1;return!0}}const rf="Invalid Interval";class oo{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,s=null){if(!e)throw new Zl("need to specify a reason the Interval is invalid");const n=e instanceof Ac?e:new Ac(e,s);if(vo.throwOnInvalid)throw new v1(n);return new oo({invalid:n})}static fromDateTimes(e,s){const n=A0(e),d=A0(s),b=function gx(i,e){return i&&i.isValid?e&&e.isValid?e<i?oo.invalid("end before start",`The end of an interval must be after its start, but you had start=${i.toISO()} and end=${e.toISO()}`):null:oo.invalid("missing or invalid end"):oo.invalid("missing or invalid start")}(n,d);return b??new oo({start:n,end:d})}static after(e,s){const n=er.fromDurationLike(s),d=A0(e);return oo.fromDateTimes(d,d.plus(n))}static before(e,s){const n=er.fromDurationLike(s),d=A0(e);return oo.fromDateTimes(d.minus(n),d)}static fromISO(e,s){const[n,d]=(e||"").split("/",2);if(n&&d){let b,D,k,H;try{b=bi.fromISO(n,s),D=b.isValid}catch{D=!1}try{k=bi.fromISO(d,s),H=k.isValid}catch{H=!1}if(D&&H)return oo.fromDateTimes(b,k);if(D){const W=er.fromISO(d,s);if(W.isValid)return oo.after(b,W)}else if(H){const W=er.fromISO(n,s);if(W.isValid)return oo.before(k,W)}}return oo.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const s=this.start.startOf(e),n=this.end.startOf(e);return Math.floor(n.diff(s,e).get(e))+(n.valueOf()!==this.end.valueOf())}hasSame(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return!!this.isValid&&this.s>e}isBefore(e){return!!this.isValid&&this.e<=e}contains(e){return!!this.isValid&&this.s<=e&&this.e>e}set({start:e,end:s}={}){return this.isValid?oo.fromDateTimes(e||this.s,s||this.e):this}splitAt(...e){if(!this.isValid)return[];const s=e.map(A0).filter(D=>this.contains(D)).sort(),n=[];let{s:d}=this,b=0;for(;d<this.e;){const D=s[b]||this.e,k=+D>+this.e?this.e:D;n.push(oo.fromDateTimes(d,k)),d=k,b+=1}return n}splitBy(e){const s=er.fromDurationLike(e);if(!this.isValid||!s.isValid||0===s.as("milliseconds"))return[];let b,{s:n}=this,d=1;const D=[];for(;n<this.e;){const k=this.start.plus(s.mapUnits(H=>H*d));b=+k>+this.e?this.e:k,D.push(oo.fromDateTimes(n,b)),n=b,d+=1}return D}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return!!this.isValid&&+this.e==+e.s}abutsEnd(e){return!!this.isValid&&+e.e==+this.s}engulfs(e){return!!this.isValid&&this.s<=e.s&&this.e>=e.e}equals(e){return!(!this.isValid||!e.isValid)&&this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const s=this.s>e.s?this.s:e.s,n=this.e<e.e?this.e:e.e;return s>=n?null:oo.fromDateTimes(s,n)}union(e){return this.isValid?oo.fromDateTimes(this.s<e.s?this.s:e.s,this.e>e.e?this.e:e.e):this}static merge(e){const[s,n]=e.sort((d,b)=>d.s-b.s).reduce(([d,b],D)=>b?b.overlaps(D)||b.abutsStart(D)?[d,b.union(D)]:[d.concat([b]),D]:[d,D],[[],null]);return n&&s.push(n),s}static xor(e){let s=null,n=0;const d=[],b=e.map(H=>[{time:H.s,type:"s"},{time:H.e,type:"e"}]),k=Array.prototype.concat(...b).sort((H,W)=>H.time-W.time);for(const H of k)n+="s"===H.type?1:-1,1===n?s=H.time:(s&&+s!=+H.time&&d.push(oo.fromDateTimes(s,H.time)),s=null);return oo.merge(d)}difference(...e){return oo.xor([this].concat(e)).map(s=>this.intersection(s)).filter(s=>s&&!s.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:rf}toLocaleString(e=Sp,s={}){return this.isValid?ta.create(this.s.loc.clone(s),e).formatInterval(this):rf}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:rf}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:rf}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:rf}toFormat(e,{separator:s=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(e)}${s}${this.e.toFormat(e)}`:rf}toDuration(e,s){return this.isValid?this.e.diff(this.s,e,s):er.invalid(this.invalidReason)}mapEndpoints(e){return oo.fromDateTimes(e(this.s),e(this.e))}}class Cg{static hasDST(e=vo.defaultZone){const s=bi.now().setZone(e).set({month:12});return!e.isUniversal&&s.offset!==s.set({month:6}).offset}static isValidIANAZone(e){return Iu.isValidZone(e)}static normalizeZone(e){return Fd(e,vo.defaultZone)}static months(e="long",{locale:s=null,numberingSystem:n=null,locObj:d=null,outputCalendar:b="gregory"}={}){return(d||$r.create(s,n,b)).months(e)}static monthsFormat(e="long",{locale:s=null,numberingSystem:n=null,locObj:d=null,outputCalendar:b="gregory"}={}){return(d||$r.create(s,n,b)).months(e,!0)}static weekdays(e="long",{locale:s=null,numberingSystem:n=null,locObj:d=null}={}){return(d||$r.create(s,n,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:s=null,numberingSystem:n=null,locObj:d=null}={}){return(d||$r.create(s,n,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return $r.create(e).meridiems()}static eras(e="short",{locale:s=null}={}){return $r.create(s,null,"gregory").eras(e)}static features(){return{relative:j1()}}}function M0(i,e){const s=d=>d.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),n=s(e)-s(i);return Math.floor(er.fromMillis(n).as("days"))}const _x={arab:"[\u0660-\u0669]",arabext:"[\u06f0-\u06f9]",bali:"[\u1b50-\u1b59]",beng:"[\u09e6-\u09ef]",deva:"[\u0966-\u096f]",fullwide:"[\uff10-\uff19]",gujr:"[\u0ae6-\u0aef]",hanidec:"[\u3007|\u4e00|\u4e8c|\u4e09|\u56db|\u4e94|\u516d|\u4e03|\u516b|\u4e5d]",khmr:"[\u17e0-\u17e9]",knda:"[\u0ce6-\u0cef]",laoo:"[\u0ed0-\u0ed9]",limb:"[\u1946-\u194f]",mlym:"[\u0d66-\u0d6f]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0b66-\u0b6f]",tamldec:"[\u0be6-\u0bef]",telu:"[\u0c66-\u0c6f]",thai:"[\u0e50-\u0e59]",tibt:"[\u0f20-\u0f29]",latn:"\\d"},_E={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},yE=_x.hanidec.replace(/[\[|\]]/g,"").split("");function ql({numberingSystem:i},e=""){return new RegExp(`${_x[i||"latn"]}${e}`)}function ir(i,e=(s=>s)){return{regex:i,deser:([s])=>e(function yx(i){let e=parseInt(i,10);if(isNaN(e)){e="";for(let s=0;s<i.length;s++){const n=i.charCodeAt(s);if(-1!==i[s].search(_x.hanidec))e+=yE.indexOf(i[s]);else for(const d in _E){const[b,D]=_E[d];n>=b&&n<=D&&(e+=n-b)}}return parseInt(e,10)}return e}(s))}}const vE=`[ ${String.fromCharCode(160)}]`,vx=new RegExp(vE,"g");function bE(i){return i.replace(/\./g,"\\.?").replace(vx,vE)}function xE(i){return i.replace(/\./g,"").replace(vx," ").toLowerCase()}function Yl(i,e){return null===i?null:{regex:RegExp(i.map(bE).join("|")),deser:([s])=>i.findIndex(n=>xE(s)===xE(n))+e}}function wE(i,e){return{regex:i,deser:([,s,n])=>vg(s,n),groups:e}}function gs(i){return{regex:i,deser:([e])=>e}}function Tg(i){return i.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}const HT={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let CE=null;function Mg(i,e){return Array.prototype.concat(...i.map(s=>function LD(i,e){if(i.literal)return i;const n=ME(ta.macroTokenToFormatOpts(i.val),e);return null==n||n.includes(void 0)?i:n}(s,e)))}function TE(i,e,s){const n=Mg(ta.parseFormat(s),i),d=n.map(D=>function $T(i,e){const s=ql(e),n=ql(e,"{2}"),d=ql(e,"{3}"),b=ql(e,"{4}"),D=ql(e,"{6}"),k=ql(e,"{1,2}"),H=ql(e,"{1,3}"),W=ql(e,"{1,6}"),fe=ql(e,"{1,9}"),we=ql(e,"{2,4}"),ft=ql(e,"{4,6}"),Je=sn=>({regex:RegExp(Tg(sn.val)),deser:([Dn])=>Dn,literal:!0}),qt=(sn=>{if(i.literal)return Je(sn);switch(sn.val){case"G":return Yl(e.eras("short"),0);case"GG":return Yl(e.eras("long"),0);case"y":return ir(W);case"yy":case"kk":return ir(we,ox);case"yyyy":case"kkkk":return ir(b);case"yyyyy":return ir(ft);case"yyyyyy":return ir(D);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return ir(k);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return ir(n);case"MMM":return Yl(e.months("short",!0),1);case"MMMM":return Yl(e.months("long",!0),1);case"LLL":return Yl(e.months("short",!1),1);case"LLLL":return Yl(e.months("long",!1),1);case"o":case"S":return ir(H);case"ooo":case"SSS":return ir(d);case"u":return gs(fe);case"uu":return gs(k);case"uuu":case"E":case"c":return ir(s);case"a":return Yl(e.meridiems(),0);case"EEE":return Yl(e.weekdays("short",!1),1);case"EEEE":return Yl(e.weekdays("long",!1),1);case"ccc":return Yl(e.weekdays("short",!0),1);case"cccc":return Yl(e.weekdays("long",!0),1);case"Z":case"ZZ":return wE(new RegExp(`([+-]${k.source})(?::(${n.source}))?`),2);case"ZZZ":return wE(new RegExp(`([+-]${k.source})(${n.source})?`),2);case"z":return gs(/[a-z_+-/]{1,256}?/i);case" ":return gs(/[^\S\n\r]/);default:return Je(sn)}})(i)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};return qt.token=i,qt}(D,i)),b=d.find(D=>D.invalidReason);if(b)return{input:e,tokens:n,invalidReason:b.invalidReason};{const[D,k]=function kD(i){return[`^${i.map(s=>s.regex).reduce((s,n)=>`${s}(${n.source})`,"")}$`,i]}(d),H=RegExp(D,"i"),[W,fe]=function EE(i,e,s){const n=i.match(e);if(n){const d={};let b=1;for(const D in s)if(yg(s,D)){const k=s[D],H=k.groups?k.groups+1:1;!k.literal&&k.token&&(d[k.token.val[0]]=k.deser(n.slice(b,b+H))),b+=H}return[n,d]}return[n,{}]}(e,H,k),[we,ft,Je]=fe?function bx(i){let n,s=null;return Li(i.z)||(s=Iu.create(i.z)),Li(i.Z)||(s||(s=new ns(i.Z)),n=i.Z),Li(i.q)||(i.M=3*(i.q-1)+1),Li(i.h)||(i.h<12&&1===i.a?i.h+=12:12===i.h&&0===i.a&&(i.h=0)),0===i.G&&i.y&&(i.y=-i.y),Li(i.u)||(i.S=g0(i.u)),[Object.keys(i).reduce((b,D)=>{const k=(b=>{switch(b){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(D);return k&&(b[k]=i[D]),b},{}),s,n]}(fe):[null,null,void 0];if(yg(fe,"a")&&yg(fe,"H"))throw new Su("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:n,regex:H,rawMatches:W,matches:fe,result:we,zone:ft,specificOffset:Je}}}function ME(i,e){if(!i)return null;const n=ta.create(e,i).dtFormatter(function FD(){return CE||(CE=bi.fromMillis(1555555555555)),CE}()),d=n.formatToParts(),b=n.resolvedOptions();return d.map(D=>function RD(i,e,s){const{type:n,value:d}=i;if("literal"===n){const H=/^\s+$/.test(d);return{literal:!H,val:H?" ":d}}let D=n;"hour"===n&&(D=null!=e.hour12?e.hour12?"hour12":"hour24":null!=e.hourCycle?"h11"===e.hourCycle||"h12"===e.hourCycle?"hour12":"hour24":s.hour12?"hour12":"hour24");let k=HT[D];if("object"==typeof k&&(k=k[e[n]]),k)return{literal:!1,val:k}}(D,i,b))}const wx=[0,31,59,90,120,151,181,212,243,273,304,334],DE=[0,31,60,91,121,152,182,213,244,274,305,335];function Xl(i,e){return new Ac("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${i}, which is invalid`)}function SE(i,e,s){const n=new Date(Date.UTC(i,e-1,s));i<100&&i>=0&&n.setUTCFullYear(n.getUTCFullYear()-1900);const d=n.getUTCDay();return 0===d?7:d}function D0(i,e,s){return s+(ay(i)?DE:wx)[e-1]}function Ex(i,e){const s=ay(i)?DE:wx,n=s.findIndex(b=>b<e);return{month:n+1,day:e-s[n]}}function Cx(i){const{year:e,month:s,day:n}=i,d=D0(e,s,n),b=SE(e,s,n);let k,D=Math.floor((d-b+10)/7);return D<1?(k=e-1,D=v0(k)):D>v0(e)?(k=e+1,D=1):k=e,{weekYear:k,weekNumber:D,weekday:b,...x0(i)}}function py(i){const{weekYear:e,weekNumber:s,weekday:n}=i,d=SE(e,1,4),b=ly(e);let k,D=7*s+n-d-3;D<1?(k=e-1,D+=ly(k)):D>b?(k=e+1,D-=ly(e)):k=e;const{month:H,day:W}=Ex(k,D);return{year:k,month:H,day:W,...x0(i)}}function my(i){const{year:e,month:s,day:n}=i;return{year:e,ordinal:D0(e,s,n),...x0(i)}}function GT(i){const{year:e,ordinal:s}=i,{month:n,day:d}=Ex(e,s);return{year:e,month:n,day:d,...x0(i)}}function Tx(i){const e=m0(i.year),s=Ld(i.month,1,12),n=Ld(i.day,1,cy(i.year,i.month));return e?s?!n&&Xl("day",i.day):Xl("month",i.month):Xl("year",i.year)}function Lp(i){const{hour:e,minute:s,second:n,millisecond:d}=i,b=Ld(e,0,23)||24===e&&0===s&&0===n&&0===d,D=Ld(s,0,59),k=Ld(n,0,59),H=Ld(d,0,999);return b?D?k?!H&&Xl("millisecond",d):Xl("second",n):Xl("minute",s):Xl("hour",e)}const Mx="Invalid DateTime",Dx=864e13;function Dg(i){return new Ac("unsupported zone",`the zone "${i.name}" is not supported`)}function AE(i){return null===i.weekData&&(i.weekData=Cx(i.c)),i.weekData}function Np(i,e){const s={ts:i.ts,zone:i.zone,c:i.c,o:i.o,loc:i.loc,invalid:i.invalid};return new bi({...s,...e,old:s})}function WT(i,e,s){let n=i-60*e*1e3;const d=s.offset(n);if(e===d)return[n,e];n-=60*(d-e)*1e3;const b=s.offset(n);return d===b?[n,d]:[i-60*Math.min(d,b)*1e3,Math.max(d,b)]}function S0(i,e){const s=new Date(i+=60*e*1e3);return{year:s.getUTCFullYear(),month:s.getUTCMonth()+1,day:s.getUTCDate(),hour:s.getUTCHours(),minute:s.getUTCMinutes(),second:s.getUTCSeconds(),millisecond:s.getUTCMilliseconds()}}function I0(i,e,s){return WT(y0(i),e,s)}function PE(i,e){const s=i.o,n=i.c.year+Math.trunc(e.years),d=i.c.month+Math.trunc(e.months)+3*Math.trunc(e.quarters),b={...i.c,year:n,month:d,day:Math.min(i.c.day,cy(n,d))+Math.trunc(e.days)+7*Math.trunc(e.weeks)},D=er.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),k=y0(b);let[H,W]=WT(k,s,i.zone);return 0!==D&&(H+=D,W=i.zone.offset(H)),{ts:H,o:W}}function Sg(i,e,s,n,d,b){const{setZone:D,zone:k}=s;if(i&&0!==Object.keys(i).length||e){const H=e||k,W=bi.fromObject(i,{...s,zone:H,specificOffset:b});return D?W:W.setZone(k)}return bi.invalid(new Ac("unparsable",`the input "${d}" can't be parsed as ${n}`))}function gy(i,e,s=!0){return i.isValid?ta.create($r.create("en-US"),{allowZ:s,forceSimple:!0}).formatDateTimeFromString(i,e):null}function Sx(i,e){const s=i.c.year>9999||i.c.year<0;let n="";return s&&i.c.year>=0&&(n+="+"),n+=Lo(i.c.year,s?6:4),e?(n+="-",n+=Lo(i.c.month),n+="-",n+=Lo(i.c.day)):(n+=Lo(i.c.month),n+=Lo(i.c.day)),n}function Ix(i,e,s,n,d,b){let D=Lo(i.c.hour);return e?(D+=":",D+=Lo(i.c.minute),(0!==i.c.millisecond||0!==i.c.second||!s)&&(D+=":")):D+=Lo(i.c.minute),(0!==i.c.millisecond||0!==i.c.second||!s)&&(D+=Lo(i.c.second),(0!==i.c.millisecond||!n)&&(D+=".",D+=Lo(i.c.millisecond,3))),d&&(i.isOffsetFixed&&0===i.offset&&!b?D+="Z":i.o<0?(D+="-",D+=Lo(Math.trunc(-i.o/60)),D+=":",D+=Lo(Math.trunc(-i.o%60))):(D+="+",D+=Lo(Math.trunc(i.o/60)),D+=":",D+=Lo(Math.trunc(i.o%60)))),b&&(D+="["+i.zone.ianaName+"]"),D}const Ax={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},qT={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},YT={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Px=["year","month","day","hour","minute","second","millisecond"],XT=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],OE=["year","ordinal","hour","minute","second","millisecond"];function Ox(i){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[i.toLowerCase()];if(!e)throw new b1(i);return e}function Rx(i,e){const s=Fd(e.zone,vo.defaultZone),n=$r.fromObject(e),d=vo.now();let b,D;if(Li(i.year))b=d;else{for(const W of Px)Li(i[W])&&(i[W]=Ax[W]);const k=Tx(i)||Lp(i);if(k)return bi.invalid(k);const H=s.offset(d);[b,D]=I0(i,H,s)}return new bi({ts:b,zone:s,loc:n,o:D})}function kx(i,e,s){const n=!!Li(s.round)||s.round,d=(D,k)=>(D=_0(D,n||s.calendary?0:2,!0),e.loc.clone(s).relFormatter(s).format(D,k)),b=D=>s.calendary?e.hasSame(i,D)?0:e.startOf(D).diff(i.startOf(D),D).get(D):e.diff(i,D).get(D);if(s.unit)return d(b(s.unit),s.unit);for(const D of s.units){const k=b(D);if(Math.abs(k)>=1)return d(k,D)}return d(i>e?-0:0,s.units[s.units.length-1])}function RE(i){let s,e={};return i.length>0&&"object"==typeof i[i.length-1]?(e=i[i.length-1],s=Array.from(i).slice(0,i.length-1)):s=Array.from(i),[e,s]}class bi{constructor(e){const s=e.zone||vo.defaultZone;let n=e.invalid||(Number.isNaN(e.ts)?new Ac("invalid input"):null)||(s.isValid?null:Dg(s));this.ts=Li(e.ts)?vo.now():e.ts;let d=null,b=null;if(!n)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(s))[d,b]=[e.old.c,e.old.o];else{const k=s.offset(this.ts);d=S0(this.ts,k),n=Number.isNaN(d.year)?new Ac("invalid input"):null,d=n?null:d,b=n?null:k}this._zone=s,this.loc=e.loc||$r.create(),this.invalid=n,this.weekData=null,this.c=d,this.o=b,this.isLuxonDateTime=!0}static now(){return new bi({})}static local(){const[e,s]=RE(arguments),[n,d,b,D,k,H,W]=s;return Rx({year:n,month:d,day:b,hour:D,minute:k,second:H,millisecond:W},e)}static utc(){const[e,s]=RE(arguments),[n,d,b,D,k,H,W]=s;return e.zone=ns.utcInstance,Rx({year:n,month:d,day:b,hour:D,minute:k,second:H,millisecond:W},e)}static fromJSDate(e,s={}){const n=function rx(i){return"[object Date]"===Object.prototype.toString.call(i)}(e)?e.valueOf():NaN;if(Number.isNaN(n))return bi.invalid("invalid input");const d=Fd(s.zone,vo.defaultZone);return d.isValid?new bi({ts:n,zone:d,loc:$r.fromObject(s)}):bi.invalid(Dg(d))}static fromMillis(e,s={}){if(Ap(e))return e<-Dx||e>Dx?bi.invalid("Timestamp out of range"):new bi({ts:e,zone:Fd(s.zone,vo.defaultZone),loc:$r.fromObject(s)});throw new Zl(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,s={}){if(Ap(e))return new bi({ts:1e3*e,zone:Fd(s.zone,vo.defaultZone),loc:$r.fromObject(s)});throw new Zl("fromSeconds requires a numerical input")}static fromObject(e,s={}){e=e||{};const n=Fd(s.zone,vo.defaultZone);if(!n.isValid)return bi.invalid(Dg(n));const d=vo.now(),b=Li(s.specificOffset)?n.offset(d):s.specificOffset,D=uy(e,Ox),k=!Li(D.ordinal),H=!Li(D.year),W=!Li(D.month)||!Li(D.day),fe=H||W,we=D.weekYear||D.weekNumber,ft=$r.fromObject(s);if((fe||k)&&we)throw new Su("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(W&&k)throw new Su("Can't mix ordinal dates with month/day");const Je=we||D.weekday&&!fe;let ht,qt,sn=S0(d,b);Je?(ht=XT,qt=qT,sn=Cx(sn)):k?(ht=OE,qt=YT,sn=my(sn)):(ht=Px,qt=Ax);let Dn=!1;for(const $a of ht)Li(D[$a])?D[$a]=Dn?qt[$a]:sn[$a]:Dn=!0;const oi=Je?function IE(i){const e=m0(i.weekYear),s=Ld(i.weekNumber,1,v0(i.weekYear)),n=Ld(i.weekday,1,7);return e?s?!n&&Xl("weekday",i.weekday):Xl("week",i.week):Xl("weekYear",i.weekYear)}(D):k?function ZT(i){const e=m0(i.year),s=Ld(i.ordinal,1,ly(i.year));return e?!s&&Xl("ordinal",i.ordinal):Xl("year",i.year)}(D):Tx(D),_r=oi||Lp(D);if(_r)return bi.invalid(_r);const wi=Je?py(D):k?GT(D):D,[ys,yl]=I0(wi,b,n),bo=new bi({ts:ys,zone:n,o:yl,loc:ft});return D.weekday&&fe&&e.weekday!==bo.weekday?bi.invalid("mismatched weekday",`you can't specify both a weekday of ${D.weekday} and a date of ${bo.toISO()}`):bo}static fromISO(e,s={}){const[n,d]=function C0(i){return bg(i,[DT,Eg],[PD,IT],[ST,AT],[OD,PT])}(e);return Sg(n,d,s,"ISO 8601",e)}static fromRFC2822(e,s={}){const[n,d]=function hE(i){return bg(function CT(i){return i.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(i),[uE,ET])}(e);return Sg(n,d,s,"RFC 2822",e)}static fromHTTP(e,s={}){const[n,d]=function OT(i){return bg(i,[TT,dE],[MT,dE],[hy,hx])}(e);return Sg(n,d,s,"HTTP",s)}static fromFormat(e,s,n={}){if(Li(e)||Li(s))throw new Zl("fromFormat requires an input string and a format");const{locale:d=null,numberingSystem:b=null}=n,D=$r.fromOpts({locale:d,numberingSystem:b,defaultToEN:!0}),[k,H,W,fe]=function xx(i,e,s){const{result:n,zone:d,specificOffset:b,invalidReason:D}=TE(i,e,s);return[n,d,b,D]}(D,e,s);return fe?bi.invalid(fe):Sg(k,H,n,`format ${s}`,e,W)}static fromString(e,s,n={}){return bi.fromFormat(e,s,n)}static fromSQL(e,s={}){const[n,d]=function LT(i){return bg(i,[kT,Eg],[pE,FT])}(e);return Sg(n,d,s,"SQL",e)}static invalid(e,s=null){if(!e)throw new Zl("need to specify a reason the DateTime is invalid");const n=e instanceof Ac?e:new Ac(e,s);if(vo.throwOnInvalid)throw new y1(n);return new bi({invalid:n})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,s={}){const n=ME(e,$r.fromObject(s));return n?n.map(d=>d?d.val:null).join(""):null}static expandFormat(e,s={}){return Mg(ta.parseFormat(e),$r.fromObject(s)).map(d=>d.val).join("")}get(e){return this[e]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?AE(this).weekYear:NaN}get weekNumber(){return this.isValid?AE(this).weekNumber:NaN}get weekday(){return this.isValid?AE(this).weekday:NaN}get ordinal(){return this.isValid?my(this.c).ordinal:NaN}get monthShort(){return this.isValid?Cg.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Cg.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Cg.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Cg.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,s=6e4,n=y0(this.c),d=this.zone.offset(n-e),b=this.zone.offset(n+e),D=this.zone.offset(n-d*s),k=this.zone.offset(n-b*s);if(D===k)return[this];const H=n-D*s,W=n-k*s,fe=S0(H,D),we=S0(W,k);return fe.hour===we.hour&&fe.minute===we.minute&&fe.second===we.second&&fe.millisecond===we.millisecond?[Np(this,{ts:H}),Np(this,{ts:W})]:[this]}get isInLeapYear(){return ay(this.year)}get daysInMonth(){return cy(this.year,this.month)}get daysInYear(){return this.isValid?ly(this.year):NaN}get weeksInWeekYear(){return this.isValid?v0(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:s,numberingSystem:n,calendar:d}=ta.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:s,numberingSystem:n,outputCalendar:d}}toUTC(e=0,s={}){return this.setZone(ns.instance(e),s)}toLocal(){return this.setZone(vo.defaultZone)}setZone(e,{keepLocalTime:s=!1,keepCalendarTime:n=!1}={}){if((e=Fd(e,vo.defaultZone)).equals(this.zone))return this;if(e.isValid){let d=this.ts;if(s||n){const b=e.offset(this.ts),D=this.toObject();[d]=I0(D,b,e)}return Np(this,{ts:d,zone:e})}return bi.invalid(Dg(e))}reconfigure({locale:e,numberingSystem:s,outputCalendar:n}={}){return Np(this,{loc:this.loc.clone({locale:e,numberingSystem:s,outputCalendar:n})})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const s=uy(e,Ox),n=!Li(s.weekYear)||!Li(s.weekNumber)||!Li(s.weekday),d=!Li(s.ordinal),b=!Li(s.year),D=!Li(s.month)||!Li(s.day);if((b||D||d)&&(s.weekYear||s.weekNumber))throw new Su("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(D&&d)throw new Su("Can't mix ordinal dates with month/day");let W;n?W=py({...Cx(this.c),...s}):Li(s.ordinal)?(W={...this.toObject(),...s},Li(s.day)&&(W.day=Math.min(cy(W.year,W.month),W.day))):W=GT({...my(this.c),...s});const[fe,we]=I0(W,this.o,this.zone);return Np(this,{ts:fe,o:we})}plus(e){return this.isValid?Np(this,PE(this,er.fromDurationLike(e))):this}minus(e){return this.isValid?Np(this,PE(this,er.fromDurationLike(e).negate())):this}startOf(e){if(!this.isValid)return this;const s={},n=er.normalizeUnit(e);switch(n){case"years":s.month=1;case"quarters":case"months":s.day=1;case"weeks":case"days":s.hour=0;case"hours":s.minute=0;case"minutes":s.second=0;case"seconds":s.millisecond=0}if("weeks"===n&&(s.weekday=1),"quarters"===n){const d=Math.ceil(this.month/3);s.month=3*(d-1)+1}return this.set(s)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,s={}){return this.isValid?ta.create(this.loc.redefaultToEN(s)).formatDateTimeFromString(this,e):Mx}toLocaleString(e=Sp,s={}){return this.isValid?ta.create(this.loc.clone(s),e).formatDateTime(this):Mx}toLocaleParts(e={}){return this.isValid?ta.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:s=!1,suppressMilliseconds:n=!1,includeOffset:d=!0,extendedZone:b=!1}={}){if(!this.isValid)return null;const D="extended"===e;let k=Sx(this,D);return k+="T",k+=Ix(this,D,s,n,d,b),k}toISODate({format:e="extended"}={}){return this.isValid?Sx(this,"extended"===e):null}toISOWeekDate(){return gy(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:s=!1,includeOffset:n=!0,includePrefix:d=!1,extendedZone:b=!1,format:D="extended"}={}){return this.isValid?(d?"T":"")+Ix(this,"extended"===D,s,e,n,b):null}toRFC2822(){return gy(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return gy(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Sx(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:s=!1,includeOffsetSpace:n=!0}={}){let d="HH:mm:ss.SSS";return(s||e)&&(n&&(d+=" "),s?d+="z":e&&(d+="ZZ")),gy(this,d,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():Mx}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const s={...this.c};return e.includeConfig&&(s.outputCalendar=this.outputCalendar,s.numberingSystem=this.loc.numberingSystem,s.locale=this.loc.locale),s}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,s="milliseconds",n={}){if(!this.isValid||!e.isValid)return er.invalid("created by diffing an invalid DateTime");const d={locale:this.locale,numberingSystem:this.numberingSystem,...n},b=function $1(i){return Array.isArray(i)?i:[i]}(s).map(er.normalizeUnit),D=e.valueOf()>this.valueOf(),W=function VT(i,e,s,n){let[d,b,D,k]=function zT(i,e,s){const n=[["years",(H,W)=>W.year-H.year],["quarters",(H,W)=>W.quarter-H.quarter+4*(W.year-H.year)],["months",(H,W)=>W.month-H.month+12*(W.year-H.year)],["weeks",(H,W)=>{const fe=M0(H,W);return(fe-fe%7)/7}],["days",M0]],d={},b=i;let D,k;for(const[H,W]of n)s.indexOf(H)>=0&&(D=H,d[H]=W(i,e),k=b.plus(d),k>e?(d[H]--,(i=b.plus(d))>e&&(k=i,d[H]--,i=b.plus(d))):i=k);return[i,d,k,D]}(i,e,s);const H=e-d,W=s.filter(we=>["hours","minutes","seconds","milliseconds"].indexOf(we)>=0);0===W.length&&(D<e&&(D=d.plus({[k]:1})),D!==d&&(b[k]=(b[k]||0)+H/(D-d)));const fe=er.fromObject(b,n);return W.length>0?er.fromMillis(H,n).shiftTo(...W).plus(fe):fe}(D?this:e,D?e:this,b,d);return D?W.negate():W}diffNow(e="milliseconds",s={}){return this.diff(bi.now(),e,s)}until(e){return this.isValid?oo.fromDateTimes(this,e):this}hasSame(e,s){if(!this.isValid)return!1;const n=e.valueOf(),d=this.setZone(e.zone,{keepLocalTime:!0});return d.startOf(s)<=n&&n<=d.endOf(s)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const s=e.base||bi.fromObject({},{zone:this.zone}),n=e.padding?this<s?-e.padding:e.padding:0;let d=["years","months","days","hours","minutes","seconds"],b=e.unit;return Array.isArray(e.unit)&&(d=e.unit,b=void 0),kx(s,this.plus(n),{...e,numeric:"always",units:d,unit:b})}toRelativeCalendar(e={}){return this.isValid?kx(e.base||bi.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(bi.isDateTime))throw new Zl("min requires all arguments be DateTimes");return H1(e,s=>s.valueOf(),Math.min)}static max(...e){if(!e.every(bi.isDateTime))throw new Zl("max requires all arguments be DateTimes");return H1(e,s=>s.valueOf(),Math.max)}static fromFormatExplain(e,s,n={}){const{locale:d=null,numberingSystem:b=null}=n;return TE($r.fromOpts({locale:d,numberingSystem:b,defaultToEN:!0}),e,s)}static fromStringExplain(e,s,n={}){return bi.fromFormatExplain(e,s,n)}static get DATE_SHORT(){return Sp}static get DATE_MED(){return va}static get DATE_MED_WITH_WEEKDAY(){return MD}static get DATE_FULL(){return Zb}static get DATE_HUGE(){return Wb}static get TIME_SIMPLE(){return x1}static get TIME_WITH_SECONDS(){return qb}static get TIME_WITH_SHORT_OFFSET(){return Yb}static get TIME_WITH_LONG_OFFSET(){return Xb}static get TIME_24_SIMPLE(){return Kb}static get TIME_24_WITH_SECONDS(){return w1}static get TIME_24_WITH_SHORT_OFFSET(){return E1}static get TIME_24_WITH_LONG_OFFSET(){return C1}static get DATETIME_SHORT(){return _g}static get DATETIME_SHORT_WITH_SECONDS(){return T1}static get DATETIME_MED(){return M1}static get DATETIME_MED_WITH_SECONDS(){return D1}static get DATETIME_MED_WITH_WEEKDAY(){return a0}static get DATETIME_FULL(){return Jb}static get DATETIME_FULL_WITH_SECONDS(){return Qb}static get DATETIME_HUGE(){return ex}static get DATETIME_HUGE_WITH_SECONDS(){return S1}}function A0(i){if(bi.isDateTime(i))return i;if(i&&i.valueOf&&Ap(i.valueOf()))return bi.fromJSDate(i);if(i&&"object"==typeof i)return bi.fromObject(i);throw new Zl(`Unknown datetime argument: ${i}, of type ${typeof i}`)}let ND=(()=>{var i;class e{constructor(n){this.http=n,this.apiUrl=ul_apiUrl}getBlogs(){return this.http.get(`${this.apiUrl}/posts`)}getBlogById(n){return this.http.get(`${this.apiUrl}/post/${n}`)}dislakeBlog(n){return this.http.delete(`${this.apiUrl}/posts/${n}/like`)}likeBlog(n){return this.http.put(`${this.apiUrl}/posts/${n}/like`,{})}getComment(n){return this.http.get(`${this.apiUrl}/posts/${n}/comments`)}addComment(n,d){return this.http.post(`${this.apiUrl}/posts/${n}/comments`,{text:d})}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Nh))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),BD=(()=>{var i;class e{constructor(n,d,b,D){this.actions$=n,this.blogService=d,this.userService=b,this.store=D,this.loadBlogs$=_l(()=>this.actions$.pipe(za(Ph),(0,wt.z)(()=>this.blogService.getBlogs().pipe((0,R.U)(k=>{const H=k.map((W,fe)=>({...W,liked:W.likes.some(we=>we.userId===this.userId),created_at:this.formatRelativeTime(k[fe].created_at)}));return km({blogs:H})}),(0,ln.K)(k=>(0,Nn.of)(_v({error:k.message}))))))),this.getBlogById$=_l(()=>this.actions$.pipe(za(Oh),(0,wt.z)(k=>this.blogService.getBlogById(k.blogId).pipe((0,R.U)(H=>yv(H)))))),this.DislakeBlog$=_l(()=>this.actions$.pipe(za(yc),(0,wt.z)(k=>this.blogService.dislakeBlog(k.blogId).pipe((0,R.U)(H=>(this.store.dispatch(Ph()),Lm(H))))))),this.LikeBlog$=_l(()=>this.actions$.pipe(za(tp),(0,wt.z)(k=>this.blogService.likeBlog(k.blogId).pipe((0,R.U)(H=>(this.store.dispatch(Ph()),Fm(H))))))),this.getComments$=_l(()=>this.actions$.pipe(za(kr),(0,wt.z)(k=>this.blogService.getComment(k.blogId).pipe((0,R.U)(W=>hs({message:W})))))),this.AddComment$=_l(()=>this.actions$.pipe(za(uu),(0,wt.z)(k=>this.blogService.addComment(k.blogId,k.text).pipe((0,R.U)(H=>(console.log(H),Bl(H))))))),this.userId=this.userService.getUserId()}formatRelativeTime(n){if(!n)return"Timestamp is null";try{const d=bi.fromISO(n);return d.isValid?d.toRelative():"Invalid timestamp"}catch(d){return console.error(d),"Error parsing timestamp"}}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(ty),E.LFG(ND),E.LFG(cp),E.LFG(Ct.yh))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})(),JT=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({providers:[Dw],imports:[Ct.Aw.forFeature("getBlogById",KC),Ct.Aw.forFeature("blogs",_1),Ct.Aw.forFeature("dislakes",JC),Ct.Aw.forFeature("like",mg),Ct.Aw.forFeature("comment",Gb),Ct.Aw.forFeature("getComments",CD),ry.forFeature([BD])]}),e})(),zD=(()=>{var i;class e{constructor(n){this.http=n,this.apiUrl=ul_apiUrl}createBlog(n,d){const b=new Ks({Authorization:`${d}`}),D=new FormData;return D.append("title",n.title),D.append("content",n.content),this.http.post(`${this.apiUrl}/posts`,n,{headers:b})}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Nh))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),VD=(()=>{var i;class e{constructor(n,d){this.actions$=n,this.addBlogService=d,this.addBlog$=_l(()=>this.actions$.pipe(za(Mb),(0,He.w)(b=>this.addBlogService.createBlog(b,"asdas").pipe((0,R.U)(D=>(localStorage.removeItem("blogs"),Db({message:D.message,postId:D.postId}))),(0,ln.K)(D=>(0,Nn.of)(xw({error:D.message})))))))}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(ty),E.LFG(zD))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();const jD=(0,Ct.Lq)({message:null,postId:null,error:null},(0,Ct.on)(Db,(i,{message:e,postId:s})=>({...i,message:e,postId:s,error:null})),(0,Ct.on)(xw,(i,{error:e})=>({...i,message:null,postId:null,error:e})));let QT=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[Ct.Aw.forFeature("newBlog",jD),ry.forFeature([VD])]}),e})();const kE=(0,Ct.Lq)({_id:"",title:"",content:"",imageUrl:"",userId:""},(0,Ct.on)(Yv,(i,{response:e})=>({...i,_id:e._id,title:e.title,content:e.content,imageUrl:e.imageUrl,userId:e.userId})));let P0=(()=>{var i;class e{constructor(n){this.http=n,this.apiUrl=ul_apiUrl}getBlog(n){return this.http.get(`${this.apiUrl}/post/${n}`)}editBlog(n){const d=localStorage.getItem("token"),b=new Ks({Authorization:d});return this.http.put(`${this.apiUrl}/posts/64fc929e18e4d343a4e1fdb7`,n,{headers:b})}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Nh))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),FE=(()=>{var i;class e{constructor(n,d){this.actions$=n,this.blogService=d,this.getPostId$=_l(()=>this.actions$.pipe(za(qv),(0,He.w)(b=>this.blogService.getBlog(b.blogId).pipe((0,R.U)(D=>Yv({response:D}))))))}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(ty),E.LFG(P0))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})(),eM=(()=>{var i;class e{constructor(n,d){this.actions$=n,this.blogService=d,this.editPost$=_l(()=>this.actions$.pipe(za(ww),(0,He.w)(({_id:b,title:D,content:k,imageUrl:H})=>this.blogService.editBlog({_id:b,title:D,content:k,imageUrl:H}).pipe((0,R.U)(W=>(console.log(W),Xv({response:W})))))))}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(ty),E.LFG(P0))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})(),_y=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[Ct.Aw.forFeature("getBlog",kE),ry.forFeature([eM,FE])]}),e})(),tM=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[JT,QT,$b,_y,JT,QT,$b,_y]}),e})(),HD=(()=>{var i;class e{constructor(n){this.store=n}intercept(n,d){return this.store.select(Tw).pipe((0,ut.q)(1),Ba(b=>{if(!b)return d.handle(n);let D=n.clone({setHeaders:{Authorization:`${b}`}});return d.handle(D)}))}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ct.yh))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();function LE(i){return new E.vHH(3e3,!1)}function sf(i){switch(i.length){case 0:return new Mp;case 1:return i[0];default:return new IC(i)}}function R0(i,e,s=new Map,n=new Map){const d=[],b=[];let D=-1,k=null;if(e.forEach(H=>{const W=H.get("offset"),fe=W==D,we=fe&&k||new Map;H.forEach((ft,Je)=>{let ht=Je,qt=ft;if("offset"!==Je)switch(ht=i.normalizePropertyName(ht,d),qt){case"!":qt=s.get(Je);break;case Cu:qt=n.get(Je);break;default:qt=i.normalizeStyleValue(Je,ht,qt,d)}we.set(ht,qt)}),fe||b.push(we),k=we,D=W}),d.length)throw function vM(i){return new E.vHH(3502,!1)}();return b}function Pu(i,e,s,n){switch(e){case"start":i.onStart(()=>n(s&&k0(s,"start",i)));break;case"done":i.onDone(()=>n(s&&k0(s,"done",i)));break;case"destroy":i.onDestroy(()=>n(s&&k0(s,"destroy",i)))}}function k0(i,e,s){const b=vy(i.element,i.triggerName,i.fromState,i.toState,e||i.phaseName,s.totalTime??i.totalTime,!!s.disabled),D=i._data;return null!=D&&(b._data=D),b}function vy(i,e,s,n,d="",b=0,D){return{element:i,triggerName:e,fromState:s,toState:n,phaseName:d,totalTime:b,disabled:!!D}}function ba(i,e,s){let n=i.get(e);return n||i.set(e,n=s),n}function $E(i){const e=i.indexOf(":");return[i.substring(1,e),i.slice(e+1)]}const qD=(()=>typeof document>"u"?null:document.documentElement)();function F0(i){const e=i.parentNode||i.host||null;return e===qD?null:e}let Bp=null,HE=!1;function Nx(i,e){for(;e;){if(e===i)return!0;e=F0(e)}return!1}function GE(i,e,s){if(s)return Array.from(i.querySelectorAll(e));const n=i.querySelector(e);return n?[n]:[]}let SM=(()=>{var i;class e{validateStyleProperty(n){return function TM(i){Bp||(Bp=function YD(){return typeof document<"u"?document.body:null}()||{},HE=!!Bp.style&&"WebkitAppearance"in Bp.style);let e=!0;return Bp.style&&!function CM(i){return"ebkit"==i.substring(1,6)}(i)&&(e=i in Bp.style,!e&&HE&&(e="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in Bp.style)),e}(n)}matchesElement(n,d){return!1}containsElement(n,d){return Nx(n,d)}getParentElement(n){return F0(n)}query(n,d,b){return GE(n,d,b)}computeStyle(n,d,b){return b||""}animate(n,d,b,D,k,H=[],W){return new Mp(b,D)}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})(),by=(()=>{class e{}return e.NOOP=new SM,e})();const ZE=1e3,L0="ng-enter",xy="ng-leave",Bd="ng-trigger",zp=".ng-trigger",zx="ng-animating",N0=".ng-animating";function zd(i){if("number"==typeof i)return i;const e=i.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Vx(parseFloat(e[1]),e[2])}function Vx(i,e){return"s"===e?i*ZE:i}function Ux(i,e,s){return i.hasOwnProperty("duration")?i:function WE(i,e,s){let d,b=0,D="";if("string"==typeof i){const k=i.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===k)return e.push(LE()),{duration:0,delay:0,easing:""};d=Vx(parseFloat(k[1]),k[2]);const H=k[3];null!=H&&(b=Vx(parseFloat(H),k[4]));const W=k[5];W&&(D=W)}else d=i;if(!s){let k=!1,H=e.length;d<0&&(e.push(function NE(){return new E.vHH(3100,!1)}()),k=!0),b<0&&(e.push(function nM(){return new E.vHH(3101,!1)}()),k=!0),k&&e.splice(H,0,LE())}return{duration:d,delay:b,easing:D}}(i,e,s)}function wy(i,e={}){return Object.keys(i).forEach(s=>{e[s]=i[s]}),e}function qE(i){const e=new Map;return Object.keys(i).forEach(s=>{e.set(s,i[s])}),e}function Vp(i,e=new Map,s){if(s)for(let[n,d]of s)e.set(n,d);for(let[n,d]of i)e.set(n,d);return e}function Pc(i,e,s){e.forEach((n,d)=>{const b=$x(d);s&&!s.has(d)&&s.set(d,i.style[b]),i.style[b]=n})}function Up(i,e){e.forEach((s,n)=>{const d=$x(n);i.style[d]=""})}function Ey(i){return Array.isArray(i)?1==i.length?i[0]:kb(i):i}const YE=new RegExp("{{\\s*(.+?)\\s*}}","g");function OM(i){let e=[];if("string"==typeof i){let s;for(;s=YE.exec(i);)e.push(s[1]);YE.lastIndex=0}return e}function B0(i,e,s){const n=i.toString(),d=n.replace(YE,(b,D)=>{let k=e[D];return null==k&&(s.push(function rM(i){return new E.vHH(3003,!1)}()),k=""),k.toString()});return d==n?i:d}function jx(i){const e=[];let s=i.next();for(;!s.done;)e.push(s.value),s=i.next();return e}const KD=/-+([a-z0-9])/g;function $x(i){return i.replace(KD,(...e)=>e[1].toUpperCase())}function Ua(i,e,s){switch(e.type){case 7:return i.visitTrigger(e,s);case 0:return i.visitState(e,s);case 1:return i.visitTransition(e,s);case 2:return i.visitSequence(e,s);case 3:return i.visitGroup(e,s);case 4:return i.visitAnimate(e,s);case 5:return i.visitKeyframes(e,s);case 6:return i.visitStyle(e,s);case 8:return i.visitReference(e,s);case 9:return i.visitAnimateChild(e,s);case 10:return i.visitAnimateRef(e,s);case 11:return i.visitQuery(e,s);case 12:return i.visitStagger(e,s);default:throw function GD(i){return new E.vHH(3004,!1)}()}}function af(i,e){return window.getComputedStyle(i)[e]}const jp="*";function QD(i,e){const s=[];return"string"==typeof i?i.split(/\s*,\s*/).forEach(n=>function eS(i,e,s){if(":"==i[0]){const H=function tS(i,e){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(s,n)=>parseFloat(n)>parseFloat(s);case":decrement":return(s,n)=>parseFloat(n)<parseFloat(s);default:return e.push(function mM(i){return new E.vHH(3016,!1)}()),"* => *"}}(i,s);if("function"==typeof H)return void e.push(H);i=H}const n=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==n||n.length<4)return s.push(function pM(i){return new E.vHH(3015,!1)}()),e;const d=n[1],b=n[2],D=n[3];e.push(eC(d,D));"<"==b[0]&&!(d==jp&&D==jp)&&e.push(eC(D,d))}(n,s,e)):s.push(i),s}const Cy=new Set(["true","1"]),z0=new Set(["false","0"]);function eC(i,e){const s=Cy.has(i)||z0.has(i),n=Cy.has(e)||z0.has(e);return(d,b)=>{let D=i==jp||i==d,k=e==jp||e==b;return!D&&s&&"boolean"==typeof d&&(D=d?Cy.has(i):z0.has(i)),!k&&n&&"boolean"==typeof b&&(k=b?Cy.has(e):z0.has(e)),D&&k}}const LM=new RegExp("s*:selfs*,?","g");function V0(i,e,s,n){return new nC(i).build(e,s,n)}class nC{constructor(e){this._driver=e}build(e,s,n){const d=new iC(s);return this._resetContextStyleTimingState(d),Ua(this,Ey(e),d)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,s){let n=s.queryCount=0,d=s.depCount=0;const b=[],D=[];return"@"==e.name.charAt(0)&&s.errors.push(function yy(){return new E.vHH(3006,!1)}()),e.definitions.forEach(k=>{if(this._resetContextStyleTimingState(s),0==k.type){const H=k,W=H.name;W.toString().split(/\s*,\s*/).forEach(fe=>{H.name=fe,b.push(this.visitState(H,s))}),H.name=W}else if(1==k.type){const H=this.visitTransition(k,s);n+=H.queryCount,d+=H.depCount,D.push(H)}else s.errors.push(function O0(){return new E.vHH(3007,!1)}())}),{type:7,name:e.name,states:b,transitions:D,queryCount:n,depCount:d,options:null}}visitState(e,s){const n=this.visitStyle(e.styles,s),d=e.options&&e.options.params||null;if(n.containsDynamicStyles){const b=new Set,D=d||{};n.styles.forEach(k=>{k instanceof Map&&k.forEach(H=>{OM(H).forEach(W=>{D.hasOwnProperty(W)||b.add(W)})})}),b.size&&(jx(b.values()),s.errors.push(function sM(i,e){return new E.vHH(3008,!1)}()))}return{type:0,name:e.name,style:n,options:d?{params:d}:null}}visitTransition(e,s){s.queryCount=0,s.depCount=0;const n=Ua(this,Ey(e.animation),s);return{type:1,matchers:QD(e.expr,s.errors),animation:n,queryCount:s.queryCount,depCount:s.depCount,options:lf(e.options)}}visitSequence(e,s){return{type:2,steps:e.steps.map(n=>Ua(this,n,s)),options:lf(e.options)}}visitGroup(e,s){const n=s.currentTime;let d=0;const b=e.steps.map(D=>{s.currentTime=n;const k=Ua(this,D,s);return d=Math.max(d,s.currentTime),k});return s.currentTime=d,{type:3,steps:b,options:lf(e.options)}}visitAnimate(e,s){const n=function nS(i,e){if(i.hasOwnProperty("duration"))return i;if("number"==typeof i)return Ty(Ux(i,e).duration,0,"");const s=i;if(s.split(/\s+/).some(b=>"{"==b.charAt(0)&&"{"==b.charAt(1))){const b=Ty(0,0,"");return b.dynamic=!0,b.strValue=s,b}const d=Ux(s,e);return Ty(d.duration,d.delay,d.easing)}(e.timings,s.errors);s.currentAnimateTimings=n;let d,b=e.styles?e.styles:Tu({});if(5==b.type)d=this.visitKeyframes(b,s);else{let D=e.styles,k=!1;if(!D){k=!0;const W={};n.easing&&(W.easing=n.easing),D=Tu(W)}s.currentTime+=n.duration+n.delay;const H=this.visitStyle(D,s);H.isEmptyStep=k,d=H}return s.currentAnimateTimings=null,{type:4,timings:n,style:d,options:null}}visitStyle(e,s){const n=this._makeStyleAst(e,s);return this._validateStyleAst(n,s),n}_makeStyleAst(e,s){const n=[],d=Array.isArray(e.styles)?e.styles:[e.styles];for(let k of d)"string"==typeof k?k===Cu?n.push(k):s.errors.push(new E.vHH(3002,!1)):n.push(qE(k));let b=!1,D=null;return n.forEach(k=>{if(k instanceof Map&&(k.has("easing")&&(D=k.get("easing"),k.delete("easing")),!b))for(let H of k.values())if(H.toString().indexOf("{{")>=0){b=!0;break}}),{type:6,styles:n,easing:D,offset:e.offset,containsDynamicStyles:b,options:null}}_validateStyleAst(e,s){const n=s.currentAnimateTimings;let d=s.currentTime,b=s.currentTime;n&&b>0&&(b-=n.duration+n.delay),e.styles.forEach(D=>{"string"!=typeof D&&D.forEach((k,H)=>{const W=s.collectedStyles.get(s.currentQuerySelector),fe=W.get(H);let we=!0;fe&&(b!=d&&b>=fe.startTime&&d<=fe.endTime&&(s.errors.push(function lM(i,e,s,n,d){return new E.vHH(3010,!1)}()),we=!1),b=fe.startTime),we&&W.set(H,{startTime:b,endTime:d}),s.options&&function PM(i,e,s){const n=e.params||{},d=OM(i);d.length&&d.forEach(b=>{n.hasOwnProperty(b)||s.push(function iM(i){return new E.vHH(3001,!1)}())})}(k,s.options,s.errors)})})}visitKeyframes(e,s){const n={type:5,styles:[],options:null};if(!s.currentAnimateTimings)return s.errors.push(function cM(){return new E.vHH(3011,!1)}()),n;let b=0;const D=[];let k=!1,H=!1,W=0;const fe=e.steps.map(Dn=>{const oi=this._makeStyleAst(Dn,s);let _r=null!=oi.offset?oi.offset:function Zx(i){if("string"==typeof i)return null;let e=null;if(Array.isArray(i))i.forEach(s=>{if(s instanceof Map&&s.has("offset")){const n=s;e=parseFloat(n.get("offset")),n.delete("offset")}});else if(i instanceof Map&&i.has("offset")){const s=i;e=parseFloat(s.get("offset")),s.delete("offset")}return e}(oi.styles),wi=0;return null!=_r&&(b++,wi=oi.offset=_r),H=H||wi<0||wi>1,k=k||wi<W,W=wi,D.push(wi),oi});H&&s.errors.push(function uM(){return new E.vHH(3012,!1)}()),k&&s.errors.push(function Fx(){return new E.vHH(3200,!1)}());const we=e.steps.length;let ft=0;b>0&&b<we?s.errors.push(function dM(){return new E.vHH(3202,!1)}()):0==b&&(ft=1/(we-1));const Je=we-1,ht=s.currentTime,qt=s.currentAnimateTimings,sn=qt.duration;return fe.forEach((Dn,oi)=>{const _r=ft>0?oi==Je?1:ft*oi:D[oi],wi=_r*sn;s.currentTime=ht+qt.delay+wi,qt.duration=wi,this._validateStyleAst(Dn,s),Dn.offset=_r,n.styles.push(Dn)}),n}visitReference(e,s){return{type:8,animation:Ua(this,Ey(e.animation),s),options:lf(e.options)}}visitAnimateChild(e,s){return s.depCount++,{type:9,options:lf(e.options)}}visitAnimateRef(e,s){return{type:10,animation:this.visitReference(e.animation,s),options:lf(e.options)}}visitQuery(e,s){const n=s.currentQuerySelector,d=e.options||{};s.queryCount++,s.currentQuery=e;const[b,D]=function NM(i){const e=!!i.split(/\s*,\s*/).find(s=>":self"==s);return e&&(i=i.replace(LM,"")),i=i.replace(/@\*/g,zp).replace(/@\w+/g,s=>zp+"-"+s.slice(1)).replace(/:animating/g,N0),[i,e]}(e.selector);s.currentQuerySelector=n.length?n+" "+b:b,ba(s.collectedStyles,s.currentQuerySelector,new Map);const k=Ua(this,Ey(e.animation),s);return s.currentQuery=null,s.currentQuerySelector=n,{type:11,selector:b,limit:d.limit||0,optional:!!d.optional,includeSelf:D,animation:k,originalSelector:e.selector,options:lf(e.options)}}visitStagger(e,s){s.currentQuery||s.errors.push(function hM(){return new E.vHH(3013,!1)}());const n="full"===e.timings?{duration:0,delay:0,easing:"full"}:Ux(e.timings,s.errors,!0);return{type:12,animation:Ua(this,Ey(e.animation),s),timings:n,options:null}}}class iC{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function lf(i){return i?(i=wy(i)).params&&(i.params=function BM(i){return i?wy(i):null}(i.params)):i={},i}function Ty(i,e,s){return{duration:i,delay:e,easing:s}}function Wx(i,e,s,n,d,b,D=null,k=!1){return{type:1,element:i,keyframes:e,preStyleProps:s,postStyleProps:n,duration:d,delay:b,totalTime:d+b,easing:D,subTimeline:k}}class U0{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,s){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...s)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const zM=new RegExp(":enter","g"),UM=new RegExp(":leave","g");function qx(i,e,s,n,d,b=new Map,D=new Map,k,H,W=[]){return(new rC).buildKeyframes(i,e,s,n,d,b,D,k,H,W)}class rC{buildKeyframes(e,s,n,d,b,D,k,H,W,fe=[]){W=W||new U0;const we=new Yx(e,s,W,d,b,fe,[]);we.options=H;const ft=H.delay?zd(H.delay):0;we.currentTimeline.delayNextStep(ft),we.currentTimeline.setStyles([D],null,we.errors,H),Ua(this,n,we);const Je=we.timelines.filter(ht=>ht.containsAnimation());if(Je.length&&k.size){let ht;for(let qt=Je.length-1;qt>=0;qt--){const sn=Je[qt];if(sn.element===s){ht=sn;break}}ht&&!ht.allowOnlyTimelineStyles()&&ht.setStyles([k],null,we.errors,H)}return Je.length?Je.map(ht=>ht.buildKeyframes()):[Wx(s,[],[],[],0,ft,"",!1)]}visitTrigger(e,s){}visitState(e,s){}visitTransition(e,s){}visitAnimateChild(e,s){const n=s.subInstructions.get(s.element);if(n){const d=s.createSubContext(e.options),b=s.currentTimeline.currentTime,D=this._visitSubInstructions(n,d,d.options);b!=D&&s.transformIntoNewTimeline(D)}s.previousNode=e}visitAnimateRef(e,s){const n=s.createSubContext(e.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],s,n),this.visitReference(e.animation,n),s.transformIntoNewTimeline(n.currentTimeline.currentTime),s.previousNode=e}_applyAnimationRefDelays(e,s,n){for(const d of e){const b=d?.delay;if(b){const D="number"==typeof b?b:zd(B0(b,d?.params??{},s.errors));n.delayNextStep(D)}}}_visitSubInstructions(e,s,n){let b=s.currentTimeline.currentTime;const D=null!=n.duration?zd(n.duration):null,k=null!=n.delay?zd(n.delay):null;return 0!==D&&e.forEach(H=>{const W=s.appendInstructionToTimeline(H,D,k);b=Math.max(b,W.duration+W.delay)}),b}visitReference(e,s){s.updateOptions(e.options,!0),Ua(this,e.animation,s),s.previousNode=e}visitSequence(e,s){const n=s.subContextCount;let d=s;const b=e.options;if(b&&(b.params||b.delay)&&(d=s.createSubContext(b),d.transformIntoNewTimeline(),null!=b.delay)){6==d.previousNode.type&&(d.currentTimeline.snapshotCurrentStyles(),d.previousNode=My);const D=zd(b.delay);d.delayNextStep(D)}e.steps.length&&(e.steps.forEach(D=>Ua(this,D,d)),d.currentTimeline.applyStylesToKeyframe(),d.subContextCount>n&&d.transformIntoNewTimeline()),s.previousNode=e}visitGroup(e,s){const n=[];let d=s.currentTimeline.currentTime;const b=e.options&&e.options.delay?zd(e.options.delay):0;e.steps.forEach(D=>{const k=s.createSubContext(e.options);b&&k.delayNextStep(b),Ua(this,D,k),d=Math.max(d,k.currentTimeline.currentTime),n.push(k.currentTimeline)}),n.forEach(D=>s.currentTimeline.mergeTimelineCollectedStyles(D)),s.transformIntoNewTimeline(d),s.previousNode=e}_visitTiming(e,s){if(e.dynamic){const n=e.strValue;return Ux(s.params?B0(n,s.params,s.errors):n,s.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,s){const n=s.currentAnimateTimings=this._visitTiming(e.timings,s),d=s.currentTimeline;n.delay&&(s.incrementTime(n.delay),d.snapshotCurrentStyles());const b=e.style;5==b.type?this.visitKeyframes(b,s):(s.incrementTime(n.duration),this.visitStyle(b,s),d.applyStylesToKeyframe()),s.currentAnimateTimings=null,s.previousNode=e}visitStyle(e,s){const n=s.currentTimeline,d=s.currentAnimateTimings;!d&&n.hasCurrentStyleProperties()&&n.forwardFrame();const b=d&&d.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(b):n.setStyles(e.styles,b,s.errors,s.options),s.previousNode=e}visitKeyframes(e,s){const n=s.currentAnimateTimings,d=s.currentTimeline.duration,b=n.duration,k=s.createSubContext().currentTimeline;k.easing=n.easing,e.styles.forEach(H=>{k.forwardTime((H.offset||0)*b),k.setStyles(H.styles,H.easing,s.errors,s.options),k.applyStylesToKeyframe()}),s.currentTimeline.mergeTimelineCollectedStyles(k),s.transformIntoNewTimeline(d+b),s.previousNode=e}visitQuery(e,s){const n=s.currentTimeline.currentTime,d=e.options||{},b=d.delay?zd(d.delay):0;b&&(6===s.previousNode.type||0==n&&s.currentTimeline.hasCurrentStyleProperties())&&(s.currentTimeline.snapshotCurrentStyles(),s.previousNode=My);let D=n;const k=s.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!d.optional,s.errors);s.currentQueryTotal=k.length;let H=null;k.forEach((W,fe)=>{s.currentQueryIndex=fe;const we=s.createSubContext(e.options,W);b&&we.delayNextStep(b),W===s.element&&(H=we.currentTimeline),Ua(this,e.animation,we),we.currentTimeline.applyStylesToKeyframe(),D=Math.max(D,we.currentTimeline.currentTime)}),s.currentQueryIndex=0,s.currentQueryTotal=0,s.transformIntoNewTimeline(D),H&&(s.currentTimeline.mergeTimelineCollectedStyles(H),s.currentTimeline.snapshotCurrentStyles()),s.previousNode=e}visitStagger(e,s){const n=s.parentContext,d=s.currentTimeline,b=e.timings,D=Math.abs(b.duration),k=D*(s.currentQueryTotal-1);let H=D*s.currentQueryIndex;switch(b.duration<0?"reverse":b.easing){case"reverse":H=k-H;break;case"full":H=n.currentStaggerTime}const fe=s.currentTimeline;H&&fe.delayNextStep(H);const we=fe.currentTime;Ua(this,e.animation,s),s.previousNode=e,n.currentStaggerTime=d.currentTime-we+(d.startTime-n.currentTimeline.startTime)}}const My={};class Yx{constructor(e,s,n,d,b,D,k,H){this._driver=e,this.element=s,this.subInstructions=n,this._enterClassName=d,this._leaveClassName=b,this.errors=D,this.timelines=k,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=My,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=H||new Dy(this._driver,s,0),k.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,s){if(!e)return;const n=e;let d=this.options;null!=n.duration&&(d.duration=zd(n.duration)),null!=n.delay&&(d.delay=zd(n.delay));const b=n.params;if(b){let D=d.params;D||(D=this.options.params={}),Object.keys(b).forEach(k=>{(!s||!D.hasOwnProperty(k))&&(D[k]=B0(b[k],D,this.errors))})}}_copyOptions(){const e={};if(this.options){const s=this.options.params;if(s){const n=e.params={};Object.keys(s).forEach(d=>{n[d]=s[d]})}}return e}createSubContext(e=null,s,n){const d=s||this.element,b=new Yx(this._driver,d,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(d,n||0));return b.previousNode=this.previousNode,b.currentAnimateTimings=this.currentAnimateTimings,b.options=this._copyOptions(),b.updateOptions(e),b.currentQueryIndex=this.currentQueryIndex,b.currentQueryTotal=this.currentQueryTotal,b.parentContext=this,this.subContextCount++,b}transformIntoNewTimeline(e){return this.previousNode=My,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,s,n){const d={duration:s??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},b=new oC(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,d,e.stretchStartingKeyframe);return this.timelines.push(b),d}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,s,n,d,b,D){let k=[];if(d&&k.push(this.element),e.length>0){e=(e=e.replace(zM,"."+this._enterClassName)).replace(UM,"."+this._leaveClassName);let W=this._driver.query(this.element,e,1!=n);0!==n&&(W=n<0?W.slice(W.length+n,W.length):W.slice(0,n)),k.push(...W)}return!b&&0==k.length&&D.push(function fM(i){return new E.vHH(3014,!1)}()),k}}class Dy{constructor(e,s,n,d){this._driver=e,this.element=s,this.startTime=n,this._elementTimelineStylesLookup=d,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(s),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(s,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const s=1===this._keyframes.size&&this._pendingStyles.size;this.duration||s?(this.forwardTime(this.currentTime+e),s&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,s){return this.applyStylesToKeyframe(),new Dy(this._driver,e,s||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,s){this._localTimelineStyles.set(e,s),this._globalTimelineStyles.set(e,s),this._styleSummary.set(e,{time:this.currentTime,value:s})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[s,n]of this._globalTimelineStyles)this._backFill.set(s,n||Cu),this._currentKeyframe.set(s,Cu);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,s,n,d){s&&this._previousKeyframe.set("easing",s);const b=d&&d.params||{},D=function $M(i,e){const s=new Map;let n;return i.forEach(d=>{if("*"===d){n=n||e.keys();for(let b of n)s.set(b,Cu)}else Vp(d,s)}),s}(e,this._globalTimelineStyles);for(let[k,H]of D){const W=B0(H,b,n);this._pendingStyles.set(k,W),this._localTimelineStyles.has(k)||this._backFill.set(k,this._globalTimelineStyles.get(k)??Cu),this._updateStyle(k,W)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,s)=>{this._currentKeyframe.set(s,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,s)=>{this._currentKeyframe.has(s)||this._currentKeyframe.set(s,e)}))}snapshotCurrentStyles(){for(let[e,s]of this._localTimelineStyles)this._pendingStyles.set(e,s),this._updateStyle(e,s)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let s in this._currentKeyframe)e.push(s);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((s,n)=>{const d=this._styleSummary.get(n);(!d||s.time>d.time)&&this._updateStyle(n,s.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,s=new Set,n=1===this._keyframes.size&&0===this.duration;let d=[];this._keyframes.forEach((k,H)=>{const W=Vp(k,new Map,this._backFill);W.forEach((fe,we)=>{"!"===fe?e.add(we):fe===Cu&&s.add(we)}),n||W.set("offset",H/this.duration),d.push(W)});const b=e.size?jx(e.values()):[],D=s.size?jx(s.values()):[];if(n){const k=d[0],H=new Map(k);k.set("offset",0),H.set("offset",1),d=[k,H]}return Wx(this.element,d,b,D,this.duration,this.startTime,this.easing,!1)}}class oC extends Dy{constructor(e,s,n,d,b,D,k=!1){super(e,s,D.delay),this.keyframes=n,this.preStyleProps=d,this.postStyleProps=b,this._stretchStartingKeyframe=k,this.timings={duration:D.duration,delay:D.delay,easing:D.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:s,duration:n,easing:d}=this.timings;if(this._stretchStartingKeyframe&&s){const b=[],D=n+s,k=s/D,H=Vp(e[0]);H.set("offset",0),b.push(H);const W=Vp(e[0]);W.set("offset",jM(k)),b.push(W);const fe=e.length-1;for(let we=1;we<=fe;we++){let ft=Vp(e[we]);const Je=ft.get("offset");ft.set("offset",jM((s+Je*n)/D)),b.push(ft)}n=D,s=0,d="",e=b}return Wx(this.element,e,this.preStyleProps,this.postStyleProps,n,s,d,!0)}}function jM(i,e=3){const s=Math.pow(10,e-1);return Math.round(i*s)/s}class j0{}const GM=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class $0 extends j0{normalizePropertyName(e,s){return $x(e)}normalizeStyleValue(e,s,n,d){let b="";const D=n.toString().trim();if(GM.has(s)&&0!==n&&"0"!==n)if("number"==typeof n)b="px";else{const k=n.match(/^[+-]?[\d\.]+([a-z]*)$/);k&&0==k[1].length&&d.push(function oM(i,e){return new E.vHH(3005,!1)}())}return D+b}}function aC(i,e,s,n,d,b,D,k,H,W,fe,we,ft){return{type:0,element:i,triggerName:e,isRemovalTransition:d,fromState:s,fromStyles:b,toState:n,toStyles:D,timelines:k,queriedElements:H,preStyleProps:W,postStyleProps:fe,totalTime:we,errors:ft}}const Xx={};class Kx{constructor(e,s,n){this._triggerName=e,this.ast=s,this._stateStyles=n}match(e,s,n,d){return function oS(i,e,s,n,d){return i.some(b=>b(e,s,n,d))}(this.ast.matchers,e,s,n,d)}buildStyles(e,s,n){let d=this._stateStyles.get("*");return void 0!==e&&(d=this._stateStyles.get(e?.toString())||d),d?d.buildStyles(s,n):new Map}build(e,s,n,d,b,D,k,H,W,fe){const we=[],ft=this.ast.options&&this.ast.options.params||Xx,ht=this.buildStyles(n,k&&k.params||Xx,we),qt=H&&H.params||Xx,sn=this.buildStyles(d,qt,we),Dn=new Set,oi=new Map,_r=new Map,wi="void"===d,ys={params:WM(qt,ft),delay:this.ast.options?.delay},yl=fe?[]:qx(e,s,this.ast.animation,b,D,ht,sn,ys,W,we);let bo=0;if(yl.forEach(ku=>{bo=Math.max(ku.duration+ku.delay,bo)}),we.length)return aC(s,this._triggerName,n,d,wi,ht,sn,[],[],oi,_r,bo,we);yl.forEach(ku=>{const $p=ku.element,tI=ba(oi,$p,new Set);ku.preStyleProps.forEach(Oy=>tI.add(Oy));const ow=ba(_r,$p,new Set);ku.postStyleProps.forEach(Oy=>ow.add(Oy)),$p!==s&&Dn.add($p)});const $a=jx(Dn.values());return aC(s,this._triggerName,n,d,wi,ht,sn,yl,$a,oi,_r,bo)}}function WM(i,e){const s=wy(e);for(const n in i)i.hasOwnProperty(n)&&null!=i[n]&&(s[n]=i[n]);return s}class sS{constructor(e,s,n){this.styles=e,this.defaultParams=s,this.normalizer=n}buildStyles(e,s){const n=new Map,d=wy(this.defaultParams);return Object.keys(e).forEach(b=>{const D=e[b];null!==D&&(d[b]=D)}),this.styles.styles.forEach(b=>{"string"!=typeof b&&b.forEach((D,k)=>{D&&(D=B0(D,d,s));const H=this.normalizer.normalizePropertyName(k,s);D=this.normalizer.normalizeStyleValue(k,H,D,s),n.set(k,D)})}),n}}class aS{constructor(e,s,n){this.name=e,this.ast=s,this._normalizer=n,this.transitionFactories=[],this.states=new Map,s.states.forEach(d=>{this.states.set(d.name,new sS(d.style,d.options&&d.options.params||{},n))}),lC(this.states,"true","1"),lC(this.states,"false","0"),s.transitions.forEach(d=>{this.transitionFactories.push(new Kx(e,d,this.states))}),this.fallbackTransition=function lS(i,e,s){return new Kx(i,{type:1,animation:{type:2,steps:[],options:null},matchers:[(D,k)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,s,n,d){return this.transitionFactories.find(D=>D.match(e,s,n,d))||null}matchStyles(e,s,n){return this.fallbackTransition.buildStyles(e,s,n)}}function lC(i,e,s){i.has(e)?i.has(s)||i.set(s,i.get(e)):i.has(s)&&i.set(e,i.get(s))}const YM=new U0;class cS{constructor(e,s,n){this.bodyNode=e,this._driver=s,this._normalizer=n,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,s){const n=[],b=V0(this._driver,s,n,[]);if(n.length)throw function BE(i){return new E.vHH(3503,!1)}();this._animations.set(e,b)}_buildPlayer(e,s,n){const d=e.element,b=R0(this._normalizer,e.keyframes,s,n);return this._driver.animate(d,b,e.duration,e.delay,e.easing,[],!0)}create(e,s,n={}){const d=[],b=this._animations.get(e);let D;const k=new Map;if(b?(D=qx(this._driver,s,b,L0,xy,new Map,new Map,n,YM,d),D.forEach(fe=>{const we=ba(k,fe.element,new Map);fe.postStyleProps.forEach(ft=>we.set(ft,null))})):(d.push(function Lx(){return new E.vHH(3300,!1)}()),D=[]),d.length)throw function bM(i){return new E.vHH(3504,!1)}();k.forEach((fe,we)=>{fe.forEach((ft,Je)=>{fe.set(Je,this._driver.computeStyle(we,Je,Cu))})});const W=sf(D.map(fe=>{const we=k.get(fe.element);return this._buildPlayer(fe,new Map,we)}));return this._playersById.set(e,W),W.onDestroy(()=>this.destroy(e)),this.players.push(W),W}destroy(e){const s=this._getPlayer(e);s.destroy(),this._playersById.delete(e);const n=this.players.indexOf(s);n>=0&&this.players.splice(n,1)}_getPlayer(e){const s=this._playersById.get(e);if(!s)throw function xM(i){return new E.vHH(3301,!1)}();return s}listen(e,s,n,d){const b=vy(s,"","","");return Pu(this._getPlayer(e),n,b,d),()=>{}}command(e,s,n,d){if("register"==n)return void this.register(e,d[0]);if("create"==n)return void this.create(e,s,d[0]||{});const b=this._getPlayer(e);switch(n){case"play":b.play();break;case"pause":b.pause();break;case"reset":b.reset();break;case"restart":b.restart();break;case"finish":b.finish();break;case"init":b.init();break;case"setPosition":b.setPosition(parseFloat(d[0]));break;case"destroy":this.destroy(e)}}}const XM="ng-animate-queued",cC="ng-animate-disabled",fS=[],JM={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},pS={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Ou="__ng_removed";class Jx{get params(){return this.options.params}constructor(e,s=""){this.namespaceId=s;const n=e&&e.hasOwnProperty("value");if(this.value=function M(i){return i??null}(n?e.value:e),n){const b=wy(e);delete b.value,this.options=b}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){const s=e.params;if(s){const n=this.options.params;Object.keys(s).forEach(d=>{null==n[d]&&(n[d]=s[d])})}}}const H0="void",r=new Jx(H0);class c{constructor(e,s,n){this.id=e,this.hostElement=s,this._engine=n,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,me(s,this._hostClassName)}listen(e,s,n,d){if(!this._triggers.has(s))throw function zE(i,e){return new E.vHH(3302,!1)}();if(null==n||0==n.length)throw function VE(i){return new E.vHH(3303,!1)}();if(!function L(i){return"start"==i||"done"==i}(n))throw function WD(i,e){return new E.vHH(3400,!1)}();const b=ba(this._elementListeners,e,[]),D={name:s,phase:n,callback:d};b.push(D);const k=ba(this._engine.statesByElement,e,new Map);return k.has(s)||(me(e,Bd),me(e,Bd+"-"+s),k.set(s,r)),()=>{this._engine.afterFlush(()=>{const H=b.indexOf(D);H>=0&&b.splice(H,1),this._triggers.has(s)||k.delete(s)})}}register(e,s){return!this._triggers.has(e)&&(this._triggers.set(e,s),!0)}_getTrigger(e){const s=this._triggers.get(e);if(!s)throw function Va(i){return new E.vHH(3401,!1)}();return s}trigger(e,s,n,d=!0){const b=this._getTrigger(s),D=new g(this.id,s,e);let k=this._engine.statesByElement.get(e);k||(me(e,Bd),me(e,Bd+"-"+s),this._engine.statesByElement.set(e,k=new Map));let H=k.get(s);const W=new Jx(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&H&&W.absorbOptions(H.options),k.set(s,W),H||(H=r),W.value!==H0&&H.value===W.value){if(!function pn(i,e){const s=Object.keys(i),n=Object.keys(e);if(s.length!=n.length)return!1;for(let d=0;d<s.length;d++){const b=s[d];if(!e.hasOwnProperty(b)||i[b]!==e[b])return!1}return!0}(H.params,W.params)){const qt=[],sn=b.matchStyles(H.value,H.params,qt),Dn=b.matchStyles(W.value,W.params,qt);qt.length?this._engine.reportError(qt):this._engine.afterFlush(()=>{Up(e,sn),Pc(e,Dn)})}return}const ft=ba(this._engine.playersByElement,e,[]);ft.forEach(qt=>{qt.namespaceId==this.id&&qt.triggerName==s&&qt.queued&&qt.destroy()});let Je=b.matchTransition(H.value,W.value,e,W.params),ht=!1;if(!Je){if(!d)return;Je=b.fallbackTransition,ht=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:s,transition:Je,fromState:H,toState:W,player:D,isFallbackTransition:ht}),ht||(me(e,XM),D.onStart(()=>{Fe(e,XM)})),D.onDone(()=>{let qt=this.players.indexOf(D);qt>=0&&this.players.splice(qt,1);const sn=this._engine.playersByElement.get(e);if(sn){let Dn=sn.indexOf(D);Dn>=0&&sn.splice(Dn,1)}}),this.players.push(D),ft.push(D),D}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(s=>s.delete(e)),this._elementListeners.forEach((s,n)=>{this._elementListeners.set(n,s.filter(d=>d.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const s=this._engine.playersByElement.get(e);s&&(s.forEach(n=>n.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,s){const n=this._engine.driver.query(e,zp,!0);n.forEach(d=>{if(d[Ou])return;const b=this._engine.fetchNamespacesByElement(d);b.size?b.forEach(D=>D.triggerLeaveAnimation(d,s,!1,!0)):this.clearElementCache(d)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(d=>this.clearElementCache(d)))}triggerLeaveAnimation(e,s,n,d){const b=this._engine.statesByElement.get(e),D=new Map;if(b){const k=[];if(b.forEach((H,W)=>{if(D.set(W,H.value),this._triggers.has(W)){const fe=this.trigger(e,W,H0,d);fe&&k.push(fe)}}),k.length)return this._engine.markElementAsRemoved(this.id,e,!0,s,D),n&&sf(k).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const s=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(s&&n){const d=new Set;s.forEach(b=>{const D=b.name;if(d.has(D))return;d.add(D);const H=this._triggers.get(D).fallbackTransition,W=n.get(D)||r,fe=new Jx(H0),we=new g(this.id,D,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:D,transition:H,fromState:W,toState:fe,player:we,isFallbackTransition:!0})})}}removeNode(e,s){const n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,s),this.triggerLeaveAnimation(e,s,!0))return;let d=!1;if(n.totalAnimations){const b=n.players.length?n.playersByQueriedElement.get(e):[];if(b&&b.length)d=!0;else{let D=e;for(;D=D.parentNode;)if(n.statesByElement.get(D)){d=!0;break}}}if(this.prepareLeaveAnimationListeners(e),d)n.markElementAsRemoved(this.id,e,!1,s);else{const b=e[Ou];(!b||b===JM)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,s))}}insertNode(e,s){me(e,this._hostClassName)}drainQueuedTransitions(e){const s=[];return this._queue.forEach(n=>{const d=n.player;if(d.destroyed)return;const b=n.element,D=this._elementListeners.get(b);D&&D.forEach(k=>{if(k.name==n.triggerName){const H=vy(b,n.triggerName,n.fromState.value,n.toState.value);H._data=e,Pu(n.player,k.phase,H,k.callback)}}),d.markedForDestroy?this._engine.afterFlush(()=>{d.destroy()}):s.push(n)}),this._queue=[],s.sort((n,d)=>{const b=n.transition.ast.depCount,D=d.transition.ast.depCount;return 0==b||0==D?b-D:this._engine.driver.containsElement(n.element,d.element)?1:-1})}destroy(e){this.players.forEach(s=>s.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}}class h{_onRemovalComplete(e,s){this.onRemovalComplete(e,s)}constructor(e,s,n){this.bodyNode=e,this.driver=s,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(d,b)=>{}}get queuedPlayers(){const e=[];return this._namespaceList.forEach(s=>{s.players.forEach(n=>{n.queued&&e.push(n)})}),e}createNamespace(e,s){const n=new c(e,s,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,s)?this._balanceNamespaceList(n,s):(this.newHostElements.set(s,n),this.collectEnterElement(s)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,s){const n=this._namespaceList,d=this.namespacesByHostElement;if(n.length-1>=0){let D=!1,k=this.driver.getParentElement(s);for(;k;){const H=d.get(k);if(H){const W=n.indexOf(H);n.splice(W+1,0,e),D=!0;break}k=this.driver.getParentElement(k)}D||n.unshift(e)}else n.push(e);return d.set(s,e),e}register(e,s){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,s)),n}registerTrigger(e,s,n){let d=this._namespaceLookup[e];d&&d.register(s,n)&&this.totalAnimations++}destroy(e,s){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const n=this._fetchNamespace(e);this.namespacesByHostElement.delete(n.hostElement);const d=this._namespaceList.indexOf(n);d>=0&&this._namespaceList.splice(d,1),n.destroy(s),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const s=new Set,n=this.statesByElement.get(e);if(n)for(let d of n.values())if(d.namespaceId){const b=this._fetchNamespace(d.namespaceId);b&&s.add(b)}return s}trigger(e,s,n,d){if(O(s)){const b=this._fetchNamespace(e);if(b)return b.trigger(s,n,d),!0}return!1}insertNode(e,s,n,d){if(!O(s))return;const b=s[Ou];if(b&&b.setForRemoval){b.setForRemoval=!1,b.setForMove=!0;const D=this.collectedLeaveElements.indexOf(s);D>=0&&this.collectedLeaveElements.splice(D,1)}if(e){const D=this._fetchNamespace(e);D&&D.insertNode(s,n)}d&&this.collectEnterElement(s)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,s){s?this.disabledNodes.has(e)||(this.disabledNodes.add(e),me(e,cC)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Fe(e,cC))}removeNode(e,s,n){if(O(s)){const d=e?this._fetchNamespace(e):null;d?d.removeNode(s,n):this.markElementAsRemoved(e,s,!1,n);const b=this.namespacesByHostElement.get(s);b&&b.id!==e&&b.removeNode(s,n)}else this._onRemovalComplete(s,n)}markElementAsRemoved(e,s,n,d,b){this.collectedLeaveElements.push(s),s[Ou]={namespaceId:e,setForRemoval:d,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:b}}listen(e,s,n,d,b){return O(s)?this._fetchNamespace(e).listen(s,n,d,b):()=>{}}_buildInstruction(e,s,n,d,b){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,d,e.fromState.options,e.toState.options,s,b)}destroyInnerAnimations(e){let s=this.driver.query(e,zp,!0);s.forEach(n=>this.destroyActiveAnimationsForElement(n)),0!=this.playersByQueriedElement.size&&(s=this.driver.query(e,N0,!0),s.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(e){const s=this.playersByElement.get(e);s&&s.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(e){const s=this.playersByQueriedElement.get(e);s&&s.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return sf(this.players).onDone(()=>e());e()})}processLeaveNode(e){const s=e[Ou];if(s&&s.setForRemoval){if(e[Ou]=JM,s.namespaceId){this.destroyInnerAnimations(e);const n=this._fetchNamespace(s.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,s.setForRemoval)}e.classList?.contains(cC)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(e=-1){let s=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,d)=>this._balanceNamespaceList(n,d)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++)me(this.collectedEnterElements[n],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const n=[];try{s=this._flushAnimations(n,e)}finally{for(let d=0;d<n.length;d++)n[d]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++)this.processLeaveNode(this.collectedLeaveElements[n]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){const n=this._whenQuietFns;this._whenQuietFns=[],s.length?sf(s).onDone(()=>{n.forEach(d=>d())}):n.forEach(d=>d())}}reportError(e){throw function UE(i){return new E.vHH(3402,!1)}()}_flushAnimations(e,s){const n=new U0,d=[],b=new Map,D=[],k=new Map,H=new Map,W=new Map,fe=new Set;this.disabledNodes.forEach(Fn=>{fe.add(Fn);const ni=this.driver.query(Fn,".ng-animate-queued",!0);for(let fi=0;fi<ni.length;fi++)fe.add(ni[fi])});const we=this.bodyNode,ft=Array.from(this.statesByElement.keys()),Je=te(ft,this.collectedEnterElements),ht=new Map;let qt=0;Je.forEach((Fn,ni)=>{const fi=L0+qt++;ht.set(ni,fi),Fn.forEach(lr=>me(lr,fi))});const sn=[],Dn=new Set,oi=new Set;for(let Fn=0;Fn<this.collectedLeaveElements.length;Fn++){const ni=this.collectedLeaveElements[Fn],fi=ni[Ou];fi&&fi.setForRemoval&&(sn.push(ni),Dn.add(ni),fi.hasAnimation?this.driver.query(ni,".ng-star-inserted",!0).forEach(lr=>Dn.add(lr)):oi.add(ni))}const _r=new Map,wi=te(ft,Array.from(Dn));wi.forEach((Fn,ni)=>{const fi=xy+qt++;_r.set(ni,fi),Fn.forEach(lr=>me(lr,fi))}),e.push(()=>{Je.forEach((Fn,ni)=>{const fi=ht.get(ni);Fn.forEach(lr=>Fe(lr,fi))}),wi.forEach((Fn,ni)=>{const fi=_r.get(ni);Fn.forEach(lr=>Fe(lr,fi))}),sn.forEach(Fn=>{this.processLeaveNode(Fn)})});const ys=[],yl=[];for(let Fn=this._namespaceList.length-1;Fn>=0;Fn--)this._namespaceList[Fn].drainQueuedTransitions(s).forEach(fi=>{const lr=fi.player,na=fi.element;if(ys.push(lr),this.collectedEnterElements.length){const Ha=na[Ou];if(Ha&&Ha.setForMove){if(Ha.previousTriggersValues&&Ha.previousTriggersValues.has(fi.triggerName)){const Ry=Ha.previousTriggersValues.get(fi.triggerName),Fu=this.statesByElement.get(fi.element);if(Fu&&Fu.has(fi.triggerName)){const gC=Fu.get(fi.triggerName);gC.value=Ry,Fu.set(fi.triggerName,gC)}}return void lr.destroy()}}const cf=!we||!this.driver.containsElement(we,na),Oc=_r.get(na),Ag=ht.get(na),xo=this._buildInstruction(fi,n,Ag,Oc,cf);if(xo.errors&&xo.errors.length)return void yl.push(xo);if(cf)return lr.onStart(()=>Up(na,xo.fromStyles)),lr.onDestroy(()=>Pc(na,xo.toStyles)),void d.push(lr);if(fi.isFallbackTransition)return lr.onStart(()=>Up(na,xo.fromStyles)),lr.onDestroy(()=>Pc(na,xo.toStyles)),void d.push(lr);const rI=[];xo.timelines.forEach(Ha=>{Ha.stretchStartingKeyframe=!0,this.disabledNodes.has(Ha.element)||rI.push(Ha)}),xo.timelines=rI,n.append(na,xo.timelines),D.push({instruction:xo,player:lr,element:na}),xo.queriedElements.forEach(Ha=>ba(k,Ha,[]).push(lr)),xo.preStyleProps.forEach((Ha,Ry)=>{if(Ha.size){let Fu=H.get(Ry);Fu||H.set(Ry,Fu=new Set),Ha.forEach((gC,pD)=>Fu.add(pD))}}),xo.postStyleProps.forEach((Ha,Ry)=>{let Fu=W.get(Ry);Fu||W.set(Ry,Fu=new Set),Ha.forEach((gC,pD)=>Fu.add(pD))})});if(yl.length){const Fn=[];yl.forEach(ni=>{Fn.push(function EM(i,e){return new E.vHH(3505,!1)}())}),ys.forEach(ni=>ni.destroy()),this.reportError(Fn)}const bo=new Map,$a=new Map;D.forEach(Fn=>{const ni=Fn.element;n.has(ni)&&($a.set(ni,ni),this._beforeAnimationBuild(Fn.player.namespaceId,Fn.instruction,bo))}),d.forEach(Fn=>{const ni=Fn.element;this._getPreviousPlayers(ni,!1,Fn.namespaceId,Fn.triggerName,null).forEach(lr=>{ba(bo,ni,[]).push(lr),lr.destroy()})});const ku=sn.filter(Fn=>kn(Fn,H,W)),$p=new Map;Y($p,this.driver,oi,W,Cu).forEach(Fn=>{kn(Fn,H,W)&&ku.push(Fn)});const ow=new Map;Je.forEach((Fn,ni)=>{Y(ow,this.driver,new Set(Fn),H,"!")}),ku.forEach(Fn=>{const ni=$p.get(Fn),fi=ow.get(Fn);$p.set(Fn,new Map([...ni?.entries()??[],...fi?.entries()??[]]))});const Oy=[],nI=[],iI={};D.forEach(Fn=>{const{element:ni,player:fi,instruction:lr}=Fn;if(n.has(ni)){if(fe.has(ni))return fi.onDestroy(()=>Pc(ni,lr.toStyles)),fi.disabled=!0,fi.overrideTotalTime(lr.totalTime),void d.push(fi);let na=iI;if($a.size>1){let Oc=ni;const Ag=[];for(;Oc=Oc.parentNode;){const xo=$a.get(Oc);if(xo){na=xo;break}Ag.push(Oc)}Ag.forEach(xo=>$a.set(xo,na))}const cf=this._buildAnimation(fi.namespaceId,lr,bo,b,ow,$p);if(fi.setRealPlayer(cf),na===iI)Oy.push(fi);else{const Oc=this.playersByElement.get(na);Oc&&Oc.length&&(fi.parentPlayer=sf(Oc)),d.push(fi)}}else Up(ni,lr.fromStyles),fi.onDestroy(()=>Pc(ni,lr.toStyles)),nI.push(fi),fe.has(ni)&&d.push(fi)}),nI.forEach(Fn=>{const ni=b.get(Fn.element);if(ni&&ni.length){const fi=sf(ni);Fn.setRealPlayer(fi)}}),d.forEach(Fn=>{Fn.parentPlayer?Fn.syncPlayerEvents(Fn.parentPlayer):Fn.destroy()});for(let Fn=0;Fn<sn.length;Fn++){const ni=sn[Fn],fi=ni[Ou];if(Fe(ni,xy),fi&&fi.hasAnimation)continue;let lr=[];if(k.size){let cf=k.get(ni);cf&&cf.length&&lr.push(...cf);let Oc=this.driver.query(ni,N0,!0);for(let Ag=0;Ag<Oc.length;Ag++){let xo=k.get(Oc[Ag]);xo&&xo.length&&lr.push(...xo)}}const na=lr.filter(cf=>!cf.destroyed);na.length?qe(this,ni,na):this.processLeaveNode(ni)}return sn.length=0,Oy.forEach(Fn=>{this.players.push(Fn),Fn.onDone(()=>{Fn.destroy();const ni=this.players.indexOf(Fn);this.players.splice(ni,1)}),Fn.play()}),Oy}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,s,n,d,b){let D=[];if(s){const k=this.playersByQueriedElement.get(e);k&&(D=k)}else{const k=this.playersByElement.get(e);if(k){const H=!b||b==H0;k.forEach(W=>{W.queued||!H&&W.triggerName!=d||D.push(W)})}}return(n||d)&&(D=D.filter(k=>!(n&&n!=k.namespaceId||d&&d!=k.triggerName))),D}_beforeAnimationBuild(e,s,n){const b=s.element,D=s.isRemovalTransition?void 0:e,k=s.isRemovalTransition?void 0:s.triggerName;for(const H of s.timelines){const W=H.element,fe=W!==b,we=ba(n,W,[]);this._getPreviousPlayers(W,fe,D,k,s.toState).forEach(Je=>{const ht=Je.getRealPlayer();ht.beforeDestroy&&ht.beforeDestroy(),Je.destroy(),we.push(Je)})}Up(b,s.fromStyles)}_buildAnimation(e,s,n,d,b,D){const k=s.triggerName,H=s.element,W=[],fe=new Set,we=new Set,ft=s.timelines.map(ht=>{const qt=ht.element;fe.add(qt);const sn=qt[Ou];if(sn&&sn.removedBeforeQueried)return new Mp(ht.duration,ht.delay);const Dn=qt!==H,oi=function St(i){const e=[];return Xt(i,e),e}((n.get(qt)||fS).map(bo=>bo.getRealPlayer())).filter(bo=>!!bo.element&&bo.element===qt),_r=b.get(qt),wi=D.get(qt),ys=R0(this._normalizer,ht.keyframes,_r,wi),yl=this._buildPlayer(ht,ys,oi);if(ht.subTimeline&&d&&we.add(qt),Dn){const bo=new g(e,k,qt);bo.setRealPlayer(yl),W.push(bo)}return yl});W.forEach(ht=>{ba(this.playersByQueriedElement,ht.element,[]).push(ht),ht.onDone(()=>function x(i,e,s){let n=i.get(e);if(n){if(n.length){const d=n.indexOf(s);n.splice(d,1)}0==n.length&&i.delete(e)}return n}(this.playersByQueriedElement,ht.element,ht))}),fe.forEach(ht=>me(ht,zx));const Je=sf(ft);return Je.onDestroy(()=>{fe.forEach(ht=>Fe(ht,zx)),Pc(H,s.toStyles)}),we.forEach(ht=>{ba(d,ht,[]).push(Je)}),Je}_buildPlayer(e,s,n){return s.length>0?this.driver.animate(e.element,s,e.duration,e.delay,e.easing,n):new Mp(e.duration,e.delay)}}class g{constructor(e,s,n){this.namespaceId=e,this.triggerName=s,this.element=n,this._player=new Mp,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((s,n)=>{s.forEach(d=>Pu(e,n,void 0,d))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const s=this._player;s.triggerCallback&&e.onStart(()=>s.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,s){ba(this._queuedCallbacks,e,[]).push(s)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const s=this._player;s.triggerCallback&&s.triggerCallback(e)}}function O(i){return i&&1===i.nodeType}function V(i,e){const s=i.style.display;return i.style.display=e??"none",s}function Y(i,e,s,n,d){const b=[];s.forEach(H=>b.push(V(H)));const D=[];n.forEach((H,W)=>{const fe=new Map;H.forEach(we=>{const ft=e.computeStyle(W,we,d);fe.set(we,ft),(!ft||0==ft.length)&&(W[Ou]=pS,D.push(W))}),i.set(W,fe)});let k=0;return s.forEach(H=>V(H,b[k++])),D}function te(i,e){const s=new Map;if(i.forEach(k=>s.set(k,[])),0==e.length)return s;const d=new Set(e),b=new Map;function D(k){if(!k)return 1;let H=b.get(k);if(H)return H;const W=k.parentNode;return H=s.has(W)?W:d.has(W)?1:D(W),b.set(k,H),H}return e.forEach(k=>{const H=D(k);1!==H&&s.get(H).push(k)}),s}function me(i,e){i.classList?.add(e)}function Fe(i,e){i.classList?.remove(e)}function qe(i,e,s){sf(s).onDone(()=>i.processLeaveNode(e))}function Xt(i,e){for(let s=0;s<i.length;s++){const n=i[s];n instanceof IC?Xt(n.players,e):e.push(n)}}function kn(i,e,s){const n=s.get(i);if(!n)return!1;let d=e.get(i);return d?n.forEach(b=>d.add(b)):e.set(i,n),s.delete(i),!0}class Vt{constructor(e,s,n){this.bodyNode=e,this._driver=s,this._normalizer=n,this._triggerCache={},this.onRemovalComplete=(d,b)=>{},this._transitionEngine=new h(e,s,n),this._timelineEngine=new cS(e,s,n),this._transitionEngine.onRemovalComplete=(d,b)=>this.onRemovalComplete(d,b)}registerTrigger(e,s,n,d,b){const D=e+"-"+d;let k=this._triggerCache[D];if(!k){const H=[],fe=V0(this._driver,b,H,[]);if(H.length)throw function yM(i,e){return new E.vHH(3404,!1)}();k=function qM(i,e,s){return new aS(i,e,s)}(d,fe,this._normalizer),this._triggerCache[D]=k}this._transitionEngine.registerTrigger(s,d,k)}register(e,s){this._transitionEngine.register(e,s)}destroy(e,s){this._transitionEngine.destroy(e,s)}onInsert(e,s,n,d){this._transitionEngine.insertNode(e,s,n,d)}onRemove(e,s,n){this._transitionEngine.removeNode(e,s,n)}disableAnimations(e,s){this._transitionEngine.markElementAsDisabled(e,s)}process(e,s,n,d){if("@"==n.charAt(0)){const[b,D]=$E(n);this._timelineEngine.command(b,s,D,d)}else this._transitionEngine.trigger(e,s,n,d)}listen(e,s,n,d,b){if("@"==n.charAt(0)){const[D,k]=$E(n);return this._timelineEngine.listen(D,s,k,b)}return this._transitionEngine.listen(e,s,n,d,b)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}}let Di=(()=>{class e{constructor(n,d,b){this._element=n,this._startStyles=d,this._endStyles=b,this._state=0;let D=e.initialStylesByElement.get(n);D||e.initialStylesByElement.set(n,D=new Map),this._initialStyles=D}start(){this._state<1&&(this._startStyles&&Pc(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Pc(this._element,this._initialStyles),this._endStyles&&(Pc(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(Up(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Up(this._element,this._endStyles),this._endStyles=null),Pc(this._element,this._initialStyles),this._state=3)}}return e.initialStylesByElement=new WeakMap,e})();function ar(i){let e=null;return i.forEach((s,n)=>{(function ja(i){return"display"===i||"position"===i})(n)&&(e=e||new Map,e.set(n,s))}),e}class Ru{constructor(e,s,n,d){this.element=e,this.keyframes=s,this.options=n,this._specialStyles=d,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){const s=[];return e.forEach(n=>{s.push(Object.fromEntries(n))}),s}_triggerWebAnimation(e,s,n){return e.animate(this._convertKeyframesToObject(s),n)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,d)=>{"offset"!==d&&e.set(d,this._finished?n:af(this.element,d))}),this.currentSnapshot=e}triggerCallback(e){const s="start"===e?this._onStartFns:this._onDoneFns;s.forEach(n=>n()),s.length=0}}class Ig{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,s){return!1}containsElement(e,s){return Nx(e,s)}getParentElement(e){return F0(e)}query(e,s,n){return GE(e,s,n)}computeStyle(e,s,n){return window.getComputedStyle(e)[s]}animate(e,s,n,d,b,D=[]){const H={duration:n,delay:d,fill:0==d?"both":"forwards"};b&&(H.easing=b);const W=new Map,fe=D.filter(Je=>Je instanceof Ru);(function RM(i,e){return 0===i||0===e})(n,d)&&fe.forEach(Je=>{Je.currentSnapshot.forEach((ht,qt)=>W.set(qt,ht))});let we=function XD(i){return i.length?i[0]instanceof Map?i:i.map(e=>qE(e)):[]}(s).map(Je=>Vp(Je));we=function kM(i,e,s){if(s.size&&e.length){let n=e[0],d=[];if(s.forEach((b,D)=>{n.has(D)||d.push(D),n.set(D,b)}),d.length)for(let b=1;b<e.length;b++){let D=e[b];d.forEach(k=>D.set(k,af(i,k)))}}return e}(e,we,W);const ft=function hi(i,e){let s=null,n=null;return Array.isArray(e)&&e.length?(s=ar(e[0]),e.length>1&&(n=ar(e[e.length-1]))):e instanceof Map&&(s=ar(e)),s||n?new Di(i,s,n):null}(e,we);return new Ru(e,we,H,ft)}}let Qx=(()=>{var i;class e extends Rb{constructor(n,d){super(),this._nextAnimationId=0,this._renderer=n.createRenderer(d.body,{id:"0",encapsulation:E.ifc.None,styles:[],data:{animation:[]}})}build(n){const d=this._nextAnimationId.toString();this._nextAnimationId++;const b=Array.isArray(n)?kb(n):n;return mS(this._renderer,null,d,"register",[b]),new QM(d,this._renderer)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(E.FYo),E.LFG(Ye))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();class QM extends Lw{constructor(e,s){super(),this._id=e,this._renderer=s}create(e,s){return new eD(this._id,e,s||{},this._renderer)}}class eD{constructor(e,s,n,d){this.id=e,this.element=s,this._renderer=d,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",n)}_listen(e,s){return this._renderer.listen(this.element,`@@${this.id}:${e}`,s)}_command(e,...s){return mS(this._renderer,this.element,this.id,e,s)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function mS(i,e,s,n,d){return i.setProperty(e,`@@${s}:${n}`,d)}const gS="@.disabled";let aI=(()=>{var i;class e{constructor(n,d,b){this.delegate=n,this.engine=d,this._zone=b,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,d.onRemovalComplete=(D,k)=>{const H=k?.parentNode(D);H&&k.removeChild(H,D)}}createRenderer(n,d){const D=this.delegate.createRenderer(n,d);if(!(n&&d&&d.data&&d.data.animation)){let we=this._rendererCache.get(D);return we||(we=new _S("",D,this.engine,()=>this._rendererCache.delete(D)),this._rendererCache.set(D,we)),we}const k=d.id,H=d.id+"-"+this._currentId;this._currentId++,this.engine.register(H,n);const W=we=>{Array.isArray(we)?we.forEach(W):this.engine.registerTrigger(k,H,n,we.name,we)};return d.data.animation.forEach(W),new lI(this,H,D,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(n,d,b){n>=0&&n<this._microtaskId?this._zone.run(()=>d(b)):(0==this._animationCallbacksBuffer.length&&queueMicrotask(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(D=>{const[k,H]=D;k(H)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([d,b]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(E.FYo),E.LFG(Vt),E.LFG(E.R0b))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})();class _S{constructor(e,s,n,d){this.namespaceId=e,this.delegate=s,this.engine=n,this._onDestroy=d}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,s){return this.delegate.createElement(e,s)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,s){this.delegate.appendChild(e,s),this.engine.onInsert(this.namespaceId,s,e,!1)}insertBefore(e,s,n,d=!0){this.delegate.insertBefore(e,s,n),this.engine.onInsert(this.namespaceId,s,e,d)}removeChild(e,s,n){this.engine.onRemove(this.namespaceId,s,this.delegate)}selectRootElement(e,s){return this.delegate.selectRootElement(e,s)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,s,n,d){this.delegate.setAttribute(e,s,n,d)}removeAttribute(e,s,n){this.delegate.removeAttribute(e,s,n)}addClass(e,s){this.delegate.addClass(e,s)}removeClass(e,s){this.delegate.removeClass(e,s)}setStyle(e,s,n,d){this.delegate.setStyle(e,s,n,d)}removeStyle(e,s,n){this.delegate.removeStyle(e,s,n)}setProperty(e,s,n){"@"==s.charAt(0)&&s==gS?this.disableAnimations(e,!!n):this.delegate.setProperty(e,s,n)}setValue(e,s){this.delegate.setValue(e,s)}listen(e,s,n){return this.delegate.listen(e,s,n)}disableAnimations(e,s){this.engine.disableAnimations(e,s)}}class lI extends _S{constructor(e,s,n,d,b){super(s,n,d,b),this.factory=e,this.namespaceId=s}setProperty(e,s,n){"@"==s.charAt(0)?"."==s.charAt(1)&&s==gS?this.disableAnimations(e,n=void 0===n||!!n):this.engine.process(this.namespaceId,e,s.slice(1),n):this.delegate.setProperty(e,s,n)}listen(e,s,n){if("@"==s.charAt(0)){const d=function cI(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}(e);let b=s.slice(1),D="";return"@"!=b.charAt(0)&&([b,D]=function uI(i){const e=i.indexOf(".");return[i.substring(0,e),i.slice(e+1)]}(b)),this.engine.listen(this.namespaceId,d,b,D,k=>{this.factory.scheduleListenerCallback(k._data||-1,n,k)})}return this.delegate.listen(e,s,n)}}const yS=[{provide:Rb,useClass:Qx},{provide:j0,useFactory:function hI(){return new $0}},{provide:Vt,useClass:(()=>{var i;class e extends Vt{constructor(n,d,b,D){super(n.body,d,b)}ngOnDestroy(){this.flush()}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ye),E.LFG(by),E.LFG(j0),E.LFG(E.z2F))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac}),e})()},{provide:E.FYo,useFactory:function fI(i,e,s){return new aI(i,e,s)},deps:[rn,Vt,E.R0b]}],tD=[{provide:by,useFactory:()=>new Ig},{provide:E.QbO,useValue:"BrowserAnimations"},...yS],vS=[{provide:by,useClass:SM},{provide:E.QbO,useValue:"NoopAnimations"},...yS];let nD,pI=(()=>{var i;class e{static withConfig(n){return{ngModule:e,providers:n.disableAnimations?vS:tD}}}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({providers:tD,imports:[ih]}),e})();try{nD=typeof Intl<"u"&&Intl.v8BreakIterator}catch{nD=!1}let ew,Iy,Sy=(()=>{var i;class e{constructor(n){this._platformId=n,this.isBrowser=this._platformId?function El(i){return i===aa}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!nD)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(E.Lbi))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();function tw(i){return function mI(){if(null==ew&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>ew=!0}))}finally{ew=ew||!1}return ew}()?i:!!i.capture}function gI(){if(null==Iy){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Iy=!1,Iy;if("scrollBehavior"in document.documentElement.style)Iy=!0;else{const i=Element.prototype.scrollTo;Iy=!!i&&!/\{\s*\[native code\]\s*\}/.test(i.toString())}}return Iy}function rD(i){return i.composedPath?i.composedPath()[0]:i.target}function oD(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function hC(i){return Array.isArray(i)?i:[i]}function _s(i){return null==i?"":"string"==typeof i?i:`${i}px`}function sD(i){return i instanceof E.SBq?i.nativeElement:i}var CI=ne(836),TI=ne(3620);const xS=new Set;let Ay,MI=(()=>{var i;class e{constructor(n,d){this._platform=n,this._nonce=d,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):SI}matchMedia(n){return(this._platform.WEBKIT||this._platform.BLINK)&&function DI(i,e){if(!xS.has(i))try{Ay||(Ay=document.createElement("style"),e&&(Ay.nonce=e),Ay.setAttribute("type","text/css"),document.head.appendChild(Ay)),Ay.sheet&&(Ay.sheet.insertRule(`@media ${i} {body{ }}`,0),xS.add(i))}catch(s){console.error(s)}}(n,this._nonce),this._matchMedia(n)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Sy),E.LFG(E.Ojb,8))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();function SI(i){return{matches:"all"===i||""===i,media:i,addListener:()=>{},removeListener:()=>{}}}let II=(()=>{var i;class e{constructor(n,d){this._mediaMatcher=n,this._zone=d,this._queries=new Map,this._destroySubject=new bt.x}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(n){return wS(hC(n)).some(b=>this._registerQuery(b).mql.matches)}observe(n){let D=le(wS(hC(n)).map(k=>this._registerQuery(k).observable));return D=De(D.pipe((0,ut.q)(1)),D.pipe((0,CI.T)(1),(0,TI.b)(0))),D.pipe((0,R.U)(k=>{const H={matches:!1,breakpoints:{}};return k.forEach(({matches:W,query:fe})=>{H.matches=H.matches||W,H.breakpoints[fe]=W}),H}))}_registerQuery(n){if(this._queries.has(n))return this._queries.get(n);const d=this._mediaMatcher.matchMedia(n),D={observable:new Xo.y(k=>{const H=W=>this._zone.run(()=>k.next(W));return d.addListener(H),()=>{d.removeListener(H)}}).pipe(Lt(d),(0,R.U)(({matches:k})=>({query:n,matches:k})),(0,qr.R)(this._destroySubject)),mql:d};return this._queries.set(n,D),D}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(MI),E.LFG(E.R0b))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();function wS(i){return i.map(e=>e.split(",")).reduce((e,s)=>e.concat(s)).map(e=>e.trim())}const MS="cdk-high-contrast-black-on-white",DS="cdk-high-contrast-white-on-black",aD="cdk-high-contrast-active";let VI=(()=>{var i;class e{constructor(n,d){this._platform=n,this._document=d,this._breakpointSubscription=(0,E.f3M)(II).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const n=this._document.createElement("div");n.style.backgroundColor="rgb(1,2,3)",n.style.position="absolute",this._document.body.appendChild(n);const d=this._document.defaultView||window,b=d&&d.getComputedStyle?d.getComputedStyle(n):null,D=(b&&b.backgroundColor||"").replace(/ /g,"");switch(n.remove(),D){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const n=this._document.body.classList;n.remove(aD,MS,DS),this._hasCheckedHighContrastMode=!0;const d=this.getHighContrastMode();1===d?n.add(aD,MS):2===d&&n.add(aD,DS)}}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Sy),E.LFG(Ye))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();const UI=new E.OlP("cdk-dir-doc",{providedIn:"root",factory:function jI(){return(0,E.f3M)(Ye)}}),$I=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let GI=(()=>{var i;class e{constructor(n){this.value="ltr",this.change=new E.vpe,n&&(this.value=function HI(i){const e=i?.toLowerCase()||"";return"auto"===e&&typeof navigator<"u"&&navigator?.language?$I.test(navigator.language)?"rtl":"ltr":"rtl"===e?"rtl":"ltr"}((n.body?n.body.dir:null)||(n.documentElement?n.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(UI,8))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),nw=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({}),e})();const WI=new E.OlP("mat-sanity-checks",{providedIn:"root",factory:function ZI(){return!0}});let Z0=(()=>{var i;class e{constructor(n,d,b){this._sanityChecks=d,this._document=b,this._hasDoneGlobalChecks=!1,n._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(n){return!oD()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[n])}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(VI),E.LFG(WI,8),E.LFG(Ye))},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[nw,nw]}),e})();class YI{constructor(e,s,n,d=!1){this._renderer=e,this.element=s,this.config=n,this._animationForciblyDisabledThroughCss=d,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const PS=tw({passive:!0,capture:!0});class XI{constructor(){this._events=new Map,this._delegateEventHandler=e=>{const s=rD(e);s&&this._events.get(e.type)?.forEach((n,d)=>{(d===s||d.contains(s))&&n.forEach(b=>b.handleEvent(e))})}}addHandler(e,s,n,d){const b=this._events.get(s);if(b){const D=b.get(n);D?D.add(d):b.set(n,new Set([d]))}else this._events.set(s,new Map([[n,new Set([d])]])),e.runOutsideAngular(()=>{document.addEventListener(s,this._delegateEventHandler,PS)})}removeHandler(e,s,n){const d=this._events.get(e);if(!d)return;const b=d.get(s);b&&(b.delete(n),0===b.size&&d.delete(s),0===d.size&&(this._events.delete(e),document.removeEventListener(e,this._delegateEventHandler,PS)))}}const OS={enterDuration:225,exitDuration:150},RS=tw({passive:!0,capture:!0}),kS=["mousedown","touchstart"],FS=["mouseup","mouseleave","touchend","touchcancel"];class fC{constructor(e,s,n,d){this._target=e,this._ngZone=s,this._platform=d,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,d.isBrowser&&(this._containerElement=sD(n))}fadeInRipple(e,s,n={}){const d=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),b={...OS,...n.animation};n.centered&&(e=d.left+d.width/2,s=d.top+d.height/2);const D=n.radius||function JI(i,e,s){const n=Math.max(Math.abs(i-s.left),Math.abs(i-s.right)),d=Math.max(Math.abs(e-s.top),Math.abs(e-s.bottom));return Math.sqrt(n*n+d*d)}(e,s,d),k=e-d.left,H=s-d.top,W=b.enterDuration,fe=document.createElement("div");fe.classList.add("mat-ripple-element"),fe.style.left=k-D+"px",fe.style.top=H-D+"px",fe.style.height=2*D+"px",fe.style.width=2*D+"px",null!=n.color&&(fe.style.backgroundColor=n.color),fe.style.transitionDuration=`${W}ms`,this._containerElement.appendChild(fe);const we=window.getComputedStyle(fe),Je=we.transitionDuration,ht="none"===we.transitionProperty||"0s"===Je||"0s, 0s"===Je||0===d.width&&0===d.height,qt=new YI(this,fe,n,ht);fe.style.transform="scale3d(1, 1, 1)",qt.state=0,n.persistent||(this._mostRecentTransientRipple=qt);let sn=null;return!ht&&(W||b.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const Dn=()=>this._finishRippleTransition(qt),oi=()=>this._destroyRipple(qt);fe.addEventListener("transitionend",Dn),fe.addEventListener("transitioncancel",oi),sn={onTransitionEnd:Dn,onTransitionCancel:oi}}),this._activeRipples.set(qt,sn),(ht||!W)&&this._finishRippleTransition(qt),qt}fadeOutRipple(e){if(2===e.state||3===e.state)return;const s=e.element,n={...OS,...e.config.animation};s.style.transitionDuration=`${n.exitDuration}ms`,s.style.opacity="0",e.state=2,(e._animationForciblyDisabledThroughCss||!n.exitDuration)&&this._finishRippleTransition(e)}fadeOutAll(){this._getActiveRipples().forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){const s=sD(e);!this._platform.isBrowser||!s||s===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=s,kS.forEach(n=>{fC._eventManager.addHandler(this._ngZone,n,s,this)}))}handleEvent(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{FS.forEach(s=>{this._triggerElement.addEventListener(s,this,RS)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(e){0===e.state?this._startFadeOutTransition(e):2===e.state&&this._destroyRipple(e)}_startFadeOutTransition(e){const s=e===this._mostRecentTransientRipple,{persistent:n}=e.config;e.state=1,!n&&(!s||!this._isPointerDown)&&e.fadeOut()}_destroyRipple(e){const s=this._activeRipples.get(e)??null;this._activeRipples.delete(e),this._activeRipples.size||(this._containerRect=null),e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),e.state=3,null!==s&&(e.element.removeEventListener("transitionend",s.onTransitionEnd),e.element.removeEventListener("transitioncancel",s.onTransitionCancel)),e.element.remove()}_onMousedown(e){const s=function NI(i){return 0===i.buttons||0===i.offsetX&&0===i.offsetY}(e),n=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!s&&!n&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!function BI(i){const e=i.touches&&i.touches[0]||i.changedTouches&&i.changedTouches[0];return!(!e||-1!==e.identifier||null!=e.radiusX&&1!==e.radiusX||null!=e.radiusY&&1!==e.radiusY)}(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const s=e.changedTouches;if(s)for(let n=0;n<s.length;n++)this.fadeInRipple(s[n].clientX,s[n].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(e=>{!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const e=this._triggerElement;e&&(kS.forEach(s=>fC._eventManager.removeHandler(s,e,this)),this._pointerUpEventsRegistered&&FS.forEach(s=>e.removeEventListener(s,this,RS)))}}fC._eventManager=new XI;let LS=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[Z0,Z0]}),e})(),tA=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[Z0,LS,Z0]}),e})();var nA=ne(4266);const iA=["addListener","removeListener"],rA=["addEventListener","removeEventListener"],oA=["on","off"];function lD(i,e,s,n){if((0,Cs.m)(s)&&(n=s,s=void 0),n)return lD(i,e,s).pipe($(n));const[d,b]=function lA(i){return(0,Cs.m)(i.addEventListener)&&(0,Cs.m)(i.removeEventListener)}(i)?rA.map(D=>k=>i[D](e,k,s)):function sA(i){return(0,Cs.m)(i.addListener)&&(0,Cs.m)(i.removeListener)}(i)?iA.map(NS(i,e)):function aA(i){return(0,Cs.m)(i.on)&&(0,Cs.m)(i.off)}(i)?oA.map(NS(i,e)):[];if(!d&&(0,nA.z)(i))return(0,wt.z)(D=>lD(D,e,s))((0,Me.Xf)(i));if(!d)throw new TypeError("Invalid event target");return new Xo.y(D=>{const k=(...H)=>D.next(1<H.length?H:H[0]);return d(k),()=>b(k)})}function NS(i,e){return s=>n=>i[s](e,n)}var BS=ne(1954);const rw={schedule(i){let e=requestAnimationFrame,s=cancelAnimationFrame;const{delegate:n}=rw;n&&(e=n.requestAnimationFrame,s=n.cancelAnimationFrame);const d=e(b=>{s=void 0,i(b)});return new At.w0(()=>s?.(d))},requestAnimationFrame(...i){const{delegate:e}=rw;return(e?.requestAnimationFrame||requestAnimationFrame)(...i)},cancelAnimationFrame(...i){const{delegate:e}=rw;return(e?.cancelAnimationFrame||cancelAnimationFrame)(...i)},delegate:void 0};var zS=ne(2631);new class uA extends zS.v{flush(e){this._active=!0;const s=this._scheduled;this._scheduled=void 0;const{actions:n}=this;let d;e=e||n.shift();do{if(d=e.execute(e.state,e.delay))break}while((e=n[0])&&e.id===s&&n.shift());if(this._active=!1,d){for(;(e=n[0])&&e.id===s&&n.shift();)e.unsubscribe();throw d}}}(class cA extends BS.o{constructor(e,s){super(e,s),this.scheduler=e,this.work=s}requestAsyncId(e,s,n=0){return null!==n&&n>0?super.requestAsyncId(e,s,n):(e.actions.push(this),e._scheduled||(e._scheduled=rw.requestAnimationFrame(()=>e.flush(void 0))))}recycleAsyncId(e,s,n=0){var d;if(null!=n?n>0:this.delay>0)return super.recycleAsyncId(e,s,n);const{actions:b}=e;null!=s&&(null===(d=b[b.length-1])||void 0===d?void 0:d.id)!==s&&(rw.cancelAnimationFrame(s),e._scheduled=void 0)}});let cD,hA=1;const pC={};function VS(i){return i in pC&&(delete pC[i],!0)}const fA={setImmediate(i){const e=hA++;return pC[e]=!0,cD||(cD=Promise.resolve()),cD.then(()=>VS(e)&&i()),e},clearImmediate(i){VS(i)}},{setImmediate:pA,clearImmediate:mA}=fA,mC={setImmediate(...i){const{delegate:e}=mC;return(e?.setImmediate||pA)(...i)},clearImmediate(i){const{delegate:e}=mC;return(e?.clearImmediate||mA)(i)},delegate:void 0};new class _A extends zS.v{flush(e){this._active=!0;const s=this._scheduled;this._scheduled=void 0;const{actions:n}=this;let d;e=e||n.shift();do{if(d=e.execute(e.state,e.delay))break}while((e=n[0])&&e.id===s&&n.shift());if(this._active=!1,d){for(;(e=n[0])&&e.id===s&&n.shift();)e.unsubscribe();throw d}}}(class gA extends BS.o{constructor(e,s){super(e,s),this.scheduler=e,this.work=s}requestAsyncId(e,s,n=0){return null!==n&&n>0?super.requestAsyncId(e,s,n):(e.actions.push(this),e._scheduled||(e._scheduled=mC.setImmediate(e.flush.bind(e,void 0))))}recycleAsyncId(e,s,n=0){var d;if(null!=n?n>0:this.delay>0)return super.recycleAsyncId(e,s,n);const{actions:b}=e;null!=s&&(null===(d=b[b.length-1])||void 0===d?void 0:d.id)!==s&&(mC.clearImmediate(s),e._scheduled===s&&(e._scheduled=void 0))}});var US=ne(6321),bA=ne(671),xA=ne(93);function jS(i,e=US.z){return function vA(i){return(0,Ve.e)((e,s)=>{let n=!1,d=null,b=null,D=!1;const k=()=>{if(b?.unsubscribe(),b=null,n){n=!1;const W=d;d=null,s.next(W)}D&&s.complete()},H=()=>{b=null,D&&s.complete()};e.subscribe((0,ee.x)(s,W=>{n=!0,d=W,b||(0,Me.Xf)(i(W)).subscribe(b=(0,ee.x)(s,k,H))},()=>{D=!0,(!n||!b||b.closed)&&s.complete()}))})}(()=>function wA(i=0,e,s=US.P){let n=-1;return null!=e&&((0,bA.K)(e)?s=e:n=e),new Xo.y(d=>{let b=(0,xA.q)(i)?+i-s.now():i;b<0&&(b=0);let D=0;return s.schedule(function(){d.closed||(d.next(D++),0<=n?this.schedule(void 0,n):d.complete())},b)})}(i,e))}let CA=(()=>{var i;class e{constructor(n,d,b){this._ngZone=n,this._platform=d,this._scrolled=new bt.x,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=b}register(n){this.scrollContainers.has(n)||this.scrollContainers.set(n,n.elementScrolled().subscribe(()=>this._scrolled.next(n)))}deregister(n){const d=this.scrollContainers.get(n);d&&(d.unsubscribe(),this.scrollContainers.delete(n))}scrolled(n=20){return this._platform.isBrowser?new Xo.y(d=>{this._globalSubscription||this._addGlobalListener();const b=n>0?this._scrolled.pipe(jS(n)).subscribe(d):this._scrolled.subscribe(d);return this._scrolledCount++,()=>{b.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):(0,Nn.of)()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((n,d)=>this.deregister(d)),this._scrolled.complete()}ancestorScrolled(n,d){const b=this.getAncestorScrollContainers(n);return this.scrolled(d).pipe((0,gt.h)(D=>!D||b.indexOf(D)>-1))}getAncestorScrollContainers(n){const d=[];return this.scrollContainers.forEach((b,D)=>{this._scrollableContainsElement(D,n)&&d.push(D)}),d}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(n,d){let b=sD(d),D=n.getElementRef().nativeElement;do{if(b==D)return!0}while(b=b.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>lD(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(E.R0b),E.LFG(Sy),E.LFG(Ye,8))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),$S=(()=>{var i;class e{constructor(n,d,b){this._platform=n,this._change=new bt.x,this._changeListener=D=>{this._change.next(D)},this._document=b,d.runOutsideAngular(()=>{if(n.isBrowser){const D=this._getWindow();D.addEventListener("resize",this._changeListener),D.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const n=this._getWindow();n.removeEventListener("resize",this._changeListener),n.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const n={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),n}getViewportRect(){const n=this.getViewportScrollPosition(),{width:d,height:b}=this.getViewportSize();return{top:n.top,left:n.left,bottom:n.top+b,right:n.left+d,height:b,width:d}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const n=this._document,d=this._getWindow(),b=n.documentElement,D=b.getBoundingClientRect();return{top:-D.top||n.body.scrollTop||d.scrollY||b.scrollTop||0,left:-D.left||n.body.scrollLeft||d.scrollX||b.scrollLeft||0}}change(n=20){return n>0?this._change.pipe(jS(n)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const n=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:n.innerWidth,height:n.innerHeight}:{width:0,height:0}}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Sy),E.LFG(E.R0b),E.LFG(Ye,8))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),uD=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({}),e})(),HS=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({imports:[nw,uD,nw,uD]}),e})();class dD{attach(e){return this._attachedHost=e,e.attach(this)}detach(){let e=this._attachedHost;null!=e&&(this._attachedHost=null,e.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(e){this._attachedHost=e}}class MA extends dD{constructor(e,s,n,d,b){super(),this.component=e,this.viewContainerRef=s,this.injector=n,this.componentFactoryResolver=d,this.projectableNodes=b}}class DA extends dD{constructor(e,s,n,d){super(),this.templateRef=e,this.viewContainerRef=s,this.context=n,this.injector=d}get origin(){return this.templateRef.elementRef}attach(e,s=this.context){return this.context=s,super.attach(e)}detach(){return this.context=void 0,super.detach()}}class SA extends dD{constructor(e){super(),this.element=e instanceof E.SBq?e.nativeElement:e}}class IA{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(e){return e instanceof MA?(this._attachedPortal=e,this.attachComponentPortal(e)):e instanceof DA?(this._attachedPortal=e,this.attachTemplatePortal(e)):this.attachDomPortal&&e instanceof SA?(this._attachedPortal=e,this.attachDomPortal(e)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(e){this._disposeFn=e}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class AA extends IA{constructor(e,s,n,d,b){super(),this.outletElement=e,this._componentFactoryResolver=s,this._appRef=n,this._defaultInjector=d,this.attachDomPortal=D=>{const k=D.element,H=this._document.createComment("dom-portal");k.parentNode.insertBefore(H,k),this.outletElement.appendChild(k),this._attachedPortal=D,super.setDisposeFn(()=>{H.parentNode&&H.parentNode.replaceChild(k,H)})},this._document=b}attachComponentPortal(e){const n=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component);let d;return e.viewContainerRef?(d=e.viewContainerRef.createComponent(n,e.viewContainerRef.length,e.injector||e.viewContainerRef.injector,e.projectableNodes||void 0),this.setDisposeFn(()=>d.destroy())):(d=n.create(e.injector||this._defaultInjector||E.zs3.NULL),this._appRef.attachView(d.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(d.hostView),d.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(d)),this._attachedPortal=e,d}attachTemplatePortal(e){let s=e.viewContainerRef,n=s.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return n.rootNodes.forEach(d=>this.outletElement.appendChild(d)),n.detectChanges(),this.setDisposeFn(()=>{let d=s.indexOf(n);-1!==d&&s.remove(d)}),this._attachedPortal=e,n}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(e){return e.hostView.rootNodes[0]}}let PA=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({}),e})();const GS=gI();class OA{constructor(e,s){this._viewportRuler=e,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=s}attach(){}enable(){if(this._canBeEnabled()){const e=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=e.style.left||"",this._previousHTMLStyles.top=e.style.top||"",e.style.left=_s(-this._previousScrollPosition.left),e.style.top=_s(-this._previousScrollPosition.top),e.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const e=this._document.documentElement,n=e.style,d=this._document.body.style,b=n.scrollBehavior||"",D=d.scrollBehavior||"";this._isEnabled=!1,n.left=this._previousHTMLStyles.left,n.top=this._previousHTMLStyles.top,e.classList.remove("cdk-global-scrollblock"),GS&&(n.scrollBehavior=d.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),GS&&(n.scrollBehavior=b,d.scrollBehavior=D)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const s=this._document.body,n=this._viewportRuler.getViewportSize();return s.scrollHeight>n.height||s.scrollWidth>n.width}}class RA{constructor(e,s,n,d){this._scrollDispatcher=e,this._ngZone=s,this._viewportRuler=n,this._config=d,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(e){this._overlayRef=e}enable(){if(this._scrollSubscription)return;const e=this._scrollDispatcher.scrolled(0).pipe((0,gt.h)(s=>!s||!this._overlayRef.overlayElement.contains(s.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=e.subscribe(()=>{const s=this._viewportRuler.getViewportScrollPosition().top;Math.abs(s-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=e.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class ZS{enable(){}disable(){}attach(){}}function hD(i,e){return e.some(s=>i.bottom<s.top||i.top>s.bottom||i.right<s.left||i.left>s.right)}function WS(i,e){return e.some(s=>i.top<s.top||i.bottom>s.bottom||i.left<s.left||i.right>s.right)}class kA{constructor(e,s,n,d){this._scrollDispatcher=e,this._viewportRuler=s,this._ngZone=n,this._config=d,this._scrollSubscription=null}attach(e){this._overlayRef=e}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const s=this._overlayRef.overlayElement.getBoundingClientRect(),{width:n,height:d}=this._viewportRuler.getViewportSize();hD(s,[{width:n,height:d,bottom:d,right:n,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let FA=(()=>{var i;class e{constructor(n,d,b,D){this._scrollDispatcher=n,this._viewportRuler=d,this._ngZone=b,this.noop=()=>new ZS,this.close=k=>new RA(this._scrollDispatcher,this._ngZone,this._viewportRuler,k),this.block=()=>new OA(this._viewportRuler,this._document),this.reposition=k=>new kA(this._scrollDispatcher,this._viewportRuler,this._ngZone,k),this._document=D}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(CA),E.LFG($S),E.LFG(E.R0b),E.LFG(Ye))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();class LA{constructor(e){if(this.scrollStrategy=new ZS,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,e){const s=Object.keys(e);for(const n of s)void 0!==e[n]&&(this[n]=e[n])}}}class NA{constructor(e,s){this.connectionPair=e,this.scrollableViewProperties=s}}let qS=(()=>{var i;class e{constructor(n){this._attachedOverlays=[],this._document=n}ngOnDestroy(){this.detach()}add(n){this.remove(n),this._attachedOverlays.push(n)}remove(n){const d=this._attachedOverlays.indexOf(n);d>-1&&this._attachedOverlays.splice(d,1),0===this._attachedOverlays.length&&this.detach()}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ye))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),BA=(()=>{var i;class e extends qS{constructor(n,d){super(n),this._ngZone=d,this._keydownListener=b=>{const D=this._attachedOverlays;for(let k=D.length-1;k>-1;k--)if(D[k]._keydownEvents.observers.length>0){const H=D[k]._keydownEvents;this._ngZone?this._ngZone.run(()=>H.next(b)):H.next(b);break}}}add(n){super.add(n),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ye),E.LFG(E.R0b,8))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),zA=(()=>{var i;class e extends qS{constructor(n,d,b){super(n),this._platform=d,this._ngZone=b,this._cursorStyleIsSet=!1,this._pointerDownListener=D=>{this._pointerDownEventTarget=rD(D)},this._clickListener=D=>{const k=rD(D),H="click"===D.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:k;this._pointerDownEventTarget=null;const W=this._attachedOverlays.slice();for(let fe=W.length-1;fe>-1;fe--){const we=W[fe];if(we._outsidePointerEvents.observers.length<1||!we.hasAttached())continue;if(we.overlayElement.contains(k)||we.overlayElement.contains(H))break;const ft=we._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>ft.next(D)):ft.next(D)}}}add(n){if(super.add(n),!this._isAttached){const d=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(d)):this._addEventListeners(d),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=d.style.cursor,d.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const n=this._document.body;n.removeEventListener("pointerdown",this._pointerDownListener,!0),n.removeEventListener("click",this._clickListener,!0),n.removeEventListener("auxclick",this._clickListener,!0),n.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(n.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(n){n.addEventListener("pointerdown",this._pointerDownListener,!0),n.addEventListener("click",this._clickListener,!0),n.addEventListener("auxclick",this._clickListener,!0),n.addEventListener("contextmenu",this._clickListener,!0)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ye),E.LFG(Sy),E.LFG(E.R0b,8))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),YS=(()=>{var i;class e{constructor(n,d){this._platform=d,this._document=n}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const n="cdk-overlay-container";if(this._platform.isBrowser||oD()){const b=this._document.querySelectorAll(`.${n}[platform="server"], .${n}[platform="test"]`);for(let D=0;D<b.length;D++)b[D].remove()}const d=this._document.createElement("div");d.classList.add(n),oD()?d.setAttribute("platform","test"):this._platform.isBrowser||d.setAttribute("platform","server"),this._document.body.appendChild(d),this._containerElement=d}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(Ye),E.LFG(Sy))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();class VA{constructor(e,s,n,d,b,D,k,H,W,fe=!1){this._portalOutlet=e,this._host=s,this._pane=n,this._config=d,this._ngZone=b,this._keyboardDispatcher=D,this._document=k,this._location=H,this._outsideClickDispatcher=W,this._animationsDisabled=fe,this._backdropElement=null,this._backdropClick=new bt.x,this._attachments=new bt.x,this._detachments=new bt.x,this._locationChanges=At.w0.EMPTY,this._backdropClickHandler=we=>this._backdropClick.next(we),this._backdropTransitionendHandler=we=>{this._disposeBackdrop(we.target)},this._keydownEvents=new bt.x,this._outsidePointerEvents=new bt.x,d.scrollStrategy&&(this._scrollStrategy=d.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=d.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(e){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const s=this._portalOutlet.attach(e);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe((0,ut.q)(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof s?.onDestroy&&s.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),s}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const e=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),e}dispose(){const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}updateSize(e){this._config={...this._config,...e},this._updateElementSize()}setDirection(e){this._config={...this._config,direction:e},this._updateElementDirection()}addPanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!0)}removePanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!1)}getDirection(){const e=this._config.direction;return e?"string"==typeof e?e:e.value:"ltr"}updateScrollStrategy(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const e=this._pane.style;e.width=_s(this._config.width),e.height=_s(this._config.height),e.minWidth=_s(this._config.minWidth),e.minHeight=_s(this._config.minHeight),e.maxWidth=_s(this._config.maxWidth),e.maxHeight=_s(this._config.maxHeight)}_togglePointerEvents(e){this._pane.style.pointerEvents=e?"":"none"}_attachBackdrop(){const e="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(e)})}):this._backdropElement.classList.add(e)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const e=this._backdropElement;if(e){if(this._animationsDisabled)return void this._disposeBackdrop(e);e.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{e.addEventListener("transitionend",this._backdropTransitionendHandler)}),e.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(e)},500))}}_toggleClasses(e,s,n){const d=hC(s||[]).filter(b=>!!b);d.length&&(n?e.classList.add(...d):e.classList.remove(...d))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const e=this._ngZone.onStable.pipe((0,qr.R)((0,Ww.T)(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),e.unsubscribe())})})}_disposeScrollStrategy(){const e=this._scrollStrategy;e&&(e.disable(),e.detach&&e.detach())}_disposeBackdrop(e){e&&(e.removeEventListener("click",this._backdropClickHandler),e.removeEventListener("transitionend",this._backdropTransitionendHandler),e.remove(),this._backdropElement===e&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const XS="cdk-overlay-connected-position-bounding-box",UA=/([A-Za-z%]+)$/;class jA{get positions(){return this._preferredPositions}constructor(e,s,n,d,b){this._viewportRuler=s,this._document=n,this._platform=d,this._overlayContainer=b,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new bt.x,this._resizeSubscription=At.w0.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(e)}attach(e){this._validatePositions(),e.hostElement.classList.add(XS),this._overlayRef=e,this._boundingBox=e.hostElement,this._pane=e.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._originRect,s=this._overlayRect,n=this._viewportRect,d=this._containerRect,b=[];let D;for(let k of this._preferredPositions){let H=this._getOriginPoint(e,d,k),W=this._getOverlayPoint(H,s,k),fe=this._getOverlayFit(W,s,n,k);if(fe.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(k,H);this._canFitWithFlexibleDimensions(fe,W,n)?b.push({position:k,origin:H,overlayRect:s,boundingBoxRect:this._calculateBoundingBoxRect(H,k)}):(!D||D.overlayFit.visibleArea<fe.visibleArea)&&(D={overlayFit:fe,overlayPoint:W,originPoint:H,position:k,overlayRect:s})}if(b.length){let k=null,H=-1;for(const W of b){const fe=W.boundingBoxRect.width*W.boundingBoxRect.height*(W.position.weight||1);fe>H&&(H=fe,k=W)}return this._isPushed=!1,void this._applyPosition(k.position,k.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(D.position,D.originPoint);this._applyPosition(D.position,D.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Py(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(XS),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const e=this._lastPosition;if(e){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const s=this._getOriginPoint(this._originRect,this._containerRect,e);this._applyPosition(e,s)}else this.apply()}withScrollableContainers(e){return this._scrollables=e,this}withPositions(e){return this._preferredPositions=e,-1===e.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(e){return this._viewportMargin=e,this}withFlexibleDimensions(e=!0){return this._hasFlexibleDimensions=e,this}withGrowAfterOpen(e=!0){return this._growAfterOpen=e,this}withPush(e=!0){return this._canPush=e,this}withLockedPosition(e=!0){return this._positionLocked=e,this}setOrigin(e){return this._origin=e,this}withDefaultOffsetX(e){return this._offsetX=e,this}withDefaultOffsetY(e){return this._offsetY=e,this}withTransformOriginOn(e){return this._transformOriginSelector=e,this}_getOriginPoint(e,s,n){let d,b;if("center"==n.originX)d=e.left+e.width/2;else{const D=this._isRtl()?e.right:e.left,k=this._isRtl()?e.left:e.right;d="start"==n.originX?D:k}return s.left<0&&(d-=s.left),b="center"==n.originY?e.top+e.height/2:"top"==n.originY?e.top:e.bottom,s.top<0&&(b-=s.top),{x:d,y:b}}_getOverlayPoint(e,s,n){let d,b;return d="center"==n.overlayX?-s.width/2:"start"===n.overlayX?this._isRtl()?-s.width:0:this._isRtl()?0:-s.width,b="center"==n.overlayY?-s.height/2:"top"==n.overlayY?0:-s.height,{x:e.x+d,y:e.y+b}}_getOverlayFit(e,s,n,d){const b=JS(s);let{x:D,y:k}=e,H=this._getOffset(d,"x"),W=this._getOffset(d,"y");H&&(D+=H),W&&(k+=W);let ft=0-k,Je=k+b.height-n.height,ht=this._subtractOverflows(b.width,0-D,D+b.width-n.width),qt=this._subtractOverflows(b.height,ft,Je),sn=ht*qt;return{visibleArea:sn,isCompletelyWithinViewport:b.width*b.height===sn,fitsInViewportVertically:qt===b.height,fitsInViewportHorizontally:ht==b.width}}_canFitWithFlexibleDimensions(e,s,n){if(this._hasFlexibleDimensions){const d=n.bottom-s.y,b=n.right-s.x,D=KS(this._overlayRef.getConfig().minHeight),k=KS(this._overlayRef.getConfig().minWidth);return(e.fitsInViewportVertically||null!=D&&D<=d)&&(e.fitsInViewportHorizontally||null!=k&&k<=b)}return!1}_pushOverlayOnScreen(e,s,n){if(this._previousPushAmount&&this._positionLocked)return{x:e.x+this._previousPushAmount.x,y:e.y+this._previousPushAmount.y};const d=JS(s),b=this._viewportRect,D=Math.max(e.x+d.width-b.width,0),k=Math.max(e.y+d.height-b.height,0),H=Math.max(b.top-n.top-e.y,0),W=Math.max(b.left-n.left-e.x,0);let fe=0,we=0;return fe=d.width<=b.width?W||-D:e.x<this._viewportMargin?b.left-n.left-e.x:0,we=d.height<=b.height?H||-k:e.y<this._viewportMargin?b.top-n.top-e.y:0,this._previousPushAmount={x:fe,y:we},{x:e.x+fe,y:e.y+we}}_applyPosition(e,s){if(this._setTransformOrigin(e),this._setOverlayElementStyles(s,e),this._setBoundingBoxStyles(s,e),e.panelClass&&this._addPanelClasses(e.panelClass),this._lastPosition=e,this._positionChanges.observers.length){const n=this._getScrollVisibility(),d=new NA(e,n);this._positionChanges.next(d)}this._isInitialRender=!1}_setTransformOrigin(e){if(!this._transformOriginSelector)return;const s=this._boundingBox.querySelectorAll(this._transformOriginSelector);let n,d=e.overlayY;n="center"===e.overlayX?"center":this._isRtl()?"start"===e.overlayX?"right":"left":"start"===e.overlayX?"left":"right";for(let b=0;b<s.length;b++)s[b].style.transformOrigin=`${n} ${d}`}_calculateBoundingBoxRect(e,s){const n=this._viewportRect,d=this._isRtl();let b,D,k,fe,we,ft;if("top"===s.overlayY)D=e.y,b=n.height-D+this._viewportMargin;else if("bottom"===s.overlayY)k=n.height-e.y+2*this._viewportMargin,b=n.height-k+this._viewportMargin;else{const Je=Math.min(n.bottom-e.y+n.top,e.y),ht=this._lastBoundingBoxSize.height;b=2*Je,D=e.y-Je,b>ht&&!this._isInitialRender&&!this._growAfterOpen&&(D=e.y-ht/2)}if("end"===s.overlayX&&!d||"start"===s.overlayX&&d)ft=n.width-e.x+this._viewportMargin,fe=e.x-this._viewportMargin;else if("start"===s.overlayX&&!d||"end"===s.overlayX&&d)we=e.x,fe=n.right-e.x;else{const Je=Math.min(n.right-e.x+n.left,e.x),ht=this._lastBoundingBoxSize.width;fe=2*Je,we=e.x-Je,fe>ht&&!this._isInitialRender&&!this._growAfterOpen&&(we=e.x-ht/2)}return{top:D,left:we,bottom:k,right:ft,width:fe,height:b}}_setBoundingBoxStyles(e,s){const n=this._calculateBoundingBoxRect(e,s);!this._isInitialRender&&!this._growAfterOpen&&(n.height=Math.min(n.height,this._lastBoundingBoxSize.height),n.width=Math.min(n.width,this._lastBoundingBoxSize.width));const d={};if(this._hasExactPosition())d.top=d.left="0",d.bottom=d.right=d.maxHeight=d.maxWidth="",d.width=d.height="100%";else{const b=this._overlayRef.getConfig().maxHeight,D=this._overlayRef.getConfig().maxWidth;d.height=_s(n.height),d.top=_s(n.top),d.bottom=_s(n.bottom),d.width=_s(n.width),d.left=_s(n.left),d.right=_s(n.right),d.alignItems="center"===s.overlayX?"center":"end"===s.overlayX?"flex-end":"flex-start",d.justifyContent="center"===s.overlayY?"center":"bottom"===s.overlayY?"flex-end":"flex-start",b&&(d.maxHeight=_s(b)),D&&(d.maxWidth=_s(D))}this._lastBoundingBoxSize=n,Py(this._boundingBox.style,d)}_resetBoundingBoxStyles(){Py(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Py(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(e,s){const n={},d=this._hasExactPosition(),b=this._hasFlexibleDimensions,D=this._overlayRef.getConfig();if(d){const fe=this._viewportRuler.getViewportScrollPosition();Py(n,this._getExactOverlayY(s,e,fe)),Py(n,this._getExactOverlayX(s,e,fe))}else n.position="static";let k="",H=this._getOffset(s,"x"),W=this._getOffset(s,"y");H&&(k+=`translateX(${H}px) `),W&&(k+=`translateY(${W}px)`),n.transform=k.trim(),D.maxHeight&&(d?n.maxHeight=_s(D.maxHeight):b&&(n.maxHeight="")),D.maxWidth&&(d?n.maxWidth=_s(D.maxWidth):b&&(n.maxWidth="")),Py(this._pane.style,n)}_getExactOverlayY(e,s,n){let d={top:"",bottom:""},b=this._getOverlayPoint(s,this._overlayRect,e);return this._isPushed&&(b=this._pushOverlayOnScreen(b,this._overlayRect,n)),"bottom"===e.overlayY?d.bottom=this._document.documentElement.clientHeight-(b.y+this._overlayRect.height)+"px":d.top=_s(b.y),d}_getExactOverlayX(e,s,n){let D,d={left:"",right:""},b=this._getOverlayPoint(s,this._overlayRect,e);return this._isPushed&&(b=this._pushOverlayOnScreen(b,this._overlayRect,n)),D=this._isRtl()?"end"===e.overlayX?"left":"right":"end"===e.overlayX?"right":"left","right"===D?d.right=this._document.documentElement.clientWidth-(b.x+this._overlayRect.width)+"px":d.left=_s(b.x),d}_getScrollVisibility(){const e=this._getOriginRect(),s=this._pane.getBoundingClientRect(),n=this._scrollables.map(d=>d.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:WS(e,n),isOriginOutsideView:hD(e,n),isOverlayClipped:WS(s,n),isOverlayOutsideView:hD(s,n)}}_subtractOverflows(e,...s){return s.reduce((n,d)=>n-Math.max(d,0),e)}_getNarrowedViewportRect(){const e=this._document.documentElement.clientWidth,s=this._document.documentElement.clientHeight,n=this._viewportRuler.getViewportScrollPosition();return{top:n.top+this._viewportMargin,left:n.left+this._viewportMargin,right:n.left+e-this._viewportMargin,bottom:n.top+s-this._viewportMargin,width:e-2*this._viewportMargin,height:s-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(e,s){return"x"===s?null==e.offsetX?this._offsetX:e.offsetX:null==e.offsetY?this._offsetY:e.offsetY}_validatePositions(){}_addPanelClasses(e){this._pane&&hC(e).forEach(s=>{""!==s&&-1===this._appliedPanelClasses.indexOf(s)&&(this._appliedPanelClasses.push(s),this._pane.classList.add(s))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(e=>{this._pane.classList.remove(e)}),this._appliedPanelClasses=[])}_getOriginRect(){const e=this._origin;if(e instanceof E.SBq)return e.nativeElement.getBoundingClientRect();if(e instanceof Element)return e.getBoundingClientRect();const s=e.width||0,n=e.height||0;return{top:e.y,bottom:e.y+n,left:e.x,right:e.x+s,height:n,width:s}}}function Py(i,e){for(let s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);return i}function KS(i){if("number"!=typeof i&&null!=i){const[e,s]=i.split(UA);return s&&"px"!==s?null:parseFloat(e)}return i||null}function JS(i){return{top:Math.floor(i.top),right:Math.floor(i.right),bottom:Math.floor(i.bottom),left:Math.floor(i.left),width:Math.floor(i.width),height:Math.floor(i.height)}}const QS="cdk-global-overlay-wrapper";class $A{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(e){const s=e.getConfig();this._overlayRef=e,this._width&&!s.width&&e.updateSize({width:this._width}),this._height&&!s.height&&e.updateSize({height:this._height}),e.hostElement.classList.add(QS),this._isDisposed=!1}top(e=""){return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}left(e=""){return this._xOffset=e,this._xPosition="left",this}bottom(e=""){return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}right(e=""){return this._xOffset=e,this._xPosition="right",this}start(e=""){return this._xOffset=e,this._xPosition="start",this}end(e=""){return this._xOffset=e,this._xPosition="end",this}width(e=""){return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}height(e=""){return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}centerHorizontally(e=""){return this.left(e),this._xPosition="center",this}centerVertically(e=""){return this.top(e),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const e=this._overlayRef.overlayElement.style,s=this._overlayRef.hostElement.style,n=this._overlayRef.getConfig(),{width:d,height:b,maxWidth:D,maxHeight:k}=n,H=!("100%"!==d&&"100vw"!==d||D&&"100%"!==D&&"100vw"!==D),W=!("100%"!==b&&"100vh"!==b||k&&"100%"!==k&&"100vh"!==k),fe=this._xPosition,we=this._xOffset,ft="rtl"===this._overlayRef.getConfig().direction;let Je="",ht="",qt="";H?qt="flex-start":"center"===fe?(qt="center",ft?ht=we:Je=we):ft?"left"===fe||"end"===fe?(qt="flex-end",Je=we):("right"===fe||"start"===fe)&&(qt="flex-start",ht=we):"left"===fe||"start"===fe?(qt="flex-start",Je=we):("right"===fe||"end"===fe)&&(qt="flex-end",ht=we),e.position=this._cssPosition,e.marginLeft=H?"0":Je,e.marginTop=W?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=H?"0":ht,s.justifyContent=qt,s.alignItems=W?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const e=this._overlayRef.overlayElement.style,s=this._overlayRef.hostElement,n=s.style;s.classList.remove(QS),n.justifyContent=n.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}}let HA=(()=>{var i;class e{constructor(n,d,b,D){this._viewportRuler=n,this._document=d,this._platform=b,this._overlayContainer=D}global(){return new $A}flexibleConnectedTo(n){return new jA(n,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG($S),E.LFG(Ye),E.LFG(Sy),E.LFG(YS))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})(),GA=0,fD=(()=>{var i;class e{constructor(n,d,b,D,k,H,W,fe,we,ft,Je,ht){this.scrollStrategies=n,this._overlayContainer=d,this._componentFactoryResolver=b,this._positionBuilder=D,this._keyboardDispatcher=k,this._injector=H,this._ngZone=W,this._document=fe,this._directionality=we,this._location=ft,this._outsideClickDispatcher=Je,this._animationsModuleType=ht}create(n){const d=this._createHostElement(),b=this._createPaneElement(d),D=this._createPortalOutlet(b),k=new LA(n);return k.direction=k.direction||this._directionality.value,new VA(D,d,b,k,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(n){const d=this._document.createElement("div");return d.id="cdk-overlay-"+GA++,d.classList.add("cdk-overlay-pane"),n.appendChild(d),d}_createHostElement(){const n=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(n),n}_createPortalOutlet(n){return this._appRef||(this._appRef=this._injector.get(E.z2F)),new AA(n,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return(i=e).\u0275fac=function(n){return new(n||i)(E.LFG(FA),E.LFG(YS),E.LFG(E._Vd),E.LFG(HA),E.LFG(BA),E.LFG(E.zs3),E.LFG(E.R0b),E.LFG(Ye),E.LFG(GI),E.LFG(Cn),E.LFG(zA),E.LFG(E.QbO,8))},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})();const qA={provide:new E.OlP("cdk-connected-overlay-scroll-strategy"),deps:[fD],useFactory:function WA(i){return()=>i.scrollStrategies.reposition()}};let YA=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({providers:[fD,qA],imports:[nw,PA,HS,HS]}),e})();const QA={provide:new E.OlP("mat-menu-scroll-strategy"),deps:[fD],useFactory:function JA(i){return()=>i.scrollStrategies.reposition()}};let eP=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i}),i.\u0275inj=E.cJS({providers:[QA],imports:[br,LS,Z0,YA,uD,Z0]}),e})(),tP=(()=>{var i;class e{}return(i=e).\u0275fac=function(n){return new(n||i)},i.\u0275mod=E.oAB({type:i,bootstrap:[jw]}),i.\u0275inj=E.cJS({providers:[{provide:Js,useClass:HD,multi:!0},{provide:It,useClass:Ot}],imports:[br,K_,ih,Ab,LC,Ns,zl,ms,pI,Ct.Aw.forRoot({}),ry.forRoot([]),tM,Zw.FT.instrument({maxAge:25}),tA,eP]}),e})();Ya().bootstrapModule(tP).catch(i=>console.error(i))},2574:function(Ue){Ue.exports=function(){"use strict";var Ie,ne,E;function Be(p,ue){if(Ie)if(ne){var Ye="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ie+")(sharedChunk); ("+ne+")(sharedChunk); self.onerror = null;",Ge={};Ie(Ge),E=ue(Ge),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(E.workerUrl=window.URL.createObjectURL(new Blob([Ye],{type:"text/javascript"})))}else ne=ue;else Ie=ue}return Be(0,function(p){var ue=typeof self<"u"?self:{},Ye="2.15.0";let Ge;const Le={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Ge){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ge=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch{Ge=o}}return Ge},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Le.API_URL)return null;try{const o=new URL(Le.API_URL);return"api.mapbox.cn"===o.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===o.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ae={supported:!1,testSupport:function(o){!Qe&&$e&&(It?Wt(o):ke=o)}};let ke,$e,Qe=!1,It=!1;function Wt(o){const t=o.createTexture();o.bindTexture(o.TEXTURE_2D,t);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,$e),o.isContextLost())return;Ae.supported=!0}catch{}o.deleteTexture(t),Qe=!0}ue.document&&($e=ue.document.createElement("img"),$e.onload=function(){ke&&Wt(ke),ke=null,It=!0},$e.onerror=function(){Qe=!0,ke=null},$e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const on="01";function Ot(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Cn=un;function un(o,t,a,u){this.cx=3*o,this.bx=3*(a-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(u-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=t,this.p2x=a,this.p2y=u}un.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,t){if(void 0===t&&(t=1e-6),o<0)return 0;if(o>1)return 1;for(var a=o,u=0;u<8;u++){var m=this.sampleCurveX(a)-o;if(Math.abs(m)<t)return a;var y=this.sampleCurveDerivativeX(a);if(Math.abs(y)<1e-6)break;a-=m/y}var w=0,T=1;for(a=o,u=0;u<20&&(m=this.sampleCurveX(a),!(Math.abs(m-o)<t));u++)o>m?w=a:T=a,a=.5*(T-w)+w;return a},solve:function(o,t){return this.sampleCurveY(this.solveCurveX(o,t))}};var Sn=Ot(Cn),gn=it;function it(o,t){this.x=o,this.y=t}it.prototype={clone:function(){return new it(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,t){return this.clone()._rotateAround(o,t)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var t=o.x-this.x,a=o.y-this.y;return t*t+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,t){return Math.atan2(this.x*t-this.y*o,this.x*o+this.y*t)},_matMult:function(o){var t=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=t,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var t=Math.cos(o),a=Math.sin(o),u=a*this.x+t*this.y;return this.x=t*this.x-a*this.y,this.y=u,this},_rotateAround:function(o,t){var a=Math.cos(o),u=Math.sin(o),m=t.y+u*(this.x-t.x)+a*(this.y-t.y);return this.x=t.x+a*(this.x-t.x)-u*(this.y-t.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},it.convert=function(o){return o instanceof it?o:Array.isArray(o)?new it(o[0],o[1]):o};var Ne=Ot(gn);const Nt=Math.PI/180,$t=180/Math.PI;function Ft(o){return o*Nt}function Kt(o){return o*$t}const ui=[[0,0],[1,0],[1,1],[0,1]];function gi(o){if(o<=0)return 0;if(o>=1)return 1;const t=o*o,a=t*o;return 4*(o<.5?a:3*(o-t)+a-.75)}function cr(o,t,a,u){const m=new Sn(o,t,a,u);return function(y){return m.solve(y)}}const No=cr(.25,.1,.25,1);function Wn(o,t,a){return Math.min(a,Math.max(t,o))}function ia(o,t,a){return(a=Wn((a-o)/(t-o),0,1))*a*(3-2*a)}function Si(o,t,a){const u=a-t,m=((o-t)%u+u)%u+t;return m===t?a:m}function yr(o,t,a){if(!o.length)return a(null,[]);let u=o.length;const m=new Array(o.length);let y=null;o.forEach((w,T)=>{t(w,(I,P)=>{I&&(y=I),m[T]=P,0==--u&&a(y,m)})})}function ra(o){const t=[];for(const a in o)t.push(o[a]);return t}function st(o,...t){for(const a of t)for(const u in a)o[u]=a[u];return o}let dt=1;function Mt(){return dt++}function Et(){return function o(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Zt(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function _t(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function yt(o,t){o.forEach(a=>{t[a]&&(t[a]=t[a].bind(t))})}function vt(o,t){return-1!==o.indexOf(t,o.length-t.length)}function dn(o,t,a){const u={};for(const m in o)u[m]=t.call(a||this,o[m],m,o);return u}function yn(o,t,a){const u={};for(const m in o)t.call(a||this,o[m],m,o)&&(u[m]=o[m]);return u}function ai(o){return Array.isArray(o)?o.map(ai):"object"==typeof o&&o?dn(o,ai):o}const On={};function Yn(o){On[o]||(typeof console<"u"&&console.warn(o),On[o]=!0)}function ji(o,t,a){return(a.y-o.y)*(t.x-o.x)>(t.y-o.y)*(a.x-o.x)}function so(o){let t=0;for(let a,u,m=0,y=o.length,w=y-1;m<y;w=m++)a=o[m],u=o[w],t+=(u.x-a.x)*(a.y+u.y);return t}function Pi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ur(o){const t={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,m,y)=>{const w=m||y;return t[u]=!w||w.toLowerCase(),""}),t["max-age"]){const a=parseInt(t["max-age"],10);isNaN(a)?delete t["max-age"]:t["max-age"]=a}return t}let is=null;function Bs(o){if(null==is){const t=o.navigator?o.navigator.userAgent:null;is=!!o.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return is}function xa(o){try{const t=ue[o];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function wo(o,t){return[o[4*t],o[4*t+1],o[4*t+2],o[4*t+3]]}const Bo="mapbox-tiles";let ii,si,Kl=500,$n=50;function Hr(){try{return ue.caches}catch{}}function zo(){Hr()&&!ii&&(ii=ue.caches.open(Bo))}function Eo(o){const t=o.indexOf("?");if(t<0)return o;const u=function(m){const y=m.indexOf("?");return y>0?m.slice(y+1).split("&"):[]}(o).filter(m=>{const y=m.split("=");return"language"===y[0]||"worldview"===y[0]});return u.length?`${o.slice(0,t)}?${u.join("&")}`:o.slice(0,t)}let $i=1/0;const ao={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ao);class vs extends Error{constructor(t,a,u){401===a&&Ze(u)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Hi=Pi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ue.location.protocol?ue.parent:ue).location.href,oa=function(o,t){if(!(/^file:/.test(a=o.url)||/^file:/.test(Hi())&&!/^\w+:/.test(a))){if(ue.fetch&&ue.Request&&ue.AbortController&&ue.Request.prototype.hasOwnProperty("signal"))return function(u,m){const y=new ue.AbortController,w=new ue.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Hi(),referrerPolicy:u.referrerPolicy,signal:y.signal});let T=!1,I=!1;const P=(N=w.url).indexOf("sku=")>0&&Ze(N);var N;"json"===u.type&&w.headers.set("Accept","application/json");const z=(G,q,J)=>{if(I)return;if(G&&"SecurityError"!==G.message&&Yn(G.toString()),q&&J)return U(q);const re=Date.now();ue.fetch(w).then(de=>{if(de.ok){const xe=P?de.clone():null;return U(de,xe,re)}return m(new vs(de.statusText,de.status,u.url))}).catch(de=>{"AbortError"!==de.name&&m(new Error(`${de.message} ${u.url}`))})},U=(G,q,J)=>{("arrayBuffer"===u.type?G.arrayBuffer():"json"===u.type?G.json():G.text()).then(re=>{I||(q&&J&&function(de,xe,he){if(zo(),!ii)return;const ve={status:xe.status,statusText:xe.statusText,headers:new ue.Headers};xe.headers.forEach((et,Ke)=>ve.headers.set(Ke,et));const Ce=ur(xe.headers.get("Cache-Control")||"");if(Ce["no-store"])return;Ce["max-age"]&&ve.headers.set("Expires",new Date(he+1e3*Ce["max-age"]).toUTCString());const Ee=ve.headers.get("Expires");Ee&&(new Date(Ee).getTime()-he<42e4||function(et,Ke){if(void 0===si)try{new Response(new ReadableStream),si=!0}catch{si=!1}si?Ke(et.body):et.blob().then(Ke)}(xe,et=>{const Ke=new ue.Response(et,ve);zo(),ii&&ii.then(pt=>pt.put(Eo(de.url),Ke)).catch(pt=>Yn(pt.message))}))}(w,q,J),T=!0,m(null,re,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch(re=>{I||m(new Error(re.message))})};return P?function(G,q){if(zo(),!ii)return q(null);const J=Eo(G.url);ii.then(re=>{re.match(J).then(de=>{const xe=function(he){if(!he)return!1;const ve=new Date(he.headers.get("Expires")||0),Ce=ur(he.headers.get("Cache-Control")||"");return ve>Date.now()&&!Ce["no-cache"]}(de);re.delete(J),xe&&re.put(J,de.clone()),q(null,de,xe)}).catch(q)}).catch(q)}(w,z):z(null,null),{cancel:()=>{I=!0,T||y.abort()}}}(o,t);if(Pi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,t,void 0,!0)}var a;return function(u,m){const y=new ue.XMLHttpRequest;y.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(y.responseType="arraybuffer");for(const w in u.headers)y.setRequestHeader(w,u.headers[w]);return"json"===u.type&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials="include"===u.credentials,y.onerror=()=>{m(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||0===y.status)&&null!==y.response){let w=y.response;if("json"===u.type)try{w=JSON.parse(y.response)}catch(T){return m(T)}m(null,w,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else m(new vs(y.statusText,y.status,u.url))},y.send(u.body),{cancel:()=>y.abort()}}(o,t)},Ei=function(o,t){return oa(st(o,{type:"arrayBuffer"}),t)};function Ga(o){const t=ue.document.createElement("a");return t.href=o,t.protocol===ue.document.location.protocol&&t.host===ue.document.location.host}const be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Q,ie;Q=[],ie=0;const _e=function(o,t){if(Ae.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),ie>=Le.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:o,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Q.push(y),y}ie++;let a=!1;const u=()=>{if(!a)for(a=!0,ie--;Q.length&&ie<Le.MAX_PARALLEL_IMAGE_REQUESTS;){const y=Q.shift(),{requestParameters:w,callback:T,cancelled:I}=y;I||(y.cancel=_e(w,T).cancel)}},m=Ei(o,(y,w,T,I)=>{u(),y?t(y):w&&(ue.createImageBitmap?function(P,N){const z=new ue.Blob([new Uint8Array(P)],{type:"image/png"});ue.createImageBitmap(z).then(U=>{N(null,U)}).catch(U=>{N(new Error(`Could not load image because of ${U.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(w,(P,N)=>t(P,N,T,I)):function(P,N){const z=new ue.Image,U=ue.URL;z.onload=()=>{N(null,z),U.revokeObjectURL(z.src),z.onload=null,ue.requestAnimationFrame(()=>{z.src=be})},z.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const G=new ue.Blob([new Uint8Array(P)],{type:"image/png"});z.src=P.byteLength?U.createObjectURL(G):be}(w,(P,N)=>t(P,N,T,I)))});return{cancel:()=>{m.cancel(),u()}}},Te="NO_ACCESS_TOKEN";function Oe(o){return 0===o.indexOf("mapbox:")}function Ze(o){return Le.API_URL_REGEX.test(o)}function je(o){return Le.API_CDN_URL_REGEX.test(o)}function Pe(o){return Le.API_STYLE_REGEX.test(o)&&!tt(o)}function tt(o){return Le.API_SPRITE_REGEX.test(o)}const Ht=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Yt(o){const t=o.match(Ht);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ut(o){const t=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${t}`}const qn="mapbox.eventData";function Vn(o){if(!o)return null;const t=o.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(ue.atob(t[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Xn{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const a=Vn(Le.ACCESS_TOKEN);let u="";return u=a&&a.u?ue.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(m,y)=>String.fromCharCode(+("0x"+y)))):Le.ACCESS_TOKEN||"",t?`${qn}.${t}:${u}`:`${qn}:${u}`}fetchEventData(){const t=xa("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const m=ue.localStorage.getItem(a);m&&(this.eventData=JSON.parse(m));const y=ue.localStorage.getItem(u);y&&(this.anonId=y)}catch{Yn("Unable to read from LocalStorage")}}saveEventData(){const t=xa("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{ue.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ue.localStorage.setItem(a,JSON.stringify(this.eventData))}catch{Yn("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,a,u,m){if(!Le.EVENTS_URL)return;const y=Yt(Le.EVENTS_URL);y.params.push(`access_token=${m||Le.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(t).toISOString()},T=a?st(w,a):w,I={url:Ut(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};var N;this.pendingRequest=(N=P=>{this.pendingRequest=null,u(P),this.saveEventData(),this.processRequests(m)},oa(st(I,{method:"POST"}),N))}queueRequest(t,a){this.queue.push(t),this.processRequests(a)}}const Hn=new class extends Xn{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,t){Le.EVENTS_URL&&Le.ACCESS_TOKEN&&Array.isArray(o)&&o.some(a=>Oe(a)||Ze(a))&&this.queueRequest(Date.now(),t)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Vn(Le.ACCESS_TOKEN),a=t?t.u:Le.ACCESS_TOKEN;let u=a!==this.eventData.tokenU;_t(this.anonId)||(this.anonId=Et(),u=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),w=new Date(m),T=(m-this.eventData.lastSuccess)/864e5;u=u||T>=1||T<-1||y.getDate()!==w.getDate()}else u=!0;u?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ye,skuId:on,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=m,this.eventData.tokenU=a)},o):this.processRequests()}},ei=Hn.postTurnstileEvent.bind(Hn),Qn=new class extends Xn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,t,a,u){this.skuToken=t,this.errorCb=u,Le.EVENTS_URL&&(a||Le.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(Te)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),_t(this.anonId)||(this.anonId=Et()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ye,skuId:on,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},o))}},wr=Qn.postMapLoadEvent.bind(Qn),li=new class extends Xn{constructor(){super("gljs.performance")}postPerformanceEvent(o,t){Le.EVENTS_URL&&(o||Le.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,performanceData:a}=this.queue.shift(),u=function(m){const y=ue.performance.getEntriesByType("resource"),w=ue.performance.getEntriesByType("mark"),T=function(U){const G={};if(U)for(const q in U)if("other"!==q)for(const J of U[q]){const re=`${q}ResolveRangeMin`,de=`${q}ResolveRangeMax`,xe=`${q}RequestCount`,he=`${q}RequestCachedCount`;G[re]=Math.min(G[re]||1/0,J.startTime),G[de]=Math.max(G[de]||-1/0,J.responseEnd);const ve=Ce=>{void 0===G[Ce]&&(G[Ce]=0),++G[Ce]};void 0!==J.transferSize&&0===J.transferSize&&ve(he),ve(xe)}return G}(function(U,G){const q={};if(U)for(const J of U){const re=G(J);void 0===q[re]&&(q[re]=[]),q[re].push(J)}return q}(y,zs)),I=ue.devicePixelRatio,P=ue.navigator.connection||ue.navigator.mozConnection||ue.navigator.webkitConnection,N={counters:[],metadata:[],attributes:[]},z=(U,G,q)=>{null!=q&&U.push({name:G,value:q.toString()})};for(const U in T)z(N.counters,U,T[U]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(z(N.counters,"interactionRangeMin",m.interactionRange[0]),z(N.counters,"interactionRangeMax",m.interactionRange[1])),w)for(const U of Object.keys(vl)){const G=vl[U],q=w.find(J=>J.name===G);q&&z(N.counters,G,q.startTime)}return z(N.counters,"visibilityHidden",m.visibilityHidden),z(N.attributes,"style",function(U){if(U)for(const G of U){const q=G.name.split("?")[0];if(Pe(q)){const J=q.split("/").slice(-2);if(2===J.length)return`mapbox://styles/${J[0]}/${J[1]}`}}}(y)),z(N.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),z(N.attributes,"fogEnabled",m.fogEnabled?"true":"false"),z(N.attributes,"projection",m.projection),z(N.attributes,"zoom",m.zoom),z(N.metadata,"devicePixelRatio",I),z(N.metadata,"connectionEffectiveType",P?P.effectiveType:void 0),z(N.metadata,"navigatorUserAgent",ue.navigator.userAgent),z(N.metadata,"screenWidth",ue.screen.width),z(N.metadata,"screenHeight",ue.screen.height),z(N.metadata,"windowWidth",ue.innerWidth),z(N.metadata,"windowHeight",ue.innerHeight),z(N.metadata,"mapWidth",m.width/I),z(N.metadata,"mapHeight",m.height/I),z(N.metadata,"webglRenderer",m.renderer),z(N.metadata,"webglVendor",m.vendor),z(N.metadata,"sdkVersion",Ye),z(N.metadata,"sdkIdentifier","mapbox-gl-js"),N}(a);for(const m of u.metadata);for(const m of u.counters);for(const m of u.attributes);this.postEvent(t,u,()=>{},o)}},tr=li.postPerformanceEvent.bind(li),Vo=new class extends Xn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,t,a,u){if(!Le.API_URL||!Le.SESSION_PATH)return;const m=Yt(Le.API_URL+Le.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${u||Le.ACCESS_TOKEN||""}`);const y={url:Ut(m),headers:{"Content-Type":"text/plain"}};var T;this.pendingRequest=(T=w=>{this.pendingRequest=null,a(w),this.saveEventData(),this.processRequests(u)},oa(st(y,{method:"GET"}),T))}getSessionAPI(o,t,a,u){this.skuToken=t,this.errorCb=u,Le.SESSION_PATH&&Le.API_URL&&(a||Le.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(Te)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||this.getSession(a,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},o)}},Er=Vo.getSessionAPI.bind(Vo),lo=new Set,vl={create:"create",load:"load",fullLoad:"fullLoad"},uf={mark(o){ue.performance.mark(o)},measure(o,t,a){ue.performance.measure(o,t,a)}};function zs(o){const t=o.name.split("?")[0];return je(t)&&t.includes("mapbox-gl.js")?"javascript":je(t)&&t.includes("mapbox-gl.css")?"css":Le.API_FONTS_REGEX.test(t)?"fontRange":tt(t)?"sprite":Pe(t)?"style":Le.API_TILEJSON_REGEX.test(t)?"tilejson":"other"}const pi=ue.performance;function Vs(o){const t=o?o.url.toString():void 0;return pi.getEntriesByName(t)}let co,Ci,sa,Co;const To={now:()=>void 0!==sa?sa:ue.performance.now(),setNow(o){sa=o},restoreNow(){sa=void 0},frame(o){const t=ue.requestAnimationFrame(o);return{cancel:()=>ue.cancelAnimationFrame(t)}},getImageData(o,t=0){const{width:a,height:u}=o;Co||(Co=ue.document.createElement("canvas"));const m=Co.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(a>Co.width||u>Co.height)&&(Co.width=a,Co.height=u),m.clearRect(-t,-t,a+2*t,u+2*t),m.drawImage(o,0,0,a,u),m.getImageData(-t,-t,a+2*t,u+2*t)},resolveURL:o=>(co||(co=ue.document.createElement("a")),co.href=o,co.href),get devicePixelRatio(){return ue.devicePixelRatio},get prefersReducedMotion(){return!!ue.matchMedia&&(null==Ci&&(Ci=ue.matchMedia("(prefers-reduced-motion: reduce)")),Ci.matches)}};function Rc(o,t,a){a[o]&&-1!==a[o].indexOf(t)||(a[o]=a[o]||[],a[o].push(t))}function rs(o,t,a){if(a&&a[o]){const u=a[o].indexOf(t);-1!==u&&a[o].splice(u,1)}}class Uo{constructor(t,a={}){st(this,a),this.type=t}}class os extends Uo{constructor(t,a={}){super("error",st({error:t},a))}}class Za{on(t,a){return this._listeners=this._listeners||{},Rc(t,a,this._listeners),this}off(t,a){return rs(t,a,this._listeners),rs(t,a,this._oneTimeListeners),this}once(t,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Rc(t,a,this._oneTimeListeners),this):new Promise(u=>this.once(t,u))}fire(t,a){"string"==typeof t&&(t=new Uo(t,a||{}));const u=t.type;if(this.listens(u)){t.target=this;const m=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const T of m)T.call(this,t);const y=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const T of y)rs(u,T,this._oneTimeListeners),T.call(this,t);const w=this._eventedParent;w&&(st(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),w.fire(t))}else t instanceof os&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,a){return this._eventedParent=t,this._eventedParentData=a,this}}var ct=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Us(o,...t){for(const a of t)for(const u in a)o[u]=a[u];return o}function rr(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Cr(o){if(Array.isArray(o))return o.map(Cr);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const t={};for(const a in o)t[a]=Cr(o[a]);return t}return rr(o)}class Jl extends Error{constructor(t,a){super(a),this.message=a,this.key=t}}var jo=Jl;class Vd{constructor(t,a=[]){this.parent=t,this.bindings={};for(const[u,m]of a)this.bindings[u]=m}concat(t){return new Vd(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var wa=Vd;const Ql={kind:"null"},en={kind:"number"},Ln={kind:"string"},ti={kind:"boolean"},$o={kind:"color"},bs={kind:"object"},ci={kind:"value"},mo={kind:"collator"},bl={kind:"formatted"},Ea={kind:"resolvedImage"};function xs(o,t){return{kind:"array",itemType:o,N:t}}function or(o){if("array"===o.kind){const t=or(o.itemType);return"number"==typeof o.N?`array<${t}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${t}>`}return o.kind}const ss=[Ql,en,Ln,ti,$o,bl,bs,xs(ci),Ea];function ye(o,t){if("error"===t.kind)return null;if("array"===o.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!ye(o.itemType,t.itemType))&&("number"!=typeof o.N||o.N===t.N))return null}else{if(o.kind===t.kind)return null;if("value"===o.kind)for(const a of ss)if(!ye(a,t))return null}return`Expected ${or(o)} but found ${or(t)} instead.`}function at(o,t){return t.some(a=>a.kind===o.kind)}function Dt(o,t){return t.some(a=>"null"===a?null===o:"array"===a?Array.isArray(o):"object"===a?o&&!Array.isArray(o)&&"object"==typeof o:a===typeof o)}var We,zt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function nn(o){return(o=Math.round(o))<0?0:o>255?255:o}function Zn(o){return nn("%"===o[o.length-1]?parseFloat(o)/100*255:parseInt(o))}function dr(o){return(t="%"===o[o.length-1]?parseFloat(o)/100:parseFloat(o))<0?0:t>1?1:t;var t}function Yi(o,t,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?o+(t-o)*a*6:2*a<1?t:3*a<2?o+(t-o)*(2/3-a)*6:o}try{We={}.parseCSSColor=function(o){var t,a=o.replace(/ /g,"").toLowerCase();if(a in zt)return zt[a].slice();if("#"===a[0])return 4===a.length?(t=parseInt(a.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===a.length&&(t=parseInt(a.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var u=a.indexOf("("),m=a.indexOf(")");if(-1!==u&&m+1===a.length){var y=a.substr(0,u),w=a.substr(u+1,m-(u+1)).split(","),T=1;switch(y){case"rgba":if(4!==w.length)return null;T=dr(w.pop());case"rgb":return 3!==w.length?null:[Zn(w[0]),Zn(w[1]),Zn(w[2]),T];case"hsla":if(4!==w.length)return null;T=dr(w.pop());case"hsl":if(3!==w.length)return null;var I=(parseFloat(w[0])%360+360)%360/360,P=dr(w[1]),N=dr(w[2]),z=N<=.5?N*(P+1):N+P-N*P,U=2*N-z;return[nn(255*Yi(U,z,I+1/3)),nn(255*Yi(U,z,I)),nn(255*Yi(U,z,I-1/3)),T];default:return null}}return null}}catch{}class Tn{constructor(t,a,u,m=1){this.r=t,this.g=a,this.b=u,this.a=m}static parse(t){if(!t)return;if(t instanceof Tn)return t;if("string"!=typeof t)return;const a=We(t);return a?new Tn(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[t,a,u,m]=this.toArray();return`rgba(${Math.round(t)},${Math.round(a)},${Math.round(u)},${m})`}toArray(){const{r:t,g:a,b:u,a:m}=this;return 0===m?[0,0,0,0]:[255*t/m,255*a/m,255*u/m,m]}toArray01(){const{r:t,g:a,b:u,a:m}=this;return 0===m?[0,0,0,0]:[t/m,a/m,u/m,m]}toArray01PremultipliedAlpha(){const{r:t,g:a,b:u,a:m}=this;return[t,a,u,m]}}Tn.black=new Tn(0,0,0,1),Tn.white=new Tn(1,1,1,1),Tn.transparent=new Tn(0,0,0,0),Tn.red=new Tn(1,0,0,1),Tn.blue=new Tn(0,0,1,1);var wn=Tn;class Gi{constructor(t,a,u){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,a){return this.collator.compare(t,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class as{constructor(t,a,u,m,y){this.text=t.normalize?t.normalize():t,this.image=a,this.scale=u,this.fontStack=m,this.textColor=y}}class Xi{constructor(t){this.sections=t}static fromString(t){return new Xi([new as(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof Xi?t:Xi.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const a of this.sections){if(a.image){t.push(["image",a.image.name]);continue}t.push(a.text);const u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toArray())),t.push(u)}return t}}class Mo{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Mo({name:t,available:!1}):null}serialize(){return["image",this.name]}}function df(o,t,a,u){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[o,t,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[o,t,a,u]:[o,t,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function xl(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof wn||o instanceof Gi||o instanceof Xi||o instanceof Mo)return!0;if(Array.isArray(o)){for(const t of o)if(!xl(t))return!1;return!0}if("object"==typeof o){for(const t in o)if(!xl(o[t]))return!1;return!0}return!1}function Dr(o){if(null===o)return Ql;if("string"==typeof o)return Ln;if("boolean"==typeof o)return ti;if("number"==typeof o)return en;if(o instanceof wn)return $o;if(o instanceof Gi)return mo;if(o instanceof Xi)return bl;if(o instanceof Mo)return Ea;if(Array.isArray(o)){const t=o.length;let a;for(const u of o){const m=Dr(u);if(a){if(a===m)continue;a=ci;break}a=m}return xs(a||ci,t)}return bs}function Lu(o){const t=typeof o;return null===o?"":"string"===t||"number"===t||"boolean"===t?String(o):o instanceof wn||o instanceof Xi||o instanceof Mo?o.toString():JSON.stringify(o)}class vr{constructor(t,a){this.type=t,this.value=a}static parse(t,a){if(2!==t.length)return a.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!xl(t[1]))return a.error("invalid value");const u=t[1];let m=Dr(u);const y=a.expectedType;return"array"!==m.kind||0!==m.N||!y||"array"!==y.kind||"number"==typeof y.N&&0!==y.N||(m=y),new vr(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof wn?["rgba"].concat(this.value.toArray()):this.value instanceof Xi?this.value.serialize():this.value}}var cn=vr,In=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const hr={string:Ln,number:en,boolean:ti,object:bs};class Ho{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");let u,m=1;const y=t[0];if("array"===y){let T,I;if(t.length>2){const P=t[1];if("string"!=typeof P||!(P in hr)||"object"===P)return a.error('The item type argument of "array" must be one of string, number, boolean',1);T=hr[P],m++}else T=ci;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);I=t[2],m++}u=xs(T,I)}else u=hr[y];const w=[];for(;m<t.length;m++){const T=a.parse(t[m],m,ci);if(!T)return null;w.push(T)}return new Ho(u,w)}evaluate(t){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(t);if(!ye(this.type,Dr(u)))return u;if(a===this.args.length-1)throw new In(`Expected value to be of type ${or(this.type)}, but found ${or(Dr(u))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,a=[t.kind];if("array"===t.kind){const u=t.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){a.push(u.kind);const m=t.N;("number"==typeof m||this.args.length>1)&&a.push(m)}}return a.concat(this.args.map(u=>u.serialize()))}}var Go=Ho;class Ar{constructor(t){this.type=bl,this.sections=t}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const u=t[1];if(!Array.isArray(u)&&"object"==typeof u)return a.error("First argument must be an image or text section.");const m=[];let y=!1;for(let w=1;w<=t.length-1;++w){const T=t[w];if(y&&"object"==typeof T&&!Array.isArray(T)){y=!1;let I=null;if(T["font-scale"]&&(I=a.parse(T["font-scale"],1,en),!I))return null;let P=null;if(T["text-font"]&&(P=a.parse(T["text-font"],1,xs(Ln)),!P))return null;let N=null;if(T["text-color"]&&(N=a.parse(T["text-color"],1,$o),!N))return null;const z=m[m.length-1];z.scale=I,z.font=P,z.textColor=N}else{const I=a.parse(t[w],1,ci);if(!I)return null;const P=I.type.kind;if("string"!==P&&"value"!==P&&"null"!==P&&"resolvedImage"!==P)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,m.push({content:I,scale:null,font:null,textColor:null})}}return new Ar(m)}evaluate(t){return new Xi(this.sections.map(a=>{const u=a.content.evaluate(t);return Dr(u)===Ea?new as("",u,null,null,null):new as(Lu(u),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))}eachChild(t){for(const a of this.sections)t(a.content),a.scale&&t(a.scale),a.font&&t(a.font),a.textColor&&t(a.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const a of this.sections){t.push(a.content.serialize());const u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),t.push(u)}return t}}class wl{constructor(t){this.type=Ea,this.input=t}static parse(t,a){if(2!==t.length)return a.error("Expected two arguments.");const u=a.parse(t[1],1,Ln);return u?new wl(u):a.error("No image name provided.")}evaluate(t){const a=this.input.evaluate(t),u=Mo.fromString(a);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(a)>-1),u}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const br={"to-boolean":ti,"to-color":$o,"to-number":en,"to-string":Ln};class aa{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const u=t[0];if(("to-boolean"===u||"to-string"===u)&&2!==t.length)return a.error("Expected one argument.");const m=br[u],y=[];for(let w=1;w<t.length;w++){const T=a.parse(t[w],w,ci);if(!T)return null;y.push(T)}return new aa(m,y)}evaluate(t){if("boolean"===this.type.kind)return!!this.args[0].evaluate(t);if("color"===this.type.kind){let a,u;for(const m of this.args){if(a=m.evaluate(t),u=null,a instanceof wn)return a;if("string"==typeof a){const y=t.parseColor(a);if(y)return y}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:df(a[0],a[1],a[2],a[3]),!u))return new wn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new In(u||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const u of this.args){if(a=u.evaluate(t),null===a)return 0;const m=Number(a);if(!isNaN(m))return m}throw new In(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?Xi.fromString(Lu(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Mo.fromString(Lu(this.args[0].evaluate(t))):Lu(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ar([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new wl(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(a=>{t.push(a.serialize())}),t}}var la=aa;const Un=["Unknown","Point","LineString","Polygon"];var ec=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Un[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*t-o[0])+this.featureDistanceData.bearing[1]*(u*t-o[1])}return 0}parseColor(o){let t=this._parseColorCache[o];return t||(t=this._parseColorCache[o]=wn.parse(o)),t}};class El{constructor(t,a,u,m){this.name=t,this.type=a,this._evaluate=u,this.args=m}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,a){const u=t[0],m=El.definitions[u];if(!m)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(m)?m[0]:m.type,w=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,T=w.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let I=null;for(const[P,N]of T){I=new Hs(a.registry,a.path,null,a.scope);const z=[];let U=!1;for(let G=1;G<t.length;G++){const q=t[G],J=Array.isArray(P)?P[G-1]:P.type,re=I.parse(q,1+z.length,J);if(!re){U=!0;break}z.push(re)}if(!U)if(Array.isArray(P)&&P.length!==z.length)I.error(`Expected ${P.length} arguments, but found ${z.length} instead.`);else{for(let G=0;G<z.length;G++){const q=Array.isArray(P)?P[G]:P.type,J=z[G];I.concat(G+1).checkSubtype(q,J.type)}if(0===I.errors.length)return new El(u,y,N,z)}}if(1===T.length)a.errors.push(...I.errors);else{const P=(T.length?T:w).map(([z])=>{return U=z,Array.isArray(U)?`(${U.map(or).join(", ")})`:`(${or(U.type)}...)`;var U}).join(" | "),N=[];for(let z=1;z<t.length;z++){const U=a.parse(t[z],1+N.length);if(!U)return null;N.push(or(U.type))}a.error(`Expected arguments of type ${P}, but found (${N.join(", ")}) instead.`)}return null}static register(t,a){El.definitions=a;for(const u in a)t[u]=El}}var Zo=El;class Tr{constructor(t,a,u){this.type=mo,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=a}static parse(t,a){if(2!==t.length)return a.error("Expected one argument.");const u=t[1];if("object"!=typeof u||Array.isArray(u))return a.error("Collator options argument must be an object.");const m=a.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,ti);if(!m)return null;const y=a.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,ti);if(!y)return null;let w=null;return u.locale&&(w=a.parse(u.locale,1,Ln),!w)?null:new Tr(m,y,w)}evaluate(t){return new Gi(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const js=8192;function Cl(o,t){o[0]=Math.min(o[0],t[0]),o[1]=Math.min(o[1],t[1]),o[2]=Math.max(o[2],t[0]),o[3]=Math.max(o[3],t[1])}function Wo(o,t){return!(o[0]<=t[0]||o[2]>=t[2]||o[1]<=t[1]||o[3]>=t[3])}function Wa(o,t){const a=(180+o[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,m=Math.pow(2,t.z);return[Math.round(a*m*js),Math.round(u*m*js)]}function hf(o,t,a){const u=o[0]-t[0],m=o[1]-t[1],y=o[0]-a[0],w=o[1]-a[1];return u*w-y*m==0&&u*y<=0&&m*w<=0}function Ca(o,t){let a=!1;for(let w=0,T=t.length;w<T;w++){const I=t[w];for(let P=0,N=I.length;P<N-1;P++){if(hf(o,I[P],I[P+1]))return!1;(m=I[P])[1]>(u=o)[1]!=(y=I[P+1])[1]>u[1]&&u[0]<(y[0]-m[0])*(u[1]-m[1])/(y[1]-m[1])+m[0]&&(a=!a)}}var u,m,y;return a}function $s(o,t){for(let a=0;a<t.length;a++)if(Ca(o,t[a]))return!0;return!1}function Nu(o,t,a,u){const m=u[0]-a[0],y=u[1]-a[1],w=(o[0]-a[0])*y-m*(o[1]-a[1]),T=(t[0]-a[0])*y-m*(t[1]-a[1]);return w>0&&T<0||w<0&&T>0}function ca(o,t,a){for(const P of a)for(let N=0;N<P.length-1;++N)if((T=[(w=P[N+1])[0]-(y=P[N])[0],w[1]-y[1]])[0]*(I=[(m=t)[0]-(u=o)[0],m[1]-u[1]])[1]-T[1]*I[0]!=0&&Nu(u,m,y,w)&&Nu(y,w,u,m))return!0;var u,m,y,w,T,I;return!1}function vn(o,t){for(let a=0;a<o.length;++a)if(!Ca(o[a],t))return!1;for(let a=0;a<o.length-1;++a)if(ca(o[a],o[a+1],t))return!1;return!0}function ky(o,t){for(let a=0;a<t.length;a++)if(vn(o,t[a]))return!0;return!1}function Bu(o,t,a){const u=[];for(let m=0;m<o.length;m++){const y=[];for(let w=0;w<o[m].length;w++){const T=Wa(o[m][w],a);Cl(t,T),y.push(T)}u.push(y)}return u}function ff(o,t,a){const u=[];for(let m=0;m<o.length;m++){const y=Bu(o[m],t,a);u.push(y)}return u}function qo(o,t,a,u){if(o[0]<a[0]||o[0]>a[2]){const m=.5*u;let y=o[0]-a[0]>m?-u:a[0]-o[0]>m?u:0;0===y&&(y=o[0]-a[2]>m?-u:a[2]-o[0]>m?u:0),o[0]+=y}Cl(t,o)}function zu(o,t,a,u){const m=Math.pow(2,u.z)*js,y=[u.x*js,u.y*js],w=[];if(!o)return w;for(const T of o)for(const I of T){const P=[I.x+y[0],I.y+y[1]];qo(P,t,a,m),w.push(P)}return w}function tc(o,t,a,u){const m=Math.pow(2,u.z)*js,y=[u.x*js,u.y*js],w=[];if(!o)return w;for(const I of o){const P=[];for(const N of I){const z=[N.x+y[0],N.y+y[1]];Cl(t,z),P.push(z)}w.push(P)}if(t[2]-t[0]<=m/2){(T=t)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const I of w)for(const P of I)qo(P,t,a,m)}var T;return w}class Ta{constructor(t,a){this.type=ti,this.geojson=t,this.geometries=a}static parse(t,a){if(2!==t.length)return a.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(xl(t[1])){const u=t[1];if("FeatureCollection"===u.type)for(let m=0;m<u.features.length;++m){const y=u.features[m].geometry.type;if("Polygon"===y||"MultiPolygon"===y)return new Ta(u,u.features[m].geometry)}else if("Feature"===u.type){const m=u.geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new Ta(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new Ta(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(a,u){const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],w=a.canonicalID();if(!w)return!1;if("Polygon"===u.type){const T=Bu(u.coordinates,y,w),I=zu(a.geometry(),m,y,w);if(!Wo(m,y))return!1;for(const P of I)if(!Ca(P,T))return!1}if("MultiPolygon"===u.type){const T=ff(u.coordinates,y,w),I=zu(a.geometry(),m,y,w);if(!Wo(m,y))return!1;for(const P of I)if(!$s(P,T))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(a,u){const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],w=a.canonicalID();if(!w)return!1;if("Polygon"===u.type){const T=Bu(u.coordinates,y,w),I=tc(a.geometry(),m,y,w);if(!Wo(m,y))return!1;for(const P of I)if(!vn(P,T))return!1}if("MultiPolygon"===u.type){const T=ff(u.coordinates,y,w),I=tc(a.geometry(),m,y,w);if(!Wo(m,y))return!1;for(const P of I)if(!ky(P,T))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Gr=Ta;function Ud(o){if(o instanceof Zo&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof Gr)return!1;let t=!0;return o.eachChild(a=>{t&&!Ud(a)&&(t=!1)}),t}function Nr(o){if(o instanceof Zo&&"feature-state"===o.name)return!1;let t=!0;return o.eachChild(a=>{t&&!Nr(a)&&(t=!1)}),t}function Br(o,t){if(o instanceof Zo&&t.indexOf(o.name)>=0)return!1;let a=!0;return o.eachChild(u=>{a&&!Br(u,t)&&(a=!1)}),a}class kc{constructor(t,a){this.type=a.type,this.name=t,this.boundExpression=a}static parse(t,a){if(2!==t.length||"string"!=typeof t[1])return a.error("'var' expression requires exactly one string literal argument.");const u=t[1];return a.scope.has(u)?new kc(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Tl=kc;class nc{constructor(t,a=[],u,m=new wa,y=[]){this.registry=t,this.path=a,this.key=a.map(w=>`[${w}]`).join(""),this.scope=m,this.errors=y,this.expectedType=u}parse(t,a,u,m,y={}){return a?this.concat(a,u,m)._parse(t,y):this._parse(t,y)}_parse(t,a){function u(m,y,w){return"assert"===w?new Go(y,[m]):"coerce"===w?new la(y,[m]):m}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=t[0];if("string"!=typeof m)return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[m];if(y){let w=y.parse(t,this);if(!w)return null;if(this.expectedType){const T=this.expectedType,I=w.type;if("string"!==T.kind&&"number"!==T.kind&&"boolean"!==T.kind&&"object"!==T.kind&&"array"!==T.kind||"value"!==I.kind)if("color"!==T.kind&&"formatted"!==T.kind&&"resolvedImage"!==T.kind||"value"!==I.kind&&"string"!==I.kind){if(this.checkSubtype(T,I))return null}else w=u(w,T,a.typeAnnotation||"coerce");else w=u(w,T,a.typeAnnotation||"assert")}if(!(w instanceof cn)&&"resolvedImage"!==w.type.kind&&Vu(w)){const T=new ec;try{w=new cn(w.type,w.evaluate(T))}catch(I){return this.error(I.message),null}}return w}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,a,u){const m="number"==typeof t?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new nc(this.registry,m,a||null,y,this.errors)}error(t,...a){const u=`${this.key}${a.map(m=>`[${m}]`).join("")}`;this.errors.push(new jo(u,t))}checkSubtype(t,a){const u=ye(t,a);return u&&this.error(u),u}}var Hs=nc;function Vu(o){if(o instanceof Tl)return Vu(o.boundExpression);if(o instanceof Zo&&"error"===o.name||o instanceof Tr||o instanceof Gr)return!1;const t=o instanceof la||o instanceof Go;let a=!0;return o.eachChild(u=>{a=t?a&&Vu(u):a&&u instanceof cn}),!!a&&Ud(o)&&Br(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function jd(o,t){const a=o.length-1;let u,m,y=0,w=a,T=0;for(;y<=w;)if(T=Math.floor((y+w)/2),u=o[T],m=o[T+1],u<=t){if(T===a||t<m)return T;y=T+1}else{if(!(u>t))throw new In("Input is not a number.");w=T-1}return 0}class $d{constructor(t,a,u){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(const[m,y]of u)this.labels.push(m),this.outputs.push(y)}static parse(t,a){if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(t[1],1,en);if(!u)return null;const m=[];let y=null;a.expectedType&&"value"!==a.expectedType.kind&&(y=a.expectedType);for(let w=1;w<t.length;w+=2){const T=1===w?-1/0:t[w],I=t[w+1],P=w,N=w+1;if("number"!=typeof T)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(m.length&&m[m.length-1][0]>=T)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const z=a.parse(I,N,y);if(!z)return null;y=y||z.type,m.push([T,z])}return new $d(y,u,m)}evaluate(t){const a=this.labels,u=this.outputs;if(1===a.length)return u[0].evaluate(t);const m=this.input.evaluate(t);if(m<=a[0])return u[0].evaluate(t);const y=a.length;return m>=a[y-1]?u[y-1].evaluate(t):u[jd(a,m)].evaluate(t)}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&t.push(this.labels[a]),t.push(this.outputs[a].serialize());return t}}var Pg=$d;function Ti(o,t,a){return o*(1-a)+t*a}var Uu=Object.freeze({__proto__:null,array:function(o,t,a){return o.map((u,m)=>Ti(u,t[m],a))},color:function(o,t,a){return new wn(Ti(o.r,t.r,a),Ti(o.g,t.g,a),Ti(o.b,t.b,a),Ti(o.a,t.a,a))},number:Ti});const Fy=4/29,ju=6/29,Sr=3*ju*ju,W0=ju*ju*ju,q0=Math.PI/180,Y0=180/Math.PI;function Rg(o){return o>W0?Math.pow(o,1/3):o/Sr+Fy}function kg(o){return o>ju?o*o*o:Sr*(o-Fy)}function Fg(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Gp(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function pf(o){const t=Gp(o.r),a=Gp(o.g),u=Gp(o.b),m=Rg((.4124564*t+.3575761*a+.1804375*u)/.95047),y=Rg((.2126729*t+.7151522*a+.072175*u)/1);return{l:116*y-16,a:500*(m-y),b:200*(y-Rg((.0193339*t+.119192*a+.9503041*u)/1.08883)),alpha:o.a}}function Zp(o){let t=(o.l+16)/116,a=isNaN(o.a)?t:t+o.a/500,u=isNaN(o.b)?t:t-o.b/200;return t=1*kg(t),a=.95047*kg(a),u=1.08883*kg(u),new wn(Fg(3.2404542*a-1.5371385*t-.4985314*u),Fg(-.969266*a+1.8760108*t+.041556*u),Fg(.0556434*a-.2040259*t+1.0572252*u),o.alpha)}function X0(o,t,a){const u=t-o;return o+a*(u>180||u<-180?u-360*Math.round(u/360):u)}const mf={forward:pf,reverse:Zp,interpolate:function(o,t,a){return{l:Ti(o.l,t.l,a),a:Ti(o.a,t.a,a),b:Ti(o.b,t.b,a),alpha:Ti(o.alpha,t.alpha,a)}}},Fc={forward:function(o){const{l:t,a,b:u}=pf(o),m=Math.atan2(u,a)*Y0;return{h:m<0?m+360:m,c:Math.sqrt(a*a+u*u),l:t,alpha:o.a}},reverse:function(o){const t=o.h*q0,a=o.c;return Zp({l:o.l,a:Math.cos(t)*a,b:Math.sin(t)*a,alpha:o.alpha})},interpolate:function(o,t,a){return{h:X0(o.h,t.h,a),c:Ti(o.c,t.c,a),l:Ti(o.l,t.l,a),alpha:Ti(o.alpha,t.alpha,a)}}};var qa=Object.freeze({__proto__:null,hcl:Fc,lab:mf});class Lc{constructor(t,a,u,m,y){this.type=t,this.operator=a,this.interpolation=u,this.input=m,this.labels=[],this.outputs=[];for(const[w,T]of y)this.labels.push(w),this.outputs.push(T)}static interpolationFactor(t,a,u,m){let y=0;if("exponential"===t.name)y=Hd(a,t.base,u,m);else if("linear"===t.name)y=Hd(a,1,u,m);else if("cubic-bezier"===t.name){const w=t.controlPoints;y=new Sn(w[0],w[1],w[2],w[3]).solve(Hd(a,1,u,m))}return y}static parse(t,a){let[u,m,y,...w]=t;if(!Array.isArray(m)||0===m.length)return a.error("Expected an interpolation type expression.",1);if("linear"===m[0])m={name:"linear"};else if("exponential"===m[0]){const P=m[1];if("number"!=typeof P)return a.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:P}}else{if("cubic-bezier"!==m[0])return a.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const P=m.slice(1);if(4!==P.length||P.some(N=>"number"!=typeof N||N<0||N>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(y=a.parse(y,2,en),!y)return null;const T=[];let I=null;"interpolate-hcl"===u||"interpolate-lab"===u?I=$o:a.expectedType&&"value"!==a.expectedType.kind&&(I=a.expectedType);for(let P=0;P<w.length;P+=2){const N=w[P],z=w[P+1],U=P+3,G=P+4;if("number"!=typeof N)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(T.length&&T[T.length-1][0]>=N)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const q=a.parse(z,G,I);if(!q)return null;I=I||q.type,T.push([N,q])}return"number"===I.kind||"color"===I.kind||"array"===I.kind&&"number"===I.itemType.kind&&"number"==typeof I.N?new Lc(I,u,m,y,T):a.error(`Type ${or(I)} is not interpolatable.`)}evaluate(t){const a=this.labels,u=this.outputs;if(1===a.length)return u[0].evaluate(t);const m=this.input.evaluate(t);if(m<=a[0])return u[0].evaluate(t);const y=a.length;if(m>=a[y-1])return u[y-1].evaluate(t);const w=jd(a,m),T=Lc.interpolationFactor(this.interpolation,m,a[w],a[w+1]),I=u[w].evaluate(t),P=u[w+1].evaluate(t);return"interpolate"===this.operator?Uu[this.type.kind.toLowerCase()](I,P,T):"interpolate-hcl"===this.operator?Fc.reverse(Fc.interpolate(Fc.forward(I),Fc.forward(P),T)):mf.reverse(mf.interpolate(mf.forward(I),mf.forward(P),T))}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,t,this.input.serialize()];for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function Hd(o,t,a,u){const m=u-a,y=o-a;return 0===m?0:1===t?y/m:(Math.pow(t,y)-1)/(Math.pow(t,m)-1)}var Do=Lc;class Gd{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expectected at least one argument.");let u=null;const m=a.expectedType;m&&"value"!==m.kind&&(u=m);const y=[];for(const T of t.slice(1)){const I=a.parse(T,1+y.length,u,void 0,{typeAnnotation:"omit"});if(!I)return null;u=u||I.type,y.push(I)}const w=m&&y.some(T=>ye(m,T.type));return new Gd(w?ci:u,y)}evaluate(t){let a,u=null,m=0;for(const y of this.args){if(m++,u=y.evaluate(t),u&&u instanceof Mo&&!u.available&&(a||(a=u),u=null,m===this.args.length))return a;if(null!==u)break}return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(a=>{t.push(a.serialize())}),t}}var Wp=Gd;class $u{constructor(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const a of this.bindings)t(a[1]);t(this.result)}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const u=[];for(let y=1;y<t.length-1;y+=2){const w=t[y];if("string"!=typeof w)return a.error(`Expected string, but found ${typeof w} instead.`,y);if(/[^a-zA-Z0-9_]/.test(w))return a.error("Variable names must contain only alphanumeric characters or '_'.",y);const T=a.parse(t[y+1],y+1);if(!T)return null;u.push([w,T])}const m=a.parse(t[t.length-1],t.length-1,a.expectedType,u);return m?new $u(u,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[a,u]of this.bindings)t.push(a,u.serialize());return t.push(this.result.serialize()),t}}var gf=$u;class Lg{constructor(t,a,u){this.type=t,this.index=a,this.input=u}static parse(t,a){if(3!==t.length)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,en),m=a.parse(t[2],2,xs(a.expectedType||ci));return u&&m?new Lg(m.type.itemType,u,m):null}evaluate(t){const a=this.index.evaluate(t),u=this.input.evaluate(t);if(a<0)throw new In(`Array index out of bounds: ${a} < 0.`);if(a>=u.length)throw new In(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a!==Math.floor(a))throw new In(`Array index must be an integer, but found ${a} instead.`);return u[a]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ly=Lg;class Gs{constructor(t,a){this.type=ti,this.needle=t,this.haystack=a}static parse(t,a){if(3!==t.length)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,ci),m=a.parse(t[2],2,ci);return u&&m?at(u.type,[ti,Ln,en,Ql,ci])?new Gs(u,m):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${or(u.type)} instead`):null}evaluate(t){const a=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(null==u)return!1;if(!Dt(a,["boolean","string","number","null"]))throw new In(`Expected first argument to be of type boolean, string, number or null, but found ${or(Dr(a))} instead.`);if(!Dt(u,["string","array"]))throw new In(`Expected second argument to be of type array or string, but found ${or(Dr(u))} instead.`);return u.indexOf(a)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ml=Gs;class zr{constructor(t,a,u){this.type=en,this.needle=t,this.haystack=a,this.fromIndex=u}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,ci),m=a.parse(t[2],2,ci);if(!u||!m)return null;if(!at(u.type,[ti,Ln,en,Ql,ci]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${or(u.type)} instead`);if(4===t.length){const y=a.parse(t[3],3,en);return y?new zr(u,m,y):null}return new zr(u,m)}evaluate(t){const a=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Dt(a,["boolean","string","number","null"]))throw new In(`Expected first argument to be of type boolean, string, number or null, but found ${or(Dr(a))} instead.`);if(!Dt(u,["string","array"]))throw new In(`Expected second argument to be of type array or string, but found ${or(Dr(u))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(t);return u.indexOf(a,m)}return u.indexOf(a)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Zd=zr;class qp{constructor(t,a,u,m,y,w){this.inputType=t,this.type=a,this.input=u,this.cases=m,this.outputs=y,this.otherwise=w}static parse(t,a){if(t.length<5)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return a.error("Expected an even number of arguments.");let u,m;a.expectedType&&"value"!==a.expectedType.kind&&(m=a.expectedType);const y={},w=[];for(let P=2;P<t.length-1;P+=2){let N=t[P];const z=t[P+1];Array.isArray(N)||(N=[N]);const U=a.concat(P);if(0===N.length)return U.error("Expected at least one branch label.");for(const q of N){if("number"!=typeof q&&"string"!=typeof q)return U.error("Branch labels must be numbers or strings.");if("number"==typeof q&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof q&&Math.floor(q)!==q)return U.error("Numeric branch labels must be integer values.");if(u){if(U.checkSubtype(u,Dr(q)))return null}else u=Dr(q);if(void 0!==y[String(q)])return U.error("Branch labels must be unique.");y[String(q)]=w.length}const G=a.parse(z,P,m);if(!G)return null;m=m||G.type,w.push(G)}const T=a.parse(t[1],1,ci);if(!T)return null;const I=a.parse(t[t.length-1],t.length-1,m);return I?"value"!==T.type.kind&&a.concat(1).checkSubtype(u,T.type)?null:new qp(u,m,T,y,w,I):null}evaluate(t){const a=this.input.evaluate(t);return(Dr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],m={};for(const w of a){const T=m[this.cases[w]];void 0===T?(m[this.cases[w]]=u.length,u.push([this.cases[w],[w]])):u[T][1].push(w)}const y=w=>"number"===this.inputType.kind?Number(w):w;for(const[w,T]of u)t.push(1===T.length?y(T[0]):T.map(y)),t.push(this.outputs[w].serialize());return t.push(this.otherwise.serialize()),t}}var Yp=qp;class Wd{constructor(t,a,u){this.type=t,this.branches=a,this.otherwise=u}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&"value"!==a.expectedType.kind&&(u=a.expectedType);const m=[];for(let w=1;w<t.length-1;w+=2){const T=a.parse(t[w],w,ti);if(!T)return null;const I=a.parse(t[w+1],w+1,u);if(!I)return null;m.push([T,I]),u=u||I.type}const y=a.parse(t[t.length-1],t.length-1,u);return y?new Wd(u,m,y):null}evaluate(t){for(const[a,u]of this.branches)if(a.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[a,u]of this.branches)t(a),t(u);t(this.otherwise)}outputDefined(){return this.branches.every(([t,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(a=>{t.push(a.serialize())}),t}}var qd=Wd;class Yd{constructor(t,a,u,m){this.type=t,this.input=a,this.beginIndex=u,this.endIndex=m}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,ci),m=a.parse(t[2],2,en);if(!u||!m)return null;if(!at(u.type,[xs(ci),Ln,ci]))return a.error(`Expected first argument to be of type array or string, but found ${or(u.type)} instead`);if(4===t.length){const y=a.parse(t[3],3,en);return y?new Yd(u.type,u,m,y):null}return new Yd(u.type,u,m)}evaluate(t){const a=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Dt(a,["string","array"]))throw new In(`Expected first argument to be of type array or string, but found ${or(Dr(a))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(t);return a.slice(u,m)}return a.slice(u)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ng=Yd;function Hu(o,t){return"=="===o||"!="===o?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function _f(o,t,a,u){return 0===u.compare(t,a)}function Nc(o,t,a){const u="=="!==o&&"!="!==o;return class oI{constructor(y,w,T){this.type=ti,this.lhs=y,this.rhs=w,this.collator=T,this.hasUntypedArgument="value"===y.type.kind||"value"===w.type.kind}static parse(y,w){if(3!==y.length&&4!==y.length)return w.error("Expected two or three arguments.");const T=y[0];let I=w.parse(y[1],1,ci);if(!I)return null;if(!Hu(T,I.type))return w.concat(1).error(`"${T}" comparisons are not supported for type '${or(I.type)}'.`);let P=w.parse(y[2],2,ci);if(!P)return null;if(!Hu(T,P.type))return w.concat(2).error(`"${T}" comparisons are not supported for type '${or(P.type)}'.`);if(I.type.kind!==P.type.kind&&"value"!==I.type.kind&&"value"!==P.type.kind)return w.error(`Cannot compare types '${or(I.type)}' and '${or(P.type)}'.`);u&&("value"===I.type.kind&&"value"!==P.type.kind?I=new Go(P.type,[I]):"value"!==I.type.kind&&"value"===P.type.kind&&(P=new Go(I.type,[P])));let N=null;if(4===y.length){if("string"!==I.type.kind&&"string"!==P.type.kind&&"value"!==I.type.kind&&"value"!==P.type.kind)return w.error("Cannot use collator to compare non-string types.");if(N=w.parse(y[3],3,mo),!N)return null}return new oI(I,P,N)}evaluate(y){const w=this.lhs.evaluate(y),T=this.rhs.evaluate(y);if(u&&this.hasUntypedArgument){const I=Dr(w),P=Dr(T);if(I.kind!==P.kind||"string"!==I.kind&&"number"!==I.kind)throw new In(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${I.kind}, ${P.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const I=Dr(w),P=Dr(T);if("string"!==I.kind||"string"!==P.kind)return t(y,w,T)}return this.collator?a(y,w,T,this.collator.evaluate(y)):t(y,w,T)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[o];return this.eachChild(w=>{y.push(w.serialize())}),y}}}const Xd=Nc("==",function(o,t,a){return t===a},_f),Ny=Nc("!=",function(o,t,a){return t!==a},function(o,t,a,u){return!_f(0,t,a,u)}),By=Nc("<",function(o,t,a){return t<a},function(o,t,a,u){return u.compare(t,a)<0}),K0=Nc(">",function(o,t,a){return t>a},function(o,t,a,u){return u.compare(t,a)>0}),zy=Nc("<=",function(o,t,a){return t<=a},function(o,t,a,u){return u.compare(t,a)<=0}),Xp=Nc(">=",function(o,t,a){return t>=a},function(o,t,a,u){return u.compare(t,a)>=0});class yf{constructor(t,a,u,m,y,w){this.type=Ln,this.number=t,this.locale=a,this.currency=u,this.unit=m,this.minFractionDigits=y,this.maxFractionDigits=w}static parse(t,a){if(3!==t.length)return a.error("Expected two arguments.");const u=a.parse(t[1],1,en);if(!u)return null;const m=t[2];if("object"!=typeof m||Array.isArray(m))return a.error("NumberFormat options argument must be an object.");let y=null;if(m.locale&&(y=a.parse(m.locale,1,Ln),!y))return null;let w=null;if(m.currency&&(w=a.parse(m.currency,1,Ln),!w))return null;let T=null;if(m.unit&&(T=a.parse(m.unit,1,Ln),!T))return null;let I=null;if(m["min-fraction-digits"]&&(I=a.parse(m["min-fraction-digits"],1,en),!I))return null;let P=null;return m["max-fraction-digits"]&&(P=a.parse(m["max-fraction-digits"],1,en),!P)?null:new yf(u,y,w,T,I,P)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Gu{constructor(t){this.type=en,this.input=t}static parse(t,a){if(2!==t.length)return a.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=a.parse(t[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?a.error(`Expected argument of type string or array, but found ${or(u.type)} instead.`):new Gu(u):null}evaluate(t){const a=this.input.evaluate(t);if("string"==typeof a||Array.isArray(a))return a.length;throw new In(`Expected value to be of type string or array, but found ${or(Dr(a))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(a=>{t.push(a.serialize())}),t}}const vf={"==":Xd,"!=":Ny,">":K0,"<":By,">=":Xp,"<=":zy,array:Go,at:Ly,boolean:Go,case:qd,coalesce:Wp,collator:Tr,format:Ar,image:wl,in:Ml,"index-of":Zd,interpolate:Do,"interpolate-hcl":Do,"interpolate-lab":Do,length:Gu,let:gf,literal:cn,match:Yp,number:Go,"number-format":yf,object:Go,slice:Ng,step:Pg,string:Go,"to-boolean":la,"to-color":la,"to-number":la,"to-string":la,var:Tl,within:Gr};function Kp(o,[t,a,u,m]){t=t.evaluate(o),a=a.evaluate(o),u=u.evaluate(o);const y=m?m.evaluate(o):1,w=df(t,a,u,y);if(w)throw new In(w);return new wn(t/255*y,a/255*y,u/255*y,y)}function Dl(o,t){return o in t}function ic(o,t){const a=t[o];return void 0===a?null:a}function Zs(o){return{type:o}}Zo.register(vf,{error:[{kind:"error"},[Ln],(o,[t])=>{throw new In(t.evaluate(o))}],typeof:[Ln,[ci],(o,[t])=>or(Dr(t.evaluate(o)))],"to-rgba":[xs(en,4),[$o],(o,[t])=>t.evaluate(o).toArray()],rgb:[$o,[en,en,en],Kp],rgba:[$o,[en,en,en,en],Kp],has:{type:ti,overloads:[[[Ln],(o,[t])=>Dl(t.evaluate(o),o.properties())],[[Ln,bs],(o,[t,a])=>Dl(t.evaluate(o),a.evaluate(o))]]},get:{type:ci,overloads:[[[Ln],(o,[t])=>ic(t.evaluate(o),o.properties())],[[Ln,bs],(o,[t,a])=>ic(t.evaluate(o),a.evaluate(o))]]},"feature-state":[ci,[Ln],(o,[t])=>ic(t.evaluate(o),o.featureState||{})],properties:[bs,[],o=>o.properties()],"geometry-type":[Ln,[],o=>o.geometryType()],id:[ci,[],o=>o.id()],zoom:[en,[],o=>o.globals.zoom],pitch:[en,[],o=>o.globals.pitch||0],"distance-from-center":[en,[],o=>o.distanceFromCenter()],"heatmap-density":[en,[],o=>o.globals.heatmapDensity||0],"line-progress":[en,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[en,[],o=>o.globals.skyRadialProgress||0],accumulated:[ci,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[en,Zs(en),(o,t)=>{let a=0;for(const u of t)a+=u.evaluate(o);return a}],"*":[en,Zs(en),(o,t)=>{let a=1;for(const u of t)a*=u.evaluate(o);return a}],"-":{type:en,overloads:[[[en,en],(o,[t,a])=>t.evaluate(o)-a.evaluate(o)],[[en],(o,[t])=>-t.evaluate(o)]]},"/":[en,[en,en],(o,[t,a])=>t.evaluate(o)/a.evaluate(o)],"%":[en,[en,en],(o,[t,a])=>t.evaluate(o)%a.evaluate(o)],ln2:[en,[],()=>Math.LN2],pi:[en,[],()=>Math.PI],e:[en,[],()=>Math.E],"^":[en,[en,en],(o,[t,a])=>Math.pow(t.evaluate(o),a.evaluate(o))],sqrt:[en,[en],(o,[t])=>Math.sqrt(t.evaluate(o))],log10:[en,[en],(o,[t])=>Math.log(t.evaluate(o))/Math.LN10],ln:[en,[en],(o,[t])=>Math.log(t.evaluate(o))],log2:[en,[en],(o,[t])=>Math.log(t.evaluate(o))/Math.LN2],sin:[en,[en],(o,[t])=>Math.sin(t.evaluate(o))],cos:[en,[en],(o,[t])=>Math.cos(t.evaluate(o))],tan:[en,[en],(o,[t])=>Math.tan(t.evaluate(o))],asin:[en,[en],(o,[t])=>Math.asin(t.evaluate(o))],acos:[en,[en],(o,[t])=>Math.acos(t.evaluate(o))],atan:[en,[en],(o,[t])=>Math.atan(t.evaluate(o))],min:[en,Zs(en),(o,t)=>Math.min(...t.map(a=>a.evaluate(o)))],max:[en,Zs(en),(o,t)=>Math.max(...t.map(a=>a.evaluate(o)))],abs:[en,[en],(o,[t])=>Math.abs(t.evaluate(o))],round:[en,[en],(o,[t])=>{const a=t.evaluate(o);return a<0?-Math.round(-a):Math.round(a)}],floor:[en,[en],(o,[t])=>Math.floor(t.evaluate(o))],ceil:[en,[en],(o,[t])=>Math.ceil(t.evaluate(o))],"filter-==":[ti,[Ln,ci],(o,[t,a])=>o.properties()[t.value]===a.value],"filter-id-==":[ti,[ci],(o,[t])=>o.id()===t.value],"filter-type-==":[ti,[Ln],(o,[t])=>o.geometryType()===t.value],"filter-<":[ti,[Ln,ci],(o,[t,a])=>{const u=o.properties()[t.value],m=a.value;return typeof u==typeof m&&u<m}],"filter-id-<":[ti,[ci],(o,[t])=>{const a=o.id(),u=t.value;return typeof a==typeof u&&a<u}],"filter->":[ti,[Ln,ci],(o,[t,a])=>{const u=o.properties()[t.value],m=a.value;return typeof u==typeof m&&u>m}],"filter-id->":[ti,[ci],(o,[t])=>{const a=o.id(),u=t.value;return typeof a==typeof u&&a>u}],"filter-<=":[ti,[Ln,ci],(o,[t,a])=>{const u=o.properties()[t.value],m=a.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[ti,[ci],(o,[t])=>{const a=o.id(),u=t.value;return typeof a==typeof u&&a<=u}],"filter->=":[ti,[Ln,ci],(o,[t,a])=>{const u=o.properties()[t.value],m=a.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[ti,[ci],(o,[t])=>{const a=o.id(),u=t.value;return typeof a==typeof u&&a>=u}],"filter-has":[ti,[ci],(o,[t])=>t.value in o.properties()],"filter-has-id":[ti,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[ti,[xs(Ln)],(o,[t])=>t.value.indexOf(o.geometryType())>=0],"filter-id-in":[ti,[xs(ci)],(o,[t])=>t.value.indexOf(o.id())>=0],"filter-in-small":[ti,[Ln,xs(ci)],(o,[t,a])=>a.value.indexOf(o.properties()[t.value])>=0],"filter-in-large":[ti,[Ln,xs(ci)],(o,[t,a])=>function(u,m,y,w){for(;y<=w;){const T=y+w>>1;if(m[T]===u)return!0;m[T]>u?w=T-1:y=T+1}return!1}(o.properties()[t.value],a.value,0,a.value.length-1)],all:{type:ti,overloads:[[[ti,ti],(o,[t,a])=>t.evaluate(o)&&a.evaluate(o)],[Zs(ti),(o,t)=>{for(const a of t)if(!a.evaluate(o))return!1;return!0}]]},any:{type:ti,overloads:[[[ti,ti],(o,[t,a])=>t.evaluate(o)||a.evaluate(o)],[Zs(ti),(o,t)=>{for(const a of t)if(a.evaluate(o))return!0;return!1}]]},"!":[ti,[ti],(o,[t])=>!t.evaluate(o)],"is-supported-script":[ti,[Ln],(o,[t])=>{const a=o.globals&&o.globals.isSupportedScript;return!a||a(t.evaluate(o))}],upcase:[Ln,[Ln],(o,[t])=>t.evaluate(o).toUpperCase()],downcase:[Ln,[Ln],(o,[t])=>t.evaluate(o).toLowerCase()],concat:[Ln,Zs(ci),(o,t)=>t.map(a=>Lu(a.evaluate(o))).join("")],"resolved-locale":[Ln,[mo],(o,[t])=>t.evaluate(o).resolvedLocale()]});var Bc=vf;function Kd(o){return{result:"success",value:o}}function ws(o){return{result:"error",value:o}}function zc(o){return"data-driven"===o["property-type"]}function So(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Zu(o){return!!o.expression&&o.expression.interpolated}function xi(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function Zi(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function Vc(o){return o}function Sl(o,t){const a="color"===t.type,u=o.stops&&"object"==typeof o.stops[0][0],m=u||!(u||void 0!==o.property),y=o.type||(Zu(t)?"exponential":"interval");if(a&&((o=Us({},o)).stops&&(o.stops=o.stops.map(P=>[P[0],wn.parse(P[1])])),o.default=wn.parse(o.default?o.default:t.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!qa[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let w,T,I;if("exponential"===y)w=Io;else if("interval"===y)w=Uc;else if("categorical"===y){w=Jd,T=Object.create(null);for(const P of o.stops)T[P[0]]=P[1];I=typeof o.stops[0][0]}else{if("identity"!==y)throw new Error(`Unknown function type "${y}"`);w=Ao}if(u){const P={},N=[];for(let G=0;G<o.stops.length;G++){const q=o.stops[G],J=q[0].zoom;void 0===P[J]&&(P[J]={zoom:J,type:o.type,property:o.property,default:o.default,stops:[]},N.push(J)),P[J].stops.push([q[0].value,q[1]])}const z=[];for(const G of N)z.push([P[G].zoom,Sl(P[G],t)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:Do.interpolationFactor.bind(void 0,U),zoomStops:z.map(G=>G[0]),evaluate:({zoom:G},q)=>Io({stops:z,base:o.base},t,G).evaluate(G,q)}}if(m){const P="exponential"===y?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Do.interpolationFactor.bind(void 0,P),zoomStops:o.stops.map(N=>N[0]),evaluate:({zoom:N})=>w(o,t,N,T,I)}}return{kind:"source",evaluate(P,N){const z=N&&N.properties?N.properties[o.property]:void 0;return void 0===z?Zr(o.default,t.default):w(o,t,z,T,I)}}}function Zr(o,t,a){return void 0!==o?o:void 0!==t?t:void 0!==a?a:void 0}function Jd(o,t,a,u,m){return Zr(typeof a===m?u[a]:void 0,o.default,t.default)}function Uc(o,t,a){if("number"!==xi(a))return Zr(o.default,t.default);const u=o.stops.length;if(1===u||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[u-1][0])return o.stops[u-1][1];const m=jd(o.stops.map(y=>y[0]),a);return o.stops[m][1]}function Io(o,t,a){const u=void 0!==o.base?o.base:1;if("number"!==xi(a))return Zr(o.default,t.default);const m=o.stops.length;if(1===m||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[m-1][0])return o.stops[m-1][1];const y=jd(o.stops.map(N=>N[0]),a),w=function(N,z,U,G){const q=G-U,J=N-U;return 0===q?0:1===z?J/q:(Math.pow(z,J)-1)/(Math.pow(z,q)-1)}(a,u,o.stops[y][0],o.stops[y+1][0]),T=o.stops[y][1],I=o.stops[y+1][1];let P=Uu[t.type]||Vc;if(o.colorSpace&&"rgb"!==o.colorSpace){const N=qa[o.colorSpace];P=(z,U)=>N.reverse(N.interpolate(N.forward(z),N.forward(U),w))}return"function"==typeof T.evaluate?{evaluate(...N){const z=T.evaluate.apply(void 0,N),U=I.evaluate.apply(void 0,N);if(void 0!==z&&void 0!==U)return P(z,U,w)}}:P(T,I,w)}function Ao(o,t,a){return"color"===t.type?a=wn.parse(a):"formatted"===t.type?a=Xi.fromString(a.toString()):"resolvedImage"===t.type?a=Mo.fromString(a.toString()):xi(a)===t.type||"enum"===t.type&&t.values[a]||(a=void 0),Zr(a,o.default,t.default)}class Wu{constructor(t,a){var u;this.expression=t,this._warningHistory={},this._evaluator=new ec,this._defaultValue=a?"color"===(u=a).type&&(Zi(u.default)||Array.isArray(u.default))?new wn(0,0,0,0):"color"===u.type?wn.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(t,a,u,m,y,w,T,I){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=m||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=w,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=I||null,this.expression.evaluate(this._evaluator)}evaluate(t,a,u,m,y,w,T,I){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=w||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=I||null;try{const P=this.expression.evaluate(this._evaluator);if(null==P||"number"==typeof P&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new In(`Expected value to be one of ${Object.keys(this._enumValues).map(N=>JSON.stringify(N)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(P.message)),this._defaultValue}}}function jc(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in Bc}function $c(o,t){const a=new Hs(Bc,[],t?function(m){const y={color:$o,string:Ln,number:en,enum:Ln,boolean:ti,formatted:bl,resolvedImage:Ea};return"array"===m.type?xs(y[m.value]||ci,m.length):y[m.type]}(t):void 0),u=a.parse(o,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return u?Kd(new Wu(u,t)):ws(a.errors)}class Ma{constructor(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent="constant"!==t&&!Nr(a.expression)}evaluateWithoutErrorHandling(t,a,u,m,y,w){return this._styleExpression.evaluateWithoutErrorHandling(t,a,u,m,y,w)}evaluate(t,a,u,m,y,w){return this._styleExpression.evaluate(t,a,u,m,y,w)}}class Hc{constructor(t,a,u,m){this.kind=t,this.zoomStops=u,this._styleExpression=a,this.isStateDependent="camera"!==t&&!Nr(a.expression),this.interpolationType=m}evaluateWithoutErrorHandling(t,a,u,m,y,w){return this._styleExpression.evaluateWithoutErrorHandling(t,a,u,m,y,w)}evaluate(t,a,u,m,y,w){return this._styleExpression.evaluate(t,a,u,m,y,w)}interpolationFactor(t,a,u){return this.interpolationType?Do.interpolationFactor(this.interpolationType,t,a,u):0}}function qu(o,t){if("error"===(o=$c(o,t)).result)return o;const a=o.value.expression,u=Ud(a);if(!u&&!zc(t))return ws([new jo("","data expressions not supported")]);const m=Br(a,["zoom","pitch","distance-from-center"]);if(!m&&!So(t))return ws([new jo("","zoom expressions not supported")]);const y=Gc(a);return y||m?y instanceof jo?ws([y]):y instanceof Do&&!Zu(t)?ws([new jo("",'"interpolate" expressions cannot be used with this property')]):Kd(y?new Hc(u?"camera":"composite",o.value,y.labels,y instanceof Do?y.interpolation:void 0):new Ma(u?"constant":"source",o.value)):ws([new jo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Yu{constructor(t,a){this._parameters=t,this._specification=a,Us(this,Sl(this._parameters,this._specification))}static deserialize(t){return new Yu(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Gc(o){let t=null;if(o instanceof gf)t=Gc(o.result);else if(o instanceof Wp){for(const a of o.args)if(t=Gc(a),t)break}else(o instanceof Pg||o instanceof Do)&&o.input instanceof Zo&&"zoom"===o.input.name&&(t=o);return t instanceof jo||o.eachChild(a=>{const u=Gc(a);u instanceof jo?t=u:!t&&u?t=new jo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&u&&t!==u&&(t=new jo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class rn{constructor(t,a,u,m){this.message=(t?`${t}: `:"")+u,m&&(this.identifier=m),null!=a&&a.__line__&&(this.line=a.__line__)}}function Es(o){const t=o.key,a=o.value,u=o.valueSpec||{},m=o.objectElementValidators||{},y=o.style,w=o.styleSpec;let T=[];const I=xi(a);if("object"!==I)return[new rn(t,a,`object expected, ${I} found`)];for(const P in a){const N=P.split(".")[0];let z;m[N]?z=m[N]:u[N]?z=fo:m["*"]?z=m["*"]:u["*"]&&(z=fo),z?T=T.concat(z({key:(t&&`${t}.`)+P,value:a[P],valueSpec:u[N]||u["*"],style:y,styleSpec:w,object:a,objectKey:P},a)):T.push(new rn(t,a[P],`unknown property "${P}"`))}for(const P in u)m[P]||u[P].required&&void 0===u[P].default&&void 0===a[P]&&T.push(new rn(t,a,`missing required property "${P}"`));return T}function Kn(o){const t=o.value,a=o.valueSpec,u=o.style,m=o.styleSpec,y=o.key,w=o.arrayElementValidator||fo;if("array"!==xi(t))return[new rn(y,t,`array expected, ${xi(t)} found`)];if(a.length&&t.length!==a.length)return[new rn(y,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new rn(y,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let T={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};m.$version<7&&(T.function=a.function),"object"===xi(a.value)&&(T=a.value);let I=[];for(let P=0;P<t.length;P++)I=I.concat(w({array:t,arrayIndex:P,value:t[P],valueSpec:T,style:u,styleSpec:m,key:`${y}[${P}]`}));return I}function Xu(o){const t=o.key,a=o.value,u=o.valueSpec;let m=xi(a);if("number"===m&&a!=a&&(m="NaN"),"number"!==m)return[new rn(t,a,`number expected, ${m} found`)];if("minimum"in u){let y=u.minimum;if("array"===xi(u.minimum)&&(y=u.minimum[o.arrayIndex]),a<y)return[new rn(t,a,`${a} is less than the minimum value ${y}`)]}if("maximum"in u){let y=u.maximum;if("array"===xi(u.maximum)&&(y=u.maximum[o.arrayIndex]),a>y)return[new rn(t,a,`${a} is greater than the maximum value ${y}`)]}return[]}function Ku(o){const t=o.valueSpec,a=rr(o.value.type);let u,m,y,w={};const T="categorical"!==a&&void 0===o.value.property,I=!T,P="array"===xi(o.value.stops)&&"array"===xi(o.value.stops[0])&&"object"===xi(o.value.stops[0][0]),N=Es({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(G){if("identity"===a)return[new rn(G.key,G.value,'identity function may not have a "stops" property')];let q=[];const J=G.value;return q=q.concat(Kn({key:G.key,value:J,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:z})),"array"===xi(J)&&0===J.length&&q.push(new rn(G.key,J,"array must have at least one stop")),q},default:function(G){return fo({key:G.key,value:G.value,valueSpec:t,style:G.style,styleSpec:G.styleSpec})}}});return"identity"===a&&T&&N.push(new rn(o.key,o.value,'missing required property "property"')),"identity"===a||o.value.stops||N.push(new rn(o.key,o.value,'missing required property "stops"')),"exponential"===a&&o.valueSpec.expression&&!Zu(o.valueSpec)&&N.push(new rn(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(I&&!zc(o.valueSpec)?N.push(new rn(o.key,o.value,"property functions not supported")):T&&!So(o.valueSpec)&&N.push(new rn(o.key,o.value,"zoom functions not supported"))),"categorical"!==a&&!P||void 0!==o.value.property||N.push(new rn(o.key,o.value,'"property" property is required')),N;function z(G){let q=[];const J=G.value,re=G.key;if("array"!==xi(J))return[new rn(re,J,`array expected, ${xi(J)} found`)];if(2!==J.length)return[new rn(re,J,`array length 2 expected, length ${J.length} found`)];if(P){if("object"!==xi(J[0]))return[new rn(re,J,`object expected, ${xi(J[0])} found`)];if(void 0===J[0].zoom)return[new rn(re,J,"object stop key must have zoom")];if(void 0===J[0].value)return[new rn(re,J,"object stop key must have value")];const de=rr(J[0].zoom);if("number"!=typeof de)return[new rn(re,J[0].zoom,"stop zoom values must be numbers")];if(y&&y>de)return[new rn(re,J[0].zoom,"stop zoom values must appear in ascending order")];de!==y&&(y=de,m=void 0,w={}),q=q.concat(Es({key:`${re}[0]`,value:J[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:Xu,value:U}}))}else q=q.concat(U({key:`${re}[0]`,value:J[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},J));return jc(Cr(J[1]))?q.concat([new rn(`${re}[1]`,J[1],"expressions are not allowed in function stops.")]):q.concat(fo({key:`${re}[1]`,value:J[1],valueSpec:t,style:G.style,styleSpec:G.styleSpec}))}function U(G,q){const J=xi(G.value),re=rr(G.value),de=null!==G.value?G.value:q;if(u){if(J!==u)return[new rn(G.key,de,`${J} stop domain type must match previous stop domain type ${u}`)]}else u=J;if("number"!==J&&"string"!==J&&"boolean"!==J&&"number"!=typeof re&&"string"!=typeof re&&"boolean"!=typeof re)return[new rn(G.key,de,"stop domain value must be a number, string, or boolean")];if("number"!==J&&"categorical"!==a){let xe=`number expected, ${J} found`;return zc(t)&&void 0===a&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new rn(G.key,de,xe)]}return"categorical"!==a||"number"!==J||"number"==typeof re&&isFinite(re)&&Math.floor(re)===re?"categorical"!==a&&"number"===J&&"number"==typeof re&&"number"==typeof m&&void 0!==m&&re<m?[new rn(G.key,de,"stop domain values must appear in ascending order")]:(m=re,"categorical"===a&&re in w?[new rn(G.key,de,"stop domain values must be unique")]:(w[re]=!0,[])):[new rn(G.key,de,`integer expected, found ${String(re)}`)]}}function uo(o){const t=("property"===o.expressionContext?qu:$c)(Cr(o.value),o.valueSpec);if("error"===t.result)return t.value.map(u=>new rn(`${o.key}${u.key}`,o.value,u.message));const a=t.value.expression||t.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!a.outputDefined())return[new rn(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!Nr(a))return[new rn(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return rc(a,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!Br(a,["zoom","feature-state"]))return[new rn(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!Ud(a))return[new rn(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rc(o,t){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)a.delete(m);if(0===a.size)return[];const u=[];return o instanceof Zo&&a.has(o.name)?[new rn(t.key,t.value,`["${o.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(o.eachChild(m=>{u.push(...rc(m,t))}),u)}function Ju(o){const t=o.key,a=o.value,u=o.valueSpec,m=[];return Array.isArray(u.values)?-1===u.values.indexOf(rr(a))&&m.push(new rn(t,a,`expected one of [${u.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(u.values).indexOf(rr(a))&&m.push(new rn(t,a,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(a)} found`)),m}function Qd(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const t of o.slice(1))if(!Qd(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Da(o,t="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Qd(o)||(o=vi(o));const a=o;let u=!0;try{u=function(P){if(!Zc(P))return P;let N=Cr(P);return eh(N),N=Jp(N),N}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const m=ct[`filter_${t}`],y=$c(u,m);let w=null;if("error"===y.result)throw new Error(y.value.map(P=>`${P.key}: ${P.message}`).join(", "));w=(P,N,z)=>y.value.evaluate(P,N,{},z);let T=null,I=null;if(u!==a){const P=$c(a,m);if("error"===P.result)throw new Error(P.value.map(N=>`${N.key}: ${N.message}`).join(", "));T=(N,z,U,G,q)=>P.value.evaluate(N,z,{},U,void 0,void 0,G,q),I=!Ud(P.value.expression)}return{filter:w,dynamicFilter:T||void 0,needGeometry:Bt(u),needFeature:!!I}}function Jp(o){if(!Array.isArray(o))return o;const t=function(a){if(Qp.has(a[0]))for(let u=1;u<a.length;u++)if(Zc(a[u]))return!0;return a}(o);return!0===t?t:t.map(a=>Jp(a))}function eh(o){let t=!1;const a=[];if("case"===o[0]){for(let u=1;u<o.length-1;u+=2)t=t||Zc(o[u]),a.push(o[u+1]);a.push(o[o.length-1])}else if("match"===o[0]){t=t||Zc(o[1]);for(let u=2;u<o.length-1;u+=2)a.push(o[u+1]);a.push(o[o.length-1])}else if("step"===o[0]){t=t||Zc(o[1]);for(let u=1;u<o.length-1;u+=2)a.push(o[u+1])}t&&(o.length=0,o.push("any",...a));for(let u=1;u<o.length;u++)eh(o[u])}function Zc(o){if(!Array.isArray(o))return!1;if("pitch"===(t=o[0])||"distance-from-center"===t)return!0;var t;for(let a=1;a<o.length;a++)if(Zc(o[a]))return!0;return!1}const Qp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Vy(o,t){return o<t?-1:o>t?1:0}function Bt(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let t=1;t<o.length;t++)if(Bt(o[t]))return!0;return!1}function vi(o){if(!o)return!0;const t=o[0];return o.length<=1?"any"!==t:"=="===t?th(o[1],o[2],"=="):"!="===t?Wc(th(o[1],o[2],"==")):"<"===t||">"===t||"<="===t||">="===t?th(o[1],o[2],t):"any"===t?(a=o.slice(1),["any"].concat(a.map(vi))):"all"===t?["all"].concat(o.slice(1).map(vi)):"none"===t?["all"].concat(o.slice(1).map(vi).map(Wc)):"in"===t?nh(o[1],o.slice(2)):"!in"===t?Wc(nh(o[1],o.slice(2))):"has"===t?Qr(o[1]):"!has"===t?Wc(Qr(o[1])):"within"!==t||o;var a}function th(o,t,a){switch(o){case"$type":return[`filter-type-${a}`,t];case"$id":return[`filter-id-${a}`,t];default:return[`filter-${a}`,o,t]}}function nh(o,t){if(0===t.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(a=>typeof a!=typeof t[0])?["filter-in-large",o,["literal",t.sort(Vy)]]:["filter-in-small",o,["literal",t]]}}function Qr(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Wc(o){return["!",o]}function Ya(o){return Qd(Cr(o.value))?uo(Us({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):ls(o)}function ls(o){const t=o.value,a=o.key;if("array"!==xi(t))return[new rn(a,t,`array expected, ${xi(t)} found`)];const u=o.styleSpec;let m,y=[];if(t.length<1)return[new rn(a,t,"filter array must have at least 1 element")];switch(y=y.concat(Ju({key:`${a}[0]`,value:t[0],valueSpec:u.filter_operator,style:o.style,styleSpec:o.styleSpec})),rr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===rr(t[1])&&y.push(new rn(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&y.push(new rn(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=xi(t[1]),"string"!==m&&y.push(new rn(`${a}[1]`,t[1],`string expected, ${m} found`)));for(let w=2;w<t.length;w++)m=xi(t[w]),"$type"===rr(t[1])?y=y.concat(Ju({key:`${a}[${w}]`,value:t[w],valueSpec:u.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==m&&"number"!==m&&"boolean"!==m&&y.push(new rn(`${a}[${w}]`,t[w],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let w=1;w<t.length;w++)y=y.concat(ls({key:`${a}[${w}]`,value:t[w],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":m=xi(t[1]),2!==t.length?y.push(new rn(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==m&&y.push(new rn(`${a}[1]`,t[1],`string expected, ${m} found`));break;case"within":m=xi(t[1]),2!==t.length?y.push(new rn(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==m&&y.push(new rn(`${a}[1]`,t[1],`object expected, ${m} found`))}return y}function qc(o,t){const a=o.key,u=o.style,m=o.styleSpec,y=o.value,w=o.objectKey,T=m[`${t}_${o.layerType}`];if(!T)return[];const I=w.match(/^(.*)-transition$/);if("paint"===t&&I&&T[I[1]]&&T[I[1]].transition)return fo({key:a,value:y,valueSpec:m.transition,style:u,styleSpec:m});const P=o.valueSpec||T[w];if(!P)return[new rn(a,y,`unknown property "${w}"`)];let N;if("string"===xi(y)&&zc(P)&&!P.tokens&&(N=/^{([^}]+)}$/.exec(y))){const U=`\`{ "type": "identity", "property": ${N?JSON.stringify(N[1]):'"_"'} }\``;return[new rn(a,y,`"${w}" does not support interpolation syntax\nUse an identity property function instead: ${U}.`)]}const z=[];return"symbol"===o.layerType&&("text-field"===w&&u&&!u.glyphs&&z.push(new rn(a,y,'use of "text-field" requires a style "glyphs" property')),"text-font"===w&&Zi(Cr(y))&&"identity"===rr(y.type)&&z.push(new rn(a,y,'"text-font" does not support identity functions'))),z.concat(fo({key:o.key,value:y,valueSpec:P,style:u,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:w}))}function Qu(o){return qc(o,"paint")}function ih(o){return qc(o,"layout")}function Uy(o){let t=[];const a=o.value,u=o.key,m=o.style,y=o.styleSpec;a.type||a.ref||t.push(new rn(u,a,'either "type" or "ref" is required'));let w=rr(a.type);const T=rr(a.ref);if(a.id){const I=rr(a.id);for(let P=0;P<o.arrayIndex;P++){const N=m.layers[P];rr(N.id)===I&&t.push(new rn(u,a.id,`duplicate layer id "${a.id}", previously used at line ${N.id.__line__}`))}}if("ref"in a){let I;["type","source","source-layer","filter","layout"].forEach(P=>{P in a&&t.push(new rn(u,a[P],`"${P}" is prohibited for ref layers`))}),m.layers.forEach(P=>{rr(P.id)===T&&(I=P)}),I?I.ref?t.push(new rn(u,a.ref,"ref cannot reference another ref layer")):w=rr(I.type):"string"==typeof T&&t.push(new rn(u,a.ref,`ref layer "${T}" not found`))}else if("background"!==w&&"sky"!==w)if(a.source){const I=m.sources&&m.sources[a.source],P=I&&rr(I.type);I?"vector"===P&&"raster"===w?t.push(new rn(u,a.source,`layer "${a.id}" requires a raster source`)):"raster"===P&&"raster"!==w?t.push(new rn(u,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==P||a["source-layer"]?"raster-dem"===P&&"hillshade"!==w?t.push(new rn(u,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==w||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||"geojson"===P&&I.lineMetrics||t.push(new rn(u,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new rn(u,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new rn(u,a.source,`source "${a.source}" not found`))}else t.push(new rn(u,a,'missing required property "source"'));return t=t.concat(Es({key:u,value:a,valueSpec:y.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fo({key:`${u}.type`,value:a.type,valueSpec:y.layer.type,style:o.style,styleSpec:o.styleSpec,object:a,objectKey:"type"}),filter:I=>Ya(Us({layerType:w},I)),layout:I=>Es({layer:a,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":P=>ih(Us({layerType:w},P))}}),paint:I=>Es({layer:a,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":P=>Qu(Us({layerType:w},P))}})}})),t}function Xa(o){const t=o.value,a=o.key,u=xi(t);return"string"!==u?[new rn(a,t,`string expected, ${u} found`)]:[]}const Yo={promoteId:function({key:o,value:t}){if("string"===xi(t))return Xa({key:o,value:t});{const a=[];for(const u in t)a.push(...Xa({key:`${o}.${u}`,value:t[u]}));return a}}};function Sa(o){const t=o.value,a=o.key,u=o.styleSpec,m=o.style;if(!t.type)return[new rn(a,t,'"type" is required')];const y=rr(t.type);let w;switch(y){case"vector":case"raster":case"raster-dem":return w=Es({key:a,value:t,valueSpec:u[`source_${y.replace("-","_")}`],style:o.style,styleSpec:u,objectElementValidators:Yo}),w;case"geojson":if(w=Es({key:a,value:t,valueSpec:u.source_geojson,style:m,styleSpec:u,objectElementValidators:Yo}),t.cluster)for(const T in t.clusterProperties){const[I,P]=t.clusterProperties[T],N="string"==typeof I?[I,["accumulated"],["get",T]]:I;w.push(...uo({key:`${a}.${T}.map`,value:P,expressionContext:"cluster-map"})),w.push(...uo({key:`${a}.${T}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return w;case"video":return Es({key:a,value:t,valueSpec:u.source_video,style:m,styleSpec:u});case"image":return Es({key:a,value:t,valueSpec:u.source_image,style:m,styleSpec:u});case"canvas":return[new rn(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ju({key:`${a}.type`,value:t.type,valueSpec:{values:bf(u)},style:m,styleSpec:u})}}function bf(o){return o.source.reduce((t,a)=>{const u=o[a];return"enum"===u.type.type&&(t=t.concat(Object.keys(u.type.values))),t},[])}function Il(o){const t=o.value,a=o.styleSpec,u=a.light,m=o.style;let y=[];const w=xi(t);if(void 0===t)return y;if("object"!==w)return y=y.concat([new rn("light",t,`object expected, ${w} found`)]),y;for(const T in t){const I=T.match(/^(.*)-transition$/);y=y.concat(I&&u[I[1]]&&u[I[1]].transition?fo({key:T,value:t[T],valueSpec:a.transition,style:m,styleSpec:a}):u[T]?fo({key:T,value:t[T],valueSpec:u[T],style:m,styleSpec:a}):[new rn(T,t[T],`unknown property "${T}"`)])}return y}function ho(o){const t=o.value,a=o.key,u=o.style,m=o.styleSpec,y=m.terrain;let w=[];const T=xi(t);if(void 0===t)return w;if("object"!==T)return w=w.concat([new rn("terrain",t,`object expected, ${T} found`)]),w;for(const I in t){const P=I.match(/^(.*)-transition$/);w=w.concat(P&&y[P[1]]&&y[P[1]].transition?fo({key:I,value:t[I],valueSpec:m.transition,style:u,styleSpec:m}):y[I]?fo({key:I,value:t[I],valueSpec:y[I],style:u,styleSpec:m}):[new rn(I,t[I],`unknown property "${I}"`)])}if(t.source){const I=u.sources&&u.sources[t.source],P=I&&rr(I.type);I?"raster-dem"!==P&&w.push(new rn(a,t.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):w.push(new rn(a,t.source,`source "${t.source}" not found`))}else w.push(new rn(a,t,'terrain is missing required property "source"'));return w}function em(o){const t=o.value,a=o.style,u=o.styleSpec,m=u.fog;let y=[];const w=xi(t);if(void 0===t)return y;if("object"!==w)return y=y.concat([new rn("fog",t,`object expected, ${w} found`)]),y;for(const T in t){const I=T.match(/^(.*)-transition$/);y=y.concat(I&&m[I[1]]&&m[I[1]].transition?fo({key:T,value:t[T],valueSpec:u.transition,style:a,styleSpec:u}):m[T]?fo({key:T,value:t[T],valueSpec:m[T],style:a,styleSpec:u}):[new rn(T,t[T],`unknown property "${T}"`)])}return y}const xf={"*":()=>[],array:Kn,boolean:function(o){const t=o.value,a=o.key,u=xi(t);return"boolean"!==u?[new rn(a,t,`boolean expected, ${u} found`)]:[]},number:Xu,color:function(o){const t=o.key,a=o.value,u=xi(a);return"string"!==u?[new rn(t,a,`color expected, ${u} found`)]:null===We(a)?[new rn(t,a,`color expected, "${a}" found`)]:[]},enum:Ju,filter:Ya,function:Ku,layer:Uy,object:Es,source:Sa,light:Il,terrain:ho,fog:em,string:Xa,formatted:function(o){return 0===Xa(o).length?[]:uo(o)},resolvedImage:function(o){return 0===Xa(o).length?[]:uo(o)},projection:function(o){const t=o.value,a=o.styleSpec,u=a.projection,m=o.style;let y=[];const w=xi(t);if("object"===w)for(const T in t)y=y.concat(fo({key:T,value:t[T],valueSpec:u[T],style:m,styleSpec:a}));else"string"!==w&&(y=y.concat([new rn("projection",t,`object or string expected, ${w} found`)]));return y}};function fo(o){const t=o.value,a=o.valueSpec,u=o.styleSpec;return a.expression&&Zi(rr(t))?Ku(o):a.expression&&jc(Cr(t))?uo(o):a.type&&xf[a.type]?xf[a.type](o):Es(Us({},o,{valueSpec:a.type?u[a.type]:a}))}function tm(o){const t=o.value,a=o.key,u=Xa(o);return u.length||(-1===t.indexOf("{fontstack}")&&u.push(new rn(a,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&u.push(new rn(a,t,'"glyphs" url must include a "{range}" token'))),u}function wf(o,t=ct){return cs(fo({key:"",value:o,valueSpec:t.$root,styleSpec:t,style:o,objectElementValidators:{glyphs:tm,"*":()=>[]}}))}const nm=o=>cs(Qu(o)),Bg=o=>cs(ih(o));function cs(o){return o.slice().sort((t,a)=>t.line&&a.line?t.line-a.line:0)}function zg(o,t){let a=!1;if(t&&t.length)for(const u of t)o.fire(new os(new Error(u.message))),a=!0;return a}var Vg=Ia,Ws=3;function Ia(o,t,a){var u=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var m=new Int32Array(this.arrayBuffer);o=m[0],this.d=(t=m[1])+2*(a=m[2]);for(var y=0;y<this.d*this.d;y++){var w=m[Ws+y],T=m[Ws+y+1];u.push(w===T?null:m.subarray(w,T))}var I=m[Ws+u.length+1];this.keys=m.subarray(m[Ws+u.length],I),this.bboxes=m.subarray(I),this.insert=this._insertReadonly}else{this.d=t+2*a;for(var P=0;P<this.d*this.d;P++)u.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=o,this.padding=a,this.scale=t/o,this.uid=0;var N=a/t*o;this.min=-N,this.max=o+N}Ia.prototype.insert=function(o,t,a,u,m){this._forEachCell(t,a,u,m,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(t),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(m)},Ia.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ia.prototype._insertCell=function(o,t,a,u,m,y){this.cells[m].push(y)},Ia.prototype.query=function(o,t,a,u,m){var y=this.min,w=this.max;if(o<=y&&t<=y&&w<=a&&w<=u&&!m)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(o,t,a,u,this._queryCell,T,{},m),T},Ia.prototype._queryCell=function(o,t,a,u,m,y,w,T){var I=this.cells[m];if(null!==I)for(var P=this.keys,N=this.bboxes,z=0;z<I.length;z++){var U=I[z];if(void 0===w[U]){var G=4*U;(T?T(N[G+0],N[G+1],N[G+2],N[G+3]):o<=N[G+2]&&t<=N[G+3]&&a>=N[G+0]&&u>=N[G+1])?(w[U]=!0,y.push(P[U])):w[U]=!1}}},Ia.prototype._forEachCell=function(o,t,a,u,m,y,w,T){for(var I=this._convertToCellCoord(o),P=this._convertToCellCoord(t),N=this._convertToCellCoord(a),z=this._convertToCellCoord(u),U=I;U<=N;U++)for(var G=P;G<=z;G++){var q=this.d*G+U;if((!T||T(this._convertFromCellCoord(U),this._convertFromCellCoord(G),this._convertFromCellCoord(U+1),this._convertFromCellCoord(G+1)))&&m.call(this,o,t,a,u,q,y,w,T))return}},Ia.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Ia.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Ia.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,t=Ws+this.cells.length+1+1,a=0,u=0;u<this.cells.length;u++)a+=this.cells[u].length;var m=new Int32Array(t+a+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var y=t,w=0;w<o.length;w++){var T=o[w];m[Ws+w]=y,m.set(T,y),y+=T.length}return m[Ws+o.length]=y,m.set(this.keys,y),m[Ws+o.length+1]=y+=this.keys.length,m.set(this.bboxes,y),y+=this.bboxes.length,m.buffer};var oc=Ot(Vg);const rh={};function hn(o,t,a={}){Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),rh[t]={klass:o,omit:a.omit||[]}}hn(Object,"Object"),oc.serialize=function(o,t){const a=o.toArrayBuffer();return t&&t.push(a),{buffer:a}},oc.deserialize=function(o){return new oc(o.buffer)},Object.defineProperty(oc,"name",{value:"Grid"}),hn(oc,"Grid"),hn(wn,"Color"),hn(Error,"Error"),hn(vs,"AJAXError"),hn(Mo,"ResolvedImage"),hn(Yu,"StylePropertyFunction"),hn(Wu,"StyleExpression",{omit:["_evaluator"]}),hn(Hc,"ZoomDependentExpression"),hn(Ma,"ZoomConstantExpression"),hn(Zo,"CompoundExpression",{omit:["_evaluate"]});for(const o in Bc)rh[Bc[o]._classRegistryKey]||hn(Bc[o],`Expression${o}`);function oh(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function Ef(o){return ue.ImageBitmap&&o instanceof ue.ImageBitmap}function sc(o,t){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(oh(o)||Ef(o))return t&&t.push(o),o;if(ArrayBuffer.isView(o)){const a=o;return t&&t.push(a.buffer),a}if(o instanceof ue.ImageData)return t&&t.push(o.data.buffer),o;if(Array.isArray(o)){const a=[];for(const u of o)a.push(sc(u,t));return a}if("object"==typeof o){const a=o.constructor,u=a._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const m=a.serialize?a.serialize(o,t):{};if(!a.serialize){for(const y in o)o.hasOwnProperty(y)&&(rh[u].omit.indexOf(y)>=0||(m[y]=sc(o[y],t)));o instanceof Error&&(m.message=o.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(m.$name=u),m}throw new Error("can't serialize object of type "+typeof o)}function Wr(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||oh(o)||Ef(o)||ArrayBuffer.isView(o)||o instanceof ue.ImageData)return o;if(Array.isArray(o))return o.map(Wr);if("object"==typeof o){const t=o.$name||"Object",{klass:a}=rh[t];if(!a)throw new Error(`can't deserialize unregistered class ${t}`);if(a.deserialize)return a.deserialize(o);const u=Object.create(a.prototype);for(const m of Object.keys(o))"$name"!==m&&(u[m]=Wr(o[m]));return u}throw new Error("can't deserialize object of type "+typeof o)}const Jt={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Mr(o){for(const t of o)if(Cf(t.charCodeAt(0)))return!0;return!1}function Ug(o){for(const t of o)if(!jg(t.charCodeAt(0)))return!1;return!0}function jg(o){return!(Jt.Arabic(o)||Jt["Arabic Supplement"](o)||Jt["Arabic Extended-A"](o)||Jt["Arabic Presentation Forms-A"](o)||Jt["Arabic Presentation Forms-B"](o))}function Cf(o){return!(746!==o&&747!==o&&(o<4352||!(Jt["Bopomofo Extended"](o)||Jt.Bopomofo(o)||Jt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Jt["CJK Compatibility Ideographs"](o)||Jt["CJK Compatibility"](o)||Jt["CJK Radicals Supplement"](o)||Jt["CJK Strokes"](o)||!(!Jt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||Jt["CJK Unified Ideographs Extension A"](o)||Jt["CJK Unified Ideographs"](o)||Jt["Enclosed CJK Letters and Months"](o)||Jt["Hangul Compatibility Jamo"](o)||Jt["Hangul Jamo Extended-A"](o)||Jt["Hangul Jamo Extended-B"](o)||Jt["Hangul Jamo"](o)||Jt["Hangul Syllables"](o)||Jt.Hiragana(o)||Jt["Ideographic Description Characters"](o)||Jt.Kanbun(o)||Jt["Kangxi Radicals"](o)||Jt["Katakana Phonetic Extensions"](o)||Jt.Katakana(o)&&12540!==o||!(!Jt["Halfwidth and Fullwidth Forms"](o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!Jt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Jt["Unified Canadian Aboriginal Syllabics"](o)||Jt["Unified Canadian Aboriginal Syllabics Extended"](o)||Jt["Vertical Forms"](o)||Jt["Yijing Hexagram Symbols"](o)||Jt["Yi Syllables"](o)||Jt["Yi Radicals"](o))))}function $g(o){return!(Cf(o)||(t=o,Jt["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Jt["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Jt["Letterlike Symbols"](t)||Jt["Number Forms"](t)||Jt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Jt["Control Pictures"](t)&&9251!==t||Jt["Optical Character Recognition"](t)||Jt["Enclosed Alphanumerics"](t)||Jt["Geometric Shapes"](t)||Jt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Jt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Jt["CJK Symbols and Punctuation"](t)||Jt.Katakana(t)||Jt["Private Use Area"](t)||Jt["CJK Compatibility Forms"](t)||Jt["Small Form Variants"](t)||Jt["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t}function Xo(o){return o>=1424&&o<=2303||Jt["Arabic Presentation Forms-A"](o)||Jt["Arabic Presentation Forms-B"](o)}function Cs(o,t){return!(!t&&Xo(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Jt.Khmer(o))}function sh(o){for(const t of o)if(Xo(t.charCodeAt(0)))return!0;return!1}const fr="deferred",Nn="loading",Po="loaded";let Ka=null,_="unavailable",l=null;const f=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(_="error"),Ka&&Ka(o)};function v(){C.fire(new Uo("pluginStateChange",{pluginStatus:_,pluginURL:l}))}const C=new Za,S=function(){return _},R=function(){if(_!==fr||!l)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_=Nn,v(),l&&Ei({url:l},o=>{o?f(o):(_=Po,v())})},F={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_===Po||null!=F.applyArabicShaping,isLoading:()=>_===Nn,setState(o){_=o.pluginStatus,l=o.pluginURL},isParsed:()=>null!=F.applyArabicShaping&&null!=F.processBidirectionalText&&null!=F.processStyledBidirectionalText,getPluginURL:()=>l};class B{constructor(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(t){return function(a,u){for(const m of a)if(!Cs(m.charCodeAt(0),u))return!1;return!0}(t,F.isLoaded())}}class ${constructor(t,a){this.property=t,this.value=a,this.expression=function(u,m){if(Zi(u))return new Yu(u,m);if(jc(u)){const y=qu(u,m);if("error"===y.result)throw new Error(y.value.map(w=>`${w.key}: ${w.message}`).join(", "));return y.value}{let y=u;return"string"==typeof u&&"color"===m.type&&(y=wn.parse(u)),{kind:"constant",evaluate:()=>y}}}(void 0===a?t.specification.default:a,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,a,u){return this.property.possiblyEvaluate(this,t,a,u)}}class j{constructor(t){this.property=t,this.value=new $(t,void 0)}transitioned(t,a){return new ee(this.property,this.value,a,st({},t.transition,this.transition),t.now)}untransitioned(){return new ee(this.property,this.value,null,{},0)}}class X{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return ai(this._values[t].value.value)}setValue(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new j(this._values[t].property)),this._values[t].value=new $(this._values[t].property,null===a?void 0:ai(a))}getTransition(t){return ai(this._values[t].transition)}setTransition(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new j(this._values[t].property)),this._values[t].transition=ai(a)||void 0}serialize(){const t={};for(const a of Object.keys(this._values)){const u=this.getValue(a);void 0!==u&&(t[a]=u);const m=this.getTransition(a);void 0!==m&&(t[`${a}-transition`]=m)}return t}transitioned(t,a){const u=new se(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(t,a._values[m]);return u}untransitioned(){const t=new se(this._properties);for(const a of Object.keys(this._values))t._values[a]=this._values[a].untransitioned();return t}}class ee{constructor(t,a,u,m,y){const w=m.delay||0,T=m.duration||0;y=y||0,this.property=t,this.value=a,this.begin=y+w,this.end=this.begin+T,t.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(t,a,u){const m=t.now||0,y=this.value.possiblyEvaluate(t,a,u),w=this.prior;if(w){if(m>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(m<this.begin)return w.possiblyEvaluate(t,a,u);{const T=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(t,a,u),y,gi(T))}}return y}}class se{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,a,u){const m=new ce(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(t,a,u);return m}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class le{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return ai(this._values[t].value)}setValue(t,a){this._values[t]=new $(this._values[t].property,null===a?void 0:ai(a))}serialize(){const t={};for(const a of Object.keys(this._values)){const u=this.getValue(a);void 0!==u&&(t[a]=u)}return t}possiblyEvaluate(t,a,u){const m=new ce(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(t,a,u);return m}}class ae{constructor(t,a,u){this.property=t,this.value=a,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,a,u,m){return this.property.evaluate(this.value,this.parameters,t,a,u,m)}}class ce{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class K{constructor(t){this.specification=t}possiblyEvaluate(t,a){return t.expression.evaluate(a)}interpolate(t,a,u){const m=Uu[this.specification.type];return m?m(t,a,u):t}}class oe{constructor(t,a){this.specification=t,this.overrides=a}possiblyEvaluate(t,a,u,m){return new ae(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(a,null,{},u,m)}:t.expression,a)}interpolate(t,a,u){if("constant"!==t.value.kind||"constant"!==a.value.kind)return t;if(void 0===t.value.value||void 0===a.value.value)return new ae(this,{kind:"constant",value:void 0},t.parameters);const m=Uu[this.specification.type];return m?new ae(this,{kind:"constant",value:m(t.value.value,a.value.value,u)},t.parameters):t}evaluate(t,a,u,m,y,w){return"constant"===t.kind?t.value:t.evaluate(a,u,m,y,w)}}class pe{constructor(t){this.specification=t}possiblyEvaluate(t,a,u,m){return!!t.expression.evaluate(a,null,{},u,m)}interpolate(){return!1}}class ge{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new B(0,{});for(const u in t){const m=t[u];m.specification.overridable&&this.overridableProperties.push(u);const y=this.defaultPropertyValues[u]=new $(m,void 0),w=this.defaultTransitionablePropertyValues[u]=new j(m);this.defaultTransitioningPropertyValues[u]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=y.possiblyEvaluate(a)}}}function De(o,t){return 256*(o=Wn(Math.floor(o),0,255))+Wn(Math.floor(t),0,255)}hn(oe,"DataDrivenProperty"),hn(K,"DataConstantProperty"),hn(pe,"ColorRampProperty");const Me={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Se{constructor(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ze{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Re(o,t=1){let a=0,u=0;return{members:o.map(m=>{const y=Me[m.type].BYTES_PER_ELEMENT,w=a=Xe(a,Math.max(t,y)),T=m.components||1;return u=Math.max(u,y),a+=y*T,{name:m.name,type:m.type,components:T,offset:w}}),size:Xe(a,Math.max(u,t)),alignment:t}}function Xe(o,t){return Math.ceil(o/t)*t}class At extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,a)}emplace(t,a,u){const m=2*t;return this.int16[m+0]=a,this.int16[m+1]=u,t}}At.prototype.bytesPerElement=4,hn(At,"StructArrayLayout2i4");class Ve extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,a,u)}emplace(t,a,u,m){const y=3*t;return this.int16[y+0]=a,this.int16[y+1]=u,this.int16[y+2]=m,t}}Ve.prototype.bytesPerElement=6,hn(Ve,"StructArrayLayout3i6");class mt extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,a,u,m)}emplace(t,a,u,m,y){const w=4*t;return this.int16[w+0]=a,this.int16[w+1]=u,this.int16[w+2]=m,this.int16[w+3]=y,t}}mt.prototype.bytesPerElement=8,hn(mt,"StructArrayLayout4i8");class nt extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,m,y,w,T){const I=this.length;return this.resize(I+1),this.emplace(I,t,a,u,m,y,w,T)}emplace(t,a,u,m,y,w,T,I){const P=6*t,N=12*t,z=3*t;return this.int16[P+0]=a,this.int16[P+1]=u,this.uint8[N+4]=m,this.uint8[N+5]=y,this.uint8[N+6]=w,this.uint8[N+7]=T,this.float32[z+2]=I,t}}nt.prototype.bytesPerElement=12,hn(nt,"StructArrayLayout2i4ub1f12");class bt extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,a,u,m)}emplace(t,a,u,m,y){const w=4*t;return this.float32[w+0]=a,this.float32[w+1]=u,this.float32[w+2]=m,this.float32[w+3]=y,t}}bt.prototype.bytesPerElement=16,hn(bt,"StructArrayLayout4f16");class He extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,a,u,m,y)}emplace(t,a,u,m,y,w){const T=6*t,I=3*t;return this.uint16[T+0]=a,this.uint16[T+1]=u,this.uint16[T+2]=m,this.uint16[T+3]=y,this.float32[I+2]=w,t}}He.prototype.bytesPerElement=12,hn(He,"StructArrayLayout4ui1f12");class ut extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,a,u,m)}emplace(t,a,u,m,y){const w=4*t;return this.uint16[w+0]=a,this.uint16[w+1]=u,this.uint16[w+2]=m,this.uint16[w+3]=y,t}}ut.prototype.bytesPerElement=8,hn(ut,"StructArrayLayout4ui8");class Lt extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,m,y,w){const T=this.length;return this.resize(T+1),this.emplace(T,t,a,u,m,y,w)}emplace(t,a,u,m,y,w,T){const I=6*t;return this.int16[I+0]=a,this.int16[I+1]=u,this.int16[I+2]=m,this.int16[I+3]=y,this.int16[I+4]=w,this.int16[I+5]=T,t}}Lt.prototype.bytesPerElement=12,hn(Lt,"StructArrayLayout6i12");class gt extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,m,y,w,T,I,P,N,z,U){const G=this.length;return this.resize(G+1),this.emplace(G,t,a,u,m,y,w,T,I,P,N,z,U)}emplace(t,a,u,m,y,w,T,I,P,N,z,U,G){const q=12*t;return this.int16[q+0]=a,this.int16[q+1]=u,this.int16[q+2]=m,this.int16[q+3]=y,this.uint16[q+4]=w,this.uint16[q+5]=T,this.uint16[q+6]=I,this.uint16[q+7]=P,this.int16[q+8]=N,this.int16[q+9]=z,this.int16[q+10]=U,this.int16[q+11]=G,t}}gt.prototype.bytesPerElement=24,hn(gt,"StructArrayLayout4i4ui4i24");class wt extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,m,y,w){const T=this.length;return this.resize(T+1),this.emplace(T,t,a,u,m,y,w)}emplace(t,a,u,m,y,w,T){const I=10*t,P=5*t;return this.int16[I+0]=a,this.int16[I+1]=u,this.int16[I+2]=m,this.float32[P+2]=y,this.float32[P+3]=w,this.float32[P+4]=T,t}}wt.prototype.bytesPerElement=20,hn(wt,"StructArrayLayout3i3f20");class bn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint32[1*t+0]=a,t}}bn.prototype.bytesPerElement=4,hn(bn,"StructArrayLayout1ul4");class Rn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,m,y,w,T,I,P,N,z,U,G){const q=this.length;return this.resize(q+1),this.emplace(q,t,a,u,m,y,w,T,I,P,N,z,U,G)}emplace(t,a,u,m,y,w,T,I,P,N,z,U,G,q){const J=20*t,re=10*t;return this.int16[J+0]=a,this.int16[J+1]=u,this.int16[J+2]=m,this.int16[J+3]=y,this.int16[J+4]=w,this.float32[re+3]=T,this.float32[re+4]=I,this.float32[re+5]=P,this.float32[re+6]=N,this.int16[J+14]=z,this.uint32[re+8]=U,this.uint16[J+18]=G,this.uint16[J+19]=q,t}}Rn.prototype.bytesPerElement=40,hn(Rn,"StructArrayLayout5i4f1i1ul2ui40");class an extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,m,y,w,T){const I=this.length;return this.resize(I+1),this.emplace(I,t,a,u,m,y,w,T)}emplace(t,a,u,m,y,w,T,I){const P=8*t;return this.int16[P+0]=a,this.int16[P+1]=u,this.int16[P+2]=m,this.int16[P+4]=y,this.int16[P+5]=w,this.int16[P+6]=T,this.int16[P+7]=I,t}}an.prototype.bytesPerElement=16,hn(an,"StructArrayLayout3i2i2i16");class xn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,a,u,m,y)}emplace(t,a,u,m,y,w){const T=4*t,I=8*t;return this.float32[T+0]=a,this.float32[T+1]=u,this.float32[T+2]=m,this.int16[I+6]=y,this.int16[I+7]=w,t}}xn.prototype.bytesPerElement=16,hn(xn,"StructArrayLayout2f1f2i16");class Jn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,a,u,m)}emplace(t,a,u,m,y){const w=12*t,T=3*t;return this.uint8[w+0]=a,this.uint8[w+1]=u,this.float32[T+1]=m,this.float32[T+2]=y,t}}Jn.prototype.bytesPerElement=12,hn(Jn,"StructArrayLayout2ub2f12");class An extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,a,u)}emplace(t,a,u,m){const y=3*t;return this.float32[y+0]=a,this.float32[y+1]=u,this.float32[y+2]=m,t}}An.prototype.bytesPerElement=12,hn(An,"StructArrayLayout3f12");class ln extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,a,u)}emplace(t,a,u,m){const y=3*t;return this.uint16[y+0]=a,this.uint16[y+1]=u,this.uint16[y+2]=m,t}}ln.prototype.bytesPerElement=6,hn(ln,"StructArrayLayout3ui6");class Oi extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,a,u,m,y,w,T,I,P,N,z,U,G,q,J,re,de,xe,he,ve,Ce){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,t,a,u,m,y,w,T,I,P,N,z,U,G,q,J,re,de,xe,he,ve,Ce)}emplace(t,a,u,m,y,w,T,I,P,N,z,U,G,q,J,re,de,xe,he,ve,Ce,Ee){const et=30*t,Ke=15*t,pt=60*t;return this.int16[et+0]=a,this.int16[et+1]=u,this.int16[et+2]=m,this.float32[Ke+2]=y,this.float32[Ke+3]=w,this.uint16[et+8]=T,this.uint16[et+9]=I,this.uint32[Ke+5]=P,this.uint32[Ke+6]=N,this.uint32[Ke+7]=z,this.uint16[et+16]=U,this.uint16[et+17]=G,this.uint16[et+18]=q,this.float32[Ke+10]=J,this.float32[Ke+11]=re,this.uint8[pt+48]=de,this.uint8[pt+49]=xe,this.uint8[pt+50]=he,this.uint32[Ke+13]=ve,this.int16[et+28]=Ce,this.uint8[pt+58]=Ee,t}}Oi.prototype.bytesPerElement=60,hn(Oi,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ri extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,a,u,m,y,w,T,I,P,N,z,U,G,q,J,re,de,xe,he,ve,Ce,Ee,et,Ke,pt,kt,ot,Tt,xt,Pt){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,t,a,u,m,y,w,T,I,P,N,z,U,G,q,J,re,de,xe,he,ve,Ce,Ee,et,Ke,pt,kt,ot,Tt,xt,Pt)}emplace(t,a,u,m,y,w,T,I,P,N,z,U,G,q,J,re,de,xe,he,ve,Ce,Ee,et,Ke,pt,kt,ot,Tt,xt,Pt,Rt){const lt=38*t,Gt=19*t;return this.int16[lt+0]=a,this.int16[lt+1]=u,this.int16[lt+2]=m,this.float32[Gt+2]=y,this.float32[Gt+3]=w,this.int16[lt+8]=T,this.int16[lt+9]=I,this.int16[lt+10]=P,this.int16[lt+11]=N,this.int16[lt+12]=z,this.int16[lt+13]=U,this.uint16[lt+14]=G,this.uint16[lt+15]=q,this.uint16[lt+16]=J,this.uint16[lt+17]=re,this.uint16[lt+18]=de,this.uint16[lt+19]=xe,this.uint16[lt+20]=he,this.uint16[lt+21]=ve,this.uint16[lt+22]=Ce,this.uint16[lt+23]=Ee,this.uint16[lt+24]=et,this.uint16[lt+25]=Ke,this.uint16[lt+26]=pt,this.uint16[lt+27]=kt,this.uint16[lt+28]=ot,this.uint32[Gt+15]=Tt,this.float32[Gt+16]=xt,this.float32[Gt+17]=Pt,this.float32[Gt+18]=Rt,t}}ri.prototype.bytesPerElement=76,hn(ri,"StructArrayLayout3i2f6i15ui1ul3f76");class Wi extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.float32[1*t+0]=a,t}}Wi.prototype.bytesPerElement=4,hn(Wi,"StructArrayLayout1f4");class Ni extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,a,u,m,y)}emplace(t,a,u,m,y,w){const T=5*t;return this.float32[T+0]=a,this.float32[T+1]=u,this.float32[T+2]=m,this.float32[T+3]=y,this.float32[T+4]=w,t}}Ni.prototype.bytesPerElement=20,hn(Ni,"StructArrayLayout5f20");class Pr extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,a,u,m)}emplace(t,a,u,m,y){const w=6*t;return this.uint32[3*t+0]=a,this.uint16[w+2]=u,this.uint16[w+3]=m,this.uint16[w+4]=y,t}}Pr.prototype.bytesPerElement=12,hn(Pr,"StructArrayLayout1ul3ui12");class qr extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,a)}emplace(t,a,u){const m=2*t;return this.uint16[m+0]=a,this.uint16[m+1]=u,t}}qr.prototype.bytesPerElement=4,hn(qr,"StructArrayLayout2ui4");class jn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint16[1*t+0]=a,t}}jn.prototype.bytesPerElement=2,hn(jn,"StructArrayLayout1ui2");class Oo extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,a)}emplace(t,a,u){const m=2*t;return this.float32[m+0]=a,this.float32[m+1]=u,t}}Oo.prototype.bytesPerElement=8,hn(Oo,"StructArrayLayout2f8");class Bi extends Se{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Bi.prototype.size=40;class _i extends Rn{get(t){return new Bi(this,t)}}hn(_i,"CollisionBoxArray");class yi extends Se{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}yi.prototype.size=60;class Or extends Oi{get(t){return new yi(this,t)}}hn(Or,"PlacedSymbolArray");class pr extends Se{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}pr.prototype.size=76;class Ri extends ri{get(t){return new pr(this,t)}}hn(Ri,"SymbolInstanceArray");class us extends Wi{getoffsetX(t){return this.float32[1*t+0]}}hn(us,"GlyphOffsetArray");class ua extends At{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}hn(ua,"SymbolLineVertexArray");class Yc extends Se{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Yc.prototype.size=12;class ed extends Pr{get(t){return new Yc(this,t)}}hn(ed,"FeatureIndexArray");class Ja extends qr{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}hn(Ja,"FillExtrusionCentroidArray");const ac=Re([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),lc=Re([{name:"a_dash",components:4,type:"Uint16"}]);var Tf={exports:{}},Ir=function(o,t){var a,u,m,y,w,T,I,P;for(u=o.length-(a=3&o.length),m=t,w=3432918353,T=461845907,P=0;P<u;)I=255&o.charCodeAt(P)|(255&o.charCodeAt(++P))<<8|(255&o.charCodeAt(++P))<<16|(255&o.charCodeAt(++P))<<24,++P,m=27492+(65535&(y=5*(65535&(m=(m^=I=(65535&(I=(I=(65535&I)*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(I=0,a){case 3:I^=(255&o.charCodeAt(P+2))<<16;case 2:I^=(255&o.charCodeAt(P+1))<<8;case 1:m^=I=(65535&(I=(I=(65535&(I^=255&o.charCodeAt(P)))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return m^=o.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0},sr=function(o,t){for(var a,u=o.length,m=t^u,y=0;u>=4;)a=1540483477*(65535&(a=255&o.charCodeAt(y)|(255&o.charCodeAt(++y))<<8|(255&o.charCodeAt(++y))<<16|(255&o.charCodeAt(++y))<<24))+((1540483477*(a>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++y;switch(u){case 3:m^=(255&o.charCodeAt(y+2))<<16;case 2:m^=(255&o.charCodeAt(y+1))<<8;case 1:m=1540483477*(65535&(m^=255&o.charCodeAt(y)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};Tf.exports=Ir,Tf.exports.murmur3=Ir,Tf.exports.murmur2=sr;var Qa=Ot(Tf.exports);class im{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,a,u,m){this.ids.push(go(t)),this.positions.push(a,u,m)}getPositions(t){const a=go(t);let u=0,m=this.ids.length-1;for(;u<m;){const w=u+m>>1;this.ids[w]>=a?m=w:u=w+1}const y=[];for(;this.ids[u]===a;)y.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return y}static serialize(t,a){const u=new Float64Array(t.ids),m=new Uint32Array(t.positions);return Xc(u,m,0,u.length-1),a&&a.push(u.buffer,m.buffer),{ids:u,positions:m}}static deserialize(t){const a=new im;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a}}function go(o){const t=+o;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Qa(String(o))}function Xc(o,t,a,u){for(;a<u;){const m=o[a+u>>1];let y=a-1,w=u+1;for(;;){do{y++}while(o[y]<m);do{w--}while(o[w]>m);if(y>=w)break;cc(o,y,w),cc(t,3*y,3*w),cc(t,3*y+1,3*w+1),cc(t,3*y+2,3*w+2)}w-a<u-w?(Xc(o,t,a,w),a=w+1):(Xc(o,t,w+1,u),u=w)}}function cc(o,t,a){const u=o[t];o[t]=o[a],o[a]=u}hn(im,"FeaturePositionMap");class qs{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,a),this.initialized=!0),!!this.location}}class Kc extends qs{constructor(t){super(t),this.current=0}set(t,a,u){this.fetchUniformLocation(t,a)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Df extends qs{constructor(t){super(t),this.current=[0,0,0,0]}set(t,a,u){this.fetchUniformLocation(t,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Sf extends qs{constructor(t){super(t),this.current=wn.transparent}set(t,a,u){this.fetchUniformLocation(t,a)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const jy=new Float32Array(16),Hg=new Float32Array(9),ha=new Float32Array(4);function td(o){return[De(255*o.r,255*o.g),De(255*o.b,255*o.a)]}class fa{constructor(t,a,u){this.value=t,this.uniformNames=a.map(m=>`u_${m}`),this.type=u}setUniform(t,a,u,m,y){a.set(t,y,m.constantOr(this.value))}getBinding(t,a){return"color"===this.type?new Sf(t):new Kc(t)}}class lh{constructor(t,a){this.uniformNames=a.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,a,u,m,y){const w="u_pattern"===y||"u_dash"===y?this.pattern:"u_pixel_ratio"===y?this.pixelRatio:null;w&&a.set(t,y,w)}getBinding(t,a){return"u_pattern"===a||"u_dash"===a?new Df(t):new Kc(t)}}class el{constructor(t,a,u,m){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,a,u,m,y,w){const T=this.paintVertexArray.length,I=this.expression.evaluate(new B(0),a,{},y,m,w);this.paintVertexArray.resize(t),this._setPaintValue(T,t,I)}updatePaintArray(t,a,u,m,y){const w=this.expression.evaluate({zoom:0},u,m,void 0,y);this._setPaintValue(t,a,w)}_setPaintValue(t,a,u){if("color"===this.type){const m=td(u);for(let y=t;y<a;y++)this.paintVertexArray.emplace(y,m[0],m[1])}else{for(let m=t;m<a;m++)this.paintVertexArray.emplace(m,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tl{constructor(t,a,u,m,y,w){this.expression=t,this.uniformNames=a.map(T=>`u_${T}_t`),this.type=u,this.useIntegerZoom=m,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=a.map(T=>({name:`a_${T}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(t,a,u,m,y,w){const T=this.expression.evaluate(new B(this.zoom),a,{},y,m,w),I=this.expression.evaluate(new B(this.zoom+1),a,{},y,m,w),P=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(P,t,T,I)}updatePaintArray(t,a,u,m,y){const w=this.expression.evaluate({zoom:this.zoom},u,m,void 0,y),T=this.expression.evaluate({zoom:this.zoom+1},u,m,void 0,y);this._setPaintValue(t,a,w,T)}_setPaintValue(t,a,u,m){if("color"===this.type){const y=td(u),w=td(m);for(let T=t;T<a;T++)this.paintVertexArray.emplace(T,y[0],y[1],w[0],w[1])}else{for(let y=t;y<a;y++)this.paintVertexArray.emplace(y,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,a,u,m,y){const w=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,T=Wn(this.expression.interpolationFactor(w,this.zoom,this.zoom+1),0,1);a.set(t,y,T)}getBinding(t,a){return new Kc(t)}}class Jc{constructor(t,a,u,m,y){this.expression=t,this.layerId=y,this.paintVertexAttributes=("array"===u?lc:ac).members;for(let w=0;w<a.length;++w);this.paintVertexArray=new m}populatePaintArray(t,a,u){const m=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(m,t,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(t,a,u,m,y,w){this._setPaintValues(t,a,u.patterns&&u.patterns[this.layerId],w)}_setPaintValues(t,a,u,m){if(!m||!u)return;const y=m[u];if(!y)return;const{tl:w,br:T,pixelRatio:I}=y;for(let P=t;P<a;P++)this.paintVertexArray.emplace(P,w[0],w[1],T[0],T[1],I)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qc{constructor(t,a,u=(()=>!0)){this.binders={},this._buffers=[];const m=[];for(const y in t.paint._values){if(!u(y))continue;const w=t.paint.get(y);if(!(w instanceof ae&&zc(w.property.specification)))continue;const T=Q0(y,t.type),I=w.value,P=w.property.specification.type,N=!!w.property.useIntegerZoom,z="line-dasharray"===y||y.endsWith("pattern"),U="line-dasharray"===y&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==I.kind||U)if("source"===I.kind||U||z){const G=Zg(y,P,"source");this.binders[y]=z?new Jc(I,T,P,G,t.id):new el(I,T,P,G),m.push(`/a_${y}`)}else{const G=Zg(y,P,"composite");this.binders[y]=new tl(I,T,P,N,a,G),m.push(`/z_${y}`)}else this.binders[y]=z?new lh(I.value,T):new fa(I.value,T,P),m.push(`/u_${y}`)}this.cacheKey=m.sort().join("")}getMaxValue(t){const a=this.binders[t];return a instanceof el||a instanceof tl?a.maxValue:0}populatePaintArrays(t,a,u,m,y,w){for(const T in this.binders){const I=this.binders[T];(I instanceof el||I instanceof tl||I instanceof Jc)&&I.populatePaintArray(t,a,u,m,y,w)}}setConstantPatternPositions(t){for(const a in this.binders){const u=this.binders[a];u instanceof lh&&u.setConstantPatternPositions(t)}}updatePaintArrays(t,a,u,m,y,w){let T=!1;for(const I in t){const P=a.getPositions(I);for(const N of P){const z=u.feature(N.index);for(const U in this.binders){const G=this.binders[U];if((G instanceof el||G instanceof tl||G instanceof Jc)&&!0===G.expression.isStateDependent){const q=m.paint.get(U);G.expression=q.value,G.updatePaintArray(N.start,N.end,z,t[I],y,w),T=!0}}}}return T}defines(){const t=[];for(const a in this.binders){const u=this.binders[a];(u instanceof fa||u instanceof lh)&&t.push(...u.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return t}getBinderAttributes(){const t=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof el||u instanceof tl||u instanceof Jc)for(let m=0;m<u.paintVertexAttributes.length;m++)t.push(u.paintVertexAttributes[m].name)}return t}getBinderUniforms(){const t=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof fa||u instanceof lh||u instanceof tl)for(const m of u.uniformNames)t.push(m)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const a=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof fa||m instanceof lh||m instanceof tl)for(const y of m.uniformNames)a.push({name:y,property:u,binding:m.getBinding(t,y)})}return a}setUniforms(t,a,u,m,y){for(const{name:w,property:T,binding:I}of u)this.binders[T].setUniform(t,I,y,m.get(T),w)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const a=this.binders[t];(a instanceof el||a instanceof tl||a instanceof Jc)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const a in this.binders){const u=this.binders[a];(u instanceof el||u instanceof tl||u instanceof Jc)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const a=this.binders[t];(a instanceof el||a instanceof tl||a instanceof Jc)&&a.destroy()}}}class uc{constructor(t,a,u=(()=>!0)){this.programConfigurations={};for(const m of t)this.programConfigurations[m.id]=new Qc(m,a,u);this.needsUpload=!1,this._featureMap=new im,this._bufferOffset=0}populatePaintArrays(t,a,u,m,y,w,T){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(t,a,m,y,w,T);void 0!==a.id&&this._featureMap.add(a.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,a,u,m,y){for(const w of u)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(t,this._featureMap,a,w,m,y)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const J0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Q0(o,t){return J0[o]||[o.replace(`${t}-`,"").replace(/-/g,"_")]}const Gg={"line-pattern":{source:He,composite:He},"fill-pattern":{source:He,composite:He},"fill-extrusion-pattern":{source:He,composite:He},"line-dasharray":{source:ut,composite:ut}},rm={color:{source:Oo,composite:bt},number:{source:Wi,composite:Oo}};function Zg(o,t,a){const u=Gg[o];return u&&u[a]||rm[t][a]}hn(fa,"ConstantBinder"),hn(lh,"PatternConstantBinder"),hn(el,"SourceExpressionBinder"),hn(Jc,"PatternCompositeBinder"),hn(tl,"CompositeExpressionBinder"),hn(Qc,"ProgramConfiguration",{omit:["_buffers"]}),hn(uc,"ProgramConfigurationSet");const If="-transition";class nl extends Za{constructor(t,a){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),a.layout&&(this._unevaluatedLayout=new le(a.layout)),a.paint)){this._transitionablePaint=new X(a.paint);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ce(a.paint)}}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,a,u={}){null!=a&&this._validate(Bg,`layers.${this.id}.layout.${t}`,t,a,u)||("visibility"!==t?this._unevaluatedLayout.setValue(t,a):this.visibility=a)}getPaintProperty(t){return vt(t,If)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,a,u={}){if(null!=a&&this._validate(nm,`layers.${this.id}.paint.${t}`,t,a,u))return!1;if(vt(t,If))return this._transitionablePaint.setTransition(t.slice(0,-11),a||void 0),!1;{const m=this._transitionablePaint._values[t],y=m.value.isDataDriven(),w=m.value;this._transitionablePaint.setValue(t,a),this._handleSpecialPaintPropertyUpdate(t);const T=this._transitionablePaint._values[t].value,I=T.isDataDriven(),P=vt(t,"pattern")||"line-dasharray"===t;return I||y||P||this._handleOverridablePaintPropertyUpdate(t,w,T)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,a,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,a)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),yn(t,(a,u)=>!(void 0===a||"layout"===u&&!Object.keys(a).length||"paint"===u&&!Object.keys(a).length))}_validate(t,a,u,m,y={}){return(!y||!1!==y.validate)&&zg(this,t.call(wf,{key:a,layerType:this.type,objectKey:u,value:m,styleSpec:ct,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const a=this.paint.get(t);if(a instanceof ae&&zc(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Da(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Af=Re([{name:"a_pos",components:2,type:"Int16"}],4),$y=Re([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Rr{constructor(t=[]){this.segments=t}prepareSegment(t,a,u,m){let y=this.segments[this.segments.length-1];return t>Rr.MAX_VERTEX_ARRAY_LENGTH&&Yn(`Max vertices per segment is ${Rr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!y||y.vertexLength+t>Rr.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==m)&&(y={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==m&&(y.sortKey=m),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const t of this.segments)for(const a in t.vaos)t.vaos[a].destroy()}static simpleSegment(t,a,u,m){return new Rr([{vertexOffset:t,primitiveOffset:a,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}Rr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hn(Rr,"SegmentVector");var _n=8192;class il{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Ki?new Ki(t.lng,t.lat):Ki.convert(t),this}setSouthWest(t){return this._sw=t instanceof Ki?new Ki(t.lng,t.lat):Ki.convert(t),this}extend(t){const a=this._sw,u=this._ne;let m,y;if(t instanceof Ki)m=t,y=t;else{if(!(t instanceof il))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(il.convert(t)):this.extend(Ki.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Ki.convert(t)):this;if(m=t._sw,y=t._ne,!m||!y)return this}return a||u?(a.lng=Math.min(m.lng,a.lng),a.lat=Math.min(m.lat,a.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new Ki(m.lng,m.lat),this._ne=new Ki(y.lng,y.lat)),this}getCenter(){return new Ki((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ki(this.getWest(),this.getNorth())}getSouthEast(){return new Ki(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:u}=Ki.convert(t);let m=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&m}static convert(t){return!t||t instanceof il?t:new il(t)}}var ch=1e-6,Ts=typeof Float32Array<"u"?Float32Array:Array;function Pf(){var o=new Ts(9);return Ts!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function rl(o,t,a){var u=t[0],m=t[1],y=t[2],w=t[3],T=t[4],I=t[5],P=t[6],N=t[7],z=t[8],U=a[0],G=a[1],q=a[2],J=a[3],re=a[4],de=a[5],xe=a[6],he=a[7],ve=a[8];return o[0]=U*u+G*w+q*P,o[1]=U*m+G*T+q*N,o[2]=U*y+G*I+q*z,o[3]=J*u+re*w+de*P,o[4]=J*m+re*T+de*N,o[5]=J*y+re*I+de*z,o[6]=xe*u+he*w+ve*P,o[7]=xe*m+he*T+ve*N,o[8]=xe*y+he*I+ve*z,o}function Ko(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function om(o,t){var a=t[0],u=t[1],m=t[2],y=t[3],w=t[4],T=t[5],I=t[6],P=t[7],N=t[8],z=t[9],U=t[10],G=t[11],q=t[12],J=t[13],re=t[14],de=t[15],xe=a*T-u*w,he=a*I-m*w,ve=a*P-y*w,Ce=u*I-m*T,Ee=u*P-y*T,et=m*P-y*I,Ke=N*J-z*q,pt=N*re-U*q,kt=N*de-G*q,ot=z*re-U*J,Tt=z*de-G*J,xt=U*de-G*re,Pt=xe*xt-he*Tt+ve*ot+Ce*kt-Ee*pt+et*Ke;return Pt?(o[0]=(T*xt-I*Tt+P*ot)*(Pt=1/Pt),o[1]=(m*Tt-u*xt-y*ot)*Pt,o[2]=(J*et-re*Ee+de*Ce)*Pt,o[3]=(U*Ee-z*et-G*Ce)*Pt,o[4]=(I*kt-w*xt-P*pt)*Pt,o[5]=(a*xt-m*kt+y*pt)*Pt,o[6]=(re*ve-q*et-de*he)*Pt,o[7]=(N*et-U*ve+G*he)*Pt,o[8]=(w*Tt-T*kt+P*Ke)*Pt,o[9]=(u*kt-a*Tt-y*Ke)*Pt,o[10]=(q*Ee-J*ve+de*xe)*Pt,o[11]=(z*ve-N*Ee-G*xe)*Pt,o[12]=(T*pt-w*ot-I*Ke)*Pt,o[13]=(a*ot-u*pt+m*Ke)*Pt,o[14]=(J*he-q*Ce-re*xe)*Pt,o[15]=(N*Ce-z*he+U*xe)*Pt,o):null}function nd(o,t,a){var u=t[0],m=t[1],y=t[2],w=t[3],T=t[4],I=t[5],P=t[6],N=t[7],z=t[8],U=t[9],G=t[10],q=t[11],J=t[12],re=t[13],de=t[14],xe=t[15],he=a[0],ve=a[1],Ce=a[2],Ee=a[3];return o[0]=he*u+ve*T+Ce*z+Ee*J,o[1]=he*m+ve*I+Ce*U+Ee*re,o[2]=he*y+ve*P+Ce*G+Ee*de,o[3]=he*w+ve*N+Ce*q+Ee*xe,o[4]=(he=a[4])*u+(ve=a[5])*T+(Ce=a[6])*z+(Ee=a[7])*J,o[5]=he*m+ve*I+Ce*U+Ee*re,o[6]=he*y+ve*P+Ce*G+Ee*de,o[7]=he*w+ve*N+Ce*q+Ee*xe,o[8]=(he=a[8])*u+(ve=a[9])*T+(Ce=a[10])*z+(Ee=a[11])*J,o[9]=he*m+ve*I+Ce*U+Ee*re,o[10]=he*y+ve*P+Ce*G+Ee*de,o[11]=he*w+ve*N+Ce*q+Ee*xe,o[12]=(he=a[12])*u+(ve=a[13])*T+(Ce=a[14])*z+(Ee=a[15])*J,o[13]=he*m+ve*I+Ce*U+Ee*re,o[14]=he*y+ve*P+Ce*G+Ee*de,o[15]=he*w+ve*N+Ce*q+Ee*xe,o}function uh(o,t,a){var u,m,y,w,T,I,P,N,z,U,G,q,J=a[0],re=a[1],de=a[2];return t===o?(o[12]=t[0]*J+t[4]*re+t[8]*de+t[12],o[13]=t[1]*J+t[5]*re+t[9]*de+t[13],o[14]=t[2]*J+t[6]*re+t[10]*de+t[14],o[15]=t[3]*J+t[7]*re+t[11]*de+t[15]):(m=t[1],y=t[2],w=t[3],T=t[4],I=t[5],P=t[6],N=t[7],z=t[8],U=t[9],G=t[10],q=t[11],o[0]=u=t[0],o[1]=m,o[2]=y,o[3]=w,o[4]=T,o[5]=I,o[6]=P,o[7]=N,o[8]=z,o[9]=U,o[10]=G,o[11]=q,o[12]=u*J+T*re+z*de+t[12],o[13]=m*J+I*re+U*de+t[13],o[14]=y*J+P*re+G*de+t[14],o[15]=w*J+N*re+q*de+t[15]),o}function Al(o,t,a){var u=a[0],m=a[1],y=a[2];return o[0]=t[0]*u,o[1]=t[1]*u,o[2]=t[2]*u,o[3]=t[3]*u,o[4]=t[4]*m,o[5]=t[5]*m,o[6]=t[6]*m,o[7]=t[7]*m,o[8]=t[8]*y,o[9]=t[9]*y,o[10]=t[10]*y,o[11]=t[11]*y,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o}function Hy(o,t,a){var u=Math.sin(a),m=Math.cos(a),y=t[4],w=t[5],T=t[6],I=t[7],P=t[8],N=t[9],z=t[10],U=t[11];return t!==o&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[4]=y*m+P*u,o[5]=w*m+N*u,o[6]=T*m+z*u,o[7]=I*m+U*u,o[8]=P*m-y*u,o[9]=N*m-w*u,o[10]=z*m-T*u,o[11]=U*m-I*u,o}function sm(o,t,a){var u=Math.sin(a),m=Math.cos(a),y=t[0],w=t[1],T=t[2],I=t[3],P=t[8],N=t[9],z=t[10],U=t[11];return t!==o&&(o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=y*m-P*u,o[1]=w*m-N*u,o[2]=T*m-z*u,o[3]=I*m-U*u,o[8]=y*u+P*m,o[9]=w*u+N*m,o[10]=T*u+z*m,o[11]=I*u+U*m,o}function Gy(o,t){return o[0]=t[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=t[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Wg(o,t,a){var u,m,y,w=a[0],T=a[1],I=a[2],P=Math.hypot(w,T,I);return P<ch?null:(w*=P=1/P,T*=P,I*=P,u=Math.sin(t),m=Math.cos(t),o[0]=w*w*(y=1-m)+m,o[1]=T*w*y+I*u,o[2]=I*w*y-T*u,o[3]=0,o[4]=w*T*y-I*u,o[5]=T*T*y+m,o[6]=I*T*y+w*u,o[7]=0,o[8]=w*I*y+T*u,o[9]=T*I*y-w*u,o[10]=I*I*y+m,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,t=arguments.length;t--;)o+=arguments[t]*arguments[t];return Math.sqrt(o)});var eu=nd;function am(){var o=new Ts(3);return Ts!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function lm(o){var t=new Ts(3);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t}function dh(o){return Math.hypot(o[0],o[1],o[2])}function hh(o,t,a){var u=new Ts(3);return u[0]=o,u[1]=t,u[2]=a,u}function ol(o,t,a){return o[0]=t[0]+a[0],o[1]=t[1]+a[1],o[2]=t[2]+a[2],o}function fh(o,t,a){return o[0]=t[0]-a[0],o[1]=t[1]-a[1],o[2]=t[2]-a[2],o}function sl(o,t,a){return o[0]=t[0]*a[0],o[1]=t[1]*a[1],o[2]=t[2]*a[2],o}function tu(o,t,a){return o[0]=Math.min(t[0],a[0]),o[1]=Math.min(t[1],a[1]),o[2]=Math.min(t[2],a[2]),o}function Ys(o,t,a){return o[0]=Math.max(t[0],a[0]),o[1]=Math.max(t[1],a[1]),o[2]=Math.max(t[2],a[2]),o}function ds(o,t,a){return o[0]=t[0]*a,o[1]=t[1]*a,o[2]=t[2]*a,o}function dc(o,t,a,u){return o[0]=t[0]+a[0]*u,o[1]=t[1]+a[1]*u,o[2]=t[2]+a[2]*u,o}function eo(o,t){var a=t[0],u=t[1],m=t[2],y=a*a+u*u+m*m;return y>0&&(y=1/Math.sqrt(y)),o[0]=t[0]*y,o[1]=t[1]*y,o[2]=t[2]*y,o}function Aa(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]}function Zy(o,t,a){var u=t[0],m=t[1],y=t[2],w=a[0],T=a[1],I=a[2];return o[0]=m*I-y*T,o[1]=y*w-u*I,o[2]=u*T-m*w,o}function Vr(o,t,a){var u=t[0],m=t[1],y=t[2],w=a[3]*u+a[7]*m+a[11]*y+a[15];return o[0]=(a[0]*u+a[4]*m+a[8]*y+a[12])/(w=w||1),o[1]=(a[1]*u+a[5]*m+a[9]*y+a[13])/w,o[2]=(a[2]*u+a[6]*m+a[10]*y+a[14])/w,o}function eb(o,t,a){var u=a[0],m=a[1],y=a[2],w=t[0],T=t[1],I=t[2],P=m*I-y*T,N=y*w-u*I,z=u*T-m*w,U=m*z-y*N,G=y*P-u*z,q=u*N-m*P,J=2*a[3];return N*=J,z*=J,G*=2,q*=2,o[0]=w+(P*=J)+(U*=2),o[1]=T+N+G,o[2]=I+z+q,o}var cm,al=fh,um=sl,dm=dh;function qg(o,t,a){return o[0]=t[0]*a,o[1]=t[1]*a,o[2]=t[2]*a,o[3]=t[3]*a,o}function Yg(o,t){var a=t[0],u=t[1],m=t[2],y=t[3],w=a*a+u*u+m*m+y*y;return w>0&&(w=1/Math.sqrt(w)),o[0]=a*w,o[1]=u*w,o[2]=m*w,o[3]=y*w,o}function nu(o,t,a){var u=t[0],m=t[1],y=t[2],w=t[3];return o[0]=a[0]*u+a[4]*m+a[8]*y+a[12]*w,o[1]=a[1]*u+a[5]*m+a[9]*y+a[13]*w,o[2]=a[2]*u+a[6]*m+a[10]*y+a[14]*w,o[3]=a[3]*u+a[7]*m+a[11]*y+a[15]*w,o}function iu(){var o=new Ts(4);return Ts!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Of(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Rf(o,t,a){a*=.5;var u=t[0],m=t[1],y=t[2],w=t[3],T=Math.sin(a),I=Math.cos(a);return o[0]=u*I+w*T,o[1]=m*I+y*T,o[2]=y*I-m*T,o[3]=w*I-u*T,o}function hm(o,t,a){a*=.5;var u=t[0],m=t[1],y=t[2],w=t[3],T=Math.sin(a),I=Math.cos(a);return o[0]=u*I-y*T,o[1]=m*I+w*T,o[2]=y*I+u*T,o[3]=w*I-m*T,o}am(),cm=new Ts(4),Ts!=Float32Array&&(cm[0]=0,cm[1]=0,cm[2]=0,cm[3]=0);var fm=Yg;am(),hh(1,0,0),hh(0,1,0),iu(),iu(),Pf();const ru=Re([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Xg}=ru,pm=Re([{name:"a_pos_3",components:3,type:"Int16"}]);var id=Re([{name:"a_pos",type:"Int16",components:2}]);class Pa{constructor(t,a){this.pos=t,this.dir=a}intersectsPlane(t,a,u){const m=Aa(a,this.dir);if(Math.abs(m)<1e-6)return!1;const y=((t[0]-this.pos[0])*a[0]+(t[1]-this.pos[1])*a[1]+(t[2]-this.pos[2])*a[2])/m;return u[0]=this.pos[0]+this.dir[0]*y,u[1]=this.pos[1]+this.dir[1]*y,u[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(t,a,u){if(J=(G=this.pos)[0],re=G[1],de=G[2],xe=(q=t)[0],he=q[1],ve=q[2],Math.abs(J-xe)<=ch*Math.max(1,Math.abs(J),Math.abs(xe))&&Math.abs(re-he)<=ch*Math.max(1,Math.abs(re),Math.abs(he))&&Math.abs(de-ve)<=ch*Math.max(1,Math.abs(de),Math.abs(ve))||0===a)return u[0]=u[1]=u[2]=0,!1;var G,q,J,re,de,xe,he,ve;const[m,y,w]=this.dir,T=this.pos[0]-t[0],I=this.pos[1]-t[1],P=this.pos[2]-t[2],N=m*m+y*y+w*w,z=2*(T*m+I*y+P*w),U=z*z-4*N*(T*T+I*I+P*P-a*a);if(U<0){const G=Math.max(-z/2,0),q=T+m*G,J=I+y*G,re=P+w*G,de=Math.hypot(q,J,re);return u[0]=q*a/de,u[1]=J*a/de,u[2]=re*a/de,!1}{const G=(-z-Math.sqrt(U))/(2*N);if(G<0){const q=Math.hypot(T,I,P);return u[0]=T*a/q,u[1]=I*a/q,u[2]=P*a/q,!1}return u[0]=T+m*G,u[1]=I+y*G,u[2]=P+w*G,!0}}}class Pl{constructor(t,a,u,m,y){this.TL=t,this.TR=a,this.BR=u,this.BL=m,this.horizon=y}static fromInvProjectionMatrix(t,a,u){const m=[-1,1,1],y=[1,1,1],w=[1,-1,1],T=[-1,-1,1],I=Vr(m,m,t),P=Vr(y,y,t),N=Vr(w,w,t),z=Vr(T,T,t);return new Pl(I,P,N,z,a/u)}}class mm{constructor(t,a){this.points=t,this.planes=a}static fromInvProjectionMatrix(t,a,u,m){const y=Math.pow(2,u),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const P=nu([],I,t),N=1/P[3]/a*y;return(z=P)[0]=(U=P)[0]*(G=[N,N,m?1/P[3]:N,N])[0],z[1]=U[1]*G[1],z[2]=U[2]*G[2],z[3]=U[3]*G[3],z;var z,U,G}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const P=eo([],Zy([],al([],w[I[0]],w[I[1]]),al([],w[I[2]],w[I[1]]))),N=-Aa(P,w[I[1]]);return P.concat(N)});return new mm(w,T)}}class Jo{static fromPoints(t){const a=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const m of t)tu(a,a,m),Ys(u,u,m);return new Jo(a,u)}static applyTransform(t,a){const u=t.getCorners();for(let m=0;m<u.length;++m)Vr(u[m],u[m],a);return Jo.fromPoints(u)}constructor(t,a){this.min=t,this.max=a,this.center=ds([],ol([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],u=lm(this.min),m=lm(this.max);for(let y=0;y<a.length;y++)u[y]=a[y]?this.min[y]:this.center[y],m[y]=a[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new Jo(u,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,a=this.max;return[[t[0],t[1],t[2]],[a[0],t[1],t[2]],[a[0],a[1],t[2]],[t[0],a[1],t[2]],[t[0],t[1],a[2]],[a[0],t[1],a[2]],[a[0],a[1],a[2]],[t[0],a[1],a[2]]]}intersects(t){const a=this.getCorners();let u=!0;for(let m=0;m<t.planes.length;m++){const y=t.planes[m];let w=0;for(let T=0;T<a.length;T++)w+=Aa(y,a[T])+y[3]>=0;if(0===w)return 0;w!==a.length&&(u=!1)}if(u)return 2;for(let m=0;m<3;m++){let y=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let T=0;T<t.points.length;T++){const I=t.points[T][m]-this.min[m];y=Math.min(y,I),w=Math.max(w,I)}if(w<0||y>this.max[m]-this.min[m])return 0}return 1}}const Kg=5,hc=6,ll=_n/Math.PI/2,tb=16383,ou=[64,32,16],Ms=-ll,Ds=ll,Ro=[new Jo([Ms,Ms,Ms],[Ds,Ds,Ds]),new Jo([Ms,Ms,Ms],[0,0,Ds]),new Jo([0,Ms,Ms],[Ds,0,Ds]),new Jo([Ms,0,Ms],[0,Ds,Ds]),new Jo([0,0,Ms],[Ds,Ds,Ds])];function Ol(o){return o*ll/Ss}function kf(o,t,a,u=!0){const m=ds([],o._camera.position,o.worldSize),y=[t,a,1,1];nu(y,y,o.pixelMatrixInverse),qg(y,y,1/y[3]);const w=eo([],al([],y,m)),T=o.globeMatrix,I=[T[12],T[13],T[14]],P=al([],I,m),N=dh(P),z=eo([],P),U=o.worldSize/(2*Math.PI),G=Aa(z,w),q=Math.asin(U/N);if(q<Math.acos(G)){if(!u)return null;const kt=[],ot=[];ds(kt,w,N/G),eo(ot,al(ot,kt,P)),eo(w,ol(w,P,ds(w,ot,Math.tan(q)*N)))}const J=[];new Pa(m,w).closestPointOnSphere(I,U,J);const re=eo([],wo(T,0)),de=eo([],wo(T,1)),xe=eo([],wo(T,2)),he=Aa(re,J),ve=Aa(de,J),Ce=Aa(xe,J),Ee=Kt(Math.asin(-ve/U));let et=Kt(Math.atan2(he,Ce));et=o.center.lng+function(kt,ot){const Tt=(ot-kt+180)%360-180;return Tt<-180?Tt+360:Tt}(o.center.lng,et);const Ke=Rl(et),pt=Wn(ka(Ee),0,1);return new ld(Ke,pt)}class Wy{constructor(t,a,u){this.a=al([],t,u),this.b=al([],a,u),this.center=u;const m=eo([],this.a),y=eo([],this.b);this.angle=Math.acos(Aa(m,y))}}function ph(o,t){if(0===o.angle)return null;let a;return a=0===o.a[t]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[t]/o.a[t]/Math.sin(o.angle)-1/Math.tan(o.angle)),a<0||a>1?null:function(u,m,y,w){const T=Math.sin(y);return u*(Math.sin((1-w)*y)/T)+m*(Math.sin(w*y)/T)}(o.a[t],o.b[t],o.angle,Wn(a,0,1))+o.center[t]}function Oa(o){if(o.z<=1)return Ro[o.z+2*o.y+o.x];const t=gm(mh(o));return Jo.fromPoints(t)}function rd(o,t,a){return ds(o,o,1-a),dc(o,o,t,a)}function od(o,t){const a=_h(t.zoom);if(0===a)return Oa(o);const u=mh(o),m=gm(u),y=Rl(u.getWest())*t.worldSize,w=Rl(u.getEast())*t.worldSize,T=ka(u.getNorth())*t.worldSize,I=ka(u.getSouth())*t.worldSize,P=[y,T,0],N=[w,T,0],z=[y,I,0],U=[w,I,0],G=om([],t.globeMatrix);return Vr(P,P,G),Vr(N,N,G),Vr(z,z,G),Vr(U,U,G),m[0]=rd(m[0],z,a),m[1]=rd(m[1],U,a),m[2]=rd(m[2],N,a),m[3]=rd(m[3],P,a),Jo.fromPoints(m)}function qy(o,t,a){for(const u of o)Vr(u,u,t),ds(u,u,a)}function mh({x:o,y:t,z:a}){const u=1/(1<<a),m=new Ki(Is(o*u),po((t+1)*u)),y=new Ki(Is((o+1)*u),po(t*u));return new il(m,y)}function gm(o){const t=Ft(o.getNorth()),a=Ft(o.getSouth()),u=Math.cos(t),m=Math.cos(a),y=Math.sin(t),w=Math.sin(a),T=o.getWest(),I=o.getEast();return[fc(m,w,T),fc(m,w,I),fc(u,y,I),fc(u,y,T)]}function fc(o,t,a,u=ll){return a=Ft(a),[o*Math.sin(a)*u,-t*u,o*Math.cos(a)*u]}function su(o,t,a){return fc(Math.cos(Ft(o)),Math.sin(Ft(o)),t,a)}function gh(o,t,a,u){const m=1<<a.z,y=(o/_n+a.x)/m;return su(po((t/_n+a.y)/m),Is(y),u)}function pc({min:o,max:t}){return tb/Math.max(t[0]-o[0],t[1]-o[1],t[2]-o[2])}const Xy=new Float64Array(16);function _m(o){const t=pc(o),a=Gy(Xy,[t,t,t]);return uh(a,a,((u=[])[0]=-(m=o.min)[0],u[1]=-m[1],u[2]=-m[2],u));var u,m}function Jg(o){const t=(u=o.min,(a=Xy)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=u[0],a[13]=u[1],a[14]=u[2],a[15]=1,a);var a,u;const m=1/pc(o);return Al(t,t,[m,m,m])}function Ky(o,t,a,u,m){const y=function(I){const P=_n/(2*Math.PI);return I/(2*Math.PI)/P}(a),w=[o,t,-a/(2*Math.PI)],T=Ko(new Float64Array(16));return uh(T,T,w),Al(T,T,[y,y,y]),Hy(T,T,Ft(-m)),sm(T,T,Ft(-u)),T}function _h(o){return ia(Kg,hc,o)}function sd(o,t){const a=su(t.lat,t.lng);return w=(m=fh([],function(q){const J=su(q._center.lat,q._center.lng);let re=Zy([],hh(0,1,0),J);const de=Wg([],-q.angle,J);re=Vr(re,re,de),Wg(de,-q._pitch,re);const xe=eo([],J);return ds(xe,xe,Ol(q.cameraToCenterDistance/q.pixelsPerMeter)),Vr(xe,xe,de),ol([],J,xe)}(o),a))[0],T=m[1],I=m[2],P=(y=a)[0],N=y[1],z=y[2],G=(U=Math.sqrt(w*w+T*T+I*I)*Math.sqrt(P*P+N*N+z*z))&&Aa(m,y)/U,Math.acos(Math.min(Math.max(G,-1),1));var m,y,w,T,I,P,N,z,U,G}function Ff(o,t){return sd(o,t)>Math.PI/2*1.01}const Qg=Ft(85),e_=Math.cos(Qg),yh=Math.sin(Qg),Ss=6371008.8,Jy=2*Math.PI*Ss;class Ra{constructor(t,a){if(isNaN(t)||isNaN(a))throw new Error(`Invalid LngLat object: (${t}, ${a})`);if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ra(Si(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const a=Math.PI/180,u=this.lat*a,m=t.lat*a,y=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((t.lng-this.lng)*a);return Ss*Math.acos(Math.min(y,1))}toBounds(t=0){const a=360*t/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new il(new Ra(this.lng-u,this.lat-a),new Ra(this.lng+u,this.lat+a))}toEcef(t){const a=Ol(t);return su(this.lat,this.lng,ll+a)}static convert(t){if(t instanceof Ra)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Ra(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Ra(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Ki=Ra;function t_(o){return Jy*Math.cos(o*Math.PI/180)}function Rl(o){return(180+o)/360}function ka(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Qo(o,t){return o/t_(t)}function Is(o){return 360*o-180}function po(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function ad(o,t){return o*t_(po(t))}const Yr=85.051129;function ym(o){return 1/Math.cos(o*Math.PI/180)}class ld{constructor(t,a,u=0){this.x=+t,this.y=+a,this.z=+u}static fromLngLat(t,a=0){const u=Ki.convert(t);return new ld(Rl(u.lng),ka(u.lat),Qo(a,u.lat))}toLngLat(){return new Ki(Is(this.x),po(this.y))}toAltitude(){return ad(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Jy*ym(po(this.y))}}function pa(o,t,a,u,m,y,w,T,I){const P=(t+u)/2,N=(a+m)/2,z=new Ne(P,N);T(z),function(U,G,q,J,re,de){const xe=q-re,he=J-de;return Math.abs((J-G)*xe-(q-U)*he)/Math.hypot(xe,he)}(z.x,z.y,y.x,y.y,w.x,w.y)>=I?(pa(o,t,a,P,N,y,z,T,I),pa(o,P,N,u,m,z,w,T,I)):o.push(w)}function cd(o,t,a){let u=o[0],m=u.x,y=u.y;t(u);const w=[u];for(let T=1;T<o.length;T++){const I=o[T],{x:P,y:N}=I;t(I),pa(w,m,y,P,N,u,I,t,a),m=P,y=N,u=I}return w}function vm(o,t,a,u){if(u(t,a)){const m=t.add(a)._mult(.5);vm(o,t,m,u),vm(o,m,a,u)}else o.push(a)}function nb(o,t){let a=o[0];const u=[a];for(let m=1;m<o.length;m++){const y=o[m];vm(u,a,y,t),a=y}return u}const Qy=Math.pow(2,14)-1,Lf=-Qy-1;function ib(o,t){const a=Math.round(o.x*t),u=Math.round(o.y*t);return o.x=Wn(a,Lf,Qy),o.y=Wn(u,Lf,Qy),(a<o.x||a>o.x+1||u<o.y||u>o.y+1)&&Yn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function kl(o,t,a){const u=o.loadGeometry(),m=o.extent,y=_n/m;if(t&&a&&a.projection.isReprojectedInTileSpace){const w=1<<t.z,{scale:T,x:I,y:P,projection:N}=a,z=U=>{const G=Is((t.x+U.x/m)/w),q=po((t.y+U.y/m)/w),J=N.project(G,q);U.x=(J.x*T-I)*m,U.y=(J.y*T-P)*m};for(let U=0;U<u.length;U++)if(1!==o.type)u[U]=cd(u[U],z,1);else{const G=[];for(const q of u[U])q.x<0||q.x>=m||q.y<0||q.y>=m||(z(q),G.push(q));u[U]=G}}for(const w of u)for(const T of w)ib(T,y);return u}function ud(o,t){return{type:o.type,id:o.id,properties:o.properties,geometry:t?kl(o):[]}}function Nf(o,t,a,u,m){o.emplaceBack(2*t+(u+1)/2,2*a+(m+1)/2)}function dd(o,t,a){o.emplaceBack(t.x,t.y,t.z,16384*a[0],16384*a[1],16384*a[2])}class hd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new At,this.indexArray=new ln,this.segments=new Rr,this.programConfigurations=new uc(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,u,m){const y=this.layers[0],w=[];let T=null;"circle"===y.type&&(T=y.layout.get("circle-sort-key"));for(const{feature:P,id:N,index:z,sourceLayerIndex:U}of t){const G=this.layers[0]._featureFilter.needGeometry,q=ud(P,G);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),q,u))continue;const J=T?T.evaluate(q,{},u):void 0,re={id:N,properties:P.properties,type:P.type,sourceLayerIndex:U,index:z,geometry:G?q.geometry:kl(P,u,m),patterns:{},sortKey:J};w.push(re)}T&&w.sort((P,N)=>P.sortKey-N.sortKey);let I=null;"globe"===m.projection.name&&(this.globeExtVertexArray=new Lt,I=m.projection);for(const P of w){const{geometry:N,index:z,sourceLayerIndex:U}=P,G=t[z].feature;this.addFeature(P,N,z,a.availableImages,u,I),a.featureIndex.insert(G,N,z,U,this.index)}}update(t,a,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,u,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Af.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,$y.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,a,u,m,y,w){for(const T of a)for(const I of T){const P=I.x,N=I.y;if(P<0||P>=_n||N<0||N>=_n)continue;if(w){const G=w.projectTilePoint(P,N,y),q=w.upVector(y,P,N),J=this.globeExtVertexArray;dd(J,G,q),dd(J,G,q),dd(J,G,q),dd(J,G,q)}const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),U=z.vertexLength;Nf(this.layoutVertexArray,P,N,-1,-1),Nf(this.layoutVertexArray,P,N,1,-1),Nf(this.layoutVertexArray,P,N,1,1),Nf(this.layoutVertexArray,P,N,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+2,U+3),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},m,y)}}function Fl(o,t){for(let a=0;a<o.length;a++)if(au(t,o[a]))return!0;for(let a=0;a<t.length;a++)if(au(o,t[a]))return!0;return!!vh(o,t)}function Bf(o,t,a){return!!au(o,t)||!!zf(t,o,a)}function n_(o,t){if(1===o.length)return tv(t,o[0]);for(let a=0;a<t.length;a++){const u=t[a];for(let m=0;m<u.length;m++)if(au(o,u[m]))return!0}for(let a=0;a<o.length;a++)if(tv(t,o[a]))return!0;for(let a=0;a<t.length;a++)if(vh(o,t[a]))return!0;return!1}function i_(o,t,a){if(o.length>1){if(vh(o,t))return!0;for(let u=0;u<t.length;u++)if(zf(t[u],o,a))return!0}for(let u=0;u<o.length;u++)if(zf(o[u],t,a))return!0;return!1}function vh(o,t){if(0===o.length||0===t.length)return!1;for(let a=0;a<o.length-1;a++){const u=o[a],m=o[a+1];for(let y=0;y<t.length-1;y++)if(ev(u,m,t[y],t[y+1]))return!0}return!1}function ev(o,t,a,u){return ji(o,a,u)!==ji(t,a,u)&&ji(o,t,a)!==ji(o,t,u)}function zf(o,t,a){const u=a*a;if(1===t.length)return o.distSqr(t[0])<u;for(let m=1;m<t.length;m++)if(bh(o,t[m-1],t[m])<u)return!0;return!1}function bh(o,t,a){const u=t.distSqr(a);if(0===u)return o.distSqr(t);const m=((o.x-t.x)*(a.x-t.x)+(o.y-t.y)*(a.y-t.y))/u;return o.distSqr(m<0?t:m>1?a:a.sub(t)._mult(m)._add(t))}function tv(o,t){let a,u,m,y=!1;for(let w=0;w<o.length;w++){a=o[w];for(let T=0,I=a.length-1;T<a.length;I=T++)u=a[T],m=a[I],u.y>t.y!=m.y>t.y&&t.x<(m.x-u.x)*(t.y-u.y)/(m.y-u.y)+u.x&&(y=!y)}return y}function au(o,t){let a=!1;for(let u=0,m=o.length-1;u<o.length;m=u++){const y=o[u],w=o[m];y.y>t.y!=w.y>t.y&&t.x<(w.x-y.x)*(t.y-y.y)/(w.y-y.y)+y.x&&(a=!a)}return a}function r_(o,t,a,u,m){for(const w of o)if(t<=w.x&&a<=w.y&&u>=w.x&&m>=w.y)return!0;const y=[new Ne(t,a),new Ne(t,m),new Ne(u,m),new Ne(u,a)];if(o.length>2)for(const w of y)if(au(o,w))return!0;for(let w=0;w<o.length-1;w++)if(rb(o[w],o[w+1],y))return!0;return!1}function rb(o,t,a){const u=a[0],m=a[2];if(o.x<u.x&&t.x<u.x||o.x>m.x&&t.x>m.x||o.y<u.y&&t.y<u.y||o.y>m.y&&t.y>m.y)return!1;const y=ji(o,t,a[0]);return y!==ji(o,t,a[1])||y!==ji(o,t,a[2])||y!==ji(o,t,a[3])}function mc(o,t,a){const u=t.paint.get(o).value;return"constant"===u.kind?u.value:a.programConfigurations.get(t.id).getMaxValue(o)}function xh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function lu(o,t,a,u,m){if(!t[0]&&!t[1])return o;const y=Ne.convert(t)._mult(m);"viewport"===a&&y._rotate(-u);const w=[];for(let T=0;T<o.length;T++)w.push(o[T].sub(y));return w}function wh(o,t,a,u){const m=Ne.convert(o)._mult(u);return"viewport"===t&&m._rotate(-a),m}hn(hd,"CircleBucket",{omit:["layers"]});const o_=new ge({"circle-sort-key":new oe(ct.layout_circle["circle-sort-key"])});var Eh={paint:new ge({"circle-radius":new oe(ct.paint_circle["circle-radius"]),"circle-color":new oe(ct.paint_circle["circle-color"]),"circle-blur":new oe(ct.paint_circle["circle-blur"]),"circle-opacity":new oe(ct.paint_circle["circle-opacity"]),"circle-translate":new K(ct.paint_circle["circle-translate"]),"circle-translate-anchor":new K(ct.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new K(ct.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new K(ct.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new oe(ct.paint_circle["circle-stroke-width"]),"circle-stroke-color":new oe(ct.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new oe(ct.paint_circle["circle-stroke-opacity"])}),layout:o_};function nv(o,t,a,u,m,y,w,T,I){if(y&&o.queryGeometry.isAboveHorizon)return!1;y&&(I*=o.pixelToTileUnitsFactor);const P=o.tileID.canonical,N=a.projection.upVectorScale(P,a.center.lat,a.worldSize).metersToTile;for(const z of t)for(const U of z){const G=U.add(T),q=m&&a.elevation?a.elevation.exaggeration()*m.getElevationAt(G.x,G.y,!0):0,J=a.projection.projectTilePoint(G.x,G.y,P);if(q>0){const he=a.projection.upVector(P,G.x,G.y);J.x+=he[0]*N*q,J.y+=he[1]*N*q,J.z+=he[2]*N*q}const re=y?G:s_(J.x,J.y,J.z,u),de=y?o.tilespaceRays.map(he=>bm(he,q)):o.queryGeometry.screenGeometry,xe=nu([],[J.x,J.y,J.z,1],u);if(!w&&y?I*=xe[3]/a.cameraToCenterDistance:w&&!y&&(I*=a.cameraToCenterDistance/xe[3]),y){const he=po((U.y/_n+P.y)/(1<<P.z));I/=a.projection.pixelsPerMeter(he,1)/Qo(1,he)}if(Bf(de,re,I))return!0}return!1}function s_(o,t,a,u){const m=nu([],[o,t,a,1],u);return new Ne(m[0]/m[3],m[1]/m[3])}const ob=hh(0,0,0),a_=hh(0,0,1);function bm(o,t){const a=am();return ob[2]=t,o.intersectsPlane(ob,a_,a),new Ne(a[0],a[1])}class iv extends hd{}function fd(o,{width:t,height:a},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==t*a*u)throw new RangeError("mismatched image size")}else m=new Uint8Array(t*a*u);return o.width=t,o.height=a,o.data=m,o}function Vf(o,t,a){const{width:u,height:m}=t;u===o.width&&m===o.height||(Uf(o,t,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,u),height:Math.min(o.height,m)},a),o.width=u,o.height=m,o.data=t.data)}function Uf(o,t,a,u,m,y){if(0===m.width||0===m.height)return t;if(m.width>o.width||m.height>o.height||a.x>o.width-m.width||a.y>o.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>t.width||m.height>t.height||u.x>t.width-m.width||u.y>t.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const w=o.data,T=t.data;for(let I=0;I<m.height;I++){const P=((a.y+I)*o.width+a.x)*y,N=((u.y+I)*t.width+u.x)*y;for(let z=0;z<m.width*y;z++)T[N+z]=w[P+z]}return t}hn(iv,"HeatmapBucket",{omit:["layers"]});class ma{constructor(t,a){fd(this,t,1,a)}resize(t){Vf(this,new ma(t),1)}clone(){return new ma({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,u,m,y){Uf(t,a,u,m,y,1)}}class As{constructor(t,a){fd(this,t,4,a)}resize(t){Vf(this,new As(t),4)}replace(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new As({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,u,m,y){Uf(t,a,u,m,y,4)}}hn(ma,"AlphaImage"),hn(As,"RGBAImage");var rv={paint:new ge({"heatmap-radius":new oe(ct.paint_heatmap["heatmap-radius"]),"heatmap-weight":new oe(ct.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new K(ct.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pe(ct.paint_heatmap["heatmap-color"]),"heatmap-opacity":new K(ct.paint_heatmap["heatmap-opacity"])})};function xm(o){const t={},a=o.resolution||256,u=o.clips?o.clips.length:1,m=o.image||new As({width:a,height:u}),y=(w,T,I)=>{t[o.evaluationKey]=I;const P=o.expression.evaluate(t);m.data[w+T+0]=Math.floor(255*P.r/P.a),m.data[w+T+1]=Math.floor(255*P.g/P.a),m.data[w+T+2]=Math.floor(255*P.b/P.a),m.data[w+T+3]=Math.floor(255*P.a)};if(o.clips)for(let w=0,T=0;w<u;++w,T+=4*a)for(let I=0,P=0;I<a;I++,P+=4){const N=I/(a-1),{start:z,end:U}=o.clips[w];y(T,P,z*(1-N)+U*N)}else for(let w=0,T=0;w<a;w++,T+=4)y(0,T,w/(a-1));return m}var sb={paint:new ge({"hillshade-illumination-direction":new K(ct.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new K(ct.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new K(ct.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new K(ct.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new K(ct.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new K(ct.paint_hillshade["hillshade-accent-color"])})};const ab=Re([{name:"a_pos",components:2,type:"Int16"}],4),{members:lb}=ab;var wm={exports:{}};function l_(o,t,a){a=a||2;var u,m,y,w,T,I,P,N=t&&t.length,z=N?t[0]*a:o.length,U=Ll(o,0,z,a,!0),G=[];if(!U||U.next===U.prev)return G;if(N&&(U=function(J,re,de,xe){var he,ve,Ce,Ee=[];for(he=0,ve=re.length;he<ve;he++)(Ce=Ll(J,re[he]*xe,he<ve-1?re[he+1]*xe:J.length,xe,!1))===Ce.next&&(Ce.steiner=!0),Ee.push(d_(Ce));for(Ee.sort(uw),he=0;he<Ee.length;he++)de=c_(Ee[he],de);return de}(o,t,U,a)),o.length>80*a){u=y=o[0],m=w=o[1];for(var q=a;q<z;q+=a)(T=o[q])<u&&(u=T),(I=o[q+1])<m&&(m=I),T>y&&(y=T),I>w&&(w=I);P=0!==(P=Math.max(y-u,w-m))?32767/P:0}return jf(U,G,a,u,m,P,0),G}function Ll(o,t,a,u,m){var y,w;if(m===Th(o,t,a,u)>0)for(y=t;y<a;y+=u)w=Mm(y,o[y],o[y+1],w);else for(y=a-u;y>=t;y-=u)w=Mm(y,o[y],o[y+1],w);return w&&gc(w,w.next)&&(pd(w),w=w.next),w}function Fa(o,t){if(!o)return o;t||(t=o);var a,u=o;do{if(a=!1,u.steiner||!gc(u,u.next)&&0!==ki(u.prev,u,u.next))u=u.next;else{if(pd(u),(u=t=u.prev)===u.next)break;a=!0}}while(a||u!==t);return t}function jf(o,t,a,u,m,y,w){if(o){!w&&y&&function(N,z,U,G){var q=N;do{0===q.z&&(q.z=cu(q.x,q.y,z,U,G)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next}while(q!==N);q.prevZ.nextZ=null,q.prevZ=null,function(J){var re,de,xe,he,ve,Ce,Ee,et,Ke=1;do{for(de=J,J=null,ve=null,Ce=0;de;){for(Ce++,xe=de,Ee=0,re=0;re<Ke&&(Ee++,xe=xe.nextZ);re++);for(et=Ke;Ee>0||et>0&&xe;)0!==Ee&&(0===et||!xe||de.z<=xe.z)?(he=de,de=de.nextZ,Ee--):(he=xe,xe=xe.nextZ,et--),ve?ve.nextZ=he:J=he,he.prevZ=ve,ve=he;de=xe}ve.nextZ=null,Ke*=2}while(Ce>1)}(q)}(o,u,m,y);for(var T,I,P=o;o.prev!==o.next;)if(T=o.prev,I=o.next,y?aw(o,u,m,y):sw(o))t.push(T.i/a|0),t.push(o.i/a|0),t.push(I.i/a|0),pd(o),o=I.next,P=I.next;else if((o=I)===P){w?1===w?jf(o=lw(Fa(o),t,a),t,a,u,m,y,2):2===w&&cw(o,t,a,u,m,y):jf(Fa(o),t,a,u,m,y,1);break}}}function sw(o){var t=o.prev,a=o,u=o.next;if(ki(t,a,u)>=0)return!1;for(var m=t.x,y=a.x,w=u.x,T=t.y,I=a.y,P=u.y,N=m<y?m<w?m:w:y<w?y:w,z=T<I?T<P?T:P:I<P?I:P,U=m>y?m>w?m:w:y>w?y:w,G=T>I?T>P?T:P:I>P?I:P,q=u.next;q!==t;){if(q.x>=N&&q.x<=U&&q.y>=z&&q.y<=G&&Ch(m,T,y,I,w,P,q.x,q.y)&&ki(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function aw(o,t,a,u){var m=o.prev,y=o,w=o.next;if(ki(m,y,w)>=0)return!1;for(var T=m.x,I=y.x,P=w.x,N=m.y,z=y.y,U=w.y,G=T<I?T<P?T:P:I<P?I:P,q=N<z?N<U?N:U:z<U?z:U,J=T>I?T>P?T:P:I>P?I:P,re=N>z?N>U?N:U:z>U?z:U,de=cu(G,q,t,a,u),xe=cu(J,re,t,a,u),he=o.prevZ,ve=o.nextZ;he&&he.z>=de&&ve&&ve.z<=xe;){if(he.x>=G&&he.x<=J&&he.y>=q&&he.y<=re&&he!==m&&he!==w&&Ch(T,N,I,z,P,U,he.x,he.y)&&ki(he.prev,he,he.next)>=0||(he=he.prevZ,ve.x>=G&&ve.x<=J&&ve.y>=q&&ve.y<=re&&ve!==m&&ve!==w&&Ch(T,N,I,z,P,U,ve.x,ve.y)&&ki(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;he&&he.z>=de;){if(he.x>=G&&he.x<=J&&he.y>=q&&he.y<=re&&he!==m&&he!==w&&Ch(T,N,I,z,P,U,he.x,he.y)&&ki(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;ve&&ve.z<=xe;){if(ve.x>=G&&ve.x<=J&&ve.y>=q&&ve.y<=re&&ve!==m&&ve!==w&&Ch(T,N,I,z,P,U,ve.x,ve.y)&&ki(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function lw(o,t,a){var u=o;do{var m=u.prev,y=u.next.next;!gc(m,y)&&Cm(m,u,u.next,y)&&Tm(m,y)&&Tm(y,m)&&(t.push(m.i/a|0),t.push(u.i/a|0),t.push(y.i/a|0),pd(u),pd(u.next),u=o=y),u=u.next}while(u!==o);return Fa(u)}function cw(o,t,a,u,m,y){var w=o;do{for(var T=w.next.next;T!==w.prev;){if(w.i!==T.i&&Em(w,T)){var I=cb(w,T);return w=Fa(w,w.next),I=Fa(I,I.next),jf(w,t,a,u,m,y,0),void jf(I,t,a,u,m,y,0)}T=T.next}w=w.next}while(w!==o)}function uw(o,t){return o.x-t.x}function c_(o,t){var a=function(m,y){var w,T=y,I=m.x,P=m.y,N=-1/0;do{if(P<=T.y&&P>=T.next.y&&T.next.y!==T.y){var z=T.x+(P-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(z<=I&&z>N&&(N=z,w=T.x<T.next.x?T:T.next,z===I))return w}T=T.next}while(T!==y);if(!w)return null;var U,G=w,q=w.x,J=w.y,re=1/0;T=w;do{I>=T.x&&T.x>=q&&I!==T.x&&Ch(P<J?I:N,P,q,J,P<J?N:I,P,T.x,T.y)&&(U=Math.abs(P-T.y)/(I-T.x),Tm(T,m)&&(U<re||U===re&&(T.x>w.x||T.x===w.x&&u_(w,T)))&&(w=T,re=U)),T=T.next}while(T!==G);return w}(o,t);if(!a)return t;var u=cb(a,o);return Fa(u,u.next),Fa(a,a.next)}function u_(o,t){return ki(o.prev,o,t.prev)<0&&ki(t.next,o,o.next)<0}function cu(o,t,a,u,m){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-a)*m|0)|o<<8))|o<<4))|o<<2))|o<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*m|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d_(o){var t=o,a=o;do{(t.x<a.x||t.x===a.x&&t.y<a.y)&&(a=t),t=t.next}while(t!==o);return a}function Ch(o,t,a,u,m,y,w,T){return(m-w)*(t-T)>=(o-w)*(y-T)&&(o-w)*(u-T)>=(a-w)*(t-T)&&(a-w)*(y-T)>=(m-w)*(u-T)}function Em(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!function(a,u){var m=a;do{if(m.i!==a.i&&m.next.i!==a.i&&m.i!==u.i&&m.next.i!==u.i&&Cm(m,m.next,a,u))return!0;m=m.next}while(m!==a);return!1}(o,t)&&(Tm(o,t)&&Tm(t,o)&&function(a,u){var m=a,y=!1,w=(a.x+u.x)/2,T=(a.y+u.y)/2;do{m.y>T!=m.next.y>T&&m.next.y!==m.y&&w<(m.next.x-m.x)*(T-m.y)/(m.next.y-m.y)+m.x&&(y=!y),m=m.next}while(m!==a);return y}(o,t)&&(ki(o.prev,o,t.prev)||ki(o,t.prev,t))||gc(o,t)&&ki(o.prev,o,o.next)>0&&ki(t.prev,t,t.next)>0)}function ki(o,t,a){return(t.y-o.y)*(a.x-t.x)-(t.x-o.x)*(a.y-t.y)}function gc(o,t){return o.x===t.x&&o.y===t.y}function Cm(o,t,a,u){var m=Hf(ki(o,t,a)),y=Hf(ki(o,t,u)),w=Hf(ki(a,u,o)),T=Hf(ki(a,u,t));return m!==y&&w!==T||!(0!==m||!$f(o,a,t))||!(0!==y||!$f(o,u,t))||!(0!==w||!$f(a,o,u))||!(0!==T||!$f(a,t,u))}function $f(o,t,a){return t.x<=Math.max(o.x,a.x)&&t.x>=Math.min(o.x,a.x)&&t.y<=Math.max(o.y,a.y)&&t.y>=Math.min(o.y,a.y)}function Hf(o){return o>0?1:o<0?-1:0}function Tm(o,t){return ki(o.prev,o,o.next)<0?ki(o,t,o.next)>=0&&ki(o,o.prev,t)>=0:ki(o,t,o.prev)<0||ki(o,o.next,t)<0}function cb(o,t){var a=new Gf(o.i,o.x,o.y),u=new Gf(t.i,t.x,t.y),m=o.next,y=t.prev;return o.next=t,t.prev=o,a.next=m,m.prev=a,u.next=a,a.prev=u,y.next=u,u.prev=y,u}function Mm(o,t,a,u){var m=new Gf(o,t,a);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function pd(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Gf(o,t,a){this.i=o,this.x=t,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Th(o,t,a,u){for(var m=0,y=t,w=a-u;y<a;y+=u)m+=(o[w]-o[y])*(o[y+1]+o[w+1]),w=y;return m}wm.exports=l_,wm.exports.default=l_,l_.deviation=function(o,t,a,u){var m=t&&t.length,y=Math.abs(Th(o,0,m?t[0]*a:o.length,a));if(m)for(var w=0,T=t.length;w<T;w++)y-=Math.abs(Th(o,t[w]*a,w<T-1?t[w+1]*a:o.length,a));var I=0;for(w=0;w<u.length;w+=3){var P=u[w]*a,N=u[w+1]*a,z=u[w+2]*a;I+=Math.abs((o[P]-o[z])*(o[N+1]-o[P+1])-(o[P]-o[N])*(o[z+1]-o[P+1]))}return 0===y&&0===I?0:Math.abs((I-y)/y)},l_.flatten=function(o){for(var t=o[0][0].length,a={vertices:[],holes:[],dimensions:t},u=0,m=0;m<o.length;m++){for(var y=0;y<o[m].length;y++)for(var w=0;w<t;w++)a.vertices.push(o[m][y][w]);m>0&&a.holes.push(u+=o[m-1].length)}return a};var h_=Ot(wm.exports);function ov(o,t,a,u,m){sv(o,t,a||0,u||o.length-1,m||ub)}function sv(o,t,a,u,m){for(;u>a;){if(u-a>600){var y=u-a+1,w=t-a+1,T=Math.log(y),I=.5*Math.exp(2*T/3),P=.5*Math.sqrt(T*I*(y-I)/y)*(w-y/2<0?-1:1);sv(o,t,Math.max(a,Math.floor(t-w*I/y+P)),Math.min(u,Math.floor(t+(y-w)*I/y+P)),m)}var N=o[t],z=a,U=u;for(Zf(o,a,t),m(o[u],N)>0&&Zf(o,a,u);z<U;){for(Zf(o,z,U),z++,U--;m(o[z],N)<0;)z++;for(;m(o[U],N)>0;)U--}0===m(o[a],N)?Zf(o,a,U):Zf(o,++U,u),U<=t&&(a=U+1),t<=U&&(u=U-1)}}function Zf(o,t,a){var u=o[t];o[t]=o[a],o[a]=u}function ub(o,t){return o<t?-1:o>t?1:0}function _o(o,t){const a=o.length;if(a<=1)return[o];const u=[];let m,y;for(let w=0;w<a;w++){const T=so(o[w]);0!==T&&(o[w].area=Math.abs(T),void 0===y&&(y=T<0),y===T<0?(m&&u.push(m),m=[o[w]]):m.push(o[w]))}if(m&&u.push(m),t>1)for(let w=0;w<u.length;w++)u[w].length<=t||(ov(u[w],t,1,u[w].length-1,av),u[w]=u[w].slice(0,t));return u}function av(o,t){return t.area-o.area}function md(o,t,a){const u=a.patternDependencies;let m=!1;for(const y of t){const w=y.paint.get(`${o}-pattern`);w.isConstant()||(m=!0);const T=w.constantOr(null);T&&(m=!0,u[T]=!0)}return m}function Mh(o,t,a,u,m){const y=m.patternDependencies;for(const w of t){const T=w.paint.get(`${o}-pattern`).value;if("constant"!==T.kind){let I=T.evaluate({zoom:u},a,{},m.availableImages);I=I&&I.name?I.name:I,y[I]=!0,a.patterns[w.id]=I}}return a}class Dh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new At,this.indexArray=new ln,this.indexArray2=new qr,this.programConfigurations=new uc(t.layers,t.zoom),this.segments=new Rr,this.segments2=new Rr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=t.projection}populate(t,a,u,m){this.hasPattern=md("fill",this.layers,a);const y=this.layers[0].layout.get("fill-sort-key"),w=[];for(const{feature:T,id:I,index:P,sourceLayerIndex:N}of t){const z=this.layers[0]._featureFilter.needGeometry,U=ud(T,z);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),U,u))continue;const G=y?y.evaluate(U,{},u,a.availableImages):void 0,q={id:I,properties:T.properties,type:T.type,sourceLayerIndex:N,index:P,geometry:z?U.geometry:kl(T,u,m),patterns:{},sortKey:G};w.push(q)}y&&w.sort((T,I)=>T.sortKey-I.sortKey);for(const T of w){const{geometry:I,index:P,sourceLayerIndex:N}=T;if(this.hasPattern){const z=Mh("fill",this.layers,T,this.zoom,a);this.patternFeatures.push(z)}else this.addFeature(T,I,P,u,{},a.availableImages);a.featureIndex.insert(t[P].feature,I,P,N,this.index)}}update(t,a,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,u,m)}addFeatures(t,a,u,m,y){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,a,u,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lb),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,a,u,m,y,w=[]){for(const T of _o(a,500)){let I=0;for(const q of T)I+=q.length;const P=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),N=P.vertexLength,z=[],U=[];for(const q of T){if(0===q.length)continue;q!==T[0]&&U.push(z.length/2);const J=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),re=J.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(re+q.length-1,re),z.push(q[0].x),z.push(q[0].y);for(let de=1;de<q.length;de++)this.layoutVertexArray.emplaceBack(q[de].x,q[de].y),this.indexArray2.emplaceBack(re+de-1,re+de),z.push(q[de].x),z.push(q[de].y);J.vertexLength+=q.length,J.primitiveLength+=q.length}const G=h_(z,U);for(let q=0;q<G.length;q+=3)this.indexArray.emplaceBack(N+G[q],N+G[q+1],N+G[q+2]);P.vertexLength+=I,P.primitiveLength+=G.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,w,m)}}hn(Dh,"FillBucket",{omit:["layers","patternFeatures"]});const db=new ge({"fill-sort-key":new oe(ct.layout_fill["fill-sort-key"])});var gd={paint:new ge({"fill-antialias":new K(ct.paint_fill["fill-antialias"]),"fill-opacity":new oe(ct.paint_fill["fill-opacity"]),"fill-color":new oe(ct.paint_fill["fill-color"]),"fill-outline-color":new oe(ct.paint_fill["fill-outline-color"]),"fill-translate":new K(ct.paint_fill["fill-translate"]),"fill-translate-anchor":new K(ct.paint_fill["fill-translate-anchor"]),"fill-pattern":new oe(ct.paint_fill["fill-pattern"])}),layout:db};const dw=Re([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),hw=Re([{name:"a_centroid_pos",components:2,type:"Uint16"}]),f_=Re([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Dm}=dw;var Wf={},fw=gn,p_=Xs;function Xs(o,t,a,u,m){this.properties={},this.extent=a,this.type=0,this._pbf=o,this._geometry=-1,this._keys=u,this._values=m,o.readFields(lv,this,t)}function lv(o,t,a){1==o?t.id=a.readVarint():2==o?function(u,m){for(var y=u.readVarint()+u.pos;u.pos<y;){var w=m._keys[u.readVarint()],T=m._values[u.readVarint()];m.properties[w]=T}}(a,t):3==o?t.type=a.readVarint():4==o&&(t._geometry=a.pos)}function _C(o){for(var t,a,u=0,m=0,y=o.length,w=y-1;m<y;w=m++)u+=((a=o[w]).x-(t=o[m]).x)*(t.y+a.y);return u}Xs.types=["Unknown","Point","LineString","Polygon"],Xs.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var t,a=o.readVarint()+o.pos,u=1,m=0,y=0,w=0,T=[];o.pos<a;){if(m<=0){var I=o.readVarint();u=7&I,m=I>>3}if(m--,1===u||2===u)y+=o.readSVarint(),w+=o.readSVarint(),1===u&&(t&&T.push(t),t=[]),t.push(new fw(y,w));else{if(7!==u)throw new Error("unknown command "+u);t&&t.push(t[0].clone())}}return t&&T.push(t),T},Xs.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var t=o.readVarint()+o.pos,a=1,u=0,m=0,y=0,w=1/0,T=-1/0,I=1/0,P=-1/0;o.pos<t;){if(u<=0){var N=o.readVarint();a=7&N,u=N>>3}if(u--,1===a||2===a)(m+=o.readSVarint())<w&&(w=m),m>T&&(T=m),(y+=o.readSVarint())<I&&(I=y),y>P&&(P=y);else if(7!==a)throw new Error("unknown command "+a)}return[w,I,T,P]},Xs.prototype.toGeoJSON=function(o,t,a){var u,m,y=this.extent*Math.pow(2,a),w=this.extent*o,T=this.extent*t,I=this.loadGeometry(),P=Xs.types[this.type];function N(G){for(var q=0;q<G.length;q++){var J=G[q];G[q]=[360*(J.x+w)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+T)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(u=0;u<I.length;u++)z[u]=I[u][0];N(I=z);break;case 2:for(u=0;u<I.length;u++)N(I[u]);break;case 3:for(I=function(G){var q=G.length;if(q<=1)return[G];for(var J,re,de=[],xe=0;xe<q;xe++){var he=_C(G[xe]);0!==he&&(void 0===re&&(re=he<0),re===he<0?(J&&de.push(J),J=[G[xe]]):J.push(G[xe]))}return J&&de.push(J),de}(I),u=0;u<I.length;u++)for(m=0;m<I[u].length;m++)N(I[u][m])}1===I.length?I=I[0]:P="Multi"+P;var U={type:"Feature",geometry:{type:P,coordinates:I},properties:this.properties};return"id"in this&&(U.id=this.id),U};var yC=p_,qf=zi;function zi(o,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Sh,this,t),this.length=this._features.length}function Sh(o,t,a){15===o?t.version=a.readVarint():1===o?t.name=a.readString():5===o?t.extent=a.readVarint():2===o?t._features.push(a.pos):3===o?t._keys.push(a.readString()):4===o&&t._values.push(function(u){for(var m=null,y=u.readVarint()+u.pos;u.pos<y;){var w=u.readVarint()>>3;m=1===w?u.readString():2===w?u.readFloat():3===w?u.readDouble():4===w?u.readVarint64():5===w?u.readVarint():6===w?u.readSVarint():7===w?u.readBoolean():null}return m}(a))}zi.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var t=this._pbf.readVarint()+this._pbf.pos;return new yC(this._pbf,t,this.extent,this._keys,this._values)};var Sm=qf;function cv(o,t,a){if(3===o){var u=new Sm(a,a.readVarint()+a.pos);u.length&&(t[u.name]=u)}}var Yf=Wf.VectorTile=function(o,t){this.layers=o.readFields(cv,{},t)},Xf=Wf.VectorTileFeature=p_;function Kf(o,t,a,u){const m=[],y=0===u?(w,T,I,P,N,z)=>{w.push(new Ne(z,I+(z-T)/(P-T)*(N-I)))}:(w,T,I,P,N,z)=>{w.push(new Ne(T+(z-I)/(N-I)*(P-T),z))};for(const w of o){const T=[];for(const I of w){if(I.length<=2)continue;const P=[];for(let U=0;U<I.length-1;U++){const G=I[U].x,q=I[U].y,J=I[U+1].x,re=I[U+1].y,de=0===u?G:q,xe=0===u?J:re;de<t?xe>t&&y(P,G,q,J,re,t):de>a?xe<a&&y(P,G,q,J,re,a):P.push(I[U]),xe<t&&de>=t&&y(P,G,q,J,re,t),xe>a&&de<=a&&y(P,G,q,J,re,a)}let N=I[I.length-1];const z=0===u?N.x:N.y;z>=t&&z<=a&&P.push(N),P.length&&(N=P[P.length-1],P[0].x===N.x&&P[0].y===N.y||P.push(P[0]),T.push(P))}T.length&&m.push(T)}return m}Wf.VectorTileLayer=qf;const uv=Xf.types,hb=Math.pow(2,13);function _d(o,t,a,u,m,y,w,T){o.emplaceBack((t<<1)+w,(a<<1)+y,(Math.floor(u*hb)<<1)+m,Math.round(T))}function m_(o,t,a){o.emplaceBack(t.x,t.y,t.z,16384*a[0],16384*a[1],16384*a[2])}class Im{constructor(){this.acc=new Ne(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ne(t.x,t.y),this.max=new Ne(t.x,t.y))}append(t,a){this.currentPolyCount.edges++,this.acc._add(t);const u=this.min,m=this.max;t.x<u.x?u.x=t.x:t.x>m.x&&(m.x=t.x),t.y<u.y?u.y=t.y:t.y>m.y&&(m.y=t.y),((0===t.x||t.x===_n)&&t.x===a.x)!=((0===t.y||t.y===_n)&&t.y===a.y)&&this.processBorderOverlap(t,a),a.x<0!=t.x<0&&this.addBorderIntersection(0,Ti(a.y,t.y,(0-a.x)/(t.x-a.x))),a.x>_n!=t.x>_n&&this.addBorderIntersection(1,Ti(a.y,t.y,(_n-a.x)/(t.x-a.x))),a.y<0!=t.y<0&&this.addBorderIntersection(2,Ti(a.x,t.x,(0-a.y)/(t.y-a.y))),a.y>_n!=t.y>_n&&this.addBorderIntersection(3,Ti(a.x,t.x,(_n-a.y)/(t.y-a.y)))}addBorderIntersection(t,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[t];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(t,a){if(t.x===a.x){if(t.y===a.y)return;const u=0===t.x?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,t.y)}else{const u=0===t.y?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,t.x)}}centroid(){const t=this.polyCount.reduce((a,u)=>a+u.edges,0);return 0!==t?this.acc.div(t)._round():new Ne(0,0)}span(){return new Ne(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,a)=>t+ +(a[0]!==Number.MAX_VALUE),0)}}class Am{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new mt,this.centroidVertexArray=new Ja,this.indexArray=new ln,this.programConfigurations=new uc(t.layers,t.zoom),this.segments=new Rr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=t.enableTerrain}populate(t,a,u,m){this.features=[],this.hasPattern=md("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(y){const w=Math.exp(Math.PI*(1-y.y/(1<<y.z)*2));return 80150034*w/(w*w+1)/_n/(1<<y.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:y,id:w,index:T,sourceLayerIndex:I}of t){const P=this.layers[0]._featureFilter.needGeometry,N=ud(y,P);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),N,u))continue;const z={id:w,sourceLayerIndex:I,index:T,geometry:P?N.geometry:kl(y,u,m),properties:y.properties,type:y.type,patterns:{}},U=this.layoutVertexArray.length;this.hasPattern?this.features.push(Mh("fill-extrusion",this.layers,z,this.zoom,a)):this.addFeature(z,z.geometry,T,u,{},a.availableImages,m),a.featureIndex.insert(y,z.geometry,T,I,this.index,U)}this.sortBorders()}addFeatures(t,a,u,m,y){for(const w of this.features){const{geometry:T}=w;this.addFeature(w,T,w.index,a,u,m,y)}this.sortBorders()}update(t,a,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,u,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Dm),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,f_.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,hw.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,a,u,m,y,w,T){const I=[new Ne(0,0),new Ne(_n,_n)],P=T.projection,N="globe"===P.name,z=this.enableTerrain&&!N?new Im:null,U="Polygon"===uv[t.type];N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Lt);const G=_o(a,500);for(let de=G.length-1;de>=0;de--){const xe=G[de];(0===xe.length||(q=xe[0]).every(he=>he.x<=0)||q.every(he=>he.x>=_n)||q.every(he=>he.y<=0)||q.every(he=>he.y>=_n))&&G.splice(de,1)}var q;let J;if(N)J=fv(G,I,m);else{J=[];for(const de of G)J.push({polygon:de,bounds:I})}const re=U?this.edgeRadius:0;for(const{polygon:de,bounds:xe}of J){let he=0,ve=0;for(const Ee of de)U&&!Ee[0].equals(Ee[Ee.length-1])&&Ee.push(Ee[0]),ve+=U?Ee.length-1:Ee.length;const Ce=this.segments.prepareSegment((U?5:4)*ve,this.layoutVertexArray,this.indexArray);if(U){const Ee=[],et=[];he=Ce.vertexLength;for(const pt of de){let kt,ot;pt.length&&pt!==de[0]&&et.push(Ee.length/2),kt=pt[1].sub(pt[0])._perp()._unit();for(let Tt=1;Tt<pt.length;Tt++){const xt=pt[Tt],Pt=pt[Tt===pt.length-1?1:Tt+1];let{x:Rt,y:lt}=xt;if(re){ot=Pt.sub(xt)._perp()._unit();const Gt=kt.add(ot)._unit(),tn=re*Math.min(4,1/(kt.x*Gt.x+kt.y*Gt.y));Rt+=tn*Gt.x,lt+=tn*Gt.y,kt=ot}_d(this.layoutVertexArray,Rt,lt,0,0,1,1,0),Ce.vertexLength++,Ee.push(xt.x,xt.y),N&&m_(this.layoutVertexExtArray,P.projectTilePoint(Rt,lt,m),P.upVector(m,Rt,lt))}}const Ke=h_(Ee,et);for(let pt=0;pt<Ke.length;pt+=3)this.indexArray.emplaceBack(he+Ke[pt],he+Ke[pt+2],he+Ke[pt+1]),Ce.primitiveLength++}for(const Ee of de){z&&Ee.length&&z.startRing(Ee[0]);let et,Ke,pt,kt=Ee.length>4&&hv(Ee[Ee.length-2],Ee[0],Ee[1]),ot=re?dv(Ee[Ee.length-2],Ee[0],Ee[1],re):0;Ke=Ee[1].sub(Ee[0])._perp()._unit();let Tt=!0;for(let xt=1,Pt=0;xt<Ee.length;xt++){let Rt=Ee[xt-1],lt=Ee[xt];const Gt=Ee[xt===Ee.length-1?1:xt+1];if(z&&U&&z.currentPolyCount.top++,Nl(lt,Rt,xe)){re&&(Ke=Gt.sub(lt)._perp()._unit(),Tt=!Tt);continue}z&&z.append(lt,Rt);const tn=lt.sub(Rt)._perp(),Qt=tn.x/(Math.abs(tn.x)+Math.abs(tn.y)),Mn=tn.y>0?1:0,jt=Rt.dist(lt);if(Pt+jt>32768&&(Pt=0),re){pt=Gt.sub(lt)._perp()._unit();let Pn=g_(Rt,lt,Gt,Jf(Ke,pt),re);isNaN(Pn)&&(Pn=0);const En=lt.sub(Rt)._unit();Rt=Rt.add(En.mult(ot))._round(),lt=lt.add(En.mult(-Pn))._round(),ot=Pn,Ke=pt}const mn=Ce.vertexLength,Bn=Ee.length>4&&hv(Rt,lt,Gt);let mi=Pm(Pt,kt,Tt);if(_d(this.layoutVertexArray,Rt.x,Rt.y,Qt,Mn,0,0,mi),_d(this.layoutVertexArray,Rt.x,Rt.y,Qt,Mn,0,1,mi),Pt+=jt,mi=Pm(Pt,Bn,!Tt),kt=Bn,_d(this.layoutVertexArray,lt.x,lt.y,Qt,Mn,0,0,mi),_d(this.layoutVertexArray,lt.x,lt.y,Qt,Mn,0,1,mi),Ce.vertexLength+=4,this.indexArray.emplaceBack(mn+0,mn+1,mn+2),this.indexArray.emplaceBack(mn+1,mn+3,mn+2),Ce.primitiveLength+=2,re){const Pn=he+(1===xt?Ee.length-2:xt-2),En=1===xt?he:Pn+1;if(this.indexArray.emplaceBack(mn+1,Pn,mn+3),this.indexArray.emplaceBack(Pn,En,mn+3),Ce.primitiveLength+=2,void 0===et&&(et=mn),!Nl(Gt,Ee[xt],xe)){const Ai=xt===Ee.length-1?et:Ce.vertexLength;this.indexArray.emplaceBack(mn+2,mn+3,Ai),this.indexArray.emplaceBack(mn+3,Ai+1,Ai),this.indexArray.emplaceBack(mn+3,En,Ai+1),Ce.primitiveLength+=3}Tt=!Tt}if(N){const Pn=this.layoutVertexExtArray,En=P.projectTilePoint(Rt.x,Rt.y,m),Ai=P.projectTilePoint(lt.x,lt.y,m),Gn=P.upVector(m,Rt.x,Rt.y),zn=P.upVector(m,lt.x,lt.y);m_(Pn,En,Gn),m_(Pn,En,Gn),m_(Pn,Ai,zn),m_(Pn,Ai,zn)}}U&&(he+=Ee.length-1)}}if(z&&z.polyCount.length>0){if(z.borders){z.vertexArrayOffset=this.centroidVertexArray.length;const de=z.borders,xe=this.featuresOnBorder.push(z)-1;for(let he=0;he<4;he++)de[he][0]!==Number.MAX_VALUE&&this.borders[he].push(xe)}this.encodeCentroid(z.borders?void 0:z.centroid(),z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,w,m)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((a,u)=>this.featuresOnBorder[a].borders[t][0]-this.featuresOnBorder[u].borders[t][0])}encodeCentroid(t,a,u=!0){let m,y;if(t)if(0!==t.y){const T=a.span()._mult(this.tileToMeter);m=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(T.x/10)),y=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(T.y/10))}else m=Math.ceil(7*(t.x+450)),y=0;else m=0,y=+u;let w=u?this.centroidVertexArray.length:a.vertexArrayOffset;for(const T of a.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*T.edges+T.top);for(let I=0;I<T.top;I++)this.centroidVertexArray.emplace(w++,m,y);for(let I=0;I<2*T.edges;I++)this.centroidVertexArray.emplace(w++,0,y),this.centroidVertexArray.emplace(w++,m,y)}}}function Jf(o,t){const a=o.add(t)._unit();return o.x*a.x+o.y*a.y}function dv(o,t,a,u){const m=t.sub(o)._perp()._unit(),y=a.sub(t)._perp()._unit();return g_(o,t,a,Jf(m,y),u)}function g_(o,t,a,u,m){const y=Math.sqrt(1-u*u);return Math.min(o.dist(t)/3,t.dist(a)/3,m*y/u)}function Nl(o,t,a){return o.x<a[0].x&&t.x<a[0].x||o.x>a[1].x&&t.x>a[1].x||o.y<a[0].y&&t.y<a[0].y||o.y>a[1].y&&t.y>a[1].y}function hv(o,t,a){if(o.x<0||o.x>=_n||t.x<0||t.x>=_n||a.x<0||a.x>=_n)return!1;const u=a.sub(t),m=u.perp(),y=o.sub(t);return(u.x*y.x+u.y*y.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(y.x*y.x+y.y*y.y))>-.866&&m.x*y.x+m.y*y.y<0}function Pm(o,t,a){const u=t?2|o:-3&o;return a?1|u:-2&u}function Qf(){const o=Math.PI/32,t=Math.tan(o),a=Ss;return a*Math.sqrt(1+2*t*t)-a}function fv(o,t,a){const u=1<<a.z,m=Is(a.x/u),y=Is((a.x+1)/u),w=po(a.y/u),T=po((a.y+1)/u);return function(I,P,N,z,U=0,G){const q=[];if(!I.length||!N||!z)return q;const J=(Ee,et)=>{for(const Ke of Ee)q.push({polygon:Ke,bounds:et})},re=Math.ceil(Math.log2(N)),de=Math.ceil(Math.log2(z)),xe=re-de,he=[];for(let Ee=0;Ee<Math.abs(xe);Ee++)he.push(xe>0?0:1);for(let Ee=0;Ee<Math.min(re,de);Ee++)he.push(0),he.push(1);let ve=I;if(ve=Kf(ve,P[0].y-U,P[1].y+U,1),ve=Kf(ve,P[0].x-U,P[1].x+U,0),!ve.length)return q;const Ce=[];for(he.length?Ce.push({polygons:ve,bounds:P,depth:0}):J(ve,P);Ce.length;){const Ee=Ce.pop(),et=Ee.depth,Ke=he[et],pt=Ee.bounds[0],kt=Ee.bounds[1],ot=0===Ke?pt.x:pt.y,Tt=0===Ke?kt.x:kt.y,xt=G?G(Ke,ot,Tt):.5*(ot+Tt),Pt=Kf(Ee.polygons,ot-U,xt+U,Ke),Rt=Kf(Ee.polygons,xt-U,Tt+U,Ke);if(Pt.length){const lt=[pt,new Ne(0===Ke?xt:kt.x,1===Ke?xt:kt.y)];he.length>et+1?Ce.push({polygons:Pt,bounds:lt,depth:et+1}):J(Pt,lt)}if(Rt.length){const lt=[new Ne(0===Ke?xt:pt.x,1===Ke?xt:pt.y),kt];he.length>et+1?Ce.push({polygons:Rt,bounds:lt,depth:et+1}):J(Rt,lt)}}return q}(o,t,Math.ceil((y-m)/11.25),Math.ceil((w-T)/11.25),1,(I,P,N)=>{if(0===I)return.5*(P+N);{const z=po((a.y+P/_n)/u);return(ka(.5*(po((a.y+N/_n)/u)+z))*u-a.y)*_n}})}hn(Am,"FillExtrusionBucket",{omit:["layers","features"]}),hn(Im,"PartMetadata");const __=new ge({"fill-extrusion-edge-radius":new K(ct["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var ep={paint:new ge({"fill-extrusion-opacity":new K(ct["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new oe(ct["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new K(ct["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new K(ct["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new oe(ct["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new oe(ct["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new oe(ct["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new K(ct["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new K(ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new K(ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new K(ct["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:__};function cl(o,t,a){var u=2*Math.PI*6378137/256/Math.pow(2,a);return[o*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}class Ih{constructor(t,a,u){this.z=t,this.x=a,this.y=u,this.key=Om(0,t,t,a,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,a){const u=(w=this.y,T=this.z,I=cl(256*(y=this.x),256*(w=Math.pow(2,T)-w-1),T),P=cl(256*(y+1),256*(w+1),T),I[0]+","+I[1]+","+P[0]+","+P[1]),m=function(y,w,T){let I,P="";for(let N=y;N>0;N--)I=1<<N-1,P+=(w&I?1:0)+(T&I?2:0);return P}(this.z,this.x,this.y);var y,w,T,I,P;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class y_{constructor(t,a){this.wrap=t,this.canonical=a,this.key=Om(t,a.z,a.z,a.x,a.y)}}class Ps{constructor(t,a,u,m,y){this.overscaledZ=t,this.wrap=a,this.canonical=new Ih(u,+m,+y),this.key=0===a&&t===u?this.canonical.key:Om(a,t,u,m,y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const a=this.canonical.z-t;return t>this.canonical.z?new Ps(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ps(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(t,a=!0){if(this.overscaledZ===t&&a)return this.key;if(t>this.canonical.z)return Om(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-t;return Om(this.wrap*+a,t,t,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const a=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a}children(t){if(this.overscaledZ>=t)return[new Ps(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new Ps(a,this.wrap,a,u,m),new Ps(a,this.wrap,a,u+1,m),new Ps(a,this.wrap,a,u,m+1),new Ps(a,this.wrap,a,u+1,m+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ps(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ps(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new y_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Om(o,t,a,u,m){const y=1<<Math.min(a,22);let w=y*(m%y)+u%y;return o&&a<22&&(w+=y*y*((o<0?-2*o-1:2*o)%(1<<2*(22-a)))),16*(32*w+a)+(t-a)}hn(Ih,"CanonicalTileID"),hn(Ps,"OverscaledTileID",{omit:["projMatrix"]});class Ah extends Ne{constructor(t,a,u){super(t,a),this.z=u}}function _c(o,t){return o.x*t.x+o.y*t.y}function Ct(o,t){if(1===o.length){let a=0;const u=t[a++];let m;for(;!m||u.equals(m);)if(m=t[a++],!m)return 1/0;for(;a<t.length;a++){const y=t[a],w=o[0],T=m.sub(u),I=y.sub(u),P=w.sub(u),N=_c(T,T),z=_c(T,I),U=_c(I,I),G=_c(P,T),q=_c(P,I),J=N*U-z*z,re=(U*G-z*q)/J,de=(N*q-z*G)/J,xe=u.z*(1-re-de)+m.z*re+y.z*de;if(isFinite(xe))return xe}return 1/0}{let a=1/0;for(const u of t)a=Math.min(a,u.z);return a}}function Rm(o,t,a,u,m,y,w,T){const I=w*m.getElevationAt(o,t,!0,!0),P=0!==y[0],N=P?0===y[1]?w*(y[0]/7-450):w*function(z,U,G){const q=Math.floor(U[0]/8),J=Math.floor(U[1]/8),re=10*(U[0]-8*q),de=10*(U[1]-8*J),xe=z.getElevationAt(q,J,!0,!0),he=z.getMeterToDEM(G),ve=Math.floor(.5*(re*he-1)),Ce=Math.floor(.5*(de*he-1)),Ee=z.tileCoordToPixel(q,J),et=2*ve+1,Ke=2*Ce+1,pt=(tn=et,Qt=Ke,[(Rt=z).getElevationAtPixel(lt=Ee.x-ve,Gt=Ee.y-Ce,!0),Rt.getElevationAtPixel(lt+Qt,Gt,!0),Rt.getElevationAtPixel(lt,Gt+Qt,!0),Rt.getElevationAtPixel(lt+tn,Gt+Qt,!0)]),kt=Math.abs(pt[0]-pt[1]),ot=Math.abs(pt[2]-pt[3]),Tt=Math.abs(pt[0]-pt[2])+Math.abs(pt[1]-pt[3]),xt=Math.min(.25,.5*he*(kt+ot)/et),Pt=Math.min(.25,.5*he*Tt/Ke);var Rt,lt,Gt,tn,Qt;return xe+Math.max(xt*re,Pt*de)}(m,y,T):I;return{base:I+(0===a)?-1:a,top:P?Math.max(N+u,I+a+2):I+u}}const pv=Re([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:v_}=pv,mv=Re([{name:"a_packed",components:4,type:"Float32"}]),{members:pw}=mv,gv=Xf.types,b_=Math.cos(Math.PI/180*37.5);class x_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new nt,this.layoutVertexArray2=new bt,this.indexArray=new ln,this.programConfigurations=new uc(t.layers,t.zoom),this.segments=new Rr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,u,m){this.hasPattern=md("line",this.layers,a);const y=this.layers[0].layout.get("line-sort-key"),w=[];for(const{feature:N,id:z,index:U,sourceLayerIndex:G}of t){const q=this.layers[0]._featureFilter.needGeometry,J=ud(N,q);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),J,u))continue;const re=y?y.evaluate(J,{},u):void 0,de={id:z,properties:N.properties,type:N.type,sourceLayerIndex:G,index:U,geometry:q?J.geometry:kl(N,u,m),patterns:{},sortKey:re};w.push(de)}y&&w.sort((N,z)=>N.sortKey-z.sortKey);const{lineAtlas:T,featureIndex:I}=a,P=this.addConstantDashes(T);for(const N of w){const{geometry:z,index:U,sourceLayerIndex:G}=N;if(P&&this.addFeatureDashes(N,T),this.hasPattern){const q=Mh("line",this.layers,N,this.zoom,a);this.patternFeatures.push(q)}else this.addFeature(N,z,U,u,T.positions,a.availableImages);I.insert(t[U].feature,z,U,G,this.index)}}addConstantDashes(t){let a=!1;for(const u of this.layers){const m=u.paint.get("line-dasharray").value,y=u.layout.get("line-cap").value;if("constant"!==m.kind||"constant"!==y.kind)a=!0;else{const w=y.value,T=m.value;if(!T)continue;t.addDash(T,w)}}return a}addFeatureDashes(t,a){const u=this.zoom;for(const m of this.layers){const y=m.paint.get("line-dasharray").value,w=m.layout.get("line-cap").value;if("constant"===y.kind&&"constant"===w.kind)continue;let T,I;if("constant"===y.kind){if(T=y.value,!T)continue}else T=y.evaluate({zoom:u},t);I="constant"===w.kind?w.value:w.evaluate({zoom:u},t),a.addDash(T,I),t.patterns[m.id]=a.getKey(T,I)}}update(t,a,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,u,m)}addFeatures(t,a,u,m,y){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,a,u,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,pw)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,v_),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,a,u,m,y,w){const T=this.layers[0].layout,I=T.get("line-join").evaluate(t,{}),P=T.get("line-cap").evaluate(t,{}),N=T.get("line-miter-limit"),z=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const U of a)this.addLine(U,t,I,P,N,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,w,m)}addLine(t,a,u,m,y,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<t.length-1;de++)this.totalDistance+=t[de].dist(t[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T="Polygon"===gv[a.type];let I=t.length;for(;I>=2&&t[I-1].equals(t[I-2]);)I--;let P=0;for(;P<I-1&&t[P].equals(t[P+1]);)P++;if(I<(T?3:2))return;"bevel"===u&&(y=1.05);const N=this.overscaling<=16?15*_n/(512*this.overscaling):0,z=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let U,G,q,J,re;this.e1=this.e2=-1,T&&(U=t[I-2],re=t[P].sub(U)._unit()._perp());for(let de=P;de<I;de++){if(q=de===I-1?T?t[P+1]:void 0:t[de+1],q&&t[de].equals(q))continue;re&&(J=re),U&&(G=U),U=t[de],re=q?q.sub(U)._unit()._perp():J,J=J||re;let xe=J.add(re);0===xe.x&&0===xe.y||xe._unit();const he=J.x*re.x+J.y*re.y,ve=xe.x*re.x+xe.y*re.y,Ce=0!==ve?1/ve:1/0,Ee=2*Math.sqrt(2-2*ve),et=ve<b_&&G&&q,Ke=J.x*re.y-J.y*re.x>0;if(et&&de>P){const ot=U.dist(G);if(ot>2*N){const Tt=U.sub(U.sub(G)._mult(N/ot)._round());this.updateDistance(G,Tt),this.addCurrentVertex(Tt,J,0,0,z),G=Tt}}const pt=G&&q;let kt=pt?u:T?"butt":m;if(pt&&"round"===kt&&(Ce<w?kt="miter":Ce<=2&&(kt="fakeround")),"miter"===kt&&Ce>y&&(kt="bevel"),"bevel"===kt&&(Ce>2&&(kt="flipbevel"),Ce<y&&(kt="miter")),G&&this.updateDistance(G,U),"miter"===kt)xe._mult(Ce),this.addCurrentVertex(U,xe,0,0,z);else if("flipbevel"===kt){if(Ce>100)xe=re.mult(-1);else{const ot=Ce*J.add(re).mag()/J.sub(re).mag();xe._perp()._mult(ot*(Ke?-1:1))}this.addCurrentVertex(U,xe,0,0,z),this.addCurrentVertex(U,xe.mult(-1),0,0,z)}else if("bevel"===kt||"fakeround"===kt){const ot=-Math.sqrt(Ce*Ce-1),Tt=Ke?ot:0,xt=Ke?0:ot;if(G&&this.addCurrentVertex(U,J,Tt,xt,z),"fakeround"===kt){const Pt=Math.round(180*Ee/Math.PI/20);for(let Rt=1;Rt<Pt;Rt++){let lt=Rt/Pt;if(.5!==lt){const tn=lt-.5;lt+=lt*tn*(lt-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*tn*tn+(.848013+he*(.215638*he-1.06021)))}const Gt=re.sub(J)._mult(lt)._add(J)._unit()._mult(Ke?-1:1);this.addHalfVertex(U,Gt.x,Gt.y,!1,Ke,0,z)}}q&&this.addCurrentVertex(U,re,-Tt,-xt,z)}else if("butt"===kt)this.addCurrentVertex(U,xe,0,0,z);else if("square"===kt){const ot=G?1:-1;G||this.addCurrentVertex(U,xe,ot,ot,z),this.addCurrentVertex(U,xe,0,0,z),G&&this.addCurrentVertex(U,xe,ot,ot,z)}else"round"===kt&&(G&&(this.addCurrentVertex(U,J,0,0,z),this.addCurrentVertex(U,J,1,1,z,!0)),q&&(this.addCurrentVertex(U,re,-1,-1,z,!0),this.addCurrentVertex(U,re,0,0,z)));if(et&&de<I-1){const ot=U.dist(q);if(ot>2*N){const Tt=U.add(q.sub(U)._mult(N/ot)._round());this.updateDistance(U,Tt),this.addCurrentVertex(Tt,re,0,0,z),U=Tt}}}}addCurrentVertex(t,a,u,m,y,w=!1){const T=a.y*m-a.x,I=-a.y-a.x*m;this.addHalfVertex(t,a.x+a.y*u,a.y-a.x*u,w,!1,u,y),this.addHalfVertex(t,T,I,w,!0,-m,y)}addHalfVertex({x:t,y:a},u,m,y,w,T,I){this.layoutVertexArray.emplaceBack((t<<1)+(y?1:0),(a<<1)+(w?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(0===T?0:T<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const P=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),I.primitiveLength++),w?this.e2=P:this.e1=P}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,a){this.distance+=t.dist(a),this.updateScaledDistance()}}hn(x_,"LineBucket",{omit:["layers","patternFeatures"]});const fb=new ge({"line-cap":new oe(ct.layout_line["line-cap"]),"line-join":new oe(ct.layout_line["line-join"]),"line-miter-limit":new K(ct.layout_line["line-miter-limit"]),"line-round-limit":new K(ct.layout_line["line-round-limit"]),"line-sort-key":new oe(ct.layout_line["line-sort-key"])});var Ph={paint:new ge({"line-opacity":new oe(ct.paint_line["line-opacity"]),"line-color":new oe(ct.paint_line["line-color"]),"line-translate":new K(ct.paint_line["line-translate"]),"line-translate-anchor":new K(ct.paint_line["line-translate-anchor"]),"line-width":new oe(ct.paint_line["line-width"]),"line-gap-width":new oe(ct.paint_line["line-gap-width"]),"line-offset":new oe(ct.paint_line["line-offset"]),"line-blur":new oe(ct.paint_line["line-blur"]),"line-dasharray":new oe(ct.paint_line["line-dasharray"]),"line-pattern":new oe(ct.paint_line["line-pattern"]),"line-gradient":new pe(ct.paint_line["line-gradient"]),"line-trim-offset":new K(ct.paint_line["line-trim-offset"])}),layout:fb};const km=new class extends oe{possiblyEvaluate(o,t){return t=new B(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(o,t)}evaluate(o,t,a,u){return t=st({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(o,t,a,u)}}(Ph.paint.properties["line-width"].specification);function _v(o,t){return t>0?t+2*o:o}km.useIntegerZoom=!0;const vC=Re([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Oh=Re([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),yv=Re([{name:"a_projected_pos",components:4,type:"Float32"}],4);Re([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tp=Re([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Fm=Re([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Re([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yc=Re([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Lm=Re([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Re([{name:"triangle",components:3,type:"Uint16"}]),Re([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Re([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Re([{type:"Float32",name:"offsetX"}]),Re([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var kr=24;const hs=128;function uu(o,t){const{expression:a}=t;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new B(o+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:m}=a;let y=0;for(;y<u.length&&u[y]<=o;)y++;y=Math.max(0,y-1);let w=y;for(;w<u.length&&u[w]<o+1;)w++;w=Math.min(u.length-1,w);const T=u[y],I=u[w];return"composite"===a.kind?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:m}:{kind:"camera",minZoom:T,maxZoom:I,minSize:a.evaluate(new B(T)),maxSize:a.evaluate(new B(I)),interpolationType:m}}}function Bl(o,{uSize:t,uSizeT:a},{lowerSize:u,upperSize:m}){return"source"===o.kind?u/hs:"composite"===o.kind?Ti(u/hs,m/hs,a):t}function ul(o,t){let a=0,u=0;if("constant"===o.kind)u=o.layoutSize;else if("source"!==o.kind){const{interpolationType:m,minZoom:y,maxZoom:w}=o,T=m?Wn(Do.interpolationFactor(m,t,y,w),0,1):0;"camera"===o.kind?u=Ti(o.minSize,o.maxSize,T):a=T}return{uSizeT:a,uSize:u}}var Nm=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:hs,evaluateSizeForFeature:Bl,evaluateSizeForZoom:ul,getSizeData:uu});function yd(o,t,a){return o.sections.forEach(u=>{u.text=function(m,y,w){const T=y.layout.get("text-transform").evaluate(w,{});return"uppercase"===T?m=m.toLocaleUpperCase():"lowercase"===T&&(m=m.toLocaleLowerCase()),F.applyArabicShaping&&(m=F.applyArabicShaping(m)),m}(u.text,t,a)}),o}const vd={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Ks(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function Bm(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var vv=Ji,w_=function(o,t,a,u,m){var y,w,T=8*m-u-1,I=(1<<T)-1,P=I>>1,N=-7,z=a?m-1:0,U=a?-1:1,G=o[t+z];for(z+=U,y=G&(1<<-N)-1,G>>=-N,N+=T;N>0;y=256*y+o[t+z],z+=U,N-=8);for(w=y&(1<<-N)-1,y>>=-N,N+=u;N>0;w=256*w+o[t+z],z+=U,N-=8);if(0===y)y=1-P;else{if(y===I)return w?NaN:1/0*(G?-1:1);w+=Math.pow(2,u),y-=P}return(G?-1:1)*w*Math.pow(2,y-u)},bv=function(o,t,a,u,m,y){var w,T,I,P=8*y-m-1,N=(1<<P)-1,z=N>>1,U=23===m?Math.pow(2,-24)-Math.pow(2,-77):0,G=u?0:y-1,q=u?1:-1,J=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(T=isNaN(t)?1:0,w=N):(w=Math.floor(Math.log(t)/Math.LN2),t*(I=Math.pow(2,-w))<1&&(w--,I*=2),(t+=w+z>=1?U/I:U*Math.pow(2,1-z))*I>=2&&(w++,I/=2),w+z>=N?(T=0,w=N):w+z>=1?(T=(t*I-1)*Math.pow(2,m),w+=z):(T=t*Math.pow(2,z-1)*Math.pow(2,m),w=0));m>=8;o[a+G]=255&T,G+=q,T/=256,m-=8);for(w=w<<m|T,P+=m;P>0;o[a+G]=255&w,G+=q,w/=256,P-=8);o[a+G-q]|=128*J};function Ji(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Ji.Varint=0,Ji.Fixed64=1,Ji.Bytes=2,Ji.Fixed32=5;var Rh=4294967296,kh=1/Rh,vc=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function du(o){return o.type===Ji.Bytes?o.readVarint()+o.pos:o.pos+1}function xv(o,t,a){var u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));a.realloc(u);for(var m=a.pos-1;m>=o;m--)a.buf[m+u]=a.buf[m]}function ip(o,t){for(var a=0;a<o.length;a++)t.writeVarint(o[a])}function zm(o,t){for(var a=0;a<o.length;a++)t.writeSVarint(o[a])}function wv(o,t){for(var a=0;a<o.length;a++)t.writeFloat(o[a])}function Ev(o,t){for(var a=0;a<o.length;a++)t.writeDouble(o[a])}function bd(o,t){for(var a=0;a<o.length;a++)t.writeBoolean(o[a])}function bc(o,t){for(var a=0;a<o.length;a++)t.writeFixed32(o[a])}function E_(o,t){for(var a=0;a<o.length;a++)t.writeSFixed32(o[a])}function Vm(o,t){for(var a=0;a<o.length;a++)t.writeFixed64(o[a])}function Fh(o,t){for(var a=0;a<o.length;a++)t.writeSFixed64(o[a])}function Lh(o,t){return(o[t]|o[t+1]<<8|o[t+2]<<16)+16777216*o[t+3]}function xd(o,t,a){o[a]=t,o[a+1]=t>>>8,o[a+2]=t>>>16,o[a+3]=t>>>24}function Nh(o,t){return(o[t]|o[t+1]<<8|o[t+2]<<16)+(o[t+3]<<24)}Ji.prototype={destroy:function(){this.buf=null},readFields:function(o,t,a){for(a=a||this.length;this.pos<a;){var u=this.readVarint(),m=u>>3,y=this.pos;this.type=7&u,o(m,t,this),this.pos===y&&this.skip(u)}return t},readMessage:function(o,t){return this.readFields(o,t,this.readVarint()+this.pos)},readFixed32:function(){var o=Lh(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Nh(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Lh(this.buf,this.pos)+Lh(this.buf,this.pos+4)*Rh;return this.pos+=8,o},readSFixed64:function(){var o=Lh(this.buf,this.pos)+Nh(this.buf,this.pos+4)*Rh;return this.pos+=8,o},readFloat:function(){var o=w_(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=w_(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var t,a,u=this.buf;return t=127&(a=u[this.pos++]),a<128?t:(t|=(127&(a=u[this.pos++]))<<7,a<128?t:(t|=(127&(a=u[this.pos++]))<<14,a<128?t:(t|=(127&(a=u[this.pos++]))<<21,a<128?t:function(m,y,w){var T,I,P=w.buf;if(T=(112&(I=P[w.pos++]))>>4,I<128||(T|=(127&(I=P[w.pos++]))<<3,I<128)||(T|=(127&(I=P[w.pos++]))<<10,I<128)||(T|=(127&(I=P[w.pos++]))<<17,I<128)||(T|=(127&(I=P[w.pos++]))<<24,I<128)||(T|=(1&(I=P[w.pos++]))<<31,I<128))return function np(o,t,a){return a?4294967296*t+(o>>>0):4294967296*(t>>>0)+(o>>>0)}(m,T,y);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(a=u[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,t=this.pos;return this.pos=o,o-t>=12&&vc?vc.decode(this.buf.subarray(t,o)):function(a,u,m){for(var y="",w=u;w<m;){var T,I,P,N=a[w],z=null,U=N>239?4:N>223?3:N>191?2:1;if(w+U>m)break;1===U?N<128&&(z=N):2===U?128==(192&(T=a[w+1]))&&(z=(31&N)<<6|63&T)<=127&&(z=null):3===U?(I=a[w+2],128==(192&(T=a[w+1]))&&128==(192&I)&&((z=(15&N)<<12|(63&T)<<6|63&I)<=2047||z>=55296&&z<=57343)&&(z=null)):4===U&&(I=a[w+2],P=a[w+3],128==(192&(T=a[w+1]))&&128==(192&I)&&128==(192&P)&&((z=(15&N)<<18|(63&T)<<12|(63&I)<<6|63&P)<=65535||z>=1114112)&&(z=null)),null===z?(z=65533,U=1):z>65535&&(z-=65536,y+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),y+=String.fromCharCode(z),w+=U}return y}(this.buf,t,o)},readBytes:function(){var o=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,o);return this.pos=o,t},readPackedVarint:function(o,t){if(this.type!==Ji.Bytes)return o.push(this.readVarint(t));var a=du(this);for(o=o||[];this.pos<a;)o.push(this.readVarint(t));return o},readPackedSVarint:function(o){if(this.type!==Ji.Bytes)return o.push(this.readSVarint());var t=du(this);for(o=o||[];this.pos<t;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Ji.Bytes)return o.push(this.readBoolean());var t=du(this);for(o=o||[];this.pos<t;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Ji.Bytes)return o.push(this.readFloat());var t=du(this);for(o=o||[];this.pos<t;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Ji.Bytes)return o.push(this.readDouble());var t=du(this);for(o=o||[];this.pos<t;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Ji.Bytes)return o.push(this.readFixed32());var t=du(this);for(o=o||[];this.pos<t;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Ji.Bytes)return o.push(this.readSFixed32());var t=du(this);for(o=o||[];this.pos<t;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Ji.Bytes)return o.push(this.readFixed64());var t=du(this);for(o=o||[];this.pos<t;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Ji.Bytes)return o.push(this.readSFixed64());var t=du(this);for(o=o||[];this.pos<t;)o.push(this.readSFixed64());return o},skip:function(o){var t=7&o;if(t===Ji.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ji.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ji.Fixed32)this.pos+=4;else{if(t!==Ji.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(o,t){this.writeVarint(o<<3|t)},realloc:function(o){for(var t=this.length||16;t<this.pos+o;)t*=2;if(t!==this.length){var a=new Uint8Array(t);a.set(this.buf),this.buf=a,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),xd(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),xd(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),xd(this.buf,-1&o,this.pos),xd(this.buf,Math.floor(o*kh),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),xd(this.buf,-1&o,this.pos),xd(this.buf,Math.floor(o*kh),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(t,a){var u,m,y,T;if(t>=0?(u=t%4294967296|0,m=t/4294967296|0):(m=~(-t/4294967296),4294967295^(u=~(-t%4294967296))?u=u+1|0:(u=0,m=m+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),y=u,(T=a).buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,T.buf[T.pos]=127&(y>>>=7),function(y,w){var T=(7&y)<<4;w.buf[w.pos++]|=T|((y>>>=3)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y)))))}(m,a)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var t=this.pos;this.pos=function(u,m,y){for(var w,T,I=0;I<m.length;I++){if((w=m.charCodeAt(I))>55295&&w<57344){if(!T){w>56319||I+1===m.length?(u[y++]=239,u[y++]=191,u[y++]=189):T=w;continue}if(w<56320){u[y++]=239,u[y++]=191,u[y++]=189,T=w;continue}w=T-55296<<10|w-56320|65536,T=null}else T&&(u[y++]=239,u[y++]=191,u[y++]=189,T=null);w<128?u[y++]=w:(w<2048?u[y++]=w>>6|192:(w<65536?u[y++]=w>>12|224:(u[y++]=w>>18|240,u[y++]=w>>12&63|128),u[y++]=w>>6&63|128),u[y++]=63&w|128)}return y}(this.buf,o,this.pos);var a=this.pos-t;a>=128&&xv(t,a,this),this.pos=t-1,this.writeVarint(a),this.pos+=a},writeFloat:function(o){this.realloc(4),bv(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),bv(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var t=o.length;this.writeVarint(t),this.realloc(t);for(var a=0;a<t;a++)this.buf[this.pos++]=o[a]},writeRawMessage:function(o,t){this.pos++;var a=this.pos;o(t,this);var u=this.pos-a;u>=128&&xv(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u},writeMessage:function(o,t,a){this.writeTag(o,Ji.Bytes),this.writeRawMessage(t,a)},writePackedVarint:function(o,t){t.length&&this.writeMessage(o,ip,t)},writePackedSVarint:function(o,t){t.length&&this.writeMessage(o,zm,t)},writePackedBoolean:function(o,t){t.length&&this.writeMessage(o,bd,t)},writePackedFloat:function(o,t){t.length&&this.writeMessage(o,wv,t)},writePackedDouble:function(o,t){t.length&&this.writeMessage(o,Ev,t)},writePackedFixed32:function(o,t){t.length&&this.writeMessage(o,bc,t)},writePackedSFixed32:function(o,t){t.length&&this.writeMessage(o,E_,t)},writePackedFixed64:function(o,t){t.length&&this.writeMessage(o,Vm,t)},writePackedSFixed64:function(o,t){t.length&&this.writeMessage(o,Fh,t)},writeBytesField:function(o,t){this.writeTag(o,Ji.Bytes),this.writeBytes(t)},writeFixed32Field:function(o,t){this.writeTag(o,Ji.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(o,t){this.writeTag(o,Ji.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(o,t){this.writeTag(o,Ji.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(o,t){this.writeTag(o,Ji.Fixed64),this.writeSFixed64(t)},writeVarintField:function(o,t){this.writeTag(o,Ji.Varint),this.writeVarint(t)},writeSVarintField:function(o,t){this.writeTag(o,Ji.Varint),this.writeSVarint(t)},writeStringField:function(o,t){this.writeTag(o,Ji.Bytes),this.writeString(t)},writeFloatField:function(o,t){this.writeTag(o,Ji.Fixed32),this.writeFloat(t)},writeDoubleField:function(o,t){this.writeTag(o,Ji.Fixed64),this.writeDouble(t)},writeBooleanField:function(o,t){this.writeVarintField(o,!!t)}};var wd=Ot(vv);const C_=3;function rp(o,t,a){t.glyphs=[],1===o&&a.readMessage(Bh,t)}function Bh(o,t,a){if(3===o){const{id:u,bitmap:m,width:y,height:w,left:T,top:I,advance:P}=a.readMessage(mw,{});t.glyphs.push({id:u,bitmap:new ma({width:y+2*C_,height:w+2*C_},m),metrics:{width:y,height:w,left:T,top:I,advance:P}})}else 4===o?t.ascender=a.readSVarint():5===o&&(t.descender=a.readSVarint())}function mw(o,t,a){1===o?t.id=a.readVarint():2===o?t.bitmap=a.readBytes():3===o?t.width=a.readVarint():4===o?t.height=a.readVarint():5===o?t.left=a.readSVarint():6===o?t.top=a.readSVarint():7===o&&(t.advance=a.readVarint())}const Um=C_;function Cv(o){let t=0,a=0;for(const w of o)t+=w.w*w.h,a=Math.max(a,w.w);o.sort((w,T)=>T.h-w.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),a),h:1/0}];let m=0,y=0;for(const w of o)for(let T=u.length-1;T>=0;T--){const I=u[T];if(!(w.w>I.w||w.h>I.h)){if(w.x=I.x,w.y=I.y,y=Math.max(y,w.y+w.h),m=Math.max(m,w.x+w.w),w.w===I.w&&w.h===I.h){const P=u.pop();T<u.length&&(u[T]=P)}else w.h===I.h?(I.x+=w.w,I.w-=w.w):w.w===I.w?(I.y+=w.h,I.h-=w.h):(u.push({x:I.x+w.w,y:I.y,w:I.w-w.w,h:w.h}),I.y+=w.h,I.h-=w.h);break}}return{w:m,h:y,fill:t/(m*y)||0}}const fs=1;class T_{constructor(t,{pixelRatio:a,version:u,stretchX:m,stretchY:y,content:w}){this.paddedRect=t,this.pixelRatio=a,this.stretchX=m,this.stretchY=y,this.content=w,this.version=u}get tl(){return[this.paddedRect.x+fs,this.paddedRect.y+fs]}get br(){return[this.paddedRect.x+this.paddedRect.w-fs,this.paddedRect.y+this.paddedRect.h-fs]}get displaySize(){return[(this.paddedRect.w-2*fs)/this.pixelRatio,(this.paddedRect.h-2*fs)/this.pixelRatio]}}class M_{constructor(t,a){const u={},m={};this.haveRenderCallbacks=[];const y=[];this.addImages(t,u,y),this.addImages(a,m,y);const{w,h:T}=Cv(y),I=new As({width:w||1,height:T||1});for(const P in t){const N=t[P],z=u[P].paddedRect;As.copy(N.data,I,{x:0,y:0},{x:z.x+fs,y:z.y+fs},N.data)}for(const P in a){const N=a[P],z=m[P].paddedRect,U=z.x+fs,G=z.y+fs,q=N.data.width,J=N.data.height;As.copy(N.data,I,{x:0,y:0},{x:U,y:G},N.data),As.copy(N.data,I,{x:0,y:J-1},{x:U,y:G-1},{width:q,height:1}),As.copy(N.data,I,{x:0,y:0},{x:U,y:G+J},{width:q,height:1}),As.copy(N.data,I,{x:q-1,y:0},{x:U-1,y:G},{width:1,height:J}),As.copy(N.data,I,{x:0,y:0},{x:U+q,y:G},{width:1,height:J})}this.image=I,this.iconPositions=u,this.patternPositions=m}addImages(t,a,u){for(const m in t){const y=t[m],w={x:0,y:0,w:y.data.width+2*fs,h:y.data.height+2*fs};u.push(w),a[m]=new T_(w,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(t,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>t.hasImage(u)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),a),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),a)}patchUpdatedImage(t,a,u){if(!t||!a||t.version===a.version)return;t.version=a.version;const[m,y]=t.tl;u.update(a.data,void 0,{x:m,y})}}hn(T_,"ImagePosition"),hn(M_,"ImageAtlas");const Js={horizontal:1,vertical:2,horizontalOnly:3},hu=-17;class op{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,a){const u=new op;return u.scale=t||1,u.fontStack=a,u}static forImage(t){const a=new op;return a.imageName=t,a}}class xc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,a){const u=new xc;for(let m=0;m<t.sections.length;m++){const y=t.sections[m];y.image?u.addImageSection(y):u.addTextSection(y,a)}return u}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(a,u){let m="";for(let y=0;y<a.length;y++){const w=a.charCodeAt(y+1)||null,T=a.charCodeAt(y-1)||null;m+=!u&&(w&&$g(w)&&!vd[a[y+1]]||T&&$g(T)&&!vd[a[y-1]])||!vd[a[y]]?a[y]:vd[a[y]]}return m}(this.text,t)}trim(){let t=0;for(let u=0;u<this.text.length&&D_[this.text.charCodeAt(u)];u++)t++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&D_[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(t,a),this.sectionIndex=this.sectionIndex.slice(t,a)}substring(t,a){const u=new xc;return u.text=this.text.substring(t,a),u.sectionIndex=this.sectionIndex.slice(t,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,a)=>Math.max(t,this.sections[a].scale),0)}addTextSection(t,a){this.text+=t.text,this.sections.push(op.forText(t.scale,t.fontStack||a));const u=this.sections.length-1;for(let m=0;m<t.text.length;++m)this.sectionIndex.push(u)}addImageSection(t){const a=t.image?t.image.name:"";if(0===a.length)return void Yn("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(op.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Yn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function sp(o,t,a,u,m,y,w,T,I,P,N,z,U,G,q){const J=xc.fromFeature(o,m);z===Js.vertical&&J.verticalizePunctuation(U);let re=[];const de=function(Ee,et,Ke,pt,kt,ot){if(!Ee)return[];const Tt=[],xt=function(Gt,tn,Qt,Mn,jt,mn){let Bn=0;for(let mi=0;mi<Gt.length();mi++){const Pn=Gt.getSection(mi);Bn+=Tv(Gt.getCharCode(mi),Pn,Mn,jt,tn,mn)}return Bn/Math.max(1,Math.ceil(Bn/Qt))}(Ee,et,Ke,pt,kt,ot),Pt=Ee.text.indexOf("\u200b")>=0;let Rt=0;for(let Gt=0;Gt<Ee.length();Gt++){const tn=Ee.getSection(Gt),Qt=Ee.getCharCode(Gt);if(D_[Qt]||(Rt+=Tv(Qt,tn,pt,kt,et,ot)),Gt<Ee.length()-1){const Mn=!((lt=Qt)<11904||!(Jt["Bopomofo Extended"](lt)||Jt.Bopomofo(lt)||Jt["CJK Compatibility Forms"](lt)||Jt["CJK Compatibility Ideographs"](lt)||Jt["CJK Compatibility"](lt)||Jt["CJK Radicals Supplement"](lt)||Jt["CJK Strokes"](lt)||Jt["CJK Symbols and Punctuation"](lt)||Jt["CJK Unified Ideographs Extension A"](lt)||Jt["CJK Unified Ideographs"](lt)||Jt["Enclosed CJK Letters and Months"](lt)||Jt["Halfwidth and Fullwidth Forms"](lt)||Jt.Hiragana(lt)||Jt["Ideographic Description Characters"](lt)||Jt["Kangxi Radicals"](lt)||Jt["Katakana Phonetic Extensions"](lt)||Jt.Katakana(lt)||Jt["Vertical Forms"](lt)||Jt["Yi Radicals"](lt)||Jt["Yi Syllables"](lt)));(gw[Qt]||Mn||tn.imageName)&&Tt.push(gb(Gt+1,Rt,xt,Tt,mb(Qt,Ee.getCharCode(Gt+1),Mn&&Pt),!1))}}var lt;return Mv(gb(Ee.length(),Rt,xt,Tt,0,!0))}(J,P,y,t,u,G),{processBidirectionalText:xe,processStyledBidirectionalText:he}=F;if(xe&&1===J.sections.length){const Ee=xe(J.toString(),de);for(const et of Ee){const Ke=new xc;Ke.text=et,Ke.sections=J.sections;for(let pt=0;pt<et.length;pt++)Ke.sectionIndex.push(0);re.push(Ke)}}else if(he){const Ee=he(J.text,J.sectionIndex,de);for(const et of Ee){const Ke=new xc;Ke.text=et[0],Ke.sectionIndex=et[1],Ke.sections=J.sections,re.push(Ke)}}else re=function(Ee,et){const Ke=[],pt=Ee.text;let kt=0;for(const ot of et)Ke.push(Ee.substring(kt,ot)),kt=ot;return kt<pt.length&&Ke.push(Ee.substring(kt,pt.length)),Ke}(J,de);const ve=[],Ce={positionedLines:ve,text:J.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:z,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ee,et,Ke,pt,kt,ot,Tt,xt,Pt,Rt,lt,Gt){let tn=0,Qt=0,Mn=0;const jt="right"===xt?1:"left"===xt?0:.5;let mn=!1;for(const Gn of kt){const zn=Gn.getSections();for(const Ii of zn){if(Ii.imageName)continue;const qi=et[Ii.fontStack];if(qi&&(mn=void 0!==qi.ascender&&void 0!==qi.descender,!mn))break}if(!mn)break}let Bn=0;for(const Gn of kt){Gn.trim();const zn=Gn.getMaxScale(),Ii=(zn-1)*kr,qi={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[Bn]=qi;const Vi=qi.positionedGlyphs;let Ui=0;if(!Gn.length()){Qt+=ot,++Bn;continue}let xr=0,mr=0;for(let Fi=0;Fi<Gn.length();Fi++){const Lr=Gn.getSection(Fi),nr=Gn.getSectionIndex(Fi),gr=Gn.getCharCode(Fi);let Mi=Lr.scale,Kr=null,Qi=null,ps=null,jr=kr,Jr=0;const no=!(Pt===Js.horizontal||!lt&&!Cf(gr)||lt&&(D_[gr]||(mi=gr,Jt.Arabic(mi)||Jt["Arabic Supplement"](mi)||Jt["Arabic Extended-A"](mi)||Jt["Arabic Presentation Forms-A"](mi)||Jt["Arabic Presentation Forms-B"](mi))));if(Lr.imageName){const Ls=pt[Lr.imageName];if(!Ls)continue;ps=Lr.imageName,Ee.iconsInText=Ee.iconsInText||!0,Qi=Ls.paddedRect;const io=Ls.displaySize;Mi=Mi*kr/Gt,Kr={width:io[0],height:io[1],left:fs,top:-Um,advance:no?io[1]:io[0],localGlyph:!1},Jr=mn?-Kr.height*Mi:hu+zn*kr-io[1]*Mi,jr=Kr.advance;const gl=(no?io[0]:io[1])*Mi-kr*zn;gl>0&&gl>Ui&&(Ui=gl)}else{const Ls=Ke[Lr.fontStack];if(!Ls)continue;Ls[gr]&&(Qi=Ls[gr]);const io=et[Lr.fontStack];if(!io)continue;const gl=io.glyphs[gr];if(!gl)continue;if(Kr=gl.metrics,jr=8203!==gr?kr:0,mn){const Pd=void 0!==io.ascender?Math.abs(io.ascender):0,Od=void 0!==io.descender?Math.abs(io.descender):0,Hl=(Pd+Od)*Mi;xr<Hl&&(xr=Hl,mr=(Pd-Od)/2*Mi),Jr=-Pd*Mi}else Jr=hu+(zn-Mi)*kr}no?(Ee.verticalizable=!0,Vi.push({glyph:gr,imageName:ps,x:tn,y:Qt+Jr,vertical:no,scale:Mi,localGlyph:Kr.localGlyph,fontStack:Lr.fontStack,sectionIndex:nr,metrics:Kr,rect:Qi}),tn+=jr*Mi+Rt):(Vi.push({glyph:gr,imageName:ps,x:tn,y:Qt+Jr,vertical:no,scale:Mi,localGlyph:Kr.localGlyph,fontStack:Lr.fontStack,sectionIndex:nr,metrics:Kr,rect:Qi}),tn+=Kr.advance*Mi+Rt)}0!==Vi.length&&(Mn=Math.max(tn-Rt,Mn),mn?jm(Vi,jt,Ui,mr,ot*zn/2):jm(Vi,jt,Ui,0,ot/2)),tn=0;const Fr=ot*zn+Ui;qi.lineOffset=Math.max(Ui,Ii),Qt+=Fr,++Bn}var mi;const Pn=Qt,{horizontalAlign:En,verticalAlign:Ai}=Dv(Tt);(function(Gn,zn,Ii,qi,Vi,Ui){const xr=(zn-Ii)*Vi,mr=-Ui*qi;for(const Fr of Gn)for(const Fi of Fr.positionedGlyphs)Fi.x+=xr,Fi.y+=mr})(Ee.positionedLines,jt,En,Ai,Mn,Pn),Ee.top+=-Ai*Pn,Ee.bottom=Ee.top+Pn,Ee.left+=-En*Mn,Ee.right=Ee.left+Mn,Ee.hasBaseline=mn}(Ce,t,a,u,re,w,T,I,z,P,U,q),!function(Ee){for(const et of Ee)if(0!==et.positionedGlyphs.length)return!1;return!0}(ve)&&Ce}const D_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Tv(o,t,a,u,m,y){if(t.imageName){const w=u[t.imageName];return w?w.displaySize[0]*t.scale*kr/y+m:0}{const w=a[t.fontStack],T=w&&w.glyphs[o];return T?T.metrics.advance*t.scale+m:0}}function pb(o,t,a,u){const m=Math.pow(o-t,2);return u?o<t?m/2:2*m:m+Math.abs(a)*a}function mb(o,t,a){let u=0;return 10===o&&(u-=1e4),a&&(u+=150),40!==o&&65288!==o||(u+=50),41!==t&&65289!==t||(u+=50),u}function gb(o,t,a,u,m,y){let w=null,T=pb(t,a,m,y);for(const I of u){const P=pb(t-I.x,a,m,y)+I.badness;P<=T&&(w=I,T=P)}return{index:o,x:t,priorBreak:w,badness:T}}function Mv(o){return o?Mv(o.priorBreak).concat(o.index):[]}function Dv(o){let t=.5,a=.5;switch(o){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:t,verticalAlign:a}}function jm(o,t,a,u,m){if(!(t||a||u||m))return;const y=o.length-1,w=o[y],T=(w.x+w.metrics.advance*w.scale)*t;for(let I=0;I<=y;I++)o[I].x-=T,o[I].y+=a+u+m}function Sv(o,t,a){const{horizontalAlign:u,verticalAlign:m}=Dv(a),y=t[0]-o.displaySize[0]*u,w=t[1]-o.displaySize[1]*m;return{image:o,top:w,bottom:w+o.displaySize[1],left:y,right:y+o.displaySize[0]}}function dl(o,t,a,u,m,y){const w=o.image;let T;if(w.content){const re=w.content,de=w.pixelRatio||1;T=[re[0]/de,re[1]/de,w.displaySize[0]-re[2]/de,w.displaySize[1]-re[3]/de]}const I=t.left*y,P=t.right*y;let N,z,U,G;"width"===a||"both"===a?(G=m[0]+I-u[3],z=m[0]+P+u[1]):(G=m[0]+(I+P-w.displaySize[0])/2,z=G+w.displaySize[0]);const q=t.top*y,J=t.bottom*y;return"height"===a||"both"===a?(N=m[1]+q-u[0],U=m[1]+J+u[2]):(N=m[1]+(q+J-w.displaySize[1])/2,U=N+w.displaySize[1]),{image:w,top:N,right:z,bottom:U,left:G,collisionPadding:T}}class ga extends Ne{constructor(t,a,u,m,y){super(t,a),this.angle=m,this.z=u,void 0!==y&&(this.segment=y)}clone(){return new ga(this.x,this.y,this.z,this.angle,this.segment)}}function Iv(o,t,a,u,m){if(void 0===t.segment)return!0;let y=t,w=t.segment+1,T=0;for(;T>-a/2;){if(w--,w<0)return!1;T-=o[w].dist(y),y=o[w]}T+=o[w].dist(o[w+1]),w++;const I=[];let P=0;for(;T<a/2;){const N=o[w],z=o[w+1];if(!z)return!1;let U=o[w-1].angleTo(N)-N.angleTo(z);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:U}),P+=U;T-I[0].distance>u;)P-=I.shift().angleDelta;if(P>m)return!1;w++,T+=N.dist(z)}return!0}function S_(o){let t=0;for(let a=0;a<o.length-1;a++)t+=o[a].dist(o[a+1]);return t}function $m(o,t,a){return o?.6*t*a:0}function Hm(o,t){return Math.max(o?o.right-o.left:0,t?t.right-t.left:0)}function hl(o,t,a,u,m,y){const w=$m(a,m,y),T=Hm(a,u)*y;let I=0;const P=S_(o)/2;for(let N=0;N<o.length-1;N++){const z=o[N],U=o[N+1],G=z.dist(U);if(I+G>P){const q=(P-I)/G,J=Ti(z.x,U.x,q),re=Ti(z.y,U.y,q),de=new ga(J,re,0,U.angleTo(z),N);return!w||Iv(o,de,T,w,t)?de:void 0}I+=G}}function Av(o,t,a,u,m,y,w,T,I){const P=$m(u,y,w),N=Hm(u,m),z=N*w,U=0===o[0].x||o[0].x===I||0===o[0].y||o[0].y===I;return t-z<t/4&&(t=z+t/4),I_(o,U?t/2*T%t:(N/2+2*y)*w*T%t,t,P,a,z,U,!1,I)}function I_(o,t,a,u,m,y,w,T,I){const P=y/2,N=S_(o);let z=0,U=t-a,G=[];for(let q=0;q<o.length-1;q++){const J=o[q],re=o[q+1],de=J.dist(re),xe=re.angleTo(J);for(;U+a<z+de;){U+=a;const he=(U-z)/de,ve=Ti(J.x,re.x,he),Ce=Ti(J.y,re.y,he);if(ve>=0&&ve<I&&Ce>=0&&Ce<I&&U-P>=0&&U+P<=N){const Ee=new ga(ve,Ce,0,xe,q);Ee._round(),u&&!Iv(o,Ee,y,u,m)||G.push(Ee)}}z+=de}return T||G.length||w||(G=I_(o,z/2,a,u,m,y,w,!0,I)),G}function Pv(o,t,a,u,m){const y=[];for(let w=0;w<o.length;w++){const T=o[w];let I;for(let P=0;P<T.length-1;P++){let N=T[P],z=T[P+1];N.x<t&&z.x<t||(N.x<t?N=new Ne(t,N.y+(t-N.x)/(z.x-N.x)*(z.y-N.y))._round():z.x<t&&(z=new Ne(t,N.y+(t-N.x)/(z.x-N.x)*(z.y-N.y))._round()),N.y<a&&z.y<a||(N.y<a?N=new Ne(N.x+(a-N.y)/(z.y-N.y)*(z.x-N.x),a)._round():z.y<a&&(z=new Ne(N.x+(a-N.y)/(z.y-N.y)*(z.x-N.x),a)._round()),N.x>=u&&z.x>=u||(N.x>=u?N=new Ne(u,N.y+(u-N.x)/(z.x-N.x)*(z.y-N.y))._round():z.x>=u&&(z=new Ne(u,N.y+(u-N.x)/(z.x-N.x)*(z.y-N.y))._round()),N.y>=m&&z.y>=m||(N.y>=m?N=new Ne(N.x+(m-N.y)/(z.y-N.y)*(z.x-N.x),m)._round():z.y>=m&&(z=new Ne(N.x+(m-N.y)/(z.y-N.y)*(z.x-N.x),m)._round()),I&&N.equals(I[I.length-1])||(I=[N],y.push(I)),I.push(z)))))}}return y}hn(ga,"Anchor");const Xr=1e20;function Ov(o,t,a,u,m,y,w,T,I){for(let P=t;P<t+u;P++)A_(o,a*y+P,y,m,w,T,I);for(let P=a;P<a+m;P++)A_(o,P*y+t,1,u,w,T,I)}function A_(o,t,a,u,m,y,w){y[0]=0,w[0]=-Xr,w[1]=Xr,m[0]=o[t];for(let T=1,I=0,P=0;T<u;T++){m[T]=o[t+T*a];const N=T*T;do{const z=y[I];P=(m[T]-m[z]+N-z*z)/(T-z)/2}while(P<=w[I]&&--I>-1);I++,y[I]=T,w[I]=P,w[I+1]=Xr}for(let T=0,I=0;T<u;T++){for(;w[I+1]<T;)I++;const P=y[I],N=T-P;o[t+T*a]=m[P]+N*N}}const ko=2,wc={none:0,ideographs:1,all:2};class fu{constructor(t,a,u){this.requestManager=t,this.localGlyphMode=a,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,a){const u=[];for(const m in t)for(const y of t[m])u.push({stack:m,id:y});yr(u,({stack:m,id:y},w)=>{let T=this.entries[m];T||(T=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=T.glyphs[y];if(void 0!==I)return void w(null,{stack:m,id:y,glyph:I});if(I=this._tinySDF(T,m,y),I)return T.glyphs[y]=I,void w(null,{stack:m,id:y,glyph:I});const P=Math.floor(y/256);if(256*P>65535)return void w(new Error("glyphs > 65535 not supported"));if(T.ranges[P])return void w(null,{stack:m,id:y,glyph:I});let N=T.requests[P];N||(N=T.requests[P]=[],fu.loadGlyphRange(m,P,this.url,this.requestManager,(z,U)=>{if(U){T.ascender=U.ascender,T.descender=U.descender;for(const G in U.glyphs)this._doesCharSupportLocalGlyph(+G)||(T.glyphs[+G]=U.glyphs[+G]);T.ranges[P]=!0}for(const G of N)G(z,U);delete T.requests[P]})),N.push((z,U)=>{z?w(z):U&&w(null,{stack:m,id:y,glyph:U.glyphs[y]||null})})},(m,y)=>{if(m)a(m);else if(y){const w={};for(const{stack:T,id:I,glyph:P}of y)void 0===w[T]&&(w[T]={}),void 0===w[T].glyphs&&(w[T].glyphs={}),w[T].glyphs[I]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},w[T].ascender=this.entries[T].ascender,w[T].descender=this.entries[T].descender;a(null,w)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==wc.none&&(this.localGlyphMode===wc.all?!!this.localFontFamily:!!this.localFontFamily&&(Jt["CJK Unified Ideographs"](t)||Jt["Hangul Syllables"](t)||Jt.Hiragana(t)||Jt.Katakana(t)||Jt["CJK Symbols and Punctuation"](t)))}_tinySDF(t,a,u){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(u))return;let y=t.tinySDF;if(!y){let J="400";/bold/i.test(a)?J="900":/medium/i.test(a)?J="500":/light/i.test(a)&&(J="200"),y=t.tinySDF=new fu.TinySDF({fontFamily:m,fontWeight:J,fontSize:24*ko,buffer:3*ko,radius:8*ko}),y.fontWeight=J}if(this.localGlyphs[y.fontWeight][u])return this.localGlyphs[y.fontWeight][u];const w=String.fromCharCode(u),{data:T,width:I,height:P,glyphWidth:N,glyphHeight:z,glyphLeft:U,glyphTop:G,glyphAdvance:q}=y.draw(w);return this.localGlyphs[y.fontWeight][u]={id:u,bitmap:new ma({width:I,height:P},T),metrics:{width:N/ko,height:z/ko,left:U/ko,top:G/ko-27,advance:q/ko,localGlyph:!0}}}}fu.loadGlyphRange=function(o,t,a,u,m){const y=256*t,w=y+255,T=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",o).replace("{range}",`${y}-${w}`),ao.Glyphs);Ei(T,(I,P)=>{if(I)m(I);else if(P){const N={},z=new wd(P).readFields(rp,{});for(const U of z.glyphs)N[U.id]=U;m(null,{glyphs:N,ascender:z.ascender,descender:z.descender})}})},fu.TinySDF=class{constructor({fontSize:o=24,buffer:t=3,radius:a=8,cutoff:u=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:w="normal"}={}){this.buffer=t,this.cutoff=u,this.radius=a;const T=this.size=o+4*t,I=this._createCanvas(T),P=this.ctx=I.getContext("2d",{willReadFrequently:!0});P.font=`${w} ${y} ${o}px ${m}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(o){const t=document.createElement("canvas");return t.width=t.height=o,t}draw(o){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(o),w=Math.ceil(a),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-m))),I=Math.min(this.size-this.buffer,w+Math.ceil(u)),P=T+2*this.buffer,N=I+2*this.buffer,z=Math.max(P*N,0),U=new Uint8ClampedArray(z),G={data:U,width:P,height:N,glyphWidth:T,glyphHeight:I,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(0===T||0===I)return G;const{ctx:q,buffer:J,gridInner:re,gridOuter:de}=this;q.clearRect(J,J,T,I),q.fillText(o,J,J+w);const xe=q.getImageData(J,J,T,I);de.fill(Xr,0,z),re.fill(0,0,z);for(let he=0;he<I;he++)for(let ve=0;ve<T;ve++){const Ce=xe.data[4*(he*T+ve)+3]/255;if(0===Ce)continue;const Ee=(he+J)*P+ve+J;if(1===Ce)de[Ee]=0,re[Ee]=Xr;else{const et=.5-Ce;de[Ee]=et>0?et*et:0,re[Ee]=et<0?et*et:0}}Ov(de,0,0,P,N,P,this.f,this.v,this.z),Ov(re,J,J,T,I,P,this.f,this.v,this.z);for(let he=0;he<z;he++){const ve=Math.sqrt(de[he])-Math.sqrt(re[he]);U[he]=Math.round(255-255*(ve/this.radius+this.cutoff))}return G}};const zh=fs;function Gm(o,t,a,u){const m=[],y=o.image,w=y.pixelRatio,T=y.paddedRect.w-2*zh,I=y.paddedRect.h-2*zh,P=o.right-o.left,N=o.bottom-o.top,z=y.stretchX||[[0,T]],U=y.stretchY||[[0,I]],G=(ot,Tt)=>ot+Tt[1]-Tt[0],q=z.reduce(G,0),J=U.reduce(G,0),re=T-q,de=I-J;let xe=0,he=q,ve=0,Ce=J,Ee=0,et=re,Ke=0,pt=de;if(y.content&&u){const ot=y.content;xe=Zm(z,0,ot[0]),ve=Zm(U,0,ot[1]),he=Zm(z,ot[0],ot[2]),Ce=Zm(U,ot[1],ot[3]),Ee=ot[0]-xe,Ke=ot[1]-ve,et=ot[2]-ot[0]-he,pt=ot[3]-ot[1]-Ce}const kt=(ot,Tt,xt,Pt)=>{const Rt=Wm(ot.stretch-xe,he,P,o.left),lt=qm(ot.fixed-Ee,et,ot.stretch,q),Gt=Wm(Tt.stretch-ve,Ce,N,o.top),tn=qm(Tt.fixed-Ke,pt,Tt.stretch,J),Qt=Wm(xt.stretch-xe,he,P,o.left),Mn=qm(xt.fixed-Ee,et,xt.stretch,q),jt=Wm(Pt.stretch-ve,Ce,N,o.top),mn=qm(Pt.fixed-Ke,pt,Pt.stretch,J),Bn=new Ne(Rt,Gt),mi=new Ne(Qt,Gt),Pn=new Ne(Qt,jt),En=new Ne(Rt,jt),Ai=new Ne(lt/w,tn/w),Gn=new Ne(Mn/w,mn/w),zn=t*Math.PI/180;if(zn){const Vi=Math.sin(zn),Ui=Math.cos(zn),xr=[Ui,-Vi,Vi,Ui];Bn._matMult(xr),mi._matMult(xr),En._matMult(xr),Pn._matMult(xr)}const Ii=ot.stretch+ot.fixed,qi=Tt.stretch+Tt.fixed;return{tl:Bn,tr:mi,bl:En,br:Pn,tex:{x:y.paddedRect.x+zh+Ii,y:y.paddedRect.y+zh+qi,w:xt.stretch+xt.fixed-Ii,h:Pt.stretch+Pt.fixed-qi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ai,pixelOffsetBR:Gn,minFontScaleX:et/w/P,minFontScaleY:pt/w/N,isSDF:a}};if(u&&(y.stretchX||y.stretchY)){const ot=Rv(z,re,q),Tt=Rv(U,de,J);for(let xt=0;xt<ot.length-1;xt++){const Pt=ot[xt],Rt=ot[xt+1];for(let lt=0;lt<Tt.length-1;lt++)m.push(kt(Pt,Tt[lt],Rt,Tt[lt+1]))}}else m.push(kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:I+1}));return m}function Zm(o,t,a){let u=0;for(const m of o)u+=Math.max(t,Math.min(a,m[1]))-Math.max(t,Math.min(a,m[0]));return u}function Rv(o,t,a){const u=[{fixed:-zh,stretch:0}];for(const[m,y]of o){const w=u[u.length-1];u.push({fixed:m-w.stretch,stretch:w.stretch}),u.push({fixed:m-w.stretch,stretch:w.stretch+(y-m)})}return u.push({fixed:t+zh,stretch:a}),u}function Wm(o,t,a,u){return o/t*a+u}function qm(o,t,a,u){return o-t*a/u}function _w(o,t,a,u){const m=t+o.positionedLines[u].lineOffset;return 0===u?a+m/2:a+(m+(t+o.positionedLines[u-1].lineOffset))/2}class _b{constructor(t=[],a=ap){if(this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:a,compare:u}=this,m=a[t];for(;t>0;){const y=t-1>>1,w=a[y];if(u(m,w)>=0)break;a[t]=w,t=y}a[t]=m}_down(t){const{data:a,compare:u}=this,m=this.length>>1,y=a[t];for(;t<m;){let w=1+(t<<1),T=a[w];const I=w+1;if(I<this.length&&u(a[I],T)<0&&(w=I,T=a[I]),u(T,y)>=0)break;a[t]=T,t=w}a[t]=y}}function ap(o,t){return o<t?-1:o>t?1:0}function zl(o,t=1,a=!1){let u=1/0,m=1/0,y=-1/0,w=-1/0;const T=o[0];for(let G=0;G<T.length;G++){const q=T[G];(!G||q.x<u)&&(u=q.x),(!G||q.y<m)&&(m=q.y),(!G||q.x>y)&&(y=q.x),(!G||q.y>w)&&(w=q.y)}const I=Math.min(y-u,w-m);let P=I/2;const N=new _b([],lp);if(0===I)return new Ne(u,m);for(let G=u;G<y;G+=I)for(let q=m;q<w;q+=I)N.push(new Ec(G+P,q+P,P,o));let z=function(G){let q=0,J=0,re=0;const de=G[0];for(let xe=0,he=de.length,ve=he-1;xe<he;ve=xe++){const Ce=de[xe],Ee=de[ve],et=Ce.x*Ee.y-Ee.x*Ce.y;J+=(Ce.x+Ee.x)*et,re+=(Ce.y+Ee.y)*et,q+=3*et}return new Ec(J/q,re/q,0,G)}(o),U=N.length;for(;N.length;){const G=N.pop();(G.d>z.d||!z.d)&&(z=G,a&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,U)),G.max-z.d<=t||(P=G.h/2,N.push(new Ec(G.p.x-P,G.p.y-P,P,o)),N.push(new Ec(G.p.x+P,G.p.y-P,P,o)),N.push(new Ec(G.p.x-P,G.p.y+P,P,o)),N.push(new Ec(G.p.x+P,G.p.y+P,P,o)),U+=4)}return a&&(console.log(`num probes: ${U}`),console.log(`best distance: ${z.d}`)),z.p}function lp(o,t){return t.max-o.max}class Ec{constructor(t,a,u,m){this.p=new Ne(t,a),this.h=u,this.d=function(y,w){let T=!1,I=1/0;for(let P=0;P<w.length;P++){const N=w[P];for(let z=0,U=N.length,G=U-1;z<U;G=z++){const q=N[z],J=N[G];q.y>y.y!=J.y>y.y&&y.x<(J.x-q.x)*(y.y-q.y)/(J.y-q.y)+q.x&&(T=!T),I=Math.min(I,bh(y,q,J))}}return(T?1:-1)*Math.sqrt(I)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const Vh=7,Ym=Number.POSITIVE_INFINITY,P_=Math.sqrt(2);function Uh(o,[t,a]){let u=0,m=0;if(a===Ym){t<0&&(t=0);const y=t/P_;switch(o){case"top-right":case"top-left":m=y-Vh;break;case"bottom-right":case"bottom-left":m=-y+Vh;break;case"bottom":m=-t+Vh;break;case"top":m=t-Vh}switch(o){case"top-right":case"bottom-right":u=-y;break;case"top-left":case"bottom-left":u=y;break;case"left":u=t;break;case"right":u=-t}}else{switch(t=Math.abs(t),a=Math.abs(a),o){case"top-right":case"top-left":case"top":m=a-Vh;break;case"bottom-right":case"bottom-left":case"bottom":m=-a+Vh}switch(o){case"top-right":case"bottom-right":case"right":u=-t;break;case"top-left":case"bottom-left":case"left":u=t}}return[u,m]}function kv(o,t,a,u,m,y,w,T,I,P){o.createArrays(),o.tilePixelRatio=_n/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const N=o.layers[0].layout,z=o.layers[0]._unevaluatedLayout._values,U={};if("composite"===o.textSizeData.kind){const{minZoom:J,maxZoom:re}=o.textSizeData;U.compositeTextSizes=[z["text-size"].possiblyEvaluate(new B(J),T),z["text-size"].possiblyEvaluate(new B(re),T)]}if("composite"===o.iconSizeData.kind){const{minZoom:J,maxZoom:re}=o.iconSizeData;U.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new B(J),T),z["icon-size"].possiblyEvaluate(new B(re),T)]}U.layoutTextSize=z["text-size"].possiblyEvaluate(new B(I+1),T),U.layoutIconSize=z["icon-size"].possiblyEvaluate(new B(I+1),T),U.textMaxSize=z["text-size"].possiblyEvaluate(new B(18),T);const G="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),q=N.get("text-size");for(const J of o.features){const re=N.get("text-font").evaluate(J,{},T).join(","),de=q.evaluate(J,{},T),xe=U.layoutTextSize.evaluate(J,{},T),he=(U.layoutIconSize.evaluate(J,{},T),{horizontal:{},vertical:void 0}),ve=J.text;let Ce,Ee=[0,0];if(ve){const pt=ve.toString(),kt=N.get("text-letter-spacing").evaluate(J,{},T)*kr,ot=N.get("text-line-height").evaluate(J,{},T)*kr,Tt=Ug(pt)?kt:0,xt=N.get("text-anchor").evaluate(J,{},T),Pt=N.get("text-variable-anchor");if(!Pt){const Qt=N.get("text-radial-offset").evaluate(J,{},T);Ee=Qt?Uh(xt,[Qt*kr,Ym]):N.get("text-offset").evaluate(J,{},T).map(Mn=>Mn*kr)}let Rt=G?"center":N.get("text-justify").evaluate(J,{},T);const lt="point"===N.get("symbol-placement"),Gt=lt?N.get("text-max-width").evaluate(J,{},T)*kr:1/0,tn=Qt=>{o.allowVerticalPlacement&&Mr(pt)&&(he.vertical=sp(ve,t,a,m,re,Gt,ot,xt,Qt,Tt,Ee,Js.vertical,!0,xe,de))};if(!G&&Pt){const Qt="auto"===Rt?Pt.map(jt=>yb(jt)):[Rt];let Mn=!1;for(let jt=0;jt<Qt.length;jt++){const mn=Qt[jt];if(!he.horizontal[mn])if(Mn)he.horizontal[mn]=he.horizontal[0];else{const Bn=sp(ve,t,a,m,re,Gt,ot,"center",mn,Tt,Ee,Js.horizontal,!1,xe,de);Bn&&(he.horizontal[mn]=Bn,Mn=1===Bn.positionedLines.length)}}tn("left")}else{if("auto"===Rt&&(Rt=yb(xt)),lt||N.get("text-writing-mode").indexOf("horizontal")>=0||!Mr(pt)){const Qt=sp(ve,t,a,m,re,Gt,ot,xt,Rt,Tt,Ee,Js.horizontal,!1,xe,de);Qt&&(he.horizontal[Rt]=Qt)}tn(lt?"left":Rt)}}let et=!1;if(J.icon&&J.icon.name){const pt=u[J.icon.name];pt&&(Ce=Sv(m[J.icon.name],N.get("icon-offset").evaluate(J,{},T),N.get("icon-anchor").evaluate(J,{},T)),et=pt.sdf,void 0===o.sdfIcons?o.sdfIcons=pt.sdf:o.sdfIcons!==pt.sdf&&Yn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pt.pixelRatio!==o.pixelRatio||0!==N.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const Ke=Na(he.horizontal)||he.vertical;o.iconsInText||(o.iconsInText=!!Ke&&Ke.iconsInText),(Ke||Ce)&&cp(o,J,he,Ce,u,U,xe,0,Ee,et,w,T,P)}y&&o.generateCollisionDebugBuffers(I,o.collisionBoxArray)}function yb(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function cp(o,t,a,u,m,y,w,T,I,P,N,z,U){let G=y.textMaxSize.evaluate(t,{},z);void 0===G&&(G=w);const q=o.layers[0].layout,J=q.get("icon-offset").evaluate(t,{},z),re=Na(a.horizontal)||a.vertical,de="globe"===U.name,xe=kr,he=w/xe,ve=o.tilePixelRatio*G/xe,Ce=(xt=o.overscaling,o.zoom>18&&xt>2&&(xt>>=1),Math.max(_n/(512*xt),1)*q.get("symbol-spacing")),Ee=q.get("text-padding")*o.tilePixelRatio,et=q.get("icon-padding")*o.tilePixelRatio,Ke=Ft(q.get("text-max-angle")),pt="map"===q.get("text-rotation-alignment")&&"point"!==q.get("symbol-placement"),kt="map"===q.get("icon-rotation-alignment")&&"point"!==q.get("symbol-placement"),ot=q.get("symbol-placement"),Tt=Ce/2;var xt;const Pt=q.get("icon-text-fit");let Rt;u&&"none"!==Pt&&(o.allowVerticalPlacement&&a.vertical&&(Rt=dl(u,a.vertical,Pt,q.get("icon-text-fit-padding"),J,he)),re&&(u=dl(u,re,Pt,q.get("icon-text-fit-padding"),J,he)));const lt=(Gt,tn,Qt)=>{if(tn.x<0||tn.x>=_n||tn.y<0||tn.y>=_n)return;let Mn=null;if(de){const{x:jt,y:mn,z:Bn}=U.projectTilePoint(tn.x,tn.y,Qt);Mn={anchor:new ga(jt,mn,Bn,0,void 0),up:U.upVector(Qt,tn.x,tn.y)}}!function(jt,mn,Bn,mi,Pn,En,Ai,Gn,zn,Ii,qi,Vi,Ui,xr,mr,Fr,Fi,Lr,nr,gr,Mi,Kr,Qi,ps,jr){const Jr=jt.addToLineVertexArray(mn,mi);let no,Ls,io,gl,Pd,Od,Hl,cg=0,Kh=0,Gv=0,bp=0,Y_=-1,ug=-1;const Qs={};let Tb=Qa("");const Jh=Bn?Bn.anchor:mn;let Zv=0,Wv=0;if(void 0===zn._unevaluatedLayout.getValue("text-radial-offset")?[Zv,Wv]=zn.layout.get("text-offset").evaluate(Mi,{},jr).map(Ns=>Ns*kr):(Zv=zn.layout.get("text-radial-offset").evaluate(Mi,{},jr)*kr,Wv=Ym),jt.allowVerticalPlacement&&Pn.vertical){const Ns=Pn.vertical;if(mr)Od=Km(Ns),Gn&&(Hl=Km(Gn));else{const ms=zn.layout.get("text-rotate").evaluate(Mi,{},jr)+90;io=Xm(Ii,Jh,mn,qi,Vi,Ui,Ns,xr,ms,Fr),Gn&&(gl=Xm(Ii,Jh,mn,qi,Vi,Ui,Gn,Lr,ms))}}if(En){const Ns=zn.layout.get("icon-rotate").evaluate(Mi,{},jr),ms="none"!==zn.layout.get("icon-text-fit"),wp=Gm(En,Ns,Qi,ms),Ep=Gn?Gm(Gn,Ns,Qi,ms):void 0;Ls=Xm(Ii,Jh,mn,qi,Vi,Ui,En,Lr,Ns),cg=4*wp.length;const K_=jt.iconSizeData;let Eu=null;"source"===K_.kind?(Eu=[hs*zn.layout.get("icon-size").evaluate(Mi,{},jr)],Eu[0]>La&&Yn(`${jt.layerIds[0]}: Value for "icon-size" is >= ${Vl}. Reduce your "icon-size".`)):"composite"===K_.kind&&(Eu=[hs*Kr.compositeIconSizes[0].evaluate(Mi,{},jr),hs*Kr.compositeIconSizes[1].evaluate(Mi,{},jr)],(Eu[0]>La||Eu[1]>La)&&Yn(`${jt.layerIds[0]}: Value for "icon-size" is >= ${Vl}. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,wp,Eu,gr,nr,Mi,!1,Bn,mn,Jr.lineStartIndex,Jr.lineLength,-1,ps,jr),Y_=jt.icon.placedSymbolArray.length-1,Ep&&(Kh=4*Ep.length,jt.addSymbols(jt.icon,Ep,Eu,gr,nr,Mi,Js.vertical,Bn,mn,Jr.lineStartIndex,Jr.lineLength,-1,ps,jr),ug=jt.icon.placedSymbolArray.length-1)}for(const Ns in Pn.horizontal){const ms=Pn.horizontal[Ns];no||(Tb=Qa(ms.text),mr?Pd=Km(ms):no=Xm(Ii,Jh,mn,qi,Vi,Ui,ms,xr,zn.layout.get("text-rotate").evaluate(Mi,{},jr),Fr));const wp=1===ms.positionedLines.length;if(Gv+=Cc(jt,Bn,mn,ms,Ai,zn,mr,Mi,Fr,Jr,Pn.vertical?Js.horizontal:Js.horizontalOnly,wp?Object.keys(Pn.horizontal):[Ns],Qs,Y_,Kr,ps,jr),wp)break}Pn.vertical&&(bp+=Cc(jt,Bn,mn,Pn.vertical,Ai,zn,mr,Mi,Fr,Jr,Js.vertical,["vertical"],Qs,ug,Kr,ps,jr));let Sc=-1;const xp=(Ns,ms)=>Ns?Math.max(Ns,ms):ms;Sc=xp(Pd,Sc),Sc=xp(Od,Sc),Sc=xp(Hl,Sc);const X_=Sc>-1?1:0;jt.glyphOffsetArray.length>=Ul.MAX_GLYPHS&&Yn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Mi.sortKey&&jt.addToSortKeyRanges(jt.symbolInstances.length,Mi.sortKey),jt.symbolInstances.emplaceBack(Jh.x,Jh.y,Jh.z,mn.x,mn.y,Qs.right>=0?Qs.right:-1,Qs.center>=0?Qs.center:-1,Qs.left>=0?Qs.left:-1,Qs.vertical>=0?Qs.vertical:-1,Y_,ug,Tb,void 0!==no?no:jt.collisionBoxArray.length,void 0!==no?no+1:jt.collisionBoxArray.length,void 0!==io?io:jt.collisionBoxArray.length,void 0!==io?io+1:jt.collisionBoxArray.length,void 0!==Ls?Ls:jt.collisionBoxArray.length,void 0!==Ls?Ls+1:jt.collisionBoxArray.length,gl||jt.collisionBoxArray.length,gl?gl+1:jt.collisionBoxArray.length,qi,Gv,bp,cg,Kh,X_,0,Zv,Wv,Sc)}(o,tn,Mn,Gt,a,u,m,Rt,o.layers[0],o.collisionBoxArray,t.index,t.sourceLayerIndex,o.index,Ee,pt,I,0,et,kt,J,t,y,P,N,z)};if("line"===ot)for(const Gt of Pv(t.geometry,0,0,_n,_n)){const tn=Av(Gt,Ce,Ke,a.vertical||re,u,xe,ve,o.overscaling,_n);for(const Qt of tn)re&&vb(o,re.text,Tt,Qt)||lt(Gt,Qt,z)}else if("line-center"===ot){for(const Gt of t.geometry)if(Gt.length>1){const tn=hl(Gt,Ke,a.vertical||re,u,xe,ve);tn&&lt(Gt,tn,z)}}else if("Polygon"===t.type)for(const Gt of _o(t.geometry,0)){const tn=zl(Gt,16);lt(Gt[0],new ga(tn.x,tn.y,0,0,void 0),z)}else if("LineString"===t.type)for(const Gt of t.geometry)lt(Gt,new ga(Gt[0].x,Gt[0].y,0,0,void 0),z);else if("Point"===t.type)for(const Gt of t.geometry)for(const tn of Gt)lt([tn],new ga(tn.x,tn.y,0,0,void 0),z)}const Vl=255,La=Vl*hs;function Cc(o,t,a,u,m,y,w,T,I,P,N,z,U,G,q,J,re){const de=function(ve,Ce,Ee,et,Ke,pt,kt,ot){const Tt=[];if(0===Ce.positionedLines.length)return Tt;const xt=et.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,Pt=function(Qt){const Mn=Qt[0],jt=Qt[1],mn=Mn*jt;return mn>0?[Mn,-jt]:mn<0?[-Mn,jt]:0===Mn?[jt,Mn]:[jt,-Mn]}(Ee);let Rt=Math.abs(Ce.top-Ce.bottom);for(const Qt of Ce.positionedLines)Rt-=Qt.lineOffset;const lt=Ce.positionedLines.length,Gt=Rt/lt;let tn=Ce.top-Ee[1];for(let Qt=0;Qt<lt;++Qt){const Mn=Ce.positionedLines[Qt];tn=_w(Ce,Gt,tn,Qt);for(const jt of Mn.positionedGlyphs){if(!jt.rect)continue;const mn=jt.rect||{};let Bn=Um+1,mi=!0,Pn=1,En=0;if(jt.imageName){const Qi=kt[jt.imageName];if(!Qi)continue;if(Qi.sdf){Yn("SDF images are not supported in formatted text and will be ignored.");continue}mi=!1,Pn=Qi.pixelRatio,Bn=fs/Pn}const Ai=(Ke||ot)&&jt.vertical,Gn=jt.metrics.advance*jt.scale/2,zn=jt.metrics,Ii=jt.rect;if(null===Ii)continue;ot&&Ce.verticalizable&&(En=jt.imageName?Gn-jt.metrics.width*jt.scale/2:0);const qi=Ke?[jt.x+Gn,jt.y]:[0,0];let Vi=[0,0],Ui=[0,0],xr=!1;Ke||(Ai?(Ui=[jt.x+Gn+Pt[0],jt.y+Pt[1]-En],xr=!0):Vi=[jt.x+Gn+Ee[0],jt.y+Ee[1]-En]);const mr=Ii.w*jt.scale/(Pn*(jt.localGlyph?ko:1)),Fr=Ii.h*jt.scale/(Pn*(jt.localGlyph?ko:1));let Fi,Lr,nr,gr;if(Ai){const Qi=jt.y-tn,ps=new Ne(-Gn,Gn-Qi),jr=-Math.PI/2,Jr=new Ne(...Ui);Fi=new Ne(-Gn+Vi[0],Vi[1]),Fi._rotateAround(jr,ps)._add(Jr),Fi.x+=-Qi+Gn,Fi.y-=(zn.left-Bn)*jt.scale;const no=jt.imageName?zn.advance*jt.scale:kr*jt.scale,Ls=String.fromCharCode(jt.glyph);Ks(Ls)?Fi.x+=(1-Bn)*jt.scale:Bm(Ls)?Fi.x+=no-zn.height*jt.scale+(-Bn-1)*jt.scale:Fi.x+=jt.imageName||zn.width+2*Bn===Ii.w&&zn.height+2*Bn===Ii.h?(no-Fr)/2:(no-(zn.height+2*Bn)*jt.scale)/2,Lr=new Ne(Fi.x,Fi.y-mr),nr=new Ne(Fi.x+Fr,Fi.y),gr=new Ne(Fi.x+Fr,Fi.y-mr)}else{const Qi=(zn.left-Bn)*jt.scale-Gn+Vi[0],ps=(-zn.top-Bn)*jt.scale+Vi[1],jr=Qi+mr,Jr=ps+Fr;Fi=new Ne(Qi,ps),Lr=new Ne(jr,ps),nr=new Ne(Qi,Jr),gr=new Ne(jr,Jr)}if(xt){let Qi;Qi=Ke?new Ne(0,0):xr?new Ne(Pt[0],Pt[1]):new Ne(Ee[0],Ee[1]),Fi._rotateAround(xt,Qi),Lr._rotateAround(xt,Qi),nr._rotateAround(xt,Qi),gr._rotateAround(xt,Qi)}const Mi=new Ne(0,0),Kr=new Ne(0,0);Tt.push({tl:Fi,tr:Lr,bl:nr,br:gr,tex:mn,writingMode:Ce.writingMode,glyphOffset:qi,sectionIndex:jt.sectionIndex,isSDF:mi,pixelOffsetTL:Mi,pixelOffsetBR:Kr,minFontScaleX:0,minFontScaleY:0})}}return Tt}(0,u,I,y,w,T,m,o.allowVerticalPlacement),xe=o.textSizeData;let he=null;"source"===xe.kind?(he=[hs*y.layout.get("text-size").evaluate(T,{},re)],he[0]>La&&Yn(`${o.layerIds[0]}: Value for "text-size" is >= ${Vl}. Reduce your "text-size".`)):"composite"===xe.kind&&(he=[hs*q.compositeTextSizes[0].evaluate(T,{},re),hs*q.compositeTextSizes[1].evaluate(T,{},re)],(he[0]>La||he[1]>La)&&Yn(`${o.layerIds[0]}: Value for "text-size" is >= ${Vl}. Reduce your "text-size".`)),o.addSymbols(o.text,de,he,I,w,T,N,t,a,P.lineStartIndex,P.lineLength,G,J,re);for(const ve of z)U[ve]=o.text.placedSymbolArray.length-1;return 4*de.length}function Na(o){for(const t in o)return o[t];return null}function Xm(o,t,a,u,m,y,w,T,I,P){let N=w.top,z=w.bottom,U=w.left,G=w.right;const q=w.collisionPadding;if(q&&(U-=q[0],N-=q[1],G+=q[2],z+=q[3]),I){const J=new Ne(U,N),re=new Ne(G,N),de=new Ne(U,z),xe=new Ne(G,z),he=Ft(I);let ve=new Ne(0,0);P&&(ve=new Ne(P[0],P[1])),J._rotateAround(he,ve),re._rotateAround(he,ve),de._rotateAround(he,ve),xe._rotateAround(he,ve),U=Math.min(J.x,re.x,de.x,xe.x),G=Math.max(J.x,re.x,de.x,xe.x),N=Math.min(J.y,re.y,de.y,xe.y),z=Math.max(J.y,re.y,de.y,xe.y)}return o.emplaceBack(t.x,t.y,t.z,a.x,a.y,U,N,G,z,T,u,m,y),o.length-1}function Km(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const t=o.bottom-o.top;return t>0?Math.max(10,t):null}function vb(o,t,a,u){const m=o.compareText;if(t in m){const y=m[t];for(let w=y.length-1;w>=0;w--)if(u.dist(y[w])<a)return!0}else m[t]=[];return m[t].push(u),!1}function Fv(o,t){const a=o.fovAboveCenter,u=o.elevation?o.elevation.getMinElevationBelowMSL()*t:0,m=(o._camera.position[2]*o.worldSize-u)/Math.cos(o._pitch),y=Math.sin(a)*m/Math.sin(Math.max(Math.PI/2-o._pitch-a,.01)),w=Math.sin(o._pitch)*y+m;return Math.min(1.01*w,m*(1/o._horizonShift))}function pu(o,t){if(!t.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:t};const a=Math.pow(2,-o.z),u=o.x*a,m=(o.x+1)*a,y=o.y*a,w=(o.y+1)*a,T=Is(u),I=Is(m),P=po(y),N=po(w),z=t.project(T,P),U=t.project(I,P),G=t.project(I,N),q=t.project(T,N);let J=Math.min(z.x,U.x,G.x,q.x),re=Math.min(z.y,U.y,G.y,q.y),de=Math.max(z.x,U.x,G.x,q.x),xe=Math.max(z.y,U.y,G.y,q.y);const he=a/16;function ve(Ee,et,Ke,pt,kt,ot){const Tt=(Ke+kt)/2,xt=(pt+ot)/2,Pt=t.project(Is(Tt),po(xt)),Rt=Math.max(0,J-Pt.x,re-Pt.y,Pt.x-de,Pt.y-xe);J=Math.min(J,Pt.x),de=Math.max(de,Pt.x),re=Math.min(re,Pt.y),xe=Math.max(xe,Pt.y),Rt>he&&(ve(Ee,Pt,Ke,pt,Tt,xt),ve(Pt,et,Tt,xt,kt,ot))}ve(z,U,u,y,m,y),ve(U,G,m,y,m,w),ve(G,q,m,w,u,w),ve(q,z,u,w,u,y),J-=he,re-=he,de+=he,xe+=he;const Ce=1/Math.max(de-J,xe-re);return{scale:Ce,x:J*Ce,y:re*Ce,x2:de*Ce,y2:xe*Ce,projection:t}}const jh=Ko(new Float32Array(16));class Os{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,a){return{x:0,y:0,z:0}}unproject(t,a){return new Ki(0,0)}projectTilePoint(t,a,u){return{x:t,y:a,z:0}}locationPoint(t,a,u=!0){return t._coordinatePoint(t.locationCoordinate(a),u)}pixelsPerMeter(t,a){return Qo(1,t)*a}pixelSpaceConversion(t,a,u){return 1}farthestPixelDistance(t){return Fv(t,t.pixelsPerMeter)}pointCoordinate(t,a,u,m){const y=t.horizonLineFromTop(!1),w=new Ne(a,Math.max(y,u));return t.rayIntersectionCoordinate(t.pointRayIntersection(w,m))}pointCoordinate3D(t,a,u){const m=new Ne(a,u);if(t.elevation)return t.elevation.pointCoordinate(m);{const y=this.pointCoordinate(t,m.x,m.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(t,a){if(t.elevation)return!this.pointCoordinate3D(t,a.x,a.y);const u=t.horizonLineFromTop();return a.y<u}createInversionMatrix(t,a){return jh}createTileMatrix(t,a,u){let m,y,w;const T=u.canonical,I=Ko(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=pu(T,this);m=1,y=P.x+u.wrap*P.scale,w=P.y,Al(I,I,[m/P.scale,m/P.scale,t.pixelsPerMeter/a])}else m=a/t.zoomScale(T.z),y=(T.x+Math.pow(2,T.z)*u.wrap)*m,w=T.y*m;return uh(I,I,[y,w,0]),Al(I,I,[m/_n,m/_n,1]),I}upVector(t,a,u){return[0,0,1]}upVectorScale(t,a,u){return{metersToTile:1}}}class bb extends Os{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[a,u]=this.parallels=t.parallels||[29.5,45.5],m=Math.sin(Ft(a));this.n=(m+Math.sin(Ft(u)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(t,a){const{n:u,c:m,r0:y}=this,w=Ft(t-this.center[0]),T=Ft(a),I=Math.sqrt(m-2*u*Math.sin(T))/u;return{x:I*Math.sin(w*u),y:I*Math.cos(w*u)-y,z:0}}unproject(t,a){const{n:u,c:m,r0:y}=this,w=y+a;let T=Math.atan2(t,Math.abs(w))*Math.sign(w);w*u<0&&(T-=Math.PI*Math.sign(t)*Math.sign(w));const I=Ft(this.center[0])*u;T=Si(T,-Math.PI-I,Math.PI-I);const P=Wn(Kt(T/u)+this.center[0],-180,180),N=Math.asin(Wn((m-(t*t+w*w)*u*u)/(2*u),-1,1)),z=Wn(Kt(N),-Yr,Yr);return new Ki(P,z)}}const yo=1.340264,_a=-.081106,$h=893e-6,Rs=.003796,Hh=Math.sqrt(3)/2;class up extends Os{project(t,a){a=a/180*Math.PI,t=t/180*Math.PI;const u=Math.asin(Hh*Math.sin(a)),m=u*u,y=m*m*m;return{x:.5*(t*Math.cos(u)/(Hh*(yo+3*_a*m+y*(7*$h+9*Rs*m)))/Math.PI+.5),y:1-.5*(u*(yo+_a*m+y*($h+Rs*m))/Math.PI+1),z:0}}unproject(t,a){t=(2*t-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,m=u*u,y=m*m*m;for(let N,z,U,G=0;G<12&&(z=u*(yo+_a*m+y*($h+Rs*m))-a,U=yo+3*_a*m+y*(7*$h+9*Rs*m),N=z/U,u=Wn(u-N,-Math.PI/3,Math.PI/3),m=u*u,y=m*m*m,!(Math.abs(N)<1e-12));++G);const w=Hh*t*(yo+3*_a*m+y*(7*$h+9*Rs*m))/Math.cos(u),T=Math.asin(Math.sin(u)/Hh),I=Wn(180*w/Math.PI,-180,180),P=Wn(180*T/Math.PI,-Yr,Yr);return new Ki(I,P)}}class O_ extends Os{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,a){return{x:.5+t/360,y:.5-a/360,z:0}}unproject(t,a){const u=360*(t-.5),m=Wn(360*(.5-a),-Yr,Yr);return new Ki(u,m)}}const mu=Math.PI/2;function Gh(o){return Math.tan((mu+o)/2)}class di extends Os{constructor(t){super(t),this.center=t.center||[0,30];const[a,u]=this.parallels=t.parallels||[30,30];let m=Ft(a),y=Ft(u);this.southernCenter=m+y<0,this.southernCenter&&(m=-m,y=-y);const w=Math.cos(m),T=Gh(m);this.n=m===y?Math.sin(m):Math.log(w/Math.cos(y))/Math.log(Gh(y)/T),this.f=w*Math.pow(Gh(m),this.n)/this.n}project(t,a){a=Ft(a),this.southernCenter&&(a=-a),t=Ft(t-this.center[0]);const u=1e-6,{n:m,f:y}=this;y>0?a<-mu+u&&(a=-mu+u):a>mu-u&&(a=mu-u);const w=y/Math.pow(Gh(a),m);let T=w*Math.sin(m*t),I=y-w*Math.cos(m*t);return T=.5*(T/Math.PI+.5),I=.5*(I/Math.PI+.5),{x:T,y:this.southernCenter?I:1-I,z:0}}unproject(t,a){t=(2*t-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:u,f:m}=this,y=m-a,w=Math.sign(y),T=Math.sign(u)*Math.sqrt(t*t+y*y);let I=Math.atan2(t,Math.abs(y))*w;y*u<0&&(I-=Math.PI*Math.sign(t)*w);const P=Wn(Kt(I/u)+this.center[0],-180,180),N=Wn(Kt(2*Math.atan(Math.pow(m/T,1/u))-mu),-Yr,Yr);return new Ki(P,this.southernCenter?-N:N)}}class Jm extends Os{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,a){return{x:Rl(t),y:ka(a),z:0}}unproject(t,a){const u=Is(t),m=po(a);return new Ki(u,m)}}const Qm=Ft(Yr);class Tc extends Os{project(t,a){const u=(a=Ft(a))*a,m=u*u;return{x:.5*((t=Ft(t))*(.8707-.131979*u+m*(m*(.003971*u-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+m*(.028874*u-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(t,a){t=(2*t-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,m=25,y=0,w=u*u;do{w=u*u;const P=w*w;y=(u*(1.007226+w*(.015085+P*(.028874*w-.044475-.005916*P)))-a)/(1.007226+w*(.045255+P*(.259866*w-.311325-.005916*11*P))),u=Wn(u-y,-Qm,Qm)}while(Math.abs(y)>1e-6&&--m>0);w=u*u;const T=Wn(Kt(t/(.8707+w*(w*(w*w*w*(.003971-.001529*w)-.013791)-.131979))),-180,180),I=Kt(u);return new Ki(T,I)}}const eg=Ft(Yr);class Lv extends Os{project(t,a){a=Ft(a),t=Ft(t);const u=Math.cos(a),m=2/Math.PI,y=Math.acos(u*Math.cos(t/2)),w=Math.sin(y)/y,T=.5*(t*m+2*u*Math.sin(t/2)/w)||0,I=.5*(a+Math.sin(a)/w)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(I/Math.PI+1),z:0}}unproject(t,a){let u=t=(2*t-.5)*Math.PI,m=a=(2*(1-a)-1)*Math.PI,y=25;const w=1e-6;let T=0,I=0;do{const P=Math.cos(m),N=Math.sin(m),z=2*N*P,U=N*N,G=P*P,q=Math.cos(u/2),J=Math.sin(u/2),re=2*q*J,de=J*J,xe=1-G*q*q,he=xe?1/xe:0,ve=xe?Math.acos(P*q)*Math.sqrt(1/xe):0,Ce=.5*(2*ve*P*J+2*u/Math.PI)-t,Ee=.5*(ve*N+m)-a,et=.5*he*(G*de+ve*P*q*U)+1/Math.PI,Ke=he*(re*z/4-ve*N*J),pt=.125*he*(z*J-ve*N*G*re),kt=.5*he*(U*q+ve*de*P)+.5,ot=Ke*pt-kt*et;T=(Ee*Ke-Ce*kt)/ot,I=(Ce*pt-Ee*et)/ot,u=Wn(u-T,-Math.PI,Math.PI),m=Wn(m-I,-eg,eg)}while((Math.abs(T)>w||Math.abs(I)>w)&&--y>0);return new Ki(Kt(u),Kt(m))}}class Zh extends Os{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ft(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,a){const{scale:u,cosPhi:m}=this;return{x:Ft(t)*m*u+.5,y:-Math.sin(Ft(a))/m*u+.5,z:0}}unproject(t,a){const{scale:u,cosPhi:m}=this,y=-(a-.5)/u,w=Wn(Kt((t-.5)/u)/m,-180,180),T=Math.asin(Wn(y*m,-1,1)),I=Wn(Kt(T),-Yr,Yr);return new Ki(w,I)}}class Ed extends Jm{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,a,u){const m=gh(t,a,u);return Vr(m,m,_m(Oa(u))),{x:m[0],y:m[1],z:m[2]}}locationPoint(t,a){const u=su(a.lat,a.lng),m=eo([],u),y=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(a),t._centerAltitude):t._centerAltitude;dc(u,u,m,Qo(1,0)*_n*y);const w=Ko(new Float64Array(16));return nd(w,t.pixelMatrix,t.globeMatrix),Vr(u,u,w),new Ne(u[0],u[1])}pixelsPerMeter(t,a){return Qo(1,0)*a}pixelSpaceConversion(t,a,u){const m=Qo(1,t)*a,y=Ti(Qo(1,45)*a,m,u);return this.pixelsPerMeter(t,a)/y}createTileMatrix(t,a,u){const m=Jg(Oa(u.canonical));return nd(new Float64Array(16),t.globeMatrix,m)}createInversionMatrix(t,a){const{center:u}=t,m=_m(Oa(a));return sm(m,m,Ft(u.lng)),Hy(m,m,Ft(u.lat)),Al(m,m,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(t,a,u,m){return kf(t,a,u,!0)||new ld(0,0)}pointCoordinate3D(t,a,u){const m=this.pointCoordinate(t,a,u,0);return[m.x,m.y,m.z]}isPointAboveHorizon(t,a){return!kf(t,a.x,a.y,!1)}farthestPixelDistance(t){const a=function(m,y){const w=m.cameraToCenterDistance,T=m._centerAltitude*y,I=m._camera,P=m._camera.forward(),N=ol([],ds([],P,-w),[0,0,T]),z=m.worldSize/(2*Math.PI),U=[0,0,-z],G=m.width/m.height,q=Math.tan(m.fovAboveCenter),J=ds([],I.up(),q),re=ds([],I.right(),q*G),de=eo([],ol([],ol([],P,J),re)),xe=[];let he;if(new Pa(N,de).closestPointOnSphere(U,z,xe)){const ve=ol([],xe,U),Ce=al([],ve,N);he=Math.cos(m.fovAboveCenter)*dh(Ce)}else{const ve=al([],N,U),Ce=al([],U,N);eo(Ce,Ce);const Ee=dh(ve)-z;he=Math.sqrt(Ee*(Ee+2*z));const et=Math.acos(he/(z+Ee))-Math.acos(Aa(P,Ce));he*=Math.cos(et)}return 1.01*he}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),u=_h(t.zoom);if(u>0){const m=Fv(t,Qo(1,t.center.lat)*t.worldSize),y=t.worldSize/(2*Math.PI),w=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Ti(a,m+y*(1-Math.cos(w)),Math.pow(u,10))}return a}upVector(t,a,u){return gh(a,u,t,1)}upVectorScale(t){return{metersToTile:Ol(pc(Oa(t)))}}}function tg(o){const t=o.parallels,a=!!t&&Math.abs(t[0]+t[1])<.01;switch(o.name){case"mercator":return new Jm(o);case"equirectangular":return new O_(o);case"naturalEarth":return new Tc(o);case"equalEarth":return new up(o);case"winkelTripel":return new Lv(o);case"albers":return a?new Zh(o):new bb(o);case"lambertConformalConic":return a?new Zh(o):new di(o);case"globe":return new Ed(o)}throw new Error(`Invalid projection name: ${o.name}`)}const Wh=Xf.types,R_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gu(o,t,a,u,m,y,w,T,I,P,N,z,U){const G=T?Math.min(La,Math.round(T[0])):0,q=T?Math.min(La,Math.round(T[1])):0;o.emplaceBack(t,a,Math.round(32*u),Math.round(32*m),y,w,(G<<1)+(I?1:0),q,16*P,16*N,256*z,256*U)}function Cd(o,t,a,u,m,y,w){o.emplaceBack(t,a,u,m,y,w)}function _u(o,t,a,u,m){o.emplaceBack(t,a,u,m),o.emplaceBack(t,a,u,m),o.emplaceBack(t,a,u,m),o.emplaceBack(t,a,u,m)}function k_(o){for(const t of o.sections)if(sh(t.text))return!0;return!1}class qh{constructor(t){this.layoutVertexArray=new gt,this.indexArray=new ln,this.programConfigurations=t,this.segments=new Rr,this.dynamicLayoutVertexArray=new bt,this.opacityVertexArray=new bn,this.placedSymbolArray=new Or,this.globeExtVertexArray=new wt}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,a,u,m){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vC.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,yv.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,R_,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Oh.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}hn(qh,"SymbolBuffers");class ng{constructor(t,a,u){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new u,this.segments=new Rr,this.collisionVertexArray=new Jn,this.collisionVertexArrayExt=new An}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,tp.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Fm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}hn(ng,"CollisionBuffers");class Ul{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(w=>w.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ko([]),this.placementViewportMatrix=Ko([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=uu(this.zoom,a["text-size"]),this.iconSizeData=uu(this.zoom,a["icon-size"]);const u=this.layers[0].layout,m=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==y&&void 0!==m.constantOr(1),this.sortFeaturesByY=("viewport-y"===y||"auto"===y&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(w=>Js[w]),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new qh(new uc(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new qh(new uc(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new us,this.lineVertexArray=new ua,this.symbolInstances=new Ri}calculateGlyphDependencies(t,a,u,m,y){for(let w=0;w<t.length;w++)if(a[t.charCodeAt(w)]=!0,m&&y){const T=vd[t.charAt(w)];T&&(a[T.charCodeAt(0)]=!0)}}populate(t,a,u,m){const y=this.layers[0],w=y.layout,T="globe"===this.projection.name,I=w.get("text-font"),P=w.get("text-field"),N=w.get("icon-image"),z=("constant"!==P.value.kind||P.value.value instanceof Xi&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&("constant"!==I.value.kind||I.value.value.length>0),U="constant"!==N.value.kind||!!N.value.value||Object.keys(N.parameters).length>0,G=w.get("symbol-sort-key");if(this.features=[],!z&&!U)return;const q=a.iconDependencies,J=a.glyphDependencies,re=a.availableImages,de=new B(this.zoom);for(const{feature:xe,id:he,index:ve,sourceLayerIndex:Ce}of t){const Ee=y._featureFilter.needGeometry,et=ud(xe,Ee);if(!y._featureFilter.filter(de,et,u))continue;if(Ee||(et.geometry=kl(xe,u,m)),T&&1!==xe.type&&u.z<=5){const ot=et.geometry,Tt=.98078528056,xt=(Pt,Rt)=>Aa(gh(Pt.x,Pt.y,u,1),gh(Rt.x,Rt.y,u,1))<Tt;for(let Pt=0;Pt<ot.length;Pt++)ot[Pt]=nb(ot[Pt],xt)}let Ke,pt;if(z){const ot=y.getValueAndResolveTokens("text-field",et,u,re),Tt=Xi.factory(ot);k_(Tt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===S()||this.hasRTLText&&F.isParsed())&&(Ke=yd(Tt,y,et))}if(U){const ot=y.getValueAndResolveTokens("icon-image",et,u,re);pt=ot instanceof Mo?ot:Mo.fromString(ot)}if(!Ke&&!pt)continue;const kt=this.sortFeaturesByKey?G.evaluate(et,{},u):void 0;if(this.features.push({id:he,text:Ke,icon:pt,index:ve,sourceLayerIndex:Ce,geometry:et.geometry,properties:xe.properties,type:Wh[xe.type],sortKey:kt}),pt&&(q[pt.name]=!0),Ke){const ot=I.evaluate(et,{},u).join(","),Tt="map"===w.get("text-rotation-alignment")&&"point"!==w.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Js.vertical)>=0;for(const xt of Ke.sections)if(xt.image)q[xt.image.name]=!0;else{const Pt=Mr(Ke.toString()),Rt=xt.fontStack||ot,lt=J[Rt]=J[Rt]||{};this.calculateGlyphDependencies(xt.text,lt,Tt,this.allowVerticalPlacement,Pt)}}}"line"===w.get("symbol-placement")&&(this.features=function(xe){const he={},ve={},Ce=[];let Ee=0;function et(ot){Ce.push(xe[ot]),Ee++}function Ke(ot,Tt,xt){const Pt=ve[ot];return delete ve[ot],ve[Tt]=Pt,Ce[Pt].geometry[0].pop(),Ce[Pt].geometry[0]=Ce[Pt].geometry[0].concat(xt[0]),Pt}function pt(ot,Tt,xt){const Pt=he[Tt];return delete he[Tt],he[ot]=Pt,Ce[Pt].geometry[0].shift(),Ce[Pt].geometry[0]=xt[0].concat(Ce[Pt].geometry[0]),Pt}function kt(ot,Tt,xt){const Pt=xt?Tt[0][Tt[0].length-1]:Tt[0][0];return`${ot}:${Pt.x}:${Pt.y}`}for(let ot=0;ot<xe.length;ot++){const Tt=xe[ot],xt=Tt.geometry,Pt=Tt.text?Tt.text.toString():null;if(!Pt){et(ot);continue}const Rt=kt(Pt,xt),lt=kt(Pt,xt,!0);if(Rt in ve&&lt in he&&ve[Rt]!==he[lt]){const Gt=pt(Rt,lt,xt),tn=Ke(Rt,lt,Ce[Gt].geometry);delete he[Rt],delete ve[lt],ve[kt(Pt,Ce[tn].geometry,!0)]=tn,Ce[Gt].geometry=null}else Rt in ve?Ke(Rt,lt,xt):lt in he?pt(Rt,lt,xt):(et(ot),he[Rt]=Ee-1,ve[lt]=Ee-1)}return Ce.filter(ot=>ot.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((xe,he)=>xe.sortKey-he.sortKey)}update(t,a,u,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,u,m),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,u,m))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=tg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,a){const u=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:m,y}of a)this.lineVertexArray.emplaceBack(m,y);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,a,u,m,y,w,T,I,P,N,z,U,G,q){const J=t.indexArray,re=t.layoutVertexArray,de=t.globeExtVertexArray,xe=t.segments.prepareSegment(4*a.length,re,J,this.canOverlap?w.sortKey:void 0),he=this.glyphOffsetArray.length,ve=xe.vertexLength,Ce=this.allowVerticalPlacement&&T===Js.vertical?Math.PI/2:0,Ee=w.text&&w.text.sections;for(let Ke=0;Ke<a.length;Ke++){const{tl:pt,tr:kt,bl:ot,br:Tt,tex:xt,pixelOffsetTL:Pt,pixelOffsetBR:Rt,minFontScaleX:lt,minFontScaleY:Gt,glyphOffset:tn,isSDF:Qt,sectionIndex:Mn}=a[Ke],jt=xe.vertexLength,mn=tn[1];if(gu(re,P.x,P.y,pt.x,mn+pt.y,xt.x,xt.y,u,Qt,Pt.x,Pt.y,lt,Gt),gu(re,P.x,P.y,kt.x,mn+kt.y,xt.x+xt.w,xt.y,u,Qt,Rt.x,Pt.y,lt,Gt),gu(re,P.x,P.y,ot.x,mn+ot.y,xt.x,xt.y+xt.h,u,Qt,Pt.x,Rt.y,lt,Gt),gu(re,P.x,P.y,Tt.x,mn+Tt.y,xt.x+xt.w,xt.y+xt.h,u,Qt,Rt.x,Rt.y,lt,Gt),I){const{x:Bn,y:mi,z:Pn}=I.anchor,[En,Ai,Gn]=I.up;Cd(de,Bn,mi,Pn,En,Ai,Gn),Cd(de,Bn,mi,Pn,En,Ai,Gn),Cd(de,Bn,mi,Pn,En,Ai,Gn),Cd(de,Bn,mi,Pn,En,Ai,Gn),_u(t.dynamicLayoutVertexArray,Bn,mi,Pn,Ce)}else _u(t.dynamicLayoutVertexArray,P.x,P.y,P.z,Ce);J.emplaceBack(jt,jt+1,jt+2),J.emplaceBack(jt+1,jt+2,jt+3),xe.vertexLength+=4,xe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tn[0]),Ke!==a.length-1&&Mn===a[Ke+1].sectionIndex||t.programConfigurations.populatePaintArrays(re.length,w,w.index,{},G,q,Ee&&Ee[Mn])}const et=I?I.anchor:P;t.placedSymbolArray.emplaceBack(et.x,et.y,et.z,P.x,P.y,he,this.glyphOffsetArray.length-he,ve,N,z,P.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],T,0,!1,0,U,0)}_commitLayoutVertex(t,a,u,m,y,w,T){t.emplaceBack(a,u,m,y,w,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(t,a,u,m,y,w,T){const I=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),P=I.vertexLength,N=T.tileAnchorX,z=T.tileAnchorY;for(let G=0;G<4;G++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(a,-t.padding,-t.padding),u.collisionVertexArrayExt.emplaceBack(a,t.padding,-t.padding),u.collisionVertexArrayExt.emplaceBack(a,t.padding,t.padding),u.collisionVertexArrayExt.emplaceBack(a,-t.padding,t.padding),this._commitLayoutVertex(u.layoutVertexArray,m,y,w,N,z,new Ne(t.x1,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,y,w,N,z,new Ne(t.x2,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,y,w,N,z,new Ne(t.x2,t.y2)),this._commitLayoutVertex(u.layoutVertexArray,m,y,w,N,z,new Ne(t.x1,t.y2)),I.vertexLength+=4;const U=u.indexArray;U.emplaceBack(P,P+1),U.emplaceBack(P+1,P+2),U.emplaceBack(P+2,P+3),U.emplaceBack(P+3,P),I.primitiveLength+=4}_addTextDebugCollisionBoxes(t,a,u,m,y,w){for(let T=m;T<y;T++){const I=u.get(T),P=this.getSymbolInstanceTextSize(t,w,a,T);this._addCollisionDebugVertices(I,P,this.textCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,w)}}_addIconDebugCollisionBoxes(t,a,u,m,y,w){for(let T=m;T<y;T++){const I=u.get(T),P=this.getSymbolInstanceIconSize(t,a,w.placedIconSymbolIndex);this._addCollisionDebugVertices(I,P,this.iconCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,w)}}generateCollisionDebugBuffers(t,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ng(an,yc.members,qr),this.iconCollisionBox=new ng(an,yc.members,qr);const u=ul(this.iconSizeData,t),m=ul(this.textSizeData,t);for(let y=0;y<this.symbolInstances.length;y++){const w=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(m,t,a,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(m,t,a,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(u,t,a,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(u,t,a,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(t,a,u,m){const y=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:m),w=Bl(this.textSizeData,t,y)/kr;return this.tilePixelRatio*w}getSymbolInstanceIconSize(t,a,u){const m=this.icon.placedSymbolArray.get(u),y=Bl(this.iconSizeData,t,m);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(t,a,u){t.emplaceBack(a,-u,-u),t.emplaceBack(a,u,-u),t.emplaceBack(a,u,u),t.emplaceBack(a,-u,u)}_updateTextDebugCollisionBoxes(t,a,u,m,y,w){for(let T=m;T<y;T++){const I=u.get(T),P=this.getSymbolInstanceTextSize(t,w,a,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,P,I.padding)}}_updateIconDebugCollisionBoxes(t,a,u,m,y,w){for(let T=m;T<y;T++){const I=u.get(T),P=this.getSymbolInstanceIconSize(t,a,w);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,P,I.padding)}}updateCollisionDebugBuffers(t,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=ul(this.iconSizeData,t),m=ul(this.textSizeData,t);for(let y=0;y<this.symbolInstances.length;y++){const w=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(m,t,a,w.textBoxStartIndex,w.textBoxEndIndex,w),this._updateTextDebugCollisionBoxes(m,t,a,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._updateIconDebugCollisionBoxes(u,t,a,w.iconBoxStartIndex,w.iconBoxEndIndex,w.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,t,a,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,a,u,m,y,w,T,I,P){const N={};if(a<u){const{x1:z,y1:U,x2:G,y2:q,padding:J,projectedAnchorX:re,projectedAnchorY:de,projectedAnchorZ:xe,tileAnchorX:he,tileAnchorY:ve,featureIndex:Ce}=t.get(a);N.textBox={x1:z,y1:U,x2:G,y2:q,padding:J,projectedAnchorX:re,projectedAnchorY:de,projectedAnchorZ:xe,tileAnchorX:he,tileAnchorY:ve},N.textFeatureIndex=Ce}if(m<y){const{x1:z,y1:U,x2:G,y2:q,padding:J,projectedAnchorX:re,projectedAnchorY:de,projectedAnchorZ:xe,tileAnchorX:he,tileAnchorY:ve,featureIndex:Ce}=t.get(m);N.verticalTextBox={x1:z,y1:U,x2:G,y2:q,padding:J,projectedAnchorX:re,projectedAnchorY:de,projectedAnchorZ:xe,tileAnchorX:he,tileAnchorY:ve},N.verticalTextFeatureIndex=Ce}if(w<T){const{x1:z,y1:U,x2:G,y2:q,padding:J,projectedAnchorX:re,projectedAnchorY:de,projectedAnchorZ:xe,tileAnchorX:he,tileAnchorY:ve,featureIndex:Ce}=t.get(w);N.iconBox={x1:z,y1:U,x2:G,y2:q,padding:J,projectedAnchorX:re,projectedAnchorY:de,projectedAnchorZ:xe,tileAnchorX:he,tileAnchorY:ve},N.iconFeatureIndex=Ce}if(I<P){const{x1:z,y1:U,x2:G,y2:q,padding:J,projectedAnchorX:re,projectedAnchorY:de,projectedAnchorZ:xe,tileAnchorX:he,tileAnchorY:ve,featureIndex:Ce}=t.get(I);N.verticalIconBox={x1:z,y1:U,x2:G,y2:q,padding:J,projectedAnchorX:re,projectedAnchorY:de,projectedAnchorZ:xe,tileAnchorX:he,tileAnchorY:ve},N.verticalIconFeatureIndex=Ce}return N}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,a){const u=t.placedSymbolArray.get(a),m=u.vertexStartIndex+4*u.numGlyphs;for(let y=u.vertexStartIndex;y<m;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(t),u=Math.cos(t),m=[],y=[],w=[];for(let T=0;T<this.symbolInstances.length;++T){w.push(T);const I=this.symbolInstances.get(T);m.push(0|Math.round(a*I.tileAnchorX+u*I.tileAnchorY)),y.push(I.featureIndex)}return w.sort((T,I)=>m[T]-m[I]||y[I]-y[T]),w}addToSortKeyRanges(t,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:P}=u;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&y!==m&&this.addIndicesForPlacedSymbol(this.text,y),w>=0&&w!==y&&w!==m&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}hn(Ul,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ul.MAX_GLYPHS=65535,Ul.addDynamicAttributes=_u;const ig=new ge({"symbol-placement":new K(ct.layout_symbol["symbol-placement"]),"symbol-spacing":new K(ct.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new K(ct.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new oe(ct.layout_symbol["symbol-sort-key"]),"symbol-z-order":new K(ct.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new K(ct.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new K(ct.layout_symbol["icon-ignore-placement"]),"icon-optional":new K(ct.layout_symbol["icon-optional"]),"icon-rotation-alignment":new K(ct.layout_symbol["icon-rotation-alignment"]),"icon-size":new oe(ct.layout_symbol["icon-size"]),"icon-text-fit":new K(ct.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new K(ct.layout_symbol["icon-text-fit-padding"]),"icon-image":new oe(ct.layout_symbol["icon-image"]),"icon-rotate":new oe(ct.layout_symbol["icon-rotate"]),"icon-padding":new K(ct.layout_symbol["icon-padding"]),"icon-keep-upright":new K(ct.layout_symbol["icon-keep-upright"]),"icon-offset":new oe(ct.layout_symbol["icon-offset"]),"icon-anchor":new oe(ct.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new K(ct.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new K(ct.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new K(ct.layout_symbol["text-rotation-alignment"]),"text-field":new oe(ct.layout_symbol["text-field"]),"text-font":new oe(ct.layout_symbol["text-font"]),"text-size":new oe(ct.layout_symbol["text-size"]),"text-max-width":new oe(ct.layout_symbol["text-max-width"]),"text-line-height":new oe(ct.layout_symbol["text-line-height"]),"text-letter-spacing":new oe(ct.layout_symbol["text-letter-spacing"]),"text-justify":new oe(ct.layout_symbol["text-justify"]),"text-radial-offset":new oe(ct.layout_symbol["text-radial-offset"]),"text-variable-anchor":new K(ct.layout_symbol["text-variable-anchor"]),"text-anchor":new oe(ct.layout_symbol["text-anchor"]),"text-max-angle":new K(ct.layout_symbol["text-max-angle"]),"text-writing-mode":new K(ct.layout_symbol["text-writing-mode"]),"text-rotate":new oe(ct.layout_symbol["text-rotate"]),"text-padding":new K(ct.layout_symbol["text-padding"]),"text-keep-upright":new K(ct.layout_symbol["text-keep-upright"]),"text-transform":new oe(ct.layout_symbol["text-transform"]),"text-offset":new oe(ct.layout_symbol["text-offset"]),"text-allow-overlap":new K(ct.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new K(ct.layout_symbol["text-ignore-placement"]),"text-optional":new K(ct.layout_symbol["text-optional"])});var dp={paint:new ge({"icon-opacity":new oe(ct.paint_symbol["icon-opacity"]),"icon-color":new oe(ct.paint_symbol["icon-color"]),"icon-halo-color":new oe(ct.paint_symbol["icon-halo-color"]),"icon-halo-width":new oe(ct.paint_symbol["icon-halo-width"]),"icon-halo-blur":new oe(ct.paint_symbol["icon-halo-blur"]),"icon-translate":new K(ct.paint_symbol["icon-translate"]),"icon-translate-anchor":new K(ct.paint_symbol["icon-translate-anchor"]),"text-opacity":new oe(ct.paint_symbol["text-opacity"]),"text-color":new oe(ct.paint_symbol["text-color"],{runtimeType:$o,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new oe(ct.paint_symbol["text-halo-color"]),"text-halo-width":new oe(ct.paint_symbol["text-halo-width"]),"text-halo-blur":new oe(ct.paint_symbol["text-halo-blur"]),"text-translate":new K(ct.paint_symbol["text-translate"]),"text-translate-anchor":new K(ct.paint_symbol["text-translate-anchor"])}),layout:ig};class F_{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ql,this.defaultValue=t}evaluate(t){if(t.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}hn(F_,"FormatSectionOverride",{omit:["defaultValue"]});class hp extends nl{constructor(t){super(t,dp)}recalculate(t,a){super.recalculate(t,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const m=[];for(const y of u)m.indexOf(y)<0&&m.push(y);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,a,u,m){const y=this.layout.get(t).evaluate(a,{},u,m),w=this._unevaluatedLayout._values[t];return w.isDataDriven()||jc(w.value)||!y?y:(T=a.properties,y.replace(/{([^{}]+)}/g,(P,N)=>N in T?String(T[N]):""));var T}createBucket(t){return new Ul(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of dp.paint.overridableProperties){if(!hp.hasPaintOverride(this.layout,t))continue;const a=this.paint.get(t),u=new F_(a),m=new Wu(u,a.property.specification);let y=null;y="constant"===a.value.kind||"source"===a.value.kind?new Ma("source",m):new Hc("composite",m,a.value.zoomStops,a.value._interpolationType),this.paint._values[t]=new ae(a.property,y,a.parameters)}}_handleOverridablePaintPropertyUpdate(t,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&hp.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,a){const u=t.get("text-field"),m=dp.paint.properties[a];let y=!1;const w=T=>{for(const I of T)if(m.overrides&&m.overrides.hasOverride(I))return void(y=!0)};if("constant"===u.value.kind&&u.value.value instanceof Xi)w(u.value.value.sections);else if("source"===u.value.kind){const T=P=>{y||(P instanceof cn&&Dr(P.value)===bl?w(P.value.sections):P instanceof Ar?w(P.sections):P.eachChild(T))},I=u.value;I._styleExpression&&T(I._styleExpression.expression)}return y}getProgramConfiguration(t){return new Qc(this,t)}}var ks={paint:new ge({"background-color":new K(ct.paint_background["background-color"]),"background-pattern":new K(ct.paint_background["background-pattern"]),"background-opacity":new K(ct.paint_background["background-opacity"])})},yu={paint:new ge({"raster-opacity":new K(ct.paint_raster["raster-opacity"]),"raster-hue-rotate":new K(ct.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new K(ct.paint_raster["raster-brightness-min"]),"raster-brightness-max":new K(ct.paint_raster["raster-brightness-max"]),"raster-saturation":new K(ct.paint_raster["raster-saturation"]),"raster-contrast":new K(ct.paint_raster["raster-contrast"]),"raster-resampling":new K(ct.paint_raster["raster-resampling"]),"raster-fade-duration":new K(ct.paint_raster["raster-fade-duration"])})};class L_ extends nl{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var xb={paint:new ge({"sky-type":new K(ct.paint_sky["sky-type"]),"sky-atmosphere-sun":new K(ct.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new K(ct.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new K(ct.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new K(ct.paint_sky["sky-gradient-radius"]),"sky-gradient":new pe(ct.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new K(ct.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new K(ct.paint_sky["sky-atmosphere-color"]),"sky-opacity":new K(ct.paint_sky["sky-opacity"])})};function Nv(o,t,a){const u=[0,0,1],m=Of([]);return hm(m,m,a?-Ft(o)+Math.PI:Ft(o)),Rf(m,m,-Ft(t)),eb(u,u,m),eo(u,u)}const fp={circle:class extends nl{constructor(o){super(o,Eh)}createBucket(o){return new hd(o)}queryRadius(o){const t=o;return mc("circle-radius",this,t)+mc("circle-stroke-width",this,t)+xh(this.paint.get("circle-translate"))}queryIntersectsFeature(o,t,a,u,m,y,w,T){const I=wh(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,o.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(t,a)+this.paint.get("circle-stroke-width").evaluate(t,a);return nv(o,u,y,w,T,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),I,P)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new Qc(this,o)}},heatmap:class extends nl{createBucket(o){return new iv(o)}constructor(o){super(o,rv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return mc("heatmap-radius",this,o)}queryIntersectsFeature(o,t,a,u,m,y,w,T){const I=this.paint.get("heatmap-radius").evaluate(t,a);return nv(o,u,y,w,T,!0,!0,new Ne(0,0),I)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new Qc(this,o)}},hillshade:class extends nl{constructor(o){super(o,sb)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends nl{constructor(o){super(o,gd)}getProgramIds(){const o=this.paint.get("fill-pattern"),t=o&&o.constantOr(1),a=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(o){return new Qc(this,o)}recalculate(o,t){super.recalculate(o,t);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Dh(o)}queryRadius(){return xh(this.paint.get("fill-translate"))}queryIntersectsFeature(o,t,a,u,m,y){return!o.queryGeometry.isAboveHorizon&&n_(lu(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,o.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends nl{constructor(o){super(o,ep)}createBucket(o){return new Am(o)}queryRadius(){return xh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new Qc(this,o)}queryIntersectsFeature(o,t,a,u,m,y,w,T,I){const P=wh(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,o.pixelToTileUnitsFactor),N=this.paint.get("fill-extrusion-height").evaluate(t,a),z=this.paint.get("fill-extrusion-base").evaluate(t,a),U=[0,0],G=T&&y.elevation,q=y.elevation?y.elevation.exaggeration():1,J=o.tile.getBucket(this);if(G&&J instanceof Am){const ve=J.centroidVertexArray,Ce=I+1;Ce<ve.length&&(U[0]=ve.geta_centroid_pos0(Ce),U[1]=ve.geta_centroid_pos1(Ce))}if(0===U[0]&&1===U[1])return!1;"globe"===y.projection.name&&(u=fv([u],[new Ne(0,0),new Ne(_n,_n)],o.tileID.canonical).map(ve=>ve.polygon).flat());const re=G?T:null,[de,xe]=(Ce=u,Ee=z,et=N,Ke=P,pt=w,kt=re,ot=U,Tt=q,xt=y.center.lat,"globe"===(ve=y).projection.name?function(Rt,lt,Gt,tn,Qt,Mn,jt,mn,Bn,mi,Pn){const En=[],Ai=[],Gn=Rt.projection.upVectorScale(Pn,Rt.center.lat,Rt.worldSize).metersToTile,zn=[0,0,0,1],Ii=[0,0,0,1],qi=(Ui,xr,mr,Fr)=>{Ui[0]=xr,Ui[1]=mr,Ui[2]=Fr,Ui[3]=1},Vi=Qf();Gt>0&&(Gt+=Vi),tn+=Vi;for(const Ui of lt){const xr=[],mr=[];for(const Fr of Ui){const Fi=Fr.x+Qt.x,Lr=Fr.y+Qt.y,nr=Rt.projection.projectTilePoint(Fi,Lr,Pn),gr=Rt.projection.upVector(Pn,Fr.x,Fr.y);let Mi=Gt,Kr=tn;if(jt){const Qi=Rm(Fi,Lr,Gt,tn,jt,mn,Bn,mi);Mi+=Qi.base,Kr+=Qi.top}0!==Gt?qi(zn,nr.x+gr[0]*Gn*Mi,nr.y+gr[1]*Gn*Mi,nr.z+gr[2]*Gn*Mi):qi(zn,nr.x,nr.y,nr.z),qi(Ii,nr.x+gr[0]*Gn*Kr,nr.y+gr[1]*Gn*Kr,nr.z+gr[2]*Gn*Kr),Vr(zn,zn,Mn),Vr(Ii,Ii,Mn),xr.push(new Ah(zn[0],zn[1],zn[2])),mr.push(new Ah(Ii[0],Ii[1],Ii[2]))}En.push(xr),Ai.push(mr)}return[En,Ai]}(ve,Ce,Ee,et,Ke,pt,kt,ot,Tt,xt,o.tileID.canonical):kt?function(Rt,lt,Gt,tn,Qt,Mn,jt,mn,Bn){const mi=[],Pn=[],En=[0,0,0,1];for(const Ai of Rt){const Gn=[],zn=[];for(const Ii of Ai){const qi=Ii.x+tn.x,Vi=Ii.y+tn.y,Ui=Rm(qi,Vi,lt,Gt,Mn,jt,mn,Bn);En[0]=qi,En[1]=Vi,En[2]=Ui.base,En[3]=1,nu(En,En,Qt),En[3]=Math.max(En[3],1e-5);const xr=new Ah(En[0]/En[3],En[1]/En[3],En[2]/En[3]);En[0]=qi,En[1]=Vi,En[2]=Ui.top,En[3]=1,nu(En,En,Qt),En[3]=Math.max(En[3],1e-5);const mr=new Ah(En[0]/En[3],En[1]/En[3],En[2]/En[3]);Gn.push(xr),zn.push(mr)}mi.push(Gn),Pn.push(zn)}return[mi,Pn]}(Ce,Ee,et,Ke,pt,kt,ot,Tt,xt):function(Rt,lt,Gt,tn,Qt){const Mn=[],jt=[],mn=Qt[8]*lt,Bn=Qt[9]*lt,mi=Qt[10]*lt,Pn=Qt[11]*lt,En=Qt[8]*Gt,Ai=Qt[9]*Gt,Gn=Qt[10]*Gt,zn=Qt[11]*Gt;for(const Ii of Rt){const qi=[],Vi=[];for(const Ui of Ii){const xr=Ui.x+tn.x,mr=Ui.y+tn.y,Fr=Qt[0]*xr+Qt[4]*mr+Qt[12],Fi=Qt[1]*xr+Qt[5]*mr+Qt[13],Lr=Qt[2]*xr+Qt[6]*mr+Qt[14],nr=Qt[3]*xr+Qt[7]*mr+Qt[15],gr=Fr+mn,Mi=Fi+Bn,Kr=Lr+mi,Qi=Math.max(nr+Pn,1e-5),ps=Fr+En,jr=Fi+Ai,Jr=Lr+Gn,no=Math.max(nr+zn,1e-5);qi.push(new Ah(gr/Qi,Mi/Qi,Kr/Qi)),Vi.push(new Ah(ps/no,jr/no,Jr/no))}Mn.push(qi),jt.push(Vi)}return[Mn,jt]}(Ce,Ee,et,Ke,pt)),he=o.queryGeometry;var ve,Ce,Ee,et,Ke,pt,kt,ot,Tt,xt;return function(ve,Ce,Ee){let et=1/0;n_(Ee,Ce)&&(et=Ct(Ee,Ce[0]));for(let Ke=0;Ke<Ce.length;Ke++){const pt=Ce[Ke],kt=ve[Ke];for(let ot=0;ot<pt.length-1;ot++){const Tt=pt[ot],xt=[Tt,pt[ot+1],kt[ot+1],kt[ot],Tt];Fl(Ee,xt)&&(et=Math.min(et,Ct(Ee,xt)))}}return et!==1/0&&et}(de,xe,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},line:class extends nl{constructor(o){super(o,Ph),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Pg,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,t){super.recalculate(o,t),this.paint._values["line-floorwidth"]=km.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new x_(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new Qc(this,o)}queryRadius(o){const t=o,a=_v(mc("line-width",this,t),mc("line-gap-width",this,t)),u=mc("line-offset",this,t);return a/2+Math.abs(u)+xh(this.paint.get("line-translate"))}queryIntersectsFeature(o,t,a,u,m,y){if(o.queryGeometry.isAboveHorizon)return!1;const w=lu(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,o.pixelToTileUnitsFactor),T=o.pixelToTileUnitsFactor/2*_v(this.paint.get("line-width").evaluate(t,a),this.paint.get("line-gap-width").evaluate(t,a)),I=this.paint.get("line-offset").evaluate(t,a);return I&&(u=function(P,N){const z=[],U=new Ne(0,0);for(let G=0;G<P.length;G++){const q=P[G],J=[];for(let re=0;re<q.length;re++){const de=q[re],xe=q[re+1],he=0===re?U:de.sub(q[re-1])._unit()._perp(),ve=re===q.length-1?U:xe.sub(de)._unit()._perp(),Ce=he._add(ve)._unit();Ce._mult(1/(Ce.x*ve.x+Ce.y*ve.y)),J.push(Ce._mult(N)._add(de))}z.push(J)}return z}(u,I*o.pixelToTileUnitsFactor)),function(P,N,z){for(let U=0;U<N.length;U++){const G=N[U];if(P.length>=3)for(let q=0;q<G.length;q++)if(au(P,G[q]))return!0;if(i_(P,G,z))return!0}return!1}(w,u,T)}isTileClipped(){return!0}},symbol:hp,background:class extends nl{constructor(o){super(o,ks)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends nl{constructor(o){super(o,yu)}getProgramIds(){return["raster"]}},sky:class extends nl{constructor(o){super(o,xb),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=xm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(o,t){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),m=!u,y=o.style.light,w=y.properties.get("position");return m&&"viewport"===y.properties.get("anchor")&&Yn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?Nv(w.azimuthal,90-w.polar,t):Nv(u[0],90-u[1],t)}const a=this.paint.get("sky-gradient-center");return Nv(a[0],90-a[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}};class to{constructor(t,a,u,m){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(a,m)}update(t,a,u){const{width:m,height:y}=t,{context:w}=this,{gl:T}=w,{HTMLImageElement:I,HTMLCanvasElement:P,HTMLVideoElement:N,ImageData:z,ImageBitmap:U}=ue;if(T.bindTexture(T.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!a||!1!==a.premultiply)),u||this.size&&this.size[0]===m&&this.size[1]===y){const{x:G,y:q}=u||{x:0,y:0};t instanceof I||t instanceof P||t instanceof N||t instanceof z||U&&t instanceof U?T.texSubImage2D(T.TEXTURE_2D,0,G,q,T.RGBA,T.UNSIGNED_BYTE,t):T.texSubImage2D(T.TEXTURE_2D,0,G,q,m,y,T.RGBA,T.UNSIGNED_BYTE,t.data)}else this.size=[m,y],t instanceof I||t instanceof P||t instanceof N||t instanceof z||U&&t instanceof U?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,t):T.texImage2D(T.TEXTURE_2D,0,this.format,m,y,0,this.format,T.UNSIGNED_BYTE,t.data);this.useMipmap=!!(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&T.generateMipmap(T.TEXTURE_2D)}bind(t,a){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),t!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?t===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_NEAREST:t),this.filter=t),a!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class N_{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class rg{constructor(){this.tasks={},this.taskQueue=[],yt(["process"],this),this.invoker=new N_(this.process),this.nextId=0}add(t,a){const u=this.nextId++,m=function({type:y,isSymbolTile:w,zoom:T}){return T=T||0,"message"===y?0:"maybePrepare"!==y||w?"parseTile"!==y||w?"parseTile"===y&&w?300-T:"maybePrepare"===y&&w?400-T:500:200-T:100-T}(a);if(0===m){Pi();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:t,metadata:a,priority:m,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){Pi();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const a=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let t=null,a=1/0;for(let m=0;m<this.taskQueue.length;m++){const y=this.tasks[this.taskQueue[m]];y.priority<a&&(a=y.priority,t=m)}if(null===t)return null;const u=this.taskQueue[t];return this.taskQueue.splice(t,1),u}remove(){this.invoker.remove()}}class wb{constructor(t){this._stringToNumber={},this._numberToString=[];for(let a=0;a<t.length;a++){const u=t[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const pp=["tile","layer","source","sourceLayer","state"];class B_{constructor(t,a,u,m,y){this.type="Feature",this._vectorTileFeature=t,this._z=a,this._x=u,this._y=m,this.properties=t.properties,this.id=y}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const a of pp)void 0!==this[a]&&(t[a]=this[a]);return t}}const Td=new Uint16Array(8184);for(let o=0;o<2046;o++){let t=o+2,a=0,u=0,m=0,y=0,w=0,T=0;for(1&t?m=y=w=32:a=u=T=32;(t>>=1)>1;){const P=a+m>>1,N=u+y>>1;1&t?(m=a,y=u,a=w,u=T):(a=m,u=y,m=w,y=T),w=P,T=N}const I=4*o;Td[I+0]=a,Td[I+1]=u,Td[I+2]=m,Td[I+3]=y}const jl=new Uint16Array(2178),Md=new Uint8Array(1089),z_=new Uint16Array(1089);function V_(o){return 0===o?-.03125:32===o?.03125:0}var Bv=Re([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const U_={type:2,extent:_n,loadGeometry:()=>[[new Ne(0,0),new Ne(_n+1,0),new Ne(_n+1,_n+1),new Ne(0,_n+1),new Ne(0,0)]]};class zv{constructor(t,a,u,m,y){this.tileID=t,this.uid=Mt(),this.uses=0,this.tileSize=a,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(t){const a=t+this.timeAdded;a<To.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=pu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,a,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(m,y){const w={};if(!y)return w;for(const T of m){const I=T.layerIds.map(P=>y.getLayer(P)).filter(Boolean);if(0!==I.length){T.layers=I,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(P=>I.filter(N=>N.id===P)[0]));for(const P of I)w[P.id]=T}}return w}(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof Ul){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof Ul&&y.hasRTLText){this.hasRTLText=!0,F.isLoading()||F.isLoaded()||"deferred"!==S()||R();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(m).queryRadius(y))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new _i}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const m=this.buckets[u];m.uploadPending()&&m.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new to(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new to(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new to(t,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,u,m,y,w,T,I){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:T,transform:w,params:y,tileTransform:this.tileTransform},t,a,u):{}}querySourceFeatures(t,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const m=u.loadVTLayers(),y=a?a.sourceLayer:"",w=m._geojsonTileLayer||m[y];if(!w)return;const T=Da(a&&a.filter),{z:I,x:P,y:N}=this.tileID.canonical,z={z:I,x:P,y:N};for(let U=0;U<w.length;U++){const G=w.feature(U);if(T.needGeometry){const re=ud(G,!0);if(!T.filter(new B(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!T.filter(new B(this.tileID.overscaledZ),G))continue;const q=u.getId(G,y),J=new B_(G,I,P,N,q);J.tile=z,t.push(J)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const u=ur(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let m=!1;if(this.expirationTime>u)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{const y=this.expirationTime-a;y?this.expirationTime=u+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!a)return;const u=this.latestFeatureIndex.loadVTLayers(),m=a.style.listImages();for(const y in this.buckets){if(!a.style.hasLayer(y))continue;const w=this.buckets[y],T=w.layers[0].sourceLayer||"_geojsonTileLayer",I=u[T],P=t[T];if(!I||!P||0===Object.keys(P).length)continue;if(w.update(P,I,m,this.imageAtlas&&this.imageAtlas.patternPositions||{}),w instanceof x_||w instanceof Dh){const z=a.style._getSourceCache(w.layers[0].source);a._terrain&&a._terrain.enabled&&z&&w.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(z.id,this.tileID)}const N=a&&a.style&&a.style.getLayer(y);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(w)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<To.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=To.now()+t}setTexture(t,a){const u=a.context,m=u.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new to(u,t,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,a){const u={};for(const m of a)u[m]=!0;this.dependencies[t]=u}hasDependency(t,a){for(const u of t){const m=this.dependencies[u];if(m)for(const y of a)if(m[y])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const u=kl(U_,this.tileID.canonical,this.tileTransform)[0],m=new At,y=new jn;for(let w=0;w<u.length;w++){const{x:T,y:I}=u[w];m.emplaceBack(T,I),y.emplaceBack(w)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(m,id.members),this._tileDebugSegments=Rr.simpleSegment(0,0,m.length,y.length)}_makeTileBoundsBuffers(t,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const u=kl(U_,this.tileID.canonical,this.tileTransform)[0];let m,y;if(this.isRaster){const w=function(T,I){const P=pu(T,I),N=Math.pow(2,T.z);for(let re=0;re<33;re++)for(let de=0;de<33;de++){const xe=Is((T.x+(de+V_(de))/32)/N),he=po((T.y+(re+V_(re))/32)/N),ve=I.project(xe,he),Ce=33*re+de;jl[2*Ce+0]=Math.round((ve.x*P.scale-P.x)*_n),jl[2*Ce+1]=Math.round((ve.y*P.scale-P.y)*_n)}Md.fill(0),z_.fill(0);for(let re=2045;re>=0;re--){const de=4*re,xe=Td[de+0],he=Td[de+1],ve=Td[de+2],Ce=Td[de+3],Ee=xe+ve>>1,et=he+Ce>>1,Ke=Ee+et-he,pt=et+xe-Ee,kt=33*he+xe,ot=33*Ce+ve,Tt=33*et+Ee,xt=Math.hypot((jl[2*kt+0]+jl[2*ot+0])/2-jl[2*Tt+0],(jl[2*kt+1]+jl[2*ot+1])/2-jl[2*Tt+1])>=16;Md[Tt]=Md[Tt]||(xt?1:0),re<1022&&(Md[Tt]=Md[Tt]||Md[33*(he+pt>>1)+(xe+Ke>>1)]||Md[33*(Ce+pt>>1)+(ve+Ke>>1)])}const z=new mt,U=new ln;let G=0;function q(re,de){const xe=33*de+re;return 0===z_[xe]&&(z.emplaceBack(jl[2*xe+0],jl[2*xe+1],re*_n/32,de*_n/32),z_[xe]=++G),z_[xe]-1}function J(re,de,xe,he,ve,Ce){const Ee=re+xe>>1,et=de+he>>1;if(Math.abs(re-ve)+Math.abs(de-Ce)>1&&Md[33*et+Ee])J(ve,Ce,re,de,Ee,et),J(xe,he,ve,Ce,Ee,et);else{const Ke=q(re,de),pt=q(xe,he),kt=q(ve,Ce);U.emplaceBack(Ke,pt,kt)}}return J(0,0,32,32,32,0),J(32,32,0,0,0,32),{vertices:z,indices:U}}(this.tileID.canonical,a);m=w.vertices,y=w.indices}else{m=new mt,y=new ln;for(const{x:T,y:I}of u)m.emplaceBack(T,I,0,0);const w=h_(m.int16,void 0,4);for(let T=0;T<w.length;T+=3)y.emplaceBack(w[T],w[T+1],w[T+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,Bv.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=Rr.simpleSegment(0,0,m.length,y.length)}_makeGlobeTileDebugBuffers(t,a){const u=a.projection;if(!u||"globe"!==u.name||a.freezeTileCoverage)return;const m=this.tileID.canonical,y=_m(od(m,a)),w=_h(a.zoom);let T;w>0&&(T=om(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,a,y,T,w),this._makeGlobeTileDebugTextBuffer(t,m,a,y,T,w)}_globePoint(t,a,u,m,y,w,T){let I=gh(t,a,u);if(w){const P=1<<u.z,N=Rl(m.center.lng),z=ka(m.center.lat),U=(u.x+.5)/P-N;let G=0;U>.5?G=-1:U<-.5&&(G=1);let q=(t/_n+u.x)/P+G,J=(a/_n+u.y)/P;q=(q-N)*m._pixelsPerMercatorPixel+N,J=(J-z)*m._pixelsPerMercatorPixel+z;const re=[q*m.worldSize,J*m.worldSize,0];Vr(re,re,w),I=rd(I,re,T)}return Vr(I,I,y)}_makeGlobeTileDebugBorderBuffer(t,a,u,m,y,w){const T=new At,I=new jn,P=new Ve,N=(U,G,q,J,re)=>{const de=(q-U)/(re-1),xe=(J-G)/(re-1),he=T.length;for(let ve=0;ve<re;ve++){const Ce=U+ve*de,Ee=G+ve*xe;T.emplaceBack(Ce,Ee);const et=this._globePoint(Ce,Ee,a,u,m,y,w);P.emplaceBack(et[0],et[1],et[2]),I.emplaceBack(he+ve)}},z=_n;N(0,0,z,0,16),N(z,0,z,z,16),N(z,z,0,z,16),N(0,z,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(I),this._tileDebugBuffer=t.createVertexBuffer(T,id.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(P,pm.members),this._tileDebugSegments=Rr.simpleSegment(0,0,T.length,I.length)}_makeGlobeTileDebugTextBuffer(t,a,u,m,y,w){const T=_n/4,I=new At,P=new ln,N=new Ve,z=25;P.reserve(32),I.reserve(z),N.reserve(z);const U=(G,q)=>z*G+q;for(let G=0;G<z;G++){const q=G*T;for(let J=0;J<z;J++){const re=J*T;I.emplaceBack(re,q);const de=this._globePoint(re,q,a,u,m,y,w);N.emplaceBack(de[0],de[1],de[2])}}for(let G=0;G<4;G++)for(let q=0;q<4;q++){const J=U(G,q),re=U(G,q+1),de=U(G+1,q),xe=U(G+1,q+1);P.emplaceBack(J,re,de),P.emplaceBack(de,re,xe)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(P),this._tileDebugTextBuffer=t.createVertexBuffer(I,id.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(N,pm.members),this._tileDebugTextSegments=Rr.simpleSegment(0,0,z,32)}}class yw{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,u){const m=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},st(this.stateChanges[t][m],u),null===this.deletedStates[t]){this.deletedStates[t]={};for(const y in this.state[t])y!==m&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][m]){this.deletedStates[t][m]={};for(const y in this.state[t][m])u[y]||(this.deletedStates[t][m][y]=null)}else for(const y in u)this.deletedStates[t]&&this.deletedStates[t][m]&&null===this.deletedStates[t][m][y]&&delete this.deletedStates[t][m][y]}removeFeatureState(t,a,u){if(null===this.deletedStates[t])return;const m=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&void 0!==a)null!==this.deletedStates[t][m]&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][u]=null);else if(void 0!==a)if(this.stateChanges[t]&&this.stateChanges[t][m])for(u in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][u]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,a){const u=String(a),m=st({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const y=this.deletedStates[t][a];if(null===y)return{};for(const w in y)delete m[w]}return m}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const u={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const w in this.stateChanges[m])this.state[m][w]||(this.state[m][w]={}),st(this.state[m][w],this.stateChanges[m][w]),y[w]=this.state[m][w];u[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(null===this.deletedStates[m])for(const w in this.state[m])y[w]={},this.state[m][w]={};else for(const w in this.deletedStates[m]){if(null===this.deletedStates[m][w])this.state[m][w]={};else if(this.state[m][w])for(const T of Object.keys(this.deletedStates[m][w]))delete this.state[m][w][T];y[w]=this.state[m][w]}u[m]=u[m]||{},st(u[m],y)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const m in t)t[m].setFeatureState(u,a)}}class Eb{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,a){const u=this.toIdx(t,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(t,a){return this.leaves[this.toIdx(t,a)]}toIdx(t,a){return a*this.size+t}}function Fs(o,t,a,u){let m=0,y=Number.MAX_VALUE;for(let w=0;w<3;w++)if(Math.abs(u[w])<1e-15){if(a[w]<o[w]||a[w]>t[w])return null}else{const T=1/u[w];let I=(o[w]-a[w])*T,P=(t[w]-a[w])*T;if(I>P){const N=I;I=P,P=N}if(I>m&&(m=I),P<y&&(y=P),m>y)return null}return m}function Dd(o,t,a,u,m,y,w,T,I,P,N){const z=u-o,U=m-t,G=y-a,q=w-o,J=T-t,re=I-a,de=N[1]*re-N[2]*J,xe=N[2]*q-N[0]*re,he=N[0]*J-N[1]*q,ve=z*de+U*xe+G*he;if(Math.abs(ve)<1e-15)return null;const Ce=1/ve,Ee=P[0]-o,et=P[1]-t,Ke=P[2]-a,pt=(Ee*de+et*xe+Ke*he)*Ce;if(pt<0||pt>1)return null;const kt=et*G-Ke*U,ot=Ke*z-Ee*G,Tt=Ee*U-et*z,xt=(N[0]*kt+N[1]*ot+N[2]*Tt)*Ce;return xt<0||pt+xt>1?null:(q*kt+J*ot+re*Tt)*Ce}function Sd(o,t,a){return(o-t)/(a-t)}function Id(o,t,a,u,m,y,w,T,I){const P=1<<a,N=y-u,z=w-m,U=(o+1)/P*N+u,G=(t+0)/P*z+m,q=(t+1)/P*z+m;T[0]=(o+0)/P*N+u,T[1]=G,I[0]=U,I[1]=q}class og{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(y){const w=Math.ceil(Math.log2(y.dim/8)),T=[];let I=Math.ceil(Math.pow(2,w));const P=1/I,N=(G,q,J,re,de)=>{const xe=re?1:0,he=(G+1)*J-xe,ve=q*J,Ce=(q+1)*J-xe;de[0]=G*J,de[1]=ve,de[2]=he,de[3]=Ce};let z=new Eb(I);const U=[];for(let G=0;G<I*I;G++){N(G%I,Math.floor(G/I),P,!1,U);const q=pl(U[0],U[1],y),J=pl(U[2],U[1],y),re=pl(U[2],U[3],y),de=pl(U[0],U[3],y);z.minimums.push(Math.min(q,J,re,de)),z.maximums.push(Math.max(q,J,re,de)),z.leaves.push(1)}for(T.push(z),I/=2;I>=1;I/=2){const G=T[T.length-1];z=new Eb(I);for(let q=0;q<I*I;q++){N(q%I,Math.floor(q/I),2,!0,U);const J=G.getElevation(U[0],U[1]),re=G.getElevation(U[2],U[1]),de=G.getElevation(U[2],U[3]),xe=G.getElevation(U[0],U[3]),he=G.isLeaf(U[0],U[1]),ve=G.isLeaf(U[2],U[1]),Ce=G.isLeaf(U[2],U[3]),Ee=G.isLeaf(U[0],U[3]),et=Math.min(J.min,re.min,de.min,xe.min),Ke=Math.max(J.max,re.max,de.max,xe.max),pt=he&&ve&&Ce&&Ee;z.maximums.push(Ke),z.minimums.push(et),z.leaves.push(Ke-et<=5&&pt?1:0)}T.push(z)}return T}(this.dem),u=a.length-1,m=a[u];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(t,a,u,m,y,w,T=1){return Fs([t,a,-100],[u,m,this.maximums[0]*T],y,w)}raycast(t,a,u,m,y,w,T=1){if(!this.nodeCount)return null;const I=this.raycastRoot(t,a,u,m,y,w,T);if(null==I)return null;const P=[],N=[],z=[],U=[],G=[{idx:0,t:I,nodex:0,nodey:0,depth:0}];for(;G.length>0;){const{idx:q,t:J,nodex:re,nodey:de,depth:xe}=G.pop();if(this.leaves[q]){Id(re,de,xe,t,a,u,m,z,U);const ve=1<<xe,Ce=(re+0)/ve,Ee=(re+1)/ve,et=(de+0)/ve,Ke=(de+1)/ve,pt=pl(Ce,et,this.dem)*T,kt=pl(Ee,et,this.dem)*T,ot=pl(Ee,Ke,this.dem)*T,Tt=pl(Ce,Ke,this.dem)*T,xt=Dd(z[0],z[1],pt,U[0],z[1],kt,U[0],U[1],ot,y,w),Pt=Dd(U[0],U[1],ot,z[0],U[1],Tt,z[0],z[1],pt,y,w),Rt=Math.min(null!==xt?xt:Number.MAX_VALUE,null!==Pt?Pt:Number.MAX_VALUE);if(Rt!==Number.MAX_VALUE)return Rt;{const lt=dc([],y,w,J);if(j_(pt,kt,Tt,ot,Sd(lt[0],z[0],U[0]),Sd(lt[1],z[1],U[1]))>=lt[2])return J}continue}let he=0;for(let ve=0;ve<this._siblingOffset.length;ve++){Id((re<<1)+this._siblingOffset[ve][0],(de<<1)+this._siblingOffset[ve][1],xe+1,t,a,u,m,z,U),z[2]=-100,U[2]=this.maximums[this.childOffsets[q]+ve]*T;const Ce=Fs(z,U,y,w);if(null!=Ce){const Ee=Ce;P[ve]=Ee;let et=!1;for(let Ke=0;Ke<he&&!et;Ke++)Ee>=P[N[Ke]]&&(N.splice(Ke,0,ve),et=!0);et||(N[he]=ve),he++}}for(let ve=0;ve<he;ve++){const Ce=N[ve];G.push({idx:this.childOffsets[q]+Ce,t:P[Ce],nodex:(re<<1)+this._siblingOffset[Ce][0],nodey:(de<<1)+this._siblingOffset[Ce][1],depth:xe+1})}}return null}_addNode(t,a,u){return this.minimums.push(t),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(t,a,u,m,y){if(1===t[m].isLeaf(a,u))return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const w=m-1,T=t[w];let I=0,P=0;for(let N=0;N<this._siblingOffset.length;N++){const z=2*a+this._siblingOffset[N][0],U=2*u+this._siblingOffset[N][1],G=T.getElevation(z,U),q=T.isLeaf(z,U),J=this._addNode(G.min,G.max,q);q&&(I|=1<<N),P||(P=J)}for(let N=0;N<this._siblingOffset.length;N++)I&1<<N||this._construct(t,2*a+this._siblingOffset[N][0],2*u+this._siblingOffset[N][1],w,P+N)}}function j_(o,t,a,u,m,y){return Ti(Ti(o,a,y),Ti(t,u,y),m)}function pl(o,t,a){const u=a.dim,m=Wn(o*u-.5,0,u-1),y=Wn(t*u-.5,0,u-1),w=Math.floor(m),T=Math.floor(y),I=Math.min(w+1,u-1),P=Math.min(T+1,u-1);return j_(a.get(w,T),a.get(I,T),a.get(w,P),a.get(I,P),m-w,y-T)}const mp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Yh(o,t,a){return(256*o*256+256*t+a)/10-1e4}function Cb(o,t,a){return 256*o+t+a/256-32768}class Xh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,a,u,m=!1,y=!1){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return Yn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const w=this.dim=a.height-2,T=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=u||"mapbox",this.borderReady=m,!m){for(let I=0;I<w;I++)T[this._idx(-1,I)]=T[this._idx(0,I)],T[this._idx(w,I)]=T[this._idx(w-1,I)],T[this._idx(I,-1)]=T[this._idx(I,0)],T[this._idx(I,w)]=T[this._idx(I,w-1)];T[this._idx(-1,-1)]=T[this._idx(0,0)],T[this._idx(w,-1)]=T[this._idx(w-1,0)],T[this._idx(-1,w)]=T[this._idx(0,w-1)],T[this._idx(w,w)]=T[this._idx(w-1,w-1)],y&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new og(this)}get(t,a,u=!1){u&&(t=Wn(t,-1,this.dim),a=Wn(a,-1,this.dim));const m=4*this._idx(t,a);return("terrarium"===this.encoding?Cb:Yh)(this.pixels[m],this.pixels[m+1],this.pixels[m+2])}static getUnpackVector(t){return mp[t]}get unpackVector(){return mp[this.encoding]}_idx(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)}static pack(t,a){const u=[0,0,0,0],m=Xh.getUnpackVector(a);let y=Math.floor((t+m[3])/m[2]);return u[2]=y%256,y=Math.floor(y/256),u[1]=y%256,y=Math.floor(y/256),u[0]=y,u}getPixels(){return new As({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,a,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let m=a*this.dim,y=a*this.dim+this.dim,w=u*this.dim,T=u*this.dim+this.dim;switch(a){case-1:m=y-1;break;case 1:y=m+1}switch(u){case-1:w=T-1;break;case 1:T=w+1}const I=-a*this.dim,P=-u*this.dim;for(let N=w;N<T;N++)for(let z=m;z<y;z++){const U=4*this._idx(z,N),G=4*this._idx(z+I,N+P);this.pixels[U+0]=t.pixels[G+0],this.pixels[U+1]=t.pixels[G+1],this.pixels[U+2]=t.pixels[G+2],this.pixels[U+3]=t.pixels[G+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}hn(Xh,"DEMData"),hn(og,"DemMinMaxQuadTree",{omit:["dem"]});class $_{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,u){const m=t.wrapped().key;void 0===this.data[m]&&(this.data[m]=[]);const y={value:a,timeout:void 0};if(void 0!==u&&(y.timeout=setTimeout(()=>{this.remove(t,y)},u)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const u=t.wrapped().key,m=void 0===a?0:this.data[u].indexOf(a),y=this.data[u][m];return this.data[u].splice(m,1),y.timeout&&clearTimeout(y.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const u in this.data)for(const m of this.data[u])t(m.value)||a.push(m);for(const u of a)this.remove(u.value.tileID,u)}}class ya{constructor(t,a,u){this.func=t,this.mask=a,this.range=u}}ya.ReadOnly=!1,ya.ReadWrite=!0,ya.disabled=new ya(519,ya.ReadOnly,[0,1]);class sg{constructor(t,a,u,m,y,w){this.test=t,this.ref=a,this.mask=u,this.fail=m,this.depthFail=y,this.pass=w}}sg.disabled=new sg({func:519,mask:0},0,0,7680,7680,7680);class Fo{constructor(t,a,u){this.blendFunction=t,this.blendColor=a,this.mask=u}}Fo.Replace=[1,0],Fo.disabled=new Fo(Fo.Replace,wn.transparent,[!1,!1,!1,!1]),Fo.unblended=new Fo(Fo.Replace,wn.transparent,[!0,!0,!0,!0]),Fo.alphaBlended=new Fo([1,771],wn.transparent,[!0,!0,!0,!0]);class es{constructor(t,a,u){this.enable=t,this.mode=a,this.frontFace=u}}es.disabled=new es(!1,1029,2305),es.backCCW=new es(!0,1029,2305),es.backCW=new es(!0,1029,2304),es.frontCW=new es(!0,1028,2304),es.frontCCW=new es(!0,1028,2305);class $l extends Za{constructor(t,a,u){super(),this.id=t,this._onlySymbols=u,a.on("data",m=>{"source"===m.dataType&&"metadata"===m.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===m.dataType&&"content"===m.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new $_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new yw,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const a=this._tiles[t];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,a){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const u=this._tiles[a];u.upload(t),u.prepare(this.map.style.imageManager)}}getIds(){return ra(this._tiles).map(t=>t.tileID).sort(Ad).map(t=>t.key)}getRenderableIds(t){const a=[];for(const u in this._tiles)this._isIdRenderable(+u,t)&&a.push(this._tiles[u]);return t?a.sort((u,m)=>{const y=u.tileID,w=m.tileID,T=new Ne(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),I=new Ne(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-w.overscaledZ||I.y-T.y||I.x-T.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(Ad).map(u=>u.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,a){const u=this._tiles[t];u&&("loading"!==u.state&&(u.state=a),this._loadTile(u,this._tileLoaded.bind(this,u,t,a)))}_tileLoaded(t,a,u,m){if(m)if(t.state="errored",404!==m.status)this._source.fire(new os(m,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=To.now(),"expired"===u&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Uo("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const a=this.getRenderableIds();for(let m=0;m<a.length;m++){const y=a[m];if(t.neighboringTiles&&t.neighboringTiles[y]){const w=this.getTileByID(y);u(t,w),u(w,t)}}function u(m,y){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let w=y.tileID.canonical.x-m.tileID.canonical.x;const T=y.tileID.canonical.y-m.tileID.canonical.y,I=Math.pow(2,m.tileID.canonical.z),P=y.tileID.key;0===w&&0===T||Math.abs(T)>1||(Math.abs(w)>1&&(1===Math.abs(w+I)?w+=I:1===Math.abs(w-I)&&(w-=I)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,w,T),m.neighboringTiles&&m.neighboringTiles[P]&&(m.neighboringTiles[P].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,u,m){for(const y in this._tiles){let w=this._tiles[y];if(m[y]||!w.hasData()||w.tileID.overscaledZ<=a||w.tileID.overscaledZ>u)continue;let T=w.tileID;for(;w&&w.tileID.overscaledZ>a+1;){const P=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[P.key],w&&w.hasData()&&(T=P)}let I=T;for(;I.overscaledZ>a;)if(I=I.scaledTo(I.overscaledZ-1),t[I.key]){m[T.key]=T;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=t.overscaledZ-1;u>=a;u--){const m=t.scaledTo(u),y=this._getLoadedTile(m);if(y)return y}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,a){a=a||this._source.tileSize;const u=Math.ceil(t.width/a)+1,m=Math.ceil(t.height/a)+1,y=Math.floor(u*m*5),w="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,y):y,T="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(T)}handleWrapJump(t){const a=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,a){const u={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+a),u[y.tileID.key]=y}this._tiles=u;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,a,u){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let m;this.updateCacheSize(t,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new Ps(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(m=t.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(m=m.filter(T=>this._source.hasTile(T)))):m=[];const y=this._updateRetainedTiles(m);if(gp(this._source.type)&&0!==m.length){const T={},I={},P=Object.keys(y);for(const z of P){const U=y[z],G=this._tiles[z];if(!G||G.fadeEndTime&&G.fadeEndTime<=To.now())continue;const q=this.findLoadedParent(U,Math.max(U.overscaledZ-$l.maxOverzooming,this._source.minzoom));q&&(this._addTile(q.tileID),T[q.tileID.key]=q.tileID),I[z]=U}const N=m[m.length-1].overscaledZ;for(const z in this._tiles){const U=this._tiles[z];if(y[z]||!U.hasData())continue;let G=U.tileID;for(;G.overscaledZ>N;){G=G.scaledTo(G.overscaledZ-1);const q=this._tiles[G.key];if(q&&q.hasData()&&I[G.key]){y[z]=U.tileID;break}}}for(const z in T)y[z]||(this._coveredTiles[z]=!0,y[z]=T[z])}for(const T in y)this._tiles[T].clearFadeHold();const w=function(T,I){const P=[];for(const N in T)N in I||P.push(N);return P}(this._tiles,y);for(const T of w){const I=this._tiles[T];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(+T)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const a={};if(0===t.length)return a;const u={},m=t.reduce((P,N)=>Math.min(P,N.overscaledZ),1/0),y=t[0].overscaledZ,w=Math.max(y-$l.maxOverzooming,this._source.minzoom),T=Math.max(y+$l.maxUnderzooming,this._source.minzoom),I={};for(const P of t){const N=this._addTile(P);a[P.key]=P,N.hasData()||m<this._source.maxzoom&&(I[P.key]=P)}this._retainLoadedChildren(I,m,T,a);for(const P of t){let N=this._tiles[P.key];if(N.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const U=P.children(this._source.maxzoom)[0],G=this.getTile(U);if(G&&G.hasData()){a[U.key]=U;continue}}else{const U=P.children(this._source.maxzoom);if(a[U[0].key]&&a[U[1].key]&&a[U[2].key]&&a[U[3].key])continue}let z=N.wasRequested();for(let U=P.overscaledZ-1;U>=w;--U){const G=P.scaledTo(U);if(u[G.key]||(u[G.key]=!0,N=this.getTile(G),!N&&z&&(N=this._addTile(G)),N&&(a[G.key]=G,z=N.wasRequested(),N.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let u,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){u=this._loadedParentTiles[m.key];break}a.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(u=this._getLoadedTile(y),u)break;m=y}for(const y of a)this._loadedParentTiles[y]=u}}_addTile(t){let a=this._tiles[t.key];if(a)return a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const u=!!a;if(!u){const m=this.map?this.map.painter:null;a=new zv(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,m,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))}return a?(a.uses++,this._tiles[t.key]=a,u||this._source.fire(new Uo("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=a.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,a,u){const m=[],y=this.transform;if(!y)return m;const w="globe"===y.projection.name,T=Rl(y.center.lng);for(const I in this._tiles){const P=this._tiles[I];if(u&&P.clearQueryDebugViz(),P.holdingForFade())continue;let N;if(w){const z=P.tileID.canonical;if(0===z.z){const U=[Math.abs(Wn(T,...ml(z,-1))-T),Math.abs(Wn(T,...ml(z,1))-T)];N=[0,2*U.indexOf(Math.min(...U))-1]}else{const U=[Math.abs(Wn(T,...ml(z,-1))-T),Math.abs(Wn(T,...ml(z,0))-T),Math.abs(Wn(T,...ml(z,1))-T)];N=[U.indexOf(Math.min(...U))-1]}}else N=[0];for(const z of N){const U=t.containsTile(P,y,a,z);U&&m.push(U)}}return m}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map(u=>this._tiles[u].tileID);for(const u of a)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(gp(this._source.type))for(const t in this._tiles){const a=this._tiles[t];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=To.now())return!0}return!1}setFeatureState(t,a,u){this._state.updateState(t=t||"_geojsonTileLayer",a,u)}removeFeatureState(t,a,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,u)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,u){const m=this._tiles[t];m&&m.setDependencies(a,u)}reloadTilesForDependencies(t,a){for(const u in this._tiles)this._tiles[u].hasDependency(t,a)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,a))}_preloadTiles(t,a){if(!this._sourceLoaded){const T=()=>{this._sourceLoaded&&(this._source.off("data",T),this._preloadTiles(t,a))};return void this._source.on("data",T)}const u=new Map,m=Array.isArray(t)?t:[t],y=this.map.painter.terrain,w=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const T of m){const I=T.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const P of I)u.set(P.key,P);this.usedForTerrain&&T.updateElevation(!1)}yr(Array.from(u.values()),(T,I)=>{const P=new zv(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(P,N=>{"raster-dem"===this._source.type&&P.dem&&this._backfillDEM(P),I(N,P)})},a)}}function Ad(o,t){const a=Math.abs(2*o.wrap)-+(o.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return o.overscaledZ-t.overscaledZ||u-a||t.canonical.y-o.canonical.y||t.canonical.x-o.canonical.x}function gp(o){return"raster"===o||"image"===o||"video"===o||"custom"===o}function ml(o,t){const a=1<<o.z;return[o.x/a+t,(o.x+1)/a+t]}$l.maxOverzooming=10,$l.maxUnderzooming=3;class vu{constructor(t,a,u){this._demTile=t,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(t,a,u){const m=u||t.findDEMTileFor(a);if(!m||!m.dem)return;const y=m.dem,w=m.tileID,T=1<<a.canonical.z-w.canonical.z;return new vu(m,m.tileSize/_n/T,[(a.canonical.x/T-w.canonical.x)*y.dim,(a.canonical.y/T-w.canonical.y)*y.dim])}tileCoordToPixel(t,a){const u=a*this._scale+this._offset[1],m=Math.floor(t*this._scale+this._offset[0]),y=Math.floor(u);return new Ne(m,y)}getElevationAt(t,a,u,m){const y=t*this._scale+this._offset[0],w=a*this._scale+this._offset[1],T=Math.floor(y),I=Math.floor(w),P=this._dem;return m=!!m,u?Ti(Ti(P.get(T,I,m),P.get(T,I+1,m),w-I),Ti(P.get(T+1,I,m),P.get(T+1,I+1,m),w-I),y-T):P.get(T,I,m)}getElevationAtPixel(t,a,u){return this._dem.get(t,a,!!u)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Qo(1,t)*this._dem.stride}}class _p{constructor(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new oc(_n,16,0),this.featureIndexArray=new ed,this.promoteId=a}insert(t,a,u,m,y,w=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,y,w);const I=this.grid;for(let P=0;P<a.length;P++){const N=a[P],z=[1/0,1/0,-1/0,-1/0];for(let U=0;U<N.length;U++){const G=N[U];z[0]=Math.min(z[0],G.x),z[1]=Math.min(z[1],G.y),z[2]=Math.max(z[2],G.x),z[3]=Math.max(z[3],G.y)}z[0]<_n&&z[1]<_n&&z[2]>=0&&z[3]>=0&&I.insert(T,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Yf(new wd(this.rawTileData)).layers,this.sourceLayerCoder=new wb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,a,u,m){this.loadVTLayers();const y=t.params||{},w=Da(y.filter),T=t.tileResult,I=t.transform,P=T.bufferedTilespaceBounds,N=this.grid.query(P.min.x,P.min.y,P.max.x,P.max.y,(q,J,re,de)=>r_(T.bufferedTilespaceGeometry,q,J,re,de));N.sort(vw);let z=null;I.elevation&&N.length>0&&(z=vu.create(I.elevation,this.tileID));const U={};let G;for(let q=0;q<N.length;q++){const J=N[q];if(J===G)continue;G=J;const re=this.featureIndexArray.get(J);let de=null;this.loadMatchingFeature(U,re,w,y.layers,y.availableImages,a,u,m,(xe,he,ve,Ce=0)=>(de||(de=kl(xe,this.tileID.canonical,t.tileTransform)),he.queryIntersectsFeature(T,xe,ve,de,this.z,t.transform,t.pixelPosMatrix,z,Ce)))}return U}loadMatchingFeature(t,a,u,m,y,w,T,I,P){const{featureIndex:N,bucketIndex:z,sourceLayerIndex:U,layoutVertexArrayOffset:G}=a,q=this.bucketLayerIDs[z];if(m&&!function(xe,he){for(let ve=0;ve<xe.length;ve++)if(he.indexOf(xe[ve])>=0)return!0;return!1}(m,q))return;const J=this.sourceLayerCoder.decode(U),re=this.vtLayers[J].feature(N);if(u.needGeometry){const xe=ud(re,!0);if(!u.filter(new B(this.tileID.overscaledZ),xe,this.tileID.canonical))return}else if(!u.filter(new B(this.tileID.overscaledZ),re))return;const de=this.getId(re,J);for(let xe=0;xe<q.length;xe++){const he=q[xe];if(m&&m.indexOf(he)<0)continue;const ve=w[he];if(!ve)continue;let Ce={};void 0!==de&&I&&(Ce=I.getState(ve.sourceLayer||"_geojsonTileLayer",de));const Ee=st({},T[he]);Ee.paint=bu(Ee.paint,ve.paint,re,Ce,y),Ee.layout=bu(Ee.layout,ve.layout,re,Ce,y);const et=!P||P(re,ve,Ce,G);if(!et)continue;const Ke=new B_(re,this.z,this.x,this.y,de);Ke.layer=Ee;let pt=t[he];void 0===pt&&(pt=t[he]=[]),pt.push({featureIndex:N,feature:Ke,intersectionZ:et})}}lookupSymbolFeatures(t,a,u,m,y,w,T,I){const P={};this.loadVTLayers();const N=Da(y);for(const z of t)this.loadMatchingFeature(P,{bucketIndex:u,sourceLayerIndex:m,featureIndex:z,layoutVertexArrayOffset:0},N,w,T,I,a);return P}loadFeature(t){const{featureIndex:a,sourceLayerIndex:u}=t;this.loadVTLayers();const m=this.sourceLayerCoder.decode(u),y=this.vtFeatures[m];if(y[a])return y[a];const w=this.vtLayers[m].feature(a);return y[a]=w,w}hasLayer(t){for(const a of this.bucketLayerIDs)for(const u of a)if(t===u)return!0;return!1}getId(t,a){let u=t.id;if(this.promoteId){const m="string"==typeof this.promoteId?this.promoteId:this.promoteId[a];null!=m&&(u=t.properties[m]),"boolean"==typeof u&&(u=Number(u))}return u}}function bu(o,t,a,u,m){return dn(o,(y,w)=>{const T=t instanceof ce?t.get(w):null;return T&&T.evaluate?T.evaluate(a,u,m):T})}function vw(o,t){return t-o}hn(_p,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Uv{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.image=new ma({width:t,height:a}),this.positions={},this.uploaded=!1}getDash(t,a){const u=this.getKey(t,a);return this.positions[u]}trim(){const t=this.width,a=this.height=Zt(this.nextRow);this.image.resize({width:t,height:a})}getKey(t,a){return t.join(",")+a}getDashRanges(t,a,u){const m=[];let y=t.length%2==1?-t[t.length-1]*u:0,w=t[0]*u,T=!0;m.push({left:y,right:w,isDash:T,zeroLength:0===t[0]});let I=t[0];for(let P=1;P<t.length;P++){T=!T;const N=t[P];y=I*u,I+=N,w=I*u,m.push({left:y,right:w,isDash:T,zeroLength:0===N})}return m}addRoundDash(t,a,u){const m=a/2;for(let y=-u;y<=u;y++){const w=this.width*(this.nextRow+u+y);let T=0,I=t[T];for(let P=0;P<this.width;P++){P/I.right>1&&(I=t[++T]);const N=Math.abs(P-I.left),z=Math.abs(P-I.right),U=Math.min(N,z);let G;const q=y/u*(m+1);if(I.isDash){const J=m-Math.abs(q);G=Math.sqrt(U*U+J*J)}else G=m-Math.sqrt(U*U+q*q);this.image.data[w+P]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(t,a){for(let I=t.length-1;I>=0;--I){const P=t[I],N=t[I+1];P.zeroLength?t.splice(I,1):N&&N.isDash===P.isDash&&(N.left=P.left,t.splice(I,1))}const u=t[0],m=t[t.length-1];u.isDash===m.isDash&&(u.left=m.left-this.width,m.right=u.right+this.width);const y=this.width*this.nextRow;let w=0,T=t[w];for(let I=0;I<this.width;I++){I/T.right>1&&(T=t[++w]);const P=Math.abs(I-T.left),N=Math.abs(I-T.right),z=Math.min(P,N);this.image.data[y+I]=Math.max(0,Math.min(255,(T.isDash?z:-z)+a+128))}}addDash(t,a){const u=this.getKey(t,a);if(this.positions[u])return this.positions[u];const m="round"===a,y=m?7:0,w=2*y+1;if(this.nextRow+w>this.height)return Yn("LineAtlas out of space"),null;0===t.length&&t.push(1);let T=0;for(let N=0;N<t.length;N++)t[N]<0&&(Yn("Negative value is found in line dasharray, replacing values with 0"),t[N]=0),T+=t[N];if(0!==T){const N=this.width/T,z=this.getDashRanges(t,this.width,N);m?this.addRoundDash(z,N,y):this.addRegularDash(z,"square"===a?.5*N:0)}const I=this.nextRow+y;this.nextRow+=w;const P={tl:[I,y],br:[T,0]};return this.positions[u]=P,P}}hn(Uv,"LineAtlas");const ag=1*ko;class G_{constructor(t){const a={},u=[];for(const T in t){const I=t[T],P=a[T]={};for(const N in I.glyphs){const z=I.glyphs[+N];if(!z||0===z.bitmap.width||0===z.bitmap.height)continue;const U=z.metrics.localGlyph?ag:1,G={x:0,y:0,w:z.bitmap.width+2*U,h:z.bitmap.height+2*U};u.push(G),P[N]=G}}const{w:m,h:y}=Cv(u),w=new ma({width:m||1,height:y||1});for(const T in t){const I=t[T];for(const P in I.glyphs){const N=I.glyphs[+P];if(!N||0===N.bitmap.width||0===N.bitmap.height)continue;const z=a[T][P],U=N.metrics.localGlyph?ag:1;ma.copy(N.bitmap,w,{x:0,y:0},{x:z.x+U,y:z.y+U},N.bitmap)}}this.image=w,this.positions=a}}hn(G_,"GlyphAtlas");class jv{constructor(t){this.tileID=new Ps(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=pu(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,a,u,m,y){this.status="parsing",this.data=t,this.collisionBoxArray=new _i;const w=new wb(Object.keys(t.layers).sort()),T=new _p(this.tileID,this.promoteId);T.bucketLayerIDs=[];const I={},P=new Uv(256,256),N={featureIndex:T,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:P,availableImages:u},z=a.familiesBySource[this.source];for(const Ce in z){const Ee=t.layers[Ce];if(!Ee)continue;let et=!1,Ke=!1;for(const ot of z[Ce])"symbol"===ot[0].type?et=!0:Ke=!0;if(!0===this.isSymbolTile&&!et||!1===this.isSymbolTile&&!Ke)continue;1===Ee.version&&Yn(`Vector tile source "${this.source}" layer "${Ce}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const pt=w.encode(Ce),kt=[];for(let ot=0;ot<Ee.length;ot++){const Tt=Ee.feature(ot),xt=T.getId(Tt,Ce);kt.push({feature:Tt,id:xt,index:ot,sourceLayerIndex:pt})}for(const ot of z[Ce]){const Tt=ot[0];void 0!==this.isSymbolTile&&"symbol"===Tt.type!==this.isSymbolTile||Tt.minzoom&&this.zoom<Math.floor(Tt.minzoom)||Tt.maxzoom&&this.zoom>=Tt.maxzoom||"none"!==Tt.visibility&&(Z_(ot,this.zoom,u),(I[Tt.id]=Tt.createBucket({index:T.bucketLayerIDs.length,layers:ot,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(kt,N,this.tileID.canonical,this.tileTransform),T.bucketLayerIDs.push(ot.map(xt=>xt.id)))}}let U,G,q,J;P.trim();const re={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},de=()=>{if(U)return y(U);if(G&&q&&J){const Ce=new G_(G),Ee=new M_(q,J);for(const et in I){const Ke=I[et];Ke instanceof Ul?(Z_(Ke.layers,this.zoom,u),kv(Ke,G,Ce.positions,q,Ee.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):Ke.hasPattern&&(Ke instanceof x_||Ke instanceof Dh||Ke instanceof Am)&&(Z_(Ke.layers,this.zoom,u),Ke.addFeatures(N,this.tileID.canonical,Ee.patternPositions,u,this.tileTransform))}this.status="done",y(null,{buckets:ra(I).filter(et=>!et.isEmpty()),featureIndex:T,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ce.image,lineAtlas:P,imageAtlas:Ee,glyphMap:this.returnDependencies?G:null,iconMap:this.returnDependencies?q:null,glyphPositions:this.returnDependencies?Ce.positions:null})}},xe=dn(N.glyphDependencies,Ce=>Object.keys(Ce).map(Number));Object.keys(xe).length?m.send("getGlyphs",{uid:this.uid,stacks:xe},(Ce,Ee)=>{U||(U=Ce,G=Ee,de())},void 0,!1,re):G={};const he=Object.keys(N.iconDependencies);he.length?m.send("getImages",{icons:he,source:this.source,tileID:this.tileID,type:"icons"},(Ce,Ee)=>{U||(U=Ce,q=Ee,de())},void 0,!1,re):q={};const ve=Object.keys(N.patternDependencies);ve.length?m.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"patterns"},(Ce,Ee)=>{U||(U=Ce,J=Ee,de())},void 0,!1,re):J={},de()}}function Z_(o,t,a){const u=new B(t);for(const m of o)m.recalculate(u,a)}class $v{constructor(t){this.entries={},this.scheduler=t}request(t,a,u,m){const y=this.entries[t]=this.entries[t]||{callbacks:[]};if(y.result){const[w,T]=y.result;return this.scheduler?this.scheduler.add(()=>{m(w,T)},a):m(w,T),()=>{}}return y.callbacks.push(m),y.cancel||(y.cancel=u((w,T)=>{y.result=[w,T];for(const I of y.callbacks)this.scheduler?this.scheduler.add(()=>{I(w,T)},a):I(w,T);setTimeout(()=>delete this.entries[t],3e3)})),()=>{y.result||(y.callbacks=y.callbacks.filter(w=>w!==m),y.callbacks.length||(y.cancel(),delete this.entries[t]))}}}function W_(o,t,a){const u=JSON.stringify(o.request);return o.data&&(this.deduped.entries[u]={result:[null,o.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},m=>{const y=Ei(o.request,(w,T,I,P)=>{w?m(w):T&&m(null,{vectorTile:a?void 0:new Yf(new wd(T)),rawData:T,cacheControl:I,expires:P})});return()=>{y.cancel(),m()}},t)}const xu=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Hv{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,u]=new Uint8Array(t,0,2);if(219!==a)throw new Error("Data does not appear to be in a KDBush format.");const m=u>>4;if(1!==m)throw new Error(`Got v${m} data when expected v1.`);const y=xu[15&u];if(!y)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(t,2,1),[T]=new Uint32Array(t,4,1);return new Hv(T,w,y,t)}constructor(t,a=64,u=Float64Array,m){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const y=xu.indexOf(this.ArrayType),w=2*t*this.ArrayType.BYTES_PER_ELEMENT,T=t*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-T%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${u}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+T+I,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+w+T+I),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+T+I,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=t)}add(t,a){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=a,u}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return q_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,a,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:w,nodeSize:T}=this,I=[0,y.length-1,0],P=[];for(;I.length;){const N=I.pop()||0,z=I.pop()||0,U=I.pop()||0;if(z-U<=T){for(let re=U;re<=z;re++){const de=w[2*re],xe=w[2*re+1];de>=t&&de<=u&&xe>=a&&xe<=m&&P.push(y[re])}continue}const G=U+z>>1,q=w[2*G],J=w[2*G+1];q>=t&&q<=u&&J>=a&&J<=m&&P.push(y[G]),(0===N?t<=q:a<=J)&&(I.push(U),I.push(G-1),I.push(1-N)),(0===N?u>=q:m>=J)&&(I.push(G+1),I.push(z),I.push(1-N))}return P}within(t,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:w}=this,T=[0,m.length-1,0],I=[],P=u*u;for(;T.length;){const N=T.pop()||0,z=T.pop()||0,U=T.pop()||0;if(z-U<=w){for(let re=U;re<=z;re++)wu(y[2*re],y[2*re+1],t,a)<=P&&I.push(m[re]);continue}const G=U+z>>1,q=y[2*G],J=y[2*G+1];wu(q,J,t,a)<=P&&I.push(m[G]),(0===N?t-u<=q:a-u<=J)&&(T.push(U),T.push(G-1),T.push(1-N)),(0===N?t+u>=q:a+u>=J)&&(T.push(G+1),T.push(z),T.push(1-N))}return I}}function q_(o,t,a,u,m,y){if(m-u<=a)return;const w=u+m>>1;yp(o,t,w,u,m,y),q_(o,t,a,u,w-1,1-y),q_(o,t,a,w+1,m,1-y)}function yp(o,t,a,u,m,y){for(;m>u;){if(m-u>600){const P=m-u+1,N=a-u+1,z=Math.log(P),U=.5*Math.exp(2*z/3),G=.5*Math.sqrt(z*U*(P-U)/P)*(N-P/2<0?-1:1);yp(o,t,a,Math.max(u,Math.floor(a-N*U/P+G)),Math.min(m,Math.floor(a+(P-N)*U/P+G)),y)}const w=t[2*a+y];let T=u,I=m;for(vp(o,t,u,a),t[2*m+y]>w&&vp(o,t,u,m);T<I;){for(vp(o,t,T,I),T++,I--;t[2*T+y]<w;)T++;for(;t[2*I+y]>w;)I--}t[2*u+y]===w?vp(o,t,u,I):(I++,vp(o,t,I,m)),I<=a&&(u=I+1),a<=I&&(m=I-1)}}function vp(o,t,a,u){lg(o,a,u),lg(t,2*a,2*u),lg(t,2*a+1,2*u+1)}function lg(o,t,a){const u=o[t];o[t]=o[a],o[a]=u}function wu(o,t,a,u){const m=o-a,y=t-u;return m*m+y*y}p.ARRAY_TYPE=Ts,p.AUTH_ERR_MSG=Te,p.Aabb=Jo,p.Actor=class{constructor(o,t,a){this.target=o,this.parent=t,this.mapId=a,this.callbacks={},this.cancelCallbacks={},yt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Pi()?o:ue,this.scheduler=new rg}send(o,t,a,u,m=!1,y){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=y,this.callbacks[w]=a);const T=Bs(this.globalScope)?void 0:[];return this.target.postMessage({id:w,type:o,hasCallback:!!a,targetMapId:u,mustQueue:m,sourceMapId:this.mapId,data:sc(t,T)},T),{cancel:()=>{a&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(o){const t=o.data,a=t.id;if(a&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(t.mustQueue||Pi()){const u=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,t),u&&u.metadata||{type:"message"})}else this.processTask(a,t)}processTask(o,t){if("<response>"===t.type){const a=this.callbacks[o];delete this.callbacks[o],a&&(t.error?a(Wr(t.error)):a(null,Wr(t.data)))}else{const a=Bs(this.globalScope)?void 0:[],u=t.hasCallback?(y,w)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:y?sc(y):null,data:sc(w,a)},a)}:y=>{},m=Wr(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,m,u);else if(this.parent.getWorkerSource){const y=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,y[0],m.source)[y[1]](m,u)}else u(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=Ih,p.Color=wn,p.ColorMode=Fo,p.CullFaceMode=es,p.DEMData=Xh,p.DataConstantProperty=K,p.DedupedRequest=$v,p.DepthMode=ya,p.EXTENT=_n,p.Elevation=class{isDataAvailableAtPoint(o){const t=this._source();if(this.isUsingMockSource()||!t||o.y<0||o.y>1)return!1;const a=t.getSource().maxzoom,u=1<<a,m=Math.floor(o.x),y=Math.floor((o.x-m)*u),w=Math.floor(o.y*u),T=this.findDEMTileFor(new Ps(a,m,a,y,w));return!(!T||!T.dem)}getAtPointOrZero(o,t=0){return this.getAtPoint(o,t)||0}getAtPoint(o,t,a=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const u=this._source();if(!u||o.y<0||o.y>1)return t;const m=u.getSource().maxzoom,y=1<<m,w=Math.floor(o.x),T=o.x-w,I=new Ps(m,w,m,Math.floor(T*y),Math.floor(o.y*y)),P=this.findDEMTileFor(I);if(!P||!P.dem)return t;const N=P.dem,z=1<<P.tileID.canonical.z,U=(T*z-P.tileID.canonical.x)*N.dim,G=(o.y*z-P.tileID.canonical.y)*N.dim,q=Math.floor(U),J=Math.floor(G);return(a?this.exaggeration():1)*Ti(Ti(N.get(q,J),N.get(q,J+1),G-J),Ti(N.get(q+1,J),N.get(q+1,J+1),G-J),U-q)}getAtTileOffset(o,t,a){const u=1<<o.canonical.z;return this.getAtPointOrZero(new ld(o.wrap+(o.canonical.x+t/_n)/u,(o.canonical.y+a/_n)/u))}getAtTileOffsetFunc(o,t,a,u){return m=>{const y=this.getAtTileOffset(o,m.x,m.y),w=u.upVector(o.canonical,m.x,m.y);return ds(w,w,y*u.upVectorScale(o.canonical,t,a).metersToTile),w}}getForTilePoints(o,t,a,u){if(this.isUsingMockSource())return!1;const m=vu.create(this,o,u);return!!m&&(t.forEach(y=>{y[2]=this.exaggeration()*m.getElevationAt(y[0],y[1],a)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(o);if(!t||!t.dem)return null;const a=t.dem.tree,u=t.tileID,m=1<<o.canonical.z-u.canonical.z;let y=o.canonical.x/m-u.canonical.x,w=o.canonical.y/m-u.canonical.y,T=0;for(let I=0;I<o.canonical.z-u.canonical.z&&!a.leaves[T];I++){y*=2,w*=2;const P=2*Math.floor(w)+Math.floor(y);T=a.childOffsets[T]+P,y%=1,w%=1}return{min:this.exaggeration()*a.minimums[T],max:this.exaggeration()*a.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,t,a){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=os,p.EvaluationParameters=B,p.Event=Uo,p.Evented=Za,p.FillExtrusionBucket=Am,p.Frustum=mm,p.FrustumCorners=Pl,p.GLOBE_RADIUS=ll,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=hc,p.GLOBE_ZOOM_THRESHOLD_MIN=Kg,p.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,t){const a=new At,u=new ln,m=[],y=o+1+2,w=t[0]+1,T=t[0]+1+(1+t.length),I=(P,N,z)=>{let U=P===y-1?P-2:0===P?P:P-1;return U+=z?24575:0,[U,N]};for(let P=0;P<y;++P)a.emplaceBack(...I(P,0,!0));for(let P=0;P<w;++P)for(let N=0;N<y;++N)a.emplaceBack(...I(N,P,(0===N||N===y-1)&&!0));for(let P=0;P<t.length;++P){const N=t[P];for(let z=0;z<y;++z)a.emplaceBack(...I(z,N,!0))}for(let P=0;P<t.length;++P){const N=u.length,z=t[P]+1+2,U=new ln;for(let J=0;J<z-1;J++){const re=J===z-2,de=re?y*(T-t.length+P-J):y;for(let xe=0;xe<y-1;xe++){const he=J*y+xe;0===J||re||0===xe||xe===y-2?(U.emplaceBack(he+1,he,he+de),U.emplaceBack(he+de,he+de+1,he+1)):(u.emplaceBack(he+1,he,he+de),u.emplaceBack(he+de,he+de+1,he+1))}}const G=Rr.simpleSegment(0,N,a.length,u.length-N);for(let J=0;J<U.uint16.length;J+=3)u.emplaceBack(U.uint16[J],U.uint16[J+1],U.uint16[J+2]);const q=Rr.simpleSegment(0,N,a.length,u.length-N);m.push({withoutSkirts:G,withSkirts:q})}return{vertices:a,indices:u,segments:m}}_createGrid(o){const t=this._fillGridMeshWithLods(64,ou);this._gridSegments=t.segments,this._gridBuffer=o.createVertexBuffer(t.vertices,id.members),this._gridIndexBuffer=o.createIndexBuffer(t.indices,!0)}_createPoles(o){const t=new ln;for(let m=0;m<=64;m++)t.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=o.createIndexBuffer(t,!0);const a=new Ni,u=new Ni;this._poleSegments=[];for(let m=0,y=0;m<Kg;m++){const w=360/(1<<m);a.emplaceBack(0,-ll,0,.5,0),u.emplaceBack(0,-ll,0,.5,1);for(let T=0;T<=64;T++){const I=T/64,P=Ti(0,w,I),[N,z,U]=fc(e_,yh,P,ll);a.emplaceBack(N,z,U,I,0),u.emplaceBack(N,z,U,I,1)}this._poleSegments.push(Rr.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(a,Xg,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(u,Xg,!1)}getGridBuffers(o,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,t){if(!this._wireframeSegments){const a=new qr,u=64,m=u+1+2,y=1;this._wireframeSegments=[];for(let w=0,T=0;w<ou.length;w++){const I=ou[w];for(let N=y;N<I+y;N++)for(let z=y;z<u+y;z++){const U=N*m+z;a.emplaceBack(U,U+1),a.emplaceBack(U,U+m),a.emplaceBack(U,U+m+1)}const P=I*u*3;this._wireframeSegments.push(Rr.simpleSegment(0,T,(I+1)*m,P)),T+=P}this._wireframeIndexBuffer=o.createIndexBuffer(a)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},p.GlyphManager=fu,p.ImagePosition=T_,p.KDBush=Hv,p.LivePerformanceUtils=uf,p.LngLat=Ki,p.LngLatBounds=il,p.LocalGlyphMode=wc,p.MAX_MERCATOR_LATITUDE=Yr,p.MercatorCoordinate=ld,p.ONE_EM=kr,p.OverscaledTileID=Ps,p.PerformanceMarkers=vl,p.Point=Ne,p.Properties=ge,p.RGBAImage=As,p.Ray=Pa,p.RequestManager=class{constructor(o,t,a){this._transformRequestFn=o,this._customAccessToken=t,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const o=function(){let t="";for(let a=0;a<10;a++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",on,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,t){return this._transformRequestFn&&this._transformRequestFn(o,t)||{url:o}}normalizeStyleURL(o,t){if(!Oe(o))return o;const a=Yt(o);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||t)}normalizeGlyphsURL(o,t){if(!Oe(o))return o;const a=Yt(o);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||t)}normalizeSourceURL(o,t,a,u){if(!Oe(o))return o;const m=Yt(o);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),a&&m.params.push(`language=${a}`),u&&m.params.push(`worldview=${u}`),this._makeAPIURL(m,this._customAccessToken||t)}normalizeSpriteURL(o,t,a,u){const m=Yt(o);return Oe(o)?(m.path=`/styles/v1${m.path}/sprite${t}${a}`,this._makeAPIURL(m,this._customAccessToken||u)):(m.path+=`${t}${a}`,Ut(m))}normalizeTileURL(o,t,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Oe(o))return o;const u=Yt(o);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||a&&"raster"!==u.authority&&512===a?"@2x":""}${Ae.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${Le.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${Le.TILE_URL_VERSION}${u.path}`);const m=this._customAccessToken||function(y){for(const w of y){const T=w.match(/^access_token=(.*)$/);if(T)return T[1]}return null}(u.params)||Le.ACCESS_TOKEN;return Le.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,m)}canonicalizeTileURL(o,t){const a=Yt(o);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return o;let u="mapbox://";a.path.match(/^\/raster\/v1\//)?u+=`raster/${a.path.replace(`/${Le.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${a.path.replace(`/${Le.TILE_URL_VERSION}/`,"")}`;let m=a.params;return t&&(m=m.filter(y=>!y.match(/^access_token=/))),m.length&&(u+=`?${m.join("&")}`),u}canonicalizeTileset(o,t){const a=!!t&&Oe(t),u=[];for(const m of o.tiles||[])Ze(m)?u.push(this.canonicalizeTileURL(m,a)):u.push(m);return u}_makeAPIURL(o,t){const a="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=Yt(Le.API_URL);if(o.protocol=u.protocol,o.authority=u.authority,"http"===o.protocol){const m=o.params.indexOf("secure");m>=0&&o.params.splice(m,1)}if("/"!==u.path&&(o.path=`${u.path}${o.path}`),!Le.REQUIRE_ACCESS_TOKEN)return Ut(o);if(t=t||Le.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return o.params=o.params.filter(m=>-1===m.indexOf("access_token")),o.params.push(`access_token=${t||""}`),Ut(o)}},p.ResourceType=ao,p.SegmentVector=Rr,p.SourceCache=$l,p.StencilMode=sg,p.StructArrayLayout1ui2=jn,p.StructArrayLayout2f1f2i16=xn,p.StructArrayLayout2i4=At,p.StructArrayLayout2ui4=qr,p.StructArrayLayout3f12=An,p.StructArrayLayout3ui6=ln,p.StructArrayLayout4i8=mt,p.StructArrayLayout5f20=Ni,p.Texture=to,p.Tile=zv,p.Transitionable=X,p.Uniform1f=Kc,p.Uniform1i=class extends qs{constructor(o){super(o),this.current=0}set(o,t,a){this.fetchUniformLocation(o,t)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},p.Uniform2f=class extends qs{constructor(o){super(o),this.current=[0,0]}set(o,t,a){this.fetchUniformLocation(o,t)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}},p.Uniform3f=class extends qs{constructor(o){super(o),this.current=[0,0,0]}set(o,t,a){this.fetchUniformLocation(o,t)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}},p.Uniform4f=Df,p.UniformColor=Sf,p.UniformMatrix2f=class extends qs{constructor(o){super(o),this.current=ha}set(o,t,a){if(this.fetchUniformLocation(o,t))for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}},p.UniformMatrix3f=class extends qs{constructor(o){super(o),this.current=Hg}set(o,t,a){if(this.fetchUniformLocation(o,t))for(let u=0;u<9;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},p.UniformMatrix4f=class extends qs{constructor(o){super(o),this.current=jy}set(o,t,a){if(this.fetchUniformLocation(o,t)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}},p.UnwrappedTileID=y_,p.ValidationError=rn,p.VectorTileFeature=Xf,p.VectorTileWorkerSource=class extends Za{constructor(o,t,a,u,m){super(),this.actor=o,this.layerIndex=t,this.availableImages=a,this.loadVectorData=m||W_,this.loading={},this.loaded={},this.deduped=new $v(o.scheduler),this.isSpriteLoaded=u,this.scheduler=o.scheduler}loadTile(o,t){const a=o.uid,u=o&&o.request,m=u&&u.collectResourceTiming,y=this.loading[a]=new jv(o);y.abort=this.loadVectorData(o,(w,T)=>{const I=!this.loading[a];if(delete this.loading[a],I||w||!T)return y.status="done",I||(this.loaded[a]=y),t(w);const P=T.rawData,N={};T.expires&&(N.expires=T.expires),T.cacheControl&&(N.cacheControl=T.cacheControl),y.vectorTile=T.vectorTile||new Yf(new wd(P));const z=()=>{y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,(U,G)=>{if(U||!G)return t(U);const q={};if(m){const J=Vs(u);J.length>0&&(q.resourceTiming=JSON.parse(JSON.stringify(J)))}t(null,st({rawTileData:P.slice(0)},G,N,q))})};this.isSpriteLoaded?z():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(z,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):z()}),this.loaded=this.loaded||{},this.loaded[a]=y})}reloadTile(o,t){const a=this.loaded,u=o.uid,m=this;if(a&&a[u]){const y=a[u];y.showCollisionBoxes=o.showCollisionBoxes,y.enableTerrain=!!o.enableTerrain,y.projection=o.projection,y.tileTransform=pu(o.tileID.canonical,o.projection);const w=(T,I)=>{const P=y.reloadCallback;P&&(delete y.reloadCallback,y.parse(y.vectorTile,m.layerIndex,this.availableImages,m.actor,P)),t(T,I)};"parsing"===y.status?y.reloadCallback=w:"done"===y.status&&(y.vectorTile?y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,w):w())}}abortTile(o,t){const a=o.uid,u=this.loading[a];u&&(u.abort&&u.abort(),delete this.loading[a]),t()}removeTile(o,t){const a=this.loaded,u=o.uid;a&&a[u]&&delete a[u],t()}},p.WritingMode=Js,p.ZoomDependentExpression=Hc,p.add=ol,p.addDynamicAttributes=_u,p.adjoint=function(o,t){var a=t[0],u=t[1],m=t[2],y=t[3],w=t[4],T=t[5],I=t[6],P=t[7],N=t[8];return o[0]=w*N-T*P,o[1]=m*P-u*N,o[2]=u*T-m*w,o[3]=T*I-y*N,o[4]=a*N-m*I,o[5]=m*y-a*T,o[6]=y*P-w*I,o[7]=u*I-a*P,o[8]=a*w-u*y,o},p.asyncAll=yr,p.bezier=cr,p.bindAll=yt,p.boundsAttributes=Bv,p.bufferConvexPolygon=function(o,t){const a=[];for(let u=0;u<o.length;u++){const m=Si(u-1,-1,o.length-1),y=Si(u+1,-1,o.length-1),w=o[u],T=o[y],I=o[m].sub(w).unit(),P=T.sub(w).unit(),N=P.angleWithSep(I.x,I.y),z=I.add(P).unit().mult(-1*t/Math.sin(N/2));a.push(w.add(z))}return a},p.cacheEntryPossiblyAdded=function(o){$i++,$i>$n&&(o.getActor().send("enforceCacheSizeLimit",Kl),$i=0)},p.calculateGlobeLabelMatrix=function(o,t){const{x:a,y:u}=o.point,m=Ky(a,u,o.worldSize/o._pixelsPerMercatorPixel,0,0);return nd(m,m,Jg(Oa(t)))},p.calculateGlobeMatrix=function(o){const{x:t,y:a}=o.point,{lng:u,lat:m}=o._center;return Ky(t,a,o.worldSize,u,m)},p.calculateGlobeMercatorMatrix=function(o){const t=o.pixelsPerMeter,a=t/Qo(1,o.center.lat),u=Ko(new Float64Array(16));return uh(u,u,[o.point.x,o.point.y,0]),Al(u,u,[a,a,t]),Float32Array.from(u)},p.circumferenceAtLatitude=t_,p.clamp=Wn,p.clearTileCache=function(o){if(!Hr())return;const t=ue.caches.delete(Bo);o&&t.catch(o).then(()=>o())},p.clipLine=Pv,p.clone=function(o){var t=new Ts(16);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},p.clone$1=ai,p.collisionCircleLayout=Lm,p.config=Le,p.conjugate=function(o,t){return o[0]=-t[0],o[1]=-t[1],o[2]=-t[2],o[3]=t[3],o},p.create=function(){var o=new Ts(16);return Ts!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},p.create$1=Pf,p.createExpression=$c,p.createLayout=Re,p.createStyleLayer=function(o){return"custom"===o.type?new L_(o):new fp[o.type](o)},p.cross=Zy,p.degToRad=Ft,p.distance=function(o,t){return Math.hypot(t[0]-o[0],t[1]-o[1],t[2]-o[2])},p.div=function(o,t,a){return o[0]=t[0]/a[0],o[1]=t[1]/a[1],o[2]=t[2]/a[2],o},p.dot=Aa,p.earthRadius=Ss,p.ease=No,p.easeCubicInOut=gi,p.ecefToLatLng=function([o,t,a]){const u=Math.hypot(o,t,a),m=Math.atan2(o,a),y=.5*Math.PI-Math.acos(-t/u);return new Ki(Kt(m),Kt(y))},p.emitValidationErrors=zg,p.endsWith=vt,p.enforceCacheSizeLimit=function(o){zo(),ii&&ii.then(t=>{t.keys().then(a=>{for(let u=0;u<a.length-o;u++)t.delete(a[u])})})},p.evaluateSizeForFeature=Bl,p.evaluateSizeForZoom=ul,p.evaluateVariableOffset=Uh,p.evented=C,p.exactEquals=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]},p.exactEquals$1=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]},p.exported=To,p.exported$1=Ae,p.extend=st,p.extend$1=Us,p.fillExtrusionHeightLift=Qf,p.filterObject=yn,p.fromMat4=function(o,t){return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[4],o[4]=t[5],o[5]=t[6],o[6]=t[8],o[7]=t[9],o[8]=t[10],o},p.fromQuat=function(o,t){var a=t[0],u=t[1],m=t[2],y=t[3],w=a+a,T=u+u,I=m+m,P=a*w,N=u*w,z=u*T,U=m*w,G=m*T,q=m*I,J=y*w,re=y*T,de=y*I;return o[0]=1-z-q,o[1]=N+de,o[2]=U-re,o[3]=0,o[4]=N-de,o[5]=1-P-q,o[6]=G+J,o[7]=0,o[8]=U+re,o[9]=G-J,o[10]=1-P-z,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},p.fromRotation=function(o,t){var a=Math.sin(t),u=Math.cos(t);return o[0]=u,o[1]=a,o[2]=0,o[3]=-a,o[4]=u,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},p.fromScaling=Gy,p.furthestTileCorner=function(o){const t=Math.round((o+45+360)%360/90)%4;return ui[t]},p.getAABBPointSquareDist=function(o,t,a){let u=0;for(let m=0;m<2;++m){const y=a?a[m]:0;o[m]>y&&(u+=(o[m]-y)*(o[m]-y)),t[m]<y&&(u+=(y-t[m])*(y-t[m]))}return u},p.getAnchorAlignment=Dv,p.getAnchorJustification=yb,p.getBounds=function(o){let t=1/0,a=1/0,u=-1/0,m=-1/0;for(const y of o)t=Math.min(t,y.x),a=Math.min(a,y.y),u=Math.max(u,y.x),m=Math.max(m,y.y);return{min:new Ne(t,a),max:new Ne(u,m)}},p.getColumn=wo,p.getDefaultExportFromCjs=Ot,p.getGridMatrix=function(o,t,a,u){const m=t.getNorth(),y=t.getSouth(),w=t.getWest(),T=t.getEast(),I=1<<o.z,P=T-w,N=m-y,z=P/64,U=-N/ou[a],G=[0,z,0,U,0,0,m,w,0];if(o.z>0){const q=180/u;rl(G,G,[q/P+1,0,0,0,q/N+1,0,-.5*q/z,.5*q/U,1])}return G[2]=I,G[5]=o.x,G[8]=o.y,G},p.getImage=_e,p.getJSON=function(o,t){return oa(st(o,{type:"json"}),t)},p.getLatitudinalLod=function(o){const t=Yr-5;o=Wn(o,-t,t)/t*90;const a=Math.pow(Math.abs(Math.sin(Ft(o))),3);return Math.round(a*(ou.length-1))},p.getMapSessionAPI=Er,p.getPerformanceMeasurement=Vs,p.getProjection=tg,p.getRTLTextPluginStatus=S,p.getReferrer=Hi,p.getTilePoint=function(o,{x:t,y:a},u=0){return new Ne(((t-u)*o.scale-o.x)*_n,(a*o.scale-o.y)*_n)},p.getTileVec3=function(o,t,a=0){return hh(((t.x-a)*o.scale-o.x)*_n,(t.y*o.scale-o.y)*_n,ad(t.z,t.y))},p.getVideo=function(o,t){const a=ue.document.createElement("video");a.muted=!0,a.onloadstart=function(){t(null,a)};for(let u=0;u<o.length;u++){const m=ue.document.createElement("source");Ga(o[u])||(a.crossOrigin="Anonymous"),m.src=o[u],a.appendChild(m)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(o){const t=[0,0,0],a=Ko(new Float64Array(16));return nd(a,o.pixelMatrix,o.globeMatrix),Vr(t,t,a),new Ne(t[0],t[1])},p.globeDenormalizeECEF=Jg,p.globeECEFOrigin=function(o,t){const a=[0,0,0];return Vr(a,a,_m(Oa(t.canonical))),Vr(a,a,o),a},p.globeMetersToEcef=Ol,p.globeNormalizeECEF=_m,p.globePixelsToTileUnits=function(o,t){return _n/(512*Math.pow(2,o))*pc(Oa(t))},p.globePoleMatrixForTile=function(o,t,a){const u=Ko(new Float64Array(16)),m=(t/(1<<o)-.5)*Math.PI*2;return sm(u,a.globeMatrix,m),Float32Array.from(u)},p.globeTileBounds=Oa,p.globeTiltAtLngLat=sd,p.globeToMercatorTransition=_h,p.globeUseCustomAntiAliasing=function(o,t,a){const u=_h(a.zoom),m=o.style.map._antialias,y=!!t.extStandardDerivatives,w=t.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return 0===u&&!m&&!w&&y},p.identity=Ko,p.identity$1=Of,p.invert=om,p.isFullscreen=function(){return!!ue.document.fullscreenElement||!!ue.document.webkitFullscreenElement},p.isLngLatBehindGlobe=Ff,p.isMapAuthenticated=function(o){return lo.has(o)},p.isMapboxURL=Oe,p.isSafariWithAntialiasingBug=function(o){const t=o.navigator?o.navigator.userAgent:null;return!!Bs(o)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=po,p.latLngToECEF=su,p.len=dm,p.length=dh,p.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},p.lngFromMercatorX=Is,p.loadVectorTile=W_,p.makeRequest=oa,p.mapValue=function(o,t,a,u,m){return Wn((o-t)/(a-t)*(m-u)+u,u,m)},p.mercatorScale=ym,p.mercatorXfromLng=Rl,p.mercatorYfromLat=ka,p.mercatorZfromAltitude=Qo,p.mul=eu,p.mul$1=um,p.multiply=nd,p.multiply$1=rl,p.multiply$2=sl,p.nextPowerOfTwo=Zt,p.normalize=eo,p.normalize$1=fm,p.normalize$2=Yg,p.number=Ti,p.ortho=function(o,t,a,u,m,y,w){var T=1/(t-a),I=1/(u-m),P=1/(y-w);return o[0]=-2*T,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*I,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*P,o[11]=0,o[12]=(t+a)*T,o[13]=(m+u)*I,o[14]=(w+y)*P,o[15]=1,o},p.pbf=vv,p.perspective=function(o,t,a,u,m){var y,w=1/Math.tan(t/2);return o[0]=w/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=w,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=m&&m!==1/0?(o[10]=(m+u)*(y=1/(u-m)),o[14]=2*m*u*y):(o[10]=-1,o[14]=-2*u),o},p.pick=function(o,t){const a={};for(let u=0;u<t.length;u++){const m=t[u];m in o&&(a[m]=o[m])}return a},p.plugin=F,p.pointGeometry=gn,p.polesInViewport=function(o){const t=Ko(new Float64Array(16));nd(t,o.pixelMatrix,o.globeMatrix);const a=[0,Ms,0],u=[0,Ds,0];return Vr(a,a,t),Vr(u,u,t),[a[0]>0&&a[0]<=o.width&&a[1]>0&&a[1]<=o.height&&!Ff(o,new Ki(o.center.lat,90)),u[0]>0&&u[0]<=o.width&&u[1]>0&&u[1]<=o.height&&!Ff(o,new Ki(o.center.lat,-90))]},p.polygonContainsPoint=au,p.polygonIntersectsBox=r_,p.polygonIntersectsPolygon=Fl,p.polygonizeBounds=function(o,t,a=0,u=!0){const m=new Ne(a,a),y=o.sub(m),w=t.add(m),T=[y,new Ne(w.x,y.y),w,new Ne(y.x,w.y)];return u&&T.push(y.clone()),T},p.posAttributes=id,p.postMapLoadEvent=wr,p.postPerformanceEvent=tr,p.postTurnstileEvent=ei,p.potpack=Cv,p.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},p.radToDeg=Kt,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(o){return o({pluginStatus:_,pluginURL:l}),C.on("pluginStateChange",o),o},p.removeAuthState=function(o){lo.delete(o)},p.renderColorRamp=xm,p.resample=cd,p.rotateX=Hy,p.rotateX$1=Rf,p.rotateY=sm,p.rotateY$1=hm,p.rotateZ=function(o,t,a){var u=Math.sin(a),m=Math.cos(a),y=t[0],w=t[1],T=t[2],I=t[3],P=t[4],N=t[5],z=t[6],U=t[7];return t!==o&&(o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=y*m+P*u,o[1]=w*m+N*u,o[2]=T*m+z*u,o[3]=I*m+U*u,o[4]=P*m-y*u,o[5]=N*m-w*u,o[6]=z*m-T*u,o[7]=U*m-I*u,o},p.rotateZ$1=function(o,t,a){a*=.5;var u=t[0],m=t[1],y=t[2],w=t[3],T=Math.sin(a),I=Math.cos(a);return o[0]=u*I+m*T,o[1]=m*I-u*T,o[2]=y*I+w*T,o[3]=w*I-y*T,o},p.scale=Al,p.scale$1=qg,p.scale$2=ds,p.scaleAndAdd=dc,p.set=function(o,t,a,u){return o[0]=t,o[1]=a,o[2]=u,o},p.setCacheLimits=function(o,t){Kl=o,$n=t},p.setColumn=function(o,t,a){o[4*t+0]=a[0],o[4*t+1]=a[1],o[4*t+2]=a[2],o[4*t+3]=a[3]},p.setRTLTextPlugin=function(o,t,a=!1){if(_===fr||_===Nn||_===Po)throw new Error("setRTLTextPlugin cannot be called multiple times.");l=To.resolveURL(o),_=fr,Ka=t,v(),a||R()},p.smoothstep=ia,p.spec=ct,p.squaredLength=function(o){var t=o[0],a=o[1],u=o[2];return t*t+a*a+u*u},p.storeAuthState=function(o,t){t?lo.add(o):lo.delete(o)},p.sub=al,p.subtract=fh,p.symbolSize=Nm,p.tileAABB=function(o,t,a,u,m,y,w,T,I){if("globe"===I.name)return function Yy(o,t,a){const u=t/o.worldSize,m=o.globeMatrix;if(a.z<=1){const Ke=Oa(a).getCorners();return qy(Ke,m,u),Jo.fromPoints(Ke)}const y=mh(a),w=gm(y);qy(w,m,u);const T=Number.MAX_VALUE,I=[-T,-T,-T],P=[T,T,T];if(y.contains(o.center)){for(const kt of w)tu(P,P,kt),Ys(I,I,kt);I[2]=0;const Ke=o.point,pt=[Ke.x*u,Ke.y*u,0];return tu(P,P,pt),Ys(I,I,pt),new Jo(P,I)}const N=[m[12]*u,m[13]*u,m[14]*u],z=y.getCenter(),U=Wn(o.center.lat,-Yr,Yr),G=Wn(z.lat,-Yr,Yr),q=Rl(o.center.lng),J=ka(U);let re=q-Rl(z.lng);const de=J-ka(G);re>.5?re-=1:re<-.5&&(re+=1);let xe=0;Math.abs(re)>Math.abs(de)?xe=re>=0?1:3:(xe=de>=0?0:2,dc(N,N,[m[4]*u,m[5]*u,m[6]*u],-Math.sin(Ft(de>=0?y.getSouth():y.getNorth()))*ll));const he=w[xe],ve=w[(xe+1)%4],Ce=new Wy(he,ve,N),Ee=[ph(Ce,0)||he[0],ph(Ce,1)||he[1],ph(Ce,2)||he[2]],et=_h(o.zoom);if(et>0){const Ke=function({x:kt,y:ot,z:Tt},xt,Pt,Rt,lt){const Gt=1/(1<<Tt);let tn=kt*Gt,Qt=tn+Gt,Mn=ot*Gt,jt=Mn+Gt,mn=0;const Bn=(tn+Qt)/2-Rt;return Bn>.5?mn=-1:Bn<-.5&&(mn=1),tn=((tn+mn)*xt-(Rt*=xt))*Pt+Rt,Qt=((Qt+mn)*xt-Rt)*Pt+Rt,Mn=(Mn*xt-(lt*=xt))*Pt+lt,jt=(jt*xt-lt)*Pt+lt,[[tn,jt,0],[Qt,jt,0],[Qt,Mn,0],[tn,Mn,0]]}(a,t,o._pixelsPerMercatorPixel,q,J);for(let kt=0;kt<w.length;kt++)rd(w[kt],Ke[kt],et);const pt=ol([],Ke[xe],Ke[(xe+1)%4]);ds(pt,pt,.5),rd(Ee,pt,et)}for(const Ke of w)tu(P,P,Ke),Ys(I,I,Ke);return P[2]=Math.min(he[2],ve[2]),tu(P,P,Ee),Ys(I,I,Ee),new Jo(P,I)}(o,t,new Ih(a,u,m));const P=pu({z:a,x:u,y:m},I);return new Jo([(y+P.x/P.scale)*t,t*(P.y/P.scale),w],[(y+P.x2/P.scale)*t,t*(P.y2/P.scale),T])},p.tileCornersToBounds=mh,p.tileTransform=pu,p.transformMat3=function(o,t,a){var u=t[0],m=t[1],y=t[2];return o[0]=u*a[0]+m*a[3]+y*a[6],o[1]=u*a[1]+m*a[4]+y*a[7],o[2]=u*a[2]+m*a[5]+y*a[8],o},p.transformMat4=Vr,p.transformMat4$1=nu,p.transformQuat=eb,p.transitionTileAABBinECEF=od,p.translate=uh,p.transpose=function(o,t){if(o===t){var a=t[1],u=t[2],m=t[5];o[1]=t[3],o[2]=t[6],o[3]=a,o[5]=t[7],o[6]=u,o[7]=m}else o[0]=t[0],o[1]=t[3],o[2]=t[6],o[3]=t[1],o[4]=t[4],o[5]=t[7],o[6]=t[2],o[7]=t[5],o[8]=t[8];return o},p.triggerPluginCompletionEvent=f,p.uniqueId=Mt,p.updateGlobeVertexNormal=function(o,t,a,u,m){const y=5*t+2;o.float32[y+0]=a,o.float32[y+1]=u,o.float32[y+2]=m},p.validateCustomStyleLayer=function(o){const t=[],a=o.id;return void 0===a&&t.push({message:`layers.${a}: missing required property "id"`}),void 0===o.render&&t.push({message:`layers.${a}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&t.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),t},p.validateFilter=o=>cs(Ya(o)),p.validateFog=o=>cs(em(o)),p.validateLayer=o=>cs(Uy(o)),p.validateLight=o=>cs(Il(o)),p.validateSource=o=>cs(Sa(o)),p.validateStyle=wf,p.validateTerrain=o=>cs(ho(o)),p.values=ra,p.vectorTile=Wf,p.version=Ye,p.warnOnce=Yn,p.window=ue,p.wrap=Si}),Be(0,function(p){function ue(be){if("number"==typeof be||"boolean"==typeof be||"string"==typeof be||null==be)return JSON.stringify(be);if(Array.isArray(be)){let ie="[";for(const _e of be)ie+=`${ue(_e)},`;return`${ie}]`}let Q="{";for(const ie of Object.keys(be).sort())Q+=`${ie}:${ue(be[ie])},`;return`${Q}}`}function Ye(be){let Q="";for(const ie of p.refProperties)Q+=`/${ue(be[ie])}`;return Q}class Ge{constructor(Q){this.keyCache={},Q&&this.replace(Q)}replace(Q){this._layerConfigs={},this._layers={},this.update(Q,[])}update(Q,ie){for(const Te of Q)this._layerConfigs[Te.id]=Te,(this._layers[Te.id]=p.createStyleLayer(Te)).compileFilter(),this.keyCache[Te.id]&&delete this.keyCache[Te.id];for(const Te of ie)delete this.keyCache[Te],delete this._layerConfigs[Te],delete this._layers[Te];this.familiesBySource={};const _e=function(Te,Oe){const Ze={};for(let Pe=0;Pe<Te.length;Pe++){const tt=Oe&&Oe[Te[Pe].id]||Ye(Te[Pe]);Oe&&(Oe[Te[Pe].id]=tt);let Ht=Ze[tt];Ht||(Ht=Ze[tt]=[]),Ht.push(Te[Pe])}const je=[];for(const Pe in Ze)je.push(Ze[Pe]);return je}(p.values(this._layerConfigs),this.keyCache);for(const Te of _e){const Oe=Te.map(Yt=>this._layers[Yt.id]),Ze=Oe[0];if("none"===Ze.visibility)continue;const je=Ze.source||"";let Pe=this.familiesBySource[je];Pe||(Pe=this.familiesBySource[je]={});const tt=Ze.sourceLayer||"_geojsonTileLayer";let Ht=Pe[tt];Ht||(Ht=Pe[tt]=[]),Ht.push(Oe)}}}class Le{loadTile(Q,ie){const{uid:_e,encoding:Te,rawImageData:Oe,padding:Ze,buildQuadTree:je}=Q,Pe=p.window.ImageBitmap&&Oe instanceof p.window.ImageBitmap?this.getImageData(Oe,Ze):Oe;ie(null,new p.DEMData(_e,Pe,Te,Ze<1,je))}getImageData(Q,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Q.width,Q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Q.width,this.offscreenCanvas.height=Q.height,this.offscreenCanvasContext.drawImage(Q,0,0,Q.width,Q.height);const _e=this.offscreenCanvasContext.getImageData(-ie,-ie,Q.width+2*ie,Q.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),_e}}function Ae(be,Q){if(0!==be.length){ke(be[0],Q);for(var ie=1;ie<be.length;ie++)ke(be[ie],!Q)}}function ke(be,Q){for(var ie=0,_e=0,Te=0,Oe=be.length,Ze=Oe-1;Te<Oe;Ze=Te++){var je=(be[Te][0]-be[Ze][0])*(be[Ze][1]+be[Te][1]),Pe=ie+je;_e+=Math.abs(ie)>=Math.abs(je)?ie-Pe+je:je-Pe+ie,ie=Pe}ie+_e>=0!=!!Q&&be.reverse()}var $e=p.getDefaultExportFromCjs(function be(Q,ie){var _e,Te=Q&&Q.type;if("FeatureCollection"===Te)for(_e=0;_e<Q.features.length;_e++)be(Q.features[_e],ie);else if("GeometryCollection"===Te)for(_e=0;_e<Q.geometries.length;_e++)be(Q.geometries[_e],ie);else if("Feature"===Te)be(Q.geometry,ie);else if("Polygon"===Te)Ae(Q.coordinates,ie);else if("MultiPolygon"===Te)for(_e=0;_e<Q.coordinates.length;_e++)Ae(Q.coordinates[_e],ie);return Q});const Qe=p.VectorTileFeature.prototype.toGeoJSON;var It={exports:{}},Wt=p.pointGeometry,on=p.vectorTile.VectorTileFeature,Ot=Cn;function Cn(be,Q){this.options=Q||{},this.features=be,this.length=be.length}function un(be,Q){this.id="number"==typeof be.id?be.id:void 0,this.type=be.type,this.rawGeometry=1===be.type?[be.geometry]:be.geometry,this.properties=be.tags,this.extent=Q||4096}Cn.prototype.feature=function(be){return new un(this.features[be],this.options.extent)},un.prototype.loadGeometry=function(){var be=this.rawGeometry;this.geometry=[];for(var Q=0;Q<be.length;Q++){for(var ie=be[Q],_e=[],Te=0;Te<ie.length;Te++)_e.push(new Wt(ie[Te][0],ie[Te][1]));this.geometry.push(_e)}return this.geometry},un.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var be=this.geometry,Q=1/0,ie=-1/0,_e=1/0,Te=-1/0,Oe=0;Oe<be.length;Oe++)for(var Ze=be[Oe],je=0;je<Ze.length;je++){var Pe=Ze[je];Q=Math.min(Q,Pe.x),ie=Math.max(ie,Pe.x),_e=Math.min(_e,Pe.y),Te=Math.max(Te,Pe.y)}return[Q,_e,ie,Te]},un.prototype.toGeoJSON=on.prototype.toGeoJSON;var Sn=p.pbf,gn=Ot;function it(be){var Q=new Sn;return function(ie,_e){for(var Te in ie.layers)_e.writeMessage(3,Ne,ie.layers[Te])}(be,Q),Q.finish()}function Ne(be,Q){var ie;Q.writeVarintField(15,be.version||1),Q.writeStringField(1,be.name||""),Q.writeVarintField(5,be.extent||4096);var _e={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<be.length;ie++)_e.feature=be.feature(ie),Q.writeMessage(2,Nt,_e);var Te=_e.keys;for(ie=0;ie<Te.length;ie++)Q.writeStringField(3,Te[ie]);var Oe=_e.values;for(ie=0;ie<Oe.length;ie++)Q.writeMessage(4,gi,Oe[ie])}function Nt(be,Q){var ie=be.feature;void 0!==ie.id&&Q.writeVarintField(1,ie.id),Q.writeMessage(2,$t,be),Q.writeVarintField(3,ie.type),Q.writeMessage(4,ui,ie)}function $t(be,Q){var ie=be.feature,_e=be.keys,Te=be.values,Oe=be.keycache,Ze=be.valuecache;for(var je in ie.properties){var Pe=ie.properties[je],tt=Oe[je];if(null!==Pe){void 0===tt&&(_e.push(je),Oe[je]=tt=_e.length-1),Q.writeVarint(tt);var Ht=typeof Pe;"string"!==Ht&&"boolean"!==Ht&&"number"!==Ht&&(Pe=JSON.stringify(Pe));var Yt=Ht+":"+Pe,Ut=Ze[Yt];void 0===Ut&&(Te.push(Pe),Ze[Yt]=Ut=Te.length-1),Q.writeVarint(Ut)}}}function Ft(be,Q){return(Q<<3)+(7&be)}function Kt(be){return be<<1^be>>31}function ui(be,Q){for(var ie=be.loadGeometry(),_e=be.type,Te=0,Oe=0,Ze=ie.length,je=0;je<Ze;je++){var Pe=ie[je],tt=1;1===_e&&(tt=Pe.length),Q.writeVarint(Ft(1,tt));for(var Ht=3===_e?Pe.length-1:Pe.length,Yt=0;Yt<Ht;Yt++){1===Yt&&1!==_e&&Q.writeVarint(Ft(2,Ht-1));var Ut=Pe[Yt].x-Te,qn=Pe[Yt].y-Oe;Q.writeVarint(Kt(Ut)),Q.writeVarint(Kt(qn)),Te+=Ut,Oe+=qn}3===_e&&Q.writeVarint(Ft(7,1))}}function gi(be,Q){var ie=typeof be;"string"===ie?Q.writeStringField(1,be):"boolean"===ie?Q.writeBooleanField(7,be):"number"===ie&&(be%1!=0?Q.writeDoubleField(3,be):be<0?Q.writeSVarintField(6,be):Q.writeVarintField(5,be))}It.exports=it,It.exports.fromVectorTileJs=it,It.exports.fromGeojsonVt=function(be,Q){Q=Q||{};var ie={};for(var _e in be)ie[_e]=new gn(be[_e].features,Q),ie[_e].name=_e,ie[_e].version=Q.version,ie[_e].extent=Q.extent;return it({layers:ie})},It.exports.GeoJSONWrapper=gn;var cr=p.getDefaultExportFromCjs(It.exports);const No={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:be=>be},Wn=Math.fround||(ia=new Float32Array(1),be=>(ia[0]=+be,ia[0]));var ia;const Si=3,yr=5,ra=6;class st{constructor(Q){this.options=Object.assign(Object.create(No),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:ie,minZoom:_e,maxZoom:Te}=this.options;ie&&console.time("total time");const Oe=`prepare ${Q.length} points`;ie&&console.time(Oe),this.points=Q;const Ze=[];for(let Pe=0;Pe<Q.length;Pe++){const tt=Q[Pe];if(!tt.geometry)continue;const[Ht,Yt]=tt.geometry.coordinates,Ut=Wn(Et(Ht)),qn=Wn(Zt(Yt));Ze.push(Ut,qn,1/0,Pe,-1,1),this.options.reduce&&Ze.push(0)}let je=this.trees[Te+1]=this._createTree(Ze);ie&&console.timeEnd(Oe);for(let Pe=Te;Pe>=_e;Pe--){const tt=+Date.now();je=this.trees[Pe]=this._createTree(this._cluster(je,Pe)),ie&&console.log("z%d: %d clusters in %dms",Pe,je.numItems,+Date.now()-tt)}return ie&&console.timeEnd("total time"),this}getClusters(Q,ie){let _e=((Q[0]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,Q[1]));let Oe=180===Q[2]?180:((Q[2]+180)%360+360)%360-180;const Ze=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)_e=-180,Oe=180;else if(_e>Oe){const Yt=this.getClusters([_e,Te,180,Ze],ie),Ut=this.getClusters([-180,Te,Oe,Ze],ie);return Yt.concat(Ut)}const je=this.trees[this._limitZoom(ie)],Pe=je.range(Et(_e),Zt(Ze),Et(Oe),Zt(Te)),tt=je.data,Ht=[];for(const Yt of Pe){const Ut=this.stride*Yt;Ht.push(tt[Ut+yr]>1?dt(tt,Ut,this.clusterProps):this.points[tt[Ut+Si]])}return Ht}getChildren(Q){const ie=this._getOriginId(Q),_e=this._getOriginZoom(Q),Te="No cluster with the specified id.",Oe=this.trees[_e];if(!Oe)throw new Error(Te);const Ze=Oe.data;if(ie*this.stride>=Ze.length)throw new Error(Te);const je=this.options.radius/(this.options.extent*Math.pow(2,_e-1)),Pe=Oe.within(Ze[ie*this.stride],Ze[ie*this.stride+1],je),tt=[];for(const Ht of Pe){const Yt=Ht*this.stride;Ze[Yt+4]===Q&&tt.push(Ze[Yt+yr]>1?dt(Ze,Yt,this.clusterProps):this.points[Ze[Yt+Si]])}if(0===tt.length)throw new Error(Te);return tt}getLeaves(Q,ie,_e){const Te=[];return this._appendLeaves(Te,Q,ie=ie||10,_e=_e||0,0),Te}getTile(Q,ie,_e){const Te=this.trees[this._limitZoom(Q)],Oe=Math.pow(2,Q),{extent:Ze,radius:je}=this.options,Pe=je/Ze,tt=(_e-Pe)/Oe,Ht=(_e+1+Pe)/Oe,Yt={features:[]};return this._addTileFeatures(Te.range((ie-Pe)/Oe,tt,(ie+1+Pe)/Oe,Ht),Te.data,ie,_e,Oe,Yt),0===ie&&this._addTileFeatures(Te.range(1-Pe/Oe,tt,1,Ht),Te.data,Oe,_e,Oe,Yt),ie===Oe-1&&this._addTileFeatures(Te.range(0,tt,Pe/Oe,Ht),Te.data,-1,_e,Oe,Yt),Yt.features.length?Yt:null}getClusterExpansionZoom(Q){let ie=this._getOriginZoom(Q)-1;for(;ie<=this.options.maxZoom;){const _e=this.getChildren(Q);if(ie++,1!==_e.length)break;Q=_e[0].properties.cluster_id}return ie}_appendLeaves(Q,ie,_e,Te,Oe){const Ze=this.getChildren(ie);for(const je of Ze){const Pe=je.properties;if(Pe&&Pe.cluster?Oe+Pe.point_count<=Te?Oe+=Pe.point_count:Oe=this._appendLeaves(Q,Pe.cluster_id,_e,Te,Oe):Oe<Te?Oe++:Q.push(je),Q.length===_e)break}return Oe}_createTree(Q){const ie=new p.KDBush(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let _e=0;_e<Q.length;_e+=this.stride)ie.add(Q[_e],Q[_e+1]);return ie.finish(),ie.data=Q,ie}_addTileFeatures(Q,ie,_e,Te,Oe,Ze){for(const je of Q){const Pe=je*this.stride,tt=ie[Pe+yr]>1;let Ht,Yt,Ut;if(tt)Ht=Mt(ie,Pe,this.clusterProps),Yt=ie[Pe],Ut=ie[Pe+1];else{const Xn=this.points[ie[Pe+Si]];Ht=Xn.properties;const[Hn,ei]=Xn.geometry.coordinates;Yt=Et(Hn),Ut=Zt(ei)}const qn={type:1,geometry:[[Math.round(this.options.extent*(Yt*Oe-_e)),Math.round(this.options.extent*(Ut*Oe-Te))]],tags:Ht};let Vn;Vn=tt||this.options.generateId?ie[Pe+Si]:this.points[ie[Pe+Si]].id,void 0!==Vn&&(qn.id=Vn),Ze.features.push(qn)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,ie){const{radius:_e,extent:Te,reduce:Oe,minPoints:Ze}=this.options,je=_e/(Te*Math.pow(2,ie)),Pe=Q.data,tt=[],Ht=this.stride;for(let Yt=0;Yt<Pe.length;Yt+=Ht){if(Pe[Yt+2]<=ie)continue;Pe[Yt+2]=ie;const Ut=Pe[Yt],qn=Pe[Yt+1],Vn=Q.within(Pe[Yt],Pe[Yt+1],je),Xn=Pe[Yt+yr];let Hn=Xn;for(const ei of Vn){const Qn=ei*Ht;Pe[Qn+2]>ie&&(Hn+=Pe[Qn+yr])}if(Hn>Xn&&Hn>=Ze){let ei,Qn=Ut*Xn,wr=qn*Xn,li=-1;const tr=((Yt/Ht|0)<<5)+(ie+1)+this.points.length;for(const Vo of Vn){const Er=Vo*Ht;if(Pe[Er+2]<=ie)continue;Pe[Er+2]=ie;const lo=Pe[Er+yr];Qn+=Pe[Er]*lo,wr+=Pe[Er+1]*lo,Pe[Er+4]=tr,Oe&&(ei||(ei=this._map(Pe,Yt,!0),li=this.clusterProps.length,this.clusterProps.push(ei)),Oe(ei,this._map(Pe,Er)))}Pe[Yt+4]=tr,tt.push(Qn/Hn,wr/Hn,1/0,tr,-1,Hn),Oe&&tt.push(li)}else{for(let ei=0;ei<Ht;ei++)tt.push(Pe[Yt+ei]);if(Hn>1)for(const ei of Vn){const Qn=ei*Ht;if(!(Pe[Qn+2]<=ie)){Pe[Qn+2]=ie;for(let wr=0;wr<Ht;wr++)tt.push(Pe[Qn+wr])}}}}return tt}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,ie,_e){if(Q[ie+yr]>1){const Ze=this.clusterProps[Q[ie+ra]];return _e?Object.assign({},Ze):Ze}const Te=this.points[Q[ie+Si]].properties,Oe=this.options.map(Te);return _e&&Oe===Te?Object.assign({},Oe):Oe}}function dt(be,Q,ie){return{type:"Feature",id:be[Q+Si],properties:Mt(be,Q,ie),geometry:{type:"Point",coordinates:[(_e=be[Q],360*(_e-.5)),_t(be[Q+1])]}};var _e}function Mt(be,Q,ie){const _e=be[Q+yr],Te=_e>=1e4?`${Math.round(_e/1e3)}k`:_e>=1e3?Math.round(_e/100)/10+"k":_e,Oe=be[Q+ra],Ze=-1===Oe?{}:Object.assign({},ie[Oe]);return Object.assign(Ze,{cluster:!0,cluster_id:be[Q+Si],point_count:_e,point_count_abbreviated:Te})}function Et(be){return be/360+.5}function Zt(be){const Q=Math.sin(be*Math.PI/180),ie=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ie<0?0:ie>1?1:ie}function _t(be){const Q=(180-360*be)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function yt(be,Q,ie,_e){for(var Te,Oe=_e,Ze=ie-Q>>1,je=ie-Q,Pe=be[Q],tt=be[Q+1],Ht=be[ie],Yt=be[ie+1],Ut=Q+3;Ut<ie;Ut+=3){var qn=vt(be[Ut],be[Ut+1],Pe,tt,Ht,Yt);if(qn>Oe)Te=Ut,Oe=qn;else if(qn===Oe){var Vn=Math.abs(Ut-Ze);Vn<je&&(Te=Ut,je=Vn)}}Oe>_e&&(Te-Q>3&&yt(be,Q,Te,_e),be[Te+2]=Oe,ie-Te>3&&yt(be,Te,ie,_e))}function vt(be,Q,ie,_e,Te,Oe){var Ze=Te-ie,je=Oe-_e;if(0!==Ze||0!==je){var Pe=((be-ie)*Ze+(Q-_e)*je)/(Ze*Ze+je*je);Pe>1?(ie=Te,_e=Oe):Pe>0&&(ie+=Ze*Pe,_e+=je*Pe)}return(Ze=be-ie)*Ze+(je=Q-_e)*je}function dn(be,Q,ie,_e){var Te={id:void 0===be?null:be,type:Q,geometry:ie,tags:_e,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Oe){var Ze=Oe.geometry,je=Oe.type;if("Point"===je||"MultiPoint"===je||"LineString"===je)yn(Oe,Ze);else if("Polygon"===je||"MultiLineString"===je)for(var Pe=0;Pe<Ze.length;Pe++)yn(Oe,Ze[Pe]);else if("MultiPolygon"===je)for(Pe=0;Pe<Ze.length;Pe++)for(var tt=0;tt<Ze[Pe].length;tt++)yn(Oe,Ze[Pe][tt])}(Te),Te}function yn(be,Q){for(var ie=0;ie<Q.length;ie+=3)be.minX=Math.min(be.minX,Q[ie]),be.minY=Math.min(be.minY,Q[ie+1]),be.maxX=Math.max(be.maxX,Q[ie]),be.maxY=Math.max(be.maxY,Q[ie+1])}function ai(be,Q,ie,_e){if(Q.geometry){var Te=Q.geometry.coordinates,Oe=Q.geometry.type,Ze=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2),je=[],Pe=Q.id;if(ie.promoteId?Pe=Q.properties[ie.promoteId]:ie.generateId&&(Pe=_e||0),"Point"===Oe)On(Te,je);else if("MultiPoint"===Oe)for(var tt=0;tt<Te.length;tt++)On(Te[tt],je);else if("LineString"===Oe)Yn(Te,je,Ze,!1);else if("MultiLineString"===Oe){if(ie.lineMetrics){for(tt=0;tt<Te.length;tt++)Yn(Te[tt],je=[],Ze,!1),be.push(dn(Pe,"LineString",je,Q.properties));return}ji(Te,je,Ze,!1)}else if("Polygon"===Oe)ji(Te,je,Ze,!0);else{if("MultiPolygon"!==Oe){if("GeometryCollection"===Oe){for(tt=0;tt<Q.geometry.geometries.length;tt++)ai(be,{id:Pe,geometry:Q.geometry.geometries[tt],properties:Q.properties},ie,_e);return}throw new Error("Input data is not a valid GeoJSON object.")}for(tt=0;tt<Te.length;tt++){var Ht=[];ji(Te[tt],Ht,Ze,!0),je.push(Ht)}}be.push(dn(Pe,Oe,je,Q.properties))}}function On(be,Q){Q.push(so(be[0])),Q.push(Pi(be[1])),Q.push(0)}function Yn(be,Q,ie,_e){for(var Te,Oe,Ze=0,je=0;je<be.length;je++){var Pe=so(be[je][0]),tt=Pi(be[je][1]);Q.push(Pe),Q.push(tt),Q.push(0),je>0&&(Ze+=_e?(Te*tt-Pe*Oe)/2:Math.sqrt(Math.pow(Pe-Te,2)+Math.pow(tt-Oe,2))),Te=Pe,Oe=tt}var Ht=Q.length-3;Q[2]=1,yt(Q,0,Ht,ie),Q[Ht+2]=1,Q.size=Math.abs(Ze),Q.start=0,Q.end=Q.size}function ji(be,Q,ie,_e){for(var Te=0;Te<be.length;Te++){var Oe=[];Yn(be[Te],Oe,ie,_e),Q.push(Oe)}}function so(be){return be/360+.5}function Pi(be){var Q=Math.sin(be*Math.PI/180),ie=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ie<0?0:ie>1?1:ie}function ur(be,Q,ie,_e,Te,Oe,Ze,je){if(_e/=Q,Oe>=(ie/=Q)&&Ze<_e)return be;if(Ze<ie||Oe>=_e)return null;for(var Pe=[],tt=0;tt<be.length;tt++){var Ht=be[tt],Yt=Ht.geometry,Ut=Ht.type,qn=0===Te?Ht.minX:Ht.minY,Vn=0===Te?Ht.maxX:Ht.maxY;if(qn>=ie&&Vn<_e)Pe.push(Ht);else if(!(Vn<ie||qn>=_e)){var Xn=[];if("Point"===Ut||"MultiPoint"===Ut)is(Yt,Xn,ie,_e,Te);else if("LineString"===Ut)Bs(Yt,Xn,ie,_e,Te,!1,je.lineMetrics);else if("MultiLineString"===Ut)wo(Yt,Xn,ie,_e,Te,!1);else if("Polygon"===Ut)wo(Yt,Xn,ie,_e,Te,!0);else if("MultiPolygon"===Ut)for(var Hn=0;Hn<Yt.length;Hn++){var ei=[];wo(Yt[Hn],ei,ie,_e,Te,!0),ei.length&&Xn.push(ei)}if(Xn.length){if(je.lineMetrics&&"LineString"===Ut){for(Hn=0;Hn<Xn.length;Hn++)Pe.push(dn(Ht.id,Ut,Xn[Hn],Ht.tags));continue}"LineString"!==Ut&&"MultiLineString"!==Ut||(1===Xn.length?(Ut="LineString",Xn=Xn[0]):Ut="MultiLineString"),"Point"!==Ut&&"MultiPoint"!==Ut||(Ut=3===Xn.length?"Point":"MultiPoint"),Pe.push(dn(Ht.id,Ut,Xn,Ht.tags))}}}return Pe.length?Pe:null}function is(be,Q,ie,_e,Te){for(var Oe=0;Oe<be.length;Oe+=3){var Ze=be[Oe+Te];Ze>=ie&&Ze<=_e&&(Q.push(be[Oe]),Q.push(be[Oe+1]),Q.push(be[Oe+2]))}}function Bs(be,Q,ie,_e,Te,Oe,Ze){for(var je,Pe,tt=xa(be),Ht=0===Te?Kl:$n,Yt=be.start,Ut=0;Ut<be.length-3;Ut+=3){var qn=be[Ut],Vn=be[Ut+1],Xn=be[Ut+2],Hn=be[Ut+3],ei=be[Ut+4],Qn=0===Te?qn:Vn,wr=0===Te?Hn:ei,li=!1;Ze&&(je=Math.sqrt(Math.pow(qn-Hn,2)+Math.pow(Vn-ei,2))),Qn<ie?wr>ie&&(Pe=Ht(tt,qn,Vn,Hn,ei,ie),Ze&&(tt.start=Yt+je*Pe)):Qn>_e?wr<_e&&(Pe=Ht(tt,qn,Vn,Hn,ei,_e),Ze&&(tt.start=Yt+je*Pe)):Bo(tt,qn,Vn,Xn),wr<ie&&Qn>=ie&&(Pe=Ht(tt,qn,Vn,Hn,ei,ie),li=!0),wr>_e&&Qn<=_e&&(Pe=Ht(tt,qn,Vn,Hn,ei,_e),li=!0),!Oe&&li&&(Ze&&(tt.end=Yt+je*Pe),Q.push(tt),tt=xa(be)),Ze&&(Yt+=je)}var tr=be.length-3;qn=be[tr],Vn=be[tr+1],Xn=be[tr+2],(Qn=0===Te?qn:Vn)>=ie&&Qn<=_e&&Bo(tt,qn,Vn,Xn),tr=tt.length-3,Oe&&tr>=3&&(tt[tr]!==tt[0]||tt[tr+1]!==tt[1])&&Bo(tt,tt[0],tt[1],tt[2]),tt.length&&Q.push(tt)}function xa(be){var Q=[];return Q.size=be.size,Q.start=be.start,Q.end=be.end,Q}function wo(be,Q,ie,_e,Te,Oe){for(var Ze=0;Ze<be.length;Ze++)Bs(be[Ze],Q,ie,_e,Te,Oe,!1)}function Bo(be,Q,ie,_e){be.push(Q),be.push(ie),be.push(_e)}function Kl(be,Q,ie,_e,Te,Oe){var Ze=(Oe-Q)/(_e-Q);return be.push(Oe),be.push(ie+(Te-ie)*Ze),be.push(1),Ze}function $n(be,Q,ie,_e,Te,Oe){var Ze=(Oe-ie)/(Te-ie);return be.push(Q+(_e-Q)*Ze),be.push(Oe),be.push(1),Ze}function ii(be,Q){for(var ie=[],_e=0;_e<be.length;_e++){var Te,Oe=be[_e],Ze=Oe.type;if("Point"===Ze||"MultiPoint"===Ze||"LineString"===Ze)Te=si(Oe.geometry,Q);else if("MultiLineString"===Ze||"Polygon"===Ze){Te=[];for(var je=0;je<Oe.geometry.length;je++)Te.push(si(Oe.geometry[je],Q))}else if("MultiPolygon"===Ze)for(Te=[],je=0;je<Oe.geometry.length;je++){for(var Pe=[],tt=0;tt<Oe.geometry[je].length;tt++)Pe.push(si(Oe.geometry[je][tt],Q));Te.push(Pe)}ie.push(dn(Oe.id,Ze,Te,Oe.tags))}return ie}function si(be,Q){var ie=[];ie.size=be.size,void 0!==be.start&&(ie.start=be.start,ie.end=be.end);for(var _e=0;_e<be.length;_e+=3)ie.push(be[_e]+Q,be[_e+1],be[_e+2]);return ie}function Hr(be,Q){if(be.transformed)return be;var ie,_e,Te,Oe=1<<be.z,Ze=be.x,je=be.y;for(ie=0;ie<be.features.length;ie++){var Pe=be.features[ie],tt=Pe.geometry,Ht=Pe.type;if(Pe.geometry=[],1===Ht)for(_e=0;_e<tt.length;_e+=2)Pe.geometry.push(zo(tt[_e],tt[_e+1],Q,Oe,Ze,je));else for(_e=0;_e<tt.length;_e++){var Yt=[];for(Te=0;Te<tt[_e].length;Te+=2)Yt.push(zo(tt[_e][Te],tt[_e][Te+1],Q,Oe,Ze,je));Pe.geometry.push(Yt)}}return be.transformed=!0,be}function zo(be,Q,ie,_e,Te,Oe){return[Math.round(ie*(be*_e-Te)),Math.round(ie*(Q*_e-Oe))]}function Eo(be,Q,ie,_e,Te){for(var Oe=Q===Te.maxZoom?0:Te.tolerance/((1<<Q)*Te.extent),Ze={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ie,y:_e,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},je=0;je<be.length;je++){Ze.numFeatures++,$i(Ze,be[je],Oe,Te);var Pe=be[je].minX,tt=be[je].minY,Ht=be[je].maxX,Yt=be[je].maxY;Pe<Ze.minX&&(Ze.minX=Pe),tt<Ze.minY&&(Ze.minY=tt),Ht>Ze.maxX&&(Ze.maxX=Ht),Yt>Ze.maxY&&(Ze.maxY=Yt)}return Ze}function $i(be,Q,ie,_e){var Te=Q.geometry,Oe=Q.type,Ze=[];if("Point"===Oe||"MultiPoint"===Oe)for(var je=0;je<Te.length;je+=3)Ze.push(Te[je]),Ze.push(Te[je+1]),be.numPoints++,be.numSimplified++;else if("LineString"===Oe)ao(Ze,Te,be,ie,!1,!1);else if("MultiLineString"===Oe||"Polygon"===Oe)for(je=0;je<Te.length;je++)ao(Ze,Te[je],be,ie,"Polygon"===Oe,0===je);else if("MultiPolygon"===Oe)for(var Pe=0;Pe<Te.length;Pe++){var tt=Te[Pe];for(je=0;je<tt.length;je++)ao(Ze,tt[je],be,ie,!0,0===je)}if(Ze.length){var Ht=Q.tags||null;if("LineString"===Oe&&_e.lineMetrics){for(var Yt in Ht={},Q.tags)Ht[Yt]=Q.tags[Yt];Ht.mapbox_clip_start=Te.start/Te.size,Ht.mapbox_clip_end=Te.end/Te.size}var Ut={geometry:Ze,type:"Polygon"===Oe||"MultiPolygon"===Oe?3:"LineString"===Oe||"MultiLineString"===Oe?2:1,tags:Ht};null!==Q.id&&(Ut.id=Q.id),be.features.push(Ut)}}function ao(be,Q,ie,_e,Te,Oe){var Ze=_e*_e;if(_e>0&&Q.size<(Te?Ze:_e))ie.numPoints+=Q.length/3;else{for(var je=[],Pe=0;Pe<Q.length;Pe+=3)(0===_e||Q[Pe+2]>Ze)&&(ie.numSimplified++,je.push(Q[Pe]),je.push(Q[Pe+1])),ie.numPoints++;Te&&function(tt,Ht){for(var Yt=0,Ut=0,qn=tt.length,Vn=qn-2;Ut<qn;Vn=Ut,Ut+=2)Yt+=(tt[Ut]-tt[Vn])*(tt[Ut+1]+tt[Vn+1]);if(Yt>0===Ht)for(Ut=0,qn=tt.length;Ut<qn/2;Ut+=2){var Xn=tt[Ut],Hn=tt[Ut+1];tt[Ut]=tt[qn-2-Ut],tt[Ut+1]=tt[qn-1-Ut],tt[qn-2-Ut]=Xn,tt[qn-1-Ut]=Hn}}(je,Oe),be.push(je)}}function vs(be,Q){var ie=(Q=this.options=function(Te,Oe){for(var Ze in Oe)Te[Ze]=Oe[Ze];return Te}(Object.create(this.options),Q)).debug;if(ie&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");var Te,Oe,Ze,je,Pe,tt,_e=function(Te,Oe){var Ze=[];if("FeatureCollection"===Te.type)for(var je=0;je<Te.features.length;je++)ai(Ze,Te.features[je],Oe,je);else ai(Ze,"Feature"===Te.type?Te:{geometry:Te},Oe);return Ze}(be,Q);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),je=Te=_e,Pe=ur(Te,1,-1-(Ze=(Oe=Q).buffer/Oe.extent),Ze,0,-1,2,Oe),tt=ur(Te,1,1-Ze,2+Ze,0,-1,2,Oe),(Pe||tt)&&(je=ur(Te,1,-Ze,1+Ze,0,-1,2,Oe)||[],Pe&&(je=ii(Pe,1).concat(je)),tt&&(je=je.concat(ii(tt,-1)))),(_e=je).length&&this.splitTile(_e,0,0,0),ie&&(_e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Hi(be,Q,ie){return 32*((1<<be)*ie+Q)+be}function oa(be,Q){const ie=be.tileID.canonical;if(!this._geoJSONIndex)return Q(null,null);const _e=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!_e)return Q(null,null);const Te=new class{constructor(Ze){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=Ze.length,this._features=Ze}feature(Ze){return new class{constructor(je){this._feature=je,this.extent=p.EXTENT,this.type=je.type,this.properties=je.tags,"id"in je&&!isNaN(je.id)&&(this.id=parseInt(je.id,10))}loadGeometry(){if(1===this._feature.type){const je=[];for(const Pe of this._feature.geometry)je.push([new p.Point(Pe[0],Pe[1])]);return je}{const je=[];for(const Pe of this._feature.geometry){const tt=[];for(const Ht of Pe)tt.push(new p.Point(Ht[0],Ht[1]));je.push(tt)}return je}}toGeoJSON(je,Pe,tt){return Qe.call(this,je,Pe,tt)}}(this._features[Ze])}}(_e.features);let Oe=cr(Te);0===Oe.byteOffset&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),Q(null,{vectorTile:Te,rawData:Oe.buffer})}vs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vs.prototype.splitTile=function(be,Q,ie,_e,Te,Oe,Ze){for(var je=[be,Q,ie,_e],Pe=this.options,tt=Pe.debug;je.length;){_e=je.pop(),ie=je.pop(),Q=je.pop(),be=je.pop();var Ht=1<<Q,Yt=Hi(Q,ie,_e),Ut=this.tiles[Yt];if(!Ut&&(tt>1&&console.time("creation"),Ut=this.tiles[Yt]=Eo(be,Q,ie,_e,Pe),this.tileCoords.push({z:Q,x:ie,y:_e}),tt)){tt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,ie,_e,Ut.numFeatures,Ut.numPoints,Ut.numSimplified),console.timeEnd("creation"));var qn="z"+Q;this.stats[qn]=(this.stats[qn]||0)+1,this.total++}if(Ut.source=be,Te){if(Q===Pe.maxZoom||Q===Te)continue;var Vn=1<<Te-Q;if(ie!==Math.floor(Oe/Vn)||_e!==Math.floor(Ze/Vn))continue}else if(Q===Pe.indexMaxZoom||Ut.numPoints<=Pe.indexMaxPoints)continue;if(Ut.source=null,0!==be.length){tt>1&&console.time("clipping");var Xn,Hn,ei,Qn,wr,li,tr=.5*Pe.buffer/Pe.extent,Vo=.5-tr,Er=.5+tr,lo=1+tr;Xn=Hn=ei=Qn=null,wr=ur(be,Ht,ie-tr,ie+Er,0,Ut.minX,Ut.maxX,Pe),li=ur(be,Ht,ie+Vo,ie+lo,0,Ut.minX,Ut.maxX,Pe),be=null,wr&&(Xn=ur(wr,Ht,_e-tr,_e+Er,1,Ut.minY,Ut.maxY,Pe),Hn=ur(wr,Ht,_e+Vo,_e+lo,1,Ut.minY,Ut.maxY,Pe),wr=null),li&&(ei=ur(li,Ht,_e-tr,_e+Er,1,Ut.minY,Ut.maxY,Pe),Qn=ur(li,Ht,_e+Vo,_e+lo,1,Ut.minY,Ut.maxY,Pe),li=null),tt>1&&console.timeEnd("clipping"),je.push(Xn||[],Q+1,2*ie,2*_e),je.push(Hn||[],Q+1,2*ie,2*_e+1),je.push(ei||[],Q+1,2*ie+1,2*_e),je.push(Qn||[],Q+1,2*ie+1,2*_e+1)}}},vs.prototype.getTile=function(be,Q,ie){var _e=this.options,Te=_e.extent,Oe=_e.debug;if(be<0||be>24)return null;var Ze=1<<be,je=Hi(be,Q=(Q%Ze+Ze)%Ze,ie);if(this.tiles[je])return Hr(this.tiles[je],Te);Oe>1&&console.log("drilling down to z%d-%d-%d",be,Q,ie);for(var Pe,tt=be,Ht=Q,Yt=ie;!Pe&&tt>0;)tt--,Ht=Math.floor(Ht/2),Yt=Math.floor(Yt/2),Pe=this.tiles[Hi(tt,Ht,Yt)];return Pe&&Pe.source?(Oe>1&&console.log("found parent tile z%d-%d-%d",tt,Ht,Yt),Oe>1&&console.time("drilling down"),this.splitTile(Pe.source,tt,Ht,Yt,be,Q,ie),Oe>1&&console.timeEnd("drilling down"),this.tiles[je]?Hr(this.tiles[je],Te):null):null};class Ei extends p.VectorTileWorkerSource{constructor(Q,ie,_e,Te,Oe){super(Q,ie,_e,Te,oa),Oe&&(this.loadGeoJSON=Oe)}loadData(Q,ie){const _e=Q&&Q.request,Te=_e&&_e.collectResourceTiming;this.loadGeoJSON(Q,(Oe,Ze)=>{if(Oe||!Ze)return ie(Oe);if("object"!=typeof Ze)return ie(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));{$e(Ze,!0);try{if(Q.filter){const Pe=p.createExpression(Q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Pe.result)throw new Error(Pe.value.map(Ht=>`${Ht.key}: ${Ht.message}`).join(", "));Ze={type:"FeatureCollection",features:Ze.features.filter(Ht=>Pe.value.evaluate({zoom:0},Ht))}}this._geoJSONIndex=Q.cluster?new st(function({superclusterOptions:Pe,clusterProperties:tt}){if(!tt||!Pe)return Pe;const Ht={},Yt={},Ut={accumulated:null,zoom:0},qn={properties:null},Vn=Object.keys(tt);for(const Xn of Vn){const[Hn,ei]=tt[Xn],Qn=p.createExpression(ei),wr=p.createExpression("string"==typeof Hn?[Hn,["accumulated"],["get",Xn]]:Hn);Ht[Xn]=Qn.value,Yt[Xn]=wr.value}return Pe.map=Xn=>{qn.properties=Xn;const Hn={};for(const ei of Vn)Hn[ei]=Ht[ei].evaluate(Ut,qn);return Hn},Pe.reduce=(Xn,Hn)=>{qn.properties=Hn;for(const ei of Vn)Ut.accumulated=Xn[ei],Xn[ei]=Yt[ei].evaluate(Ut,qn)},Pe}(Q)).load(Ze.features):new vs(Pe=Ze,Q.geojsonVtOptions)}catch(Pe){return ie(Pe)}this.loaded={};const je={};if(Te){const Pe=p.getPerformanceMeasurement(_e);Pe&&(je.resourceTiming={},je.resourceTiming[Q.source]=JSON.parse(JSON.stringify(Pe)))}ie(null,je)}var Pe})}reloadTile(Q,ie){const _e=this.loaded;return _e&&_e[Q.uid]?super.reloadTile(Q,ie):this.loadTile(Q,ie)}loadGeoJSON(Q,ie){if(Q.request)p.getJSON(Q.request,ie);else{if("string"!=typeof Q.data)return ie(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(Q.data))}catch{return ie(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Q,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId))}catch(_e){ie(_e)}}getClusterChildren(Q,ie){try{ie(null,this._geoJSONIndex.getChildren(Q.clusterId))}catch(_e){ie(_e)}}getClusterLeaves(Q,ie){try{ie(null,this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset))}catch(_e){ie(_e)}}}class Ga{constructor(Q){this.self=Q,this.actor=new p.Actor(Q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:Ei},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ie,_e)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=_e},this.self.registerRTLTextPlugin=ie=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=ie.applyArabicShaping,p.plugin.processBidirectionalText=ie.processBidirectionalText,p.plugin.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(Q,ie,_e){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q],_e()}checkIfReady(Q,ie,_e){_e()}setReferrer(Q,ie){this.referrer=ie}spriteLoaded(Q,ie){this.isSpriteLoaded[Q]=ie;for(const _e in this.workerSources[Q]){const Te=this.workerSources[Q][_e];for(const Oe in Te)Te[Oe]instanceof p.VectorTileWorkerSource&&(Te[Oe].isSpriteLoaded=ie,Te[Oe].fire(new p.Event("isSpriteLoaded")))}}setImages(Q,ie,_e){this.availableImages[Q]=ie;for(const Te in this.workerSources[Q]){const Oe=this.workerSources[Q][Te];for(const Ze in Oe)Oe[Ze].availableImages=ie}_e()}enableTerrain(Q,ie,_e){this.terrain=ie,_e()}setProjection(Q,ie){this.projections[Q]=p.getProjection(ie)}setLayers(Q,ie,_e){this.getLayerIndex(Q).replace(ie),_e()}updateLayers(Q,ie,_e){this.getLayerIndex(Q).update(ie.layers,ie.removedIds),_e()}loadTile(Q,ie,_e){const Te=this.enableTerrain?p.extend({enableTerrain:this.terrain},ie):ie;Te.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,ie.type,ie.source).loadTile(Te,_e)}loadDEMTile(Q,ie,_e){const Te=this.enableTerrain?p.extend({buildQuadTree:this.terrain},ie):ie;this.getDEMWorkerSource(Q,ie.source).loadTile(Te,_e)}reloadTile(Q,ie,_e){const Te=this.enableTerrain?p.extend({enableTerrain:this.terrain},ie):ie;Te.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,ie.type,ie.source).reloadTile(Te,_e)}abortTile(Q,ie,_e){this.getWorkerSource(Q,ie.type,ie.source).abortTile(ie,_e)}removeTile(Q,ie,_e){this.getWorkerSource(Q,ie.type,ie.source).removeTile(ie,_e)}removeSource(Q,ie,_e){if(!this.workerSources[Q]||!this.workerSources[Q][ie.type]||!this.workerSources[Q][ie.type][ie.source])return;const Te=this.workerSources[Q][ie.type][ie.source];delete this.workerSources[Q][ie.type][ie.source],void 0!==Te.removeSource?Te.removeSource(ie,_e):_e()}loadWorkerSource(Q,ie,_e){try{this.self.importScripts(ie.url),_e()}catch(Te){_e(Te.toString())}}syncRTLPluginState(Q,ie,_e){try{p.plugin.setState(ie);const Te=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=Te){this.self.importScripts(Te);const Oe=p.plugin.isParsed();_e(Oe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Te}`),Oe)}}catch(Te){_e(Te.toString())}}getAvailableImages(Q){let ie=this.availableImages[Q];return ie||(ie=[]),ie}getLayerIndex(Q){let ie=this.layerIndexes[Q];return ie||(ie=this.layerIndexes[Q]=new Ge),ie}getWorkerSource(Q,ie,_e){return this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][ie]||(this.workerSources[Q][ie]={}),this.workerSources[Q][ie][_e]||(this.workerSources[Q][ie][_e]=new this.workerSourceTypes[ie]({send:(Oe,Ze,je,Pe,tt,Ht)=>{this.actor.send(Oe,Ze,je,Q,tt,Ht)},scheduler:this.actor.scheduler},this.getLayerIndex(Q),this.getAvailableImages(Q),this.isSpriteLoaded[Q])),this.workerSources[Q][ie][_e]}getDEMWorkerSource(Q,ie){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][ie]||(this.demWorkerSources[Q][ie]=new Le),this.demWorkerSources[Q][ie]}enforceCacheSizeLimit(Q,ie){p.enforceCacheSizeLimit(ie)}getWorkerPerformanceMetrics(Q,ie,_e){_e(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ga(self)),Ga}),Be(0,function(p){function ue(_,l){if(Array.isArray(_)){if(!Array.isArray(l)||_.length!==l.length)return!1;for(let f=0;f<_.length;f++)if(!ue(_[f],l[f]))return!1;return!0}if("object"==typeof _&&null!==_&&null!==l){if("object"!=typeof l||Object.keys(_).length!==Object.keys(l).length)return!1;for(const f in _)if(!ue(_[f],l[f]))return!1;return!0}return _===l}var Ye=Ge;function Ge(_){return l=_,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,C,S=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(S);try{C=new Worker(R),v=!0}catch{v=!1}return C&&C.terminate(),URL.revokeObjectURL(R),v}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var v=document.createElement("canvas");v.width=v.height=1;var C=v.getContext("2d");if(!C)return!1;var S=C.getImageData(0,0,1,1);return S&&S.width===v.width}()||(void 0===Le[f=l&&l.failIfMajorPerformanceCaveat]&&(Le[f]=function(v){var C,R,F,B,S=(R=v,F=document.createElement("canvas"),(B=Object.create(Ge.webGLContextAttributes)).failIfMajorPerformanceCaveat=R,F.getContext("webgl",B)||F.getContext("experimental-webgl",B));if(!S)return!1;try{C=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!C||S.isContextLost())&&(S.shaderSource(C,"void main() {}"),S.compileShader(C),!0===S.getShaderParameter(C,S.COMPILE_STATUS))}(f)),!Le[f]||document.documentMode));var l,f}var Le={};function Ae(_,l,f){const v=p.window.document.createElement(_);return void 0!==l&&(v.className=l),f&&f.appendChild(v),v}function ke(_,l,f){const v=p.window.document.createElementNS("http://www.w3.org/2000/svg",_);for(const C of Object.keys(l))v.setAttributeNS(null,C,l[C]);return f&&f.appendChild(v),v}Ge.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const $e=p.window.document&&p.window.document.documentElement.style,Qe=$e&&void 0!==$e.userSelect?"userSelect":"WebkitUserSelect";let It;function Wt(){$e&&Qe&&(It=$e[Qe],$e[Qe]="none")}function on(){$e&&Qe&&($e[Qe]=It)}function Ot(_){_.preventDefault(),_.stopPropagation(),p.window.removeEventListener("click",Ot,!0)}function Cn(){p.window.addEventListener("click",Ot,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",Ot,!0)},0)}function un(_,l){const f=_.getBoundingClientRect();return it(_,f,l)}function Sn(_,l){const f=_.getBoundingClientRect(),v=[];for(let C=0;C<l.length;C++)v.push(it(_,f,l[C]));return v}function gn(_){return void 0!==p.window.InstallTrigger&&2===_.button&&_.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button}function it(_,l,f){const v=_.offsetWidth===l.width?1:_.offsetWidth/l.width;return new p.Point((f.clientX-l.left)*v,(f.clientY-l.top)*v)}function Ne(_,l){var f=l[0],v=l[1],C=l[2],S=l[3],R=f*S-C*v;return R?(_[0]=S*(R=1/R),_[1]=-v*R,_[2]=-C*R,_[3]=f*R,_):null}function Nt(_){const{userImage:l}=_;return!!(l&&l.render&&l.render())&&(_.data.replace(new Uint8Array(l.data.buffer)),!0)}class $t extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:f,callback:v}of this.requestors)this._notify(f,v);this.requestors=[]}}hasImage(l){return!!this.getImage(l)}getImage(l){return this.images[l]}addImage(l,f){this._validate(l,f)&&(this.images[l]=f)}_validate(l,f){let v=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),v=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),v=!1),this._validateContent(f.content,f)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),v=!1),v}_validateStretch(l,f){if(!l)return!0;let v=0;for(const C of l){if(C[0]<v||C[1]<C[0]||f<C[1])return!1;v=C[1]}return!0}_validateContent(l,f){return!(l&&(4!==l.length||l[0]<0||f.data.width<l[0]||l[1]<0||f.data.height<l[1]||l[2]<0||f.data.width<l[2]||l[3]<0||f.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,f){f.version=this.images[l].version+1,this.images[l]=f,this.updatedImages[l]=!0}removeImage(l){const f=this.images[l];delete this.images[l],delete this.patterns[l],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,f){let v=!0;if(!this.isLoaded())for(const C of l)this.images[C]||(v=!1);this.isLoaded()||v?this._notify(l,f):this.requestors.push({ids:l,callback:f})}_notify(l,f){const v={};for(const C of l){this.images[C]||this.fire(new p.Event("styleimagemissing",{id:C}));const S=this.images[C];S?v[C]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!(!S.userImage||!S.userImage.render)}:p.warnOnce(`Image "${C}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,v)}getPixelSize(){const{width:l,height:f}=this.atlasImage;return{width:l,height:f}}getPattern(l){const f=this.patterns[l],v=this.getImage(l);if(!v)return null;if(f&&f.position.version===v.version)return f.position;if(f)f.position.version=v.version;else{const C={w:v.data.width+2,h:v.data.height+2,x:0,y:0},S=new p.ImagePosition(C,v);this.patterns[l]={bin:C,position:S}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const f=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(l,this.atlasImage,f.RGBA),this.atlasTexture&&this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const S in this.patterns)l.push(this.patterns[S].bin);const{w:f,h:v}=p.potpack(l),C=this.atlasImage;C.resize({width:f||1,height:v||1});for(const S in this.patterns){const{bin:R}=this.patterns[S],F=R.x+1,B=R.y+1,$=this.images[S].data,j=$.width,X=$.height;p.RGBAImage.copy($,C,{x:0,y:0},{x:F,y:B},{width:j,height:X}),p.RGBAImage.copy($,C,{x:0,y:X-1},{x:F,y:B-1},{width:j,height:1}),p.RGBAImage.copy($,C,{x:0,y:0},{x:F,y:B+X},{width:j,height:1}),p.RGBAImage.copy($,C,{x:j-1,y:0},{x:F-1,y:B},{width:1,height:X}),p.RGBAImage.copy($,C,{x:0,y:0},{x:F+j,y:B},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const f of l){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const v=this.images[f];Nt(v)&&this.updateImage(f,v)}}}const Ft=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(_,l){return function([f,v,C]){const S=p.degToRad(v+90),R=p.degToRad(C);return{x:f*Math.cos(S)*Math.sin(R),y:f*Math.sin(S)*Math.sin(R),z:f*Math.cos(R),azimuthal:v,polar:C}}(_.expression.evaluate(l))}interpolate(_,l,f){return{x:p.number(_.x,l.x,f),y:p.number(_.y,l.y,f),z:p.number(_.z,l.z,f),azimuthal:p.number(_.azimuthal,l.azimuthal,f),polar:p.number(_.polar,l.polar,f)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class Kt extends p.Evented{constructor(l){super(),this._transitionable=new p.Transitionable(Ft),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f={}){if(!this._validate(p.validateLight,l,f))for(const v in l){const C=l[v];p.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),C):this._transitionable.setValue(v,C)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,v){return(!v||!1!==v.validate)&&p.emitValidationErrors(this,l.call(p.validateStyle,p.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const ui=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let gi=class extends p.Evented{constructor(_,l){super(),this._transitionable=new p.Transitionable(ui),this.set(_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(_){for(const l in _){const f=_[l];p.endsWith(l,"-transition")?this._transitionable.setTransition(l.slice(0,-11),f):this._transitionable.setValue(l,f)}}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}};function cr(_,l,f,v){const C=p.smoothstep(45,65,f),[S,R]=No(_,v),F=p.length(l);let B=1-Math.min(1,Math.exp((F-S)/(R-S)*-6));return B*=B*B,B=Math.min(1,1.00747*B),B*C*_.alpha}function No(_,l){const f=.5/Math.tan(.5*l);return[_.range[0]+f,_.range[1]+f]}const Wn=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class ia extends p.Evented{constructor(l,f){super(),this._transitionable=new p.Transitionable(Wn),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const l=this._transform,f="globe"===l.projection.name,v=p.globeToMercatorTransition(l.zoom),C=this.properties.get("range"),S=[.5,3];return{range:f?[p.number(S[0],C[0],v),p.number(S[1],C[1],v)]:C,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,f={}){if(!this._validate(p.validateFog,l,f)){for(const v of Object.keys(p.spec.fog))l&&void 0===l[v]&&(l[v]=p.spec.fog[v].default);for(const v in l){const C=l[v];p.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),C):this._transitionable.setValue(v,C)}}}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,l))*f.a}getOpacityAtLatLng(l,f){return this._transform.projection.supportsFog?function(v,C,S){const R=p.MercatorCoordinate.fromLngLat(C),F=S.elevation?S.elevation.getAtPointOrZero(R):0,B=[R.x,R.y,F];return p.transformMat4(B,B,S.mercatorFogMatrix),cr(v,B,S.pitch,S._fov)}(this.state,l,f):0}getFovAdjustedRange(l){return this._transform.projection.supportsFog?No(this.state,l):[0,1]}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,v){return(!v||!1!==v.validate)&&p.emitValidationErrors(this,l.call(p.validateStyle,p.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Si{constructor(l,f){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const v=this.workerPool.acquire(this.id);for(let C=0;C<v.length;C++){const S=new Si.Actor(v[C],f,this.id);S.name=`Worker ${C}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,f,v){p.asyncAll(this.actors,(C,S)=>{C.send(l,f,S)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function yr(_,l,f){return l*(p.EXTENT/(_.tileSize*Math.pow(2,f-_.tileID.overscaledZ)))}Si.Actor=p.Actor;class ra{constructor(l,f,v,C){this.screenBounds=l,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,C)}static createFromScreenPoints(l,f){let v,C;if(l instanceof p.Point||"number"==typeof l[0]){const S=p.Point.convert(l);v=[S],C=f.isPointAboveHorizon(S)}else{const S=p.Point.convert(l[0]),R=p.Point.convert(l[1]);v=[S,R],C=p.polygonizeBounds(S,R).every(F=>f.isPointAboveHorizon(F))}return new ra(v,f.getCameraPoint(),C,f)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(l){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const f=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],C=p.polygonizeBounds(f,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<v.x?C.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?C[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(C[3]=this.cameraPoint)),p.bufferConvexPolygon(C,l)}bufferedCameraGeometryGlobe(l){const f=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],C=p.polygonizeBounds(f,v,l),S=this.cameraPoint.clone();switch(3*((S.y>f.y)+(S.y>v.y))+((S.x>f.x)+(S.x>v.x))){case 0:C[0]=S,C[4]=S.clone();break;case 1:C.splice(1,0,S);break;case 2:C[1]=S;break;case 3:C.splice(4,0,S);break;case 5:C.splice(2,0,S);break;case 6:C[3]=S;break;case 7:C.splice(3,0,S);break;case 8:C[2]=S}return C}containsTile(l,f,v,C=0){const S=l.queryPadding/f._pixelsPerMercatorPixel+1,R=v?this._bufferedCameraMercator(S,f):this._bufferedScreenMercator(S,f);let F=l.tileID.wrap+(R.unwrapped?C:0);const B=R.polygon.map(ce=>p.getTilePoint(l.tileTransform,ce,F));if(!p.polygonIntersectsBox(B,0,0,p.EXTENT,p.EXTENT))return;F=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?C:0);const $=this.screenGeometryMercator.polygon.map(ce=>p.getTileVec3(l.tileTransform,ce,F)),j=$.map(ce=>new p.Point(ce[0],ce[1])),X=f.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),ee=p.getTileVec3(l.tileTransform,X,F),se=$.map(ce=>{const K=p.sub(ce,ce,ee);return p.normalize(K,K),new p.Ray(ee,K)}),le=yr(l,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:se,bufferedTilespaceGeometry:B,bufferedTilespaceBounds:(ae=p.getBounds(B),ae.min.x=p.clamp(ae.min.x,0,p.EXTENT),ae.min.y=p.clamp(ae.min.y,0,p.EXTENT),ae.max.x=p.clamp(ae.max.x,0,p.EXTENT),ae.max.y=p.clamp(ae.max.y,0,p.EXTENT),ae),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:le};var ae}_bufferedScreenMercator(l,f){const v=Mt(l);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let C;return C="globe"===f.projection.name?this._projectAndResample(this.bufferedScreenGeometry(l),f):{polygon:this.bufferedScreenGeometry(l).map(S=>f.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[v]=C,C}}_bufferedCameraMercator(l,f){const v=Mt(l);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let C;return C="globe"===f.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),f):{polygon:this.bufferedCameraGeometry(l).map(S=>f.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[v]=C,C}}_projectAndResample(l,f){const v=function(S,R){const F=p.multiply([],R.pixelMatrix,R.globeMatrix),B=[0,-p.GLOBE_RADIUS,0,1],$=[0,p.GLOBE_RADIUS,0,1],j=[0,0,0,1];p.transformMat4$1(B,B,F),p.transformMat4$1($,$,F),p.transformMat4$1(j,j,F);const X=new p.Point(B[0]/B[3],B[1]/B[3]),ee=new p.Point($[0]/$[3],$[1]/$[3]),se=p.polygonContainsPoint(S,X)&&B[3]<j[3],le=p.polygonContainsPoint(S,ee)&&$[3]<j[3];if(!se&&!le)return null;const ae=function(Se,ze,Re){for(let Xe=1;Xe<Se.length;Xe++){const At=dt(ze.pointCoordinate3D(Se[Xe-1]).x),Ve=dt(ze.pointCoordinate3D(Se[Xe]).x);if(Re<0){if(At<Ve)return{idx:Xe,t:-At/(Ve-1-At)}}else if(Ve<At)return{idx:Xe,t:(1-At)/(Ve+1-At)}}return null}(S,R,se?-1:1);if(!ae)return null;const{idx:ce,t:K}=ae;let oe=ce>1?st(S.slice(0,ce),R):[],pe=ce<S.length?st(S.slice(ce),R):[];oe=oe.map(Se=>new p.Point(dt(Se.x),Se.y)),pe=pe.map(Se=>new p.Point(dt(Se.x),Se.y));const ge=[...oe];0===ge.length&&ge.push(pe[pe.length-1]);const De=p.number(ge[ge.length-1].y,(0===pe.length?oe[0]:pe[0]).y,K);let Me;return Me=se?[new p.Point(0,De),new p.Point(0,0),new p.Point(1,0),new p.Point(1,De)]:[new p.Point(1,De),new p.Point(1,1),new p.Point(0,1),new p.Point(0,De)],ge.push(...Me),0===pe.length?ge.push(oe[0]):ge.push(...pe),{polygon:ge.map(Se=>new p.MercatorCoordinate(Se.x,Se.y)),unwrapped:!1}}(l,f);if(v)return v;const C=function(S,R){let F=!1,B=-1/0,$=0;for(let X=0;X<S.length-1;X++)S[X].x>B&&(B=S[X].x,$=X);for(let X=0;X<S.length-1;X++){const ee=($+X)%(S.length-1),se=S[ee],le=S[ee+1];Math.abs(se.x-le.x)>.5&&(se.x<le.x?(se.x+=1,0===ee&&(S[S.length-1].x+=1)):(le.x+=1,ee+1===S.length-1&&(S[0].x+=1)),F=!0)}const j=p.mercatorXfromLng(R.center.lng);return F&&j<Math.abs(j-1)&&S.forEach(X=>{X.x-=1}),{polygon:S,unwrapped:F}}(st(l,f).map(S=>new p.Point(dt(S.x),S.y)),f);return{polygon:C.polygon.map(S=>new p.MercatorCoordinate(S.x,S.y)),unwrapped:C.unwrapped}}}function st(_,l){return p.resample(_,f=>{const v=l.pointCoordinate3D(f);f.x=v.x,f.y=v.y},1/256)}function dt(_){return _<0?1+_%1:_%1}function Mt(_){return 100*_|0}function Et(_,l,f,v,C){const S=function(R,F){if(R)return C(R);if(F){_.url&&F.tiles&&_.tiles&&delete _.tiles;const B=p.pick(p.extend(F,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);F.vector_layers&&(B.vectorLayers=F.vector_layers,B.vectorLayerIds=B.vectorLayers.map($=>$.id)),B.tiles=l.canonicalizeTileset(B,_.url),C(null,B)}};return _.url?p.getJSON(l.transformRequest(l.normalizeSourceURL(_.url,null,f,v),p.ResourceType.Source),S):p.exported.frame(()=>S(null,_))}class Zt{constructor(l,f,v){this.bounds=p.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=v||24}validateBounds(l){return Array.isArray(l)&&4===l.length?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const f=Math.pow(2,l.z),v=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*f),C=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*f),S=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*f),R=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=v&&l.x<S&&l.y>=C&&l.y<R}}class _t{constructor(l,f,v){this.context=l;const C=l.gl;this.buffer=C.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const yt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class vt{constructor(l,f,v,C){this.length=f.length,this.attributes=v,this.itemSize=f.bytesPerElement,this.dynamicDraw=C,this.context=l;const S=l.gl;this.buffer=S.createBuffer(),l.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let v=0;v<this.attributes.length;v++){const C=f.attributes[this.attributes[v].name];void 0!==C&&l.enableVertexAttribArray(C)}}setVertexAttribPointers(l,f,v){for(let C=0;C<this.attributes.length;C++){const S=this.attributes[C],R=f.attributes[S.name];void 0!==R&&l.vertexAttribPointer(R,S.components,l[yt[S.type]],!1,this.itemSize,S.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class dn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class yn extends dn{getDefault(){return p.Color.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class ai extends dn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class On extends dn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Yn extends dn{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class ji extends dn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class so extends dn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Pi extends dn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class ur extends dn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class is extends dn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class Bs extends dn{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class xa extends dn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class wo extends dn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Bo extends dn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class Kl extends dn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class $n extends dn{getDefault(){return p.Color.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class ii extends dn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class si extends dn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class Hr extends dn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class zo extends dn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Eo,$i=class extends dn{getDefault(){return null}set(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)}};class ao extends dn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class vs extends dn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Hi extends dn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class oa extends dn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Ei extends dn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Ga extends dn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class be extends dn{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Q extends dn{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class ie extends dn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class _e extends dn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Te extends dn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Oe extends dn{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class Ze extends Oe{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class je extends Oe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Pe extends je{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class tt{constructor(l,f,v,C){this.context=l,this.width=f,this.height=v;const S=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new Ze(l,S),C&&(this.depthAttachment=new je(l,S))}destroy(){const l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){const v=this.depthAttachment.get();v&&l.deleteRenderbuffer(v)}l.deleteFramebuffer(this.framebuffer)}}class Ht{constructor(l,f=!1){if(this.gl=l,this.isWebGL2=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),f){const v=l;this.extVertexArrayObject={createVertexArrayOES:v.createVertexArray.bind(l),deleteVertexArrayOES:v.deleteVertexArray.bind(l),bindVertexArrayOES:v.bindVertexArray.bind(l)}}this.clearColor=new yn(this),this.clearDepth=new ai(this),this.clearStencil=new On(this),this.colorMask=new Yn(this),this.depthMask=new ji(this),this.stencilMask=new so(this),this.stencilFunc=new Pi(this),this.stencilOp=new ur(this),this.stencilTest=new is(this),this.depthRange=new Bs(this),this.depthTest=new xa(this),this.depthFunc=new wo(this),this.blend=new Bo(this),this.blendFunc=new Kl(this),this.blendColor=new $n(this),this.blendEquation=new ii(this),this.cullFace=new si(this),this.cullFaceSide=new Hr(this),this.frontFace=new zo(this),this.program=new $i(this),this.activeTexture=new ao(this),this.viewport=new vs(this),this.bindFramebuffer=new Hi(this),this.bindRenderbuffer=new oa(this),this.bindTexture=new Ei(this),this.bindVertexBuffer=new Ga(this),this.bindElementBuffer=new be(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Q(this),this.pixelStoreUnpack=new ie(this),this.pixelStoreUnpackPremultiplyAlpha=new _e(this),this.pixelStoreUnpackFlipY=new Te(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),f||(this.extTextureHalfFloat=l.getExtension("OES_texture_half_float")),(f||this.extTextureHalfFloat&&l.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=f||l.getExtension("OES_standard_derivatives"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f){return new _t(this,l,f)}createVertexBuffer(l,f,v){return new vt(this,l,f,v)}createRenderbuffer(l,f,v){const C=this.gl,S=C.createRenderbuffer();return this.bindRenderbuffer.set(S),C.renderbufferStorage(C.RENDERBUFFER,l,f,v),this.bindRenderbuffer.set(null),S}createFramebuffer(l,f,v){return new tt(this,l,f,v)}clear({color:l,depth:f,stencil:v}){const C=this.gl;let S=0;l&&(S|=C.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),void 0!==f&&(S|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),void 0!==v&&(S|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),C.clear(S)}setCullFace(l){!1===l.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){ue(l.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Yt extends p.Evented{constructor(l,f,v,C){if(super(),this.id=l,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(f,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(l){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=Et(this._options,this.map._requestManager,f,v,(C,S)=>{this._tileJSONRequest=null,this._loaded=!0,C?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),v&&2!==v.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new p.ErrorEvent(C))):S&&(p.extend(this,S),S.bounds&&(this.tileBounds=new Zt(S.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(S.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(C)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(l,f){const v=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(v,p.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(C.request.collectResourceTiming=this._collectResourceTiming,l.actor&&"expired"!==l.state)"loading"===l.state?l.reloadCallback=f:l.request=l.actor.send("reloadTile",C,S.bind(this));else if(l.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",C,S.bind(this),void 0,!0);else{const R=p.loadVectorTile.call({deduped:this._deduped},C,(F,B)=>{F||!B?S.call(this,F):(C.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},l.actor&&l.actor.send("loadTile",C,S.bind(this),void 0,!0))},!0);l.request={cancel:R}}function S(R,F){return delete l.request,l.aborted?f(null):R&&404!==R.status?f(R):(F&&F.resourceTiming&&(l.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&l.setExpiryData(F),l.loadVectorData(F,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ut extends p.Evented{constructor(l,f,v,C){super(),this.id=l,this.dispatcher=v,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},f),p.extend(this,p.pick(f,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Et(this._options,this.map._requestManager,null,null,(f,v)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new p.ErrorEvent(f)):v&&(p.extend(this,v),v.bounds&&(this.tileBounds=new Zt(v.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(v.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(f)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,f){const v=p.exported.devicePixelRatio>=2,C=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);l.request=p.getImage(this.map._requestManager.transformRequest(C,p.ResourceType.Tile),(S,R,F,B)=>(delete l.request,l.aborted?(l.state="unloaded",f(null)):S?(l.state="errored",f(S)):R?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:F,expires:B}),l.setTexture(R,this.map.painter),l.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null)))}static loadTileData(l,f,v){l.setTexture(f,v)}static unloadTileData(l,f){l.texture&&f.saveTileTexture(l.texture)}abortTile(l,f){l.request&&(l.request.cancel(),delete l.request),f()}unloadTile(l,f){l.texture&&this.map.painter.saveTileTexture(l.texture),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function qn(_,l,f,v,C,S,R,F){const B=[_,f,C,l,v,S,1,1,1],$=[R,F,1],j=p.adjoint([],B),[X,ee,se]=p.transformMat3($,$,p.transpose(j,j));return p.multiply$1(B,[X,0,0,0,ee,0,0,0,se],B)}class Vn extends p.Evented{constructor(l,f,v,C){super(),this.id=l,this.dispatcher=v,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=f,this._dirty=!1}load(l,f){this._loaded=f||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(v,C)=>{if(this._imageRequest=null,this._loaded=!0,v)this.fire(new p.ErrorEvent(v));else if(C){const{HTMLImageElement:S}=p.window;this.image=C instanceof S?p.exported.getImageData(C):C,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading()}})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(l){this.coordinates=l,this._boundsArray=void 0;const f=l.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(v){let C=1/0,S=1/0,R=-1/0,F=-1/0;for(const X of v)C=Math.min(C,X.x),S=Math.min(S,X.y),R=Math.max(R,X.x),F=Math.max(F,X.y);const B=Math.max(R-C,F-S),$=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),j=Math.pow(2,$);return new p.CanonicalTileID($,Math.floor((C+R)/2*j),Math.floor((S+F)/2*j))}(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(l){for(const B in this.tiles){const $=this.tiles[B];"loaded"!==$.state&&($.state="loaded",$.texture=this.texture)}if(this._boundsArray)return;const f=p.tileTransform(this.tileID,this.map.transform.projection),[v,C,S,R]=this.coordinates.map(B=>{const $=f.projection.project(B[0],B[1]);return p.getTilePoint(f,$)._round()});this.perspectiveTransform=function(B,$,j,X,ee,se,le,ae,ce,K){const oe=qn(0,0,B,0,0,$,B,$),pe=qn(j,X,ee,se,le,ae,ce,K);return p.multiply$1(pe,p.adjoint(oe,oe),pe),[pe[6]/pe[8]*B/p.EXTENT,pe[7]/pe[8]*$/p.EXTENT]}(this.width,this.height,v.x,v.y,C.x,C.y,R.x,R.y,S.x,S.y);const F=this._boundsArray=new p.StructArrayLayout4i8;F.emplaceBack(v.x,v.y,0,0),F.emplaceBack(C.x,C.y,p.EXTENT,0),F.emplaceBack(R.x,R.y,0,p.EXTENT),F.emplaceBack(S.x,S.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=l.createVertexBuffer(F,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const l=this.map.painter.context,f=l.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(l,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(l)}loadTile(l,f){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},f(null)):(l.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Xn={vector:Yt,raster:Ut,"raster-dem":class extends Ut{constructor(_,l,f,v){super(_,l,f,v),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(_,l){const f=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(C,S){C&&(_.state="errored",l(C)),S&&(_.dem=S,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",l(null))}_.request=p.getImage(this.map._requestManager.transformRequest(f,p.ResourceType.Tile),function(C,S,R,F){if(delete _.request,_.aborted)_.state="unloaded",l(null);else if(C)_.state="errored",l(C);else if(S){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:R,expires:F});const B=p.window.ImageBitmap&&S instanceof p.window.ImageBitmap&&(null==Eo&&(Eo=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),Eo),$=1-(S.width-p.prevPowerOfTwo(S.width))/2;$<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const j=B?S:p.exported.getImageData(S,$),X={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:j,encoding:this.encoding,padding:$};_.actor&&"expired"!==_.state||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",X,v.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(_){const l=_.canonical,f=Math.pow(2,l.z),v=(l.x-1+f)%f,C=0===l.x?_.wrap-1:_.wrap,S=(l.x+1+f)%f,R=l.x+1===f?_.wrap+1:_.wrap,F={};return F[new p.OverscaledTileID(_.overscaledZ,C,l.z,v,l.y).key]={backfilled:!1},F[new p.OverscaledTileID(_.overscaledZ,R,l.z,S,l.y).key]={backfilled:!1},l.y>0&&(F[new p.OverscaledTileID(_.overscaledZ,C,l.z,v,l.y-1).key]={backfilled:!1},F[new p.OverscaledTileID(_.overscaledZ,_.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},F[new p.OverscaledTileID(_.overscaledZ,R,l.z,S,l.y-1).key]={backfilled:!1}),l.y+1<f&&(F[new p.OverscaledTileID(_.overscaledZ,C,l.z,v,l.y+1).key]={backfilled:!1},F[new p.OverscaledTileID(_.overscaledZ,_.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},F[new p.OverscaledTileID(_.overscaledZ,R,l.z,S,l.y+1).key]={backfilled:!1}),F}unloadTile(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded"}},geojson:class extends p.Evented{constructor(_,l,f,v){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(v),this._data=l.data,this._options=p.extend({},l),this._collectResourceTiming=l.collectResourceTiming,void 0!==l.maxzoom&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const C=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(void 0!==l.buffer?l.buffer:128)*C,tolerance:(void 0!==l.tolerance?l.tolerance:.375)*C,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:void 0!==l.clusterMaxZoom?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==l.clusterRadius?l.clusterRadius:50)*C,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},l),this}getClusterChildren(_,l){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},l),this}getClusterLeaves(_,l,f,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:l,offset:f},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const _=p.extend({},this.workerOptions),l=this._data;"string"==typeof l?(_.request=this.map._requestManager.transformRequest(p.exported.resolveURL(l),p.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(f,v)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new p.ErrorEvent(f));else{const C={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(C.resourceTiming=v.resourceTiming[this.id]),this.fire(new p.Event("data",C)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,l){const f=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(f,{type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(v,C)=>(delete _.request,_.unloadVectorData(),_.aborted?l(null):v?l(v):(_.loadVectorData(C,this.map.painter,"reloadTile"===f),l(null))),void 0,"loadTile"===f)}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Vn{constructor(_,l,f,v){super(_,l,f,v),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const l of _.urls)this.urls.push(this.map._requestManager.transformRequest(l,p.ResourceType.Source).url);p.getVideo(this.urls,(l,f)=>{this._loaded=!0,l?this.fire(new p.ErrorEvent(l)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const l=this.video.seekable;_<l.start(0)||_>l.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const _=this.map.painter.context,l=_.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(_,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Vn,canvas:class extends Vn{constructor(_,l,f,v){super(_,l,f,v),l.coordinates?Array.isArray(l.coordinates)&&4===l.coordinates.length&&!l.coordinates.some(C=>!Array.isArray(C)||2!==C.length||C.some(S=>"number"!=typeof S))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${_}`,null,'missing required property "coordinates"'))),l.animate&&"boolean"!=typeof l.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),l.canvas?"string"==typeof l.canvas||l.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${_}`,null,'missing required property "canvas"'))),this.options=l,this.animate=void 0===l.animate||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const l=this.map.painter.context;this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends p.Evented{constructor(_,l,f,v){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=l,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Zt(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this._map=_,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){const{x:l,y:f,z:v}=_.canonical;return this._implementation.hasTile({x:l,y:f,z:v})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,l){const{x:f,y:v,z:C}=_.tileID.canonical,S=new p.window.AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:f,y:v,z:C},{signal:S.signal})).then(function(R){return delete _.request,_.aborted?(_.state="unloaded",l(null)):void 0===R?(_.state="errored",l(null)):null===R?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",l(null)):(F=R)instanceof p.window.ImageData||F instanceof p.window.HTMLCanvasElement||F instanceof p.window.ImageBitmap||F instanceof p.window.HTMLImageElement?(this.loadTileData(_,R),_.state="loaded",void l(null)):(_.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var F}.bind(this)).catch(R=>{20!==R.code&&(_.state="errored",l(R))}),_.request.cancel=()=>S.abort()}loadTileData(_,l){Ut.loadTileData(_,l,this._map.painter)}unloadTileData(_){Ut.unloadTileData(_,this._map.painter)}unloadTile(_,l){if(this.unloadTileData(_),this._implementation.unloadTile){const{x:f,y:v,z:C}=_.tileID.canonical;this._implementation.unloadTile({x:f,y:v,z:C})}l()}abortTile(_,l){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Hn=function(_,l,f,v){const C=new Xn[l.type](_,l,f,v);if(C.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${C.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],C),C};function ei(_,l){const f=p.identity([]);return p.scale(f,f,[.5*_.width,.5*-_.height,1]),p.translate(f,f,[1,-1,0]),p.multiply(f,f,_.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(f)}function Qn(_,l,f,v,C,S,R,F=!1){const B=_.tilesIn(v,R,F);B.sort(li);const $=[];for(const X of B)$.push({wrappedTileID:X.tile.tileID.wrapped().key,queryResults:X.tile.queryRenderedFeatures(l,f,_._state,X,C,S,ei(_.transform,X.tile.tileID),F)});const j=function(X){const ee={},se={};for(const le of X){const ae=le.queryResults,ce=le.wrappedTileID,K=se[ce]=se[ce]||{};for(const oe in ae){const pe=ae[oe],ge=K[oe]=K[oe]||{},De=ee[oe]=ee[oe]||[];for(const Me of pe)ge[Me.featureIndex]||(ge[Me.featureIndex]=!0,De.push(Me))}}return ee}($);for(const X in j)j[X].forEach(ee=>{const se=ee.feature,le=se.layer;le&&"background"!==le.type&&"sky"!==le.type&&(se.source=le.source,le["source-layer"]&&(se.sourceLayer=le["source-layer"]),se.state=void 0!==se.id?_.getFeatureState(le["source-layer"],se.id):{})});return j}function wr(_,l){const f=_.getRenderableIds().map(S=>_.getTileByID(S)),v=[],C={};for(let S=0;S<f.length;S++){const R=f[S],F=R.tileID.canonical.key;C[F]||(C[F]=!0,R.querySourceFeatures(v,l))}return v}function li(_,l){const f=_.tileID,v=l.tileID;return f.overscaledZ-v.overscaledZ||f.canonical.y-v.canonical.y||f.wrap-v.wrap||f.canonical.x-v.canonical.x}function tr(){return null!=Ka.workerClass?new Ka.workerClass:new p.window.Worker(Ka.workerUrl)}const Vo="mapboxgl_preloaded_worker_pool";class Er{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<Er.workerCount;)this.workers.push(new tr);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],0===this.numActive()&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Vo]}numActive(){return Object.keys(this.active).length}}let lo;function vl(){return lo||(lo=new Er),lo}function uf(_,l){const f={};for(const v in _)"ref"!==v&&(f[v]=_[v]);return p.refProperties.forEach(v=>{v in l&&(f[v]=l[v])}),f}function zs(_){_=_.slice();const l=Object.create(null);for(let f=0;f<_.length;f++)l[_[f].id]=_[f];for(let f=0;f<_.length;f++)"ref"in _[f]&&(_[f]=uf(_[f],l[_[f].ref]));return _}Er.workerCount=2;const pi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Vs(_,l,f){f.push({command:pi.addSource,args:[_,l[_]]})}function co(_,l,f){l.push({command:pi.removeSource,args:[_]}),f[_]=!0}function Ci(_,l,f,v){co(_,f,v),Vs(_,l,f)}function sa(_,l,f){let v;for(v in _[f])if(_[f].hasOwnProperty(v)&&"data"!==v&&!ue(_[f][v],l[f][v]))return!1;for(v in l[f])if(l[f].hasOwnProperty(v)&&"data"!==v&&!ue(_[f][v],l[f][v]))return!1;return!0}function Co(_,l,f,v,C,S){let R;for(R in l=l||{},_=_||{})_.hasOwnProperty(R)&&(ue(_[R],l[R])||f.push({command:S,args:[v,R,l[R],C]}));for(R in l)l.hasOwnProperty(R)&&!_.hasOwnProperty(R)&&(ue(_[R],l[R])||f.push({command:S,args:[v,R,l[R],C]}))}function To(_){return _.id}function Rc(_,l){return _[l.id]=l,_}class rs{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(1===this.points.length)return this.points[0];l=p.clamp(l,0,1);let f=1,v=this._distances[f];const C=l*this.paddedLength+this.padding;for(;v<C&&f<this._distances.length;)v=this._distances[++f];const S=f-1,R=this._distances[S],F=v-R,B=F>0?(C-R)/F:0;return this.points[S].mult(1-B).add(this.points[f].mult(B))}}class Uo{constructor(l,f,v){const C=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(l/v),this.yCellCount=Math.ceil(f/v);for(let R=0;R<this.xCellCount*this.yCellCount;R++)C.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,v,C,S){this._forEachCell(f,v,C,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(C),this.bboxes.push(S)}insertCircle(l,f,v,C){this._forEachCell(f-C,v-C,f+C,v+C,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(v),this.circles.push(C)}_insertBoxCell(l,f,v,C,S,R){this.boxCells[S].push(R)}_insertCircleCell(l,f,v,C,S,R){this.circleCells[S].push(R)}_query(l,f,v,C,S,R){if(v<0||l>this.width||C<0||f>this.height)return!S&&[];const F=[];if(l<=0&&f<=0&&this.width<=v&&this.height<=C){if(S)return!0;for(let B=0;B<this.boxKeys.length;B++)F.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const $=this.circles[3*B],j=this.circles[3*B+1],X=this.circles[3*B+2];F.push({key:this.circleKeys[B],x1:$-X,y1:j-X,x2:$+X,y2:j+X})}return R?F.filter(R):F}return this._forEachCell(l,f,v,C,this._queryCell,F,{hitTest:S,seenUids:{box:{},circle:{}}},R),S?F.length>0:F}_queryCircle(l,f,v,C,S){const R=l-v,F=l+v,B=f-v,$=f+v;if(F<0||R>this.width||$<0||B>this.height)return!C&&[];const j=[];return this._forEachCell(R,B,F,$,this._queryCellCircle,j,{hitTest:C,circle:{x:l,y:f,radius:v},seenUids:{box:{},circle:{}}},S),C?j.length>0:j}query(l,f,v,C,S){return this._query(l,f,v,C,!1,S)}hitTest(l,f,v,C,S){return this._query(l,f,v,C,!0,S)}hitTestCircle(l,f,v,C){return this._queryCircle(l,f,v,!0,C)}_queryCell(l,f,v,C,S,R,F,B){const $=F.seenUids,j=this.boxCells[S];if(null!==j){const ee=this.bboxes;for(const se of j)if(!$.box[se]){$.box[se]=!0;const le=4*se;if(l<=ee[le+2]&&f<=ee[le+3]&&v>=ee[le+0]&&C>=ee[le+1]&&(!B||B(this.boxKeys[se]))){if(F.hitTest)return R.push(!0),!0;R.push({key:this.boxKeys[se],x1:ee[le],y1:ee[le+1],x2:ee[le+2],y2:ee[le+3]})}}}const X=this.circleCells[S];if(null!==X){const ee=this.circles;for(const se of X)if(!$.circle[se]){$.circle[se]=!0;const le=3*se;if(this._circleAndRectCollide(ee[le],ee[le+1],ee[le+2],l,f,v,C)&&(!B||B(this.circleKeys[se]))){if(F.hitTest)return R.push(!0),!0;{const ae=ee[le],ce=ee[le+1],K=ee[le+2];R.push({key:this.circleKeys[se],x1:ae-K,y1:ce-K,x2:ae+K,y2:ce+K})}}}}}_queryCellCircle(l,f,v,C,S,R,F,B){const $=F.circle,j=F.seenUids,X=this.boxCells[S];if(null!==X){const se=this.bboxes;for(const le of X)if(!j.box[le]){j.box[le]=!0;const ae=4*le;if(this._circleAndRectCollide($.x,$.y,$.radius,se[ae+0],se[ae+1],se[ae+2],se[ae+3])&&(!B||B(this.boxKeys[le])))return R.push(!0),!0}}const ee=this.circleCells[S];if(null!==ee){const se=this.circles;for(const le of ee)if(!j.circle[le]){j.circle[le]=!0;const ae=3*le;if(this._circlesCollide(se[ae],se[ae+1],se[ae+2],$.x,$.y,$.radius)&&(!B||B(this.circleKeys[le])))return R.push(!0),!0}}}_forEachCell(l,f,v,C,S,R,F,B){const $=this._convertToXCellCoord(l),j=this._convertToYCellCoord(f),X=this._convertToXCellCoord(v),ee=this._convertToYCellCoord(C);for(let se=$;se<=X;se++)for(let le=j;le<=ee;le++)if(S.call(this,l,f,v,C,this.xCellCount*le+se,R,F,B))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,v,C,S,R){const F=C-l,B=S-f,$=v+R;return $*$>F*F+B*B}_circleAndRectCollide(l,f,v,C,S,R,F){const B=(R-C)/2,$=Math.abs(l-(C+B));if($>B+v)return!1;const j=(F-S)/2,X=Math.abs(f-(S+j));if(X>j+v)return!1;if($<=B||X<=j)return!0;const ee=$-B,se=X-j;return ee*ee+se*se<=v*v}}const os={unknown:0,flipRequired:1,flipNotRequired:2},Za=Math.tan(85*Math.PI/180);function ct(_,l,f,v,C,S,R){const F=p.create();if(f)if("globe"===S.name){const B=p.calculateGlobeLabelMatrix(C,l);p.multiply(F,F,B)}else{const B=Ne([],R);F[0]=B[0],F[1]=B[1],F[4]=B[2],F[5]=B[3],v||p.rotateZ(F,F,C.angle)}else p.multiply(F,C.labelPlaneMatrix,_);return F}function Us(_,l,f,v,C,S,R){const F=ct(_,l,f,v,C,S,R);return"globe"===S.name&&f||(F[2]=F[6]=F[10]=F[14]=0),F}function rr(_,l,f,v,C,S,R){if(f){if("globe"===S.name){const F=ct(_,l,f,v,C,S,R);return p.invert(F,F),p.multiply(F,_,F),F}{const F=p.clone(_),B=p.identity([]);return B[0]=R[0],B[1]=R[1],B[4]=R[2],B[5]=R[3],p.multiply(F,F,B),v||p.rotateZ(F,F,-C.angle),F}}return C.glCoordMatrix}function Cr(_,l,f,v){const C=[_,l,f,1];f?p.transformMat4$1(C,C,v):ci(C,C,v);const S=C[3];return C[0]/=S,C[1]/=S,C[2]/=S,C}function Jl(_,l){return Math.min(.5+_/l*.5,1.5)}function jo(_,l){const f=_[0]/_[3],v=_[1]/_[3];return f>=-l[0]&&f<=l[0]&&v>=-l[1]&&v<=l[1]}function Vd(_,l,f,v,C,S,R,F,B,$){const j=f.transform,X=v?_.textSizeData:_.iconSizeData,ee=p.evaluateSizeForZoom(X,f.transform.zoom),se="globe"===j.projection.name,le=[256/f.width*2+1,256/f.height*2+1],ae=v?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ae.clear();let ce=null;se&&(ce=v?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);const K=_.lineVertexArray,oe=v?_.text.placedSymbolArray:_.icon.placedSymbolArray,pe=f.transform.width/f.transform.height;let ge,De=!1;for(let Me=0;Me<oe.length;Me++){const Se=oe.get(Me),{numGlyphs:ze,writingMode:Re}=Se;if(Re!==p.WritingMode.vertical||De||ge===p.WritingMode.horizontal||(De=!0),ge=Re,(Se.hidden||Re===p.WritingMode.vertical)&&!De){bs(ze,ae);continue}De=!1;const Xe=new p.Point(Se.tileAnchorX,Se.tileAnchorY);let{x:At,y:Ve,z:mt}=j.projection.projectTilePoint(Xe.x,Xe.y,$.canonical);if(B){const[Rn,an,xn]=B(Xe);At+=Rn,Ve+=an,mt+=xn}const nt=[At,Ve,mt,1];if(p.transformMat4$1(nt,nt,l),!jo(nt,le)){bs(ze,ae);continue}const bt=Jl(f.transform.cameraToCenterDistance,nt[3]),He=p.evaluateSizeForFeature(X,ee,Se),ut=R?He/bt:He*bt,Lt=Cr(At,Ve,mt,C);if(Lt[3]<=0){bs(ze,ae);continue}let gt={};const wt=R?null:B,bn=en(Se,ut,!1,F,l,C,S,_.glyphOffsetArray,K,ae,ce,Lt,Xe,gt,pe,wt,j.projection,$,R);De=bn.useVertical,wt&&bn.needsFlipping&&(gt={}),(bn.notEnoughRoom||De||bn.needsFlipping&&en(Se,ut,!0,F,l,C,S,_.glyphOffsetArray,K,ae,ce,Lt,Xe,gt,pe,wt,j.projection,$,R).notEnoughRoom)&&bs(ze,ae)}v?(_.text.dynamicLayoutVertexBuffer.updateData(ae),ce&&_.text.globeExtVertexBuffer.updateData(ce)):(_.icon.dynamicLayoutVertexBuffer.updateData(ae),ce&&_.icon.globeExtVertexBuffer.updateData(ce))}function wa(_,l,f,v,C,S,R,F,B,$,j,X,ee,se,le,ae){const{lineStartIndex:ce,glyphStartIndex:K,segment:oe}=F,pe=K+F.numGlyphs,ge=ce+F.lineLength,De=l.getoffsetX(K),Me=l.getoffsetX(pe-1),Se=$o(_*De,f,v,C,S,R,oe,ce,ge,B,$,j,X,ee,!0,se,le,ae);if(!Se)return null;const ze=$o(_*Me,f,v,C,S,R,oe,ce,ge,B,$,j,X,ee,!0,se,le,ae);return ze?{first:Se,last:ze}:null}function Ql(_,l,f,v){return _===p.WritingMode.horizontal&&Math.abs(v)>Math.abs(f)?{useVertical:!0}:_===p.WritingMode.vertical?v>0?{needsFlipping:!0}:null:l!==os.unknown&&(0===(C=f)||Math.abs(v/C)>Za)?l===os.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null;var C}function en(_,l,f,v,C,S,R,F,B,$,j,X,ee,se,le,ae,ce,K,oe){const pe=l/24,ge=_.lineOffsetX*pe,De=_.lineOffsetY*pe,{lineStartIndex:Me,glyphStartIndex:Se,numGlyphs:ze,segment:Re,writingMode:Xe,flipState:At}=_,Ve=Me+_.lineLength,mt=nt=>{if(j){const[Lt,gt,wt]=nt.up,bn=$.length;p.updateGlobeVertexNormal(j,bn+0,Lt,gt,wt),p.updateGlobeVertexNormal(j,bn+1,Lt,gt,wt),p.updateGlobeVertexNormal(j,bn+2,Lt,gt,wt),p.updateGlobeVertexNormal(j,bn+3,Lt,gt,wt)}const[bt,He,ut]=nt.point;p.addDynamicAttributes($,bt,He,ut,nt.angle)};if(ze>1){const nt=wa(pe,F,ge,De,f,X,ee,_,B,S,se,ae,!1,ce,K,oe);if(!nt)return{notEnoughRoom:!0};if(v&&!f){let[bt,He,ut]=nt.first.point,[Lt,gt,wt]=nt.last.point;[bt,He]=Cr(bt,He,ut,R),[Lt,gt]=Cr(Lt,gt,wt,R);const bn=Ql(Xe,At,(Lt-bt)*le,gt-He);if(_.flipState=bn&&bn.needsFlipping?os.flipRequired:os.flipNotRequired,bn)return bn}mt(nt.first);for(let bt=Se+1;bt<Se+ze-1;bt++){const He=$o(pe*F.getoffsetX(bt),ge,De,f,X,ee,Re,Me,Ve,B,S,se,ae,!1,!1,ce,K,oe);if(!He)return $.length-=4*(bt-Se),{notEnoughRoom:!0};mt(He)}mt(nt.last)}else{if(v&&!f){const bt=Cr(ee.x,ee.y,0,C),He=Me+Re+1,ut=new p.Point(B.getx(He),B.gety(He)),Lt=Cr(ut.x,ut.y,0,C),gt=Lt[3]>0?Lt:ti(ee,ut,bt,1,C,void 0,ce,K.canonical),wt=Ql(Xe,At,(gt[0]-bt[0])*le,gt[1]-bt[1]);if(_.flipState=wt&&wt.needsFlipping?os.flipRequired:os.flipNotRequired,wt)return wt}const nt=$o(pe*F.getoffsetX(Se),ge,De,f,X,ee,Re,Me,Ve,B,S,se,ae,!1,!1,ce,K,oe);if(!nt)return{notEnoughRoom:!0};mt(nt)}return{}}function Ln(_,l,f,v,C){const{x:S,y:R,z:F}=v.projectTilePoint(_.x,_.y,l);if(!C)return Cr(S,R,F,f);const[B,$,j]=C(_);return Cr(S+B,R+$,F+j,f)}function ti(_,l,f,v,C,S,R,F){const B=Ln(_.sub(l)._unit()._add(_),F,C,R,S);return p.sub(B,f,B),p.normalize(B,B),p.scaleAndAdd(B,f,B,v)}function $o(_,l,f,v,C,S,R,F,B,$,j,X,ee,se,le,ae,ce,K){const oe=v?_-l:_+l;let pe=oe>0?1:-1,ge=0;v&&(pe*=-1,ge=Math.PI),pe<0&&(ge+=Math.PI);let De=F+R+(pe>0?0:1)|0,Me=C,Se=C,ze=0,Re=0;const Xe=Math.abs(oe),At=[],Ve=[];let mt=S,nt=mt;const bt=()=>ti(nt,mt,Se,Xe-ze+1,j,ee,ae,ce.canonical);for(;ze+Re<=Xe;){if(De+=pe,De<F||De>=B)return null;if(Se=Me,nt=mt,At.push(Se),se&&Ve.push(nt),mt=new p.Point($.getx(De),$.gety(De)),Me=X[De],!Me){const xn=Ln(mt,ce.canonical,j,ae,ee);Me=xn[3]>0?X[De]=xn:bt()}ze+=Re,Re=p.distance(Se,Me)}le&&ee&&(X[De]&&(Me=bt(),Re=p.distance(Se,Me)),X[De]=Me);const He=(Xe-ze)/Re,ut=mt.sub(nt)._mult(He)._add(nt),Lt=p.sub([],Me,Se),gt=p.scaleAndAdd([],Se,Lt,He);let wt=[0,0,1],bn=Lt[0],Rn=Lt[1];if(K&&(wt=ae.upVector(ce.canonical,ut.x,ut.y),0!==wt[0]||0!==wt[1]||1!==wt[2])){const xn=[wt[2],0,-wt[0]],Jn=p.cross([],wt,xn);p.normalize(xn,xn),p.normalize(Jn,Jn),bn=p.dot(Lt,xn),Rn=p.dot(Lt,Jn)}if(f){const xn=p.cross([],wt,Lt);p.normalize(xn,xn),p.scaleAndAdd(gt,gt,xn,f*pe)}const an=ge+Math.atan2(Rn,bn);return At.push(gt),se&&Ve.push(ut),{point:gt,angle:an,path:At,tilePath:Ve,up:wt}}function bs(_,l){const f=l.length,v=f+4*_;l.resize(v),l.float32.fill(-1/0,4*f,4*v)}function ci(_,l,f){const v=l[0],C=l[1];return _[0]=f[0]*v+f[4]*C+f[12],_[1]=f[1]*v+f[5]*C+f[13],_[3]=f[3]*v+f[7]*C+f[15],_}const mo=100;class bl{constructor(l,f,v=new Uo(l.width+200,l.height+200,25),C=new Uo(l.width+200,l.height+200,25)){this.transform=l,this.grid=v,this.ignoredGrid=C,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+mo,this.screenBottomBoundary=l.height+mo,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=f}placeCollisionBox(l,f,v,C,S,R,F,B){let $=v.projectedAnchorX,j=v.projectedAnchorY,X=v.projectedAnchorZ;const ee=v.elevation,se=v.tileID,le=l.getProjection();if(ee&&se){const[Me,Se,ze]=le.upVector(se.canonical,v.tileAnchorX,v.tileAnchorY),Re=le.upVectorScale(se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;$+=Me*ee*Re,j+=Se*ee*Re,X+=ze*ee*Re}const ae=this.projectAndGetPerspectiveRatio(F,$,j,X,v.tileID,"globe"===le.name||!!ee||this.transform.pitch>0,le),ce=R*ae.perspectiveRatio,K=(v.x1*f+C.x-v.padding)*ce+ae.point.x,oe=(v.y1*f+C.y-v.padding)*ce+ae.point.y,pe=(v.x2*f+C.x+v.padding)*ce+ae.point.x,ge=(v.y2*f+C.y+v.padding)*ce+ae.point.y,De=ae.perspectiveRatio<=.55||ae.occluded;return!this.isInsideGrid(K,oe,pe,ge)||!S&&this.grid.hitTest(K,oe,pe,ge,B)||De?{box:[],offscreen:!1,occluded:ae.occluded}:{box:[K,oe,pe,ge],offscreen:this.isOffscreen(K,oe,pe,ge),occluded:!1}}placeCollisionCircles(l,f,v,C,S,R,F,B,$,j,X,ee,se,le,ae){const ce=[],K=this.transform.elevation,oe=l.getProjection(),pe=K?K.getAtTileOffsetFunc(ae,this.transform.center.lat,this.transform.worldSize,oe):null,ge=new p.Point(v.tileAnchorX,v.tileAnchorY);let{x:De,y:Me,z:Se}=oe.projectTilePoint(ge.x,ge.y,ae.canonical);if(pe){const[ut,Lt,gt]=pe(ge);De+=ut,Me+=Lt,Se+=gt}const ze="globe"===oe.name,Re=this.projectAndGetPerspectiveRatio(F,De,Me,Se,ae,ze||!!K||this.transform.pitch>0,oe),{perspectiveRatio:Xe}=Re,At=(X?R/Xe:R*Xe)/p.ONE_EM,Ve=Cr(De,Me,Se,B),mt=Re.signedDistanceFromCamera>0?wa(At,S,v.lineOffsetX*At,v.lineOffsetY*At,!1,Ve,ge,v,C,B,{},K&&!X?pe:null,X&&!!K,oe,ae,X):null;let nt=!1,bt=!1,He=!0;if(mt&&!Re.occluded){const ut=.5*se*Xe+le,Lt=new p.Point(-100,-100),gt=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),wt=new rs,{first:bn,last:Rn}=mt,an=bn.path.length;let xn=[];for(let ln=an-1;ln>=1;ln--)xn.push(bn.path[ln]);for(let ln=1;ln<Rn.path.length;ln++)xn.push(Rn.path[ln]);const Jn=2.5*ut;$&&(xn=xn.map(([ln,Oi,ri],Wi)=>(pe&&!ze&&(ri=pe(Wi<an-1?bn.tilePath[an-1-Wi]:Rn.tilePath[Wi-an+2])[2]),Cr(ln,Oi,ri,$))),xn.some(ln=>ln[3]<=0)&&(xn=[]));let An=[];if(xn.length>0){let ln=1/0,Oi=-1/0,ri=1/0,Wi=-1/0;for(const Ni of xn)ln=Math.min(ln,Ni[0]),ri=Math.min(ri,Ni[1]),Oi=Math.max(Oi,Ni[0]),Wi=Math.max(Wi,Ni[1]);Oi>=Lt.x&&ln<=gt.x&&Wi>=Lt.y&&ri<=gt.y&&(An=[xn.map(Ni=>new p.Point(Ni[0],Ni[1]))],(ln<Lt.x||Oi>gt.x||ri<Lt.y||Wi>gt.y)&&(An=p.clipLine(An,Lt.x,Lt.y,gt.x,gt.y)))}for(const ln of An){wt.reset(ln,.25*ut);let Oi=0;Oi=wt.length<=.5*ut?1:Math.ceil(wt.paddedLength/Jn)+1;for(let ri=0;ri<Oi;ri++){const Wi=ri/Math.max(Oi-1,1),Ni=wt.lerp(Wi),Pr=Ni.x+mo,qr=Ni.y+mo;ce.push(Pr,qr,ut,0);const jn=Pr-ut,Oo=qr-ut,Bi=Pr+ut,_i=qr+ut;if(He=He&&this.isOffscreen(jn,Oo,Bi,_i),bt=bt||this.isInsideGrid(jn,Oo,Bi,_i),!f&&this.grid.hitTestCircle(Pr,qr,ut,ee)&&(nt=!0,!j))return{circles:[],offscreen:!1,collisionDetected:nt,occluded:!1}}}}return{circles:!j&&nt||!bt?[]:ce,offscreen:He,collisionDetected:nt,occluded:Re.occluded}}queryRenderedSymbols(l){if(0===l.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const f=[];let v=1/0,C=1/0,S=-1/0,R=-1/0;for(const j of l){const X=new p.Point(j.x+mo,j.y+mo);v=Math.min(v,X.x),C=Math.min(C,X.y),S=Math.max(S,X.x),R=Math.max(R,X.y),f.push(X)}const F=this.grid.query(v,C,S,R).concat(this.ignoredGrid.query(v,C,S,R)),B={},$={};for(const j of F){const X=j.key;if(void 0===B[X.bucketInstanceId]&&(B[X.bucketInstanceId]={}),B[X.bucketInstanceId][X.featureIndex])continue;const ee=[new p.Point(j.x1,j.y1),new p.Point(j.x2,j.y1),new p.Point(j.x2,j.y2),new p.Point(j.x1,j.y2)];p.polygonIntersectsPolygon(f,ee)&&(B[X.bucketInstanceId][X.featureIndex]=!0,void 0===$[X.bucketInstanceId]&&($[X.bucketInstanceId]=[]),$[X.bucketInstanceId].push(X.featureIndex))}return $}insertCollisionBox(l,f,v,C,S){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:C,collisionGroupID:S},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,v,C,S){const R=f?this.ignoredGrid:this.grid,F={bucketInstanceId:v,featureIndex:C,collisionGroupID:S};for(let B=0;B<l.length;B+=4)R.insertCircle(F,l[B],l[B+1],l[B+2])}projectAndGetPerspectiveRatio(l,f,v,C,S,R,F){const B=[f,v,C,1];let $=!1;C||this.transform.pitch>0?(p.transformMat4$1(B,B,l),this.fogState&&S&&"globe"!==F.name&&($=function(ee,se,le,ae,ce,K){const oe=K.calculateFogTileMatrix(ce),pe=[se,le,ae];return p.transformMat4(pe,pe,oe),cr(ee,pe,K.pitch,K._fov)}(this.fogState,f,v,C,S.toUnwrapped(),this.transform)>.9)):ci(B,B,l);const j=B[3];return{point:new p.Point((B[0]/j+1)/2*this.transform.width+mo,(-B[1]/j+1)/2*this.transform.height+mo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(F)/j*.5,1.5),signedDistanceFromCamera:j,occluded:R&&B[2]>j||$}}isOffscreen(l,f,v,C){return v<mo||l>=this.screenRightBoundary||C<mo||f>this.screenBottomBoundary}isInsideGrid(l,f,v,C){return v>=0&&l<this.gridRightBoundary&&C>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=p.identity([]);return p.translate(l,l,[-100,-100,0]),l}}function Ea(_,l,f){const v=l.createTileMatrix(_,_.worldSize,f.toUnwrapped());return p.multiply(new Float32Array(16),_.projMatrix,v)}function xs(_,l,f){if(l.projection.name===f.projection.name)return _.projMatrix;const v=f.clone();return v.setProjection(l.projection),Ea(v,l.getProjection(),_)}function or(_,l,f){return l.name===f.projection.name?_.projMatrix:Ea(f,l,_)}class ss{constructor(l,f,v,C){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):C&&v?1:0,this.placed=v}isHidden(){return 0===this.opacity&&!this.placed}}class ye{constructor(l,f,v,C,S,R=!1){this.text=new ss(l?l.text:null,f,v,S),this.icon=new ss(l?l.icon:null,f,C,S),this.clipped=R}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class at{constructor(l,f,v,C=!1){this.text=l,this.icon=f,this.skipFade=v,this.clipped=C}}class Dt{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class We{constructor(l,f,v,C,S){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=v,this.bucketIndex=C,this.tileID=S}}class zt{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:v=>v.collisionGroupID===f}}return this.collisionGroups[l]}}function nn(_,l,f,v,C){const{horizontalAlign:S,verticalAlign:R}=p.getAnchorAlignment(_),F=-(S-.5)*l,B=-(R-.5)*f,$=p.evaluateVariableOffset(_,v);return new p.Point(F+$[0]*C,B+$[1]*C)}function Zn(_,l,f,v,C){const S=new p.Point(_,l);return f&&S._rotate(v?C:-C),S}class dr{constructor(l,f,v,C,S){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new bl(this.transform,S),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new zt(v),this.collisionCircleArrays={},this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,f,v,C){const S=v.getBucket(f),R=v.latestFeatureIndex;if(!S||!R||f.id!==S.layerIds[0])return;const F=S.layers[0].layout,B=v.collisionBoxArray,$=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),j=v.tileSize/p.EXTENT,X=v.tileID.toUnwrapped();this.transform.setProjection(S.projection);const ee=(se=v.tileID,le=S.getProjection(),ae=this.transform,le.name===this.projection?ae.calculateProjMatrix(se.toUnwrapped()):Ea(ae,le,se));var se,le,ae;const ce="map"===F.get("text-pitch-alignment"),K="map"===F.get("text-rotation-alignment");f.compileFilter();const oe=f.dynamicFilter(),pe=f.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(v),De=Us(ee,v.tileID.canonical,ce,K,this.transform,S.getProjection(),ge);let Me=null;if(ce){const Re=rr(ee,v.tileID.canonical,ce,K,this.transform,S.getProjection(),ge);Me=p.multiply([],this.transform.labelPlaneMatrix,Re)}let Se=null;oe&&v.latestFeatureIndex&&(Se={unwrappedTileID:X,dynamicFilter:oe,dynamicFilterNeedsFeature:pe,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[S.bucketInstanceId]=new We(S.bucketInstanceId,R,S.sourceLayerIndex,S.index,v.tileID);const ze={bucket:S,layout:F,posMatrix:ee,textLabelPlaneMatrix:De,labelToScreenMatrix:Me,clippingData:Se,scale:$,textPixelRatio:j,holdingForFade:v.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(S.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(C)for(const Re of S.sortKeyRanges){const{sortKey:Xe,symbolInstanceStart:At,symbolInstanceEnd:Ve}=Re;l.push({sortKey:Xe,symbolInstanceStart:At,symbolInstanceEnd:Ve,parameters:ze})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:ze})}attemptAnchorPlacement(l,f,v,C,S,R,F,B,$,j,X,ee,se,le,ae,ce,K,oe){const{textOffset0:pe,textOffset1:ge,crossTileID:De}=ee,Me=[pe,ge],Se=nn(l,v,C,Me,S),ze=this.collisionIndex.placeCollisionBox(le,S,f,Zn(Se.x,Se.y,R,F,this.transform.angle),X,B,$,j.predicate);if(ce){const Re=le.getSymbolInstanceIconSize(oe,this.transform.zoom,ee.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(le,Re,ce,Zn(Se.x,Se.y,R,F,this.transform.angle),X,B,$,j.predicate).box.length)return}if(ze.box.length>0){let Re;return this.prevPlacement&&this.prevPlacement.variableOffsets[De]&&this.prevPlacement.placements[De]&&this.prevPlacement.placements[De].text&&(Re=this.prevPlacement.variableOffsets[De].anchor),this.variableOffsets[De]={textOffset:Me,width:v,height:C,anchor:l,textScale:S,prevAnchor:Re},this.markUsedJustification(le,l,ee,ae),le.allowVerticalPlacement&&(this.markUsedOrientation(le,ae,ee),this.placedOrientations[De]=ae),{shift:Se,placedGlyphBoxes:ze}}}placeLayerBucketPart(l,f,v,C){const{bucket:S,layout:R,posMatrix:F,textLabelPlaneMatrix:B,labelToScreenMatrix:$,clippingData:j,textPixelRatio:X,holdingForFade:ee,collisionBoxArray:se,partiallyEvaluatedTextSize:le,partiallyEvaluatedIconSize:ae,collisionGroup:ce}=l.parameters,K=R.get("text-optional"),oe=R.get("icon-optional"),pe=R.get("text-allow-overlap"),ge=R.get("icon-allow-overlap"),De="map"===R.get("text-rotation-alignment"),Me="map"===R.get("text-pitch-alignment"),Se="none"!==R.get("icon-text-fit"),ze="viewport-y"===R.get("symbol-z-order");this.transform.setProjection(S.projection);let Re=pe&&(ge||!S.hasIconData()||oe),Xe=ge&&(pe||!S.hasTextData()||K);!S.collisionArrays&&se&&S.deserializeCollisionBoxes(se),v&&C&&S.updateCollisionDebugBuffers(this.transform.zoom,se);const At=(Ve,mt,nt)=>{const{crossTileID:bt,numVerticalGlyphVertices:He}=Ve;if(j){const Bi={zoom:this.transform.zoom,pitch:this.transform.pitch};let _i=null;if(j.dynamicFilterNeedsFeature){const yi=this.retainedQueryData[S.bucketInstanceId];_i=j.featureIndex.loadFeature({featureIndex:Ve.featureIndex,bucketIndex:yi.bucketIndex,sourceLayerIndex:yi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,j.dynamicFilter)(Bi,_i,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new p.Point(Ve.tileAnchorX,Ve.tileAnchorY),this.transform.calculateDistanceTileData(j.unwrappedTileID)))return this.placements[bt]=new at(!1,!1,!1,!0),void f.add(bt)}if(f.has(bt))return;if(ee)return void(this.placements[bt]=new at(!1,!1,!1));let ut=!1,Lt=!1,gt=!0,wt=!1,bn=!1,Rn=null,an={box:null,offscreen:null,occluded:null},xn={box:null,offscreen:null,occluded:null},Jn=null,An=null,ln=null,Oi=0,ri=0,Wi=0;nt.textFeatureIndex?Oi=nt.textFeatureIndex:Ve.useRuntimeCollisionCircles&&(Oi=Ve.featureIndex),nt.verticalTextFeatureIndex&&(ri=nt.verticalTextFeatureIndex);const Ni=Bi=>{Bi.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const _i=this.transform.elevation;(_i||Bi.elevation)&&(Bi.elevation=_i?_i.getAtTileOffset(Bi.tileID,Bi.tileAnchorX,Bi.tileAnchorY):0)},Pr=nt.textBox;if(Pr){Ni(Pr);const Bi=yi=>{let Or=p.WritingMode.horizontal;if(S.allowVerticalPlacement&&!yi&&this.prevPlacement){const pr=this.prevPlacement.placedOrientations[bt];pr&&(this.placedOrientations[bt]=pr,Or=pr,this.markUsedOrientation(S,Or,Ve))}return Or},_i=(yi,Or)=>{if(S.allowVerticalPlacement&&He>0&&nt.verticalTextBox){for(const pr of S.writingModes)if(pr===p.WritingMode.vertical?(an=Or(),xn=an):an=yi(),an&&an.box&&an.box.length)break}else an=yi()};if(R.get("text-variable-anchor")){let yi=R.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[bt]){const Ri=this.prevPlacement.variableOffsets[bt];yi.indexOf(Ri.anchor)>0&&(yi=yi.filter(us=>us!==Ri.anchor),yi.unshift(Ri.anchor))}const Or=(Ri,us,ua)=>{const Yc=S.getSymbolInstanceTextSize(le,Ve,this.transform.zoom,mt),ed=(Ri.x2-Ri.x1)*Yc+2*Ri.padding,Ja=(Ri.y2-Ri.y1)*Yc+2*Ri.padding,ac=Se&&!ge?us:null;ac&&Ni(ac);let lc={box:[],offscreen:!1,occluded:!1};const Tf=pe?2*yi.length:yi.length;for(let da=0;da<Tf;++da){const ah=this.attemptAnchorPlacement(yi[da%yi.length],Ri,ed,Ja,Yc,De,Me,X,F,ce,da>=yi.length,Ve,mt,S,ua,ac,le,ae);if(ah&&(lc=ah.placedGlyphBoxes,lc&&lc.box&&lc.box.length)){ut=!0,Rn=ah.shift;break}}return lc};_i(()=>Or(Pr,nt.iconBox,p.WritingMode.horizontal),()=>{const Ri=nt.verticalTextBox;return Ri&&Ni(Ri),S.allowVerticalPlacement&&!(an&&an.box&&an.box.length)&&He>0&&Ri?Or(Ri,nt.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),an&&(ut=an.box,gt=an.offscreen,wt=an.occluded);const pr=Bi(!(!an||!an.box));if(!ut&&this.prevPlacement){const Ri=this.prevPlacement.variableOffsets[bt];Ri&&(this.variableOffsets[bt]=Ri,this.markUsedJustification(S,Ri.anchor,Ve,pr))}}else{const yi=(Or,pr)=>{const Ri=S.getSymbolInstanceTextSize(le,Ve,this.transform.zoom,mt),us=this.collisionIndex.placeCollisionBox(S,Ri,Or,new p.Point(0,0),pe,X,F,ce.predicate);return us&&us.box&&us.box.length&&(this.markUsedOrientation(S,pr,Ve),this.placedOrientations[bt]=pr),us};_i(()=>yi(Pr,p.WritingMode.horizontal),()=>{const Or=nt.verticalTextBox;return S.allowVerticalPlacement&&He>0&&Or?(Ni(Or),yi(Or,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Bi(!!(an&&an.box&&an.box.length))}}if(Jn=an,ut=Jn&&Jn.box&&Jn.box.length>0,gt=Jn&&Jn.offscreen,wt=Jn&&Jn.occluded,Ve.useRuntimeCollisionCircles){const Bi=S.text.placedSymbolArray.get(Ve.centerJustifiedTextSymbolIndex>=0?Ve.centerJustifiedTextSymbolIndex:Ve.verticalPlacedTextSymbolIndex),_i=p.evaluateSizeForFeature(S.textSizeData,le,Bi),yi=R.get("text-padding");An=this.collisionIndex.placeCollisionCircles(S,pe,Bi,S.lineVertexArray,S.glyphOffsetArray,_i,F,B,$,v,Me,ce.predicate,Ve.collisionCircleDiameter*_i/p.ONE_EM,yi,this.retainedQueryData[S.bucketInstanceId].tileID),ut=pe||An.circles.length>0&&!An.collisionDetected,gt=gt&&An.offscreen,wt=An.occluded}if(nt.iconFeatureIndex&&(Wi=nt.iconFeatureIndex),nt.iconBox){const Bi=_i=>{Ni(_i);const yi=Se&&Rn?Zn(Rn.x,Rn.y,De,Me,this.transform.angle):new p.Point(0,0),Or=S.getSymbolInstanceIconSize(ae,this.transform.zoom,Ve.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,Or,_i,yi,ge,X,F,ce.predicate)};xn&&xn.box&&xn.box.length&&nt.verticalIconBox?(ln=Bi(nt.verticalIconBox),Lt=ln.box.length>0):(ln=Bi(nt.iconBox),Lt=ln.box.length>0),gt=gt&&ln.offscreen,bn=ln.occluded}const qr=K||0===Ve.numHorizontalGlyphVertices&&0===He,jn=oe||0===Ve.numIconVertices;if(qr||jn?jn?qr||(Lt=Lt&&ut):ut=Lt&&ut:Lt=ut=Lt&&ut,ut&&Jn&&Jn.box&&this.collisionIndex.insertCollisionBox(Jn.box,R.get("text-ignore-placement"),S.bucketInstanceId,xn&&xn.box&&ri?ri:Oi,ce.ID),Lt&&ln&&this.collisionIndex.insertCollisionBox(ln.box,R.get("icon-ignore-placement"),S.bucketInstanceId,Wi,ce.ID),An&&(ut&&this.collisionIndex.insertCollisionCircles(An.circles,R.get("text-ignore-placement"),S.bucketInstanceId,Oi,ce.ID),v)){const Bi=S.bucketInstanceId;let _i=this.collisionCircleArrays[Bi];void 0===_i&&(_i=this.collisionCircleArrays[Bi]=new Dt);for(let yi=0;yi<An.circles.length;yi+=4)_i.circles.push(An.circles[yi+0]),_i.circles.push(An.circles[yi+1]),_i.circles.push(An.circles[yi+2]),_i.circles.push(An.collisionDetected?1:0)}const Oo="globe"!==S.projection.name;Re=Re&&(Oo||!wt),Xe=Xe&&(Oo||!bn),this.placements[bt]=new at(ut||Re,Lt||Xe,gt||S.justReloaded),f.add(bt)};if(ze){const Ve=S.getSortedSymbolIndexes(this.transform.angle);for(let mt=Ve.length-1;mt>=0;--mt){const nt=Ve[mt];At(S.symbolInstances.get(nt),nt,S.collisionArrays[nt])}}else for(let Ve=l.symbolInstanceStart;Ve<l.symbolInstanceEnd;Ve++)At(S.symbolInstances.get(Ve),Ve,S.collisionArrays[Ve]);if(v&&S.bucketInstanceId in this.collisionCircleArrays){const Ve=this.collisionCircleArrays[S.bucketInstanceId];p.invert(Ve.invProjMatrix,F),Ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(l,f,v,C){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:F,verticalPlacedTextSymbolIndex:B,crossTileID:$}=v,j=p.getAnchorJustification(f),X=C===p.WritingMode.vertical?B:"left"===j?S:"center"===j?R:"right"===j?F:-1;S>=0&&(l.text.placedSymbolArray.get(S).crossTileID=X>=0&&S!==X?0:$),R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=X>=0&&R!==X?0:$),F>=0&&(l.text.placedSymbolArray.get(F).crossTileID=X>=0&&F!==X?0:$),B>=0&&(l.text.placedSymbolArray.get(B).crossTileID=X>=0&&B!==X?0:$)}markUsedOrientation(l,f,v){const C=f===p.WritingMode.horizontal||f===p.WritingMode.horizontalOnly?f:0,S=f===p.WritingMode.vertical?f:0,{leftJustifiedTextSymbolIndex:R,centerJustifiedTextSymbolIndex:F,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:$}=v,j=l.text.placedSymbolArray;R>=0&&(j.get(R).placedOrientation=C),F>=0&&(j.get(F).placedOrientation=C),B>=0&&(j.get(B).placedOrientation=C),$>=0&&(j.get($).placedOrientation=S)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let v=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const C=f?f.symbolFadeChange(l):1,S=f?f.opacities:{},R=f?f.variableOffsets:{},F=f?f.placedOrientations:{};for(const B in this.placements){const $=this.placements[B],j=S[B];j?(this.opacities[B]=new ye(j,C,$.text,$.icon,null,$.clipped),v=v||$.text!==j.text.placed||$.icon!==j.icon.placed):(this.opacities[B]=new ye(null,C,$.text,$.icon,$.skipFade,$.clipped),v=v||$.text||$.icon)}for(const B in S){const $=S[B];if(!this.opacities[B]){const j=new ye($,C,!1,!1);j.isHidden()||(this.opacities[B]=j,v=v||$.text.placed||$.icon.placed)}}for(const B in R)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=R[B]);for(const B in F)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=F[B]);v?this.lastPlacementChangeTime=l:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f){const v=new Set;for(const C of f){const S=C.getBucket(l);S&&C.latestFeatureIndex&&l.id===S.layerIds[0]&&this.updateBucketOpacities(S,v,C.collisionBoxArray)}}updateBucketOpacities(l,f,v){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const C=l.layers[0].layout,S=!!l.layers[0].dynamicFilter(),R=new ye(null,0,!1,!1,!0),F=C.get("text-allow-overlap"),B=C.get("icon-allow-overlap"),$=C.get("text-variable-anchor"),j="map"===C.get("text-rotation-alignment"),X="map"===C.get("text-pitch-alignment"),ee="none"!==C.get("icon-text-fit"),se=new ye(null,0,F&&(B||!l.hasIconData()||C.get("icon-optional")),B&&(F||!l.hasTextData()||C.get("text-optional")),!0);!l.collisionArrays&&v&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(v);const le=(ce,K,oe)=>{for(let pe=0;pe<K/4;pe++)ce.opacityVertexArray.emplaceBack(oe)};let ae=0;for(let ce=0;ce<l.symbolInstances.length;ce++){const K=l.symbolInstances.get(ce),{numHorizontalGlyphVertices:oe,numVerticalGlyphVertices:pe,crossTileID:ge,numIconVertices:De}=K,Me=f.has(ge);let Se=this.opacities[ge];Me?Se=R:Se||(Se=se,this.opacities[ge]=Se),f.add(ge);const ze=oe>0||pe>0,Re=De>0,Xe=this.placedOrientations[ge],At=Xe===p.WritingMode.vertical,Ve=Xe===p.WritingMode.horizontal||Xe===p.WritingMode.horizontalOnly;if(!ze&&!Re||Se.isHidden()||ae++,ze){const mt=xl(Se.text);le(l.text,oe,At?Dr:mt),le(l.text,pe,Ve?Dr:mt);const nt=Se.text.isHidden(),{leftJustifiedTextSymbolIndex:bt,centerJustifiedTextSymbolIndex:He,rightJustifiedTextSymbolIndex:ut,verticalPlacedTextSymbolIndex:Lt}=K,gt=l.text.placedSymbolArray,wt=nt||At?1:0;bt>=0&&(gt.get(bt).hidden=wt),He>=0&&(gt.get(He).hidden=wt),ut>=0&&(gt.get(ut).hidden=wt),Lt>=0&&(gt.get(Lt).hidden=nt||Ve?1:0);const bn=this.variableOffsets[ge];bn&&this.markUsedJustification(l,bn.anchor,K,Xe);const Rn=this.placedOrientations[ge];Rn&&(this.markUsedJustification(l,"left",K,Rn),this.markUsedOrientation(l,Rn,K))}if(Re){const mt=xl(Se.icon),{placedIconSymbolIndex:nt,verticalPlacedIconSymbolIndex:bt}=K,He=l.icon.placedSymbolArray,ut=Se.icon.isHidden()?1:0;nt>=0&&(le(l.icon,De,At?Dr:mt),He.get(nt).hidden=ut),bt>=0&&(le(l.icon,K.numVerticalIconVertices,Ve?Dr:mt),He.get(bt).hidden=ut)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const mt=l.collisionArrays[ce];if(mt){let nt=new p.Point(0,0),bt=!0;if(mt.textBox||mt.verticalTextBox){if($){const ut=this.variableOffsets[ge];ut?(nt=nn(ut.anchor,ut.width,ut.height,ut.textOffset,ut.textScale),j&&nt._rotate(X?this.transform.angle:-this.transform.angle)):bt=!1}S&&(bt=!Se.clipped),mt.textBox&&Yi(l.textCollisionBox.collisionVertexArray,Se.text.placed,!bt||At,nt.x,nt.y),mt.verticalTextBox&&Yi(l.textCollisionBox.collisionVertexArray,Se.text.placed,!bt||Ve,nt.x,nt.y)}const He=bt&&!(Ve||!mt.verticalIconBox);mt.iconBox&&Yi(l.iconCollisionBox.collisionVertexArray,Se.icon.placed,He,ee?nt.x:0,ee?nt.y:0),mt.verticalIconBox&&Yi(l.iconCollisionBox.collisionVertexArray,Se.icon.placed,!He,ee?nt.x:0,ee?nt.y:0)}}}if(l.fullyClipped=0===ae,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const ce=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=ce.invProjMatrix,l.placementViewportMatrix=ce.viewportMatrix,l.collisionCircleArray=ce.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return 0===this.fadeDuration?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const v=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*v>l}setStale(){this.stale=!0}}function Yi(_,l,f,v,C){_.emplaceBack(l?1:0,f?1:0,v||0,C||0),_.emplaceBack(l?1:0,f?1:0,v||0,C||0),_.emplaceBack(l?1:0,f?1:0,v||0,C||0),_.emplaceBack(l?1:0,f?1:0,v||0,C||0)}const Tn=Math.pow(2,25),wn=Math.pow(2,24),Gi=Math.pow(2,17),as=Math.pow(2,16),Xi=Math.pow(2,9),Mo=Math.pow(2,8),df=Math.pow(2,1);function xl(_){if(0===_.opacity&&!_.placed)return 0;if(1===_.opacity&&_.placed)return 4294967295;const l=_.placed?1:0,f=Math.floor(127*_.opacity);return f*Tn+l*wn+f*Gi+l*as+f*Xi+l*Mo+f*df+l}const Dr=0;class Lu{constructor(l){this._sortAcrossTiles="viewport-y"!==l.layout.get("symbol-z-order")&&void 0!==l.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,f,v,C,S){const R=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(R,C,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((F,B)=>F.sortKey-B.sortKey));this._currentPartIndex<R.length;){const F=R[this._currentPartIndex];if(f.placeLayerBucketPart(F,this._seenCrossTileIDs,v,0===F.symbolInstanceStart),this._currentPartIndex++,S())return!0}return!1}}class vr{constructor(l,f,v,C,S,R,F,B){this.placement=new dr(l,S,R,F,B),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=C,this._done=!1}isDone(){return this._done}continuePlacement(l,f,v){const C=p.exported.now(),S=()=>{const R=p.exported.now()-C;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=f[l[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if("symbol"===R.type&&(!R.minzoom||R.minzoom<=F)&&(!R.maxzoom||R.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new Lu(R)),this._inProgressLayer.continuePlacement(v[R.source],this.placement,this._showCollisionBoxes,R,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const cn=512/p.EXTENT/2;class In{constructor(l,f,v){this.tileID=l,this.bucketInstanceId=v,this.index=new p.KDBush(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const C=l.canonical.x*p.EXTENT,S=l.canonical.y*p.EXTENT;for(let R=0;R<f.length;R++){const{key:F,crossTileID:B,tileAnchorX:$,tileAnchorY:j}=f.get(R),X=Math.floor((C+$)*cn),ee=Math.floor((S+j)*cn);this.index.add(X,ee),this.keys.push(F),this.crossTileIDs.push(B)}this.index.finish()}findMatches(l,f,v){const C=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),S=cn/Math.pow(2,f.canonical.z-this.tileID.canonical.z),R=f.canonical.x*p.EXTENT,F=f.canonical.y*p.EXTENT;for(let B=0;B<l.length;B++){const $=l.get(B);if($.crossTileID)continue;const{key:j,tileAnchorX:X,tileAnchorY:ee}=$,se=Math.floor((R+X)*S),le=Math.floor((F+ee)*S),ae=this.index.range(se-C,le-C,se+C,le+C);for(const ce of ae){const K=this.crossTileIDs[ce];if(this.keys[ce]===j&&!v.has(K)){v.add(K),$.crossTileID=K;break}}}}}class hr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ho{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(0!==f)for(const v in this.indexes){const C=this.indexes[v],S={};for(const R in C){const F=C[R];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+f),S[F.tileID.key]=F}this.indexes[v]=S}this.lng=l}addBucket(l,f,v){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let S=0;S<f.symbolInstances.length;S++)f.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const C=this.usedCrossTileIDs[l.overscaledZ];for(const S in this.indexes){const R=this.indexes[S];if(Number(S)>l.overscaledZ)for(const F in R){const B=R[F];B.tileID.isChildOf(l)&&B.findMatches(f.symbolInstances,l,C)}else{const F=R[l.scaledTo(Number(S)).key];F&&F.findMatches(f.symbolInstances,l,C)}}for(let S=0;S<f.symbolInstances.length;S++){const R=f.symbolInstances.get(S);R.crossTileID||(R.crossTileID=v.generate(),C.add(R.crossTileID))}return void 0===this.indexes[l.overscaledZ]&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new In(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const v of f.crossTileIDs)this.usedCrossTileIDs[l].delete(v)}removeStaleBuckets(l){let f=!1;for(const v in this.indexes){const C=this.indexes[v];for(const S in C)l[C[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,C[S]),delete C[S],f=!0)}return f}}class Go{constructor(){this.layerIndexes={},this.crossTileIDs=new hr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,v,C){let S=this.layerIndexes[l.id];void 0===S&&(S=this.layerIndexes[l.id]=new Ho);let R=!1;const F={};"globe"!==C.name&&S.handleWrapJump(v);for(const B of f){const $=B.getBucket(l);$&&l.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(B.tileID,$,this.crossTileIDs)&&(R=!0),F[$.bucketInstanceId]=!0)}return S.removeStaleBuckets(F)&&(R=!0),R}pruneUnusedLayers(l){const f={};l.forEach(v=>{f[v]=!0});for(const v in this.layerIndexes)f[v]||delete this.layerIndexes[v]}}const Ar=(_,l)=>p.emitValidationErrors(_,l&&l.filter(f=>"source.canvas"!==f.identifier)),wl=p.pick(pi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),br=p.pick(pi,["setCenter","setZoom","setBearing","setPitch"]),aa={version:8,layers:[],sources:{}},la={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Un extends p.Evented{constructor(l,f={}){super(),this.map=l,this.dispatcher=new Si(vl(),this),this.imageManager=new $t,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(l._requestManager,f.localFontFamily?p.LocalGlyphMode.all:f.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.crossTileSymbolIndex=new Go,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const v=this;this._rtlTextPluginCallback=Un.registerForPluginStateChange(C=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:C.pluginStatus,pluginURL:C.pluginURL},(S,R)=>{if(p.triggerPluginCompletionEvent(S),R&&R.every(F=>F))for(const F in v._sourceCaches){const B=v._sourceCaches[F],$=B.getSource().type;"vector"!==$&&"geojson"!==$||B.reload()}})}),this.on("data",C=>{if("source"!==C.dataType||"metadata"!==C.sourceDataType)return;const S=this.getSource(C.sourceId);if(S&&S.vectorLayerIds)for(const R in this._layers){const F=this._layers[R];F.source===S.id&&this._validateLayer(F)}})}loadURL(l,f={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const v="boolean"==typeof f.validate?f.validate:!p.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,f.accessToken);const C=this.map._requestManager.transformRequest(l,p.ResourceType.Style);this._request=p.getJSON(C,(S,R)=>{this._request=null,S?this.fire(new p.ErrorEvent(S)):R&&this._load(R,v)})}loadJSON(l,f={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(l,!1!==f.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(aa,!1)}_updateLayerCount(l,f){const v=f?1:-1;l.is3D()&&(this._num3DLayers+=v),"circle"===l.type&&(this._numCircleLayers+=v),"symbol"===l.type&&(this._numSymbolLayers+=v)}_load(l,f){if(f&&Ar(this,p.validateStyle(l)))return;this._loaded=!0,this.stylesheet=p.clone$1(l),this._updateMapProjection();for(const C in l.sources)this.addSource(C,l.sources[C],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);const v=zs(this.stylesheet.layers);this._order=v.map(C=>C.id),this._layers={},this._serializedLayers={};for(const C of v){const S=p.createStyleLayer(C);S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Kt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(l){this._spriteRequest=function(f,v,C){let S,R,F;const B=p.exported.devicePixelRatio>1?"@2x":"";let $=p.getJSON(v.transformRequest(v.normalizeSpriteURL(f,B,".json"),p.ResourceType.SpriteJSON),(ee,se)=>{$=null,F||(F=ee,S=se,X())}),j=p.getImage(v.transformRequest(v.normalizeSpriteURL(f,B,".png"),p.ResourceType.SpriteImage),(ee,se)=>{j=null,F||(F=ee,R=se,X())});function X(){if(F)C(F);else if(S&&R){const ee=p.exported.getImageData(R),se={};for(const le in S){const{width:ae,height:ce,x:K,y:oe,sdf:pe,pixelRatio:ge,stretchX:De,stretchY:Me,content:Se}=S[le],ze=new p.RGBAImage({width:ae,height:ce});p.RGBAImage.copy(ee,ze,{x:K,y:oe},{x:0,y:0},{width:ae,height:ce}),se[le]={data:ze,pixelRatio:ge,sdf:pe,stretchX:De,stretchY:Me,content:Se}}C(null,se)}}return{cancel(){$&&($.cancel(),$=null),j&&(j.cancel(),j=null)}}}(l,this.map._requestManager,(f,v)=>{if(this._spriteRequest=null,f)this.fire(new p.ErrorEvent(f));else if(v)for(const C in v)this.imageManager.addImage(C,v[C]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(l){const f=this.getSource(l.source);if(!f)return;const v=l.sourceLayer;v&&("geojson"===f.type||f.vectorLayerIds&&-1===f.vectorLayerIds.indexOf(v))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${f.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){const f=[];for(const v of l){const C=this._layers[v];"custom"!==C.type&&f.push(C.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&("function"==typeof l.isLayerDraped?l.isLayerDraped():la[l.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;const f=this._changed;if(this._changed){const C=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(C.length||S.length)&&this._updateWorkerLayers(C,S);for(const R in this._updatedSources){const F=this._updatedSources[R];"reload"===F?this._reloadSource(R):"clear"===F&&this._clearSource(R)}this._updateTilesForChangedImages();for(const R in this._updatedPaintProps)this._layers[R].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}const v={};for(const C in this._sourceCaches){const S=this._sourceCaches[C];v[C]=S.used,S.used=!1}for(const C of this._order){const S=this._layers[C];if(S.recalculate(l,this._availableImages),!S.isHidden(l.zoom)){const F=this._getLayerSourceCache(S);F&&(F.used=!0)}const R=this.map.painter;if(R){const F=S.getProgramIds();if(!F)continue;const B=S.getProgramConfiguration(l.zoom);for(const $ of F)R.useProgram($,B)}}for(const C in v){const S=this._sourceCaches[C];v[C]!==S.used&&S.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),Ar(this,p.validateStyle(l)))return!1;(l=p.clone$1(l)).layers=zs(l.layers);const f=function(C,S){if(!C)return[{command:pi.setStyle,args:[S]}];let R=[];try{if(!ue(C.version,S.version))return[{command:pi.setStyle,args:[S]}];ue(C.center,S.center)||R.push({command:pi.setCenter,args:[S.center]}),ue(C.zoom,S.zoom)||R.push({command:pi.setZoom,args:[S.zoom]}),ue(C.bearing,S.bearing)||R.push({command:pi.setBearing,args:[S.bearing]}),ue(C.pitch,S.pitch)||R.push({command:pi.setPitch,args:[S.pitch]}),ue(C.sprite,S.sprite)||R.push({command:pi.setSprite,args:[S.sprite]}),ue(C.glyphs,S.glyphs)||R.push({command:pi.setGlyphs,args:[S.glyphs]}),ue(C.transition,S.transition)||R.push({command:pi.setTransition,args:[S.transition]}),ue(C.light,S.light)||R.push({command:pi.setLight,args:[S.light]}),ue(C.fog,S.fog)||R.push({command:pi.setFog,args:[S.fog]}),ue(C.projection,S.projection)||R.push({command:pi.setProjection,args:[S.projection]});const F={},B=[];!function(X,ee,se,le){let ae;for(ae in ee=ee||{},X=X||{})X.hasOwnProperty(ae)&&(ee.hasOwnProperty(ae)||co(ae,se,le));for(ae in ee){if(!ee.hasOwnProperty(ae))continue;const ce=ee[ae];X.hasOwnProperty(ae)?ue(X[ae],ce)||("geojson"===X[ae].type&&"geojson"===ce.type&&sa(X,ee,ae)?se.push({command:pi.setGeoJSONSourceData,args:[ae,ce.data]}):Ci(ae,ee,se,le)):Vs(ae,ee,se)}}(C.sources,S.sources,B,F);const $=[];C.layers&&C.layers.forEach(X=>{X.source&&F[X.source]?R.push({command:pi.removeLayer,args:[X.id]}):$.push(X)});let j=C.terrain;j&&F[j.source]&&(R.push({command:pi.setTerrain,args:[void 0]}),j=void 0),R=R.concat(B),ue(j,S.terrain)||R.push({command:pi.setTerrain,args:[S.terrain]}),function(X,ee,se){ee=ee||[];const le=(X=X||[]).map(To),ae=ee.map(To),ce=X.reduce(Rc,{}),K=ee.reduce(Rc,{}),oe=le.slice(),pe=Object.create(null);let ge,De,Me,Se,ze,Re,Xe;for(ge=0,De=0;ge<le.length;ge++)Me=le[ge],K.hasOwnProperty(Me)?De++:(se.push({command:pi.removeLayer,args:[Me]}),oe.splice(oe.indexOf(Me,De),1));for(ge=0,De=0;ge<ae.length;ge++)Me=ae[ae.length-1-ge],oe[oe.length-1-ge]!==Me&&(ce.hasOwnProperty(Me)?(se.push({command:pi.removeLayer,args:[Me]}),oe.splice(oe.lastIndexOf(Me,oe.length-De),1)):De++,Re=oe[oe.length-ge],se.push({command:pi.addLayer,args:[K[Me],Re]}),oe.splice(oe.length-ge,0,Me),pe[Me]=!0);for(ge=0;ge<ae.length;ge++)if(Me=ae[ge],Se=ce[Me],ze=K[Me],!pe[Me]&&!ue(Se,ze))if(ue(Se.source,ze.source)&&ue(Se["source-layer"],ze["source-layer"])&&ue(Se.type,ze.type)){for(Xe in Co(Se.layout,ze.layout,se,Me,null,pi.setLayoutProperty),Co(Se.paint,ze.paint,se,Me,null,pi.setPaintProperty),ue(Se.filter,ze.filter)||se.push({command:pi.setFilter,args:[Me,ze.filter]}),ue(Se.minzoom,ze.minzoom)&&ue(Se.maxzoom,ze.maxzoom)||se.push({command:pi.setLayerZoomRange,args:[Me,ze.minzoom,ze.maxzoom]}),Se)Se.hasOwnProperty(Xe)&&"layout"!==Xe&&"paint"!==Xe&&"filter"!==Xe&&"metadata"!==Xe&&"minzoom"!==Xe&&"maxzoom"!==Xe&&(0===Xe.indexOf("paint.")?Co(Se[Xe],ze[Xe],se,Me,Xe.slice(6),pi.setPaintProperty):ue(Se[Xe],ze[Xe])||se.push({command:pi.setLayerProperty,args:[Me,Xe,ze[Xe]]}));for(Xe in ze)ze.hasOwnProperty(Xe)&&!Se.hasOwnProperty(Xe)&&"layout"!==Xe&&"paint"!==Xe&&"filter"!==Xe&&"metadata"!==Xe&&"minzoom"!==Xe&&"maxzoom"!==Xe&&(0===Xe.indexOf("paint.")?Co(Se[Xe],ze[Xe],se,Me,Xe.slice(6),pi.setPaintProperty):ue(Se[Xe],ze[Xe])||se.push({command:pi.setLayerProperty,args:[Me,Xe,ze[Xe]]}))}else se.push({command:pi.removeLayer,args:[Me]}),Re=oe[oe.lastIndexOf(Me)+1],se.push({command:pi.addLayer,args:[ze,Re]})}($,S.layers,R)}catch(F){console.warn("Unable to compute style diff:",F),R=[{command:pi.setStyle,args:[S]}]}return R}(this.serialize(),l).filter(C=>!(C.command in br));if(0===f.length)return!1;const v=f.filter(C=>!(C.command in wl));if(v.length>0)throw new Error(`Unimplemented: ${v.map(C=>C.command).join(", ")}.`);return f.forEach(C=>{"setTransition"!==C.command&&"setProjection"!==C.command&&this[C.command].apply(this,C.args)}),this.stylesheet=l,this._updateMapProjection(),!0}addImage(l,f){return this.getImage(l)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,f),this._afterImageUpdated(l),this)}updateImage(l,f){this.imageManager.updateImage(l,f)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l),this._afterImageUpdated(l),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,f,v={}){if(this._checkLoaded(),void 0!==this.getSource(l))throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(p.validateSource,`sources.${l}`,f,null,v))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const C=Hn(l,f,this.dispatcher,this);C.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(l),source:C.serialize(),sourceId:l}));const S=R=>{const F=(R?"symbol:":"other:")+l,B=this._sourceCaches[F]=new p.SourceCache(F,C,R);(R?this._symbolSourceCaches:this._otherSourceCaches)[l]=B,B.style=this,B.onAdd(this.map)};S(!1),"vector"!==f.type&&"geojson"!==f.type||S(!0),C.onAdd&&C.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();const f=this.getSource(l);if(!f)throw new Error("There is no source with this ID");for(const C in this._layers)if(this._layers[C].source===l)return this.fire(new p.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${C}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new p.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(l);for(const C of v)delete this._sourceCaches[C.id],delete this._updatedSources[C.id],C.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:C.getSource().id})),C.setEventedParent(null),C.clearTiles();return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(l,f){this._checkLoaded(),this.getSource(l).setData(f),this._changed=!0}getSource(l){const f=this._getSourceCache(l);return f&&f.getSource()}_getSources(){const l=[];for(const f in this._otherSourceCaches){const v=this._getSourceCache(f);v&&l.push(v.getSource())}return l}addLayer(l,f,v={}){this._checkLoaded();const C=l.id;if(this.getLayer(C))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${C}" already exists on this map`)));let S;if("custom"===l.type){if(Ar(this,p.validateCustomStyleLayer(l)))return;S=p.createStyleLayer(l)}else{if("object"==typeof l.source&&(this.addSource(C,l.source),l=p.clone$1(l),l=p.extend(l,{source:C})),this._validate(p.validateLayer,`layers.${C}`,l,{arrayIndex:-1},v))return;S=p.createStyleLayer(l),this._validateLayer(S),S.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}const R=f?this._order.indexOf(f):this._order.length;if(f&&-1===R)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(R,0,C),this._layerOrderChanged=!0,this._layers[C]=S;const F=this._getLayerSourceCache(S);if(this._removedLayers[C]&&S.source&&F&&"custom"!==S.type){const B=this._removedLayers[C];delete this._removedLayers[C],B.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",F.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,f){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===f)return;const v=this._order.indexOf(l);this._order.splice(v,1);const C=f?this._order.indexOf(f):this._order.length;f&&-1===C?this.fire(new p.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(C,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();const f=this._layers[l];if(!f)return void this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const v=this._order.indexOf(l);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=f,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(const f in this._layers)if(this._layers[f].type===l)return!0;return!1}setLayerZoomRange(l,f,v){this._checkLoaded();const C=this.getLayer(l);C?C.minzoom===f&&C.maxzoom===v||(null!=f&&(C.minzoom=f),null!=v&&(C.maxzoom=v),this._updateLayer(C)):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,f,v={}){this._checkLoaded();const C=this.getLayer(l);if(C){if(!ue(C.filter,f))return null==f?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(p.validateFilter,`layers.${C.id}.filter`,f,{layerType:C.type},v)||(C.filter=p.clone$1(f),this._updateLayer(C)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){const f=this.getLayer(l);return f&&p.clone$1(f.filter)}setLayoutProperty(l,f,v,C={}){this._checkLoaded();const S=this.getLayer(l);S?ue(S.getLayoutProperty(f),v)||(S.setLayoutProperty(f,v,C),this._updateLayer(S)):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,f){const v=this.getLayer(l);if(v)return v.getLayoutProperty(f);this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,f,v,C={}){this._checkLoaded();const S=this.getLayer(l);S?ue(S.getPaintProperty(f),v)||(S.setPaintProperty(f,v,C)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,f){const v=this.getLayer(l);return v&&v.getPaintProperty(f)}setFeatureState(l,f){this._checkLoaded();const v=l.source,C=l.sourceLayer,S=this.getSource(v);if(!S)return void this.fire(new p.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const R=S.type;if("geojson"===R&&C)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===R&&!C)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===l.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const F=this._getSourceCaches(v);for(const B of F)B.setFeatureState(C,l.id,f)}removeFeatureState(l,f){this._checkLoaded();const v=l.source,C=this.getSource(v);if(!C)return void this.fire(new p.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const S=C.type,R="vector"===S?l.sourceLayer:void 0;if("vector"===S&&!R)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&"string"!=typeof l.id&&"number"!=typeof l.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const F=this._getSourceCaches(v);for(const B of F)B.removeFeatureState(R,l.id,f)}getFeatureState(l){this._checkLoaded();const f=l.source,v=l.sourceLayer,C=this.getSource(f);if(C){if("vector"!==C.type||v)return void 0===l.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(v,l.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const l={};for(const f in this._sourceCaches){const v=this._sourceCaches[f].getSource();l[v.id]||(l[v.id]=v.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},f=>void 0!==f)}_updateLayer(l){this._updatedLayers[l.id]=!0;const f=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&f&&"raster"!==f.getSource().type&&(this._updatedSources[l.source]="reload",f.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const f=R=>"fill-extrusion"===this._layers[R].type,v={},C=[];for(let R=this._order.length-1;R>=0;R--){const F=this._order[R];if(f(F)){v[F]=R;for(const B of l){const $=B[F];if($)for(const j of $)C.push(j)}}}C.sort((R,F)=>F.intersectionZ-R.intersectionZ);const S=[];for(let R=this._order.length-1;R>=0;R--){const F=this._order[R];if(f(F))for(let B=C.length-1;B>=0;B--){const $=C[B].feature;if(v[$.layer.id]<R)break;S.push($),C.pop()}else for(const B of l){const $=B[F];if($)for(const j of $)S.push(j.feature)}}return S}queryRenderedFeatures(l,f,v){f&&f.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const C={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const B of f.layers){const $=this._layers[B];if(!$)return this.fire(new p.ErrorEvent(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];C[$.source]=!0}}const S=[];f.availableImages=this._availableImages;const R=f&&f.layers?f.layers.some(B=>{const $=this.getLayer(B);return $&&$.is3D()}):this.has3DLayers(),F=ra.createFromScreenPoints(l,v);for(const B in this._sourceCaches){const $=this._sourceCaches[B].getSource().id;f.layers&&!C[$]||S.push(Qn(this._sourceCaches[B],this._layers,this._serializedLayers,F,f,v,R,!!this.map._showQueryGeometry))}return this.placement&&S.push(function(B,$,j,X,ee,se,le){const ae={},ce=se.queryRenderedSymbols(X),K=[];for(const oe of Object.keys(ce).map(Number))K.push(le[oe]);K.sort(li);for(const oe of K){const pe=oe.featureIndex.lookupSymbolFeatures(ce[oe.bucketInstanceId],$,oe.bucketIndex,oe.sourceLayerIndex,ee.filter,ee.layers,ee.availableImages,B);for(const ge in pe){const De=ae[ge]=ae[ge]||[],Me=pe[ge];Me.sort((Se,ze)=>{const Re=oe.featureSortOrder;if(Re){const Xe=Re.indexOf(Se.featureIndex);return Re.indexOf(ze.featureIndex)-Xe}return ze.featureIndex-Se.featureIndex});for(const Se of Me)De.push(Se)}}for(const oe in ae)ae[oe].forEach(pe=>{const ge=pe.feature,De=j(B[oe]);if(!De)return;const Me=De.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=Me});return ae}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),F.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(l,f){f&&f.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const v=this._getSourceCaches(l);let C=[];for(const S of v)C=C.concat(wr(S,f));return C}addSourceType(l,f,v){return Un.getSourceType(l)?v(new Error(`A source type called "${l}" already exists.`)):(Un.setSourceType(l,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:f.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(l,f={}){this._checkLoaded();const v=this.light.getLight();let C=!1;for(const R in l)if(!ue(l[R],v[R])){C=!0;break}if(!C)return;const S=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(l,f),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,f=1){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=l;if(1===f){if("object"==typeof v.source){const C="terrain-dem-src";this.addSource(C,v.source),v=p.clone$1(v),v=p.extend(v,{source:C})}if(this._validate(p.validateTerrain,"terrain",v))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,f)}else{const C=this.terrain,S=C.get();for(const R of Object.keys(p.spec.terrain))!v.hasOwnProperty(R)&&p.spec.terrain[R].default&&(v[R]=p.spec.terrain[R].default);for(const R in v)if(!ue(v[R],S[R])){C.set(v),this.stylesheet.terrain=v;const F=this._setTransitionParameters({duration:0});C.updateTransitions(F);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const f=this.fog=new ia(l,this.map.transform);this.stylesheet.fog=l;const v=this._setTransitionParameters({duration:0});f.updateTransitions(v)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,v=f.get();0===Object.keys(l).length&&f.set(l);for(const C in l)if(!ue(l[C],v[C])){f.set(l),this.stylesheet.fog=l;const S=this._setTransitionParameters({duration:0});f.updateTransitions(S);break}}else this._createFog(l);this._markersNeedUpdate=!0}_setTransitionParameters(l){return{now:p.exported.now(),transition:p.extend(l,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const l=this._order.filter(v=>this.isLayerDraped(this._layers[v])),f=this._order.filter(v=>!this.isLayerDraped(this._layers[v]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...f)}_createTerrain(l,f){const v=this.terrain=new gi(l,f);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const C=this._setTransitionParameters({duration:0});v.updateTransitions(C)}_force3DLayerUpdate(){for(const l in this._layers){const f=this._layers[l];"fill-extrusion"===f.type&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const f=this._layers[l];"symbol"===f.type&&this._updateLayer(f)}}_validate(l,f,v,C,S={}){return(!S||!1!==S.validate)&&Ar(this,l.call(p.validateStyle,p.extend({key:f,style:this.serialize(),value:v,styleSpec:p.spec},C)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){const f=this._getSourceCaches(l);for(const v of f)v.clearTiles()}_reloadSource(l){const f=this._getSourceCaches(l);for(const v of f)v.resume(),v.reload()}_reloadSources(){for(const l of this._getSources())l.reload&&l.reload()}_updateSources(l){for(const f in this._sourceCaches)this._sourceCaches[f].update(l)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const f=this._sourceCaches[l];f.resume(),f.reload()}}_updatePlacement(l,f,v,C,S=!1){let R=!1,F=!1;const B={};for(const $ of this._order){const j=this._layers[$];if("symbol"!==j.type)continue;if(!B[j.source]){const ee=this._getLayerSourceCache(j);if(!ee)continue;B[j.source]=ee.getRenderableIds(!0).map(se=>ee.getTileByID(se)).sort((se,le)=>le.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(le.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(j,B[j.source],l.center.lng,l.projection);R=R||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),S=S||this._layerOrderChanged||0===v,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),l.zoom))&&(this.pauseablePlacement=new vr(l,this._order,S,f,v,C,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),F=!0),R&&this.pauseablePlacement.placement.setStale()),F||R)for(const $ of this._order){const j=this._layers[$];"symbol"===j.type&&this.placement.updateLayerOpacities(j,B[j.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,f,v){this.imageManager.getImages(f.icons,v),this._updateTilesForChangedImages();const C=S=>{S&&S.setDependencies(f.tileID.key,f.type,f.icons)};C(this._otherSourceCaches[f.source]),C(this._symbolSourceCaches[f.source])}getGlyphs(l,f,v){this.glyphManager.getGlyphs(f.stacks,v)}getResource(l,f,v){return p.makeRequest(f,v)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return"symbol"===l.type?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){const f=[];return this._otherSourceCaches[l]&&f.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&f.push(this._symbolSourceCaches[l]),f}_isSourceCacheLoaded(l){const f=this._getSourceCaches(l);return 0===f.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${l}'`))),!1):f.every(v=>v.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Un.getSourceType=function(_){return Xn[_]},Un.setSourceType=function(_,l){Xn[_]=l},Un.registerForPluginStateChange=p.registerForPluginStateChange;var ec="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",El="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Zo="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Tr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",js="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Cl={},Wo={};const Wa=[];ca(ec,Wa),ca(Zo,Wa),ca(Tr,Wa),ca(js,Wa),Cl=vn("",Zo),Wo=vn(js,Tr);const hf=vn("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ca=ec,$s="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Nu={background:vn("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:vn("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:vn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:vn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:vn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:vn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:vn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:vn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:vn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:vn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:vn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:vn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:vn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:vn("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:vn("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:vn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:vn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:vn("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:vn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:vn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:vn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:vn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:vn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:vn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:vn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:vn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",El),skyboxGradient:vn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",El),skyboxCapture:vn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:vn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:vn("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ca(_,l){const f=_.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let v of f)if(v=v.trim(),"#"===v[0]&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const C=v.split(" ");for(const S of C)l.includes(S)||l.push(S)}}function vn(_,l){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),C={},S=[...Wa];return ca(_,S),ca(l,S),{fragmentSource:_=_.replace(f,(R,F,B,$,j)=>(C[j]=!0,"define"===F?`\n#ifndef HAS_UNIFORM_u_${j}\nvarying ${B} ${$} ${j};\n#else\nuniform ${B} ${$} u_${j};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${j}\n    ${B} ${$} ${j} = u_${j};\n#endif\n`)),vertexSource:l=l.replace(f,(R,F,B,$,j)=>{const X="float"===$?"vec2":"vec4",ee=j.match(/color/)?"color":X;return C[j]?"define"===F?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nattribute ${B} ${X} a_${j};\nvarying ${B} ${$} ${j};\n#else\nuniform ${B} ${$} u_${j};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = a_${j};\n#else\n    ${B} ${$} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = unpack_mix_${ee}(a_${j}, u_${j}_t);\n#else\n    ${B} ${$} ${j} = u_${j};\n#endif\n`:"define"===F?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nattribute ${B} ${X} a_${j};\n#else\nuniform ${B} ${$} u_${j};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${B} ${$} ${j} = a_${j};\n#else\n    ${B} ${$} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${B} ${$} ${j} = unpack_mix_${ee}(a_${j}, u_${j}_t);\n#else\n    ${B} ${$} ${j} = u_${j};\n#endif\n`}),staticAttributes:v,usedDefines:S}}class ky{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,f,v,C,S,R,F){this.context=l;let B=this.boundPaintVertexBuffers.length!==C.length;for(let j=0;!B&&j<C.length;j++)this.boundPaintVertexBuffers[j]!==C[j]&&(B=!0);let $=this.boundDynamicVertexBuffers.length!==F.length;for(let j=0;!$&&j<F.length;j++)this.boundDynamicVertexBuffers[j]!==F[j]&&($=!0);if(!l.extVertexArrayObject||!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==v||B||$||this.boundIndexBuffer!==S||this.boundVertexOffset!==R)this.freshBind(f,v,C,S,R,F);else{l.bindVertexArrayOES.set(this.vao);for(const j of F)j&&j.bind();S&&S.dynamicDraw&&S.bind()}}freshBind(l,f,v,C,S,R){let F;const B=l.numAttributes,$=this.context,j=$.gl;if($.extVertexArrayObject)this.vao&&this.destroy(),this.vao=$.extVertexArrayObject.createVertexArrayOES(),$.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=C,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=R;else{F=$.currentNumAttributes||0;for(let X=B;X<F;X++)j.disableVertexAttribArray(X)}f.enableAttributes(j,l),f.bind(),f.setVertexAttribPointers(j,l,S);for(const X of v)X.enableAttributes(j,l),X.bind(),X.setVertexAttribPointers(j,l,S);for(const X of R)X&&(X.enableAttributes(j,l),X.bind(),X.setVertexAttribPointers(j,l,S));C&&C.bind(),$.currentNumAttributes=B}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Bu(_,l){const f=Math.pow(2,l.canonical.z),v=l.canonical.y;return[new p.MercatorCoordinate(0,v/f).toLngLat().lat,new p.MercatorCoordinate(0,(v+1)/f).toLngLat().lat]}function ff(_,l,f,v,C,S,R){const F=_.context,B=F.gl,$=f.fbo;if(!$)return;_.prepareDrawTile();const j=_.useProgram("hillshade");F.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,$.colorAttachment.get());const X=((ae,ce,K,oe)=>{const pe=K.paint.get("hillshade-shadow-color"),ge=K.paint.get("hillshade-highlight-color"),De=K.paint.get("hillshade-accent-color");let Me=K.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===K.paint.get("hillshade-illumination-anchor")&&(Me-=ae.transform.angle);const Se=!ae.options.moving;return{u_matrix:oe||ae.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Se),u_image:0,u_latrange:Bu(0,ce.tileID),u_light:[K.paint.get("hillshade-exaggeration"),Me],u_shadow:pe,u_highlight:ge,u_accent:De}})(_,f,v,_.terrain?l.projMatrix:null);_.prepareDrawProgram(F,j,l.toUnwrapped());const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:se,tileBoundsSegments:le}=_.getTileBoundsBuffers(f);j.draw(F,B.TRIANGLES,C,S,R,p.CullFaceMode.disabled,X,v.id,ee,se,le)}function qo(_,l,f){if(!l.needsDEMTextureUpload)return;const v=_.context,C=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||_.getTileTexture(f.stride);const S=f.getPixels();l.demTexture?l.demTexture.update(S,{premultiply:!1}):l.demTexture=new p.Texture(v,S,C.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function zu(_,l,f,v,C,S){const R=_.context,F=R.gl;if(!l.dem)return;const B=l.dem;if(R.activeTexture.set(F.TEXTURE1),qo(_,l,B),!l.demTexture)return;l.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);const $=B.dim;R.activeTexture.set(F.TEXTURE0);let j=l.fbo;if(!j){const le=new p.Texture(R,{width:$,height:$,data:null},F.RGBA);le.bind(F.LINEAR,F.CLAMP_TO_EDGE),j=l.fbo=R.createFramebuffer($,$,!0),j.colorAttachment.set(le.texture)}R.bindFramebuffer.set(j.framebuffer),R.viewport.set([0,0,$,$]);const{tileBoundsBuffer:X,tileBoundsIndexBuffer:ee,tileBoundsSegments:se}=_.getMercatorTileBoundsBuffers();_.useProgram("hillshadePrepare").draw(R,F.TRIANGLES,v,C,S,p.CullFaceMode.disabled,((le,ae)=>{const ce=ae.stride,K=p.create();return p.ortho(K,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(K,K,[0,-p.EXTENT,0]),{u_matrix:K,u_image:1,u_dimension:[ce,ce],u_zoom:le.overscaledZ,u_unpack:ae.unpackVector}})(l.tileID,B),f.id,X,ee,se),l.needsHillshadePrepare=!1}const tc=_=>({u_matrix:new p.UniformMatrix4f(_),u_image0:new p.Uniform1i(_),u_skirt_height:new p.Uniform1f(_)}),Ta=(_,l)=>({u_matrix:_,u_image0:0,u_skirt_height:l}),Gr=(_,l,f,v,C,S,R,F,B,$,j,X,ee,se,le)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:f,u_zoom_transition:C,u_merc_center:S,u_image0:0,u_frustum_tl:R,u_frustum_tr:F,u_frustum_br:B,u_frustum_bl:$,u_globe_pos:j,u_globe_radius:X,u_viewport:ee,u_grid_matrix:le?Float32Array.from(le):new Float32Array(9),u_skirt_height:se});function Ud(_,l){return null!=_&&null!=l&&!(!_.hasData()||!l.hasData())&&null!=_.demTexture&&null!=l.demTexture&&_.tileID.key!==l.tileID.key}const Nr=new class{constructor(){this.operations={}}newMorphing(_,l,f,v,C){if(_ in this.operations){const S=this.operations[_];S.to.tileID.key!==f.tileID.key&&(S.queued=f)}else this.operations[_]={startTime:v,phase:0,duration:C,from:l,to:f,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const l=this.operations[_];return{from:l.from,to:l.to,phase:l.phase}}update(_){for(const l in this.operations){const f=this.operations[l];for(f.phase=(_-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,_)){delete this.operations[l];break}}}_nextOp(_,l){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=l,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},Br={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function kc(_){return 6*Math.pow(1.5,22-_)}function Tl(_,l){const f=1<<_.z;return!l&&(0===_.x||_.x===f-1)||0===_.y||_.y===f-1}const nc=_=>({u_matrix:_});function Hs(_,l,f,v,C){if(C>0){const S=p.exported.now(),R=(S-_.timeAdded)/C,F=l?(S-l.timeAdded)/C:-1,B=f.getSource(),$=v.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),j=!l||Math.abs(l.tileID.overscaledZ-$)>Math.abs(_.tileID.overscaledZ-$),X=j&&_.refreshedUponExpiration?1:p.clamp(j?R:1-F,0,1);return _.refreshedUponExpiration&&R>=1&&(_.refreshedUponExpiration=!1),l?{opacity:1,mix:1-X}:{opacity:X,mix:0}}return{opacity:1,mix:0}}class Vu extends p.SourceCache{constructor(l){const f={type:"raster-dem",maxzoom:l.transform.maxZoom},v=new Si(vl(),null),C=Hn("mock-dem",f,v,l.style);super("mock-dem",C,!1),C.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,f){l.state="loaded",f(null)}}class jd extends p.SourceCache{constructor(l){const f=Hn("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new Si(vl(),null),l.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,f,v){if(l.freezeTileCoverage)return;this.transform=l;const C=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,R)=>{if(S[R.key]="",!this._tiles[R.key]){const F=new p.Tile(R,this._source.tileSize*R.overscaleFactor(),l.tileZoom);F.state="loaded",this._tiles[R.key]=F}return S},{});for(const S in this._tiles)S in C||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(l){const f=this.proxyCachedFBO[l];if(void 0!==f){const v=Object.values(f);this.renderCachePool.push(...v),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class $d extends p.OverscaledTileID{constructor(l,f,v){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=f,this.projMatrix=v}}class Pg extends p.Elevation{constructor(l,f){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,C,S]=function(B){const $=new p.StructArrayLayout2i4,j=new p.StructArrayLayout3ui6,X=131;$.reserve(17161),j.reserve(33800);const ee=p.EXTENT/128,se=p.EXTENT+ee/2,le=se+ee;for(let ce=-ee;ce<le;ce+=ee)for(let K=-ee;K<le;K+=ee){const oe=K<0||K>se||ce<0||ce>se?24575:0,pe=p.clamp(Math.round(K),0,p.EXTENT),ge=p.clamp(Math.round(ce),0,p.EXTENT);$.emplaceBack(pe+oe,ge)}const ae=(ce,K)=>{const oe=K*X+ce;j.emplaceBack(oe+1,oe,oe+X),j.emplaceBack(oe+X,oe+X+1,oe+1)};for(let ce=1;ce<129;ce++)for(let K=1;K<129;K++)ae(K,ce);return[0,129].forEach(ce=>{for(let K=0;K<130;K++)ae(K,ce),ae(ce,K)}),[$,j,32768]}(),R=l.context;this.gridBuffer=R.createVertexBuffer(v,p.posAttributes.members),this.gridIndexBuffer=R.createIndexBuffer(C),this.gridSegments=p.SegmentVector.simpleSegment(0,0,v.length,C.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,v.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new jd(f.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const F=R.gl;this._overlapStencilMode=new p.StencilMode({func:F.GEQUAL,mask:255},0,255,F.KEEP,F.KEEP,F.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Vu(f.map)}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,f,v){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;const C=l.terrain.properties;this.sourceCache=0===l.terrain.drapeRenderMode?this._mockSourceCache:l._getSourceCache(C.get("source")),this._exaggeration=C.get("exaggeration");const S=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const R=this.getScaledDemTileSize();this.sourceCache.update(f,R,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,S(),this._initializing=!0),S(),f.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==l.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&"source"===l.dataType?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):"style"===l.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=0===v._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(v.center),-1),this._emptyDEMTextureDirty=!this._initializing);const C=this.proxyCoords=f.getIds().map(B=>{const $=f.getTileByID(B).tileID;return $.projMatrix=v.calculateProjMatrix($.toUnwrapped()),$});(function(B,$){const j=$.transform.pointCoordinate($.transform.getCameraPoint()),X=new p.Point(j.x,j.y);B.sort((ee,se)=>{if(se.overscaledZ-ee.overscaledZ)return se.overscaledZ-ee.overscaledZ;const le=new p.Point(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),ae=new p.Point(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),ce=X.mult(1<<ee.canonical.z);return ce.x-=.5,ce.y-=.5,ce.distSqr(le)-ce.distSqr(ae)})})(C,this.painter),this._previousZoom=v.zoom;const S=this.proxyToSource||{};this.proxyToSource={},C.forEach(B=>{this.proxyToSource[B.key]={}}),this.terrainTileForTile={};const R=this._style._sourceCaches;for(const B in R){const $=R[B];if(!$.used||($!==this.sourceCache&&this.resetTileLookupCache($.id),this._setupProxiedCoordsForOrtho($,l[B],S),$.usedForTerrain))continue;const j=l[B];$.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[f.id]=C.map(B=>new $d(B,B.key,this.orthoMatrix)),this._assignTerrainTiles(C),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const F={};this._visibleDemTiles=[];for(const B of this.proxyCoords){const $=this.terrainTileForTile[B.key];if(!$)continue;const j=$.tileID.key;j in F||(this._visibleDemTiles.push($),F[j]=j)}}_assignTerrainTiles(l){this._initializing||l.forEach(f=>{if(this.terrainTileForTile[f.key])return;const v=this._findTileCoveringTileID(f,this.sourceCache);v&&(this.terrainTileForTile[f.key]=v)})}_prepareDEMTextures(){const l=this.painter.context,f=l.gl;for(const v in this.terrainTileForTile){const C=this.terrainTileForTile[v],S=C.dem;!S||C.demTexture&&!C.needsDEMTextureUpload||(l.activeTexture.set(f.TEXTURE1),qo(this.painter,C,S))}}_prepareDemTileUniforms(l,f,v,C){if(!f||null==f.demTexture)return!1;const S=l.tileID.canonical,R=Math.pow(2,f.tileID.canonical.z-S.z),F=C||"";return v[`u_dem_tl${F}`]=[S.x*R%1,S.y*R%1],v[`u_dem_scale${F}`]=R,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,f=l.gl;if(!this._emptyDepthBufferTexture){const v=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(l,v,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const f=this._visibleDemTiles.reduce((v,C)=>{if(!C.dem)return v;const S=C.dem.tree.minimums[0];return S>0&&l++,v+S},0);return l?f/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,f=l.gl;l.activeTexture.set(f.TEXTURE2);const v=this._getLoadedAreaMinimum(),C=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(v,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(C,{premultiply:!1}):S=this._emptyDEMTexture=new p.Texture(l,C,f.RGBA,{premultiply:!1}),S}setupElevationDraw(l,f,v){const C=this.painter.context,S=C.gl,R=(F=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(F),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var F;R.u_dem_size=this.sourceCache.getSource().tileSize,R.u_exaggeration=this.exaggeration();let B=null,$=null,j=1;if(v&&v.morphing&&this._useVertexMorphing){const X=v.morphing.srcDemTile,ee=v.morphing.dstDemTile;j=v.morphing.phase,X&&ee&&(this._prepareDemTileUniforms(l,X,R,"_prev")&&($=X),this._prepareDemTileUniforms(l,ee,R)&&(B=ee))}if($&&B?(C.activeTexture.set(S.TEXTURE2),B.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),C.activeTexture.set(S.TEXTURE4),$.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),R.u_dem_lerp=j):(B=this.terrainTileForTile[l.tileID.key],C.activeTexture.set(S.TEXTURE2),(this._prepareDemTileUniforms(l,B,R)?B.demTexture:this.emptyDEMTexture).bind(S.NEAREST,S.CLAMP_TO_EDGE)),C.activeTexture.set(S.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),this._depthFBO&&(R.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),R.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&B){const X=(1<<B.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;R.u_meter_to_dem=X}if(v&&v.labelPlaneMatrixInv&&(R.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),f.setTerrainUniformValues(C,R),"globe"===this.painter.transform.projection.name){const X=this.globeUniformValues(this.painter.transform,l.tileID.canonical,v&&v.useDenormalizedUpVectorScale);f.setGlobeUniformValues(C,X)}}globeUniformValues(l,f,v){const C=l.projection;return{u_tile_tl_up:C.upVector(f,0,0),u_tile_tr_up:C.upVector(f,p.EXTENT,0),u_tile_br_up:C.upVector(f,p.EXTENT,p.EXTENT),u_tile_bl_up:C.upVector(f,0,p.EXTENT),u_tile_up_scale:v?p.globeMetersToEcef(1):C.upVectorScale(f,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const f=this.painter,v=this.painter.context;0!==l.length&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(C,S,R,F,B){if("globe"===C.transform.projection.name)!function($,j,X,ee,se){const le=$.context,ae=le.gl;let ce,K;const oe=$.options.showTerrainWireframe?2:0,pe=$.transform,ge=p.globeUseCustomAntiAliasing($,le,pe),De=(bt,He)=>{if(K===bt)return;const ut=[Br[bt],"PROJECTION_GLOBE_VIEW"];ge&&ut.push("CUSTOM_ANTIALIASING"),He&&ut.push(Br[oe]),ce=$.useProgram("globeRaster",null,ut),K=bt},Me=$.colorModeForRenderPass(),Se=new p.DepthMode(ae.LEQUAL,p.DepthMode.ReadWrite,$.depthRangeFor3D);Nr.update(se);const ze=p.calculateGlobeMercatorMatrix(pe),Re=[p.mercatorXfromLng(pe.center.lng),p.mercatorYfromLat(pe.center.lat)],Xe=oe?[!1,!0]:[!1],At=$.globeSharedBuffers,Ve=[pe.width*p.exported.devicePixelRatio,pe.height*p.exported.devicePixelRatio],mt=Float32Array.from(pe.globeMatrix),nt={useDenormalizedUpVectorScale:!0};if(Xe.forEach(bt=>{const He=$.transform,ut=kc(He.zoom)*j.exaggeration();K=-1;const Lt=bt?ae.LINES:ae.TRIANGLES;for(const gt of ee){const wt=X.getTile(gt),bn=p.StencilMode.disabled,Rn=j.prevTerrainTileForTile[gt.key],an=j.terrainTileForTile[gt.key];Ud(Rn,an)&&Nr.newMorphing(gt.key,Rn,an,se,250),le.activeTexture.set(ae.TEXTURE0),wt.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const xn=Nr.getMorphValuesForProxy(gt.key),Jn=xn?1:0;xn&&p.extend$1(nt,{morphing:{srcDemTile:xn.from,dstDemTile:xn.to,phase:p.easeCubicInOut(xn.phase)}});const An=p.tileCornersToBounds(gt.canonical),ln=p.getLatitudinalLod(An.getCenter().lat),Oi=p.getGridMatrix(gt.canonical,An,ln,He.worldSize/He._pixelsPerMercatorPixel),ri=p.globeNormalizeECEF(p.globeTileBounds(gt.canonical)),Wi=Gr(He.projMatrix,mt,ze,ri,p.globeToMercatorTransition(He.zoom),Re,He.frustumCorners.TL,He.frustumCorners.TR,He.frustumCorners.BR,He.frustumCorners.BL,He.globeCenterInViewSpace,He.globeRadius,Ve,ut,Oi);if(De(Jn,bt),j.setupElevationDraw(wt,ce,nt),$.prepareDrawProgram(le,ce,gt.toUnwrapped()),At){const[Ni,Pr,qr]=bt?At.getWirefameBuffers($.context,ln):At.getGridBuffers(ln,0!==ut);ce.draw(le,Lt,Se,bn,Me,p.CullFaceMode.backCCW,Wi,"globe_raster",Ni,Pr,qr)}}}),At){const bt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&bt.push("CUSTOM_ANTIALIASING"),ce=$.useProgram("globeRaster",null,bt);for(const He of ee){const{x:ut,y:Lt,z:gt}=He.canonical,wt=0===Lt,bn=Lt===(1<<gt)-1,[Rn,an,xn,Jn]=At.getPoleBuffers(gt);if(Jn&&(wt||bn)){const An=X.getTile(He);le.activeTexture.set(ae.TEXTURE0),An.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);let ln=p.globePoleMatrixForTile(gt,ut,pe);const Oi=p.globeNormalizeECEF(p.globeTileBounds(He.canonical)),ri=(Wi,Ni)=>Wi.draw(le,ae.TRIANGLES,Se,p.StencilMode.disabled,Me,p.CullFaceMode.disabled,Gr(pe.projMatrix,ln,ln,Oi,0,Re,pe.frustumCorners.TL,pe.frustumCorners.TR,pe.frustumCorners.BR,pe.frustumCorners.BL,pe.globeCenterInViewSpace,pe.globeRadius,Ve,0),"globe_pole_raster",Ni,xn,Jn);j.setupElevationDraw(An,ce,nt),$.prepareDrawProgram(le,ce,He.toUnwrapped()),wt&&ri(ce,Rn),bn&&(ln=p.scale(p.create(),ln,[1,-1,1]),ri(ce,an))}}}}(C,S,R,F,B);else{const $=C.context,j=$.gl;let X,ee;const se=C.options.showTerrainWireframe?2:0,le=(pe,ge)=>{if(ee===pe)return;const De=[Br[pe]];ge&&De.push(Br[se]),X=C.useProgram("terrainRaster",null,De),ee=pe},ae=C.colorModeForRenderPass(),ce=new p.DepthMode(j.LEQUAL,p.DepthMode.ReadWrite,C.depthRangeFor3D);Nr.update(B);const K=C.transform,oe=kc(K.zoom)*S.exaggeration();(se?[!1,!0]:[!1]).forEach(pe=>{ee=-1;const ge=pe?j.LINES:j.TRIANGLES,[De,Me]=pe?S.getWirefameBuffer():[S.gridIndexBuffer,S.gridSegments];for(const Se of F){const ze=R.getTile(Se),Re=p.StencilMode.disabled,Xe=S.prevTerrainTileForTile[Se.key],At=S.terrainTileForTile[Se.key];Ud(Xe,At)&&Nr.newMorphing(Se.key,Xe,At,B,250),$.activeTexture.set(j.TEXTURE0),ze.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST);const Ve=Nr.getMorphValuesForProxy(Se.key),mt=Ve?1:0;let nt;Ve&&(nt={morphing:{srcDemTile:Ve.from,dstDemTile:Ve.to,phase:p.easeCubicInOut(Ve.phase)}});const bt=Ta(Se.projMatrix,Tl(Se.canonical,K.renderWorldCopies)?oe/10:oe);le(mt,pe),S.setupElevationDraw(ze,X,nt),C.prepareDrawProgram($,X,Se.toUnwrapped()),X.draw($,ge,ce,Re,ae,p.CullFaceMode.backCCW,bt,"terrain_raster",S.gridBuffer,De,Me)}})}}(f,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(0===this._drapedRenderBatches.length)return l+1;this.renderingToTexture=!0;const f=this.painter,v=this.painter.context,C=this.proxySourceCache,S=this.proxiedCoords[C.id],R=this._drapedRenderBatches.shift(),F=[],B=f.style.order;let $=0;for(const j of S){const X=C.getTileByID(j.proxyTileKey),ee=C.proxyCachedFBO[j.key]?C.proxyCachedFBO[j.key][l]:void 0,se=void 0!==ee?C.renderCache[ee]:this.pool[$++],le=void 0!==ee;if(X.texture=se.tex,le&&!se.dirty){F.push(X.tileID);continue}let ae;v.bindFramebuffer.set(se.fb.framebuffer),this.renderedToTile=!1,se.dirty&&(v.clear({color:p.Color.transparent,stencil:0}),se.dirty=!1);for(let ce=R.start;ce<=R.end;++ce){const K=f.style._layers[B[ce]];if(K.isHidden(f.transform.zoom))continue;const oe=f.style._getLayerSourceCache(K),pe=oe?this.proxyToSource[j.key][oe.id]:[j];if(!pe)continue;const ge=pe;v.viewport.set([0,0,se.fb.width,se.fb.height]),ae!==(oe?oe.id:null)&&(this._setupStencil(se,pe,K,oe),ae=oe?oe.id:null),f.renderLayer(f,oe,K,ge)}this.renderedToTile?(se.dirty=!0,F.push(X.tileID)):le||--$,5===$&&($=0,this.renderToBackBuffer(F))}return this.renderToBackBuffer(F),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),R.end+1}postRender(){}renderCacheEfficiency(l){const f=l.order.length;if(0===f)return{efficiency:100};let v,C=0,S=0,R=!1;for(let F=0;F<f;++F){const B=l._layers[l.order[F]];this._style.isLayerDraped(B)?(R&&++C,++S):R||(R=!0,v=B.id)}return 0===S?{efficiency:100}:{efficiency:100*(1-C/S),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{l=Math.min(l,f.dem.tree.minimums[0])}),0===l?l:(l-30)*this._exaggeration}raycast(l,f,v){if(!this._visibleDemTiles)return null;const C=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const R=S.tileID,F=1<<R.overscaledZ,{x:B,y:$}=R.canonical,j=B/F,X=(B+1)/F,ee=$/F,se=($+1)/F;return{minx:j,miny:ee,maxx:X,maxy:se,t:S.dem.tree.raycastRoot(j,ee,X,se,l,f,v),tile:S}});C.sort((S,R)=>(null!==S.t?S.t:Number.MAX_VALUE)-(null!==R.t?R.t:Number.MAX_VALUE));for(const S of C){if(null==S.t)return null;const R=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,l,f,v);if(null!=R)return R}return null}_createFBO(){const l=this.painter.context,f=l.gl,v=this.drapeBufferSize;l.activeTexture.set(f.TEXTURE0);const C=new p.Texture(l,{width:v[0],height:v[1],data:null},f.RGBA);C.bind(f.LINEAR,f.CLAMP_TO_EDGE);const S=l.createFramebuffer(v[0],v[1],!1);return S.colorAttachment.set(C.texture),S.depthAttachment=new Pe(l,S.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:S,tex:C,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const f=this._style._layers[l],v=f.isHidden(this.painter.transform.zoom);return"custom"===f.type?!v&&f.shouldRedrape():!v&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const v of this._style._getSources())if(v instanceof Yt){l=!0;break}if(!l)return;const f={};for(let v=0;v<this._style.order.length;++v){const C=this._style._layers[this._style.order[v]],S=this._style._getLayerSourceCache(C);if(S&&!f[S.id]&&!C.isHidden(this.painter.transform.zoom)&&"line"===C.type&&C.widthExpression()instanceof p.ZoomDependentExpression){f[S.id]=!0;for(const R of this.proxyCoords){const F=this.proxyToSource[R.key][S.id];if(F)for(const B of F)this._clearRenderCacheForTile(S.id,B)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const v in this._style._sourceCaches)if(this._style._sourceCaches[v]._source instanceof Ut){l=!0;break}if(!l)return;const f={};for(let v=0;v<this._style.order.length;++v){const C=this._style._layers[this._style.order[v]],S=this._style._getLayerSourceCache(C);if(!S||f[S.id]||C.isHidden(this.painter.transform.zoom)||"raster"!==C.type)continue;const R=C.paint.get("raster-fade-duration");for(const F of this.proxyCoords){const B=this.proxyToSource[F.key][S.id];if(B)for(const $ of B){const j=Hs(S.getTile($),S.findLoadedParent($,0),S,this.painter.transform,R);(1!==j.opacity||0!==j.mix)&&this._clearRenderCacheForTile(S.id,$)}}}}_setupDrapedRenderBatches(){const l=this._style.order,f=l.length;if(0===f)return;const v=[];let C,S=0,R=this._style._layers[l[S]];for(;!this._style.isLayerDraped(R)&&R.isHidden(this.painter.transform.zoom)&&++S<f;)R=this._style._layers[l[S]];for(;S<f;++S){const F=this._style._layers[l[S]];F.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(F)?void 0===C&&(C=S):void 0!==C&&(v.push({start:C,end:S-1}),C=void 0))}void 0!==C&&v.push({start:C,end:S-1}),this._drapedRenderBatches=v}_setupRenderCache(l){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const R=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let F=0;F<R.length;++F){const B=Object.values(R[F]);f.renderCachePool.push(...B)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,C=this._tilesDirty;for(let R=v.length-1;R>=0;R--){const F=v[R];if(f.getTileByID(F.key),void 0!==f.proxyCachedFBO[F.key]){const B=l[F.key],$=this.proxyToSource[F.key];let j=0;for(const X in $){const ee=$[X],se=B[X];if(!se||se.length!==ee.length||ee.some((le,ae)=>le!==se[ae]||C[X]&&C[X].hasOwnProperty(le.key))){j=-1;break}++j}for(const X in f.proxyCachedFBO[F.key])f.renderCache[f.proxyCachedFBO[F.key][X]].dirty=j<0||j!==Object.values(B).length}}const S=[...this._drapedRenderBatches];S.sort((R,F)=>F.end-F.start-(R.end-R.start));for(const R of S)for(const F of v){if(f.proxyCachedFBO[F.key])continue;let B=f.renderCachePool.pop();void 0===B&&f.renderCache.length<50&&(B=f.renderCache.length,f.renderCache.push(this._createFBO())),void 0!==B&&(f.proxyCachedFBO[F.key]={},f.proxyCachedFBO[F.key][R.start]=B,f.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(l,f,v,C){if(!C||!this._sourceTilesOverlap[C.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,R=S.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let F;if(v.isTileClipped())F=f.length,this._overlapStencilMode.test={func:R.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);F=1,this._overlapStencilMode.test={func:R.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+F>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=F,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(l,f){const v=this.painter,C=this.painter.context,S=C.gl;v._tileClippingMaskIDs={},C.setColorMode(p.ColorMode.disabled),C.setDepthMode(p.DepthMode.disabled);const R=v.useProgram("clippingMask");for(const F of l){const B=v._tileClippingMaskIDs[F.key]=--f;R.draw(C,S.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:S.ALWAYS,mask:0},B,255,S.KEEP,S.KEEP,S.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,nc(F.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(l){const f=this.painter.transform;if(l.x<0||l.x>f.width||l.y<0||l.y>f.height)return null;const v=[l.x,l.y,1,1];p.transformMat4$1(v,v,f.pixelMatrixInverse),p.scale$1(v,v,1/v[3]),v[0]/=f.worldSize,v[1]/=f.worldSize;const C=f._camera.position,S=p.mercatorZfromAltitude(1,f.center.lat),R=[C[0],C[1],C[2]/S,0],F=p.subtract([],v.slice(0,3),R);p.normalize(F,F);const B=this.raycast(R,F,this._exaggeration);return null!==B&&B?(p.scaleAndAdd(R,R,F,B),R[3]=R[2],R[2]*=S,R):null}drawDepth(){const l=this.painter,f=l.context,v=this.proxySourceCache,C=Math.ceil(l.width),S=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===C&&this._depthFBO.height===S||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const R=f.gl,F=f.createFramebuffer(C,S,!0);f.activeTexture.set(R.TEXTURE0);const B=new p.Texture(f,{width:C,height:S,data:null},R.RGBA);B.bind(R.NEAREST,R.CLAMP_TO_EDGE),F.colorAttachment.set(B.texture);const $=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,C,S);F.depthAttachment.set($),this._depthFBO=F,this._depthTexture=B}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,C,S]),function(R,F,B,$){if("globe"===R.transform.projection.name)return;const j=R.context,X=j.gl;j.clear({depth:1});const ee=R.useProgram("terrainDepth"),se=new p.DepthMode(X.LESS,p.DepthMode.ReadWrite,R.depthRangeFor3D);for(const le of $){const ae=B.getTile(le),ce=Ta(le.projMatrix,0);F.setupElevationDraw(ae,ee),ee.draw(j,X.TRIANGLES,se,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,ce,"terrain_depth",F.gridBuffer,F.gridIndexBuffer,F.gridNoSkirtSegments)}}(l,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,f,v){if(l.getSource()instanceof Vn)return this._setupProxiedCoordsForImageSource(l,f,v);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const C=this.proxiedCoords[l.id]=[],S=this.proxyCoords;for(let F=0;F<S.length;F++){const B=S[F],$=this._findTileCoveringTileID(B,l);if($){const j=this._createProxiedId(B,$,v[B.key]&&v[B.key][l.id]);C.push(j),this.proxyToSource[B.key][l.id]=[j]}}let R=!1;for(let F=0;F<f.length;F++){const B=l.getTile(f[F]);if(!B||!B.hasData())continue;const $=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if($&&$.tileID.canonical.z!==B.tileID.canonical.z){const j=this.proxyToSource[$.tileID.key][l.id],X=this._createProxiedId($.tileID,B,v[$.tileID.key]&&v[$.tileID.key][l.id]);j?j.splice(j.length-1,0,X):this.proxyToSource[$.tileID.key][l.id]=[X],C.push(X),R=!0}}this._sourceTilesOverlap[l.id]=R}_setupProxiedCoordsForImageSource(l,f,v){if(!l.getSource().loaded())return;const C=this.proxiedCoords[l.id]=[],S=this.proxyCoords,R=l.getSource(),F=new p.Point(R.tileID.x,R.tileID.y)._div(1<<R.tileID.z),B=R.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((j,X)=>(j.min.x=Math.min(j.min.x,X.x-F.x),j.min.y=Math.min(j.min.y,X.y-F.y),j.max.x=Math.max(j.max.x,X.x-F.x),j.max.y=Math.max(j.max.y,X.y-F.y),j),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),$=(j,X)=>{const ee=j.wrap+j.canonical.x/(1<<j.canonical.z),se=j.canonical.y/(1<<j.canonical.z),le=p.EXTENT/(1<<j.canonical.z),ae=X.wrap+X.canonical.x/(1<<X.canonical.z),ce=X.canonical.y/(1<<X.canonical.z);return ee+le<ae+B.min.x||ee>ae+B.max.x||se+le<ce+B.min.y||se>ce+B.max.y};for(let j=0;j<S.length;j++){const X=S[j];for(let ee=0;ee<f.length;ee++){const se=l.getTile(f[ee]);if(!se||!se.hasData()||$(X,se.tileID))continue;const le=this._createProxiedId(X,se,v[X.key]&&v[X.key][l.id]),ae=this.proxyToSource[X.key][l.id];ae?ae.push(le):this.proxyToSource[X.key][l.id]=[le],C.push(le)}}}_createProxiedId(l,f,v){let C=this.orthoMatrix;if(v){const S=v.find(R=>R.key===f.tileID.key);if(S)return S}if(f.tileID.key!==l.key){const S=l.canonical.z-f.tileID.canonical.z;let R,F,B;C=p.create();const $=f.tileID.wrap-l.wrap<<l.overscaledZ;S>0?(R=p.EXTENT>>S,F=R*((f.tileID.canonical.x<<S)-l.canonical.x+$),B=R*((f.tileID.canonical.y<<S)-l.canonical.y)):(R=p.EXTENT<<-S,F=p.EXTENT*(f.tileID.canonical.x-(l.canonical.x+$<<-S)),B=p.EXTENT*(f.tileID.canonical.y-(l.canonical.y<<-S))),p.ortho(C,0,R,0,R,0,1),p.translate(C,C,[F,B,0])}return new $d(f.tileID,l.key,C)}_findTileCoveringTileID(l,f){let v=f.getTile(l);if(v&&v.hasData())return v;const C=this._findCoveringTileCache[f.id],S=C[l.key];if(v=S?f.getTileByID(S):null,v&&v.hasData()||null===S)return v;let R=v?v.tileID:l,F=R.overscaledZ;const B=f.getSource().minzoom,$=[];if(!S){const X=f.getSource().maxzoom;if(l.canonical.z>=X){const ee=l.canonical.z-X;f.getSource().reparseOverscaled?(F=Math.max(l.canonical.z+2,f.transform.tileZoom),R=new p.OverscaledTileID(F,l.wrap,X,l.canonical.x>>ee,l.canonical.y>>ee)):0!==ee&&(F=X,R=new p.OverscaledTileID(F,l.wrap,X,l.canonical.x>>ee,l.canonical.y>>ee))}R.key!==l.key&&($.push(R.key),v=f.getTile(R))}const j=X=>{$.forEach(ee=>{C[ee]=X}),$.length=0};for(F-=1;F>=B&&(!v||!v.hasData());F--){v&&j(v.tileID.key);const X=R.calculateScaledKey(F);if(v=f.getTileByID(X),v&&v.hasData())break;const ee=C[X];if(null===ee)break;void 0===ee?$.push(X):v=f.getTileByID(ee)}return j(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,f){let v=this._tilesDirty[l];v||(v=this._tilesDirty[l]={}),v[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const l=function(f){let v=0;const C=new p.StructArrayLayout2ui4,S=131;for(let R=1;R<129;R++){for(let F=1;F<129;F++)v=R*S+F,C.emplaceBack(v,v+1),C.emplaceBack(v,v+S),C.emplaceBack(v+1,v+S),128===R&&C.emplaceBack(v+S,v+S+1);C.emplaceBack(v+1,v+1+S)}return C}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ti{static cacheKey(l,f,v,C){let S=`${f}${C?C.cacheKey:""}`;for(const R of v)l.usedDefines.includes(R)&&(S+=`/${R}`);return S}constructor(l,f,v,C,S,R){const F=l.gl;this.program=F.createProgram();const B=function(K){const oe=[];for(let pe=0;pe<K.length;pe++){if(null===K[pe])continue;const ge=K[pe].split(" ");oe.push(ge.pop())}return oe}(v.staticAttributes),$=C?C.getBinderAttributes():[],j=B.concat($);let X=C?C.defines():[];X=X.concat(R.map(K=>`#define ${K}`));const ee=l.isWebGL2?"#version 300 es\n":"",se=ee+X.concat(l.extStandardDerivatives&&0===ee.length?"#extension GL_OES_standard_derivatives : enable\n".concat($s):$s,$s,Ca,hf.fragmentSource,Wo.fragmentSource,v.fragmentSource).join("\n"),le=ee+X.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ca,hf.vertexSource,Wo.vertexSource,Cl.vertexSource,v.vertexSource).join("\n"),ae=F.createShader(F.FRAGMENT_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);F.shaderSource(ae,se),F.compileShader(ae),F.attachShader(this.program,ae);const ce=F.createShader(F.VERTEX_SHADER);if(F.isContextLost())this.failedToCreate=!0;else{F.shaderSource(ce,le),F.compileShader(ce),F.attachShader(this.program,ce),this.attributes={},this.numAttributes=j.length;for(let K=0;K<this.numAttributes;K++)j[K]&&(F.bindAttribLocation(this.program,K,j[K]),this.attributes[j[K]]=K);F.linkProgram(this.program),F.deleteShader(ce),F.deleteShader(ae),this.fixedUniforms=S(l),this.binderUniforms=C?C.getUniforms(l):[],R.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(K=l),u_dem_prev:new p.Uniform1i(K),u_dem_unpack:new p.Uniform4f(K),u_dem_tl:new p.Uniform2f(K),u_dem_scale:new p.Uniform1f(K),u_dem_tl_prev:new p.Uniform2f(K),u_dem_scale_prev:new p.Uniform1f(K),u_dem_size:new p.Uniform1f(K),u_dem_lerp:new p.Uniform1f(K),u_exaggeration:new p.Uniform1f(K),u_depth:new p.Uniform1i(K),u_depth_size_inv:new p.Uniform2f(K),u_meter_to_dem:new p.Uniform1f(K),u_label_plane_matrix_inv:new p.UniformMatrix4f(K)}),R.includes("GLOBE")&&(this.globeUniforms=(K=>({u_tile_tl_up:new p.Uniform3f(K),u_tile_tr_up:new p.Uniform3f(K),u_tile_br_up:new p.Uniform3f(K),u_tile_bl_up:new p.Uniform3f(K),u_tile_up_scale:new p.Uniform1f(K)}))(l)),R.includes("FOG")&&(this.fogUniforms=(K=>({u_fog_matrix:new p.UniformMatrix4f(K),u_fog_range:new p.Uniform2f(K),u_fog_color:new p.Uniform4f(K),u_fog_horizon_blend:new p.Uniform1f(K),u_fog_temporal_offset:new p.Uniform1f(K),u_frustum_tl:new p.Uniform3f(K),u_frustum_tr:new p.Uniform3f(K),u_frustum_br:new p.Uniform3f(K),u_frustum_bl:new p.Uniform3f(K),u_globe_pos:new p.Uniform3f(K),u_globe_radius:new p.Uniform1f(K),u_globe_transition:new p.Uniform1f(K),u_is_globe:new p.Uniform1i(K),u_viewport:new p.Uniform2f(K)}))(l))}var K}setTerrainUniformValues(l,f){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const C in f)v[C]&&v[C].set(this.program,C,f[C])}}setGlobeUniformValues(l,f){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const C in f)v[C]&&v[C].set(this.program,C,f[C])}}setFogUniformValues(l,f){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const C in f)v[C].set(this.program,C,f[C])}}draw(l,f,v,C,S,R,F,B,$,j,X,ee,se,le,ae){const ce=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(v),l.setStencilMode(C),l.setColorMode(S),l.setCullFace(R);for(const oe of Object.keys(this.fixedUniforms))this.fixedUniforms[oe].set(this.program,oe,F[oe]);le&&le.setUniforms(this.program,l,this.binderUniforms,ee,{zoom:se});const K={[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[f];for(const oe of X.get()){const pe=oe.vaos||(oe.vaos={});(pe[B]||(pe[B]=new ky)).bind(l,this,$,le?le.getPaintVertexBuffers():[],j,oe.vertexOffset,ae||[]),ce.drawElements(f,oe.primitiveLength*K,ce.UNSIGNED_SHORT,oe.primitiveOffset*K*2)}}}function Uu(_,l){const f=Math.pow(2,l.tileID.overscaledZ),v=l.tileSize*Math.pow(2,_.transform.tileZoom)/f,C=v*(l.tileID.canonical.x+l.tileID.wrap*f),S=v*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_tile_units_to_pixels:1/yr(l,1,_.transform.tileZoom),u_pixel_coord_upper:[C>>16,S>>16],u_pixel_coord_lower:[65535&C,65535&S]}}const Og=p.create(),Hp=(_,l,f,v,C,S,R,F,B,$,j)=>{const X=l.style.light,ee=X.properties.get("position"),se=[ee.x,ee.y,ee.z],le=p.create$1();"viewport"===X.properties.get("anchor")&&(p.fromRotation(le,-l.transform.angle),p.transformMat3(se,se,le));const ae=X.properties.get("color"),ce=l.transform,K={u_matrix:_,u_lightpos:se,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_vertical_gradient:+f,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Og,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:C,u_edge_radius:S};return"globe"===ce.projection.name&&(K.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],K.u_zoom_transition=B,K.u_inv_rot_matrix=j,K.u_merc_center=$,K.u_up_dir=ce.projection.upVector(new p.CanonicalTileID(0,0,0),$[0]*p.EXTENT,$[1]*p.EXTENT),K.u_height_lift=F),K},Fy=(_,l,f,v,C,S,R,F,B,$,j,X)=>{const ee=Hp(_,l,f,v,C,S,R,B,$,j,X),se={u_height_factor:-Math.pow(2,R.overscaledZ)/F.tileSize/8};return p.extend(ee,Uu(l,F),se)},ju=_=>({u_matrix:_}),Sr=(_,l,f)=>p.extend(ju(_),Uu(l,f)),W0=(_,l)=>({u_matrix:_,u_world:l}),q0=(_,l,f,v)=>p.extend(Sr(_,l,f),{u_world:v}),Y0=p.create(),Rg=(_,l,f,v,C,S)=>{const R=_.transform,F="globe"===R.projection.name;let B;if("map"===S.paint.get("circle-pitch-alignment"))if(F){const j=p.globePixelsToTileUnits(R.zoom,l.canonical)*R._pixelsPerMercatorPixel;B=Float32Array.from([j,0,0,j])}else B=R.calculatePixelsToTileUnitsMatrix(f);else B=new Float32Array([R.pixelsToGLUnits[0],0,0,R.pixelsToGLUnits[1]]);const $={u_camera_to_center_distance:R.cameraToCenterDistance,u_matrix:_.translatePosMatrix(l.projMatrix,f,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:B,u_inv_rot_matrix:Y0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){$.u_inv_rot_matrix=v,$.u_merc_center=C,$.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],$.u_zoom_transition=p.globeToMercatorTransition(R.zoom);const j=C[0]*p.EXTENT,X=C[1]*p.EXTENT;$.u_up_dir=R.projection.upVector(new p.CanonicalTileID(0,0,0),j,X)}return $},kg=_=>{const l=[];return"map"===_.paint.get("circle-pitch-alignment")&&l.push("PITCH_WITH_MAP"),"map"===_.paint.get("circle-pitch-scale")&&l.push("SCALE_WITH_MAP"),l},Fg=(_,l,f,v)=>{const C=p.EXTENT/f.tileSize;return{u_matrix:_,u_camera_to_center_distance:l.getCameraToCenterDistance(v),u_extrude_scale:[l.pixelsToGLUnits[0]/C,l.pixelsToGLUnits[1]/C]}},Gp=(_,l,f=1)=>({u_matrix:_,u_color:l,u_overlay:0,u_overlay_scale:f}),pf=p.create(),Zp=(_,l,f,v,C,S,R)=>{const F=_.transform,B="globe"===F.projection.name,$=B?p.globePixelsToTileUnits(F.zoom,l.canonical)*F._pixelsPerMercatorPixel:yr(f,1,S),j={u_matrix:l.projMatrix,u_extrude_scale:$,u_intensity:R,u_inv_rot_matrix:pf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){j.u_inv_rot_matrix=v,j.u_merc_center=C,j.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],j.u_zoom_transition=p.globeToMercatorTransition(F.zoom);const X=C[0]*p.EXTENT,ee=C[1]*p.EXTENT;j.u_up_dir=F.projection.upVector(new p.CanonicalTileID(0,0,0),X,ee)}return j},X0=(_,l,f,v,C,S,R)=>{const F=_.transform,B=F.calculatePixelsToTileUnitsMatrix(l);return{u_matrix:qa(_,l,f,v),u_pixels_to_tile_units:B,u_device_pixel_ratio:S,u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:C,u_texsize:Lc(f)?l.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Fc(l,_.transform),u_alpha_discard_threshold:0,u_trim_offset:R}},mf=(_,l,f,v,C)=>{const S=_.transform;return{u_matrix:qa(_,l,f,v),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:C,u_image:0,u_tile_units_to_pixels:Fc(l,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Fc(_,l){return 1/yr(_,1,l.tileZoom)}function qa(_,l,f,v){return _.translatePosMatrix(v||l.tileID.projMatrix,l,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function Lc(_){const l=_.paint.get("line-dasharray").value;return l.value||"constant"!==l.kind}const Hd=(_,l,f,v,C,S)=>{return{u_matrix:_,u_tl_parent:l,u_scale_parent:f,u_fade_t:v.mix,u_opacity:v.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(F=C.paint.get("raster-saturation"),F>0?1-1/(1.001-F):-F),u_contrast_factor:(R=C.paint.get("raster-contrast"),R>0?1/(1-R):1+R),u_spin_weights:Do(C.paint.get("raster-hue-rotate")),u_perspective_transform:S};var R,F};function Do(_){_*=Math.PI/180;const l=Math.sin(_),f=Math.cos(_);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}const Gd=p.create(),Wp=(_,l,f,v,C,S,R,F,B,$,j,X,ee,se,le,ae)=>{const ce=C.transform,K={u_is_size_zoom_constant:+("constant"===_||"source"===_),u_is_size_feature_constant:+("constant"===_||"camera"===_),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:ce.width/ce.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:R,u_coord_matrix:F,u_is_text:+B,u_pitch_with_map:+v,u_texsize:$,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Gd,u_up_vector:[0,-1,0]};return"globe"===ae.name&&(K.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],K.u_zoom_transition=X,K.u_inv_rot_matrix=se,K.u_merc_center=ee,K.u_camera_forward=ce._camera.forward(),K.u_ecef_origin=p.globeECEFOrigin(ce.globeMatrix,j.toUnwrapped()),K.u_tile_matrix=Float32Array.from(ce.globeMatrix),K.u_up_vector=le),K},$u=(_,l,f,v,C,S,R,F,B,$,j,X,ee,se,le,ae,ce)=>p.extend(Wp(_,l,f,v,C,S,R,F,B,$,X,ee,se,le,ae,ce),{u_gamma_scale:v?C.transform.cameraToCenterDistance*Math.cos(C.terrain?0:C.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+j}),gf=(_,l,f,v,C,S,R,F,B,$,j,X,ee,se,le,ae)=>p.extend($u(_,l,f,v,C,S,R,F,!0,B,!0,j,X,ee,se,le,ae),{u_texsize_icon:$,u_texture_icon:1}),Lg=(_,l,f)=>({u_matrix:_,u_opacity:l,u_color:f}),Ly=(_,l,f,v,C)=>p.extend(function(S,R,F){const B=R.imageManager.getPattern(S.toString()),{width:$,height:j}=R.imageManager.getPixelSize(),X=Math.pow(2,F.tileID.overscaledZ),ee=F.tileSize*Math.pow(2,R.transform.tileZoom)/X,se=ee*(F.tileID.canonical.x+F.tileID.wrap*X),le=ee*F.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[$,j],u_pattern_size:B.displaySize,u_tile_units_to_pixels:1/yr(F,1,R.transform.tileZoom),u_pixel_coord_upper:[se>>16,le>>16],u_pixel_coord_lower:[65535&se,65535&le]}}(v,f,C),{u_matrix:_,u_opacity:l}),Gs={fillExtrusion:_=>({u_matrix:new p.UniformMatrix4f(_),u_lightpos:new p.Uniform3f(_),u_lightintensity:new p.Uniform1f(_),u_lightcolor:new p.Uniform3f(_),u_vertical_gradient:new p.Uniform1f(_),u_opacity:new p.Uniform1f(_),u_edge_radius:new p.Uniform1f(_),u_ao:new p.Uniform2f(_),u_tile_id:new p.Uniform3f(_),u_zoom_transition:new p.Uniform1f(_),u_inv_rot_matrix:new p.UniformMatrix4f(_),u_merc_center:new p.Uniform2f(_),u_up_dir:new p.Uniform3f(_),u_height_lift:new p.Uniform1f(_)}),fillExtrusionPattern:_=>({u_matrix:new p.UniformMatrix4f(_),u_lightpos:new p.Uniform3f(_),u_lightintensity:new p.Uniform1f(_),u_lightcolor:new p.Uniform3f(_),u_vertical_gradient:new p.Uniform1f(_),u_height_factor:new p.Uniform1f(_),u_edge_radius:new p.Uniform1f(_),u_ao:new p.Uniform2f(_),u_tile_id:new p.Uniform3f(_),u_zoom_transition:new p.Uniform1f(_),u_inv_rot_matrix:new p.UniformMatrix4f(_),u_merc_center:new p.Uniform2f(_),u_up_dir:new p.Uniform3f(_),u_height_lift:new p.Uniform1f(_),u_image:new p.Uniform1i(_),u_texsize:new p.Uniform2f(_),u_pixel_coord_upper:new p.Uniform2f(_),u_pixel_coord_lower:new p.Uniform2f(_),u_tile_units_to_pixels:new p.Uniform1f(_),u_opacity:new p.Uniform1f(_)}),fill:_=>({u_matrix:new p.UniformMatrix4f(_)}),fillPattern:_=>({u_matrix:new p.UniformMatrix4f(_),u_image:new p.Uniform1i(_),u_texsize:new p.Uniform2f(_),u_pixel_coord_upper:new p.Uniform2f(_),u_pixel_coord_lower:new p.Uniform2f(_),u_tile_units_to_pixels:new p.Uniform1f(_)}),fillOutline:_=>({u_matrix:new p.UniformMatrix4f(_),u_world:new p.Uniform2f(_)}),fillOutlinePattern:_=>({u_matrix:new p.UniformMatrix4f(_),u_world:new p.Uniform2f(_),u_image:new p.Uniform1i(_),u_texsize:new p.Uniform2f(_),u_pixel_coord_upper:new p.Uniform2f(_),u_pixel_coord_lower:new p.Uniform2f(_),u_tile_units_to_pixels:new p.Uniform1f(_)}),circle:_=>({u_camera_to_center_distance:new p.Uniform1f(_),u_extrude_scale:new p.UniformMatrix2f(_),u_device_pixel_ratio:new p.Uniform1f(_),u_matrix:new p.UniformMatrix4f(_),u_inv_rot_matrix:new p.UniformMatrix4f(_),u_merc_center:new p.Uniform2f(_),u_tile_id:new p.Uniform3f(_),u_zoom_transition:new p.Uniform1f(_),u_up_dir:new p.Uniform3f(_)}),collisionBox:_=>({u_matrix:new p.UniformMatrix4f(_),u_camera_to_center_distance:new p.Uniform1f(_),u_extrude_scale:new p.Uniform2f(_)}),collisionCircle:_=>({u_matrix:new p.UniformMatrix4f(_),u_inv_matrix:new p.UniformMatrix4f(_),u_camera_to_center_distance:new p.Uniform1f(_),u_viewport_size:new p.Uniform2f(_)}),debug:_=>({u_color:new p.UniformColor(_),u_matrix:new p.UniformMatrix4f(_),u_overlay:new p.Uniform1i(_),u_overlay_scale:new p.Uniform1f(_)}),clippingMask:_=>({u_matrix:new p.UniformMatrix4f(_)}),heatmap:_=>({u_extrude_scale:new p.Uniform1f(_),u_intensity:new p.Uniform1f(_),u_matrix:new p.UniformMatrix4f(_),u_inv_rot_matrix:new p.UniformMatrix4f(_),u_merc_center:new p.Uniform2f(_),u_tile_id:new p.Uniform3f(_),u_zoom_transition:new p.Uniform1f(_),u_up_dir:new p.Uniform3f(_)}),heatmapTexture:_=>({u_image:new p.Uniform1i(_),u_color_ramp:new p.Uniform1i(_),u_opacity:new p.Uniform1f(_)}),hillshade:_=>({u_matrix:new p.UniformMatrix4f(_),u_image:new p.Uniform1i(_),u_latrange:new p.Uniform2f(_),u_light:new p.Uniform2f(_),u_shadow:new p.UniformColor(_),u_highlight:new p.UniformColor(_),u_accent:new p.UniformColor(_)}),hillshadePrepare:_=>({u_matrix:new p.UniformMatrix4f(_),u_image:new p.Uniform1i(_),u_dimension:new p.Uniform2f(_),u_zoom:new p.Uniform1f(_),u_unpack:new p.Uniform4f(_)}),line:_=>({u_matrix:new p.UniformMatrix4f(_),u_pixels_to_tile_units:new p.UniformMatrix2f(_),u_device_pixel_ratio:new p.Uniform1f(_),u_units_to_pixels:new p.Uniform2f(_),u_dash_image:new p.Uniform1i(_),u_gradient_image:new p.Uniform1i(_),u_image_height:new p.Uniform1f(_),u_texsize:new p.Uniform2f(_),u_tile_units_to_pixels:new p.Uniform1f(_),u_alpha_discard_threshold:new p.Uniform1f(_),u_trim_offset:new p.Uniform2f(_)}),linePattern:_=>({u_matrix:new p.UniformMatrix4f(_),u_texsize:new p.Uniform2f(_),u_pixels_to_tile_units:new p.UniformMatrix2f(_),u_device_pixel_ratio:new p.Uniform1f(_),u_image:new p.Uniform1i(_),u_units_to_pixels:new p.Uniform2f(_),u_tile_units_to_pixels:new p.Uniform1f(_),u_alpha_discard_threshold:new p.Uniform1f(_)}),raster:_=>({u_matrix:new p.UniformMatrix4f(_),u_tl_parent:new p.Uniform2f(_),u_scale_parent:new p.Uniform1f(_),u_fade_t:new p.Uniform1f(_),u_opacity:new p.Uniform1f(_),u_image0:new p.Uniform1i(_),u_image1:new p.Uniform1i(_),u_brightness_low:new p.Uniform1f(_),u_brightness_high:new p.Uniform1f(_),u_saturation_factor:new p.Uniform1f(_),u_contrast_factor:new p.Uniform1f(_),u_spin_weights:new p.Uniform3f(_),u_perspective_transform:new p.Uniform2f(_)}),symbolIcon:_=>({u_is_size_zoom_constant:new p.Uniform1i(_),u_is_size_feature_constant:new p.Uniform1i(_),u_size_t:new p.Uniform1f(_),u_size:new p.Uniform1f(_),u_camera_to_center_distance:new p.Uniform1f(_),u_rotate_symbol:new p.Uniform1i(_),u_aspect_ratio:new p.Uniform1f(_),u_fade_change:new p.Uniform1f(_),u_matrix:new p.UniformMatrix4f(_),u_label_plane_matrix:new p.UniformMatrix4f(_),u_coord_matrix:new p.UniformMatrix4f(_),u_is_text:new p.Uniform1i(_),u_pitch_with_map:new p.Uniform1i(_),u_texsize:new p.Uniform2f(_),u_tile_id:new p.Uniform3f(_),u_zoom_transition:new p.Uniform1f(_),u_inv_rot_matrix:new p.UniformMatrix4f(_),u_merc_center:new p.Uniform2f(_),u_camera_forward:new p.Uniform3f(_),u_tile_matrix:new p.UniformMatrix4f(_),u_up_vector:new p.Uniform3f(_),u_ecef_origin:new p.Uniform3f(_),u_texture:new p.Uniform1i(_)}),symbolSDF:_=>({u_is_size_zoom_constant:new p.Uniform1i(_),u_is_size_feature_constant:new p.Uniform1i(_),u_size_t:new p.Uniform1f(_),u_size:new p.Uniform1f(_),u_camera_to_center_distance:new p.Uniform1f(_),u_rotate_symbol:new p.Uniform1i(_),u_aspect_ratio:new p.Uniform1f(_),u_fade_change:new p.Uniform1f(_),u_matrix:new p.UniformMatrix4f(_),u_label_plane_matrix:new p.UniformMatrix4f(_),u_coord_matrix:new p.UniformMatrix4f(_),u_is_text:new p.Uniform1i(_),u_pitch_with_map:new p.Uniform1i(_),u_texsize:new p.Uniform2f(_),u_texture:new p.Uniform1i(_),u_gamma_scale:new p.Uniform1f(_),u_device_pixel_ratio:new p.Uniform1f(_),u_tile_id:new p.Uniform3f(_),u_zoom_transition:new p.Uniform1f(_),u_inv_rot_matrix:new p.UniformMatrix4f(_),u_merc_center:new p.Uniform2f(_),u_camera_forward:new p.Uniform3f(_),u_tile_matrix:new p.UniformMatrix4f(_),u_up_vector:new p.Uniform3f(_),u_ecef_origin:new p.Uniform3f(_),u_is_halo:new p.Uniform1i(_)}),symbolTextAndIcon:_=>({u_is_size_zoom_constant:new p.Uniform1i(_),u_is_size_feature_constant:new p.Uniform1i(_),u_size_t:new p.Uniform1f(_),u_size:new p.Uniform1f(_),u_camera_to_center_distance:new p.Uniform1f(_),u_rotate_symbol:new p.Uniform1i(_),u_aspect_ratio:new p.Uniform1f(_),u_fade_change:new p.Uniform1f(_),u_matrix:new p.UniformMatrix4f(_),u_label_plane_matrix:new p.UniformMatrix4f(_),u_coord_matrix:new p.UniformMatrix4f(_),u_is_text:new p.Uniform1i(_),u_pitch_with_map:new p.Uniform1i(_),u_texsize:new p.Uniform2f(_),u_texsize_icon:new p.Uniform2f(_),u_texture:new p.Uniform1i(_),u_texture_icon:new p.Uniform1i(_),u_gamma_scale:new p.Uniform1f(_),u_device_pixel_ratio:new p.Uniform1f(_),u_is_halo:new p.Uniform1i(_)}),background:_=>({u_matrix:new p.UniformMatrix4f(_),u_opacity:new p.Uniform1f(_),u_color:new p.UniformColor(_)}),backgroundPattern:_=>({u_matrix:new p.UniformMatrix4f(_),u_opacity:new p.Uniform1f(_),u_image:new p.Uniform1i(_),u_pattern_tl:new p.Uniform2f(_),u_pattern_br:new p.Uniform2f(_),u_texsize:new p.Uniform2f(_),u_pattern_size:new p.Uniform2f(_),u_pixel_coord_upper:new p.Uniform2f(_),u_pixel_coord_lower:new p.Uniform2f(_),u_tile_units_to_pixels:new p.Uniform1f(_)}),terrainRaster:tc,terrainDepth:tc,skybox:_=>({u_matrix:new p.UniformMatrix4f(_),u_sun_direction:new p.Uniform3f(_),u_cubemap:new p.Uniform1i(_),u_opacity:new p.Uniform1f(_),u_temporal_offset:new p.Uniform1f(_)}),skyboxGradient:_=>({u_matrix:new p.UniformMatrix4f(_),u_color_ramp:new p.Uniform1i(_),u_center_direction:new p.Uniform3f(_),u_radius:new p.Uniform1f(_),u_opacity:new p.Uniform1f(_),u_temporal_offset:new p.Uniform1f(_)}),skyboxCapture:_=>({u_matrix_3f:new p.UniformMatrix3f(_),u_sun_direction:new p.Uniform3f(_),u_sun_intensity:new p.Uniform1f(_),u_color_tint_r:new p.Uniform4f(_),u_color_tint_m:new p.Uniform4f(_),u_luminance:new p.Uniform1f(_)}),globeRaster:_=>({u_proj_matrix:new p.UniformMatrix4f(_),u_globe_matrix:new p.UniformMatrix4f(_),u_normalize_matrix:new p.UniformMatrix4f(_),u_merc_matrix:new p.UniformMatrix4f(_),u_zoom_transition:new p.Uniform1f(_),u_merc_center:new p.Uniform2f(_),u_image0:new p.Uniform1i(_),u_grid_matrix:new p.UniformMatrix3f(_),u_skirt_height:new p.Uniform1f(_),u_frustum_tl:new p.Uniform3f(_),u_frustum_tr:new p.Uniform3f(_),u_frustum_br:new p.Uniform3f(_),u_frustum_bl:new p.Uniform3f(_),u_globe_pos:new p.Uniform3f(_),u_globe_radius:new p.Uniform1f(_),u_viewport:new p.Uniform2f(_)}),globeAtmosphere:_=>({u_frustum_tl:new p.Uniform3f(_),u_frustum_tr:new p.Uniform3f(_),u_frustum_br:new p.Uniform3f(_),u_frustum_bl:new p.Uniform3f(_),u_horizon:new p.Uniform1f(_),u_transition:new p.Uniform1f(_),u_fadeout_range:new p.Uniform1f(_),u_color:new p.Uniform4f(_),u_high_color:new p.Uniform4f(_),u_space_color:new p.Uniform4f(_),u_star_intensity:new p.Uniform1f(_),u_star_density:new p.Uniform1f(_),u_star_size:new p.Uniform1f(_),u_temporal_offset:new p.Uniform1f(_),u_horizon_angle:new p.Uniform1f(_),u_rotation_matrix:new p.UniformMatrix4f(_)})};let Ml;function zr(_,l,f,v,C,S,R){const F=_.context,B=F.gl,$=_.transform,j=_.useProgram("collisionBox"),X=[];let ee=0,se=0;for(let ge=0;ge<v.length;ge++){const De=v[ge],Me=l.getTile(De),Se=Me.getBucket(f);if(!Se)continue;const ze=xs(De,Se,$);let Re=ze;0===C[0]&&0===C[1]||(Re=_.translatePosMatrix(ze,Me,C,S));const Xe=R?Se.textCollisionBox:Se.iconCollisionBox,At=Se.collisionCircleArray;if(At.length>0){const Ve=p.create(),mt=Re;p.mul(Ve,Se.placementInvProjMatrix,$.glCoordMatrix),p.mul(Ve,Ve,Se.placementViewportMatrix),X.push({circleArray:At,circleOffset:se,transform:mt,invTransform:Ve,projection:Se.getProjection()}),ee+=At.length/4,se=ee}Xe&&(_.terrain&&_.terrain.setupElevationDraw(Me,j),j.draw(F,B.LINES,p.DepthMode.disabled,p.StencilMode.disabled,_.colorModeForRenderPass(),p.CullFaceMode.disabled,Fg(Re,$,Me,Se.getProjection()),f.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,null,$.zoom,null,[Xe.collisionVertexBuffer,Xe.collisionVertexBufferExt]))}if(!R||!X.length)return;const le=_.useProgram("collisionCircle"),ae=new p.StructArrayLayout2f1f2i16;ae.resize(4*ee),ae._trim();let ce=0;for(const ge of X)for(let De=0;De<ge.circleArray.length/4;De++){const Me=4*De,Se=ge.circleArray[Me+0],ze=ge.circleArray[Me+1],Re=ge.circleArray[Me+2],Xe=ge.circleArray[Me+3];ae.emplace(ce++,Se,ze,Re,Xe,0),ae.emplace(ce++,Se,ze,Re,Xe,1),ae.emplace(ce++,Se,ze,Re,Xe,2),ae.emplace(ce++,Se,ze,Re,Xe,3)}(!Ml||Ml.length<2*ee)&&(Ml=function(ge){const De=2*ge,Me=new p.StructArrayLayout3ui6;Me.resize(De),Me._trim();for(let Se=0;Se<De;Se++){const ze=6*Se;Me.uint16[ze+0]=4*Se+0,Me.uint16[ze+1]=4*Se+1,Me.uint16[ze+2]=4*Se+2,Me.uint16[ze+3]=4*Se+2,Me.uint16[ze+4]=4*Se+3,Me.uint16[ze+5]=4*Se+0}return Me}(ee));const K=F.createIndexBuffer(Ml,!0),oe=F.createVertexBuffer(ae,p.collisionCircleLayout.members,!0);for(const ge of X){const De={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(pe=$).getCameraToCenterDistance(ge.projection),u_viewport_size:[pe.width,pe.height]};le.draw(F,B.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,_.colorModeForRenderPass(),p.CullFaceMode.disabled,De,f.id,oe,K,p.SegmentVector.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,$.zoom)}var pe;oe.destroy(),K.destroy()}const Zd=p.create();function qp({width:_,height:l,anchor:f,textOffset:v,textScale:C},S){const{horizontalAlign:R,verticalAlign:F}=p.getAnchorAlignment(f),B=-(R-.5)*_,$=-(F-.5)*l,j=p.evaluateVariableOffset(f,v);return new p.Point((B/C+j[0])*S,($/C+j[1])*S)}function Yp(_,l,f,v,C,S,R,F,B,$,j){const X=_.text.placedSymbolArray,ee=_.text.dynamicLayoutVertexArray,se=_.icon.dynamicLayoutVertexArray,le={},ae=_.getProjection(),ce=or(F,ae,S),K=S.elevation,oe=ae.upVectorScale(F.canonical,S.center.lat,S.worldSize).metersToTile;ee.clear();for(let pe=0;pe<X.length;pe++){const ge=X.get(pe),{tileAnchorX:De,tileAnchorY:Me,numGlyphs:Se}=ge,ze=ge.hidden||!ge.crossTileID||_.allowVerticalPlacement&&!ge.placedOrientation?null:v[ge.crossTileID];if(ze){let Re=0,Xe=0,At=0;if(K){const wt=K?K.getAtTileOffset(F,De,Me):0,[bn,Rn,an]=ae.upVector(F.canonical,De,Me);Re=wt*bn*oe,Xe=wt*Rn*oe,At=wt*an*oe}let[Ve,mt,nt,bt]=Cr(ge.projectedAnchorX+Re,ge.projectedAnchorY+Xe,ge.projectedAnchorZ+At,f?ce:R);const He=Jl(S.getCameraToCenterDistance(ae),bt);let ut=C.evaluateSizeForFeature(_.textSizeData,$,ge)*He/p.ONE_EM;f&&(ut*=_.tilePixelRatio/B);const Lt=qp(ze,ut);f?(({x:Ve,y:mt,z:nt}=ae.projectTilePoint(De+Lt.x,Me+Lt.y,F.canonical)),[Ve,mt,nt]=Cr(Ve+Re,mt+Xe,nt+At,R)):(l&&Lt._rotate(-S.angle),Ve+=Lt.x,mt+=Lt.y,nt=0);const gt=_.allowVerticalPlacement&&ge.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let wt=0;wt<Se;wt++)p.addDynamicAttributes(ee,Ve,mt,nt,gt);j&&ge.associatedIconIndex>=0&&(le[ge.associatedIconIndex]={x:Ve,y:mt,z:nt,angle:gt})}else bs(Se,ee)}if(j){se.clear();const pe=_.icon.placedSymbolArray;for(let ge=0;ge<pe.length;ge++){const De=pe.get(ge),{numGlyphs:Me}=De,Se=le[ge];if(De.hidden||!Se)bs(Me,se);else{const{x:ze,y:Re,z:Xe,angle:At}=Se;for(let Ve=0;Ve<Me;Ve++)p.addDynamicAttributes(se,ze,Re,Xe,At)}}_.icon.dynamicLayoutVertexBuffer.updateData(se)}_.text.dynamicLayoutVertexBuffer.updateData(ee)}function Wd(_,l,f){return f.iconsInText&&l?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function qd(_,l,f,v,C,S,R,F,B,$,j,X){const ee=_.context,se=ee.gl,le=_.transform,ae="map"===F,ce="map"===B,K=ae&&"point"!==f.layout.get("symbol-placement"),oe=ae&&!ce&&!K,pe=void 0!==f.layout.get("symbol-sort-key").constantOr(1);let ge=!1;const De=_.depthModeForSublayer(0,p.DepthMode.ReadOnly),Me=[p.mercatorXfromLng(le.center.lng),p.mercatorYfromLat(le.center.lat)],Se=f.layout.get("text-variable-anchor"),ze="globe"===le.projection.name,Re=[],Xe=[0,-1,0];let At=Xe;!ze&&!le.mercatorFromTransition||ae||(At=function(Ve){const mt=Ve._camera.getWorldToCamera(Ve.worldSize,1),nt=p.multiply([],mt,Ve.globeMatrix);p.invert(nt,nt);const bt=[0,0,0],He=[0,1,0,0];return p.transformMat4$1(He,He,nt),bt[0]=He[0],bt[1]=He[1],bt[2]=He[2],p.normalize(bt,bt),bt}(le));for(const Ve of v){const mt=l.getTile(Ve),nt=mt.getBucket(f);if(!nt||"mercator"===nt.projection.name&&ze)continue;const bt=C?nt.text:nt.icon;if(!bt||nt.fullyClipped||!bt.segments.get().length)continue;const He=bt.programConfigurations.get(f.id),ut=C||nt.sdfIcons,Lt=C?nt.textSizeData:nt.iconSizeData,gt=ce||0!==le.pitch,wt=p.evaluateSizeForZoom(Lt,le.zoom);let bn,Rn,an,xn,Jn=[0,0],An=null;if(C)Rn=mt.glyphAtlasTexture,an=se.LINEAR,bn=mt.glyphAtlasTexture.size,nt.iconsInText&&(Jn=mt.imageAtlasTexture.size,An=mt.imageAtlasTexture,xn=gt||_.options.rotating||_.options.zooming||"composite"===Lt.kind||"camera"===Lt.kind?se.LINEAR:se.NEAREST);else{const Ja=1!==f.layout.get("icon-size").constantOr(0)||nt.iconsNeedLinear;Rn=mt.imageAtlasTexture,an=ut||_.options.rotating||_.options.zooming||Ja||gt?se.LINEAR:se.NEAREST,bn=mt.imageAtlasTexture.size}const ln="globe"===nt.projection.name,Oi=ln?At:Xe,ri=ln?p.globeToMercatorTransition(le.zoom):0,Wi=or(Ve,nt.getProjection(),le),Ni=le.calculatePixelsToTileUnitsMatrix(mt),Pr=ct(Wi,mt.tileID.canonical,ce,ae,le,nt.getProjection(),Ni),qr=_.terrain&&ce&&K?p.invert(p.create(),Pr):Zd,jn=rr(Wi,mt.tileID.canonical,ce,ae,le,nt.getProjection(),Ni),Oo=Se&&nt.hasTextData(),Bi="none"!==f.layout.get("icon-text-fit")&&Oo&&nt.hasIconData();if(K){const Ja=le.elevation,ac=Ja?Ja.getAtTileOffsetFunc(Ve,le.center.lat,le.worldSize,nt.getProjection()):null,lc=Us(Wi,mt.tileID.canonical,ce,ae,le,nt.getProjection(),Ni);Vd(nt,Wi,_,C,lc,jn,ce,$,ac,Ve)}const _i=K||C&&Se||Bi,yi=_.translatePosMatrix(Wi,mt,S,R),Or=_i?Zd:Pr,pr=_.translatePosMatrix(jn,mt,S,R,!0),Ri=nt.getProjection().createInversionMatrix(le,Ve.canonical),us=[];_.terrainRenderModeElevated()&&ce&&us.push("PITCH_WITH_MAP_TERRAIN"),ln&&us.push("PROJECTION_GLOBE_VIEW"),_i&&us.push("PROJECTED_POS_ON_VIEWPORT");const ua=ut&&0!==f.paint.get(C?"text-halo-width":"icon-halo-width").constantOr(1);let Yc;Yc=ut?nt.iconsInText?gf(Lt.kind,wt,oe,ce,_,yi,Or,pr,bn,Jn,Ve,ri,Me,Ri,Oi,nt.getProjection()):$u(Lt.kind,wt,oe,ce,_,yi,Or,pr,C,bn,!0,Ve,ri,Me,Ri,Oi,nt.getProjection()):Wp(Lt.kind,wt,oe,ce,_,yi,Or,pr,C,bn,Ve,ri,Me,Ri,Oi,nt.getProjection());const ed={program:_.useProgram(Wd(ut,C,nt),He,us),buffers:bt,uniformValues:Yc,atlasTexture:Rn,atlasTextureIcon:An,atlasInterpolation:an,atlasInterpolationIcon:xn,isSDF:ut,hasHalo:ua,tile:mt,labelPlaneMatrixInv:qr};if(pe&&nt.canOverlap){ge=!0;const Ja=bt.segments.get();for(const ac of Ja)Re.push({segments:new p.SegmentVector([ac]),sortKey:ac.sortKey,state:ed})}else Re.push({segments:bt.segments,sortKey:0,state:ed})}ge&&Re.sort((Ve,mt)=>Ve.sortKey-mt.sortKey);for(const Ve of Re){const mt=Ve.state;if(_.terrain&&_.terrain.setupElevationDraw(mt.tile,mt.program,{useDepthForOcclusion:!ze,labelPlaneMatrixInv:mt.labelPlaneMatrixInv}),ee.activeTexture.set(se.TEXTURE0),mt.atlasTexture.bind(mt.atlasInterpolation,se.CLAMP_TO_EDGE),mt.atlasTextureIcon&&(ee.activeTexture.set(se.TEXTURE1),mt.atlasTextureIcon&&mt.atlasTextureIcon.bind(mt.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),mt.isSDF){const nt=mt.uniformValues;mt.hasHalo&&(nt.u_is_halo=1,Yd(mt.buffers,Ve.segments,f,_,mt.program,De,j,X,nt)),nt.u_is_halo=0}Yd(mt.buffers,Ve.segments,f,_,mt.program,De,j,X,mt.uniformValues)}}function Yd(_,l,f,v,C,S,R,F,B){const $=v.context,j=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.globeExtVertexBuffer];C.draw($,$.gl.TRIANGLES,S,R,F,p.CullFaceMode.disabled,B,f.id,_.layoutVertexBuffer,_.indexBuffer,l,f.paint,v.transform.zoom,_.programConfigurations.get(f.id),j)}function Ng(_,l,f,v,C,S,R){const F=_.context.gl,B=f.paint.get("fill-pattern"),$=B&&B.constantOr(1);let j,X,ee,se,le;R?(X=$&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=F.LINES):(X=$?"fillPattern":"fill",j=F.TRIANGLES);for(const ae of v){const ce=l.getTile(ae);if($&&!ce.patternsLoaded())continue;const K=ce.getBucket(f);if(!K)continue;_.prepareDrawTile();const oe=K.programConfigurations.get(f.id),pe=_.useProgram(X,oe);$&&(_.context.activeTexture.set(F.TEXTURE0),ce.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),oe.updatePaintBuffers());const ge=B.constantOr(null);if(ge&&ce.imageAtlas){const Me=ce.imageAtlas.patternPositions[ge.toString()];Me&&oe.setConstantPatternPositions(Me)}const De=_.translatePosMatrix(ae.projMatrix,ce,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(R){se=K.indexBuffer2,le=K.segments2;const Me=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];ee="fillOutlinePattern"===X&&$?q0(De,_,ce,Me):W0(De,Me)}else se=K.indexBuffer,le=K.segments,ee=$?Sr(De,_,ce):ju(De);_.prepareDrawProgram(_.context,pe,ae.toUnwrapped()),pe.draw(_.context,j,C,_.stencilModeForClipping(ae),S,p.CullFaceMode.disabled,ee,f.id,K.layoutVertexBuffer,se,le,f.paint,_.transform.zoom,oe)}}function Hu(_,l,f,v,C,S,R){const F=_.context,B=F.gl,$=_.transform,j=f.paint.get("fill-extrusion-pattern"),X=j.constantOr(1),ee=f.paint.get("fill-extrusion-opacity"),se=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),f.paint.get("fill-extrusion-ambient-occlusion-radius")],le=f.layout.get("fill-extrusion-edge-radius"),ae=le>0&&!f.paint.get("fill-extrusion-rounded-roof"),ce=ae?0:le,K="globe"===$.projection.name?p.fillExtrusionHeightLift():0,oe="globe"===$.projection.name,pe=oe?p.globeToMercatorTransition($.zoom):0,ge=[p.mercatorXfromLng($.center.lng),p.mercatorYfromLat($.center.lat)],De=[];oe&&De.push("PROJECTION_GLOBE_VIEW"),se[0]>0&&De.push("FAUX_AO"),ae&&De.push("ZERO_ROOF_RADIUS");for(const Me of v){const Se=l.getTile(Me),ze=Se.getBucket(f);if(!ze||ze.projection.name!==$.projection.name)continue;const Re=ze.programConfigurations.get(f.id),Xe=_.useProgram(X?"fillExtrusionPattern":"fillExtrusion",Re,De);if(_.terrain){const ut=_.terrain;if(_.style.terrainSetForDrapingOnly())ut.setupElevationDraw(Se,Xe,{useMeterToDem:!0});else{if(!ze.enableTerrain)continue;if(ut.setupElevationDraw(Se,Xe,{useMeterToDem:!0}),_f(F,l,Me,ze,f,ut),!ze.centroidVertexBuffer){const Lt=Xe.attributes.a_centroid_pos;void 0!==Lt&&B.vertexAttrib2f(Lt,0,0)}}}X&&(_.context.activeTexture.set(B.TEXTURE0),Se.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Re.updatePaintBuffers());const At=j.constantOr(null);if(At&&Se.imageAtlas){const ut=Se.imageAtlas.patternPositions[At.toString()];ut&&Re.setConstantPatternPositions(ut)}const Ve=_.translatePosMatrix(Me.projMatrix,Se,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),mt=$.projection.createInversionMatrix($,Me.canonical),nt=f.paint.get("fill-extrusion-vertical-gradient"),bt=X?Fy(Ve,_,nt,ee,se,ce,Me,Se,K,pe,ge,mt):Hp(Ve,_,nt,ee,se,ce,Me,K,pe,ge,mt);_.prepareDrawProgram(F,Xe,Me.toUnwrapped());const He=[];_.terrain&&He.push(ze.centroidVertexBuffer),oe&&He.push(ze.layoutVertexExtBuffer),Xe.draw(F,F.gl.TRIANGLES,C,S,R,p.CullFaceMode.backCCW,bt,f.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,f.paint,_.transform.zoom,Re,He)}}function _f(_,l,f,v,C,S){const R=[K=>{let oe=K.canonical.x-1,pe=K.wrap;return oe<0&&(oe=(1<<K.canonical.z)-1,pe--),new p.OverscaledTileID(K.overscaledZ,pe,K.canonical.z,oe,K.canonical.y)},K=>{let oe=K.canonical.x+1,pe=K.wrap;return oe===1<<K.canonical.z&&(oe=0,pe++),new p.OverscaledTileID(K.overscaledZ,pe,K.canonical.z,oe,K.canonical.y)},K=>new p.OverscaledTileID(K.overscaledZ,K.wrap,K.canonical.z,K.canonical.x,(0===K.canonical.y?1<<K.canonical.z:K.canonical.y)-1),K=>new p.OverscaledTileID(K.overscaledZ,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y===(1<<K.canonical.z)-1?0:K.canonical.y+1)],F=K=>{const oe=l.getSource().minzoom,pe=De=>{const Me=l.getTileByID(De);if(Me&&Me.hasData())return Me.getBucket(C)},ge=[0,-1,1];for(const De of ge){if(K.overscaledZ+De<oe)continue;const Me=pe(K.calculateScaledKey(K.overscaledZ+De));if(Me)return Me}},B=[0,0,0],$=(K,oe)=>(B[0]=Math.min(K.min.y,oe.min.y),B[1]=Math.max(K.max.y,oe.max.y),B[2]=p.EXTENT-oe.min.x>K.max.x?oe.min.x-p.EXTENT:K.max.x,B),j=(K,oe)=>(B[0]=Math.min(K.min.x,oe.min.x),B[1]=Math.max(K.max.x,oe.max.x),B[2]=p.EXTENT-oe.min.y>K.max.y?oe.min.y-p.EXTENT:K.max.y,B),X=[(K,oe)=>$(K,oe),(K,oe)=>$(oe,K),(K,oe)=>j(K,oe),(K,oe)=>j(oe,K)],ee=new p.Point(0,0);let se,le,ae;const ce=(K,oe,pe,ge,De)=>{const Me=[[ge?pe:K,ge?K:pe,0],[ge?pe:oe,ge?oe:pe,0]],Se=De<0?p.EXTENT+De:De,ze=[ge?Se:(K+oe)/2,ge?(K+oe)/2:Se,0];return 0===pe&&De<0||0!==pe&&De>0?S.getForTilePoints(ae,[ze],!0,le):Me.push(ze),S.getForTilePoints(f,Me,!0,se),Math.max(Me[0][2],Me[1][2],ze[2])/S.exaggeration()};for(let K=0;K<4;K++){const oe=(K<2?1:5)-K,pe=v.borders[K];if(0===pe.length)continue;const ge=ae=R[K](f),De=F(ge);if(!(De&&De instanceof p.FillExtrusionBucket&&De.enableTerrain)||v.borderDoneWithNeighborZ[K]===De.canonical.z&&De.borderDoneWithNeighborZ[oe]===v.canonical.z||(le=S.findDEMTileFor(ge),!le||!le.dem))continue;if(!se){const Re=S.findDEMTileFor(f);if(!Re||!Re.dem)return;se=Re}const Me=De.borders[oe];let Se=0;const ze=De.borderDoneWithNeighborZ[oe]!==v.canonical.z;if(v.canonical.z===De.canonical.z){for(let Re=0;Re<pe.length;Re++){const Xe=v.featuresOnBorder[pe[Re]],At=Xe.borders[K];let Ve;for(;Se<Me.length&&(Ve=De.featuresOnBorder[Me[Se]],!(Ve.borders[oe][1]>At[0]+3));)ze&&De.encodeCentroid(void 0,Ve,!1),Se++;if(Ve&&Se<Me.length){const mt=Se;let nt=0;for(;!(Ve.borders[oe][0]>At[1]-3)&&(nt++,++Se!==Me.length);)Ve=De.featuresOnBorder[Me[Se]];if(Ve=De.featuresOnBorder[Me[mt]],Xe.intersectsCount()>1||Ve.intersectsCount()>1||1!==nt){1!==nt&&(Se=mt),v.encodeCentroid(void 0,Xe,!1),ze&&De.encodeCentroid(void 0,Ve,!1);continue}const bt=X[K](Xe,Ve),He=K%2?p.EXTENT-1:0;ee.x=ce(bt[0],Math.min(p.EXTENT-1,bt[1]),He,K<2,bt[2]),ee.y=0,v.encodeCentroid(ee,Xe,!1),ze&&De.encodeCentroid(ee,Ve,!1)}else v.encodeCentroid(void 0,Xe,!1)}v.borderDoneWithNeighborZ[K]=De.canonical.z,v.needsCentroidUpdate=!0,ze&&(De.borderDoneWithNeighborZ[oe]=v.canonical.z,De.needsCentroidUpdate=!0)}else{for(const Re of pe)v.encodeCentroid(void 0,v.featuresOnBorder[Re],!1);if(ze){for(const Re of Me)De.encodeCentroid(void 0,De.featuresOnBorder[Re],!1);De.borderDoneWithNeighborZ[oe]=v.canonical.z,De.needsCentroidUpdate=!0}v.borderDoneWithNeighborZ[K]=De.canonical.z,v.needsCentroidUpdate=!0}}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&0!==v.centroidVertexArray.length)&&v.uploadCentroid(_)}const Nc=new p.Color(1,0,0,1),Xd=new p.Color(0,1,0,1),Ny=new p.Color(0,0,1,1),By=new p.Color(1,0,1,1),K0=new p.Color(0,1,1,1);function zy(_,l,f){const v=_.context,C=_.transform,S=v.gl,R="globe"===C.projection.name,F=R?["PROJECTION_GLOBE_VIEW"]:null;let B=f.projMatrix;if(R&&p.globeToMercatorTransition(C.zoom)>0){const Xe=p.transitionTileAABBinECEF(f.canonical,C),At=p.globeDenormalizeECEF(Xe);B=p.multiply(new Float32Array(16),C.globeMatrix,At),p.multiply(B,C.projMatrix,B)}const $=_.useProgram("debug",null,F),j=l.getTileByID(f.key);_.terrain&&_.terrain.setupElevationDraw(j,$);const X=p.DepthMode.disabled,ee=p.StencilMode.disabled,se=_.colorModeForRenderPass();v.activeTexture.set(S.TEXTURE0),_.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),R?j._makeGlobeTileDebugBuffers(_.context,C):j._makeDebugTileBoundsBuffers(_.context,C.projection);const ae=j._tileDebugBuffer||_.debugBuffer,ce=j._tileDebugIndexBuffer||_.debugIndexBuffer,K=j._tileDebugSegments||_.debugSegments;$.draw(v,S.LINE_STRIP,X,ee,se,p.CullFaceMode.disabled,Gp(B,p.Color.red),"$debug",ae,ce,K,null,null,null,[j._globeTileDebugBorderBuffer]);const oe=j.latestRawTileData,pe=Math.floor((oe&&oe.byteLength||0)/1024),ge=l.getTile(f).tileSize,De=512/Math.min(ge,512)*(f.overscaledZ/C.zoom)*.5;let Me=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Me+=` => ${f.overscaledZ}`),Me+=` ${pe}kb`,function(Xe,At){Xe.initDebugOverlayCanvas();const Ve=Xe.debugOverlayCanvas,mt=Xe.context.gl,nt=Xe.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,Ve.width,Ve.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(At,5,5),nt.strokeText(At,5,5),Xe.debugOverlayTexture.update(Ve),Xe.debugOverlayTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE)}(_,Me);const Se=j._tileDebugTextBuffer||_.debugBuffer,ze=j._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,Re=j._tileDebugTextSegments||_.debugSegments;$.draw(v,S.TRIANGLES,X,ee,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,Gp(B,p.Color.transparent,De),"$debug",Se,ze,Re,null,null,null,[j._globeTileDebugTextBuffer])}function Xp(_,l,f,v){Gu(_,0,l+f/2,_.transform.width,f,v)}function yf(_,l,f,v){Gu(_,l-f/2,0,f,_.transform.height,v)}function Gu(_,l,f,v,C,S){const R=_.context,F=R.gl;F.enable(F.SCISSOR_TEST),F.scissor(l*p.exported.devicePixelRatio,f*p.exported.devicePixelRatio,v*p.exported.devicePixelRatio,C*p.exported.devicePixelRatio),R.clear({color:S}),F.disable(F.SCISSOR_TEST)}const vf=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Kp}=vf;function Dl(_,l,f,v){_.emplaceBack(l,f,v)}class ic{constructor(l){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,Dl(this.vertexArray,-1,-1,1),Dl(this.vertexArray,1,-1,1),Dl(this.vertexArray,-1,1,1),Dl(this.vertexArray,1,1,1),Dl(this.vertexArray,-1,-1,-1),Dl(this.vertexArray,1,-1,-1),Dl(this.vertexArray,-1,1,-1),Dl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,Kp),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function Zs(_,l,f,v,C,S){const R=_.gl,F=l.paint.get("sky-atmosphere-color"),B=l.paint.get("sky-atmosphere-halo-color"),$=l.paint.get("sky-atmosphere-sun-intensity"),j={u_matrix_3f:p.fromMat4(p.create$1(),v),u_sun_direction:C,u_sun_intensity:$,u_color_tint_r:[(le=F).r,le.g,le.b,le.a],u_color_tint_m:[(ae=B).r,ae.g,ae.b,ae.a],u_luminance:5e-5};var le,ae;R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+S,l.skyboxTexture,0),f.draw(_,R.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,j,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Bc=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Kd{constructor(l){const f=new p.StructArrayLayout5f20;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const v=new p.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(f,Bc.members),this.indexBuffer=l.createIndexBuffer(v),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ws={symbol:function(_,l,f,v,C){if("translucent"!==_.renderPass)return;const S=p.StencilMode.disabled,R=_.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(F,B,$,j,X,ee,se){const le=B.transform,ae="map"===X,ce="map"===ee;for(const K of F){const oe=j.getTile(K),pe=oe.getBucket($);if(!pe||!pe.text||!pe.text.segments.get().length)continue;const ge=p.evaluateSizeForZoom(pe.textSizeData,le.zoom),De=or(K,pe.getProjection(),le),Me=le.calculatePixelsToTileUnitsMatrix(oe),Se=ct(De,oe.tileID.canonical,ce,ae,le,pe.getProjection(),Me),ze="none"!==$.layout.get("icon-text-fit")&&pe.hasIconData();if(ge){const Re=Math.pow(2,le.zoom-oe.tileID.overscaledZ);Yp(pe,ae,ce,se,p.symbolSize,le,Se,K,Re,ge,ze)}}}(v,_,f,l,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),C),0!==f.paint.get("icon-opacity").constantOr(1)&&qd(_,l,f,v,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),S,R),0!==f.paint.get("text-opacity").constantOr(1)&&qd(_,l,f,v,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),S,R),l.map.showCollisionBoxes&&(zr(_,l,f,v,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),zr(_,l,f,v,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(_,l,f,v){if("translucent"!==_.renderPass)return;const C=f.paint.get("circle-opacity"),S=f.paint.get("circle-stroke-width"),R=f.paint.get("circle-stroke-opacity"),F=void 0!==f.layout.get("circle-sort-key").constantOr(1);if(0===C.constantOr(1)&&(0===S.constantOr(1)||0===R.constantOr(1)))return;const B=_.context,$=B.gl,j=_.transform,X=_.depthModeForSublayer(0,p.DepthMode.ReadOnly),ee=p.StencilMode.disabled,se=_.colorModeForRenderPass(),le="globe"===j.projection.name,ae=[p.mercatorXfromLng(j.center.lng),p.mercatorYfromLat(j.center.lat)],ce=[];for(let oe=0;oe<v.length;oe++){const pe=v[oe],ge=l.getTile(pe),De=ge.getBucket(f);if(!De||De.projection.name!==j.projection.name)continue;const Me=De.programConfigurations.get(f.id),Se=kg(f);le&&Se.push("PROJECTION_GLOBE_VIEW");const ze=_.useProgram("circle",Me,Se),Re=De.layoutVertexBuffer,Xe=De.globeExtVertexBuffer,At=De.indexBuffer,Ve=j.projection.createInversionMatrix(j,pe.canonical),mt={programConfiguration:Me,program:ze,layoutVertexBuffer:Re,globeExtVertexBuffer:Xe,indexBuffer:At,uniformValues:Rg(_,pe,ge,Ve,ae,f),tile:ge};if(F){const nt=De.segments.get();for(const bt of nt)ce.push({segments:new p.SegmentVector([bt]),sortKey:bt.sortKey,state:mt})}else ce.push({segments:De.segments,sortKey:0,state:mt})}F&&ce.sort((oe,pe)=>oe.sortKey-pe.sortKey);const K={useDepthForOcclusion:!le};for(const oe of ce){const{programConfiguration:pe,program:ge,layoutVertexBuffer:De,globeExtVertexBuffer:Me,indexBuffer:Se,uniformValues:ze,tile:Re}=oe.state,Xe=oe.segments;_.terrain&&_.terrain.setupElevationDraw(Re,ge,K),_.prepareDrawProgram(B,ge,Re.tileID.toUnwrapped()),ge.draw(B,$.TRIANGLES,X,ee,se,p.CullFaceMode.disabled,ze,f.id,De,Se,Xe,f.paint,j.zoom,pe,[Me])}},heatmap:function(_,l,f,v){if(0!==f.paint.get("heatmap-opacity"))if("offscreen"===_.renderPass){const C=_.context,S=C.gl,R=p.StencilMode.disabled,F=new p.ColorMode([S.ONE,S.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(se,le,ae,ce){const K=se.gl,oe=le.width*ce,pe=le.height*ce;se.activeTexture.set(K.TEXTURE1),se.viewport.set([0,0,oe,pe]);let ge=ae.heatmapFbo;if(!ge||ge&&(ge.width!==oe||ge.height!==pe)){ge&&ge.destroy();const De=K.createTexture();K.bindTexture(K.TEXTURE_2D,De),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),ge=ae.heatmapFbo=se.createFramebuffer(oe,pe,!1),function(Me,Se,ze,Re,Xe,At){const Ve=Me.gl;Ve.texImage2D(Ve.TEXTURE_2D,0,Me.isWebGL2&&Me.extRenderToTextureHalfFloat?Ve.RGBA16F:Ve.RGBA,Xe,At,0,Ve.RGBA,Me.extRenderToTextureHalfFloat?Me.isWebGL2?Ve.HALF_FLOAT:Me.extTextureHalfFloat.HALF_FLOAT_OES:Ve.UNSIGNED_BYTE,null),Re.colorAttachment.set(ze)}(se,0,De,ge,oe,pe)}else K.bindTexture(K.TEXTURE_2D,ge.colorAttachment.get()),se.bindFramebuffer.set(ge.framebuffer)})(C,_,f,"globe"===_.transform.projection.name?.5:.25),C.clear({color:p.Color.transparent});const B=_.transform,$="globe"===B.projection.name,j=$?["PROJECTION_GLOBE_VIEW"]:null,X=$?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,ee=[p.mercatorXfromLng(B.center.lng),p.mercatorYfromLat(B.center.lat)];for(let se=0;se<v.length;se++){const le=v[se];if(l.hasRenderableParent(le))continue;const ae=l.getTile(le),ce=ae.getBucket(f);if(!ce||ce.projection.name!==B.projection.name)continue;const K=ce.programConfigurations.get(f.id),oe=_.useProgram("heatmap",K,j),{zoom:pe}=_.transform;_.terrain&&_.terrain.setupElevationDraw(ae,oe),_.prepareDrawProgram(C,oe,le.toUnwrapped());const ge=B.projection.createInversionMatrix(B,le.canonical);oe.draw(C,S.TRIANGLES,p.DepthMode.disabled,R,F,X,Zp(_,le,ae,ge,ee,pe,f.paint.get("heatmap-intensity")),f.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,f.paint,_.transform.zoom,K,$?[ce.globeExtVertexBuffer]:null)}C.viewport.set([0,0,_.width,_.height])}else"translucent"===_.renderPass&&(_.context.setColorMode(_.colorModeForRenderPass()),function(C,S){const R=C.context,F=R.gl,B=S.heatmapFbo;if(!B)return;R.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,B.colorAttachment.get()),R.activeTexture.set(F.TEXTURE1);let $=S.colorRampTexture;$||($=S.colorRampTexture=new p.Texture(R,S.colorRamp,F.RGBA)),$.bind(F.LINEAR,F.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(R,F.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,C.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:S.paint.get("heatmap-opacity")},S.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,S.paint,C.transform.zoom)}(_,f))},line:function(_,l,f,v){if("translucent"!==_.renderPass)return;const C=f.paint.get("line-opacity"),S=f.paint.get("line-width");if(0===C.constantOr(1)||0===S.constantOr(1))return;const R=_.depthModeForSublayer(0,p.DepthMode.ReadOnly),F=_.colorModeForRenderPass(),B=_.terrain&&_.terrain.renderingToTexture?1:p.exported.devicePixelRatio,$=f.paint.get("line-dasharray"),j=$.constantOr(1),X=f.layout.get("line-cap"),ee=f.paint.get("line-pattern"),se=ee.constantOr(1),le=f.paint.get("line-gradient"),ae=se?"linePattern":"line",ce=_.context,K=ce.gl,oe=(ge=>{const De=[];Lc(ge)&&De.push("RENDER_LINE_DASH"),ge.paint.get("line-gradient")&&De.push("RENDER_LINE_GRADIENT");const Me=ge.paint.get("line-trim-offset");0===Me[0]&&0===Me[1]||De.push("RENDER_LINE_TRIM_OFFSET");const Se=ge.paint.get("line-pattern").constantOr(1),ze=1!==ge.paint.get("line-opacity").constantOr(1);return!Se&&ze&&De.push("RENDER_LINE_ALPHA_DISCARD"),De})(f);let pe=oe.includes("RENDER_LINE_ALPHA_DISCARD");_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(pe=!1);for(const ge of v){const De=l.getTile(ge);if(se&&!De.patternsLoaded())continue;const Me=De.getBucket(f);if(!Me)continue;_.prepareDrawTile();const Se=Me.programConfigurations.get(f.id),ze=_.useProgram(ae,Se,oe),Re=ee.constantOr(null);if(Re&&De.imageAtlas){const ut=De.imageAtlas.patternPositions[Re.toString()];ut&&Se.setConstantPatternPositions(ut)}const Xe=$.constantOr(null),At=X.constantOr(null);if(!se&&Xe&&At&&De.lineAtlas){const ut=De.lineAtlas.getDash(Xe,At);ut&&Se.setConstantPatternPositions(ut)}let[Ve,mt]=f.paint.get("line-trim-offset");("round"===At||"square"===At)&&Ve!==mt&&(0===Ve&&(Ve-=1),1===mt&&(mt+=1));const nt=_.terrain?ge.projMatrix:null,bt=se?mf(_,De,f,nt,B):X0(_,De,f,nt,Me.lineClipsArray.length,B,[Ve,mt]);if(le){const ut=Me.gradients[f.id];let Lt=ut.texture;if(f.gradientVersion!==ut.version){let gt=256;if(f.stepInterpolant){const wt=l.getSource().maxzoom,bn=ge.canonical.z===wt?Math.ceil(1<<_.transform.maxZoom-ge.canonical.z):1;gt=p.clamp(p.nextPowerOfTwo(Me.maxLineLength/p.EXTENT*1024*bn),256,ce.maxTextureSize)}ut.gradient=p.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:gt,image:ut.gradient||void 0,clips:Me.lineClipsArray}),ut.texture?ut.texture.update(ut.gradient):ut.texture=new p.Texture(ce,ut.gradient,K.RGBA),ut.version=f.gradientVersion,Lt=ut.texture}ce.activeTexture.set(K.TEXTURE1),Lt.bind(f.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}j&&(ce.activeTexture.set(K.TEXTURE0),De.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),Se.updatePaintBuffers()),se&&(ce.activeTexture.set(K.TEXTURE0),De.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Se.updatePaintBuffers()),_.prepareDrawProgram(ce,ze,ge.toUnwrapped());const He=ut=>{ze.draw(ce,K.TRIANGLES,R,ut,F,p.CullFaceMode.disabled,bt,f.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,f.paint,_.transform.zoom,Se,[Me.layoutVertexBuffer2])};if(pe){const ut=_.stencilModeForClipping(ge).ref;0===ut&&_.terrain&&ce.clear({stencil:0});const Lt={func:K.EQUAL,mask:255};bt.u_alpha_discard_threshold=.8,He(new p.StencilMode(Lt,ut,255,K.KEEP,K.KEEP,K.INVERT)),bt.u_alpha_discard_threshold=0,He(new p.StencilMode(Lt,ut,255,K.KEEP,K.KEEP,K.KEEP))}else He(_.stencilModeForClipping(ge))}pe&&(_.resetStencilClippingMasks(),_.terrain&&ce.clear({stencil:0}))},fill:function(_,l,f,v){const C=f.paint.get("fill-color"),S=f.paint.get("fill-opacity");if(0===S.constantOr(1))return;const R=_.colorModeForRenderPass(),F=f.paint.get("fill-pattern"),B=_.opaquePassEnabledForLayer()&&!F.constantOr(1)&&1===C.constantOr(p.Color.transparent).a&&1===S.constantOr(0)?"opaque":"translucent";if(_.renderPass===B){const $=_.depthModeForSublayer(1,"opaque"===_.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Ng(_,l,f,v,$,R,!1)}if("translucent"===_.renderPass&&f.paint.get("fill-antialias")){const $=_.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Ng(_,l,f,v,$,R,!0)}},"fill-extrusion":function(_,l,f,v){const C=f.paint.get("fill-extrusion-opacity");if(0!==C&&"translucent"===_.renderPass){const S=new p.DepthMode(_.context.gl.LEQUAL,p.DepthMode.ReadWrite,_.depthRangeFor3D);if(1!==C||f.paint.get("fill-extrusion-pattern").constantOr(1))Hu(_,l,f,v,S,p.StencilMode.disabled,p.ColorMode.disabled),Hu(_,l,f,v,S,_.stencilModeFor3D(),_.colorModeForRenderPass()),_.resetStencilClippingMasks();else{const R=_.colorModeForRenderPass();Hu(_,l,f,v,S,p.StencilMode.disabled,R)}}},hillshade:function(_,l,f,v){if("offscreen"!==_.renderPass&&"translucent"!==_.renderPass)return;const C=_.context,S=_.depthModeForSublayer(0,p.DepthMode.ReadOnly),R=_.colorModeForRenderPass(),F=_.terrain&&_.terrain.renderingToTexture,[B,$]="translucent"!==_.renderPass||F?[{},v]:_.stencilConfigForOverlap(v);for(const j of $){const X=l.getTile(j);if(X.needsHillshadePrepare&&"offscreen"===_.renderPass)zu(_,X,f,S,p.StencilMode.disabled,R);else if("translucent"===_.renderPass){const ee=F&&_.terrain?_.terrain.stencilModeForRTTOverlap(j):B[j.overscaledZ];ff(_,j,X,f,S,ee,R)}}C.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,l,f,v,C,S){if("translucent"!==_.renderPass||0===f.paint.get("raster-opacity")||!v.length)return;const R=_.context,F=R.gl,B=l.getSource(),$=_.useProgram("raster"),j=_.colorModeForRenderPass(),X=_.terrain&&_.terrain.renderingToTexture,[ee,se]=B instanceof Vn||X?[{},v]:_.stencilConfigForOverlap(v),le=se[se.length-1].overscaledZ,ae=!_.options.moving;for(const ce of se){const K=X?p.DepthMode.disabled:_.depthModeForSublayer(ce.overscaledZ-le,1===f.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,F.LESS),oe=ce.toUnwrapped(),pe=l.getTile(ce);if(X&&(!pe||!pe.hasData()))continue;const ge=X?ce.projMatrix:_.transform.calculateProjMatrix(oe,ae),De=_.terrain&&X?_.terrain.stencilModeForRTTOverlap(ce):ee[ce.overscaledZ],Me=S?0:f.paint.get("raster-fade-duration");pe.registerFadeDuration(Me);const Se=l.findLoadedParent(ce,0),ze=Hs(pe,Se,l,_.transform,Me);let Re,Xe;_.terrain&&_.terrain.prepareDrawTile();const At="nearest"===f.paint.get("raster-resampling")?F.NEAREST:F.LINEAR;R.activeTexture.set(F.TEXTURE0),pe.texture.bind(At,F.CLAMP_TO_EDGE),R.activeTexture.set(F.TEXTURE1),Se?(Se.texture.bind(At,F.CLAMP_TO_EDGE),Re=Math.pow(2,Se.tileID.overscaledZ-pe.tileID.overscaledZ),Xe=[pe.tileID.canonical.x*Re%1,pe.tileID.canonical.y*Re%1]):pe.texture.bind(At,F.CLAMP_TO_EDGE),pe.texture.useMipmap&&R.extTextureFilterAnisotropic&&_.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Ve=Hd(ge,Xe||[0,0],Re||1,ze,f,B instanceof Vn?B.perspectiveTransform:[0,0]);if(_.prepareDrawProgram(R,$,oe),B instanceof Vn)B.boundsBuffer&&B.boundsSegments&&$.draw(R,F.TRIANGLES,K,p.StencilMode.disabled,j,p.CullFaceMode.disabled,Ve,f.id,B.boundsBuffer,_.quadTriangleIndexBuffer,B.boundsSegments);else{const{tileBoundsBuffer:mt,tileBoundsIndexBuffer:nt,tileBoundsSegments:bt}=_.getTileBoundsBuffers(pe);$.draw(R,F.TRIANGLES,K,De,j,p.CullFaceMode.disabled,Ve,f.id,mt,nt,bt)}}_.resetStencilClippingMasks()},background:function(_,l,f,v){const C=f.paint.get("background-color"),S=f.paint.get("background-opacity");if(0===S)return;const R=_.context,F=R.gl,B=_.transform,$=B.tileSize,j=f.paint.get("background-pattern");if(_.isPatternMissing(j))return;const X=!j&&1===C.a&&1===S&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==X)return;const ee=p.StencilMode.disabled,se=_.depthModeForSublayer(0,"opaque"===X?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),le=_.colorModeForRenderPass(),ae=_.useProgram(j?"backgroundPattern":"background");let ce,K=v;K||(ce=_.getBackgroundTiles(),K=Object.values(ce).map(oe=>oe.tileID)),j&&(R.activeTexture.set(F.TEXTURE0),_.imageManager.bind(_.context));for(const oe of K){const pe=oe.toUnwrapped(),ge=v?oe.projMatrix:_.transform.calculateProjMatrix(pe);_.prepareDrawTile();const De=l?l.getTile(oe):ce?ce[oe.key]:new p.Tile(oe,$,B.zoom,_),Me=j?Ly(ge,S,_,j,{tileID:oe,tileSize:$}):Lg(ge,S,C);_.prepareDrawProgram(R,ae,pe);const{tileBoundsBuffer:Se,tileBoundsIndexBuffer:ze,tileBoundsSegments:Re}=_.getTileBoundsBuffers(De);ae.draw(R,F.TRIANGLES,se,ee,le,p.CullFaceMode.disabled,Me,f.id,Se,ze,Re)}},sky:function(_,l,f){const v=_.transform,C="mercator"===v.projection.name||"globe"===v.projection.name?1:p.smoothstep(7,8,v.zoom),S=f.paint.get("sky-opacity")*C;if(0===S)return;const R=_.context,F=f.paint.get("sky-type"),B=new p.DepthMode(R.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),$=_.frameCounter/1e3%1;"atmosphere"===F?"offscreen"===_.renderPass?f.needsSkyboxCapture(_)&&(function(j,X,ee,se){const le=j.context,ae=le.gl;let ce=X.skyboxFbo;if(!ce){ce=X.skyboxFbo=le.createFramebuffer(32,32,!1),X.skyboxGeometry=new ic(le),X.skyboxTexture=le.gl.createTexture(),ae.bindTexture(ae.TEXTURE_CUBE_MAP,X.skyboxTexture),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MAG_FILTER,ae.LINEAR);for(let ge=0;ge<6;++ge)ae.texImage2D(ae.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,ae.RGBA,32,32,0,ae.RGBA,ae.UNSIGNED_BYTE,null)}le.bindFramebuffer.set(ce.framebuffer),le.viewport.set([0,0,32,32]);const K=X.getCenter(j,!0),oe=j.useProgram("skyboxCapture"),pe=new Float64Array(16);p.identity(pe),p.rotateY(pe,pe,.5*-Math.PI),Zs(le,X,oe,pe,K,0),p.identity(pe),p.rotateY(pe,pe,.5*Math.PI),Zs(le,X,oe,pe,K,1),p.identity(pe),p.rotateX(pe,pe,.5*-Math.PI),Zs(le,X,oe,pe,K,2),p.identity(pe),p.rotateX(pe,pe,.5*Math.PI),Zs(le,X,oe,pe,K,3),p.identity(pe),Zs(le,X,oe,pe,K,4),p.identity(pe),p.rotateY(pe,pe,Math.PI),Zs(le,X,oe,pe,K,5),le.viewport.set([0,0,j.width,j.height])}(_,f),f.markSkyboxValid(_)):"sky"===_.renderPass&&function(j,X,ee,se,le){const ae=j.context,ce=ae.gl,K=j.transform,oe=j.useProgram("skybox");ae.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_CUBE_MAP,X.skyboxTexture);const pe={u_matrix:K.skyboxMatrix,u_sun_direction:X.getCenter(j,!1),u_cubemap:0,u_opacity:se,u_temporal_offset:le};j.prepareDrawProgram(ae,oe),oe.draw(ae,ce.TRIANGLES,ee,p.StencilMode.disabled,j.colorModeForRenderPass(),p.CullFaceMode.backCW,pe,"skybox",X.skyboxGeometry.vertexBuffer,X.skyboxGeometry.indexBuffer,X.skyboxGeometry.segment)}(_,f,B,S,$):"gradient"===F&&"sky"===_.renderPass&&function(j,X,ee,se,le){const ae=j.context,ce=ae.gl,K=j.transform,oe=j.useProgram("skyboxGradient");X.skyboxGeometry||(X.skyboxGeometry=new ic(ae)),ae.activeTexture.set(ce.TEXTURE0);let pe=X.colorRampTexture;pe||(pe=X.colorRampTexture=new p.Texture(ae,X.colorRamp,ce.RGBA)),pe.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const ge=(De=K.skyboxMatrix,Me=X.getCenter(j,!1),Se=X.paint.get("sky-gradient-radius"),ze=se,Re=le,{u_matrix:De,u_color_ramp:0,u_center_direction:Me,u_radius:p.degToRad(Se),u_opacity:ze,u_temporal_offset:Re});var De,Me,Se,ze,Re;j.prepareDrawProgram(ae,oe),oe.draw(ae,ce.TRIANGLES,ee,p.StencilMode.disabled,j.colorModeForRenderPass(),p.CullFaceMode.backCW,ge,"skyboxGradient",X.skyboxGeometry.vertexBuffer,X.skyboxGeometry.indexBuffer,X.skyboxGeometry.segment)}(_,f,B,S,$)},debug:function(_,l,f){for(let v=0;v<f.length;v++)zy(_,l,f[v])},custom:function(_,l,f,v){const C=_.context,S=f.implementation;if(!_.transform.projection.unsupportedLayers||!_.transform.projection.unsupportedLayers.includes("custom")||_.terrain&&(_.terrain.renderingToTexture||"offscreen"===_.renderPass)&&f.isLayerDraped()){if("offscreen"===_.renderPass){const R=S.prerender;if(R){if(_.setCustomLayerDefaults(),C.setColorMode(_.colorModeForRenderPass()),"globe"===_.transform.projection.name){const F=_.transform.pointMerc;R.call(S,C.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(_.transform.zoom),[F.x,F.y],_.transform.pixelsPerMeterRatio)}else R.call(S,C.gl,_.transform.customLayerMatrix());C.setDirty(),_.setBaseState()}}else if("translucent"===_.renderPass){if(_.terrain&&_.terrain.renderingToTexture){const F=S.renderToTile;if(F){const B=v[0].canonical,$=new p.MercatorCoordinate(B.x+v[0].wrap*(1<<B.z),B.y,B.z);C.setDepthMode(p.DepthMode.disabled),C.setStencilMode(p.StencilMode.disabled),C.setColorMode(_.colorModeForRenderPass()),_.setCustomLayerDefaults(),F.call(S,C.gl,$),C.setDirty(),_.setBaseState()}return}_.setCustomLayerDefaults(),C.setColorMode(_.colorModeForRenderPass()),C.setStencilMode(p.StencilMode.disabled);const R="3d"===S.renderingMode?new p.DepthMode(_.context.gl.LEQUAL,p.DepthMode.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(C.setDepthMode(R),"globe"===_.transform.projection.name){const F=_.transform.pointMerc;S.render(C.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(_.transform.zoom),[F.x,F.y],_.transform.pixelsPerMeterRatio)}else S.render(C.gl,_.transform.customLayerMatrix());C.setDirty(),_.setBaseState(),C.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class zc{constructor(l,f,v=!1){this.context=new Ht(l,v),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,f){const v=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Pg(this,l));const C=this._terrain;this.transform.elevation=v?C:null,C.update(l,this.transform,f)}_updateFog(l){const f=l.fog;if(!f||"globe"===this.transform.projection.name||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,C]=f.getFovAdjustedRange(this.transform._fov);if(v>C)return void(this.transform.fogCullDistSq=null);const S=v+.78*(C-v);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,f){if(this.width=l*p.exported.devicePixelRatio,this.height=f*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const l=this.context,f=new p.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(p.EXTENT,0),f.emplaceBack(0,p.EXTENT),f.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const v=new p.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(p.EXTENT,0),v.emplaceBack(0,p.EXTENT),v.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=l.createVertexBuffer(v,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const C=new p.StructArrayLayout2i4;C.emplaceBack(-1,-1),C.emplaceBack(1,-1),C.emplaceBack(-1,1),C.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(C,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const S=new p.StructArrayLayout4i8;S.emplaceBack(0,0,0,0),S.emplaceBack(p.EXTENT,0,p.EXTENT,0),S.emplaceBack(0,p.EXTENT,0,p.EXTENT),S.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(S,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const R=new p.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(R);const F=new p.StructArrayLayout1ui2;for(const $ of[0,1,3,2,0])F.emplaceBack($);this.debugIndexBuffer=l.createIndexBuffer(F),this.emptyTexture=new p.Texture(l,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=p.create();const B=this.context.gl;this.stencilClearMode=new p.StencilMode({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new Kd(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(l,f.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,nc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,f,v){if(!f||this.currentStencilSource===f.id||!l.isTileClipped()||!v||0===v.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let F=!1;for(const B of v)if(void 0===this._tileClippingMaskIDs[B.key]){F=!0;break}if(!F)return}this.currentStencilSource=f.id;const C=this.context,S=C.gl;this.nextStencilID+v.length>256&&this.clearStencil(),C.setColorMode(p.ColorMode.disabled),C.setDepthMode(p.DepthMode.disabled);const R=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const F of v){const B=f.getTile(F),$=this._tileClippingMaskIDs[F.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:ee}=this.getTileBoundsBuffers(B);R.draw(C,S.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:S.ALWAYS,mask:0},$,255,S.KEEP,S.KEEP,S.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,nc(F.projMatrix),"$clipping",j,X,ee)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new p.StencilMode({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const f=this.context.gl;return new p.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(l){const f=this.context.gl,v=l.sort((R,F)=>F.overscaledZ-R.overscaledZ),C=v[v.length-1].overscaledZ,S=v[0].overscaledZ-C+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const R={};for(let F=0;F<S;F++)R[F+C]=new p.StencilMode({func:f.GEQUAL,mask:255},F+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=S,[R,v]}return[{[C]:p.StencilMode.disabled},v]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([l.CONSTANT_COLOR,l.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(l,f,v){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const C=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new p.DepthMode(v||this.context.gl.LEQUAL,f,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,f){this.style=l,this.options=f,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const v=this.style.order,C=this.style._sourceCaches;for(const $ in C){const j=C[$];j.used&&j.prepare(this.context)}const S={},R={},F={};for(const $ in C){const j=C[$];S[$]=j.getVisibleCoordinates(),R[$]=S[$].slice().reverse(),F[$]=j.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $=0;$<v.length;$++)if(this.style._layers[v[$]].is3D()){this.opaquePassCutoff=$;break}if(this.terrain&&(this.terrain.updateTileBinding(F),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const $ of v){const j=this.style._layers[$],X=l._getLayerSourceCache(j);if(!j.hasOffscreenPass()||j.isHidden(this.transform.zoom))continue;const ee=X?R[X.id]:void 0;("custom"===j.type||j.isSky()||ee&&ee.length)&&this.renderLayer(this,X,j,ee)}this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon];const B=this.terrain;if(B&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&B.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:f.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const $=this.style._layers[v[this.currentLayer]],j=l._getLayerSourceCache($);if($.isSky())continue;const X=j?R[j.id]:void 0;this._renderTileClippingMasks($,j,X),this.renderLayer(this,j,$,X)}if(this.style.fog&&this.transform.projection.supportsFog&&function($,j){const X=$.context,ee=X.gl,se=$.transform,le=new p.DepthMode(ee.LEQUAL,p.DepthMode.ReadOnly,[0,1]),ae=$.useProgram("globeAtmosphere",null,"globe"===se.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ce=p.globeToMercatorTransition(se.zoom),K=j.properties.get("color").toArray01(),oe=j.properties.get("high-color").toArray01(),pe=j.properties.get("space-color").toArray01PremultipliedAlpha(),ge=p.identity$1([]);p.rotateY$1(ge,ge,-p.degToRad(se._center.lng)),p.rotateX$1(ge,ge,p.degToRad(se._center.lat)),p.rotateZ$1(ge,ge,se.angle),p.rotateX$1(ge,ge,-se._pitch);const De=p.fromQuat(new Float32Array(16),ge),Me=p.mapValue(j.properties.get("star-intensity"),0,1,0,.25),ze=p.mapValue(j.properties.get("horizon-blend"),0,1,5e-4,.25),Re=p.globeUseCustomAntiAliasing($,X,se)&&5e-4===ze?se.worldSize/(2*Math.PI*1.025)-1:se.globeRadius,Xe=$.frameCounter/1e3%1,At=p.length(se.globeCenterInViewSpace),Ve=Math.sqrt(Math.pow(At,2)-Math.pow(Re,2)),mt=Math.acos(Ve/At),nt={u_frustum_tl:se.frustumCorners.TL,u_frustum_tr:se.frustumCorners.TR,u_frustum_br:se.frustumCorners.BR,u_frustum_bl:se.frustumCorners.BL,u_horizon:se.frustumCorners.horizon,u_transition:ce,u_fadeout_range:ze,u_color:K,u_high_color:oe,u_space_color:pe,u_star_intensity:Me,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Xe,u_horizon_angle:mt,u_rotation_matrix:De};$.prepareDrawProgram(X,ae);const bt=$.atmosphereBuffer;bt&&ae.draw(X,ee.TRIANGLES,le,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,nt,"skybox",bt.vertexBuffer,bt.indexBuffer,bt.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const $=this.style._layers[v[this.currentLayer]],j=l._getLayerSourceCache($);$.isSky()&&this.renderLayer(this,j,$,j?R[j.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const $=this.style._layers[v[this.currentLayer]],j=l._getLayerSourceCache($);if($.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped($)){if($.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const X=j?("symbol"===$.type?F:R)[j.id]:void 0;this._renderTileClippingMasks($,j,j?S[j.id]:void 0),this.renderLayer(this,j,$,X),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $=null;p.values(this.style._layers).forEach(j=>{const X=l._getLayerSourceCache(j);X&&!j.isHidden(this.transform.zoom)&&(!$||$.getSource().maxzoom<X.getSource().maxzoom)&&($=X)}),$&&this.options.showTileBoundaries&&ws.debug(this,$,$.getVisibleCoordinates())}this.options.showPadding&&function($){const j=$.transform.padding;Xp($,$.transform.height-(j.top||0),3,Nc),Xp($,j.bottom||0,3,Xd),yf($,j.left||0,3,Ny),yf($,$.transform.width-(j.right||0),3,By);const X=$.transform.centerPoint;var ee,se,le,ae;Gu(ee=$,(se=X.x)-1,(le=$.transform.height-X.y)-10,2,20,ae=K0),Gu(ee,se-10,le-1,20,2,ae)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(l,f,v,C){v.isHidden(this.transform.zoom)||("background"===v.type||"sky"===v.type||"custom"===v.type||C&&C.length)&&(this.id=v.id,this.gpuTimingStart(v),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(v.type)||l.terrain&&"custom"===v.type)&&ws[v.type](l,f,v,C,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let v=this.gpuTimers[l.id];v||(v=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),v.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,f=l.createQueryEXT();this.deferredRenderGpuTimeQueries.push(f),l.beginQueryEXT(l.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const f={};for(const v in l){const C=l[v],S=this.context.extTimerQuery,R=S.getQueryObjectEXT(C.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(C.query),f[v]=R}return f}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery;let v=0;for(const C of l)v+=f.getQueryObjectEXT(C,f.QUERY_RESULT_EXT)/1e6,f.deleteQueryEXT(C);return v}translatePosMatrix(l,f,v,C,S){if(!v[0]&&!v[1])return l;const R=S?"map"===C?this.transform.angle:0:"viewport"===C?-this.transform.angle:0;if(R){const $=Math.sin(R),j=Math.cos(R);v=[v[0]*j-v[1]*$,v[0]*$+v[1]*j]}const F=[S?v[0]:yr(f,v[0],this.transform.zoom),S?v[1]:yr(f,v[1],this.transform.zoom),0],B=new Float32Array(16);return p.translate(B,l,F),B}saveTileTexture(l){const f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}isPatternMissing(l){return null===l||void 0!==l&&!this.imageManager.getPattern(l.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const l=this.terrain&&this.terrain.renderingToTexture,f=this.terrain&&0===this.terrain.exaggeration(),v=this.style&&this.style.fog,C=[];return this.terrainRenderModeElevated()&&C.push("TERRAIN"),"globe"===this.transform.projection.name&&C.push("GLOBE"),f&&C.push("ZERO_EXAGGERATION"),v&&!l&&0!==v.getOpacity(this.transform.pitch)&&C.push("FOG"),l&&C.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&C.push("OVERDRAW_INSPECTOR"),C}useProgram(l,f,v){this.cache=this.cache||{};const C=v||[],S=this.currentGlobalDefines().concat(C),R=Ti.cacheKey(Nu[l],l,S,f);return this.cache[R]||(this.cache[R]=new Ti(this.context,l,Nu[l],f,Gs[l],S)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(l,f,v){if(this.terrain&&this.terrain.renderingToTexture)return;const C=this.style.fog;if(C){const S=C.getOpacity(this.transform.pitch),R=((F,B,$,j,X,ee,se,le,ae,ce,K)=>{const oe=F.transform,pe=B.properties.get("color").toArray01();pe[3]=j;const ge=F.frameCounter/1e3%1;return{u_fog_matrix:$?oe.calculateFogTileMatrix($):F.identityMat,u_fog_range:B.getFovAdjustedRange(oe._fov),u_fog_color:pe,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_temporal_offset:ge,u_frustum_tl:X,u_frustum_tr:ee,u_frustum_br:se,u_frustum_bl:le,u_globe_pos:ae,u_globe_radius:ce,u_viewport:K,u_globe_transition:p.globeToMercatorTransition(oe.zoom),u_is_globe:+("globe"===oe.projection.name)}})(this,C,v,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);f.setFogUniformValues(l,R)}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,f=l.createTexture();return l.bindTexture(l.TEXTURE_2D,f),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&0!==l.getOpacity(this.transform.pitch)}getBackgroundTiles(){const l=this._backgroundTiles,f=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const C of v)f[C.key]=l[C.key]||new p.Tile(C,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class So{constructor(l=0,f=0,v=0,C=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(v)||v<0||isNaN(C)||C<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=v,this.right=C}interpolate(l,f,v){return null!=f.top&&null!=l.top&&(this.top=p.number(l.top,f.top,v)),null!=f.bottom&&null!=l.bottom&&(this.bottom=p.number(l.bottom,f.bottom,v)),null!=f.left&&null!=l.left&&(this.left=p.number(l.left,f.left,v)),null!=f.right&&null!=l.right&&(this.right=p.number(l.right,f.right,v)),this}getCenter(l,f){const v=p.clamp((this.left+l-this.right)/2,0,l),C=p.clamp((this.top+f-this.bottom)/2,0,f);return new p.Point(v,C)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new So(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Zu(_,l){const f=p.getColumn(_,3);p.fromQuat(_,l),p.setColumn(_,3,f)}function xi(_,l){const f=p.identity$1([]);return p.rotateZ$1(f,f,-l),p.rotateX$1(f,f,-_),f}function Zi(_,l){const f=[_[0],_[1],0],v=[l[0],l[1],0];if(p.length(f)>=1e-15){const R=p.normalize([],f);p.scale$2(v,R,p.dot(v,R)),l[0]=v[0],l[1]=v[1]}const C=p.cross([],l,_);if(p.len(C)<1e-15)return null;const S=Math.atan2(-C[1],C[0]);return xi(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),S)}class Vc{constructor(l,f){this.position=l,this.orientation=f}get position(){return this._position}set position(l){if(l){const f=l instanceof p.MercatorCoordinate?l:new p.MercatorCoordinate(l[0],l[1],l[2]);this._renderWorldCopies&&(f.x=p.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(l,f){if(this.orientation=null,!this.position)return;const v=this.position,C=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(l)):0,S=p.MercatorCoordinate.fromLngLat(l,C),R=[S.x-v.x,S.y-v.y,S.z-v.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Zi(R,f)}setPitchBearing(l,f){this.orientation=xi(p.degToRad(l),p.degToRad(-f))}}class Sl{constructor(l,f){this._transform=p.identity([]),this.orientation=f,this.position=l}get mercatorPosition(){const l=this.position;return new p.MercatorCoordinate(l[0],l[1],l[2])}get position(){const l=p.getColumn(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var f;l&&p.setColumn(this._transform,3,[(f=l)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||p.identity$1([]),l&&Zu(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,f){this._orientation=xi(l,f),Zu(this._transform,this._orientation)}forward(){const l=p.getColumn(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=p.getColumn(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=p.getColumn(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,f){const v=new Float64Array(16);return p.invert(v,this.getWorldToCamera(l,f)),v}getWorldToCameraPosition(l,f,v){const C=this.position;p.scale$2(C,C,-l);const S=new Float64Array(16);return p.fromScaling(S,[v,v,v]),p.translate(S,S,C),S[10]*=f,S}getWorldToCamera(l,f){const v=new Float64Array(16),C=new Float64Array(4),S=this.position;return p.conjugate(C,this._orientation),p.scale$2(S,S,-l),p.fromQuat(v,C),p.translate(v,v,S),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=f,v[9]*=f,v[10]*=f,v[11]*=f,v}getCameraToClipPerspective(l,f,v,C){const S=new Float64Array(16);return p.perspective(S,l,f,v,C),S}getDistanceToElevation(l,f=!1){const v=0===l?0:p.mercatorZfromAltitude(l,f?p.latFromMercatorY(this.position[1]):this.position[1]),C=this.forward();return(v-this.position[2])/C[2]}clone(){return new Sl([...this.position],[...this.orientation])}}function Zr(_,l){const f=Uc(_.projection,_.zoom,_.width,_.height),v=function(S,R,F,B,$){const j=new p.LngLat(F.lng-180*Io,F.lat),X=new p.LngLat(F.lng+180*Io,F.lat),ee=S.project(j.lng,j.lat),se=S.project(X.lng,X.lat),le=-Math.atan2(se.y-ee.y,se.x-ee.x),ae=p.MercatorCoordinate.fromLngLat(F);ae.y=p.clamp(ae.y,-1+Io,1-Io);const ce=ae.toLngLat(),K=S.project(ce.lng,ce.lat),oe=p.MercatorCoordinate.fromLngLat(ce);oe.x+=Io;const pe=oe.toLngLat(),ge=S.project(pe.lng,pe.lat),De=Wu(ge.x-K.x,ge.y-K.y,le),Me=p.MercatorCoordinate.fromLngLat(ce);Me.y+=Io;const Se=Me.toLngLat(),ze=S.project(Se.lng,Se.lat),Re=Wu(ze.x-K.x,ze.y-K.y,le),Xe=Math.abs(De.x)/Math.abs(Re.y),At=p.identity([]);p.rotateZ(At,At,-le*(1-($?0:B)));const Ve=p.identity([]);return p.scale(Ve,Ve,[1,1-(1-Xe)*B,1]),Ve[4]=-Re.x/Re.y*B,p.rotateZ(Ve,Ve,le),p.multiply(Ve,At,Ve),Ve}(_.projection,0,_.center,f,l),C=Jd(_);return p.scale(v,v,[C,C,1]),v}function Jd(_){const l=_.projection,f=Uc(_.projection,_.zoom,_.width,_.height),v=Ao(l,_.center),C=Ao(l,p.LngLat.convert(l.center));return Math.pow(2,v*f+(1-f)*C)}function Uc(_,l,f,v,C=1/0){const S=_.range;if(!S)return 0;const R=Math.min(C,Math.max(f,v)),F=Math.log(R/1024)/Math.LN2;return p.smoothstep(S[0]+F,S[1]+F,l)}const Io=1/4e4;function Ao(_,l){const f=p.clamp(l.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),v=new p.LngLat(l.lng-180*Io,f),C=new p.LngLat(l.lng+180*Io,f),S=_.project(v.lng,f),R=_.project(C.lng,f),F=p.MercatorCoordinate.fromLngLat(v),B=p.MercatorCoordinate.fromLngLat(C),$=R.x-S.x,j=R.y-S.y,X=B.x-F.x,ee=B.y-F.y,se=Math.sqrt((X*X+ee*ee)/($*$+j*j));return Math.log(se)/Math.LN2}function Wu(_,l,f){const v=Math.cos(f),C=Math.sin(f);return{x:_*v-l*C,y:_*C+l*v}}class jc{constructor(l,f,v,C,S,R,F){this.tileSize=512,this._renderWorldCopies=void 0===S||S,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=v??0,this._maxPitch=C??60,this.setProjection(R),this.setMaxBounds(F),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new So,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Sl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const l=new jc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(l,f=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||v)&&this._updateCameraOnTerrain(),(l||v)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const v=!ue(f,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const f=l!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(l){void 0===l?l=!0:null===l&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const f=-l*Math.PI/180;var v,C,S,R,F,B,$,j,X,ee;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(v=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),C=this.rotationMatrix,R=this.angle,F=(S=this.rotationMatrix)[0],B=S[1],$=S[2],j=S[3],X=Math.sin(R),ee=Math.cos(R),C[0]=F*ee+$*X,C[1]=B*ee+j*X,C[2]=F*-X+$*ee,C[3]=B*-X+j*ee)}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const f=p.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=p.degToRad(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const l=this._elevation;this._centerAltitude=l.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=l.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let C=0,S=0;for(let R=0;R<f.length;R++){const F=new p.Point(f[R][0]*this.width,v+f[R][1]*(this.height-v)),B=l.pointCoordinate(F);if(!B)continue;const $=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);C+=B[3]*$,S+=$}return 0===S?NaN:C/S}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const l=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*f,C=this._mercatorZfromZoom(l),S=this._mercatorZfromZoom(this._maxZoom),R=Math.max(C-v,S);this._setZoom(this._zoomFromMercatorZ(R))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let v;v=l.z<this._camera.position[2]?[f.x,f.y,f.z]:[l.x,l.y,l.z];const C=p.length(p.sub([],this._camera.position,v));return p.clamp(this._zoomFromMercatorZ(C),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let f=!1;if(l.orientation&&!p.exactEquals(l.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(l.orientation)),l.position){const v=[l.position.x,l.position.y,l.position.z];p.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,f=new Vc;return f.position=new p.MercatorCoordinate(l[0],l[1],l[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(l){if(!p.length$1(l))return!1;p.normalize$1(l,l);const f=p.transformQuat([],[0,0,-1],l),v=p.transformQuat([],[0,-1,0],l);if(v[2]<0)return!1;const C=Zi(f,v);return!!C&&(this._camera.orientation=C,!0)}_setCameraPosition(l){const f=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,C=this.cameraToCenterDistance;l[2]=p.clamp(l[2],C/v,C/f),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,v){this._unmodified=!1,this._edgeInsets.interpolate(l,f,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(l){const f=[new p.UnwrappedTileID(0,l)];if(this.renderWorldCopies){const v=this.pointCoordinate(new p.Point(0,0)),C=this.pointCoordinate(new p.Point(this.width,0)),S=this.pointCoordinate(new p.Point(this.width,this.height)),R=this.pointCoordinate(new p.Point(0,this.height)),F=Math.floor(Math.min(v.x,C.x,S.x,R.x)),B=Math.floor(Math.max(v.x,C.x,S.x,R.x)),$=1;for(let j=F-$;j<=B+$;j++)0!==j&&f.push(new p.UnwrappedTileID(j,l))}return f}coveringTiles(l){let f=this.coveringZoomLevel(l);const v=f,C=this.elevation&&!l.isTerrainDEM,S="mercator"===this.projection.name;if(void 0!==l.minzoom&&f<l.minzoom)return[];void 0!==l.maxzoom&&f>l.maxzoom&&(f=l.maxzoom);const R=this.locationCoordinate(this.center),F=this.center.lat,B=1<<f,$=[B*R.x,B*R.y,0],j="globe"===this.projection.name,X=!j,ee=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,X),se=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),le=B*p.mercatorZfromAltitude(1,this.center.lat),ae=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),ce=[B*se.x,B*se.y,ae*(X?1:le)],K=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),oe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,pe=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ge=l.isTerrainDEM?-pe:this._elevation?this._elevation.getMinElevationBelowMSL():0,De=this.projection.isReprojectedInTileSpace?Jd(this):1,Me=He=>{const Lt=new p.MercatorCoordinate(He.x+25e-6,He.y,He.z),gt=new p.MercatorCoordinate(He.x,He.y+25e-6,He.z),wt=He.toLngLat(),bn=Lt.toLngLat(),Rn=gt.toLngLat(),an=this.locationCoordinate(wt),xn=this.locationCoordinate(bn),Jn=this.locationCoordinate(Rn),An=Math.hypot(xn.x-an.x,xn.y-an.y),ln=Math.hypot(Jn.x-an.x,Jn.y-an.y);return Math.sqrt(An*ln)*De/25e-6},Se=He=>{const ut=pe,Lt=ge;return{aabb:p.tileAABB(this,B,0,0,0,He,Lt,ut,this.projection),zoom:0,x:0,y:0,minZ:Lt,maxZ:ut,wrap:He,fullyVisible:!1}},ze=[];let Re=[];const Xe=f,At=l.reparseOverscaled?v:f,Ve=He=>He*He,mt=Ve((ae-this._centerAltitude)*le),nt=He=>{if(!this._elevation||!He.tileID||!S)return;const ut=this._elevation.getMinMaxForTile(He.tileID),Lt=He.aabb;ut?(Lt.min[2]=ut.min,Lt.max[2]=ut.max,Lt.center[2]=(Lt.min[2]+Lt.max[2])/2):(He.shouldSplit=bt(He),He.shouldSplit||(Lt.min[2]=Lt.max[2]=Lt.center[2]=this._centerAltitude))},bt=He=>{if(He.zoom<oe)return!0;if(He.zoom===Xe)return!1;if(null!=He.shouldSplit)return He.shouldSplit;const ut=He.aabb.distanceX(ce),Lt=He.aabb.distanceY(ce);let gt=mt,wt=1;if(j){gt=Ve(He.aabb.distanceZ(ce));const an=Math.pow(2,He.zoom),xn=p.latFromMercatorY((He.y+1)/an),Jn=p.latFromMercatorY(He.y/an),An=Math.min(Math.max(F,xn),Jn),ln=p.circumferenceAtLatitude(An)/p.circumferenceAtLatitude(F);if(wt=An===F?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ln/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&He.zoom===Xe-1&&ln>=.9)return!0}else if(C&&(gt=Ve(He.aabb.distanceZ(ce)*le)),this.projection.isReprojectedInTileSpace&&v<=5){const an=Math.pow(2,He.zoom),xn=Me(new p.MercatorCoordinate((He.x+.5)/an,(He.y+.5)/an));wt=xn>.85?1:xn}const bn=ut*ut+Lt*Lt+gt;return bn<Ve((1<<Xe-He.zoom)*K*wt*((an,xn)=>{if(xn*Ve(.707)<an)return 1;const Jn=Math.sqrt(xn/an);return Jn/(1.4144271570014144+(Math.pow(1.1,Jn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(gt,mt),bn))};if(this.renderWorldCopies)for(let He=1;He<=3;He++)ze.push(Se(-He)),ze.push(Se(He));for(ze.push(Se(0));ze.length>0;){const He=ze.pop(),ut=He.x,Lt=He.y;let gt=He.fullyVisible;if(!gt){const wt=He.aabb.intersects(ee);if(0===wt)continue;gt=2===wt}if(He.zoom!==Xe&&bt(He))for(let wt=0;wt<4;wt++){const bn=(ut<<1)+wt%2,Rn=(Lt<<1)+(wt>>1),an={aabb:S?He.aabb.quadrant(wt):p.tileAABB(this,B,He.zoom+1,bn,Rn,He.wrap,He.minZ,He.maxZ,this.projection),zoom:He.zoom+1,x:bn,y:Rn,wrap:He.wrap,fullyVisible:gt,tileID:void 0,shouldSplit:void 0,minZ:He.minZ,maxZ:He.maxZ};C&&!j&&(an.tileID=new p.OverscaledTileID(He.zoom+1===Xe?At:He.zoom+1,He.wrap,He.zoom+1,bn,Rn),nt(an)),ze.push(an)}else{const wt=He.zoom===Xe?At:He.zoom;if(l.minzoom&&l.minzoom>wt)continue;const bn=$[0]-(.5+ut+(He.wrap<<He.zoom))*(1<<f-He.zoom),Rn=$[1]-.5-Lt,an=He.tileID?He.tileID:new p.OverscaledTileID(wt,He.wrap,He.zoom,ut,Lt);Re.push({tileID:an,distanceSq:bn*bn+Rn*Rn})}}if(this.fogCullDistSq){const He=this.fogCullDistSq,ut=this.horizonLineFromTop();Re=Re.filter(Lt=>{const gt=[0,0,0,1],wt=[p.EXTENT,p.EXTENT,0,1],bn=this.calculateFogTileMatrix(Lt.tileID.toUnwrapped());p.transformMat4$1(gt,gt,bn),p.transformMat4$1(wt,wt,bn);const Rn=p.getAABBPointSquareDist(gt,wt);if(0===Rn)return!0;let an=!1;const xn=this._elevation;if(xn&&Rn>He&&0!==ut){const Jn=this.calculateProjMatrix(Lt.tileID.toUnwrapped());let An;l.isTerrainDEM||(An=xn.getMinMaxForTile(Lt.tileID)),An||(An={min:ge,max:pe});const ln=p.furthestTileCorner(this.rotation),Oi=[ln[0]*p.EXTENT,ln[1]*p.EXTENT,An.max];p.transformMat4(Oi,Oi,Jn),an=(1-Oi[1])*this.height*.5<ut}return Rn<He||an})}return Re.sort((He,ut)=>He.distanceSq-ut.distanceSq).map(He=>He.tileID)}resize(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const f=p.clamp(l.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),v=this.projection.project(l.lng,f);return new p.Point(v.x*this.worldSize,v.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,f){let v,C;const S=this.centerPoint;if("globe"===this.projection.name){const F=this.worldSize;v=(f.x-S.x)/F,C=(f.y-S.y)/F}else{const F=this.pointCoordinate(f),B=this.pointCoordinate(S);v=F.x-B.x,C=F.y-B.y}const R=this.locationCoordinate(l);this.setLocation(new p.MercatorCoordinate(R.x-v,R.y-C))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,f){const v=f?p.mercatorZfromAltitude(f,l.lat):void 0,C=this.projection.project(l.lng,l.lat);return new p.MercatorCoordinate(C.x,C.y,v)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,f){const v=f??this._centerAltitude,C=[l.x,l.y,0,1],S=[l.x,l.y,1,1];p.transformMat4$1(C,C,this.pixelMatrixInverse),p.transformMat4$1(S,S,this.pixelMatrixInverse);const R=S[3];p.scale$1(C,C,1/C[3]),p.scale$1(S,S,1/R);const F=C[2],B=S[2];return{p0:C,p1:S,t:F===B?0:(v-F)/(B-F)}}screenPointToMercatorRay(l){const f=[l.x,l.y,0,1],v=[l.x,l.y,1,1];return p.transformMat4$1(f,f,this.pixelMatrixInverse),p.transformMat4$1(v,v,this.pixelMatrixInverse),p.scale$1(f,f,1/f[3]),p.scale$1(v,v,1/v[3]),f[2]=p.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,v[2]=p.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,p.scale$1(f,f,1/this.worldSize),p.scale$1(v,v,1/this.worldSize),new p.Ray([f[0],f[1],f[2]],p.normalize([],p.sub([],v,f)))}rayIntersectionCoordinate(l){const{p0:f,p1:v,t:C}=l,S=p.mercatorZfromAltitude(f[2],this._center.lat),R=p.mercatorZfromAltitude(v[2],this._center.lat);return new p.MercatorCoordinate(p.number(f[0],v[0],C)/this.worldSize,p.number(f[1],v[1],C)/this.worldSize,p.number(S,R,C))}pointCoordinate(l,f=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,f)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let f=this.projection.pointCoordinate3D(this,l.x,l.y);if(f)return new p.MercatorCoordinate(f[0],f[1],f[2]);let v=0,C=this.horizonLineFromTop();if(l.y>C)return this.pointCoordinate(l);const S=.02*C,R=l.clone();for(let F=0;F<10&&C-v>S;F++){R.y=p.number(v,C,.66);const B=this.projection.pointCoordinate3D(this,R.x,R.y);B?(C=R.y,f=B):v=R.y}return f?new p.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(l);const f=this.pointCoordinate(l);return f.y>=0&&f.y<=1}_coordinatePoint(l,f){const v=f&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,C=[l.x*this.worldSize,l.y*this.worldSize,v+l.toAltitude(),1];return p.transformMat4$1(C,C,this.pixelMatrix),C[3]>0?new p.Point(C[0]/C[3],C[1]/C[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:f}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,S=this.pointLocation3D(new p.Point(f,l)),R=this.pointLocation3D(new p.Point(C,l)),F=this.pointLocation3D(new p.Point(C,v)),B=this.pointLocation3D(new p.Point(f,v));let $=Math.min(S.lng,R.lng,F.lng,B.lng),j=Math.max(S.lng,R.lng,F.lng,B.lng),X=Math.min(S.lat,R.lat,F.lat,B.lat),ee=Math.max(S.lat,R.lat,F.lat,B.lat);const se=Math.pow(2,-this.zoom)/16*270,le="globe"===this.projection.name?1:4,ae=(ce,K,oe,pe,ge)=>{const De=(ce+oe)/2,Me=(K+pe)/2,Se=new p.Point(De,Me),{lng:ze,lat:Re}=this.pointLocation3D(Se),Xe=Math.max(0,$-ze,X-Re,ze-j,Re-ee);$=Math.min($,ze),j=Math.max(j,ze),X=Math.min(X,Re),ee=Math.max(ee,Re),(ge<le||Xe>se)&&(ae(ce,K,De,Me,ge+1),ae(De,Me,oe,pe,ge+1))};if(ae(f,l,C,l,1),ae(C,l,C,v,1),ae(C,v,f,v,1),ae(f,v,f,l,1),"globe"===this.projection.name){const[ce,K]=p.polesInViewport(this);ce?(ee=90,j=180,$=-180):K&&(X=-90,j=180,$=-180)}return new p.LngLatBounds(new p.LngLat($,X),new p.LngLat(j,ee))}_getBoundsRectangular(l,f){const{top:v,left:C}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,R=this.width-this._edgeInsets.right,F=new p.Point(C,v),B=new p.Point(R,v),$=new p.Point(R,S),j=new p.Point(C,S);let X=this.pointCoordinate(F,l),ee=this.pointCoordinate(B,l);const se=this.pointCoordinate($,f),le=this.pointCoordinate(j,f),ae=(ce,K)=>(K.y-ce.y)/(K.x-ce.x);return X.y>1&&ee.y>=0?X=new p.MercatorCoordinate((1-le.y)/ae(le,X)+le.x,1):X.y<0&&ee.y<=1&&(X=new p.MercatorCoordinate(-le.y/ae(le,X)+le.x,0)),ee.y>1&&X.y>=0?ee=new p.MercatorCoordinate((1-se.y)/ae(se,ee)+se.x,1):ee.y<0&&X.y<=1&&(ee=new p.MercatorCoordinate(-se.y/ae(se,ee)+se.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(se))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=l.visibleDemTiles.reduce((v,C)=>{if(C.dem){const S=C.dem.tree;v.min=Math.min(v.min,S.minimums[0]),v.max=Math.max(v.max,S.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*l.exaggeration(),f.max*l.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-f*(1-this._horizonShift);return l?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,f){return this.projection.createTileMatrix(this,f,l)}calculateDistanceTileData(l){const f=l.key,v=this._distanceTileDataCache;if(v[f])return v[f];const C=l.canonical,S=1/this.height,R=this.cameraWorldSize,F=R/this.zoomScale(C.z),B=(C.x+Math.pow(2,C.z)*l.wrap)*F,$=C.y*F,j=this.point;j.x*=R/this.worldSize,j.y*=R/this.worldSize;const X=this.angle,ee=Math.sin(-X),se=-Math.cos(-X);return v[f]={bearing:[ee,se],center:[(j.x-B)*S,(j.y-$)*S],scale:F/p.EXTENT*S},v[f]}calculateFogTileMatrix(l){const f=l.key,v=this._fogTileMatrixCache;if(v[f])return v[f];const C=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return p.multiply(C,this.worldToFogMatrix,C),v[f]=new Float32Array(C),v[f]}calculateProjMatrix(l,f=!1){const v=l.key,C=f?this._alignedProjMatrixCache:this._projMatrixCache;if(C[v])return C[v];const S=this.calculatePosMatrix(l,this.worldSize);return p.multiply(S,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,S),C[v]=new Float32Array(S),C[v]}calculatePixelsToTileUnitsMatrix(l){const f=l.tileID.key,v=this._pixelsToTileUnitsCache;if(v[f])return v[f];const C=function(S,R){const{scale:F}=S.tileTransform,B=F*p.EXTENT/(S.tileSize*Math.pow(2,R.zoom-S.tileID.overscaledZ+S.tileID.canonical.z));return $=new Float32Array(4),ee=(j=R.inverseAdjustmentMatrix)[1],se=j[2],le=j[3],ce=(X=[B,B])[1],$[0]=j[0]*(ae=X[0]),$[1]=ee*ae,$[2]=se*ce,$[3]=le*ce,$;var $,j,X,ee,se,le,ae,ce}(l,this);return v[f]=C,v[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const l=1/this.worldSize,f=p.fromScaling([],[l,l,l]);return p.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const l=this._elevation;this._updateCameraState();const f=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(f),C=this._camera.forward(),S=p.mercatorZfromAltitude(1,this._center.lat);v[2]/=S,C[2]/=S,p.normalize(C,C);const R=l.raycast(v,C,l.exaggeration());if(R){const F=p.scaleAndAdd([],v,C,R),B=new p.MercatorCoordinate(F[0],F[1],p.mercatorZfromAltitude(F[2],p.latFromMercatorY(F[1]))),$=(B.z+p.length([B.x-v[0],B.y-v[1],B.z-v[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ($),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const f=this._elevation,v=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,C=this._computeCameraPosition(v),S=f.getAtPointOrZero(new p.MercatorCoordinate(...C)),R=this.pixelsPerMeter/this.worldSize*S,F=this._minimumHeightOverTerrain(),B=C[2]-R;if(B<=F)if(B<0||l){const $=this.locationCoordinate(this._center,this._centerAltitude),j=[C[0],C[1],$.z-C[2]],X=p.length(j);j[2]-=(F-B)/this._pixelsPerMercatorPixel;const ee=p.length(j);if(0===ee)return;p.scale$2(j,j,X/ee*this._pixelsPerMercatorPixel),this._camera.position=[C[0],C[1],$.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const ee=this.center;return ee.lat=p.clamp(ee.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(ee.lng=p.clamp(ee.lng,this.minLng,this.maxLng)),this.center=ee,void(this._constraining=!1)}const f=this._unmodified,{x:v,y:C}=this.point;let S=0,R=v,F=C;const B=this.width/2,$=this.height/2,j=this.worldMinY*this.scale,X=this.worldMaxY*this.scale;if(C-$<j&&(F=j+$),C+$>X&&(F=X-$),X-j<this.height&&(S=Math.max(S,this.height/(X-j)),F=(X+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ee=this.worldMinX*this.scale,se=this.worldMaxX*this.scale,le=this.worldSize/2-(ee+se)/2;R=(v+le+this.worldSize)%this.worldSize-le,R-B<ee&&(R=ee+B),R+B>se&&(R=se-B),se-ee<this.width&&(S=Math.max(S,this.width/(se-ee)),R=(se+ee)/2)}R===v&&F===C||(this.center=this.unproject(new p.Point(R,F))),S&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,f=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const v=Uc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const C="meters"===this.projection.zAxisUnit?f:1,S=this._camera.getWorldToCamera(this.worldSize,C),R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);R[8]=2*-l.x/this.width,R[9]=2*l.y/this.height;let F=p.mul([],R,S);if(this.projection.isReprojectedInTileSpace){const Me=this.locationCoordinate(this.center),Se=p.identity([]);p.translate(Se,Se,[Me.x*this.worldSize,Me.y*this.worldSize,0]),p.multiply(Se,Se,Zr(this)),p.translate(Se,Se,[-Me.x*this.worldSize,-Me.y*this.worldSize,0]),p.multiply(F,F,Se),this.inverseAdjustmentMatrix=function(ze){const Re=Zr(ze,!0);return Ne([],[Re[0],Re[1],Re[4],Re[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],F,[this.worldSize,this.worldSize,this.worldSize/C,1]),this.projMatrix=F,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const B=p.invert([],R);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height);const $=new Float32Array(16);p.identity($),p.scale($,$,[1,-1,1]),p.rotateX($,$,this._pitch),p.rotateZ($,$,this.angle);const j=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-l.x/this.width,j[9]=2*(l.y+X)/this.height,this.skyboxMatrix=p.multiply($,j,$);const ee=this.point,se=ee.x,le=ee.y,ae=this.width%2/2,ce=this.height%2/2,K=Math.cos(this.angle),oe=Math.sin(this.angle),pe=se-Math.round(se)+K*ae+oe*ce,ge=le-Math.round(le)+K*ce+oe*ae,De=new Float64Array(F);if(p.translate(De,De,[pe>.5?pe-1:pe,ge>.5?ge-1:ge,0]),this.alignedProjMatrix=De,F=p.create(),p.scale(F,F,[this.width/2,-this.height/2,1]),p.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=p.create(),p.scale(F,F,[1,-1,1]),p.translate(F,F,[-1,-1,0]),p.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},F=p.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const Me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(Me,Me,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,v=this._camera.position,C=1/this.height/this._pixelsPerMercatorPixel,S=[l,l,f];p.scale$2(S,S,C),p.scale$2(v,v,-1),p.multiply$2(v,v,S);const R=p.create();p.translate(R,R,v),p.scale(R,R,S),this.mercatorFogMatrix=R,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,f,C)}_computeCameraPosition(l){const f=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),C=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-l/this.worldSize*this._centerAltitude;return[C.x/this.worldSize-v[0]*S,C.y/this.worldSize-v[1]*S,l/this.worldSize*this._centerAltitude-v[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],C=l[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),C>0&&(S=Math.min((f-v)/C,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,l,S),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,f=this._camera.forward(),{pitch:v,bearing:C}=this._camera.getPitchBearing(),S=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,R=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),F=Math.max((l[2]-S)/Math.cos(v),R),B=this._zoomFromMercatorZ(F);p.scaleAndAdd(l,l,f,F),this._pitch=p.clamp(v,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(C,-Math.PI,Math.PI),this._setZoom(p.clamp(B,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let f=0,v=p.GLOBE_ZOOM_THRESHOLD_MAX,C=0,S=1/0;for(;v-f>1e-6&&v>f;){const R=f+.5*(v-f),F=this.tileSize*Math.pow(2,R),B=this.getCameraToCenterDistance(this.projection,R,F),$=this.scaleZoom(B/(l*this.tileSize)),j=Math.abs(R-$);j<S&&(S=j,C=R),R<$?f=R:v=R}return C}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,f){const v=Math.min(l.x,f.x),C=Math.max(l.x,f.x),S=Math.min(l.y,f.y),R=Math.max(l.y,f.y);if(S<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const F=[new p.Point(v,S),new p.Point(C,R),new p.Point(v,R),new p.Point(C,S)],B=this.renderWorldCopies?-3:0,$=this.renderWorldCopies?4:1;for(const j of F){const X=this.pointRayIntersection(j);if(X.t<0)return!0;const ee=this.rayIntersectionCoordinate(X);if(ee.x<B||ee.y<0||ee.x>$||ee.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(l,f){const v=p.length(p.sub([],this._camera.position,l)),C=this._zoomFromMercatorZ(v)+f;return v-this._mercatorZfromZoom(C)}getCameraPoint(){if("globe"===this.projection.name){const l=function([f,v,C],S){const R=[f,v,C,1];p.transformMat4$1(R,R,S);const F=R[3]=Math.max(R[3],1e-6);return R[0]/=F,R[1]/=F,R[2]/=F,R}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,l))}}getCameraToCenterDistance(l,f=this.zoom,v=this.worldSize){const C=Uc(l,f,this.width,this.height,1024),S=l.pixelSpaceConversion(this.center.lat,v,C);return.5/Math.tan(.5*this._fov)*this.height*S}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(l,l,this.globeMatrix),l}}function $c(_,l){let f=!1,v=null;const C=()=>{v=null,f&&(_(),v=setTimeout(C,l),f=!1)};return()=>(f=!0,v||C(),v)}class Ma{constructor(l){this._hashName=l&&encodeURIComponent(l),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=$c(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,p.window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const f=Hc(l);if(this._hashName){const v=this._hashName;let C=!1;const S=p.window.location.hash.slice(1).split("&").map(R=>{const F=R.split("=")[0];return F===v?(C=!0,`${F}=${f}`):R}).filter(R=>R);return C||S.push(`${v}=${f}`),`#${S.join("&")}`}return`#${f}`}_getCurrentHash(){const l=p.window.location.hash.replace("#","");if(this._hashName){let f;return l.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(f=v)}),(f&&f[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(v=>isNaN(v))){const v=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(f[3]||0):l.getBearing();return l.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:v,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const l=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,l)}}function Hc(_,l){const f=_.getCenter(),v=Math.round(100*_.getZoom())/100,C=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,C),R=Math.round(f.lng*S)/S,F=Math.round(f.lat*S)/S,B=_.getBearing(),$=_.getPitch();let j=l?`/${R}/${F}/${v}`:`${v}/${F}/${R}`;return(B||$)&&(j+="/"+Math.round(10*B)/10),$&&(j+=`/${Math.round($)}`),j}const qu={linearity:.3,easing:p.bezier(0,0,.3,1)},Yu=p.extend({deceleration:2500,maxSpeed:1400},qu),Gc=p.extend({deceleration:20,maxSpeed:1400},qu),rn=p.extend({deceleration:1e3,maxSpeed:360},qu),Es=p.extend({deceleration:1e3,maxSpeed:90},qu);class Kn{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=p.exported.now();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)f.zoom+=S.zoomDelta||0,f.bearing+=S.bearingDelta||0,f.pitch+=S.pitchDelta||0,S.panDelta&&f.pan._add(S.panDelta),S.around&&(f.around=S.around),S.pinchAround&&(f.pinchAround=S.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,C={};if(f.pan.mag()){const S=Ku(f.pan.mag(),v,p.extend({},Yu,l||{}));C.offset=f.pan.mult(S.amount/f.pan.mag()),C.center=this._map.transform.center,Xu(C,S)}if(f.zoom){const S=Ku(f.zoom,v,Gc);C.zoom=this._map.transform.zoom+S.amount,Xu(C,S)}if(f.bearing){const S=Ku(f.bearing,v,rn);C.bearing=this._map.transform.bearing+p.clamp(S.amount,-179,179),Xu(C,S)}if(f.pitch){const S=Ku(f.pitch,v,Es);C.pitch=this._map.transform.pitch+S.amount,Xu(C,S)}if(C.zoom||C.bearing){const S=void 0===f.pinchAround?f.around:f.pinchAround;C.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),C.noMoveStart=!0,C}}function Xu(_,l){(!_.duration||_.duration<l.duration)&&(_.duration=l.duration,_.easing=l.easing)}function Ku(_,l,f){const{maxSpeed:v,linearity:C,deceleration:S}=f,R=p.clamp(_*C/(l/1e3),-v,v),F=Math.abs(R)/(S*C);return{easing:f.easing,duration:1e3*F,amount:R*(F/2)}}class uo extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,v,C={}){const S=un(f.getCanvasContainer(),v),R=f.unproject(S);super(l,p.extend({point:S,lngLat:R,originalEvent:v},C)),this._defaultPrevented=!1,this.target=f}}class rc extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,v){const C="touchend"===l?v.changedTouches:v.touches,S=Sn(f.getCanvasContainer(),C),R=S.map(B=>f.unproject(B)),F=S.reduce((B,$,j,X)=>B.add($.div(X.length)),new p.Point(0,0));super(l,{points:S,point:F,lngLats:R,lngLat:f.unproject(F),originalEvent:v}),this._defaultPrevented=!1}}class Ju extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,v){super(l,{originalEvent:v}),this._defaultPrevented=!1}}class Qd{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new Ju(l.type,this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new uo(l.type,this._map,l))}mouseup(l){this._map.fire(new uo(l.type,this._map,l))}preclick(l){const f=p.extend({},l);f.type="preclick",this._map.fire(new uo(f.type,this._map,f))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(l),this._map.fire(new uo(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new uo(l.type,this._map,l))}mouseover(l){this._map.fire(new uo(l.type,this._map,l))}mouseout(l){this._map.fire(new uo(l.type,this._map,l))}touchstart(l){return this._firePreventable(new rc(l.type,this._map,l))}touchmove(l){this._map.fire(new rc(l.type,this._map,l))}touchend(l){this._map.fire(new rc(l.type,this._map,l))}touchcancel(l){this._map.fire(new rc(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Da{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new uo(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new uo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new uo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jp{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&0===l.button&&(Wt(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const v=f,C=this._startPos,S=this._lastPos;if(!C||!S||S.equals(v)||!this._box&&v.dist(C)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=Ae("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const R=Math.min(C.x,v.x),F=Math.max(C.x,v.x),B=Math.min(C.y,v.y),$=Math.max(C.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${R}px,${B}px)`,this._box.style.width=F-R+"px",this._box.style.height=$-B+"px")})}mouseupWindow(l,f){if(!this._active)return;const v=this._startPos,C=f;if(v&&0===l.button){if(this.reset(),Cn(),v.x!==C.x||v.y!==C.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:S=>S.fitScreenCoordinates(v,C,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&27===l.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),on(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new p.Event(l,{originalEvent:f}))}}function eh(_,l){const f={};for(let v=0;v<_.length;v++)f[_[v].identifier]=l[v];return f}class Zc{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,f,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=l.timeStamp),v.length===this.numTouches&&(this.centroid=function(C){const S=new p.Point(0,0);for(const R of C)S._add(R);return S.div(C.length)}(f),this.touches=eh(v,f)))}touchmove(l,f,v){if(this.aborted||!this.centroid)return;const C=eh(v,f);for(const S in this.touches){const R=C[S];(!R||R.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(l,f,v){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),0===v.length){const C=!this.aborted&&this.centroid;if(this.reset(),C)return C}}}class Qp{constructor(l){this.singleTap=new Zc(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,f,v){this.singleTap.touchstart(l,f,v)}touchmove(l,f,v){this.singleTap.touchmove(l,f,v)}touchend(l,f,v){const C=this.singleTap.touchend(l,f,v);if(C){const S=l.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(C)<30;if(S&&R||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=C,this.count===this.numTaps)return this.reset(),C}}}class Vy{constructor(){this._zoomIn=new Qp({numTouches:1,numTaps:2}),this._zoomOut=new Qp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,v){this._zoomIn.touchstart(l,f,v),this._zoomOut.touchstart(l,f,v)}touchmove(l,f,v){this._zoomIn.touchmove(l,f,v),this._zoomOut.touchmove(l,f,v)}touchend(l,f,v){const C=this._zoomIn.touchend(l,f,v),S=this._zoomOut.touchend(l,f,v);return C?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(C)},{originalEvent:l})}):S?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(S)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Bt={0:1,2:2};class vi{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,f){return!1}_move(l,f){return{}}mousedown(l,f){if(this._lastPoint)return;const v=gn(l);this._correctButton(l,v)&&(this._lastPoint=f,this._eventButton=v)}mousemoveWindow(l,f){const v=this._lastPoint;if(v)if(l.preventDefault(),null!=this._eventButton&&function(C,S){const R=Bt[S];return void 0===C.buttons||(C.buttons&R)!==R}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(v,f)}mouseupWindow(l){this._lastPoint&&gn(l)===this._eventButton&&(this._moved&&Cn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class th extends vi{mousedown(l,f){super.mousedown(l,f),this._lastPoint&&(this._active=!0)}_correctButton(l,f){return 0===f&&!l.ctrlKey}_move(l,f){return{around:f,panDelta:f.sub(l)}}}class nh extends vi{_correctButton(l,f){return 0===f&&l.ctrlKey||2===f}_move(l,f){const v=.8*(f.x-l.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(l){l.preventDefault()}}class Qr extends vi{_correctButton(l,f){return 0===f&&l.ctrlKey||2===f}_move(l,f){const v=-.5*(f.y-l.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(l){l.preventDefault()}}class Wc{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(l,f,v){return this._calculateTransform(l,f,v)}touchmove(l,f,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===v.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,f,v)}}touchend(l,f,v){this._calculateTransform(l,f,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,v){v.length>0&&(this._active=!0);const C=eh(v,f),S=new p.Point(0,0),R=new p.Point(0,0);let F=0;for(const $ in C){const j=C[$],X=this._touches[$];X&&(S._add(j),R._add(j.sub(X)),F++,C[$]=j)}if(this._touches=C,F<this._minTouches||!R.mag())return;const B=R.div(F);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(F),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ya{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,f,v){return{}}touchstart(l,f,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,v){const C=this._firstTwoTouches;if(!C)return;l.preventDefault();const[S,R]=C,F=ls(v,f,S),B=ls(v,f,R);if(!F||!B)return;const $=this._aroundCenter?null:F.add(B).div(2);return this._move([F,B],$,l)}touchend(l,f,v){if(!this._firstTwoTouches)return;const[C,S]=this._firstTwoTouches,R=ls(v,f,C),F=ls(v,f,S);R&&F||(this._active&&Cn(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ls(_,l,f){for(let v=0;v<_.length;v++)if(_[v].identifier===f)return l[v]}function qc(_,l){return Math.log(_/l)/Math.LN2}class Qu extends Ya{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const v=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(qc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qc(this._distance,v),pinchAround:f}}}function ih(_,l){return 180*_.angleWith(l)/Math.PI}class Uy extends Ya{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f){const v=this._vector;if(this._vector=l[0].sub(l[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ih(this._vector,v),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const C=ih(l,v);return Math.abs(C)<f}}function Xa(_){return Math.abs(_.y)>Math.abs(_.x)}class Yo extends Ya{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,Xa(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,v){const C=this._lastPoints;if(!C)return;const S=l[0].sub(C[0]),R=l[1].sub(C[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(S,R,v.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(S.y+R.y)/2*-.5})}gestureBeginsVertically(l,f,v){if(void 0!==this._valid)return this._valid;const C=l.mag()>=2,S=f.mag()>=2;if(!C&&!S)return;if(!C||!S)return null==this._firstMove&&(this._firstMove=v),v-this._firstMove<100&&void 0;const R=l.y>0==f.y>0;return Xa(l)&&Xa(f)&&R}}const Sa={panStep:100,bearingStep:15,pitchStep:10};class bf{constructor(){const l=Sa;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,v=0,C=0,S=0,R=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?v=-1:(l.preventDefault(),S=-1);break;case 39:l.shiftKey?v=1:(l.preventDefault(),S=1);break;case 38:l.shiftKey?C=1:(l.preventDefault(),R=-1);break;case 40:l.shiftKey?C=-1:(l.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(v=0,C=0),{cameraAnimation:F=>{const B=F.getZoom();F.easeTo({duration:300,easeId:"keyboardHandler",easing:Il,zoom:f?Math.round(B)+f*(l.shiftKey?2:1):B,bearing:F.getBearing()+v*this._bearingStep,pitch:F.getPitch()+C*this._pitchStep,offset:[-S*this._panStep,-R*this._panStep],center:F.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Il(_){return _*(2-_)}const ho=4.000244140625;class em{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=l.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const v=p.exported.now(),C=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,0!==f&&f%ho==0?this._type="wheel":0!==f&&Math.abs(f)<4?this._type="trackpad":C>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(C*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=un(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;"wheel"===this._type&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(0!==this._delta){const B="wheel"===this._type&&Math.abs(this._delta)>ho?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&0!==$&&($=1/$);const j=f(),X=Math.pow(2,j),ee="number"==typeof this._targetZoom?l.zoomScale(this._targetZoom):X;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(ee*$))),"wheel"===this._type&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._delta=0}const v="number"==typeof this._targetZoom?this._targetZoom:f(),C=this._startZoom,S=this._easing;let R,F=!1;if("wheel"===this._type&&C&&S){const B=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),$=S(B);R=p.number(C,v,$),B<1?this._frameId||(this._frameId=!0):F=!0}else R=v,F=!0;return this._active=!0,F&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!F,zoomDelta:R-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=p.ease;if(this._prevEase){const v=this._prevEase,C=(p.exported.now()-v.start)/v.duration,S=v.easing(C+.01)-v.easing(C),R=.27/Math.sqrt(S*S+1e-4)*.01,F=Math.sqrt(.0729-R*R);f=p.bezier(R,F,.25,1)}return this._prevEase={start:p.exported.now(),duration:l,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class xf{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,f){return l.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(l.shiftKey?-1:1),around:v.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tm{constructor(){this._tap=new Qp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,f,v){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=f[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(l,f,v))}touchmove(l,f,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const C=f[0],S=C.y-this._swipePoint.y;return this._swipePoint=C,l.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(l,f,v)}touchend(l,f,v){this._tapTime?this._swipePoint&&0===v.length&&this.reset():this._tap.touchend(l,f,v)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wf{constructor(l,f,v){this._el=l,this._mousePan=f,this._touchPan=v}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class nm{constructor(l,f,v){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Bg{constructor(l,f,v,C){this._el=l,this._touchZoom=f,this._touchRotate=v,this._tapDragZoom=C,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const cs=_=>_.zoom||_.drag||_.pitch||_.rotate;class zg extends p.Event{}class Vg{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,f){const v=p.sub([],f,l);this.radius=p.length(v[2]<0?p.div([],v,this.constants):[v[0],v[1],0])}projectRay(l){p.div(l,l,this.constants),p.normalize(l,l),p.mul$1(l,l,this.constants);const f=p.scale$2([],l,this.radius);if(f[2]>0){const v=p.scale$2([],[0,0,1],p.dot(f,[0,0,1])),C=p.scale$2([],p.normalize([],[f[0],f[1],0]),this.radius),S=p.add([],f,p.scale$2([],p.sub([],p.add([],C,v),f),2));f[0]=S[0],f[1]=S[1]}return f}}function Ws(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class Ia{constructor(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Kn(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Vg,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),p.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[C,S,R]of this._listeners)C.addEventListener(S,C===p.window.document?this.handleWindowEvent:this.handleEvent,R)}destroy(){for(const[l,f,v]of this._listeners)l.removeEventListener(f,l===p.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(l){const f=this._map,v=f.getCanvasContainer();this._add("mapEvent",new Qd(f,l));const C=f.boxZoom=new Jp(f,l);this._add("boxZoom",C);const S=new Vy,R=new fo;f.doubleClickZoom=new xf(R,S),this._add("tapZoom",S),this._add("clickZoom",R);const F=new tm;this._add("tapDragZoom",F);const B=f.touchPitch=new Yo(f);this._add("touchPitch",B);const $=new nh(l),j=new Qr(l);f.dragRotate=new nm(l,$,j),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const X=new th(l),ee=new Wc(f,l);f.dragPan=new wf(v,X,ee),this._add("mousePan",X),this._add("touchPan",ee,["touchZoom","touchRotate"]);const se=new Uy,le=new Qu;f.touchZoomRotate=new Bg(v,le,se,F),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Da(f));const ae=f.scrollZoom=new em(f,this);this._add("scrollZoom",ae,["mousePan"]);const ce=f.keyboard=new bf;this._add("keyboard",ce);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[K]&&f[K].enable(l[K])}_add(l,f,v){this._handlers.push({handlerName:l,handler:f,allowed:v}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!cs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,f,v){for(const C in l)if(C!==v&&(!f||f.indexOf(C)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const f=[];for(const v of l)this._el.contains(v.target)&&f.push(v);return f}handleEvent(l,f){this._updatingCamera=!0;const v="renderFrame"===l.type,C=v?void 0:l,S={needsRenderFrame:!1},R={},F={},B=l.touches?this._getMapTouches(l.touches):void 0,$=B?Sn(this._el,B):v?void 0:un(this._el,l);for(const{handlerName:ee,handler:se,allowed:le}of this._handlers){if(!se.isEnabled())continue;let ae;this._blockedByActive(F,le,ee)?se.reset():se[f||l.type]&&(ae=se[f||l.type](l,$,B),this.mergeHandlerResult(S,R,ae,ee,C),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()),(ae||se.isActive())&&(F[ee]=se)}const j={};for(const ee in this._previousActiveHandlers)F[ee]||(j[ee]=C);this._previousActiveHandlers=F,(Object.keys(j).length||Ws(S))&&(this._changes.push([S,R,j]),this._triggerRenderFrame()),(Object.keys(F).length||Ws(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=S;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))}mergeHandlerResult(l,f,v,C,S){if(!v)return;p.extend(l,v);const R={handlerName:C,originalEvent:v.originalEvent||S};void 0!==v.zoomDelta&&(f.zoom=R),void 0!==v.panDelta&&(f.drag=R),void 0!==v.pitchDelta&&(f.pitch=R),void 0!==v.bearingDelta&&(f.rotate=R)}_applyChanges(){const l={},f={},v={};for(const[C,S,R]of this._changes)C.panDelta&&(l.panDelta=(l.panDelta||new p.Point(0,0))._add(C.panDelta)),C.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+C.zoomDelta),C.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+C.bearingDelta),C.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+C.pitchDelta),void 0!==C.around&&(l.around=C.around),void 0!==C.aroundCoord&&(l.aroundCoord=C.aroundCoord),void 0!==C.pinchAround&&(l.pinchAround=C.pinchAround),C.noInertia&&(l.noInertia=C.noInertia),p.extend(f,S),p.extend(v,R);this._updateMapTransform(l,f,v),this._changes=[]}_updateMapTransform(l,f,v){const C=this._map,S=C.transform,R=oe=>[oe.x,oe.y,oe.z];if((oe=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!Ws(l)){const oe=S.zoom;S.cameraElevationReference="sea",S.recenterOnTerrain(),S.cameraElevationReference="ground",oe!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&C._stop(!0),!Ws(l))return void this._fireEvents(f,v,!0);let{panDelta:F,zoomDelta:B,bearingDelta:$,pitchDelta:j,around:X,aroundCoord:ee,pinchAround:se}=l;S._isCameraConstrained&&(B>0&&(B=0),S._isCameraConstrained=!1),void 0!==se&&(X=se),(B||(oe=>f.drag&&!this._eventsInProgress.drag)())&&X&&(this._dragOrigin=R(S.pointCoordinate3D(X)),this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",C._stop(!0),X=X||C.transform.centerPoint,$&&(S.bearing+=$),j&&(S.pitch+=j),S._updateCameraState();const le=[0,0,0];if(F)if("mercator"===S.projection.name){const oe=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(X).dir),pe=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(X.sub(F)).dir);le[0]=pe[0]-oe[0],le[1]=pe[1]-oe[1]}else{const oe=S.pointCoordinate(X);if("globe"===S.projection.name){F=F.rotate(-S.angle);const pe=S._pixelsPerMercatorPixel/S.worldSize;le[0]=-F.x*p.mercatorScale(p.latFromMercatorY(oe.y))*pe,le[1]=-F.y*p.mercatorScale(S.center.lat)*pe}else{const pe=S.pointCoordinate(X.sub(F));oe&&pe&&(le[0]=pe.x-oe.x,le[1]=pe.y-oe.y)}}const ae=S.zoom,ce=[0,0,0];if(B){const oe=R(ee||S.pointCoordinate3D(X)),pe={dir:p.normalize([],p.sub([],oe,S._camera.position))};if(pe.dir[2]<0){const ge=S.zoomDeltaToMovement(oe,B);p.scale$2(ce,pe.dir,ge)}}const K=p.add(le,le,ce);S._translateCameraConstrained(K),B&&Math.abs(S.zoom-ae)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,v,!0)}_fireEvents(l,f,v){const C=cs(this._eventsInProgress),S=cs(l),R={};for(const j in l){const{originalEvent:X}=l[j];this._eventsInProgress[j]||(R[`${j}start`]=X),this._eventsInProgress[j]=l[j]}!C&&S&&this._fireEvent("movestart",S.originalEvent);for(const j in R)this._fireEvent(j,R[j]);S&&this._fireEvent("move",S.originalEvent);for(const j in l){const{originalEvent:X}=l[j];this._fireEvent(j,X)}const F={};let B;for(const j in this._eventsInProgress){const{handlerName:X,originalEvent:ee}=this._eventsInProgress[j];this._handlersById[X].isActive()||(delete this._eventsInProgress[j],B=f[X]||ee,F[`${j}end`]=B)}for(const j in F)this._fireEvent(j,F[j]);const $=cs(this._eventsInProgress);if(v&&(C||S)&&!$){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=ee=>0!==ee&&-this._bearingSnap<ee&&ee<this._bearingSnap;j?(X(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:B})):(this._map.fire(new p.Event("moveend",{originalEvent:B})),X(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new p.Event(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new zg("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const oc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class rh extends p.Evented{constructor(l,f){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=!1!==f.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}panBy(l,f,v){return l=p.Point.convert(l).mult(-1),this.panTo(this.transform.center,p.extend({offset:l},f),v)}panTo(l,f,v){return this.easeTo(p.extend({center:l},f),v)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,v){return this.easeTo(p.extend({zoom:l},f),v)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,v){return this.easeTo(p.extend({bearing:l},f),v)}resetNorth(l,f){return this.rotateTo(0,p.extend({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}cameraForBounds(l,f){l=p.LngLatBounds.convert(l);const v=f&&f.bearing||0,C=f&&f.pitch||0,S=l.getNorthWest(),R=l.getSouthEast();return this._cameraForBounds(this.transform,S,R,v,C,f)}_extendCameraOptions(l){const f={top:0,bottom:0,right:0,left:0};if("number"==typeof(l=p.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding){const v=l.padding;l.padding={top:v,bottom:v,right:v,left:v}}return l.padding=p.extend(f,l.padding),l}_minimumAABBFrustumDistance(l,f){const v=f.max[0]-f.min[0],C=f.max[1]-f.min[1];return v/C>l.aspect?v/(2*Math.tan(.5*l.fovX)*l.aspect):C/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,f,v,C,S,R){const F=l.clone(),B=this._extendCameraOptions(R);F.bearing=C,F.pitch=S;const $=p.LngLat.convert(f),j=p.LngLat.convert(v),X=.5*($.lat+j.lat),ee=.5*($.lng+j.lng),se=p.latLngToECEF(X,ee),le=p.normalize([],se),ae=p.normalize([],p.cross([],le,[0,1,0])),ce=p.cross([],ae,le),K=[ae[0],ae[1],ae[2],0,ce[0],ce[1],ce[2],0,le[0],le[1],le[2],0,0,0,0,1],oe=[se,p.latLngToECEF($.lat,$.lng),p.latLngToECEF(j.lat,$.lng),p.latLngToECEF(j.lat,j.lng),p.latLngToECEF($.lat,j.lng),p.latLngToECEF(X,$.lng),p.latLngToECEF(X,j.lng),p.latLngToECEF($.lat,ee),p.latLngToECEF(j.lat,ee)];let pe=p.Aabb.fromPoints(oe.map(gt=>[p.dot(ae,gt),p.dot(ce,gt),p.dot(le,gt)]));const ge=p.transformMat4([],pe.center,K);0===p.squaredLength(ge)&&p.set(ge,0,0,1),p.normalize(ge,ge),p.scale$2(ge,ge,p.GLOBE_RADIUS),F.center=p.ecefToLatLng(ge);const De=F.getWorldToCameraMatrix(),Me=p.invert(new Float64Array(16),De);pe=p.Aabb.applyTransform(pe,p.multiply([],De,K)),p.transformMat4(ge,ge,De);const Se=.5*(pe.max[2]-pe.min[2]),ze=this._minimumAABBFrustumDistance(F,pe),Re=p.scale$2([],[0,0,1],Se),Xe=p.add(Re,ge,Re),At=ze+(0===F.pitch?0:p.distance(ge,Xe)),Ve=F.globeCenterInViewSpace,mt=p.sub([],ge,[Ve[0],Ve[1],Ve[2]]);p.normalize(mt,mt),p.scale$2(mt,mt,At);const nt=p.add([],ge,mt);p.transformMat4(nt,nt,Me);const bt=p.earthRadius/p.GLOBE_RADIUS,He=p.length(nt),ut=p.mercatorZfromAltitude(Math.max(He*bt-p.earthRadius,Number.EPSILON),0),Lt=Math.min(F.zoomFromMercatorZAdjusted(ut),B.maxZoom);return Lt>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(F.setProjection({name:"mercator"}),F.zoom=Lt,this._cameraForBounds(F,f,v,C,S,R)):{center:F.center,zoom:Lt,bearing:C,pitch:S}}queryTerrainElevation(l,f){const v=this.transform.elevation;return v?(f=p.extend({},{exaggerated:!0},f),v.getAtPoint(p.MercatorCoordinate.fromLngLat(l),null,f.exaggerated)):null}_cameraForBounds(l,f,v,C,S,R){if("globe"===l.projection.name)return this._cameraForBoundsOnGlobe(l,f,v,C,S,R);const F=l.clone(),B=this._extendCameraOptions(R),$=F.padding;F.bearing=C,F.pitch=S;const j=p.LngLat.convert(f),X=p.LngLat.convert(v),ee=new p.LngLat(j.lng,X.lat),se=new p.LngLat(X.lng,j.lat),le=F.project(j),ae=F.project(X),ce=this.queryTerrainElevation(j),K=this.queryTerrainElevation(X),oe=this.queryTerrainElevation(ee),pe=this.queryTerrainElevation(se),ge=[[le.x,le.y,Math.min(ce||0,K||0,oe||0,pe||0)],[ae.x,ae.y,Math.max(ce||0,K||0,oe||0,pe||0)]];let De=p.Aabb.fromPoints(ge);const Me=F.getWorldToCameraMatrix(),Se=p.invert(new Float64Array(16),Me);De=p.Aabb.applyTransform(De,Me);const ze=p.sub([],De.max,De.min),Re=$.left||0,Xe=$.right||0,At=$.bottom||0,Ve=$.top||0,{left:mt,right:nt,top:bt,bottom:He}=B.padding,ut=.5*(Re+Xe),Lt=.5*(Ve+At),gt=Math.min(F.scaleZoom(F.scale*Math.min((F.width-(Re+Xe+mt+nt))/ze[0],(F.height-(At+Ve+He+bt))/ze[1])),B.maxZoom),wt=F.scale/F.zoomScale(gt);De=new p.Aabb([De.min[0]-(mt+ut)*wt,De.min[1]-(He+Lt)*wt,De.min[2]],[De.max[0]+(nt+ut)*wt,De.max[1]+(bt+Lt)*wt,De.max[2]]);const bn=.5*ze[2],Rn=this._minimumAABBFrustumDistance(F,De),an=[0,0,1,0];p.transformMat4$1(an,an,Me),p.normalize$2(an,an);const xn=p.scale$2([],an,Rn+bn),Jn=p.add([],De.center,xn),An=("number"==typeof B.offset.x&&"number"==typeof B.offset.y?new p.Point(B.offset.x,B.offset.y):p.Point.convert(B.offset)).rotate(-p.degToRad(C));De.center[0]-=An.x*wt,De.center[1]+=An.y*wt,p.transformMat4(De.center,De.center,Se),p.transformMat4(Jn,Jn,Se);const ln=[De.center[0],De.center[1],Jn[2]*F.pixelsPerMeter];p.scale$2(ln,ln,1/F.worldSize);const Oi=p.lngFromMercatorX(ln[0]),ri=p.latFromMercatorY(ln[1]),Wi=Math.min(F._zoomFromMercatorZ(ln[2]),B.maxZoom),Ni=new p.LngLat(Oi,ri);return F.mercatorFromTransition&&Wi<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(F.setProjection({name:"globe"}),F.zoom=Wi,this._cameraForBounds(F,f,v,C,S,R)):{center:Ni,zoom:Wi,bearing:C,pitch:S}}fitBounds(l,f,v){const C=this.cameraForBounds(l,f);return this._fitInternal(C,f,v)}fitScreenCoordinates(l,f,v,C,S){const R=p.Point.convert(l),F=p.Point.convert(f),B=new p.Point(Math.min(R.x,F.x),Math.min(R.y,F.y)),$=new p.Point(Math.max(R.x,F.x),Math.max(R.y,F.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(R,F))return this;const j=this.transform.pointLocation3D(B),X=this.transform.pointLocation3D($),ee=this.transform.pointLocation3D(new p.Point(B.x,$.y)),se=this.transform.pointLocation3D(new p.Point($.x,B.y)),le=[Math.min(j.lng,X.lng,ee.lng,se.lng),Math.min(j.lat,X.lat,ee.lat,se.lat)],ae=[Math.max(j.lng,X.lng,ee.lng,se.lng),Math.max(j.lat,X.lat,ee.lat,se.lat)],ce=C&&C.pitch?C.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,le,ae,v,ce,C);return this._fitInternal(K,C,S)}_fitInternal(l,f,v){return l?(delete(f=p.extend(l,f)).padding,f.linear?this.easeTo(f,v):this.flyTo(f,v)):this}jumpTo(l,f){this.stop();const v=l.preloadOnly?this.transform.clone():this.transform;let C=!1,S=!1,R=!1;return"zoom"in l&&v.zoom!==+l.zoom&&(C=!0,v.zoom=+l.zoom),void 0!==l.center&&(v.center=p.LngLat.convert(l.center)),"bearing"in l&&v.bearing!==+l.bearing&&(S=!0,v.bearing=+l.bearing),"pitch"in l&&v.pitch!==+l.pitch&&(R=!0,v.pitch=+l.pitch),null==l.padding||v.isPaddingEqual(l.padding)||(v.padding=l.padding),l.preloadOnly?(this._preloadTiles(v),this):(this.fire(new p.Event("movestart",f)).fire(new p.Event("move",f)),C&&this.fire(new p.Event("zoomstart",f)).fire(new p.Event("zoom",f)).fire(new p.Event("zoomend",f)),S&&this.fire(new p.Event("rotatestart",f)).fire(new p.Event("rotate",f)).fire(new p.Event("rotateend",f)),R&&this.fire(new p.Event("pitchstart",f)).fire(new p.Event("pitch",f)).fire(new p.Event("pitchend",f)),this.fire(new p.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(oc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,f){const v=this.transform;if(!v.projection.supportsFreeCamera)return p.warnOnce(oc),this;this.stop();const C=v.zoom,S=v.pitch,R=v.bearing;v.setFreeCameraOptions(l);const F=C!==v.zoom,B=S!==v.pitch,$=R!==v.bearing;return this.fire(new p.Event("movestart",f)).fire(new p.Event("move",f)),F&&this.fire(new p.Event("zoomstart",f)).fire(new p.Event("zoom",f)).fire(new p.Event("zoomend",f)),$&&this.fire(new p.Event("rotatestart",f)).fire(new p.Event("rotate",f)).fire(new p.Event("rotateend",f)),B&&this.fire(new p.Event("pitchstart",f)).fire(new p.Event("pitch",f)).fire(new p.Event("pitchend",f)),this.fire(new p.Event("moveend",f)),this}easeTo(l,f){this._stop(!1,l.easeId),(!1===(l=p.extend({offset:[0,0],duration:500,easing:p.ease},l)).animate||this._prefersReducedMotion(l))&&(l.duration=0);const v=this.transform,C=this.getZoom(),S=this.getBearing(),R=this.getPitch(),F=this.getPadding(),B="zoom"in l?+l.zoom:C,$="bearing"in l?this._normalizeBearing(l.bearing,S):S,j="pitch"in l?+l.pitch:R,X="padding"in l?l.padding:v.padding,ee=p.Point.convert(l.offset);let se,le,ae;if("globe"===v.projection.name){const Re=p.MercatorCoordinate.fromLngLat(v.center),Xe=ee.rotate(-v.angle);Re.x+=Xe.x/v.worldSize,Re.y+=Xe.y/v.worldSize;const At=Re.toLngLat(),Ve=p.LngLat.convert(l.center||At);this._normalizeCenter(Ve),se=v.centerPoint.add(Xe),le=new p.Point(Re.x,Re.y).mult(v.worldSize),ae=new p.Point(p.mercatorXfromLng(Ve.lng),p.mercatorYfromLat(Ve.lat)).mult(v.worldSize).sub(le)}else{se=v.centerPoint.add(ee);const Re=v.pointLocation(se),Xe=p.LngLat.convert(l.center||Re);this._normalizeCenter(Xe),le=v.project(Re),ae=v.project(Xe).sub(le)}const ce=v.zoomScale(B-C);let K,oe;l.around&&(K=p.LngLat.convert(l.around),oe=v.locationPoint(K));const pe=this._zooming||B!==C,ge=this._rotating||S!==$,De=this._pitching||j!==R,Me=!v.isPaddingEqual(X),Se=Re=>Xe=>{if(pe&&(Re.zoom=p.number(C,B,Xe)),ge&&(Re.bearing=p.number(S,$,Xe)),De&&(Re.pitch=p.number(R,j,Xe)),Me&&(Re.interpolatePadding(F,X,Xe),se=Re.centerPoint.add(ee)),K)Re.setLocationAtPoint(K,oe);else{const At=Re.zoomScale(Re.zoom-C),Ve=B>C?Math.min(2,ce):Math.max(.5,ce),mt=Math.pow(Ve,1-Xe),nt=Re.unproject(le.add(ae.mult(Xe*mt)).mult(At));Re.setLocationAtPoint(Re.renderWorldCopies?nt.wrap():nt,se)}return l.preloadOnly||this._fireMoveEvents(f),Re};if(l.preloadOnly){const Re=this._emulate(Se,l.duration,v);return this._preloadTiles(Re),this}const ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=ge,this._pitching=De,this._padding=Me,this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,ze),this._ease(Se(v),Re=>{v.recenterOnTerrain(),this._afterEase(f,Re)},l),this}_prepareEase(l,f,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||v.moving||this.fire(new p.Event("movestart",l)),this._zooming&&!v.zooming&&this.fire(new p.Event("zoomstart",l)),this._rotating&&!v.rotating&&this.fire(new p.Event("rotatestart",l)),this._pitching&&!v.pitching&&this.fire(new p.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new p.Event("move",l)),this._zooming&&this.fire(new p.Event("zoom",l)),this._rotating&&this.fire(new p.Event("rotate",l)),this._pitching&&this.fire(new p.Event("pitch",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,C=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new p.Event("zoomend",l)),C&&this.fire(new p.Event("rotateend",l)),S&&this.fire(new p.Event("pitchend",l)),this.fire(new p.Event("moveend",l))}flyTo(l,f){if(this._prefersReducedMotion(l)){const gt=p.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(gt,f)}this.stop(),l=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},l);const v=this.transform,C=this.getZoom(),S=this.getBearing(),R=this.getPitch(),F=this.getPadding(),B="zoom"in l?p.clamp(+l.zoom,v.minZoom,v.maxZoom):C,$="bearing"in l?this._normalizeBearing(l.bearing,S):S,j="pitch"in l?+l.pitch:R,X="padding"in l?l.padding:v.padding,ee=v.zoomScale(B-C),se=p.Point.convert(l.offset);let le=v.centerPoint.add(se);const ae=v.pointLocation(le),ce=p.LngLat.convert(l.center||ae);this._normalizeCenter(ce);const K=v.project(ae),oe=v.project(ce).sub(K);let pe=l.curve;const ge=Math.max(v.width,v.height),De=ge/ee,Me=oe.mag();if("minZoom"in l){const gt=p.clamp(Math.min(l.minZoom,C,B),v.minZoom,v.maxZoom),wt=ge/v.zoomScale(gt-C);pe=Math.sqrt(wt/Me*2)}const Se=pe*pe;function ze(gt){const wt=(De*De-ge*ge+(gt?-1:1)*Se*Se*Me*Me)/(2*(gt?De:ge)*Se*Me);return Math.log(Math.sqrt(wt*wt+1)-wt)}function Re(gt){return(Math.exp(gt)-Math.exp(-gt))/2}function Xe(gt){return(Math.exp(gt)+Math.exp(-gt))/2}const At=ze(0);let Ve=function(gt){return Xe(At)/Xe(At+pe*gt)},mt=function(gt){return ge*((Xe(At)*(Re(wt=At+pe*gt)/Xe(wt))-Re(At))/Se)/Me;var wt},nt=(ze(1)-At)/pe;if(Math.abs(Me)<1e-6||!isFinite(nt)){if(Math.abs(ge-De)<1e-6)return this.easeTo(l,f);const gt=De<ge?-1:1;nt=Math.abs(Math.log(De/ge))/pe,mt=function(){return 0},Ve=function(wt){return Math.exp(gt*pe*wt)}}l.duration="duration"in l?+l.duration:1e3*nt/("screenSpeed"in l?+l.screenSpeed/pe:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const bt=S!==$,He=j!==R,ut=!v.isPaddingEqual(X),Lt=gt=>wt=>{const bn=wt*nt,Rn=1/Ve(bn);gt.zoom=1===wt?B:C+gt.scaleZoom(Rn),bt&&(gt.bearing=p.number(S,$,wt)),He&&(gt.pitch=p.number(R,j,wt)),ut&&(gt.interpolatePadding(F,X,wt),le=gt.centerPoint.add(se));const an=1===wt?ce:gt.unproject(K.add(oe.mult(mt(bn))).mult(Rn));return gt.setLocationAtPoint(gt.renderWorldCopies?an.wrap():an,le),gt._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(f),gt};if(l.preloadOnly){const gt=this._emulate(Lt,l.duration,v);return this._preloadTiles(gt),this}return this._zooming=!0,this._rotating=bt,this._pitching=He,this._padding=ut,this._prepareEase(f,!1),this._ease(Lt(v),()=>this._afterEase(f),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,f)}if(!l){const v=this.handlers;v&&v.stop(!1)}return this}_ease(l,f,v){!1===v.animate||0===v.duration?(l(1),f()):(this._easeStart=p.exported.now(),this._easeOptions=v,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,f){l=p.wrap(l,-180,180);const v=Math.abs(l-f);return Math.abs(l-360-f)<v&&(l-=360),Math.abs(l+360-f)<v&&(l+=360),l}_normalizeCenter(l){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const v=l.lng-f.center.lng;l.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,f,v){const C=Math.ceil(15*f/1e3),S=[],R=l(v.clone());for(let F=0;F<=C;F++){const B=R(F/C);S.push(B.clone())}return S}}class hn{constructor(l={}){this.options=l,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const f=this.options&&this.options.compact;return this._map=l,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ae("button","mapboxgl-ctrl-attrib-button",this._container),Ae("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ae("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===f&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,f){const v=this._map._getUIString(`AttributionControl.${f}`);l.setAttribute("aria-label",v),l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(l){const v=f.reduce((C,S,R)=>(S.value&&(C+=`${S.key}=${S.value}${R<f.length-1?"&":""}`),C),"?");l.href=`${p.config.FEEDBACK_URL}/${v}#${Hc(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||"metadata"!==l.sourceDataType&&"visibility"!==l.sourceDataType&&"style"!==l.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const C=this._map.style.stylesheet;this.styleOwner=C.owner,this.styleId=C.id}const f=this._map.style._sourceCaches;for(const C in f){const S=f[C];if(S.used){const R=S.getSource();R.attribution&&l.indexOf(R.attribution)<0&&l.push(R.attribution)}}l.sort((C,S)=>C.length-S.length),l=l.filter((C,S)=>{for(let R=S+1;R<l.length;R++)if(l[R].indexOf(C)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const v=l.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,l.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class oh{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=Ae("div","mapboxgl-ctrl");const f=Ae("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&"metadata"!==l.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(0===Object.entries(l).length)return!0;for(const f in l){const v=l[f].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class Ef{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,v=f?this._queue.concat(f):this._queue;for(const C of v)if(C.id===l)return void(C.cancelled=!0)}run(l=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const v of f)if(!v.cancelled&&(v.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function sc(_,l,f){if(_=new p.LngLat(_.lng,_.lat),l){const v=new p.LngLat(_.lng-360,_.lat),C=new p.LngLat(_.lng+360,_.lat),S=360*Math.ceil(Math.abs(_.lng-f.center.lng)/360),R=f.locationPoint(_).distSqr(l),F=l.x<0||l.y<0||l.x>f.width||l.y>f.height;f.locationPoint(v).distSqr(l)<R&&(F||Math.abs(v.lng-f.center.lng)<S)?_=v:f.locationPoint(C).distSqr(l)<R&&(F||Math.abs(C.lng-f.center.lng)<S)&&(_=C)}for(;Math.abs(_.lng-f.center.lng)>180;){const v=f.locationPoint(_);if(v.x>=0&&v.y>=0&&v.x<=f.width&&v.y<=f.height)break;_.lng>f.center.lng?_.lng-=360:_.lng+=360}return _}const Wr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Jt extends p.Evented{constructor(l,f){if(super(),(l instanceof p.window.HTMLElement||f)&&(l=p.extend({element:l},f)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=p.Point.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ae("div");const C=41,S=27,R=ke("svg",{display:"block",height:C*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${C}`},this._element),F=ke("radialGradient",{id:"shadowGradient"},ke("defs",{},R));ke("stop",{offset:"10%","stop-opacity":.4},F),ke("stop",{offset:"100%","stop-opacity":.05},F),ke("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},R),ke("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},R),ke("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},R),ke("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},R),this._offset=p.Point.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",C=>{C.preventDefault()}),this._element.addEventListener("mousedown",C=>{C.preventDefault()});const v=this._element.classList;for(const C in Wr)v.remove(`mapboxgl-marker-anchor-${C}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=p.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const C=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[C,-1*(24.6+C)],"bottom-right":[-C,-1*(24.6+C)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const f=l.code,v=l.charCode||l.keyCode;"Space"!==f&&"Enter"!==f&&32!==v&&13!==v||this.togglePopup()}_onMapClick(l){const f=l.originalEvent.target,v=this._element;this._popup&&(f===v||v.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,f=this._pos;if(!l||!f)return!1;const v=l.unproject(f),C=l.getFreeCameraOptions();if(!C.position)return!1;const S=C.position.toLngLat();return S.distanceTo(v)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const f=this._pos;if(!f||f.x<0||f.x>l.transform.width||f.y<0||f.y>l.transform.height)return void this._clearFadeTimer();const v=l.unproject(f);let C;l._showingGlobe()&&p.isLngLatBehindGlobe(l.transform,this._lngLat)?C=0:(C=1-l._queryFogOpacity(v),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(C*=this._occludedOpacity)),this._element.style.opacity=`${C}`,this._element.style.pointerEvents=C>0?"auto":"none",this._popup&&this._popup._setOpacity(C),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${l.x}px,${l.y}px)\n            ${Wr[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${f.x}px,${f.y}px)\n        `}_calculateXYTransform(){const l=this._pos,f=this._map,v=this.getPitchAlignment();if(!f||!l||"map"!==v)return"";if(!f._showingGlobe()){const B=f.getPitch();return B?`rotateX(${B}deg)`:""}const C=p.radToDeg(p.globeTiltAtLngLat(f.transform,this._lngLat)),S=l.sub(p.globeCenterToScreenPoint(f.transform)),R=Math.abs(S.x)+Math.abs(S.y);if(0===R)return"";const F=C/R;return`rotateX(${-S.y*F}deg) rotateY(${S.x*F}deg)`}_calculateZTransform(){const l=this._pos,f=this._map;if(!f||!l)return"";let v=0;const C=this.getRotationAlignment();if("map"===C)if(f._showingGlobe()){const S=f.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),R=f.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(S);v=p.radToDeg(Math.atan2(R.y,R.x))-90}else v=-f.getBearing();else if("horizon"===C){const S=p.smoothstep(4,6,f.getZoom()),R=p.globeCenterToScreenPoint(f.transform);R.y+=S*f.transform.height;const F=l.sub(R),B=p.radToDeg(Math.atan2(F.y,F.x));v=(B>90?B-270:B+90)*(1-S)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(l){p.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=sc(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),!0===l?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=p.Point.convert(l),this._update(),this}_onMove(l){const f=this._map;if(!f)return;const v=this._pointerdownPos,C=this._positionDelta;if(v&&C){if(!this._isDragging){const S=this._clickTolerance||f._clickTolerance;if(l.point.dist(v)<S)return;this._isDragging=!0}this._pos=l.point.sub(C),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(l){const f=this._map,v=this._pos;f&&v&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(v),this._pointerdownPos=l.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const f=this._map;return f&&(l?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Mr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ug=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function jg(_=new p.Point(0,0),l="bottom"){if("number"==typeof _){const f=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(l){case"top":return new p.Point(0,_);case"top-left":return new p.Point(f,f);case"top-right":return new p.Point(-f,f);case"bottom":return new p.Point(0,-_);case"bottom-left":return new p.Point(f,-f);case"bottom-right":return new p.Point(-f,-f);case"left":return new p.Point(_,0);case"right":return new p.Point(-_,0)}return new p.Point(0,0)}return _ instanceof p.Point||Array.isArray(_)?p.Point.convert(_):p.Point.convert(_[l]||[0,0])}class Cf{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const f=p.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,f,v){this._start=this.getValue(f),this._end=l,this._startTime=f,this._endTime=f+v}}const $g={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Xo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Cs={showCompass:!0,showZoom:!0,visualizePitch:!1};class sh{constructor(l,f,v=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new nh({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,v&&(this.mousePitch=new Qr({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),Wt()}move(l,f){const v=this.map,C=this.mouseRotate.mousemoveWindow(l,f),S=C&&C.bearingDelta;if(S&&v.setBearing(v.getBearing()+S),this.mousePitch){const R=this.mousePitch.mousemoveWindow(l,f),F=R&&R.pitchDelta;F&&v.setPitch(v.getPitch()+F)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){on(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(p.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),un(this.element,l)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,un(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){1!==l.targetTouches.length?this.reset():(this._startPos=this._lastPos=Sn(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){1!==l.targetTouches.length?this.reset():(this._lastPos=Sn(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){0===l.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const fr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Nn={maxWidth:100,unit:"metric"},Po={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ka={version:p.version,supported:Ye,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends rh{constructor(_){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(_=p.extend({},Xo,_)).minZoom&&null!=_.maxZoom&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=_.minPitch&&null!=_.maxPitch&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=_.minPitch&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=_.maxPitch&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(_.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new jc(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._useWebGL2=_.useWebGL2,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._collectResourceTiming=_.collectResourceTiming,this._optimizeForTerrain=_.optimizeForTerrain,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new Ef,this._domRenderTaskQueue=new Ef,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},$g,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Cf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,"string"==typeof _.container){if(this._container=p.window.document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Ia(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),this._hash=_.hash&&new Ma("string"==typeof _.hash&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,p.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),_.attributionControl&&this.addControl(new hn({customAttribution:_.customAttribution})),this._logoControl=new oh,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update("style"===l.dataType),this.fire(new p.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new p.Event(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(_,l){if(void 0===l&&(l=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=_.onAdd(this);this._controls.push(_);const v=this._controlPositions[l];return-1!==l.indexOf("bottom")?v.insertBefore(f,v.firstChild):v.appendChild(f),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(_);return l>-1&&this._controls.splice(l,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new p.Event("movestart",_)).fire(new p.Event("move",_)),this.fire(new p.Event("resize",_)),l&&this.fire(new p.Event("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(p.LngLatBounds.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return"auto"===_?p.window.navigator.language:Array.isArray(_)?0===_.length?void 0:_.map(l=>"auto"===l?p.window.navigator.language:l):_}setLanguage(_){const l=this._parseLanguage(_);if(!this.style||l===this._language)return this;this._language=l,this.style._reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(_){return this._lazyInitEmptyStyle(),_?"string"==typeof _&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const _=this.transform,l=_.projection.name;let f;"globe"===l&&_.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(_.setMercatorFromTransition(),f=!0):"mercator"===l&&_.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(_.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,l){return this._updateProjection(_||l||{name:"mercator"})}_updateProjection(_){let l;if(l="globe"===_.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),l){this.painter.clearBackgroundTiles();for(const f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(_){return this.transform.locationPoint3D(p.LngLat.convert(_))}unproject(_){return this.transform.pointLocation3D(p.Point.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(_,l,f){if("mouseenter"===_||"mouseover"===_){let v=!1;const C=R=>{const F=l.filter($=>this.getLayer($)),B=F.length?this.queryRenderedFeatures(R.point,{layers:F}):[];B.length?v||(v=!0,f.call(this,new uo(_,this,R.originalEvent,{features:B}))):v=!1},S=()=>{v=!1};return{layers:new Set(l),listener:f,delegates:{mousemove:C,mouseout:S}}}if("mouseleave"===_||"mouseout"===_){let v=!1;const C=R=>{const F=l.filter(B=>this.getLayer(B));(F.length?this.queryRenderedFeatures(R.point,{layers:F}):[]).length?v=!0:v&&(v=!1,f.call(this,new uo(_,this,R.originalEvent)))},S=R=>{v&&(v=!1,f.call(this,new uo(_,this,R.originalEvent)))};return{layers:new Set(l),listener:f,delegates:{mousemove:C,mouseout:S}}}{const v=C=>{const S=l.filter(F=>this.getLayer(F)),R=S.length?this.queryRenderedFeatures(C.point,{layers:S}):[];R.length&&(C.features=R,f.call(this,C),delete C.features)};return{layers:new Set(l),listener:f,delegates:{[_]:v}}}}on(_,l,f){if(void 0===f)return super.on(_,l);Array.isArray(l)||(l=[l]);const v=this._createDelegatedListener(_,l,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(v);for(const C in v.delegates)this.on(C,v.delegates[C]);return this}once(_,l,f){if(void 0===f)return super.once(_,l);Array.isArray(l)||(l=[l]);const v=this._createDelegatedListener(_,l,f);for(const C in v.delegates)this.once(C,v.delegates[C]);return this}off(_,l,f){if(void 0===f)return super.off(_,l);l=new Set(Array.isArray(l)?l:[l]);const v=(S,R)=>{if(S.size!==R.size)return!1;for(const F of S)if(!R.has(F))return!1;return!0},C=this._delegatedListeners?this._delegatedListeners[_]:void 0;return C&&(S=>{for(let R=0;R<S.length;R++){const F=S[R];if(F.listener===f&&v(F.layers,l)){for(const B in F.delegates)this.off(B,F.delegates[B]);return S.splice(R,1),this}}})(C),this}queryRenderedFeatures(_,l){return this.style?(void 0!==l||void 0===_||_ instanceof p.Point||Array.isArray(_)||(l=_,_=void 0),this.style.queryRenderedFeatures(_=_||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(_,l){return this.style.querySourceFeatures(_,l)}isPointOnSurface(_){const{name:l}=this.transform.projection;return"globe"!==l&&"mercator"!==l&&p.warnOnce(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(_))}setStyle(_,l){return!1!==(l=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(_,l))}_getUIString(_){const l=this._locale[_];if(null==l)throw new Error(`Missing UI string '${_}'`);return l}_updateStyle(_,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_&&(this.style=new Un(this,l||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof _?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Un(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,l){if("string"==typeof _){const f=this._requestManager.normalizeStyleURL(_),v=this._requestManager.transformRequest(f,p.ResourceType.Style);p.getJSON(v,(C,S)=>{C?this.fire(new p.ErrorEvent(C)):S&&this._updateDiff(S,l)})}else"object"==typeof _&&this._updateDiff(_,l)}_updateDiff(_,l){try{this.style.setState(_)&&this._update(!0)}catch(f){p.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(_,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(_,l){return this._lazyInitEmptyStyle(),this.style.addSource(_,l),this._update(!0)}isSourceLoaded(_){return!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){const _=this.style&&this.style._sourceCaches;for(const l in _){const f=_[l]._tiles;for(const v in f){const C=f[v];if("loaded"!==C.state&&"errored"!==C.state)return!1}}return!0}addSourceType(_,l,f){this._lazyInitEmptyStyle(),this.style.addSourceType(_,l,f)}removeSource(_){return this.style.removeSource(_),this._updateTerrain(),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,l,{pixelRatio:f=1,sdf:v=!1,stretchX:C,stretchY:S,content:R}={}){if(this._lazyInitEmptyStyle(),l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap){const{width:F,height:B,data:$}=p.exported.getImageData(l);this.style.addImage(_,{data:new p.RGBAImage({width:F,height:B},$),pixelRatio:f,stretchX:C,stretchY:S,content:R,sdf:v,version:0})}else if(void 0===l.width||void 0===l.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:F,height:B}=l,$=l;this.style.addImage(_,{data:new p.RGBAImage({width:F,height:B},new Uint8Array($.data)),pixelRatio:f,stretchX:C,stretchY:S,content:R,sdf:v,version:0,userImage:$}),$.onAdd&&$.onAdd(this,_)}}updateImage(_,l){const f=this.style.getImage(_);if(!f)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap?p.exported.getImageData(l):l,{width:C,height:S}=v;void 0!==C&&void 0!==S?C===f.data.width&&S===f.data.height?(f.data.replace(v.data,!(l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap)),this.style.updateImage(_,f)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${C}, ${S})\n                must be that same as the previous version of the image\n                (${f.data.width}, ${f.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,l){p.getImage(this._requestManager.transformRequest(_,p.ResourceType.Image),(f,v)=>{l(f,v instanceof p.window.HTMLImageElement?p.exported.getImageData(v):v)})}listImages(){return this.style.listImages()}addLayer(_,l){return this._lazyInitEmptyStyle(),this.style.addLayer(_,l),this._update(!0)}moveLayer(_,l){return this.style.moveLayer(_,l),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}setLayerZoomRange(_,l,f){return this.style.setLayerZoomRange(_,l,f),this._update(!0)}setFilter(_,l,f={}){return this.style.setFilter(_,l,f),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,l,f,v={}){return this.style.setPaintProperty(_,l,f,v),this._update(!0)}getPaintProperty(_,l){return this.style.getPaintProperty(_,l)}setLayoutProperty(_,l,f,v={}){return this.style.setLayoutProperty(_,l,f,v),this._update(!0)}getLayoutProperty(_,l){return this.style.getLayoutProperty(_,l)}setLight(_,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(_),this.transform):0}setFeatureState(_,l){return this.style.setFeatureState(_,l),this._update()}removeFeatureState(_,l){return this.style.removeFeatureState(_,l),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let f,v,C,S=this._container;for(;S&&(!v||!C);){const R=p.window.getComputedStyle(S).transform;R&&"none"!==R&&(f=R.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&"0"!==f[0]&&"1"!==f[0]&&(v=f[0]),f[3]&&"0"!==f[3]&&"1"!==f[3]&&(C=f[3])),S=S.parentElement}this._containerWidth=v?Math.abs(_/v):_,this._containerHeight=C?Math.abs(l/C):l}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ae("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=Ae("div","mapboxgl-canvas-container",_);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=Ae("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=Ae("div","mapboxgl-control-container",_),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{v[C]=Ae("div",`mapboxgl-ctrl-${C}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,l){const f=p.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(_),this._canvas.height=f*Math.ceil(l),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${l}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const l=this._markers.indexOf(_);-1!==l&&this._markers.splice(l,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){const l=this._popups.indexOf(_);-1!==l&&this._popups.splice(l,1)}_setupPainter(){const _=p.extend({},Ye.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._useWebGL2&&this._canvas.getContext("webgl2",_),f=l||this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);f?(this._useWebGL2&&!l&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(f,!0),this.painter=new zc(f,this.transform,!!l),this.on("data",v=>{"source"===v.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(f)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let l;const f=this.painter.context.extTimerQuery,v=p.exported.now();if(this.listens("gpu-timing-frame")&&(l=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,B=this.transform.pitch,$=p.exported.now(),j=new p.EvaluationParameters(F,{now:$,fadeDuration:C,pitch:B,transition:this.style.getTransition()});this.style.update(j)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(v),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const F=p.exported.now()-v;f.endQueryEXT(f.TIME_ELAPSED_EXT,l),setTimeout(()=>{const B=f.getQueryObjectEXT(l,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(l),this.fire(new p.Event("gpu-timing-frame",{cpuTime:F,gpuTime:B})),p.window.performance.mark("frame-gpu",{startTime:v,detail:{gpuTime:B}})},50)}if(this.listens("gpu-timing-layer")){const F=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(F);this.fire(new p.Event("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const F=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(F);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:B}))},50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(R||this._repaint)this.triggerRepaint();else{const F=!this.isMoving()&&this.loaded();if(F&&(S=this._updateAverageElevation(v,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),F&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(const l of this._markers)_&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!_||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(_,l=!1){const f=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&f(0);if((l||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const v=this.transform.averageElevation;let C=this.transform.sampleAverageElevation(),S=!1;this.transform.elevation&&(S=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(C)?C=0:this._averageElevationLastSampledAt=_;const R=Math.abs(v-C);if(R>1){if(this._isInitialLoad||S)return this._averageElevation.jumpTo(C),f(C);this._averageElevation.easeTo(C,_,300)}else if(R>1e-4)return this._averageElevation.jumpTo(C),f(C)}return!!this._averageElevation.isEasing(_)&&f(this._averageElevation.getValue(_))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===p.AUTH_ERR_MSG||401===_.status)){const l=this.painter.context.gl;p.storeAuthState(l,!1),this._logoControl instanceof oh&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const _=this._isDragging();this.painter.updateTerrain(this.style,_)}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const f=this.painter.context.gl,v=f.createFramebuffer();function C(S){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,S,0);const R=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,R),R}return f.bindFramebuffer(f.FRAMEBUFFER,v),this._canvasPixelComparison(C(_),l.canvasCopies.map(C),l.timeStamps)}_canvasPixelComparison(_,l,f){let v=f[1]-f[0];const C=_.length/4;for(let S=0;S<l.length;S++){const R=l[S];let F=0;for(let B=0;B<R.length;B+=4)R[B]===_[B]&&R[B+1]===_[B+1]&&R[B+2]===_[B+2]&&R[B+3]===_[B+3]&&(F+=1);v+=(f[S+2]-f[S+1])*(1-F/C)}return v}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=p.exported.frame(l=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(l)}))}_preloadTiles(_){const l=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(l,(f,v)=>f._preloadTiles(_,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,_&&this._update())}_setCacheLimits(_,l){p.setCacheLimits(_,l)}get version(){return p.version}},NavigationControl:class{constructor(_){this.options=p.extend({},Cs,_),this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),Ae("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),Ae("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:l}):f.resetNorth({},{originalEvent:l}))}),this._compassIcon=Ae("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map;if(!_)return;const l=_.getZoom(),f=l===_.getMaxZoom(),v=l===_.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const _=this._map;if(!_)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new sh(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){const _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,l){const f=Ae("button",_,this._container);return f.type="button",f.addEventListener("click",l),f}_setButtonTitle(_,l){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${l}`);_.setAttribute("aria-label",f),_.firstElementChild&&_.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends p.Evented{constructor(_){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},fr,_),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=$c(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){const l=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,_(f)};void 0!==this._supportsGeolocation?_(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(f=>l("denied"!==f.state)).catch(()=>l()):l()}_isOutOfMapMaxBounds(_){const l=this._map.getMaxBounds(),f=_.coords;return!!l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(_),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",_)),this._finish()}}_updateCamera(_){const l=new p.LngLat(_.coords.longitude,_.coords.latitude),f=_.coords.accuracy,v=this._map.getBearing(),C=p.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(f),C,{geolocateSource:!0})}_updateMarker(_){if(_){const l=new p.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map.transform,l=p.mercatorZfromAltitude(1,_._center.lat)*_.worldSize,f=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(1===_.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===_.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=Ae("button","mapboxgl-ctrl-geolocate",this._container),Ae("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===_){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ae("div","mapboxgl-user-location"),this._dotElement.appendChild(Ae("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ae("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Jt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ae("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||"ACTIVE_LOCK"!==this._watchState||l.originalEvent&&"resize"===l.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:!0===_.absolute&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(l=>{"granted"===l&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:hn,ScaleControl:class{constructor(_){this.options=p.extend({},Nn,_),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const _=this.options.maxWidth||100,l=this._map,f=l._containerHeight/2,v=l._containerWidth/2-_/2,C=l.unproject([v,f]),S=l.unproject([v+_,f]),R=C.distanceTo(S);if("imperial"===this.options.unit){const F=3.2808*R;F>5280?this._setScale(_,F/5280,"mile"):this._setScale(_,F,"foot")}else"nautical"===this.options.unit?this._setScale(_,R/1852,"nautical-mile"):R>=1e3?this._setScale(_,R/1e3,"kilometer"):this._setScale(_,R,"meter")}_setScale(_,l,f){this._map._requestDomTask(()=>{const v=function(S){const R=Math.pow(10,`${Math.floor(S)}`.length-1);let F=S/R;return F=F>=10?10:F>=5?5:F>=3?3:F>=2?2:F>=1?1:function(B){const $=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*$)/$}(F),R*F}(l),C=v/l;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==f?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(v):`${v}&nbsp;${Po[f]}`,this._container.style.width=_*C+"px"})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof p.window.HTMLElement?this._container=_.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=Ae("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ae("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(_){super(),this.options=p.extend(Object.create(Mr),_),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=p.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(p.window.document.createTextNode(_))}setHTML(_){const l=p.window.document.createDocumentFragment(),f=p.window.document.createElement("body");let v;for(f.innerHTML=_;v=f.firstChild,v;)l.appendChild(v);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=Ae("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(_),this.options.closeButton){const f=this._closeButton=Ae("button","mapboxgl-popup-close-button",l);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let l;return this._classList.delete(_)?l=!1:(this._classList.add(_),l=!0),this._updateClassList(),l}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const l=this._map,f=this._container,v=this._pos;if(!l||!f||!v)return"bottom";const C=f.offsetWidth,S=f.offsetHeight,R=v.x<C/2,F=v.x>l.transform.width-C/2;if(v.y+_<S)return R?"top-left":F?"top-right":"top";if(v.y>l.transform.height-S){if(R)return"bottom-left";if(F)return"bottom-right"}return R?"left":F?"right":"bottom"}_updateClassList(){const _=this._container;if(!_)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),_.className=l.join(" ")}_update(_){const l=this._map,f=this._content;if(!l||!this._lngLat&&!this._trackPointer||!f)return;let v=this._container;if(v||(v=this._container=Ae("div","mapboxgl-popup",l.getContainer()),this._tip=Ae("div","mapboxgl-popup-tip",v),v.appendChild(f)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sc(this._lngLat,this._pos,l.transform)),!this._trackPointer||_){const C=this._pos=this._trackPointer&&_?_:l.project(this._lngLat),S=jg(this.options.offset),R=this._anchor=this._getAnchor(S.y),F=jg(this.options.offset,R),B=C.add(F).round();l._requestDomTask(()=>{this._container&&R&&(this._container.style.transform=`${Wr[R]} translate(${B.x}px,${B.y}px)`)})}if(!this._marker&&l._showingGlobe()){const C=p.isLngLatBehindGlobe(l.transform,this._lngLat)?0:1;this._setOpacity(C)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Ug);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:Jt,Style:Un,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:Vc,Evented:p.Evented,config:p.config,prewarm:function(){vl().acquire(Vo)},clearPrewarmedResources:function(){const _=lo;_&&(_.isPreloaded()&&1===_.numActive()?(_.release(Vo),lo=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(_){p.config.ACCESS_TOKEN=_},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(_){p.config.API_URL=_},get workerCount(){return Er.workerCount},set workerCount(_){Er.workerCount=_},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){p.config.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){p.clearTileCache(_)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Ka}),E}()},5619:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{X:()=>Be});var E=ne(8645);class Be extends E.x{constructor(p){super(),this._value=p}get value(){return this.getValue()}_subscribe(p){const ue=super._subscribe(p);return!ue.closed&&p.next(this._value),ue}getValue(){const{hasError:p,thrownError:ue,_value:Ye}=this;if(p)throw ue;return this._throwIfClosed(),Ye}next(p){super.next(this._value=p)}}},5592:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{y:()=>Le});var E=ne(305),Be=ne(7394),rt=ne(4850),p=ne(8407),ue=ne(2653),Ye=ne(4674),Ge=ne(1441);let Le=(()=>{class Qe{constructor(Wt){Wt&&(this._subscribe=Wt)}lift(Wt){const on=new Qe;return on.source=this,on.operator=Wt,on}subscribe(Wt,on,Ot){const Cn=function $e(Qe){return Qe&&Qe instanceof E.Lv||function ke(Qe){return Qe&&(0,Ye.m)(Qe.next)&&(0,Ye.m)(Qe.error)&&(0,Ye.m)(Qe.complete)}(Qe)&&(0,Be.Nn)(Qe)}(Wt)?Wt:new E.Hp(Wt,on,Ot);return(0,Ge.x)(()=>{const{operator:un,source:Sn}=this;Cn.add(un?un.call(Cn,Sn):Sn?this._subscribe(Cn):this._trySubscribe(Cn))}),Cn}_trySubscribe(Wt){try{return this._subscribe(Wt)}catch(on){Wt.error(on)}}forEach(Wt,on){return new(on=Ae(on))((Ot,Cn)=>{const un=new E.Hp({next:Sn=>{try{Wt(Sn)}catch(gn){Cn(gn),un.unsubscribe()}},error:Cn,complete:Ot});this.subscribe(un)})}_subscribe(Wt){var on;return null===(on=this.source)||void 0===on?void 0:on.subscribe(Wt)}[rt.L](){return this}pipe(...Wt){return(0,p.U)(Wt)(this)}toPromise(Wt){return new(Wt=Ae(Wt))((on,Ot)=>{let Cn;this.subscribe(un=>Cn=un,un=>Ot(un),()=>on(Cn))})}}return Qe.create=It=>new Qe(It),Qe})();function Ae(Qe){var It;return null!==(It=Qe??ue.config.Promise)&&void 0!==It?It:Promise}},7328:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{t:()=>rt});var E=ne(8645),Be=ne(4552);class rt extends E.x{constructor(ue=1/0,Ye=1/0,Ge=Be.l){super(),this._bufferSize=ue,this._windowTime=Ye,this._timestampProvider=Ge,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=Ye===1/0,this._bufferSize=Math.max(1,ue),this._windowTime=Math.max(1,Ye)}next(ue){const{isStopped:Ye,_buffer:Ge,_infiniteTimeWindow:Le,_timestampProvider:Ae,_windowTime:ke}=this;Ye||(Ge.push(ue),!Le&&Ge.push(Ae.now()+ke)),this._trimBuffer(),super.next(ue)}_subscribe(ue){this._throwIfClosed(),this._trimBuffer();const Ye=this._innerSubscribe(ue),{_infiniteTimeWindow:Ge,_buffer:Le}=this,Ae=Le.slice();for(let ke=0;ke<Ae.length&&!ue.closed;ke+=Ge?1:2)ue.next(Ae[ke]);return this._checkFinalizedStatuses(ue),Ye}_trimBuffer(){const{_bufferSize:ue,_timestampProvider:Ye,_buffer:Ge,_infiniteTimeWindow:Le}=this,Ae=(Le?1:2)*ue;if(ue<1/0&&Ae<Ge.length&&Ge.splice(0,Ge.length-Ae),!Le){const ke=Ye.now();let $e=0;for(let Qe=1;Qe<Ge.length&&Ge[Qe]<=ke;Qe+=2)$e=Qe;$e&&Ge.splice(0,$e+1)}}}},8645:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{x:()=>Ge});var E=ne(5592),Be=ne(7394);const p=(0,ne(2306).d)(Ae=>function(){Ae(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var ue=ne(9039),Ye=ne(1441);let Ge=(()=>{class Ae extends E.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift($e){const Qe=new Le(this,this);return Qe.operator=$e,Qe}_throwIfClosed(){if(this.closed)throw new p}next($e){(0,Ye.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Qe of this.currentObservers)Qe.next($e)}})}error($e){(0,Ye.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=$e;const{observers:Qe}=this;for(;Qe.length;)Qe.shift().error($e)}})}complete(){(0,Ye.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:$e}=this;for(;$e.length;)$e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var $e;return(null===($e=this.observers)||void 0===$e?void 0:$e.length)>0}_trySubscribe($e){return this._throwIfClosed(),super._trySubscribe($e)}_subscribe($e){return this._throwIfClosed(),this._checkFinalizedStatuses($e),this._innerSubscribe($e)}_innerSubscribe($e){const{hasError:Qe,isStopped:It,observers:Wt}=this;return Qe||It?Be.Lc:(this.currentObservers=null,Wt.push($e),new Be.w0(()=>{this.currentObservers=null,(0,ue.P)(Wt,$e)}))}_checkFinalizedStatuses($e){const{hasError:Qe,thrownError:It,isStopped:Wt}=this;Qe?$e.error(It):Wt&&$e.complete()}asObservable(){const $e=new E.y;return $e.source=this,$e}}return Ae.create=(ke,$e)=>new Le(ke,$e),Ae})();class Le extends Ge{constructor(ke,$e){super(),this.destination=ke,this.source=$e}next(ke){var $e,Qe;null===(Qe=null===($e=this.destination)||void 0===$e?void 0:$e.next)||void 0===Qe||Qe.call($e,ke)}error(ke){var $e,Qe;null===(Qe=null===($e=this.destination)||void 0===$e?void 0:$e.error)||void 0===Qe||Qe.call($e,ke)}complete(){var ke,$e;null===($e=null===(ke=this.destination)||void 0===ke?void 0:ke.complete)||void 0===$e||$e.call(ke)}_subscribe(ke){var $e,Qe;return null!==(Qe=null===($e=this.source)||void 0===$e?void 0:$e.subscribe(ke))&&void 0!==Qe?Qe:Be.Lc}}},305:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{Hp:()=>Ot,Lv:()=>Qe});var E=ne(4674),Be=ne(7394),rt=ne(2653),p=ne(3894),ue=ne(2420);const Ye=Ae("C",void 0,void 0);function Ae(it,Ne,Nt){return{kind:it,value:Ne,error:Nt}}var ke=ne(7599),$e=ne(1441);class Qe extends Be.w0{constructor(Ne){super(),this.isStopped=!1,Ne?(this.destination=Ne,(0,Be.Nn)(Ne)&&Ne.add(this)):this.destination=gn}static create(Ne,Nt,$t){return new Ot(Ne,Nt,$t)}next(Ne){this.isStopped?Sn(function Le(it){return Ae("N",it,void 0)}(Ne),this):this._next(Ne)}error(Ne){this.isStopped?Sn(function Ge(it){return Ae("E",void 0,it)}(Ne),this):(this.isStopped=!0,this._error(Ne))}complete(){this.isStopped?Sn(Ye,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Ne){this.destination.next(Ne)}_error(Ne){try{this.destination.error(Ne)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const It=Function.prototype.bind;function Wt(it,Ne){return It.call(it,Ne)}class on{constructor(Ne){this.partialObserver=Ne}next(Ne){const{partialObserver:Nt}=this;if(Nt.next)try{Nt.next(Ne)}catch($t){Cn($t)}}error(Ne){const{partialObserver:Nt}=this;if(Nt.error)try{Nt.error(Ne)}catch($t){Cn($t)}else Cn(Ne)}complete(){const{partialObserver:Ne}=this;if(Ne.complete)try{Ne.complete()}catch(Nt){Cn(Nt)}}}class Ot extends Qe{constructor(Ne,Nt,$t){let Ft;if(super(),(0,E.m)(Ne)||!Ne)Ft={next:Ne??void 0,error:Nt??void 0,complete:$t??void 0};else{let Kt;this&&rt.config.useDeprecatedNextContext?(Kt=Object.create(Ne),Kt.unsubscribe=()=>this.unsubscribe(),Ft={next:Ne.next&&Wt(Ne.next,Kt),error:Ne.error&&Wt(Ne.error,Kt),complete:Ne.complete&&Wt(Ne.complete,Kt)}):Ft=Ne}this.destination=new on(Ft)}}function Cn(it){rt.config.useDeprecatedSynchronousErrorHandling?(0,$e.O)(it):(0,p.h)(it)}function Sn(it,Ne){const{onStoppedNotification:Nt}=rt.config;Nt&&ke.z.setTimeout(()=>Nt(it,Ne))}const gn={closed:!0,next:ue.Z,error:function un(it){throw it},complete:ue.Z}},7394:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{Lc:()=>Ye,w0:()=>ue,Nn:()=>Ge});var E=ne(4674);const rt=(0,ne(2306).d)(Ae=>function($e){Ae(this),this.message=$e?`${$e.length} errors occurred during unsubscription:\n${$e.map((Qe,It)=>`${It+1}) ${Qe.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=$e});var p=ne(9039);class ue{constructor(ke){this.initialTeardown=ke,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let ke;if(!this.closed){this.closed=!0;const{_parentage:$e}=this;if($e)if(this._parentage=null,Array.isArray($e))for(const Wt of $e)Wt.remove(this);else $e.remove(this);const{initialTeardown:Qe}=this;if((0,E.m)(Qe))try{Qe()}catch(Wt){ke=Wt instanceof rt?Wt.errors:[Wt]}const{_finalizers:It}=this;if(It){this._finalizers=null;for(const Wt of It)try{Le(Wt)}catch(on){ke=ke??[],on instanceof rt?ke=[...ke,...on.errors]:ke.push(on)}}if(ke)throw new rt(ke)}}add(ke){var $e;if(ke&&ke!==this)if(this.closed)Le(ke);else{if(ke instanceof ue){if(ke.closed||ke._hasParent(this))return;ke._addParent(this)}(this._finalizers=null!==($e=this._finalizers)&&void 0!==$e?$e:[]).push(ke)}}_hasParent(ke){const{_parentage:$e}=this;return $e===ke||Array.isArray($e)&&$e.includes(ke)}_addParent(ke){const{_parentage:$e}=this;this._parentage=Array.isArray($e)?($e.push(ke),$e):$e?[$e,ke]:ke}_removeParent(ke){const{_parentage:$e}=this;$e===ke?this._parentage=null:Array.isArray($e)&&(0,p.P)($e,ke)}remove(ke){const{_finalizers:$e}=this;$e&&(0,p.P)($e,ke),ke instanceof ue&&ke._removeParent(this)}}ue.EMPTY=(()=>{const Ae=new ue;return Ae.closed=!0,Ae})();const Ye=ue.EMPTY;function Ge(Ae){return Ae instanceof ue||Ae&&"closed"in Ae&&(0,E.m)(Ae.remove)&&(0,E.m)(Ae.add)&&(0,E.m)(Ae.unsubscribe)}function Le(Ae){(0,E.m)(Ae)?Ae():Ae.unsubscribe()}},2653:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{config:()=>E});const E={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},6232:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{E:()=>Be});const Be=new(ne(5592).y)(ue=>ue.complete())},9666:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{D:()=>Nt});var E=ne(4829),Be=ne(3093),rt=ne(9360);function p($t,Ft=0){return(0,rt.e)((Kt,ui)=>{ui.add($t.schedule(()=>Kt.subscribe(ui),Ft))})}var Ge=ne(5592),Ae=ne(4971),ke=ne(4674),$e=ne(7103);function It($t,Ft){if(!$t)throw new Error("Iterable cannot be null");return new Ge.y(Kt=>{(0,$e.f)(Kt,Ft,()=>{const ui=$t[Symbol.asyncIterator]();(0,$e.f)(Kt,Ft,()=>{ui.next().then(gi=>{gi.done?Kt.complete():Kt.next(gi.value)})},0,!0)})})}var Wt=ne(8382),on=ne(4026),Ot=ne(4266),Cn=ne(3664),un=ne(5726),Sn=ne(9853),gn=ne(541);function Nt($t,Ft){return Ft?function Ne($t,Ft){if(null!=$t){if((0,Wt.c)($t))return function ue($t,Ft){return(0,E.Xf)($t).pipe(p(Ft),(0,Be.Q)(Ft))}($t,Ft);if((0,Ot.z)($t))return function Le($t,Ft){return new Ge.y(Kt=>{let ui=0;return Ft.schedule(function(){ui===$t.length?Kt.complete():(Kt.next($t[ui++]),Kt.closed||this.schedule())})})}($t,Ft);if((0,on.t)($t))return function Ye($t,Ft){return(0,E.Xf)($t).pipe(p(Ft),(0,Be.Q)(Ft))}($t,Ft);if((0,un.D)($t))return It($t,Ft);if((0,Cn.T)($t))return function Qe($t,Ft){return new Ge.y(Kt=>{let ui;return(0,$e.f)(Kt,Ft,()=>{ui=$t[Ae.h](),(0,$e.f)(Kt,Ft,()=>{let gi,cr;try{({value:gi,done:cr}=ui.next())}catch(No){return void Kt.error(No)}cr?Kt.complete():Kt.next(gi)},0,!0)}),()=>(0,ke.m)(ui?.return)&&ui.return()})}($t,Ft);if((0,gn.L)($t))return function it($t,Ft){return It((0,gn.Q)($t),Ft)}($t,Ft)}throw(0,Sn.z)($t)}($t,Ft):(0,E.Xf)($t)}},4829:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{Xf:()=>It});var E=ne(7582),Be=ne(4266),rt=ne(4026),p=ne(5592),ue=ne(8382),Ye=ne(5726),Ge=ne(9853),Le=ne(3664),Ae=ne(541),ke=ne(4674),$e=ne(3894),Qe=ne(4850);function It(it){if(it instanceof p.y)return it;if(null!=it){if((0,ue.c)(it))return function Wt(it){return new p.y(Ne=>{const Nt=it[Qe.L]();if((0,ke.m)(Nt.subscribe))return Nt.subscribe(Ne);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(it);if((0,Be.z)(it))return function on(it){return new p.y(Ne=>{for(let Nt=0;Nt<it.length&&!Ne.closed;Nt++)Ne.next(it[Nt]);Ne.complete()})}(it);if((0,rt.t)(it))return function Ot(it){return new p.y(Ne=>{it.then(Nt=>{Ne.closed||(Ne.next(Nt),Ne.complete())},Nt=>Ne.error(Nt)).then(null,$e.h)})}(it);if((0,Ye.D)(it))return un(it);if((0,Le.T)(it))return function Cn(it){return new p.y(Ne=>{for(const Nt of it)if(Ne.next(Nt),Ne.closed)return;Ne.complete()})}(it);if((0,Ae.L)(it))return function Sn(it){return un((0,Ae.Q)(it))}(it)}throw(0,Ge.z)(it)}function un(it){return new p.y(Ne=>{(function gn(it,Ne){var Nt,$t,Ft,Kt;return(0,E.mG)(this,void 0,void 0,function*(){try{for(Nt=(0,E.KL)(it);!($t=yield Nt.next()).done;)if(Ne.next($t.value),Ne.closed)return}catch(ui){Ft={error:ui}}finally{try{$t&&!$t.done&&(Kt=Nt.return)&&(yield Kt.call(Nt))}finally{if(Ft)throw Ft.error}}Ne.complete()})})(it,Ne).catch(Nt=>Ne.error(Nt))})}},3019:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{T:()=>Ye});var E=ne(7537),Be=ne(4829),rt=ne(6232),p=ne(9940),ue=ne(9666);function Ye(...Ge){const Le=(0,p.yG)(Ge),Ae=(0,p._6)(Ge,1/0),ke=Ge;return ke.length?1===ke.length?(0,Be.Xf)(ke[0]):(0,E.J)(Ae)((0,ue.D)(ke,Le)):rt.E}},2096:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{of:()=>rt});var E=ne(9940),Be=ne(9666);function rt(...p){const ue=(0,E.yG)(p);return(0,Be.D)(p,ue)}},8251:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{Q:()=>rt,x:()=>Be});var E=ne(305);function Be(p,ue,Ye,Ge,Le){return new rt(p,ue,Ye,Ge,Le)}class rt extends E.Lv{constructor(ue,Ye,Ge,Le,Ae,ke){super(ue),this.onFinalize=Ae,this.shouldUnsubscribe=ke,this._next=Ye?function($e){try{Ye($e)}catch(Qe){ue.error(Qe)}}:super._next,this._error=Le?function($e){try{Le($e)}catch(Qe){ue.error(Qe)}finally{this.unsubscribe()}}:super._error,this._complete=Ge?function(){try{Ge()}catch($e){ue.error($e)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var ue;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Ye}=this;super.unsubscribe(),!Ye&&(null===(ue=this.onFinalize)||void 0===ue||ue.call(this))}}}},6306:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{K:()=>p});var E=ne(4829),Be=ne(8251),rt=ne(9360);function p(ue){return(0,rt.e)((Ye,Ge)=>{let ke,Le=null,Ae=!1;Le=Ye.subscribe((0,Be.x)(Ge,void 0,void 0,$e=>{ke=(0,E.Xf)(ue($e,p(ue)(Ye))),Le?(Le.unsubscribe(),Le=null,ke.subscribe(Ge)):Ae=!0})),Ae&&(Le.unsubscribe(),Le=null,ke.subscribe(Ge))})}},6328:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{b:()=>rt});var E=ne(1631),Be=ne(4674);function rt(p,ue){return(0,Be.m)(ue)?(0,E.z)(p,ue,1):(0,E.z)(p,1)}},3620:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{b:()=>p});var E=ne(6321),Be=ne(9360),rt=ne(8251);function p(ue,Ye=E.z){return(0,Be.e)((Ge,Le)=>{let Ae=null,ke=null,$e=null;const Qe=()=>{if(Ae){Ae.unsubscribe(),Ae=null;const Wt=ke;ke=null,Le.next(Wt)}};function It(){const Wt=$e+ue,on=Ye.now();if(on<Wt)return Ae=this.schedule(void 0,Wt-on),void Le.add(Ae);Qe()}Ge.subscribe((0,rt.x)(Le,Wt=>{ke=Wt,$e=Ye.now(),Ae||(Ae=Ye.schedule(It,ue),Le.add(Ae))},()=>{Qe(),Le.complete()},void 0,()=>{ke=Ae=null}))})}},3997:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{x:()=>p});var E=ne(2737),Be=ne(9360),rt=ne(8251);function p(Ye,Ge=E.y){return Ye=Ye??ue,(0,Be.e)((Le,Ae)=>{let ke,$e=!0;Le.subscribe((0,rt.x)(Ae,Qe=>{const It=Ge(Qe);($e||!Ye(ke,It))&&($e=!1,ke=It,Ae.next(Qe))}))})}function ue(Ye,Ge){return Ye===Ge}},2181:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{h:()=>rt});var E=ne(9360),Be=ne(8251);function rt(p,ue){return(0,E.e)((Ye,Ge)=>{let Le=0;Ye.subscribe((0,Be.x)(Ge,Ae=>p.call(ue,Ae,Le++)&&Ge.next(Ae)))})}},7398:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{U:()=>rt});var E=ne(9360),Be=ne(8251);function rt(p,ue){return(0,E.e)((Ye,Ge)=>{let Le=0;Ye.subscribe((0,Be.x)(Ge,Ae=>{Ge.next(p.call(ue,Ae,Le++))}))})}},7537:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{J:()=>rt});var E=ne(1631),Be=ne(2737);function rt(p=1/0){return(0,E.z)(Be.y,p)}},1631:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{z:()=>Le});var E=ne(7398),Be=ne(4829),rt=ne(9360),p=ne(7103),ue=ne(8251),Ge=ne(4674);function Le(Ae,ke,$e=1/0){return(0,Ge.m)(ke)?Le((Qe,It)=>(0,E.U)((Wt,on)=>ke(Qe,Wt,It,on))((0,Be.Xf)(Ae(Qe,It))),$e):("number"==typeof ke&&($e=ke),(0,rt.e)((Qe,It)=>function Ye(Ae,ke,$e,Qe,It,Wt,on,Ot){const Cn=[];let un=0,Sn=0,gn=!1;const it=()=>{gn&&!Cn.length&&!un&&ke.complete()},Ne=$t=>un<Qe?Nt($t):Cn.push($t),Nt=$t=>{Wt&&ke.next($t),un++;let Ft=!1;(0,Be.Xf)($e($t,Sn++)).subscribe((0,ue.x)(ke,Kt=>{It?.(Kt),Wt?Ne(Kt):ke.next(Kt)},()=>{Ft=!0},void 0,()=>{if(Ft)try{for(un--;Cn.length&&un<Qe;){const Kt=Cn.shift();on?(0,p.f)(ke,on,()=>Nt(Kt)):Nt(Kt)}it()}catch(Kt){ke.error(Kt)}}))};return Ae.subscribe((0,ue.x)(ke,Ne,()=>{gn=!0,it()})),()=>{Ot?.()}}(Qe,It,Ae,$e)))}},3093:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{Q:()=>p});var E=ne(7103),Be=ne(9360),rt=ne(8251);function p(ue,Ye=0){return(0,Be.e)((Ge,Le)=>{Ge.subscribe((0,rt.x)(Le,Ae=>(0,E.f)(Le,ue,()=>Le.next(Ae),Ye),()=>(0,E.f)(Le,ue,()=>Le.complete(),Ye),Ae=>(0,E.f)(Le,ue,()=>Le.error(Ae),Ye)))})}},6699:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{R:()=>p});var E=ne(9360),Be=ne(8251);function p(ue,Ye){return(0,E.e)(function rt(ue,Ye,Ge,Le,Ae){return(ke,$e)=>{let Qe=Ge,It=Ye,Wt=0;ke.subscribe((0,Be.x)($e,on=>{const Ot=Wt++;It=Qe?ue(It,on,Ot):(Qe=!0,on),Le&&$e.next(It)},Ae&&(()=>{Qe&&$e.next(It),$e.complete()})))}}(ue,Ye,arguments.length>=2,!0))}},3020:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{B:()=>ue});var E=ne(4829),Be=ne(8645),rt=ne(305),p=ne(9360);function ue(Ge={}){const{connector:Le=(()=>new Be.x),resetOnError:Ae=!0,resetOnComplete:ke=!0,resetOnRefCountZero:$e=!0}=Ge;return Qe=>{let It,Wt,on,Ot=0,Cn=!1,un=!1;const Sn=()=>{Wt?.unsubscribe(),Wt=void 0},gn=()=>{Sn(),It=on=void 0,Cn=un=!1},it=()=>{const Ne=It;gn(),Ne?.unsubscribe()};return(0,p.e)((Ne,Nt)=>{Ot++,!un&&!Cn&&Sn();const $t=on=on??Le();Nt.add(()=>{Ot--,0===Ot&&!un&&!Cn&&(Wt=Ye(it,$e))}),$t.subscribe(Nt),!It&&Ot>0&&(It=new rt.Hp({next:Ft=>$t.next(Ft),error:Ft=>{un=!0,Sn(),Wt=Ye(gn,Ae,Ft),$t.error(Ft)},complete:()=>{Cn=!0,Sn(),Wt=Ye(gn,ke),$t.complete()}}),(0,E.Xf)(Ne).subscribe(It))})(Qe)}}function Ye(Ge,Le,...Ae){if(!0===Le)return void Ge();if(!1===Le)return;const ke=new rt.Hp({next:()=>{ke.unsubscribe(),Ge()}});return(0,E.Xf)(Le(...Ae)).subscribe(ke)}},836:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{T:()=>Be});var E=ne(2181);function Be(rt){return(0,E.h)((p,ue)=>rt<=ue)}},4664:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{w:()=>p});var E=ne(4829),Be=ne(9360),rt=ne(8251);function p(ue,Ye){return(0,Be.e)((Ge,Le)=>{let Ae=null,ke=0,$e=!1;const Qe=()=>$e&&!Ae&&Le.complete();Ge.subscribe((0,rt.x)(Le,It=>{Ae?.unsubscribe();let Wt=0;const on=ke++;(0,E.Xf)(ue(It,on)).subscribe(Ae=(0,rt.x)(Le,Ot=>Le.next(Ye?Ye(It,Ot,on,Wt++):Ot),()=>{Ae=null,Qe()}))},()=>{$e=!0,Qe()}))})}},8180:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{q:()=>p});var E=ne(6232),Be=ne(9360),rt=ne(8251);function p(ue){return ue<=0?()=>E.E:(0,Be.e)((Ye,Ge)=>{let Le=0;Ye.subscribe((0,rt.x)(Ge,Ae=>{++Le<=ue&&(Ge.next(Ae),ue<=Le&&Ge.complete())}))})}},9773:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{R:()=>ue});var E=ne(9360),Be=ne(8251),rt=ne(4829),p=ne(2420);function ue(Ye){return(0,E.e)((Ge,Le)=>{(0,rt.Xf)(Ye).subscribe((0,Be.x)(Le,()=>Le.complete(),p.Z)),!Le.closed&&Ge.subscribe(Le)})}},5178:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{V:()=>Ae});var E=ne(6321),Be=ne(93),rt=ne(9360),p=ne(4829),ue=ne(2306),Ye=ne(8251),Ge=ne(7103);const Le=(0,ue.d)($e=>function(It=null){$e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=It});function Ae($e,Qe){const{first:It,each:Wt,with:on=ke,scheduler:Ot=Qe??E.z,meta:Cn=null}=(0,Be.q)($e)?{first:$e}:"number"==typeof $e?{each:$e}:$e;if(null==It&&null==Wt)throw new TypeError("No timeout provided.");return(0,rt.e)((un,Sn)=>{let gn,it,Ne=null,Nt=0;const $t=Ft=>{it=(0,Ge.f)(Sn,Ot,()=>{try{gn.unsubscribe(),(0,p.Xf)(on({meta:Cn,lastValue:Ne,seen:Nt})).subscribe(Sn)}catch(Kt){Sn.error(Kt)}},Ft)};gn=un.subscribe((0,Ye.x)(Sn,Ft=>{it?.unsubscribe(),Nt++,Sn.next(Ne=Ft),Wt>0&&$t(Wt)},void 0,void 0,()=>{it?.closed||it?.unsubscribe(),Ne=null})),!Nt&&$t(null!=It?"number"==typeof It?It:+It-Ot.now():Wt)})}function ke($e){throw new Le($e)}},2460:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{M:()=>Ge});var E=ne(9360),Be=ne(8251),rt=ne(4829),p=ne(2737),ue=ne(2420),Ye=ne(9940);function Ge(...Le){const Ae=(0,Ye.jO)(Le);return(0,E.e)((ke,$e)=>{const Qe=Le.length,It=new Array(Qe);let Wt=Le.map(()=>!1),on=!1;for(let Ot=0;Ot<Qe;Ot++)(0,rt.Xf)(Le[Ot]).subscribe((0,Be.x)($e,Cn=>{It[Ot]=Cn,!on&&!Wt[Ot]&&(Wt[Ot]=!0,(on=Wt.every(p.y))&&(Wt=null))},ue.Z));ke.subscribe((0,Be.x)($e,Ot=>{if(on){const Cn=[Ot,...It];$e.next(Ae?Ae(...Cn):Cn)}}))})}},1954:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{o:()=>ue});var E=ne(7394);class Be extends E.w0{constructor(Ge,Le){super()}schedule(Ge,Le=0){return this}}const rt={setInterval(Ye,Ge,...Le){const{delegate:Ae}=rt;return Ae?.setInterval?Ae.setInterval(Ye,Ge,...Le):setInterval(Ye,Ge,...Le)},clearInterval(Ye){const{delegate:Ge}=rt;return(Ge?.clearInterval||clearInterval)(Ye)},delegate:void 0};var p=ne(9039);class ue extends Be{constructor(Ge,Le){super(Ge,Le),this.scheduler=Ge,this.work=Le,this.pending=!1}schedule(Ge,Le=0){var Ae;if(this.closed)return this;this.state=Ge;const ke=this.id,$e=this.scheduler;return null!=ke&&(this.id=this.recycleAsyncId($e,ke,Le)),this.pending=!0,this.delay=Le,this.id=null!==(Ae=this.id)&&void 0!==Ae?Ae:this.requestAsyncId($e,this.id,Le),this}requestAsyncId(Ge,Le,Ae=0){return rt.setInterval(Ge.flush.bind(Ge,this),Ae)}recycleAsyncId(Ge,Le,Ae=0){if(null!=Ae&&this.delay===Ae&&!1===this.pending)return Le;null!=Le&&rt.clearInterval(Le)}execute(Ge,Le){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const Ae=this._execute(Ge,Le);if(Ae)return Ae;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(Ge,Le){let ke,Ae=!1;try{this.work(Ge)}catch($e){Ae=!0,ke=$e||new Error("Scheduled action threw falsy error")}if(Ae)return this.unsubscribe(),ke}unsubscribe(){if(!this.closed){const{id:Ge,scheduler:Le}=this,{actions:Ae}=Le;this.work=this.state=this.scheduler=null,this.pending=!1,(0,p.P)(Ae,this),null!=Ge&&(this.id=this.recycleAsyncId(Le,Ge,null)),this.delay=null,super.unsubscribe()}}}},2631:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{v:()=>rt});var E=ne(4552);class Be{constructor(ue,Ye=Be.now){this.schedulerActionCtor=ue,this.now=Ye}schedule(ue,Ye=0,Ge){return new this.schedulerActionCtor(this,ue).schedule(Ge,Ye)}}Be.now=E.l.now;class rt extends Be{constructor(ue,Ye=Be.now){super(ue,Ye),this.actions=[],this._active=!1}flush(ue){const{actions:Ye}=this;if(this._active)return void Ye.push(ue);let Ge;this._active=!0;do{if(Ge=ue.execute(ue.state,ue.delay))break}while(ue=Ye.shift());if(this._active=!1,Ge){for(;ue=Ye.shift();)ue.unsubscribe();throw Ge}}}},6321:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{P:()=>p,z:()=>rt});var E=ne(1954);const rt=new(ne(2631).v)(E.o),p=rt},4552:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{l:()=>E});const E={now:()=>(E.delegate||Date).now(),delegate:void 0}},2381:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{N:()=>ue});var E=ne(1954),rt=ne(2631);const ue=new class p extends rt.v{}(class Be extends E.o{constructor(Le,Ae){super(Le,Ae),this.scheduler=Le,this.work=Ae}schedule(Le,Ae=0){return Ae>0?super.schedule(Le,Ae):(this.delay=Ae,this.state=Le,this.scheduler.flush(this),this)}execute(Le,Ae){return Ae>0||this.closed?super.execute(Le,Ae):this._execute(Le,Ae)}requestAsyncId(Le,Ae,ke=0){return null!=ke&&ke>0||null==ke&&this.delay>0?super.requestAsyncId(Le,Ae,ke):(Le.flush(this),0)}})},7599:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{z:()=>E});const E={setTimeout(Be,rt,...p){const{delegate:ue}=E;return ue?.setTimeout?ue.setTimeout(Be,rt,...p):setTimeout(Be,rt,...p)},clearTimeout(Be){const{delegate:rt}=E;return(rt?.clearTimeout||clearTimeout)(Be)},delegate:void 0}},4971:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{h:()=>Be});const Be=function E(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},4850:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{L:()=>E});const E="function"==typeof Symbol&&Symbol.observable||"@@observable"},9940:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{_6:()=>Ye,jO:()=>p,yG:()=>ue});var E=ne(4674),Be=ne(671);function rt(Ge){return Ge[Ge.length-1]}function p(Ge){return(0,E.m)(rt(Ge))?Ge.pop():void 0}function ue(Ge){return(0,Be.K)(rt(Ge))?Ge.pop():void 0}function Ye(Ge,Le){return"number"==typeof rt(Ge)?Ge.pop():Le}},9039:(Ue,Ie,ne)=>{"use strict";function E(Be,rt){if(Be){const p=Be.indexOf(rt);0<=p&&Be.splice(p,1)}}ne.d(Ie,{P:()=>E})},2306:(Ue,Ie,ne)=>{"use strict";function E(Be){const p=Be(ue=>{Error.call(ue),ue.stack=(new Error).stack});return p.prototype=Object.create(Error.prototype),p.prototype.constructor=p,p}ne.d(Ie,{d:()=>E})},1441:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{O:()=>p,x:()=>rt});var E=ne(2653);let Be=null;function rt(ue){if(E.config.useDeprecatedSynchronousErrorHandling){const Ye=!Be;if(Ye&&(Be={errorThrown:!1,error:null}),ue(),Ye){const{errorThrown:Ge,error:Le}=Be;if(Be=null,Ge)throw Le}}else ue()}function p(ue){E.config.useDeprecatedSynchronousErrorHandling&&Be&&(Be.errorThrown=!0,Be.error=ue)}},7103:(Ue,Ie,ne)=>{"use strict";function E(Be,rt,p,ue=0,Ye=!1){const Ge=rt.schedule(function(){p(),Ye?Be.add(this.schedule(null,ue)):this.unsubscribe()},ue);if(Be.add(Ge),!Ye)return Ge}ne.d(Ie,{f:()=>E})},2737:(Ue,Ie,ne)=>{"use strict";function E(Be){return Be}ne.d(Ie,{y:()=>E})},4266:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{z:()=>E});const E=Be=>Be&&"number"==typeof Be.length&&"function"!=typeof Be},5726:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{D:()=>Be});var E=ne(4674);function Be(rt){return Symbol.asyncIterator&&(0,E.m)(rt?.[Symbol.asyncIterator])}},93:(Ue,Ie,ne)=>{"use strict";function E(Be){return Be instanceof Date&&!isNaN(Be)}ne.d(Ie,{q:()=>E})},4674:(Ue,Ie,ne)=>{"use strict";function E(Be){return"function"==typeof Be}ne.d(Ie,{m:()=>E})},8382:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{c:()=>rt});var E=ne(4850),Be=ne(4674);function rt(p){return(0,Be.m)(p[E.L])}},3664:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{T:()=>rt});var E=ne(4971),Be=ne(4674);function rt(p){return(0,Be.m)(p?.[E.h])}},4026:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{t:()=>Be});var E=ne(4674);function Be(rt){return(0,E.m)(rt?.then)}},541:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{L:()=>p,Q:()=>rt});var E=ne(7582),Be=ne(4674);function rt(ue){return(0,E.FC)(this,arguments,function*(){const Ge=ue.getReader();try{for(;;){const{value:Le,done:Ae}=yield(0,E.qq)(Ge.read());if(Ae)return yield(0,E.qq)(void 0);yield yield(0,E.qq)(Le)}}finally{Ge.releaseLock()}})}function p(ue){return(0,Be.m)(ue?.getReader)}},671:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{K:()=>Be});var E=ne(4674);function Be(rt){return rt&&(0,E.m)(rt.schedule)}},9360:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{A:()=>Be,e:()=>rt});var E=ne(4674);function Be(p){return(0,E.m)(p?.lift)}function rt(p){return ue=>{if(Be(ue))return ue.lift(function(Ye){try{return p(Ye,this)}catch(Ge){this.error(Ge)}});throw new TypeError("Unable to lift unknown Observable type")}}},2420:(Ue,Ie,ne)=>{"use strict";function E(){}ne.d(Ie,{Z:()=>E})},8407:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{U:()=>rt,z:()=>Be});var E=ne(2737);function Be(...p){return rt(p)}function rt(p){return 0===p.length?E.y:1===p.length?p[0]:function(Ye){return p.reduce((Ge,Le)=>Le(Ge),Ye)}}},3894:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{h:()=>rt});var E=ne(2653),Be=ne(7599);function rt(p){Be.z.setTimeout(()=>{const{onUnhandledError:ue}=E.config;if(!ue)throw p;ue(p)})}},9853:(Ue,Ie,ne)=>{"use strict";function E(Be){return new TypeError(`You provided ${null!==Be&&"object"==typeof Be?"an invalid object":`'${Be}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}ne.d(Ie,{z:()=>E})},5879:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{$8M:()=>Oo,$WT:()=>as,$Z:()=>eg,AFp:()=>mv,ALo:()=>lE,AaK:()=>Qe,CHM:()=>th,CRH:()=>jT,EJc:()=>tM,EpF:()=>Sw,F4k:()=>Aw,FYo:()=>Um,FiY:()=>If,Flj:()=>qp,GfV:()=>M_,Gpc:()=>on,HDt:()=>NE,JOm:()=>ru,Jf7:()=>qm,KtG:()=>nh,LFG:()=>Qn,LSH:()=>f_,Lbi:()=>b_,Lck:()=>q1,MMx:()=>X1,MR2:()=>Xf,NdJ:()=>Ab,O4$:()=>Ug,Ojb:()=>Ph,OlP:()=>zi,Oqu:()=>s0,P3R:()=>lv,PXZ:()=>Bp,Q6J:()=>qv,QGY:()=>Iw,QbO:()=>fb,Qsj:()=>Cv,R0b:()=>Xr,RDi:()=>iv,Rgc:()=>Eg,SBq:()=>Bh,Sil:()=>iM,Suo:()=>ir,TTD:()=>vf,TgZ:()=>Xv,VuI:()=>YM,X6Q:()=>qE,XFs:()=>$n,Xpm:()=>ye,Xq5:()=>Ke,Xts:()=>Sh,Y36:()=>Tc,YKP:()=>ax,YNc:()=>bw,Yjl:()=>Yi,Yz7:()=>On,Z0I:()=>Pi,ZZ4:()=>Zx,_Bn:()=>W1,_UZ:()=>Sb,_Vd:()=>wd,_c5:()=>zM,_uU:()=>Nb,aQg:()=>Ty,c2e:()=>FE,cJS:()=>ji,cg1:()=>Gb,dDg:()=>EM,dqk:()=>$i,eFA:()=>Nx,eJc:()=>bx,ekj:()=>Fb,eoX:()=>jE,f3M:()=>li,g9A:()=>gv,gHi:()=>xc,h0i:()=>tf,hGG:()=>VM,hij:()=>iy,iGM:()=>ql,ifc:()=>Vs,ip1:()=>kE,jDz:()=>J1,kL8:()=>y1,kcU:()=>Cf,ktI:()=>ga,lG2:()=>dr,lcZ:()=>uE,lqb:()=>cl,lri:()=>UE,n5z:()=>Ni,oAB:()=>zt,oxw:()=>Jv,qFp:()=>Jx,qLn:()=>Vl,qOj:()=>P,qZA:()=>Kv,rWj:()=>wM,rg0:()=>zy,s9C:()=>Qv,sBO:()=>Up,s_b:()=>fy,soG:()=>_y,tBr:()=>Zg,tb:()=>ba,tdS:()=>By,tp0:()=>Af,uIk:()=>jt,vHH:()=>it,vpe:()=>hl,wAp:()=>Su,xp6:()=>Jm,z2F:()=>Bd,zSh:()=>Pm,zs3:()=>dl});var E=ne(8645),Be=ne(7394),rt=ne(5592),p=ne(3019),ue=ne(5619),Ye=ne(2096),Ge=ne(3020),Le=ne(4664),Ae=ne(3997);function ke(r){for(let c in r)if(r[c]===ke)return c;throw Error("Could not find renamed property on target object.")}function $e(r,c){for(const h in c)c.hasOwnProperty(h)&&!r.hasOwnProperty(h)&&(r[h]=c[h])}function Qe(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(Qe).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const c=r.toString();if(null==c)return""+c;const h=c.indexOf("\n");return-1===h?c:c.substring(0,h)}function It(r,c){return null==r||""===r?null===c?"":c:null==c||""===c?r:r+" "+c}const Wt=ke({__forward_ref__:ke});function on(r){return r.__forward_ref__=on,r.toString=function(){return Qe(this())},r}function Ot(r){return Cn(r)?r():r}function Cn(r){return"function"==typeof r&&r.hasOwnProperty(Wt)&&r.__forward_ref__===on}function un(r){return r&&!!r.\u0275providers}const gn="https://g.co/ng/security#xss";class it extends Error{constructor(c,h){super(function Ne(r,c){return`NG0${Math.abs(r)}${c?": "+c:""}`}(c,h)),this.code=c}}function Nt(r){return"string"==typeof r?r:null==r?"":String(r)}function gi(r,c){throw new it(-201,!1)}function yt(r,c){null==r&&function vt(r,c,h,g){throw new Error(`ASSERTION ERROR: ${r}`+(null==g?"":` [Expected=> ${h} ${g} ${c} <=Actual]`))}(c,r,null,"!=")}function On(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function ji(r){return{providers:r.providers||[],imports:r.imports||[]}}function so(r){return ur(r,xa)||ur(r,Bo)}function Pi(r){return null!==so(r)}function ur(r,c){return r.hasOwnProperty(c)?r[c]:null}function Bs(r){return r&&(r.hasOwnProperty(wo)||r.hasOwnProperty(Kl))?r[wo]:null}const xa=ke({\u0275prov:ke}),wo=ke({\u0275inj:ke}),Bo=ke({ngInjectableDef:ke}),Kl=ke({ngInjectorDef:ke});var $n=function(r){return r[r.Default=0]="Default",r[r.Host=1]="Host",r[r.Self=2]="Self",r[r.SkipSelf=4]="SkipSelf",r[r.Optional=8]="Optional",r}($n||{});let ii;function si(){return ii}function Hr(r){const c=ii;return ii=r,c}function zo(r,c,h){const g=so(r);return g&&"root"==g.providedIn?void 0===g.value?g.value=g.factory():g.value:h&$n.Optional?null:void 0!==c?c:void gi(Qe(r))}const $i=globalThis,je={},Pe="__NG_DI_FLAG__",tt="ngTempTokenPath",Yt=/\n/gm,qn="__source";let Vn;function Hn(r){const c=Vn;return Vn=r,c}function ei(r,c=$n.Default){if(void 0===Vn)throw new it(-203,!1);return null===Vn?zo(r,void 0,c):Vn.get(r,c&$n.Optional?null:void 0,c)}function Qn(r,c=$n.Default){return(si()||ei)(Ot(r),c)}function li(r,c=$n.Default){return Qn(r,tr(c))}function tr(r){return typeof r>"u"||"number"==typeof r?r:0|(r.optional&&8)|(r.host&&1)|(r.self&&2)|(r.skipSelf&&4)}function Vo(r){const c=[];for(let h=0;h<r.length;h++){const g=Ot(r[h]);if(Array.isArray(g)){if(0===g.length)throw new it(900,!1);let x,M=$n.Default;for(let O=0;O<g.length;O++){const L=g[O],V=lo(L);"number"==typeof V?-1===V?x=L.token:M|=V:x=L}c.push(Qn(x,M))}else c.push(Qn(g))}return c}function Er(r,c){return r[Pe]=c,r.prototype[Pe]=c,r}function lo(r){return r[Pe]}function zs(r){return{toString:r}.toString()}var pi=function(r){return r[r.OnPush=0]="OnPush",r[r.Default=1]="Default",r}(pi||{}),Vs=function(r){return r[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",r}(Vs||{});const co={},Ci=[],sa=ke({\u0275cmp:ke}),Co=ke({\u0275dir:ke}),To=ke({\u0275pipe:ke}),Rc=ke({\u0275mod:ke}),rs=ke({\u0275fac:ke}),Uo=ke({__NG_ELEMENT_ID__:ke}),os=ke({__NG_ENV_ID__:ke});function Za(r,c,h){let g=r.length;for(;;){const x=r.indexOf(c,h);if(-1===x)return x;if(0===x||r.charCodeAt(x-1)<=32){const M=c.length;if(x+M===g||r.charCodeAt(x+M)<=32)return x}h=x+1}}function ct(r,c,h){let g=0;for(;g<h.length;){const x=h[g];if("number"==typeof x){if(0!==x)break;g++;const M=h[g++],O=h[g++],L=h[g++];r.setAttribute(c,O,L,M)}else{const M=x,O=h[++g];rr(M)?r.setProperty(c,M,O):r.setAttribute(c,M,O),g++}}return g}function Us(r){return 3===r||4===r||6===r}function rr(r){return 64===r.charCodeAt(0)}function Cr(r,c){if(null!==c&&0!==c.length)if(null===r||0===r.length)r=c.slice();else{let h=-1;for(let g=0;g<c.length;g++){const x=c[g];"number"==typeof x?h=x:0===h||Jl(r,h,x,null,-1===h||2===h?c[++g]:null)}}return r}function Jl(r,c,h,g,x){let M=0,O=r.length;if(-1===c)O=-1;else for(;M<r.length;){const L=r[M++];if("number"==typeof L){if(L===c){O=-1;break}if(L>c){O=M-1;break}}}for(;M<r.length;){const L=r[M];if("number"==typeof L)break;if(L===h){if(null===g)return void(null!==x&&(r[M+1]=x));if(g===r[M+1])return void(r[M+2]=x)}M++,null!==g&&M++,null!==x&&M++}-1!==O&&(r.splice(O,0,c),M=O+1),r.splice(M++,0,h),null!==g&&r.splice(M++,0,g),null!==x&&r.splice(M++,0,x)}const jo="ng-template";function Vd(r,c,h){let g=0,x=!0;for(;g<r.length;){let M=r[g++];if("string"==typeof M&&x){const O=r[g++];if(h&&"class"===M&&-1!==Za(O.toLowerCase(),c,0))return!0}else{if(1===M){for(;g<r.length&&"string"==typeof(M=r[g++]);)if(M.toLowerCase()===c)return!0;return!1}"number"==typeof M&&(x=!1)}}return!1}function wa(r){return 4===r.type&&r.value!==jo}function Ql(r,c,h){return c===(4!==r.type||h?r.value:jo)}function en(r,c,h){let g=4;const x=r.attrs||[],M=function ci(r){for(let c=0;c<r.length;c++)if(Us(r[c]))return c;return r.length}(x);let O=!1;for(let L=0;L<c.length;L++){const V=c[L];if("number"!=typeof V){if(!O)if(4&g){if(g=2|1&g,""!==V&&!Ql(r,V,h)||""===V&&1===c.length){if(Ln(g))return!1;O=!0}}else{const Y=8&g?V:c[++L];if(8&g&&null!==r.attrs){if(!Vd(r.attrs,Y,h)){if(Ln(g))return!1;O=!0}continue}const me=ti(8&g?"class":V,x,wa(r),h);if(-1===me){if(Ln(g))return!1;O=!0;continue}if(""!==Y){let Fe;Fe=me>M?"":x[me+1].toLowerCase();const qe=8&g?Fe:null;if(qe&&-1!==Za(qe,Y,0)||2&g&&Y!==Fe){if(Ln(g))return!1;O=!0}}}}else{if(!O&&!Ln(g)&&!Ln(V))return!1;if(O&&Ln(V))continue;O=!1,g=V|1&g}}return Ln(g)||O}function Ln(r){return 0==(1&r)}function ti(r,c,h,g){if(null===c)return-1;let x=0;if(g||!h){let M=!1;for(;x<c.length;){const O=c[x];if(O===r)return x;if(3===O||6===O)M=!0;else{if(1===O||2===O){let L=c[++x];for(;"string"==typeof L;)L=c[++x];continue}if(4===O)break;if(0===O){x+=4;continue}}x+=M?1:2}return-1}return function mo(r,c){let h=r.indexOf(4);if(h>-1)for(h++;h<r.length;){const g=r[h];if("number"==typeof g)return-1;if(g===c)return h;h++}return-1}(c,r)}function $o(r,c,h=!1){for(let g=0;g<c.length;g++)if(en(r,c[g],h))return!0;return!1}function Ea(r,c){return r?":not("+c.trim()+")":c}function xs(r){let c=r[0],h=1,g=2,x="",M=!1;for(;h<r.length;){let O=r[h];if("string"==typeof O)if(2&g){const L=r[++h];x+="["+O+(L.length>0?'="'+L+'"':"")+"]"}else 8&g?x+="."+O:4&g&&(x+=" "+O);else""!==x&&!Ln(O)&&(c+=Ea(M,x),x=""),g=O,M=M||!Ln(g);h++}return""!==x&&(c+=Ea(M,x)),c}function ye(r){return zs(()=>{const c=Mo(r),h={...c,decls:r.decls,vars:r.vars,template:r.template,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,onPush:r.changeDetection===pi.OnPush,directiveDefs:null,pipeDefs:null,dependencies:c.standalone&&r.dependencies||null,getStandaloneInjector:null,signals:r.signals??!1,data:r.data||{},encapsulation:r.encapsulation||Vs.Emulated,styles:r.styles||Ci,_:null,schemas:r.schemas||null,tView:null,id:""};df(h);const g=r.dependencies;return h.directiveDefs=xl(g,!1),h.pipeDefs=xl(g,!0),h.id=function Lu(r){let c=0;const h=[r.selectors,r.ngContentSelectors,r.hostVars,r.hostAttrs,r.consts,r.vars,r.decls,r.encapsulation,r.standalone,r.signals,r.exportAs,JSON.stringify(r.inputs),JSON.stringify(r.outputs),Object.getOwnPropertyNames(r.type.prototype),!!r.contentQueries,!!r.viewQuery].join("|");for(const x of h)c=Math.imul(31,c)+x.charCodeAt(0)<<0;return c+=2147483648,"c"+c}(h),h})}function Dt(r){return Tn(r)||wn(r)}function We(r){return null!==r}function zt(r){return zs(()=>({type:r.type,bootstrap:r.bootstrap||Ci,declarations:r.declarations||Ci,imports:r.imports||Ci,exports:r.exports||Ci,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function Zn(r,c){if(null==r)return co;const h={};for(const g in r)if(r.hasOwnProperty(g)){let x=r[g],M=x;Array.isArray(x)&&(M=x[1],x=x[0]),h[x]=g,c&&(c[x]=M)}return h}function dr(r){return zs(()=>{const c=Mo(r);return df(c),c})}function Yi(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,standalone:!0===r.standalone,onDestroy:r.type.prototype.ngOnDestroy||null}}function Tn(r){return r[sa]||null}function wn(r){return r[Co]||null}function Gi(r){return r[To]||null}function as(r){const c=Tn(r)||wn(r)||Gi(r);return null!==c&&c.standalone}function Xi(r,c){const h=r[Rc]||null;if(!h&&!0===c)throw new Error(`Type ${Qe(r)} does not have '\u0275mod' property.`);return h}function Mo(r){const c={};return{type:r.type,providersResolver:null,factory:null,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:c,inputTransforms:null,inputConfig:r.inputs||co,exportAs:r.exportAs||null,standalone:!0===r.standalone,signals:!0===r.signals,selectors:r.selectors||Ci,viewQuery:r.viewQuery||null,features:r.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Zn(r.inputs,c),outputs:Zn(r.outputs)}}function df(r){r.features?.forEach(c=>c(r))}function xl(r,c){if(!r)return null;const h=c?Gi:Dt;return()=>("function"==typeof r?r():r).map(g=>h(g)).filter(We)}const vr=0,cn=1,In=2,hr=3,Ho=4,Go=5,Ar=6,wl=7,br=8,aa=9,la=10,Un=11,ec=12,El=13,Zo=14,Tr=15,js=16,Cl=17,Wo=18,Wa=19,hf=20,Ca=21,$s=22,Nu=23,ca=24,vn=25,Bu=1,ff=2,qo=7,tc=9,Gr=11;function Nr(r){return Array.isArray(r)&&"object"==typeof r[Bu]}function Br(r){return Array.isArray(r)&&!0===r[Bu]}function kc(r){return 0!=(4&r.flags)}function Tl(r){return r.componentOffset>-1}function nc(r){return 1==(1&r.flags)}function Hs(r){return!!r.template}function Vu(r){return 0!=(512&r[In])}function qa(r,c){return r.hasOwnProperty(rs)?r[rs]:null}const Lc=Symbol("SIGNAL");function Do(r,c,h={}){return c[Lc]=r,Object.assign(c,h)}function Gd(r,c){return(null===r||"object"!=typeof r)&&Object.is(r,c)}let $u=$i.WeakRef??class Wp{constructor(c){this.ref=c}deref(){return this.ref}},Ly=0,Gs=null,Ml=!1;function zr(r){const c=Gs;return Gs=r,c}class Zd{constructor(){this.id=Ly++,this.ref=function gf(r){return new $u(r)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[c,h]of this.producers){const g=h.producerNode.deref();if(null!=g&&h.atTrackingVersion===this.trackingVersion){if(g.producerPollStatus(h.seenValueVersion))return!0}else this.producers.delete(c),g?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const c=Ml;Ml=!0;try{for(const[h,g]of this.consumers){const x=g.consumerNode.deref();null!=x&&x.trackingVersion===g.atTrackingVersion?x.onConsumerDependencyMayHaveChanged():(this.consumers.delete(h),x?.producers.delete(this.id))}}finally{Ml=c}}producerAccessed(){if(Ml)throw new Error("");if(null===Gs)return;let c=Gs.producers.get(this.id);void 0===c?(c={consumerNode:Gs.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:Gs.trackingVersion},Gs.producers.set(this.id,c),this.consumers.set(Gs.id,c)):(c.seenValueVersion=this.valueVersion,c.atTrackingVersion=Gs.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==Gs?.consumerAllowSignalWrites}producerPollStatus(c){return this.valueVersion!==c||(this.onProducerUpdateValueVersion(),this.valueVersion!==c)}}function qp(r,c){const h=new Yd(r,c?.equal??Gd);return Do(h,h.signal.bind(h))}const Yp=Symbol("UNSET"),Wd=Symbol("COMPUTING"),qd=Symbol("ERRORED");class Yd extends Zd{constructor(c,h){super(),this.computation=c,this.equal=h,this.value=Yp,this.error=null,this.stale=!0,this.consumerAllowSignalWrites=!1}onConsumerDependencyMayHaveChanged(){this.stale||(this.stale=!0,this.producerMayHaveChanged())}onProducerUpdateValueVersion(){if(this.stale){if(this.value!==Yp&&this.value!==Wd&&!this.consumerPollProducersForChange())return void(this.stale=!1);this.recomputeValue()}}recomputeValue(){if(this.value===Wd)throw new Error("Detected cycle in computations.");const c=this.value;this.value=Wd,this.trackingVersion++;const h=zr(this);let g;try{g=this.computation()}catch(x){g=qd,this.error=x}finally{zr(h)}this.stale=!1,c!==Yp&&c!==qd&&g!==qd&&this.equal(c,g)?this.value=c:(this.value=g,this.valueVersion++)}signal(){if(this.onProducerUpdateValueVersion(),this.producerAccessed(),this.value===qd)throw this.error;return this.value}}let Hu=function Ng(){throw new Error};function _f(){Hu()}class Ny extends Zd{constructor(c,h){super(),this.value=c,this.equal=h,this.consumerAllowSignalWrites=!1}onConsumerDependencyMayHaveChanged(){}onProducerUpdateValueVersion(){}set(c){this.producerUpdatesAllowed||_f(),this.equal(this.value,c)||(this.value=c,this.valueVersion++,this.producerMayHaveChanged())}update(c){this.producerUpdatesAllowed||_f(),this.set(c(this.value))}mutate(c){this.producerUpdatesAllowed||_f(),c(this.value),this.valueVersion++,this.producerMayHaveChanged()}asReadonly(){return void 0===this.readonlySignal&&(this.readonlySignal=Do(this,()=>this.signal())),this.readonlySignal}signal(){return this.producerAccessed(),this.value}}function By(r,c){const h=new Ny(r,c?.equal??Gd);return Do(h,h.signal.bind(h),{set:h.set.bind(h),update:h.update.bind(h),mutate:h.mutate.bind(h),asReadonly:h.asReadonly.bind(h)})}function zy(r){const c=zr(null);try{return r()}finally{zr(c)}}const Xp=()=>{};class yf extends Zd{constructor(c,h,g){super(),this.watch=c,this.schedule=h,this.dirty=!1,this.cleanupFn=Xp,this.registerOnCleanup=x=>{this.cleanupFn=x},this.consumerAllowSignalWrites=g}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const c=zr(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=Xp,this.watch(this.registerOnCleanup)}finally{zr(c)}}cleanup(){this.cleanupFn()}}class Gu{constructor(c,h,g){this.previousValue=c,this.currentValue=h,this.firstChange=g}isFirstChange(){return this.firstChange}}function vf(){return Kp}function Kp(r){return r.type.prototype.ngOnChanges&&(r.setInput=ic),Dl}function Dl(){const r=Bc(this),c=r?.current;if(c){const h=r.previous;if(h===co)r.previous=c;else for(let g in c)h[g]=c[g];r.current=null,this.ngOnChanges(c)}}function ic(r,c,h,g){const x=this.declaredInputs[h],M=Bc(r)||function Kd(r,c){return r[Zs]=c}(r,{previous:co,current:null}),O=M.current||(M.current={}),L=M.previous,V=L[x];O[x]=new Gu(V&&V.currentValue,c,L===co),r[g]=c}vf.ngInherit=!0;const Zs="__ngSimpleChanges__";function Bc(r){return r[Zs]||null}const So=function(r,c,h){},Zu="svg";function Zi(r){for(;Array.isArray(r);)r=r[vr];return r}function Sl(r,c){return Zi(c[r])}function Zr(r,c){return Zi(c[r.index])}function Uc(r,c){return r.data[c]}function Ao(r,c){const h=c[r];return Nr(h)?h:h[vr]}function Ma(r,c){return null==c?null:r[c]}function Hc(r){r[Cl]=0}function qu(r){1024&r[In]||(r[In]|=1024,Gc(r,1))}function Yu(r){1024&r[In]&&(r[In]&=-1025,Gc(r,-1))}function Gc(r,c){let h=r[hr];if(null===h)return;h[Go]+=c;let g=h;for(h=h[hr];null!==h&&(1===c&&1===g[Go]||-1===c&&0===g[Go]);)h[Go]+=c,g=h,h=h[hr]}function rn(r,c){if(256==(256&r[In]))throw new it(911,!1);null===r[Ca]&&(r[Ca]=[]),r[Ca].push(c)}const Kn={lFrame:oc(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Qd(){return Kn.bindingsEnabled}function Bt(){return Kn.lFrame.lView}function vi(){return Kn.lFrame.tView}function th(r){return Kn.lFrame.contextLView=r,r[br]}function nh(r){return Kn.lFrame.contextLView=null,r}function Qr(){let r=Wc();for(;null!==r&&64===r.type;)r=r.parent;return r}function Wc(){return Kn.lFrame.currentTNode}function ls(r,c){const h=Kn.lFrame;h.currentTNode=r,h.isParent=c}function qc(){return Kn.lFrame.isParent}function Il(){return Kn.lFrame.bindingIndex++}function fo(r,c){const h=Kn.lFrame;h.bindingIndex=h.bindingRootIndex=r,wf(c)}function wf(r){Kn.lFrame.currentDirectiveIndex=r}function Bg(){return Kn.lFrame.currentQueryIndex}function cs(r){Kn.lFrame.currentQueryIndex=r}function zg(r){const c=r[cn];return 2===c.type?c.declTNode:1===c.type?r[Ar]:null}function Vg(r,c,h){if(h&$n.SkipSelf){let x=c,M=r;for(;!(x=x.parent,null!==x||h&$n.Host||(x=zg(M),null===x||(M=M[Zo],10&x.type))););if(null===x)return!1;c=x,r=M}const g=Kn.lFrame=Ia();return g.currentTNode=c,g.lView=r,!0}function Ws(r){const c=Ia(),h=r[cn];Kn.lFrame=c,c.currentTNode=h.firstChild,c.lView=r,c.tView=h,c.contextLView=r,c.bindingIndex=h.bindingStartIndex,c.inI18n=!1}function Ia(){const r=Kn.lFrame,c=null===r?null:r.child;return null===c?oc(r):c}function oc(r){const c={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=c),c}function rh(){const r=Kn.lFrame;return Kn.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const hn=rh;function oh(){const r=rh();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function Wr(){return Kn.lFrame.selectedIndex}function Jt(r){Kn.lFrame.selectedIndex=r}function Mr(){const r=Kn.lFrame;return Uc(r.tView,r.selectedIndex)}function Ug(){Kn.lFrame.currentNamespace=Zu}function Cf(){!function $g(){Kn.lFrame.currentNamespace=null}()}let Cs=!0;function sh(){return Cs}function fr(r){Cs=r}function Po(r,c){for(let h=c.directiveStart,g=c.directiveEnd;h<g;h++){const M=r.data[h].type.prototype,{ngAfterContentInit:O,ngAfterContentChecked:L,ngAfterViewInit:V,ngAfterViewChecked:Y,ngOnDestroy:te}=M;O&&(r.contentHooks??=[]).push(-h,O),L&&((r.contentHooks??=[]).push(h,L),(r.contentCheckHooks??=[]).push(h,L)),V&&(r.viewHooks??=[]).push(-h,V),Y&&((r.viewHooks??=[]).push(h,Y),(r.viewCheckHooks??=[]).push(h,Y)),null!=te&&(r.destroyHooks??=[]).push(h,te)}}function Ka(r,c,h){f(r,c,3,h)}function _(r,c,h,g){(3&r[In])===h&&f(r,c,h,g)}function l(r,c){let h=r[In];(3&h)===c&&(h&=8191,h+=1,r[In]=h)}function f(r,c,h,g){const M=g??-1,O=c.length-1;let L=0;for(let V=void 0!==g?65535&r[Cl]:0;V<O;V++)if("number"==typeof c[V+1]){if(L=c[V],null!=g&&L>=g)break}else c[V]<0&&(r[Cl]+=65536),(L<M||-1==M)&&(C(r,h,c,V),r[Cl]=(4294901760&r[Cl])+V+2),V++}function v(r,c){So(4,r,c);const h=zr(null);try{c.call(r)}finally{zr(h),So(5,r,c)}}function C(r,c,h,g){const x=h[g]<0,M=h[g+1],L=r[x?-h[g]:h[g]];x?r[In]>>13<r[Cl]>>16&&(3&r[In])===c&&(r[In]+=8192,v(L,M)):v(L,M)}const S=-1;class R{constructor(c,h,g){this.factory=c,this.resolving=!1,this.canSeeViewProviders=h,this.injectImpl=g}}function ae(r){return r!==S}function ce(r){return 32767&r}function oe(r,c){let h=function K(r){return r>>16}(r),g=c;for(;h>0;)g=g[Zo],h--;return g}let pe=!0;function ge(r){const c=pe;return pe=r,c}const Me=255,Se=5;let ze=0;const Re={};function At(r,c){const h=mt(r,c);if(-1!==h)return h;const g=c[cn];g.firstCreatePass&&(r.injectorIndex=c.length,Ve(g.data,r),Ve(c,null),Ve(g.blueprint,null));const x=nt(r,c),M=r.injectorIndex;if(ae(x)){const O=ce(x),L=oe(x,c),V=L[cn].data;for(let Y=0;Y<8;Y++)c[M+Y]=L[O+Y]|V[O+Y]}return c[M+8]=x,M}function Ve(r,c){r.push(0,0,0,0,0,0,0,0,c)}function mt(r,c){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===c[r.injectorIndex+8]?-1:r.injectorIndex}function nt(r,c){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let h=0,g=null,x=c;for(;null!==x;){if(g=jn(x),null===g)return S;if(h++,x=x[Zo],-1!==g.injectorIndex)return g.injectorIndex|h<<16}return S}function bt(r,c,h){!function Xe(r,c,h){let g;"string"==typeof h?g=h.charCodeAt(0)||0:h.hasOwnProperty(Uo)&&(g=h[Uo]),null==g&&(g=h[Uo]=ze++);const x=g&Me;c.data[r+(x>>Se)]|=1<<x}(r,c,h)}function ut(r,c,h){if(h&$n.Optional||void 0!==r)return r;gi()}function Lt(r,c,h,g){if(h&$n.Optional&&void 0===g&&(g=null),!(h&($n.Self|$n.Host))){const x=r[aa],M=Hr(void 0);try{return x?x.get(c,g,h&$n.Optional):zo(c,g,h&$n.Optional)}finally{Hr(M)}}return ut(g,0,h)}function gt(r,c,h,g=$n.Default,x){if(null!==r){if(2048&c[In]&&!(g&$n.Self)){const O=function qr(r,c,h,g,x){let M=r,O=c;for(;null!==M&&null!==O&&2048&O[In]&&!(512&O[In]);){const L=wt(M,O,h,g|$n.Self,Re);if(L!==Re)return L;let V=M.parent;if(!V){const Y=O[hf];if(Y){const te=Y.get(h,Re,g);if(te!==Re)return te}V=jn(O),O=O[Zo]}M=V}return x}(r,c,h,g,Re);if(O!==Re)return O}const M=wt(r,c,h,g,Re);if(M!==Re)return M}return Lt(c,h,g,x)}function wt(r,c,h,g,x){const M=function xn(r){if("string"==typeof r)return r.charCodeAt(0)||0;const c=r.hasOwnProperty(Uo)?r[Uo]:void 0;return"number"==typeof c?c>=0?c&Me:Wi:c}(h);if("function"==typeof M){if(!Vg(c,r,g))return g&$n.Host?ut(x,0,g):Lt(c,h,g,x);try{let O;if(O=M(g),null!=O||g&$n.Optional)return O;gi()}finally{hn()}}else if("number"==typeof M){let O=null,L=mt(r,c),V=S,Y=g&$n.Host?c[Tr][Ar]:null;for((-1===L||g&$n.SkipSelf)&&(V=-1===L?nt(r,c):c[L+8],V!==S&&An(g,!1)?(O=c[cn],L=ce(V),c=oe(V,c)):L=-1);-1!==L;){const te=c[cn];if(Jn(M,L,te.data)){const me=bn(L,c,h,O,g,Y);if(me!==Re)return me}V=c[L+8],V!==S&&An(g,c[cn].data[L+8]===Y)&&Jn(M,L,c)?(O=te,L=ce(V),c=oe(V,c)):L=-1}}return x}function bn(r,c,h,g,x,M){const O=c[cn],L=O.data[r+8],te=Rn(L,O,h,null==g?Tl(L)&&pe:g!=O&&0!=(3&L.type),x&$n.Host&&M===L);return null!==te?an(c,O,te,L):Re}function Rn(r,c,h,g,x){const M=r.providerIndexes,O=c.data,L=1048575&M,V=r.directiveStart,te=M>>20,Fe=x?L+te:r.directiveEnd;for(let qe=g?L:L+te;qe<Fe;qe++){const St=O[qe];if(qe<V&&h===St||qe>=V&&St.type===h)return qe}if(x){const qe=O[V];if(qe&&Hs(qe)&&qe.type===h)return V}return null}function an(r,c,h,g){let x=r[h];const M=c.data;if(function F(r){return r instanceof R}(x)){const O=x;O.resolving&&function Ft(r,c){const h=c?`. Dependency path: ${c.join(" > ")} > ${r}`:"";throw new it(-200,`Circular dependency in DI detected for ${r}${h}`)}(function $t(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():Nt(r)}(M[h]));const L=ge(O.canSeeViewProviders);O.resolving=!0;const Y=O.injectImpl?Hr(O.injectImpl):null;Vg(r,g,$n.Default);try{x=r[h]=O.factory(void 0,M,r,g),c.firstCreatePass&&h>=g.directiveStart&&function Nn(r,c,h){const{ngOnChanges:g,ngOnInit:x,ngDoCheck:M}=c.type.prototype;if(g){const O=Kp(c);(h.preOrderHooks??=[]).push(r,O),(h.preOrderCheckHooks??=[]).push(r,O)}x&&(h.preOrderHooks??=[]).push(0-r,x),M&&((h.preOrderHooks??=[]).push(r,M),(h.preOrderCheckHooks??=[]).push(r,M))}(h,M[h],c)}finally{null!==Y&&Hr(Y),ge(L),O.resolving=!1,hn()}}return x}function Jn(r,c,h){return!!(h[c+(r>>Se)]&1<<r)}function An(r,c){return!(r&$n.Self||r&$n.Host&&c)}class ri{constructor(c,h){this._tNode=c,this._lView=h}get(c,h,g){return gt(this._tNode,this._lView,c,tr(g),h)}}function Wi(){return new ri(Qr(),Bt())}function Ni(r){return zs(()=>{const c=r.prototype.constructor,h=c[rs]||Pr(c),g=Object.prototype;let x=Object.getPrototypeOf(r.prototype).constructor;for(;x&&x!==g;){const M=x[rs]||Pr(x);if(M&&M!==h)return M;x=Object.getPrototypeOf(x)}return M=>new M})}function Pr(r){return Cn(r)?()=>{const c=Pr(Ot(r));return c&&c()}:qa(r)}function jn(r){const c=r[cn],h=c.type;return 2===h?c.declTNode:1===h?r[Ar]:null}function Oo(r){return function He(r,c){if("class"===c)return r.classes;if("style"===c)return r.styles;const h=r.attrs;if(h){const g=h.length;let x=0;for(;x<g;){const M=h[x];if(Us(M))break;if(0===M)x+=2;else if("number"==typeof M)for(x++;x<g&&"string"==typeof h[x];)x++;else{if(M===c)return h[x+1];x+=2}}}return null}(Qr(),r)}const _i="__parameters__";function Ri(r,c,h){return zs(()=>{const g=function pr(r){return function(...h){if(r){const g=r(...h);for(const x in g)this[x]=g[x]}}}(c);function x(...M){if(this instanceof x)return g.apply(this,M),this;const O=new x(...M);return L.annotation=O,L;function L(V,Y,te){const me=V.hasOwnProperty(_i)?V[_i]:Object.defineProperty(V,_i,{value:[]})[_i];for(;me.length<=te;)me.push(null);return(me[te]=me[te]||[]).push(O),V}}return h&&(x.prototype=Object.create(h.prototype)),x.prototype.ngMetadataName=r,x.annotationCls=x,x})}function Xc(r,c){r.forEach(h=>Array.isArray(h)?Xc(h,c):c(h))}function cc(r,c,h){c>=r.length?r.push(h):r.splice(c,0,h)}function qs(r,c){return c>=r.length-1?r.pop():r.splice(c,1)[0]}function ha(r,c,h){let g=fa(r,c);return g>=0?r[1|g]=h:(g=~g,function jy(r,c,h,g){let x=r.length;if(x==c)r.push(h,g);else if(1===x)r.push(g,r[0]),r[0]=h;else{for(x--,r.push(r[x-1],r[x]);x>c;)r[x]=r[x-2],x--;r[c]=h,r[c+1]=g}}(r,g,c,h)),g}function td(r,c){const h=fa(r,c);if(h>=0)return r[1|h]}function fa(r,c){return function el(r,c,h){let g=0,x=r.length>>h;for(;x!==g;){const M=g+(x-g>>1),O=r[M<<h];if(c===O)return M<<h;O>c?x=M:g=M+1}return~(x<<h)}(r,c,1)}const Zg=Er(Ri("Inject",r=>({token:r})),-1),If=Er(Ri("Optional"),8),Af=Er(Ri("SkipSelf"),4);function hm(r){return 128==(128&r.flags)}var ru=function(r){return r[r.Important=1]="Important",r[r.DashCase=2]="DashCase",r}(ru||{});const Pl=new Map;let mm=0;const Ds="__ngContext__";function Ro(r,c){Nr(c)?(r[Ds]=c[Wa],function Kg(r){Pl.set(r[Wa],r)}(c)):r[Ds]=c}let fc;function su(r,c){return fc(r,c)}function pc(r){const c=r[hr];return Br(c)?c[hr]:c}function Jg(r){return _h(r[ec])}function Ky(r){return _h(r[Ho])}function _h(r){for(;null!==r&&!Br(r);)r=r[Ho];return r}function sd(r,c,h,g,x){if(null!=g){let M,O=!1;Br(g)?M=g:Nr(g)&&(O=!0,g=g[vr]);const L=Zi(g);0===r&&null!==h?null==x?cd(c,h,L):pa(c,h,L,x||null,!0):1===r&&null!==h?pa(c,h,L,x||null,!0):2===r?function vh(r,c,h){const g=Lf(r,c);g&&function nb(r,c,h,g){r.removeChild(c,h,g)}(r,g,c,h)}(c,L,O):3===r&&c.destroyNode(L),null!=M&&function r_(r,c,h,g,x){const M=h[qo];M!==Zi(h)&&sd(c,r,g,M,x);for(let L=Gr;L<h.length;L++){const V=h[L];bh(V[cn],V,r,c,g,M)}}(c,r,M,h,x)}}function yh(r,c,h){return r.createElement(c,h)}function ka(r,c){const h=r[tc],g=h.indexOf(c);Yu(c),h.splice(g,1)}function Qo(r,c){if(r.length<=Gr)return;const h=Gr+c,g=r[h];if(g){const x=g[js];null!==x&&x!==r&&ka(x,g),c>0&&(r[h-1][Ho]=g[Ho]);const M=qs(r,Gr+c);!function Ss(r,c){bh(r,c,c[Un],2,null,null),c[vr]=null,c[Ar]=null}(g[cn],g);const O=M[Wo];null!==O&&O.detachView(M[cn]),g[hr]=null,g[Ho]=null,g[In]&=-129}return g}function Is(r,c){if(!(256&c[In])){const h=c[Un];c[Nu]?.destroy(),c[ca]?.destroy(),h.destroyNode&&bh(r,c,h,3,null,null),function Ki(r){let c=r[ec];if(!c)return po(r[cn],r);for(;c;){let h=null;if(Nr(c))h=c[ec];else{const g=c[Gr];g&&(h=g)}if(!h){for(;c&&!c[Ho]&&c!==r;)Nr(c)&&po(c[cn],c),c=c[hr];null===c&&(c=r),Nr(c)&&po(c[cn],c),h=c&&c[Ho]}c=h}}(c)}}function po(r,c){if(!(256&c[In])){c[In]&=-129,c[In]|=256,function Yr(r,c){let h;if(null!=r&&null!=(h=r.destroyHooks))for(let g=0;g<h.length;g+=2){const x=c[h[g]];if(!(x instanceof R)){const M=h[g+1];if(Array.isArray(M))for(let O=0;O<M.length;O+=2){const L=x[M[O]],V=M[O+1];So(4,L,V);try{V.call(L)}finally{So(5,L,V)}}else{So(4,x,M);try{M.call(x)}finally{So(5,x,M)}}}}}(r,c),function ad(r,c){const h=r.cleanup,g=c[wl];if(null!==h)for(let M=0;M<h.length-1;M+=2)if("string"==typeof h[M]){const O=h[M+3];O>=0?g[O]():g[-O].unsubscribe(),M+=2}else h[M].call(g[h[M+1]]);null!==g&&(c[wl]=null);const x=c[Ca];if(null!==x){c[Ca]=null;for(let M=0;M<x.length;M++)(0,x[M])()}}(r,c),1===c[cn].type&&c[Un].destroy();const h=c[js];if(null!==h&&Br(c[hr])){h!==c[hr]&&ka(h,c);const g=c[Wo];null!==g&&g.detachView(r)}!function ll(r){Pl.delete(r[Wa])}(c)}}function ym(r,c,h){return function ld(r,c,h){let g=c;for(;null!==g&&40&g.type;)g=(c=g).parent;if(null===g)return h[vr];{const{componentOffset:x}=g;if(x>-1){const{encapsulation:M}=r.data[g.directiveStart+x];if(M===Vs.None||M===Vs.Emulated)return null}return Zr(g,h)}}(r,c.parent,h)}function pa(r,c,h,g,x){r.insertBefore(c,h,g,x)}function cd(r,c,h){r.appendChild(c,h)}function vm(r,c,h,g,x){null!==g?pa(r,c,h,g,x):cd(r,c,h)}function Lf(r,c){return r.parentNode(c)}let dd,bm,Vf,Nf=function ud(r,c,h){return 40&r.type?Zr(r,h):null};function Fl(r,c,h,g){const x=ym(r,g,c),M=c[Un],L=function kl(r,c,h){return Nf(r,c,h)}(g.parent||c[Ar],g,c);if(null!=x)if(Array.isArray(h))for(let V=0;V<h.length;V++)vm(M,x,h[V],L,!1);else vm(M,x,h,L,!1);void 0!==dd&&dd(M,g,c,h,x)}function Bf(r,c){if(null!==c){const h=c.type;if(3&h)return Zr(c,r);if(4&h)return i_(-1,r[c.index]);if(8&h){const g=c.child;if(null!==g)return Bf(r,g);{const x=r[c.index];return Br(x)?i_(-1,x):Zi(x)}}if(32&h)return su(c,r)()||Zi(r[c.index]);{const g=n_(r,c);return null!==g?Array.isArray(g)?g[0]:Bf(pc(r[Tr]),g):Bf(r,c.next)}}return null}function n_(r,c){return null!==c?r[Tr][Ar].projection[c.projection]:null}function i_(r,c){const h=Gr+r+1;if(h<c.length){const g=c[h],x=g[cn].firstChild;if(null!==x)return Bf(g,x)}return c[qo]}function zf(r,c,h,g,x,M,O){for(;null!=h;){const L=g[h.index],V=h.type;if(O&&0===c&&(L&&Ro(Zi(L),g),h.flags|=2),32!=(32&h.flags))if(8&V)zf(r,c,h.child,g,x,M,!1),sd(c,r,x,L,M);else if(32&V){const Y=su(h,g);let te;for(;te=Y();)sd(c,r,x,te,M);sd(c,r,x,L,M)}else 16&V?au(r,c,g,h,x,M):sd(c,r,x,L,M);h=O?h.projectionNext:h.next}}function bh(r,c,h,g,x,M){zf(h,g,r.firstChild,c,x,M,!1)}function au(r,c,h,g,x,M){const O=h[Tr],V=O[Ar].projection[g.projection];if(Array.isArray(V))for(let Y=0;Y<V.length;Y++)sd(c,r,x,V[Y],M);else{let Y=V;const te=O[hr];hm(g)&&(Y.flags|=128),zf(r,c,Y,te,x,M,!0)}}function xh(r,c,h){""===h?r.removeAttribute(c,"class"):r.setAttribute(c,"class",h)}function lu(r,c,h){const{mergedAttrs:g,classes:x,styles:M}=h;null!==g&&ct(r,c,g),null!==x&&xh(r,c,x),null!==M&&function mc(r,c,h){r.setAttribute(c,"style",h)}(r,c,M)}function iv(r){bm=r}function rv(r){return function Uf(){if(void 0===Vf&&(Vf=null,$i.trustedTypes))try{Vf=$i.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r})}catch{}return Vf}()?.createScriptURL(r)||r}class xm{constructor(c){this.changingThisBreaksApplicationSecurity=c}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${gn})`}}function Ll(r){return r instanceof xm?r.changingThisBreaksApplicationSecurity:r}function Fa(r,c){const h=function jf(r){return r instanceof xm&&r.getTypeName()||null}(r);if(null!=h&&h!==c){if("ResourceURL"===h&&"URL"===c)return!0;throw new Error(`Required a safe ${c}, got a ${h} (see ${gn})`)}return h===c}const Ch=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var gd=function(r){return r[r.NONE=0]="NONE",r[r.HTML=1]="HTML",r[r.STYLE=2]="STYLE",r[r.SCRIPT=3]="SCRIPT",r[r.URL=4]="URL",r[r.RESOURCE_URL=5]="RESOURCE_URL",r}(gd||{});function f_(r){const c=qf();return c?c.sanitize(gd.URL,r)||"":Fa(r,"URL")?Ll(r):function Em(r){return(r=String(r)).match(Ch)?r:"unsafe:"+r}(Nt(r))}function Dm(r){const c=qf();if(c)return rv(c.sanitize(gd.RESOURCE_URL,r)||"");if(Fa(r,"ResourceURL"))return rv(Ll(r));throw new it(904,!1)}function lv(r,c,h){return function Xs(r,c){return"src"===c&&("embed"===r||"frame"===r||"iframe"===r||"media"===r||"script"===r)||"href"===c&&("base"===r||"link"===r)?Dm:f_}(c,h)(r)}function qf(){const r=Bt();return r&&r[la].sanitizer}class zi{constructor(c,h){this._desc=c,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof h?this.__NG_ELEMENT_ID__=h:void 0!==h&&(this.\u0275prov=On({token:this,providedIn:h.providedIn||"root",factory:h.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Sh=new zi("ENVIRONMENT_INITIALIZER"),Sm=new zi("INJECTOR",-1),cv=new zi("INJECTOR_DEF_TYPES");class Yf{get(c,h=je){if(h===je){const g=new Error(`NullInjectorError: No provider for ${Qe(c)}!`);throw g.name="NullInjectorError",g}return h}}function Xf(r){return{\u0275providers:r}}function Kf(...r){return{\u0275providers:uv(0,r),\u0275fromNgModule:!0}}function uv(r,...c){const h=[],g=new Set;let x;const M=O=>{h.push(O)};return Xc(c,O=>{const L=O;_d(L,M,[],g)&&(x||=[],x.push(L))}),void 0!==x&&hb(x,M),h}function hb(r,c){for(let h=0;h<r.length;h++){const{ngModule:g,providers:x}=r[h];Im(x,M=>{c(M,g)})}}function _d(r,c,h,g){if(!(r=Ot(r)))return!1;let x=null,M=Bs(r);const O=!M&&Tn(r);if(M||O){if(O&&!O.standalone)return!1;x=r}else{const V=r.ngModule;if(M=Bs(V),!M)return!1;x=V}const L=g.has(x);if(O){if(L)return!1;if(g.add(x),O.dependencies){const V="function"==typeof O.dependencies?O.dependencies():O.dependencies;for(const Y of V)_d(Y,c,h,g)}}else{if(!M)return!1;{if(null!=M.imports&&!L){let Y;g.add(x);try{Xc(M.imports,te=>{_d(te,c,h,g)&&(Y||=[],Y.push(te))})}finally{}void 0!==Y&&hb(Y,c)}if(!L){const Y=qa(x)||(()=>new x);c({provide:x,useFactory:Y,deps:Ci},x),c({provide:cv,useValue:x,multi:!0},x),c({provide:Sh,useValue:()=>Qn(x),multi:!0},x)}const V=M.providers;if(null!=V&&!L){const Y=r;Im(V,te=>{c(te,Y)})}}}return x!==r&&void 0!==r.providers}function Im(r,c){for(let h of r)un(h)&&(h=h.\u0275providers),Array.isArray(h)?Im(h,c):c(h)}const Am=ke({provide:String,useValue:ke});function Jf(r){return null!==r&&"object"==typeof r&&Am in r}function Nl(r){return"function"==typeof r}const Pm=new zi("Set Injector scope."),Qf={},fv={};let __;function ep(){return void 0===__&&(__=new Yf),__}class cl{}class Ih extends cl{get destroyed(){return this._destroyed}constructor(c,h,g,x){super(),this.parent=h,this.source=g,this.scopes=x,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,v_(c,O=>this.processProvider(O)),this.records.set(Sm,_c(void 0,this)),x.has("environment")&&this.records.set(cl,_c(void 0,this));const M=this.records.get(Pm);null!=M&&"string"==typeof M.value&&this.scopes.add(M.value),this.injectorDefTypes=new Set(this.get(cv.multi,Ci,$n.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const h of this._ngOnDestroyHooks)h.ngOnDestroy();const c=this._onDestroyHooks;this._onDestroyHooks=[];for(const h of c)h()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(c){return this.assertNotDestroyed(),this._onDestroyHooks.push(c),()=>this.removeOnDestroy(c)}runInContext(c){this.assertNotDestroyed();const h=Hn(this),g=Hr(void 0);try{return c()}finally{Hn(h),Hr(g)}}get(c,h=je,g=$n.Default){if(this.assertNotDestroyed(),c.hasOwnProperty(os))return c[os](this);g=tr(g);const M=Hn(this),O=Hr(void 0);try{if(!(g&$n.SkipSelf)){let V=this.records.get(c);if(void 0===V){const Y=function pv(r){return"function"==typeof r||"object"==typeof r&&r instanceof zi}(c)&&so(c);V=Y&&this.injectableDefInScope(Y)?_c(y_(c),Qf):null,this.records.set(c,V)}if(null!=V)return this.hydrate(c,V)}return(g&$n.Self?ep():this.parent).get(c,h=g&$n.Optional&&h===je?null:h)}catch(L){if("NullInjectorError"===L.name){if((L[tt]=L[tt]||[]).unshift(Qe(c)),M)throw L;return function vl(r,c,h,g){const x=r[tt];throw c[qn]&&x.unshift(c[qn]),r.message=function uf(r,c,h,g=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.slice(2):r;let x=Qe(c);if(Array.isArray(c))x=c.map(Qe).join(" -> ");else if("object"==typeof c){let M=[];for(let O in c)if(c.hasOwnProperty(O)){let L=c[O];M.push(O+":"+("string"==typeof L?JSON.stringify(L):Qe(L)))}x=`{${M.join(", ")}}`}return`${h}${g?"("+g+")":""}[${x}]: ${r.replace(Yt,"\n  ")}`}("\n"+r.message,x,h,g),r.ngTokenPath=x,r[tt]=null,r}(L,c,"R3InjectorError",this.source)}throw L}finally{Hr(O),Hn(M)}}resolveInjectorInitializers(){const c=Hn(this),h=Hr(void 0);try{const x=this.get(Sh.multi,Ci,$n.Self);for(const M of x)M()}finally{Hn(c),Hr(h)}}toString(){const c=[],h=this.records;for(const g of h.keys())c.push(Qe(g));return`R3Injector[${c.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new it(205,!1)}processProvider(c){let h=Nl(c=Ot(c))?c:Ot(c&&c.provide);const g=function Om(r){return Jf(r)?_c(void 0,r.useValue):_c(Ah(r),Qf)}(c);if(Nl(c)||!0!==c.multi)this.records.get(h);else{let x=this.records.get(h);x||(x=_c(void 0,Qf,!0),x.factory=()=>Vo(x.multi),this.records.set(h,x)),h=c,x.multi.push(c)}this.records.set(h,g)}hydrate(c,h){return h.value===Qf&&(h.value=fv,h.value=h.factory()),"object"==typeof h.value&&h.value&&function Rm(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(h.value)&&this._ngOnDestroyHooks.add(h.value),h.value}injectableDefInScope(c){if(!c.providedIn)return!1;const h=Ot(c.providedIn);return"string"==typeof h?"any"===h||this.scopes.has(h):this.injectorDefTypes.has(h)}removeOnDestroy(c){const h=this._onDestroyHooks.indexOf(c);-1!==h&&this._onDestroyHooks.splice(h,1)}}function y_(r){const c=so(r),h=null!==c?c.factory:qa(r);if(null!==h)return h;if(r instanceof zi)throw new it(204,!1);if(r instanceof Function)return function Ps(r){const c=r.length;if(c>0)throw function Kc(r,c){const h=[];for(let g=0;g<r;g++)h.push(c);return h}(c,"?"),new it(204,!1);const h=function is(r){return r&&(r[xa]||r[Bo])||null}(r);return null!==h?()=>h.factory(r):()=>new r}(r);throw new it(204,!1)}function Ah(r,c,h){let g;if(Nl(r)){const x=Ot(r);return qa(x)||y_(x)}if(Jf(r))g=()=>Ot(r.useValue);else if(function g_(r){return!(!r||!r.useFactory)}(r))g=()=>r.useFactory(...Vo(r.deps||[]));else if(function dv(r){return!(!r||!r.useExisting)}(r))g=()=>Qn(Ot(r.useExisting));else{const x=Ot(r&&(r.useClass||r.provide));if(!function Ct(r){return!!r.deps}(r))return qa(x)||y_(x);g=()=>new x(...Vo(r.deps))}return g}function _c(r,c,h=!1){return{factory:r,value:c,multi:h?[]:void 0}}function v_(r,c){for(const h of r)Array.isArray(h)?v_(h,c):h&&un(h)?v_(h.\u0275providers,c):c(h)}const mv=new zi("AppId",{providedIn:"root",factory:()=>pw}),pw="ng",gv=new zi("Platform Initializer"),b_=new zi("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),fb=new zi("AnimationModuleType"),Ph=new zi("CSP nonce",{providedIn:"root",factory:()=>function fd(){if(void 0!==bm)return bm;if(typeof document<"u")return document;throw new it(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let w_=(r,c,h)=>null;function Rh(r,c,h=!1){return w_(r,c,h)}class E_{}class Vm{}class Nh{resolveComponentFactory(c){throw function Fh(r){const c=Error(`No component factory found for ${Qe(r)}.`);return c.ngComponent=r,c}(c)}}let wd=(()=>{class c{}return c.NULL=new Nh,c})();function C_(){return rp(Qr(),Bt())}function rp(r,c){return new Bh(Zr(r,c))}let Bh=(()=>{class c{constructor(g){this.nativeElement=g}}return c.__NG_ELEMENT_ID__=C_,c})();function mw(r){return r instanceof Bh?r.nativeElement:r}class Um{}let Cv=(()=>{class c{constructor(){this.destroyNode=null}}return c.__NG_ELEMENT_ID__=()=>function fs(){const r=Bt(),h=Ao(Qr().index,r);return(Nr(h)?h:r)[Un]}(),c})(),T_=(()=>{var r;class c{}return(r=c).\u0275prov=On({token:r,providedIn:"root",factory:()=>null}),c})();class M_{constructor(c){this.full=c,this.major=c.split(".")[0],this.minor=c.split(".")[1],this.patch=c.split(".").slice(2).join(".")}}const Js=new M_("16.2.3"),hu={};function xc(r){if(!si()&&!function Xn(){return Vn}())throw new it(-203,!1)}function jm(r,c=null,h=null,g){const x=Sv(r,c,h,g);return x.resolveInjectorInitializers(),x}function Sv(r,c=null,h=null,g,x=new Set){const M=[h||Ci,Kf(r)];return g=g||("object"==typeof r?void 0:Qe(r)),new Ih(M,c||ep(),g||null,x)}let dl=(()=>{var r;class c{static create(g,x){if(Array.isArray(g))return jm({name:""},x,g,"");{const M=g.name??"";return jm({name:M},g.parent,g.providers,M)}}}return(r=c).THROW_IF_NOT_FOUND=je,r.NULL=new Yf,r.\u0275prov=On({token:r,providedIn:"any",factory:()=>Qn(Sm)}),r.__NG_ELEMENT_ID__=-1,c})(),ga=(()=>{var r;class c{}return(r=c).__NG_ELEMENT_ID__=S_,r.__NG_ENV_ID__=h=>h,c})();class Iv extends ga{constructor(c){super(),this._lView=c}onDestroy(c){return rn(this._lView,c),()=>function Es(r,c){if(null===r[Ca])return;const h=r[Ca].indexOf(c);-1!==h&&r[Ca].splice(h,1)}(this._lView,c)}}function S_(){return new Iv(Bt())}function Hm(r){return c=>{setTimeout(r,void 0,c)}}const hl=class $m extends E.x{constructor(c=!1){super(),this.__isAsync=c}emit(c){super.next(c)}subscribe(c,h,g){let x=c,M=h||(()=>null),O=g;if(c&&"object"==typeof c){const V=c;x=V.next?.bind(V),M=V.error?.bind(V),O=V.complete?.bind(V)}this.__isAsync&&(M=Hm(M),x&&(x=Hm(x)),O&&(O=Hm(O)));const L=super.subscribe({next:x,error:M,complete:O});return c instanceof Be.w0&&c.add(L),L}};function Av(...r){}class Xr{constructor({enableLongStackTrace:c=!1,shouldCoalesceEventChangeDetection:h=!1,shouldCoalesceRunChangeDetection:g=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new hl(!1),this.onMicrotaskEmpty=new hl(!1),this.onStable=new hl(!1),this.onError=new hl(!1),typeof Zone>"u")throw new it(908,!1);Zone.assertZonePatched();const x=this;x._nesting=0,x._outer=x._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(x._inner=x._inner.fork(new Zone.TaskTrackingZoneSpec)),c&&Zone.longStackTraceZoneSpec&&(x._inner=x._inner.fork(Zone.longStackTraceZoneSpec)),x.shouldCoalesceEventChangeDetection=!g&&h,x.shouldCoalesceRunChangeDetection=g,x.lastRequestAnimationFrameId=-1,x.nativeRequestAnimationFrame=function I_(){const r="function"==typeof $i.requestAnimationFrame;let c=$i[r?"requestAnimationFrame":"setTimeout"],h=$i[r?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&c&&h){const g=c[Zone.__symbol__("OriginalDelegate")];g&&(c=g);const x=h[Zone.__symbol__("OriginalDelegate")];x&&(h=x)}return{nativeRequestAnimationFrame:c,nativeCancelAnimationFrame:h}}().nativeRequestAnimationFrame,function wc(r){const c=()=>{!function ko(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call($i,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,fu(r),r.isCheckStableRunning=!0,A_(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),fu(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(h,g,x,M,O,L)=>{try{return zh(r),h.invokeTask(x,M,O,L)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===M.type||r.shouldCoalesceRunChangeDetection)&&c(),Gm(r)}},onInvoke:(h,g,x,M,O,L,V)=>{try{return zh(r),h.invoke(x,M,O,L,V)}finally{r.shouldCoalesceRunChangeDetection&&c(),Gm(r)}},onHasTask:(h,g,x,M)=>{h.hasTask(x,M),g===x&&("microTask"==M.change?(r._hasPendingMicrotasks=M.microTask,fu(r),A_(r)):"macroTask"==M.change&&(r.hasPendingMacrotasks=M.macroTask))},onHandleError:(h,g,x,M)=>(h.handleError(x,M),r.runOutsideAngular(()=>r.onError.emit(M)),!1)})}(x)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Xr.isInAngularZone())throw new it(909,!1)}static assertNotInAngularZone(){if(Xr.isInAngularZone())throw new it(909,!1)}run(c,h,g){return this._inner.run(c,h,g)}runTask(c,h,g,x){const M=this._inner,O=M.scheduleEventTask("NgZoneEvent: "+x,c,Ov,Av,Av);try{return M.runTask(O,h,g)}finally{M.cancelTask(O)}}runGuarded(c,h,g){return this._inner.runGuarded(c,h,g)}runOutsideAngular(c){return this._outer.run(c)}}const Ov={};function A_(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function fu(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function zh(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function Gm(r){r._nesting--,A_(r)}class Zm{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new hl,this.onMicrotaskEmpty=new hl,this.onStable=new hl,this.onError=new hl}run(c,h,g){return c.apply(h,g)}runGuarded(c,h,g){return c.apply(h,g)}runOutsideAngular(c){return c()}runTask(c,h,g,x){return c.apply(h,g)}}const Rv=new zi("",{providedIn:"root",factory:Wm});function Wm(){const r=li(Xr);let c=!0;const h=new rt.y(x=>{c=r.isStable&&!r.hasPendingMacrotasks&&!r.hasPendingMicrotasks,r.runOutsideAngular(()=>{x.next(c),x.complete()})}),g=new rt.y(x=>{let M;r.runOutsideAngular(()=>{M=r.onStable.subscribe(()=>{Xr.assertNotInAngularZone(),queueMicrotask(()=>{!c&&!r.hasPendingMacrotasks&&!r.hasPendingMicrotasks&&(c=!0,x.next(!0))})})});const O=r.onUnstable.subscribe(()=>{Xr.assertInAngularZone(),c&&(c=!1,r.runOutsideAngular(()=>{x.next(!1)}))});return()=>{M.unsubscribe(),O.unsubscribe()}});return(0,p.T)(h,g.pipe((0,Ge.B)()))}function qm(r){return r.ownerDocument.defaultView}function zl(r){return r instanceof Function?r():r}let P_=(()=>{var r;class c{constructor(){this.callbacks=new Set,this.deferredCallbacks=new Set,this.renderDepth=0,this.runningCallbacks=!1}begin(){if(this.runningCallbacks)throw new it(102,!1);this.renderDepth++}end(){if(this.renderDepth--,0===this.renderDepth)try{this.runningCallbacks=!0;for(const g of this.callbacks)g.invoke()}finally{this.runningCallbacks=!1;for(const g of this.deferredCallbacks)this.callbacks.add(g);this.deferredCallbacks.clear()}}register(g){(this.runningCallbacks?this.deferredCallbacks:this.callbacks).add(g)}unregister(g){this.callbacks.delete(g),this.deferredCallbacks.delete(g)}ngOnDestroy(){this.callbacks.clear(),this.deferredCallbacks.clear()}}return(r=c).\u0275prov=On({token:r,providedIn:"root",factory:()=>new r}),c})();function Uh(r){for(;r;){r[In]|=64;const c=pc(r);if(Vu(r)&&!c)return r;r=c}return null}function cp(r){return r.ngOriginalError}class Vl{constructor(){this._console=console}handleError(c){const h=this._findOriginalError(c);this._console.error("ERROR",c),h&&this._console.error("ORIGINAL ERROR",h)}_findOriginalError(c){let h=c&&cp(c);for(;h&&cp(h);)h=cp(h);return h||null}}const Na=new zi("",{providedIn:"root",factory:()=>!1});class Hh extends Zd{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(c){this._lView=c}onConsumerDependencyMayHaveChanged(){Uh(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(c,h,g){const x=zr(this);this.trackingVersion++;try{c(h,g)}finally{zr(x)}}destroy(){this.trackingVersion++}}let up=null;function O_(){return up??=new Hh,up}function mu(r,c){return r[c]??O_()}function Gh(r,c){const h=O_();h.hasReadASignal&&(r[c]=up,h.lView=r,up=new Hh)}const di={};function Jm(r){Qm(vi(),Bt(),Wr()+r,!1)}function Qm(r,c,h,g){if(!g)if(3==(3&c[In])){const M=r.preOrderCheckHooks;null!==M&&Ka(c,M,h)}else{const M=r.preOrderHooks;null!==M&&_(c,M,0,h)}Jt(h)}function Tc(r,c=$n.Default){const h=Bt();return null===h?Qn(r,c):gt(Qr(),h,Ot(r),c)}function eg(){throw new Error("invalid")}function Zh(r,c,h,g,x,M,O,L,V,Y,te){const me=c.blueprint.slice();return me[vr]=x,me[In]=140|g,(null!==Y||r&&2048&r[In])&&(me[In]|=2048),Hc(me),me[hr]=me[Zo]=r,me[br]=h,me[la]=O||r&&r[la],me[Un]=L||r&&r[Un],me[aa]=V||r&&r[aa]||null,me[Ar]=M,me[Wa]=function Jo(){return mm++}(),me[$s]=te,me[hf]=Y,me[Tr]=2==c.type?r[Tr]:me,me}function Ed(r,c,h,g,x){let M=r.data[c];if(null===M)M=function tg(r,c,h,g,x){const M=Wc(),O=qc(),V=r.data[c]=function yu(r,c,h,g,x,M){let O=c?c.injectorIndex:-1,L=0;return function Da(){return null!==Kn.skipHydrationRootTNode}()&&(L|=128),{type:h,index:g,insertBeforeIndex:null,injectorIndex:O,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:L,providerIndexes:0,value:x,attrs:M,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:c,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,O?M:M&&M.parent,h,c,g,x);return null===r.firstChild&&(r.firstChild=V),null!==M&&(O?null==M.child&&null!==V.parent&&(M.child=V):null===M.next&&(M.next=V,V.prev=M)),V}(r,c,h,g,x),function em(){return Kn.lFrame.inI18n}()&&(M.flags|=32);else if(64&M.type){M.type=h,M.value=g,M.attrs=x;const O=function Ya(){const r=Kn.lFrame,c=r.currentTNode;return r.isParent?c:c.parent}();M.injectorIndex=null===O?-1:O.injectorIndex}return ls(M,!0),M}function Wh(r,c,h,g){if(0===h)return-1;const x=c.length;for(let M=0;M<h;M++)c.push(g),r.blueprint.push(g),r.data.push(null);return x}function R_(r,c,h,g,x){const M=mu(c,Nu),O=Wr(),L=2&g;try{if(Jt(-1),L&&c.length>vn&&Qm(r,c,vn,!1),So(L?2:0,x),L)M.runInContext(h,g,x);else{const Y=zr(null);try{h(g,x)}finally{zr(Y)}}}finally{L&&null===c[Nu]&&Gh(c,Nu),Jt(O),So(L?3:1,x)}}function gu(r,c,h){if(kc(c)){const g=zr(null);try{const M=c.directiveEnd;for(let O=c.directiveStart;O<M;O++){const L=r.data[O];L.contentQueries&&L.contentQueries(1,h[O],O)}}finally{zr(g)}}}function Cd(r,c,h){Qd()&&(function Td(r,c,h,g){const x=h.directiveStart,M=h.directiveEnd;Tl(h)&&function Eb(r,c,h){const g=Zr(c,r),x=k_(h);let O=16;h.signals?O=4096:h.onPush&&(O=64);const L=mp(r,Zh(r,x,null,O,g,c,null,r[la].rendererFactory.createRenderer(g,h),null,null,null));r[c.index]=L}(c,h,r.data[x+h.componentOffset]),r.firstCreatePass||At(h,c),Ro(g,c);const O=h.initialInputs;for(let L=x;L<M;L++){const V=r.data[L],Y=an(c,r,L,h);Ro(Y,c),null!==O&&Sd(0,L-x,Y,V,0,O),Hs(V)&&(Ao(h.index,c)[br]=an(c,r,L,h))}}(r,c,h,Zr(h,c)),64==(64&h.flags)&&jl(r,c,h))}function _u(r,c,h=Zr){const g=c.localNames;if(null!==g){let x=c.index+1;for(let M=0;M<g.length;M+=2){const O=g[M+1],L=-1===O?h(c,r):r[O];r[x++]=L}}}function k_(r){const c=r.tView;return null===c||c.incompleteFirstPass?r.tView=qh(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts,r.id):c}function qh(r,c,h,g,x,M,O,L,V,Y,te){const me=vn+g,Fe=me+x,qe=function ng(r,c){const h=[];for(let g=0;g<c;g++)h.push(g<r?null:di);return h}(me,Fe),St="function"==typeof Y?Y():Y;return qe[cn]={type:r,blueprint:qe,template:h,queries:null,viewQuery:L,declTNode:c,data:qe.slice().fill(null,me),bindingStartIndex:me,expandoStartIndex:Fe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof M?M():M,pipeRegistry:"function"==typeof O?O():O,firstChild:null,schemas:V,consts:St,incompleteFirstPass:!1,ssrId:te}}let dp=r=>null;function L_(r,c,h,g){for(let x in r)if(r.hasOwnProperty(x)){h=null===h?{}:h;const M=r[x];null===g?xb(h,c,x,M):g.hasOwnProperty(x)&&xb(h,c,g[x],M)}return h}function xb(r,c,h,g){r.hasOwnProperty(h)?r[h].push(c,g):r[h]=[c,g]}function to(r,c,h,g,x,M,O,L){const V=Zr(c,h);let te,Y=c.inputs;!L&&null!=Y&&(te=Y[g])?(sg(r,h,te,g,x),Tl(c)&&function N_(r,c){const h=Ao(c,r);16&h[In]||(h[In]|=64)}(h,c.index)):3&c.type&&(g=function fp(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(g),x=null!=O?O(x,c.value||"",g):x,M.setProperty(V,g,x))}function pp(r,c,h,g){if(Qd()){const x=null===g?null:{"":-1},M=function z_(r,c){const h=r.directiveRegistry;let g=null,x=null;if(h)for(let M=0;M<h.length;M++){const O=h[M];if($o(c,O.selectors,!1))if(g||(g=[]),Hs(O))if(null!==O.findHostDirectiveDefs){const L=[];x=x||new Map,O.findHostDirectiveDefs(O,L,x),g.unshift(...L,O),V_(r,c,L.length)}else g.unshift(O),V_(r,c,0);else x=x||new Map,O.findHostDirectiveDefs?.(O,g,x),g.push(O)}return null===g?null:[g,x]}(r,h);let O,L;null===M?O=L=null:[O,L]=M,null!==O&&B_(r,c,h,O,x,L),x&&function Bv(r,c,h){if(c){const g=r.localNames=[];for(let x=0;x<c.length;x+=2){const M=h[c[x+1]];if(null==M)throw new it(-301,!1);g.push(c[x],M)}}}(h,g,x)}h.mergedAttrs=Cr(h.mergedAttrs,h.attrs)}function B_(r,c,h,g,x,M){for(let Y=0;Y<g.length;Y++)bt(At(h,c),r,g[Y].type);!function zv(r,c,h){r.flags|=1,r.directiveStart=c,r.directiveEnd=c+h,r.providerIndexes=c}(h,r.data.length,g.length);for(let Y=0;Y<g.length;Y++){const te=g[Y];te.providersResolver&&te.providersResolver(te)}let O=!1,L=!1,V=Wh(r,c,g.length,null);for(let Y=0;Y<g.length;Y++){const te=g[Y];h.mergedAttrs=Cr(h.mergedAttrs,te.hostAttrs),yw(r,h,c,V,te),U_(V,te,x),null!==te.contentQueries&&(h.flags|=4),(null!==te.hostBindings||null!==te.hostAttrs||0!==te.hostVars)&&(h.flags|=64);const me=te.type.prototype;!O&&(me.ngOnChanges||me.ngOnInit||me.ngDoCheck)&&((r.preOrderHooks??=[]).push(h.index),O=!0),!L&&(me.ngOnChanges||me.ngDoCheck)&&((r.preOrderCheckHooks??=[]).push(h.index),L=!0),V++}!function Nv(r,c,h){const x=c.directiveEnd,M=r.data,O=c.attrs,L=[];let V=null,Y=null;for(let te=c.directiveStart;te<x;te++){const me=M[te],Fe=h?h.get(me):null,St=Fe?Fe.outputs:null;V=L_(me.inputs,te,V,Fe?Fe.inputs:null),Y=L_(me.outputs,te,Y,St);const Xt=null===V||null===O||wa(c)?null:og(V,te,O);L.push(Xt)}null!==V&&(V.hasOwnProperty("class")&&(c.flags|=8),V.hasOwnProperty("style")&&(c.flags|=16)),c.initialInputs=L,c.inputs=V,c.outputs=Y}(r,h,M)}function jl(r,c,h){const g=h.directiveStart,x=h.directiveEnd,M=h.index,O=function tm(){return Kn.lFrame.currentDirectiveIndex}();try{Jt(M);for(let L=g;L<x;L++){const V=r.data[L],Y=c[L];wf(L),(null!==V.hostBindings||0!==V.hostVars||null!==V.hostAttrs)&&Md(V,Y)}}finally{Jt(-1),wf(O)}}function Md(r,c){null!==r.hostBindings&&r.hostBindings(1,c)}function V_(r,c,h){c.componentOffset=h,(r.components??=[]).push(c.index)}function U_(r,c,h){if(h){if(c.exportAs)for(let g=0;g<c.exportAs.length;g++)h[c.exportAs[g]]=r;Hs(c)&&(h[""]=r)}}function yw(r,c,h,g,x){r.data[g]=x;const M=x.factory||(x.factory=qa(x.type)),O=new R(M,Hs(x),Tc);r.blueprint[g]=O,h[g]=O,function fl(r,c,h,g,x){const M=x.hostBindings;if(M){let O=r.hostBindingOpCodes;null===O&&(O=r.hostBindingOpCodes=[]);const L=~c.index;(function Mc(r){let c=r.length;for(;c>0;){const h=r[--c];if("number"==typeof h&&h<0)return h}return 0})(O)!=L&&O.push(L),O.push(h,g,M)}}(r,c,g,Wh(r,h,x.hostVars,di),x)}function Fs(r,c,h,g,x,M){const O=Zr(r,c);!function Dd(r,c,h,g,x,M,O){if(null==M)r.removeAttribute(c,x,h);else{const L=null==O?Nt(M):O(M,g||"",x);r.setAttribute(c,x,L,h)}}(c[Un],O,M,r.value,h,g,x)}function Sd(r,c,h,g,x,M){const O=M[c];if(null!==O)for(let L=0;L<O.length;)Id(g,h,O[L++],O[L++],O[L++])}function Id(r,c,h,g,x){const M=zr(null);try{const O=r.inputTransforms;null!==O&&O.hasOwnProperty(g)&&(x=O[g].call(c,x)),null!==r.setInput?r.setInput(c,x,h,g):c[g]=x}finally{zr(M)}}function og(r,c,h){let g=null,x=0;for(;x<h.length;){const M=h[x];if(0!==M)if(5!==M){if("number"==typeof M)break;if(r.hasOwnProperty(M)){null===g&&(g=[]);const O=r[M];for(let L=0;L<O.length;L+=2)if(O[L]===c){g.push(M,O[L+1],h[x+1]);break}}x+=2}else x+=2;else x+=4}return g}function j_(r,c,h,g){return[r,!0,!1,c,null,0,g,h,null,null,null]}function pl(r,c){const h=r.contentQueries;if(null!==h)for(let g=0;g<h.length;g+=2){const M=h[g+1];if(-1!==M){const O=r.data[M];cs(h[g]),O.contentQueries(2,c[M],M)}}}function mp(r,c){return r[ec]?r[El][Ho]=c:r[ec]=c,r[El]=c,c}function Yh(r,c,h){cs(0);const g=zr(null);try{c(r,h)}finally{zr(g)}}function Xh(r){return r[wl]||(r[wl]=[])}function $_(r){return r.cleanup||(r.cleanup=[])}function H_(r,c){const h=r[aa],g=h?h.get(Vl,null):null;g&&g.handleError(c)}function sg(r,c,h,g,x){for(let M=0;M<h.length;){const O=h[M++],L=h[M++];Id(r.data[O],c[O],g,L,x)}}function Vv(r,c){const h=Ao(c,r),g=h[cn];!function Dc(r,c){for(let h=c.length;h<r.blueprint.length;h++)c.push(r.blueprint[h])}(g,h);const x=h[vr];null!==x&&null===h[$s]&&(h[$s]=Rh(x,h[aa])),es(g,h,h[br])}function es(r,c,h){Ws(c);try{const g=r.viewQuery;null!==g&&Yh(1,g,h);const x=r.template;null!==x&&R_(r,c,x,1,h),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&pl(r,c),r.staticViewQueries&&Yh(2,r.viewQuery,h);const M=r.components;null!==M&&function $l(r,c){for(let h=0;h<c.length;h++)Vv(r,c[h])}(c,M)}catch(g){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),g}finally{c[In]&=-5,oh()}}let Ad=(()=>{var r;class c{constructor(){this.all=new Set,this.queue=new Map}create(g,x,M){const O=typeof Zone>"u"?null:Zone.current,L=new yf(g,te=>{this.all.has(te)&&this.queue.set(te,O)},M);let V;this.all.add(L),L.notify();const Y=()=>{L.cleanup(),V?.(),this.all.delete(L),this.queue.delete(L)};return V=x?.onDestroy(Y),{destroy:Y}}flush(){if(0!==this.queue.size)for(const[g,x]of this.queue)this.queue.delete(g),x?x.run(()=>g.run()):g.run()}get isQueueEmpty(){return 0===this.queue.size}}return(r=c).\u0275prov=On({token:r,providedIn:"root",factory:()=>new r}),c})();function ml(r,c,h){let g=h?r.styles:null,x=h?r.classes:null,M=0;if(null!==c)for(let O=0;O<c.length;O++){const L=c[O];"number"==typeof L?M=L:1==M?x=It(x,L):2==M&&(g=It(g,L+": "+c[++O]+";"))}h?r.styles=g:r.stylesWithoutHost=g,h?r.classes=x:r.classesWithoutHost=x}function vu(r,c,h,g,x=!1){for(;null!==h;){const M=c[h.index];null!==M&&g.push(Zi(M)),Br(M)&&_p(M,g);const O=h.type;if(8&O)vu(r,c,h.child,g);else if(32&O){const L=su(h,c);let V;for(;V=L();)g.push(V)}else if(16&O){const L=n_(c,h);if(Array.isArray(L))g.push(...L);else{const V=pc(c[Tr]);vu(V[cn],V,L,g,!0)}}h=x?h.projectionNext:h.next}return g}function _p(r,c){for(let h=Gr;h<r.length;h++){const g=r[h],x=g[cn].firstChild;null!==x&&vu(g[cn],g,x,c)}r[qo]!==r[vr]&&c.push(r[qo])}function bu(r,c,h,g=!0){const x=c[la],M=x.rendererFactory,O=x.afterRenderEventManager;M.begin?.(),O?.begin();try{ag(r,c,r.template,h)}catch(V){throw g&&H_(c,V),V}finally{M.end?.(),x.effectManager?.flush(),O?.end()}}function ag(r,c,h,g){const x=c[In];if(256!=(256&x)){c[la].effectManager?.flush(),Ws(c);try{Hc(c),function bf(r){return Kn.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==h&&R_(r,c,h,2,g);const O=3==(3&x);if(O){const Y=r.preOrderCheckHooks;null!==Y&&Ka(c,Y,null)}else{const Y=r.preOrderHooks;null!==Y&&_(c,Y,0,null),l(c,0)}if(function jv(r){for(let c=Jg(r);null!==c;c=Ky(c)){if(!c[ff])continue;const h=c[tc];for(let g=0;g<h.length;g++){qu(h[g])}}}(c),G_(c,2),null!==r.contentQueries&&pl(r,c),O){const Y=r.contentCheckHooks;null!==Y&&Ka(c,Y)}else{const Y=r.contentHooks;null!==Y&&_(c,Y,1),l(c,1)}!function Lv(r,c){const h=r.hostBindingOpCodes;if(null===h)return;const g=mu(c,ca);try{for(let x=0;x<h.length;x++){const M=h[x];if(M<0)Jt(~M);else{const O=M,L=h[++x],V=h[++x];fo(L,O),g.runInContext(V,2,c[O])}}}finally{null===c[ca]&&Gh(c,ca),Jt(-1)}}(r,c);const L=r.components;null!==L&&W_(c,L,0);const V=r.viewQuery;if(null!==V&&Yh(2,V,g),O){const Y=r.viewCheckHooks;null!==Y&&Ka(c,Y)}else{const Y=r.viewHooks;null!==Y&&_(c,Y,2),l(c,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),c[In]&=-73,Yu(c)}finally{oh()}}}function G_(r,c){for(let h=Jg(r);null!==h;h=Ky(h))for(let g=Gr;g<h.length;g++)$v(h[g],c)}function Z_(r,c,h){$v(Ao(c,r),h)}function $v(r,c){if(!function jc(r){return 128==(128&r[In])}(r))return;const h=r[cn];if(80&r[In]&&0===c||1024&r[In]||2===c)ag(h,r,h.template,r[br]);else if(r[Go]>0){G_(r,1);const x=r[cn].components;null!==x&&W_(r,x,1)}}function W_(r,c,h){for(let g=0;g<c.length;g++)Z_(r,c[g],h)}class xu{get rootNodes(){const c=this._lView,h=c[cn];return vu(h,c,h.firstChild,[])}constructor(c,h){this._lView=c,this._cdRefInjectingView=h,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[br]}set context(c){this._lView[br]=c}get destroyed(){return 256==(256&this._lView[In])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const c=this._lView[hr];if(Br(c)){const h=c[8],g=h?h.indexOf(this):-1;g>-1&&(Qo(c,g),qs(h,g))}this._attachedToViewContainer=!1}Is(this._lView[cn],this._lView)}onDestroy(c){rn(this._lView,c)}markForCheck(){Uh(this._cdRefInjectingView||this._lView)}detach(){this._lView[In]&=-129}reattach(){this._lView[In]|=128}detectChanges(){bu(this._lView[cn],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new it(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Ra(r,c){bh(r,c,c[Un],2,null,null)}(this._lView[cn],this._lView)}attachToAppRef(c){if(this._attachedToViewContainer)throw new it(902,!1);this._appRef=c}}class Hv extends xu{constructor(c){super(c),this._view=c}detectChanges(){const c=this._view;bu(c[cn],c,c[br],!1)}checkNoChanges(){}get context(){return null}}class q_ extends wd{constructor(c){super(),this.ngModule=c}resolveComponentFactory(c){const h=Tn(c);return new wu(h,this.ngModule)}}function yp(r){const c=[];for(let h in r)r.hasOwnProperty(h)&&c.push({propName:r[h],templateName:h});return c}class lg{constructor(c,h){this.injector=c,this.parentInjector=h}get(c,h,g){g=tr(g);const x=this.injector.get(c,hu,g);return x!==hu||h===hu?x:this.parentInjector.get(c,h,g)}}class wu extends Vm{get inputs(){const c=this.componentDef,h=c.inputTransforms,g=yp(c.inputs);if(null!==h)for(const x of g)h.hasOwnProperty(x.propName)&&(x.transform=h[x.propName]);return g}get outputs(){return yp(this.componentDef.outputs)}constructor(c,h){super(),this.componentDef=c,this.ngModule=h,this.componentType=c.type,this.selector=function or(r){return r.map(xs).join(",")}(c.selectors),this.ngContentSelectors=c.ngContentSelectors?c.ngContentSelectors:[],this.isBoundToModule=!!h}create(c,h,g,x){let M=(x=x||this.ngModule)instanceof cl?x:x?.injector;M&&null!==this.componentDef.getStandaloneInjector&&(M=this.componentDef.getStandaloneInjector(M)||M);const O=M?new lg(c,M):c,L=O.get(Um,null);if(null===L)throw new it(407,!1);const me={rendererFactory:L,sanitizer:O.get(T_,null),effectManager:O.get(Ad,null),afterRenderEventManager:O.get(P_,null)},Fe=L.createRenderer(null,this.componentDef),qe=this.componentDef.selectors[0][0]||"div",St=g?function Ul(r,c,h,g){const M=g.get(Na,!1)||h===Vs.ShadowDom,O=r.selectRootElement(c,M);return function ig(r){dp(r)}(O),O}(Fe,g,this.componentDef.encapsulation,O):yh(Fe,qe,function vp(r){const c=r.toLowerCase();return"svg"===c?Zu:"math"===c?"math":null}(qe)),kn=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let Vt=null;null!==St&&(Vt=Rh(St,O,!0));const hi=qh(0,null,null,1,0,null,null,null,null,null,null),Di=Zh(null,hi,null,kn,null,null,me,Fe,O,null,Vt);let ar,ja;Ws(Di);try{const Ru=this.componentDef;let Ig,Qx=null;Ru.findHostDirectiveDefs?(Ig=[],Qx=new Map,Ru.findHostDirectiveDefs(Ru,Ig,Qx),Ig.push(Ru)):Ig=[Ru];const QM=function t(r,c){const h=r[cn],g=vn;return r[g]=c,Ed(h,g,2,"#host",null)}(Di,St),eD=function a(r,c,h,g,x,M,O){const L=x[cn];!function u(r,c,h,g){for(const x of r)c.mergedAttrs=Cr(c.mergedAttrs,x.hostAttrs);null!==c.mergedAttrs&&(ml(c,c.mergedAttrs,!0),null!==h&&lu(g,h,c))}(g,r,c,O);let V=null;null!==c&&(V=Rh(c,x[aa]));const Y=M.rendererFactory.createRenderer(c,h);let te=16;h.signals?te=4096:h.onPush&&(te=64);const me=Zh(x,k_(h),null,te,x[r.index],r,M,Y,null,null,V);return L.firstCreatePass&&V_(L,r,g.length-1),mp(x,me),x[r.index]=me}(QM,St,Ru,Ig,Di,me,Fe);ja=Uc(hi,vn),St&&function y(r,c,h,g){if(g)ct(r,h,["ng-version",Js.full]);else{const{attrs:x,classes:M}=function ss(r){const c=[],h=[];let g=1,x=2;for(;g<r.length;){let M=r[g];if("string"==typeof M)2===x?""!==M&&c.push(M,r[++g]):8===x&&h.push(M);else{if(!Ln(x))break;x=M}g++}return{attrs:c,classes:h}}(c.selectors[0]);x&&ct(r,h,x),M&&M.length>0&&xh(r,h,M.join(" "))}}(Fe,Ru,St,g),void 0!==h&&function w(r,c,h){const g=r.projection=[];for(let x=0;x<c.length;x++){const M=h[x];g.push(null!=M?Array.from(M):null)}}(ja,this.ngContentSelectors,h),ar=function m(r,c,h,g,x,M){const O=Qr(),L=x[cn],V=Zr(O,x);B_(L,x,O,h,null,g);for(let te=0;te<h.length;te++)Ro(an(x,L,O.directiveStart+te,O),x);jl(L,x,O),V&&Ro(V,x);const Y=an(x,L,O.directiveStart+O.componentOffset,O);if(r[br]=x[br]=Y,null!==M)for(const te of M)te(Y,c);return gu(L,O,r),Y}(eD,Ru,Ig,Qx,Di,[T]),es(hi,Di,null)}finally{oh()}return new o(this.componentType,ar,rp(ja,Di),Di,ja)}}class o extends E_{constructor(c,h,g,x,M){super(),this.location=g,this._rootLView=x,this._tNode=M,this.previousInputValues=null,this.instance=h,this.hostView=this.changeDetectorRef=new Hv(x),this.componentType=c}setInput(c,h){const g=this._tNode.inputs;let x;if(null!==g&&(x=g[c])){if(this.previousInputValues??=new Map,this.previousInputValues.has(c)&&Object.is(this.previousInputValues.get(c),h))return;const M=this._rootLView;sg(M[cn],M,x,c,h),this.previousInputValues.set(c,h),Uh(Ao(this._tNode.index,M))}}get injector(){return new ri(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(c){this.hostView.onDestroy(c)}}function T(){const r=Qr();Po(Bt()[cn],r)}function P(r){let c=function I(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),h=!0;const g=[r];for(;c;){let x;if(Hs(r))x=c.\u0275cmp||c.\u0275dir;else{if(c.\u0275cmp)throw new it(903,!1);x=c.\u0275dir}if(x){if(h){g.push(x);const O=r;O.inputs=z(r.inputs),O.inputTransforms=z(r.inputTransforms),O.declaredInputs=z(r.declaredInputs),O.outputs=z(r.outputs);const L=x.hostBindings;L&&q(r,L);const V=x.viewQuery,Y=x.contentQueries;if(V&&U(r,V),Y&&G(r,Y),$e(r.inputs,x.inputs),$e(r.declaredInputs,x.declaredInputs),$e(r.outputs,x.outputs),null!==x.inputTransforms&&(null===O.inputTransforms&&(O.inputTransforms={}),$e(O.inputTransforms,x.inputTransforms)),Hs(x)&&x.data.animation){const te=r.data;te.animation=(te.animation||[]).concat(x.data.animation)}}const M=x.features;if(M)for(let O=0;O<M.length;O++){const L=M[O];L&&L.ngInherit&&L(r),L===P&&(h=!1)}}c=Object.getPrototypeOf(c)}!function N(r){let c=0,h=null;for(let g=r.length-1;g>=0;g--){const x=r[g];x.hostVars=c+=x.hostVars,x.hostAttrs=Cr(x.hostAttrs,h=Cr(h,x.hostAttrs))}}(g)}function z(r){return r===co?{}:r===Ci?[]:r}function U(r,c){const h=r.viewQuery;r.viewQuery=h?(g,x)=>{c(g,x),h(g,x)}:c}function G(r,c){const h=r.contentQueries;r.contentQueries=h?(g,x,M)=>{c(g,x,M),h(g,x,M)}:c}function q(r,c){const h=r.hostBindings;r.hostBindings=h?(g,x)=>{c(g,x),h(g,x)}:c}function Ke(r){const c=r.inputConfig,h={};for(const g in c)if(c.hasOwnProperty(g)){const x=c[g];Array.isArray(x)&&x[2]&&(h[g]=x[2])}r.inputTransforms=h}function kt(r){return!!xt(r)&&(Array.isArray(r)||!(r instanceof Map)&&Symbol.iterator in r)}function xt(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function Gt(r,c,h){return!Object.is(r[c],h)&&(r[c]=h,!0)}function jt(r,c,h,g){const x=Bt();return Gt(x,Il(),c)&&(vi(),Fs(Mr(),x,r,c,h,g)),jt}function Bn(r,c,h,g){return Gt(r,Il(),h)?c+Nt(h)+g:di}function bw(r,c,h,g,x,M,O,L){const V=Bt(),Y=vi(),te=r+vn,me=Y.firstCreatePass?function xC(r,c,h,g,x,M,O,L,V){const Y=c.consts,te=Ed(c,r,4,O||null,Ma(Y,L));pp(c,h,te,Ma(Y,V)),Po(c,te);const me=te.tView=qh(2,te,g,x,M,c.directiveRegistry,c.pipeRegistry,null,c.schemas,Y,null);return null!==c.queries&&(c.queries.template(c,te),me.queries=c.queries.embeddedTView(te)),te}(te,Y,V,c,h,g,x,M,O):Y.data[te];ls(me,!1);const Fe=Mb(Y,V,me,r);sh()&&Fl(Y,V,Fe,me),Ro(Fe,V),mp(V,V[te]=j_(Fe,V,Fe,me)),nc(me)&&Cd(Y,V,me),null!=O&&_u(V,me,L)}let Mb=function Db(r,c,h,g){return fr(!0),c[Un].createComment("")};function qv(r,c,h){const g=Bt();return Gt(g,Il(),c)&&to(vi(),Mr(),g,r,c,g[Un],h,!1),qv}function Yv(r,c,h,g,x){const O=x?"class":"style";sg(r,h,c.inputs[O],O,g)}function Xv(r,c,h,g){const x=Bt(),M=vi(),O=vn+r,L=x[Un],V=M.firstCreatePass?function ww(r,c,h,g,x,M){const O=c.consts,V=Ed(c,r,2,g,Ma(O,x));return pp(c,h,V,Ma(O,M)),null!==V.attrs&&ml(V,V.attrs,!1),null!==V.mergedAttrs&&ml(V,V.mergedAttrs,!0),null!==c.queries&&c.queries.elementStart(c,V),V}(O,M,x,c,h,g):M.data[O],Y=TC(M,x,V,L,c,r);x[O]=Y;const te=nc(V);return ls(V,!0),lu(L,Y,V),32!=(32&V.flags)&&sh()&&Fl(M,x,Y,V),0===function uo(){return Kn.lFrame.elementDepthCount}()&&Ro(Y,x),function rc(){Kn.lFrame.elementDepthCount++}(),te&&(Cd(M,x,V),gu(M,V,x)),null!==g&&_u(x,V),Xv}function Kv(){let r=Qr();qc()?function Qu(){Kn.lFrame.isParent=!1}():(r=r.parent,ls(r,!1));const c=r;(function Jp(r){return Kn.skipHydrationRootTNode===r})(c)&&function Vy(){Kn.skipHydrationRootTNode=null}(),function Ju(){Kn.lFrame.elementDepthCount--}();const h=vi();return h.firstCreatePass&&(Po(h,r),kc(r)&&h.queries.elementEnd(r)),null!=c.classesWithoutHost&&function X(r){return 0!=(8&r.flags)}(c)&&Yv(h,c,Bt(),c.classesWithoutHost,!0),null!=c.stylesWithoutHost&&function ee(r){return 0!=(16&r.flags)}(c)&&Yv(h,c,Bt(),c.stylesWithoutHost,!1),Kv}function Sb(r,c,h,g){return Xv(r,c,h,g),Kv(),Sb}let TC=(r,c,h,g,x,M)=>(fr(!0),yh(g,x,function Xo(){return Kn.lFrame.currentNamespace}()));function Sw(){return Bt()}function Iw(r){return!!r&&"function"==typeof r.then}function Aw(r){return!!r&&"function"==typeof r.subscribe}function Ab(r,c,h,g){const x=Bt(),M=vi(),O=Qr();return function Ow(r,c,h,g,x,M,O){const L=nc(g),Y=r.firstCreatePass&&$_(r),te=c[br],me=Xh(c);let Fe=!0;if(3&g.type||O){const Xt=Zr(g,c),pn=O?O(Xt):Xt,kn=me.length,Vt=O?Di=>O(Zi(Di[g.index])):g.index;let hi=null;if(!O&&L&&(hi=function DC(r,c,h,g){const x=r.cleanup;if(null!=x)for(let M=0;M<x.length-1;M+=2){const O=x[M];if(O===h&&x[M+1]===g){const L=c[wl],V=x[M+2];return L.length>V?L[V]:null}"string"==typeof O&&(M+=2)}return null}(r,c,x,g.index)),null!==hi)(hi.__ngLastListenerFn__||hi).__ngNextListenerFn__=M,hi.__ngLastListenerFn__=M,Fe=!1;else{M=Pb(g,c,te,M,!1);const Di=h.listen(pn,x,M);me.push(M,Di),Y&&Y.push(x,Vt,kn,kn+1)}}else M=Pb(g,c,te,M,!1);const qe=g.outputs;let St;if(Fe&&null!==qe&&(St=qe[x])){const Xt=St.length;if(Xt)for(let pn=0;pn<Xt;pn+=2){const ar=c[St[pn]][St[pn+1]].subscribe(M),ja=me.length;me.push(M,ar),Y&&Y.push(x,g.index,ja,-(ja+1))}}}(M,x,x[Un],O,r,c,g),Ab}function Rw(r,c,h,g){try{return So(6,c,h),!1!==h(g)}catch(x){return H_(r,x),!1}finally{So(7,c,h)}}function Pb(r,c,h,g,x){return function M(O){if(O===Function)return g;Uh(r.componentOffset>-1?Ao(r.index,c):c);let V=Rw(c,h,g,O),Y=M.__ngNextListenerFn__;for(;Y;)V=Rw(c,h,Y,O)&&V,Y=Y.__ngNextListenerFn__;return x&&!1===V&&O.preventDefault(),V}}function Jv(r=1){return function Ef(r){return(Kn.lFrame.contextLView=function sc(r,c){for(;r>0;)c=c[Zo],r--;return c}(r,Kn.lFrame.contextLView))[br]}(r)}function Qv(r,c,h){return J_(r,"",c,"",h),Qv}function J_(r,c,h,g,x){const M=Bt(),O=Bn(M,c,h,g);return O!==di&&to(vi(),Mr(),M,r,O,M[Un],x,!1),J_}function Cp(r,c){return r<<17|c<<2}function Tp(r){return r>>17&32767}function Nw(r){return 2|r}function hg(r){return(131068&r)>>2}function Bw(r,c){return-131069&r|c<<2}function Mp(r){return 1|r}function Vw(r,c,h,g,x){const M=r[h+1],O=null===c;let L=g?Tp(M):hg(M),V=!1;for(;0!==L&&(!1===V||O);){const te=r[L+1];OC(r[L],c)&&(V=!0,r[L+1]=g?Mp(te):Nw(te)),L=g?Tp(te):hg(te)}V&&(r[h+1]=g?Nw(M):Mp(M))}function OC(r,c){return null===r||null==c||(Array.isArray(r)?r[1]:r)===c||!(!Array.isArray(r)||"string"!=typeof c)&&fa(r,c)>=0}function Fb(r,c){return function Gl(r,c,h,g){const x=Bt(),M=vi(),O=function ho(r){const c=Kn.lFrame,h=c.bindingIndex;return c.bindingIndex=c.bindingIndex+r,h}(2);M.firstUpdatePass&&function Kw(r,c,h,g){const x=r.data;if(null===x[h+1]){const M=x[Wr()],O=function Xw(r,c){return c>=r.expandoStartIndex}(r,h);(function za(r,c){return 0!=(r.flags&(c?8:16))})(M,g)&&null===c&&!O&&(c=!1),c=function n0(r,c,h,g){const x=function nm(r){const c=Kn.lFrame.currentDirectiveIndex;return-1===c?null:r[c]}(r);let M=g?c.residualClasses:c.residualStyles;if(null===x)0===(g?c.classBindings:c.styleBindings)&&(h=pg(h=r0(null,r,c,h,g),c.attrs,g),M=null);else{const O=c.directiveStylingLast;if(-1===O||r[O]!==x)if(h=r0(x,r,c,h,g),null===M){let V=function _l(r,c,h){const g=h?c.classBindings:c.styleBindings;if(0!==hg(g))return r[Tp(g)]}(r,c,g);void 0!==V&&Array.isArray(V)&&(V=r0(null,r,c,V[1],g),V=pg(V,c.attrs,g),function NC(r,c,h,g){r[Tp(h?c.classBindings:c.styleBindings)]=g}(r,c,g,V))}else M=function bD(r,c,h){let g;const x=c.directiveEnd;for(let M=1+c.directiveStylingLast;M<x;M++)g=pg(g,r[M].hostAttrs,h);return pg(g,c.attrs,h)}(r,c,g)}return void 0!==M&&(g?c.residualClasses=M:c.residualStyles=M),h}(x,M,c,g),function AC(r,c,h,g,x,M){let O=M?c.classBindings:c.styleBindings,L=Tp(O),V=hg(O);r[g]=h;let te,Y=!1;if(Array.isArray(h)?(te=h[1],(null===te||fa(h,te)>0)&&(Y=!0)):te=h,x)if(0!==V){const Fe=Tp(r[L+1]);r[g+1]=Cp(Fe,L),0!==Fe&&(r[Fe+1]=Bw(r[Fe+1],g)),r[L+1]=function gD(r,c){return 131071&r|c<<17}(r[L+1],g)}else r[g+1]=Cp(L,0),0!==L&&(r[L+1]=Bw(r[L+1],g)),L=g;else r[g+1]=Cp(V,0),0===L?L=g:r[V+1]=Bw(r[V+1],g),V=g;Y&&(r[g+1]=Nw(r[g+1])),Vw(r,te,g,!0),Vw(r,te,g,!1),function PC(r,c,h,g,x){const M=x?r.residualClasses:r.residualStyles;null!=M&&"string"==typeof c&&fa(M,c)>=0&&(h[g+1]=Mp(h[g+1]))}(c,te,r,g,M),O=Cp(L,V),M?c.classBindings=O:c.styleBindings=O}(x,M,c,h,O,g)}}(M,r,O,g),c!==di&&Gt(x,O,c)&&function Jw(r,c,h,g,x,M,O,L){if(!(3&c.type))return;const V=r.data,Y=V[L+1],te=function _D(r){return 1==(1&r)}(Y)?Qw(V,c,h,x,hg(Y),O):void 0;ey(te)||(ey(M)||function t0(r){return 2==(2&r)}(Y)&&(M=Qw(V,null,h,x,L,O)),function rb(r,c,h,g,x){if(c)x?r.addClass(h,g):r.removeClass(h,g);else{let M=-1===g.indexOf("-")?void 0:ru.DashCase;null==x?r.removeStyle(h,g,M):("string"==typeof x&&x.endsWith("!important")&&(x=x.slice(0,-10),M|=ru.Important),r.setStyle(h,g,x,M))}}(g,O,Sl(Wr(),h),x,M))}(M,M.data[Wr()],x,x[Un],r,x[O+1]=function ty(r,c){return null==r||""===r||("string"==typeof c?r+=c:"object"==typeof r&&(r=Qe(Ll(r)))),r}(c,h),g,O)}(r,c,null,!0),Fb}function r0(r,c,h,g,x){let M=null;const O=h.directiveEnd;let L=h.directiveStylingLast;for(-1===L?L=h.directiveStart:L++;L<O&&(M=c[L],g=pg(g,M.hostAttrs,x),M!==r);)L++;return null!==r&&(h.directiveStylingLast=L),g}function pg(r,c,h){const g=h?1:2;let x=-1;if(null!==c)for(let M=0;M<c.length;M++){const O=c[M];"number"==typeof O?x=O:x===g&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),ha(r,O,!!h||c[++M]))}return void 0===r?null:r}function Qw(r,c,h,g,x,M){const O=null===c;let L;for(;x>0;){const V=r[x],Y=Array.isArray(V),te=Y?V[1]:V,me=null===te;let Fe=h[x+1];Fe===di&&(Fe=me?Ci:void 0);let qe=me?td(Fe,g):te===g?Fe:void 0;if(Y&&!ey(qe)&&(qe=td(V,g)),ey(qe)&&(L=qe,O))return L;const St=r[x+1];x=O?Tp(St):hg(St)}if(null!==c){let V=M?c.residualClasses:c.residualStyles;null!=V&&(L=td(V,g))}return L}function ey(r){return void 0!==r}function Nb(r,c=""){const h=Bt(),g=vi(),x=r+vn,M=g.firstCreatePass?Ed(g,x,1,c,null):g.data[x],O=ny(g,h,M,c,r);h[x]=O,sh()&&Fl(g,h,O,M),ls(M,!1)}let ny=(r,c,h,g,x)=>(fr(!0),function Ff(r,c){return r.createText(c)}(c[Un],g));function s0(r){return iy("",r,""),s0}function iy(r,c,h){const g=Bt(),x=Bn(g,r,c,h);return x!==di&&function Fo(r,c,h){const g=Sl(c,r);!function Qg(r,c,h){r.setValue(c,h)}(r[Un],g,h)}(g,Wr(),x),iy}const Dp=void 0;var JC=["en",[["a","p"],["AM","PM"],Dp],[["AM","PM"],Dp,Dp],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Dp,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Dp,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Dp,"{1} 'at' {0}",Dp],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function KC(r){const h=Math.floor(Math.abs(r)),g=r.toString().replace(/^[^.]*\.?/,"").length;return 1===h&&0===g?1:5}];let mg={};function Gb(r){const c=function b1(r){return r.toLowerCase().replace(/_/g,"-")}(r);let h=v1(c);if(h)return h;const g=c.split("-")[0];if(h=v1(g),h)return h;if("en"===g)return JC;throw new it(701,!1)}function y1(r){return Gb(r)[Su.PluralCase]}function v1(r){return r in mg||(mg[r]=$i.ng&&$i.ng.common&&$i.ng.common.locales&&$i.ng.common.locales[r]),mg[r]}var Su=function(r){return r[r.LocaleId=0]="LocaleId",r[r.DayPeriodsFormat=1]="DayPeriodsFormat",r[r.DayPeriodsStandalone=2]="DayPeriodsStandalone",r[r.DaysFormat=3]="DaysFormat",r[r.DaysStandalone=4]="DaysStandalone",r[r.MonthsFormat=5]="MonthsFormat",r[r.MonthsStandalone=6]="MonthsStandalone",r[r.Eras=7]="Eras",r[r.FirstDayOfWeek=8]="FirstDayOfWeek",r[r.WeekendRange=9]="WeekendRange",r[r.DateFormat=10]="DateFormat",r[r.TimeFormat=11]="TimeFormat",r[r.DateTimeFormat=12]="DateTimeFormat",r[r.NumberSymbols=13]="NumberSymbols",r[r.NumberFormats=14]="NumberFormats",r[r.CurrencyCode=15]="CurrencyCode",r[r.CurrencySymbol=16]="CurrencySymbol",r[r.CurrencyName=17]="CurrencyName",r[r.Currencies=18]="Currencies",r[r.Directionality=19]="Directionality",r[r.PluralCase=20]="PluralCase",r[r.ExtraData=21]="ExtraData",r}(Su||{});const fn="en-US";let Zb=fn;function vg(r,c,h,g,x){if(r=Ot(r),Array.isArray(r))for(let M=0;M<r.length;M++)vg(r[M],c,h,g,x);else{const M=vi(),O=Bt(),L=Qr();let V=Nl(r)?r:Ot(r.provide);const Y=Ah(r),te=1048575&L.providerIndexes,me=L.directiveStart,Fe=L.providerIndexes>>20;if(Nl(r)||!r.multi){const qe=new R(Y,x,Tc),St=Op(V,c,x?te:te+Fe,me);-1===St?(bt(At(L,O),M,V),b0(M,r,c.length),c.push(V),L.directiveStart++,L.directiveEnd++,x&&(L.providerIndexes+=1048576),h.push(qe),O.push(qe)):(h[St]=qe,O[St]=qe)}else{const qe=Op(V,c,te+Fe,me),St=Op(V,c,te,te+Fe),pn=St>=0&&h[St];if(x&&!pn||!x&&!(qe>=0&&h[qe])){bt(At(L,O),M,V);const kn=function Z1(r,c,h,g,x){const M=new R(r,h,Tc);return M.multi=[],M.index=c,M.componentProviders=0,uy(M,x,g&&!h),M}(x?ro:x0,h.length,x,g,Y);!x&&pn&&(h[St].providerFactory=kn),b0(M,r,c.length,0),c.push(V),L.directiveStart++,L.directiveEnd++,x&&(L.providerIndexes+=1048576),h.push(kn),O.push(kn)}else b0(M,r,qe>-1?qe:St,uy(h[x?St:qe],Y,!x&&g));!x&&g&&pn&&h[St].componentProviders++}}}function b0(r,c,h,g){const x=Nl(c),M=function hv(r){return!!r.useClass}(c);if(x||M){const V=(M?Ot(c.useClass):c).prototype.ngOnDestroy;if(V){const Y=r.destroyHooks||(r.destroyHooks=[]);if(!x&&c.multi){const te=Y.indexOf(h);-1===te?Y.push(h,[g,V]):Y[te+1].push(g,V)}else Y.push(h,V)}}}function uy(r,c,h){return h&&r.componentProviders++,r.multi.push(c)-1}function Op(r,c,h,g){for(let x=h;x<g;x++)if(c[x]===r)return x;return-1}function x0(r,c,h,g){return sx(this.multi,[])}function ro(r,c,h,g){const x=this.multi;let M;if(this.providerFactory){const O=this.providerFactory.componentProviders,L=an(h,h[cn],this.providerFactory.index,g);M=L.slice(0,O),sx(x,M);for(let V=O;V<L.length;V++)M.push(L[V])}else M=[],sx(x,M);return M}function sx(r,c){for(let h=0;h<r.length;h++)c.push((0,r[h])());return c}function W1(r,c=[]){return h=>{h.providersResolver=(g,x)=>function G1(r,c,h){const g=vi();if(g.firstCreatePass){const x=Hs(r);vg(h,g.data,g.blueprint,x,!0),vg(c,g.data,g.blueprint,x,!1)}}(g,x?x(r):r,c)}}class tf{}class ax{}function q1(r,c){return new w0(r,c??null,[])}class w0 extends tf{constructor(c,h,g){super(),this._parent=h,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new q_(this);const x=Xi(c);this._bootstrapComponents=zl(x.bootstrap),this._r3Injector=Sv(c,h,[{provide:tf,useValue:this},{provide:wd,useValue:this.componentFactoryResolver},...g],Qe(c),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(c)}get injector(){return this._r3Injector}destroy(){const c=this._r3Injector;!c.destroyed&&c.destroy(),this.destroyCbs.forEach(h=>h()),this.destroyCbs=null}onDestroy(c){this.destroyCbs.push(c)}}class E0 extends ax{constructor(c){super(),this.moduleType=c}create(c){return new w0(this.moduleType,c,[])}}class Y1 extends tf{constructor(c){super(),this.componentFactoryResolver=new q_(this),this.instance=null;const h=new Ih([...c.providers,{provide:tf,useValue:this},{provide:wd,useValue:this.componentFactoryResolver}],c.parent||ep(),c.debugName,new Set(["environment"]));this.injector=h,c.runEnvironmentInitializers&&h.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(c){this.injector.onDestroy(c)}}function X1(r,c,h=null){return new Y1({providers:r,parent:c,debugName:h,runEnvironmentInitializers:!0}).injector}let K1=(()=>{var r;class c{constructor(g){this._injector=g,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(g){if(!g.standalone)return null;if(!this.cachedInjectors.has(g)){const x=uv(0,g.type),M=x.length>0?X1([x],this._injector,`Standalone[${g.type.name}]`):null;this.cachedInjectors.set(g,M)}return this.cachedInjectors.get(g)}ngOnDestroy(){try{for(const g of this.cachedInjectors.values())null!==g&&g.destroy()}finally{this.cachedInjectors.clear()}}}return(r=c).\u0275prov=On({token:r,providedIn:"environment",factory:()=>new r(Qn(cl))}),c})();function J1(r){r.getStandaloneInjector=c=>c.get(K1).getOrCreateStandaloneInjector(r)}function sE(r,c,h,g,x,M){const O=c+h;return Gt(r,O,x)?function Rt(r,c,h){return r[c]=h}(r,O+1,M?g.call(M,x):g(x)):function Au(r,c){const h=r[c];return h===di?void 0:h}(r,O+1)}function lE(r,c){const h=vi();let g;const x=r+vn;h.firstCreatePass?(g=function wT(r,c){if(c)for(let h=c.length-1;h>=0;h--){const g=c[h];if(r===g.name)return g}}(c,h.pipeRegistry),h.data[x]=g,g.onDestroy&&(h.destroyHooks??=[]).push(x,g.onDestroy)):g=h.data[x];const M=g.factory||(g.factory=qa(g.type)),L=Hr(Tc);try{const V=ge(!1),Y=M();return ge(V),function EC(r,c,h,g){h>=r.data.length&&(r.data[h]=null,r.blueprint[h]=null),c[h]=g}(h,Bt(),x,Y),Y}finally{Hr(L)}}function uE(r,c,h){const g=r+vn,x=Bt(),M=function Io(r,c){return r[c]}(x,g);return function hy(r,c){return r[cn].data[c].pure}(x,g)?sE(x,function Yo(){const r=Kn.lFrame;let c=r.bindingRootIndex;return-1===c&&(c=r.bindingRootIndex=r.tView.bindingStartIndex),c}(),c,M.transform,h,M):M.transform(h)}function dE(){return this._results[Symbol.iterator]()}class hx{get changes(){return this._changes||(this._changes=new hl)}constructor(c=!1){this._emitDistinctChangesOnly=c,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const h=hx.prototype;h[Symbol.iterator]||(h[Symbol.iterator]=dE)}get(c){return this._results[c]}map(c){return this._results.map(c)}filter(c){return this._results.filter(c)}find(c){return this._results.find(c)}reduce(c,h){return this._results.reduce(c,h)}forEach(c){this._results.forEach(c)}some(c){return this._results.some(c)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(c,h){const g=this;g.dirty=!1;const x=function go(r){return r.flat(Number.POSITIVE_INFINITY)}(c);(this._changesDetected=!function im(r,c,h){if(r.length!==c.length)return!1;for(let g=0;g<r.length;g++){let x=r[g],M=c[g];if(h&&(x=h(x),M=h(M)),M!==x)return!1}return!0}(g._results,x,h))&&(g._results=x,g.length=x.length,g.last=x[this.length-1],g.first=x[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function ST(r,c,h,g=!0){const x=c[cn];if(function t_(r,c,h,g){const x=Gr+g,M=h.length;g>0&&(h[x-1][Ho]=c),g<M-Gr?(c[Ho]=h[x],cc(h,Gr+g,c)):(h.push(c),c[Ho]=null),c[hr]=h;const O=c[js];null!==O&&h!==O&&function Rl(r,c){const h=r[tc];c[Tr]!==c[hr][hr][Tr]&&(r[ff]=!0),null===h?r[tc]=[c]:h.push(c)}(O,c);const L=c[Wo];null!==L&&L.insertView(r),c[In]|=128}(x,c,r,h),g){const M=i_(h,r),O=c[Un],L=Lf(O,r[qo]);null!==L&&function Jy(r,c,h,g,x,M){g[vr]=x,g[Ar]=c,bh(r,g,h,1,x,M)}(x,r[Ar],O,c,L,M)}}let Eg=(()=>{class c{}return c.__NG_ELEMENT_ID__=PT,c})();const IT=Eg,AT=class extends IT{constructor(c,h,g){super(),this._declarationLView=c,this._declarationTContainer=h,this.elementRef=g}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(c,h){return this.createEmbeddedViewImpl(c,h)}createEmbeddedViewImpl(c,h,g){const x=function DT(r,c,h,g){const x=c.tView,L=Zh(r,x,h,4096&r[In]?4096:16,null,c,null,null,null,g?.injector??null,g?.hydrationInfo??null);L[js]=r[c.index];const Y=r[Wo];return null!==Y&&(L[Wo]=Y.createEmbeddedView(x)),es(x,L,h),L}(this._declarationLView,this._declarationTContainer,c,{injector:h,hydrationInfo:g});return new xu(x)}};function PT(){return C0(Qr(),Bt())}function C0(r,c){return 4&r.type?new AT(c,r,rp(r,c)):null}let fy=(()=>{class c{}return c.__NG_ELEMENT_ID__=NT,c})();function NT(){return gE(Qr(),Bt())}const Wl=fy,Fp=class extends Wl{constructor(c,h,g){super(),this._lContainer=c,this._hostTNode=h,this._hostLView=g}get element(){return rp(this._hostTNode,this._hostLView)}get injector(){return new ri(this._hostTNode,this._hostLView)}get parentInjector(){const c=nt(this._hostTNode,this._hostLView);if(ae(c)){const h=oe(c,this._hostLView),g=ce(c);return new ri(h[cn].data[g+8],h)}return new ri(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(c){const h=mE(this._lContainer);return null!==h&&h[c]||null}get length(){return this._lContainer.length-Gr}createEmbeddedView(c,h,g){let x,M;"number"==typeof g?x=g:null!=g&&(x=g.index,M=g.injector);const L=c.createEmbeddedViewImpl(h||{},M,null);return this.insertImpl(L,x,false),L}createComponent(c,h,g,x,M){const O=c&&!function Qa(r){return"function"==typeof r}(c);let L;if(O)L=h;else{const Xt=h||{};L=Xt.index,g=Xt.injector,x=Xt.projectableNodes,M=Xt.environmentInjector||Xt.ngModuleRef}const V=O?c:new wu(Tn(c)),Y=g||this.parentInjector;if(!M&&null==V.ngModule){const pn=(O?Y:this.parentInjector).get(cl,null);pn&&(M=pn)}Tn(V.componentType??{});const qe=V.create(Y,x,null,M);return this.insertImpl(qe.hostView,L,false),qe}insert(c,h){return this.insertImpl(c,h,!1)}insertImpl(c,h,g){const x=c._lView;if(function $c(r){return Br(r[hr])}(x)){const V=this.indexOf(c);if(-1!==V)this.detach(V);else{const Y=x[hr],te=new Fp(Y,Y[Ar],Y[hr]);te.detach(te.indexOf(c))}}const O=this._adjustIndex(h),L=this._lContainer;return ST(L,x,O,!g),c.attachToViewContainerRef(),cc(Nd(L),O,c),c}move(c,h){return this.insert(c,h)}indexOf(c){const h=mE(this._lContainer);return null!==h?h.indexOf(c):-1}remove(c){const h=this._adjustIndex(c,-1),g=Qo(this._lContainer,h);g&&(qs(Nd(this._lContainer),h),Is(g[cn],g))}detach(c){const h=this._adjustIndex(c,-1),g=Qo(this._lContainer,h);return g&&null!=qs(Nd(this._lContainer),h)?new xu(g):null}_adjustIndex(c,h=0){return c??this.length+h}};function mE(r){return r[8]}function Nd(r){return r[8]||(r[8]=[])}function gE(r,c){let h;const g=c[r.index];return Br(g)?h=g:(h=j_(g,c,null,r),c[r.index]=h,mp(c,h)),px(h,c,r,g),new Fp(h,r,c)}let px=function mx(r,c,h,g){if(r[qo])return;let x;x=8&h.type?Zi(g):function nf(r,c){const h=r[Un],g=h.createComment(""),x=Zr(c,r);return pa(h,Lf(h,x),g,function ib(r,c){return r.nextSibling(c)}(h,x),!1),g}(c,h),r[qo]=x};class rf{constructor(c){this.queryList=c,this.matches=null}clone(){return new rf(this.queryList)}setDirty(){this.queryList.setDirty()}}class gx{constructor(c=[]){this.queries=c}createEmbeddedView(c){const h=c.queries;if(null!==h){const g=null!==c.contentQueries?c.contentQueries[0]:h.length,x=[];for(let M=0;M<g;M++){const O=h.getByIndex(M);x.push(this.queries[O.indexInDeclarationView].clone())}return new gx(x)}return null}insertView(c){this.dirtyQueriesWithMatches(c)}detachView(c){this.dirtyQueriesWithMatches(c)}dirtyQueriesWithMatches(c){for(let h=0;h<this.queries.length;h++)null!==Yl(c,h).matches&&this.queries[h].setDirty()}}class oo{constructor(c,h,g=null){this.predicate=c,this.flags=h,this.read=g}}class Cg{constructor(c=[]){this.queries=c}elementStart(c,h){for(let g=0;g<this.queries.length;g++)this.queries[g].elementStart(c,h)}elementEnd(c){for(let h=0;h<this.queries.length;h++)this.queries[h].elementEnd(c)}embeddedTView(c){let h=null;for(let g=0;g<this.length;g++){const x=null!==h?h.length:0,M=this.getByIndex(g).embeddedTView(c,x);M&&(M.indexInDeclarationView=g,null!==h?h.push(M):h=[M])}return null!==h?new Cg(h):null}template(c,h){for(let g=0;g<this.queries.length;g++)this.queries[g].template(c,h)}getByIndex(c){return this.queries[c]}get length(){return this.queries.length}track(c){this.queries.push(c)}}class M0{constructor(c,h=-1){this.metadata=c,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=h}elementStart(c,h){this.isApplyingToNode(h)&&this.matchTNode(c,h)}elementEnd(c){this._declarationNodeIndex===c.index&&(this._appliesToNextNode=!1)}template(c,h){this.elementStart(c,h)}embeddedTView(c,h){return this.isApplyingToNode(c)?(this.crossesNgTemplate=!0,this.addMatch(-c.index,h),new M0(this.metadata)):null}isApplyingToNode(c){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const h=this._declarationNodeIndex;let g=c.parent;for(;null!==g&&8&g.type&&g.index!==h;)g=g.parent;return h===(null!==g?g.index:-1)}return this._appliesToNextNode}matchTNode(c,h){const g=this.metadata.predicate;if(Array.isArray(g))for(let x=0;x<g.length;x++){const M=g[x];this.matchTNodeWithReadOption(c,h,zT(h,M)),this.matchTNodeWithReadOption(c,h,Rn(h,c,M,!1,!1))}else g===Eg?4&h.type&&this.matchTNodeWithReadOption(c,h,-1):this.matchTNodeWithReadOption(c,h,Rn(h,c,g,!1,!1))}matchTNodeWithReadOption(c,h,g){if(null!==g){const x=this.metadata.read;if(null!==x)if(x===Bh||x===fy||x===Eg&&4&h.type)this.addMatch(h.index,-2);else{const M=Rn(h,c,x,!1,!1);null!==M&&this.addMatch(h.index,M)}else this.addMatch(h.index,g)}}addMatch(c,h){null===this.matches?this.matches=[c,h]:this.matches.push(c,h)}}function zT(r,c){const h=r.localNames;if(null!==h)for(let g=0;g<h.length;g+=2)if(h[g]===c)return h[g+1];return null}function _x(r,c,h,g){return-1===h?function VT(r,c){return 11&r.type?rp(r,c):4&r.type?C0(r,c):null}(c,r):-2===h?function _E(r,c,h){return h===Bh?rp(c,r):h===Eg?C0(c,r):h===fy?gE(c,r):void 0}(r,c,g):an(r,r[cn],h,c)}function yE(r,c,h,g){const x=c[Wo].queries[g];if(null===x.matches){const M=r.data,O=h.matches,L=[];for(let V=0;V<O.length;V+=2){const Y=O[V];L.push(Y<0?null:_x(c,M[Y],O[V+1],h.metadata.read))}x.matches=L}return x.matches}function yx(r,c,h,g){const x=r.queries.getByIndex(h),M=x.matches;if(null!==M){const O=yE(r,c,x,h);for(let L=0;L<M.length;L+=2){const V=M[L];if(V>0)g.push(O[L/2]);else{const Y=M[L+1],te=c[-V];for(let me=Gr;me<te.length;me++){const Fe=te[me];Fe[js]===Fe[hr]&&yx(Fe[cn],Fe,Y,g)}if(null!==te[tc]){const me=te[tc];for(let Fe=0;Fe<me.length;Fe++){const qe=me[Fe];yx(qe[cn],qe,Y,g)}}}}}return g}function ql(r){const c=Bt(),h=vi(),g=Bg();cs(g+1);const x=Yl(h,g);if(r.dirty&&function Wu(r){return 4==(4&r[In])}(c)===(2==(2&x.metadata.flags))){if(null===x.matches)r.reset([]);else{const M=x.crossesNgTemplate?yx(h,c,g,[]):yE(h,c,x,g);r.reset(M,mw),r.notifyOnChanges()}return!0}return!1}function ir(r,c,h,g){const x=vi();if(x.firstCreatePass){const M=Qr();(function bE(r,c,h){null===r.queries&&(r.queries=new Cg),r.queries.track(new M0(c,h))})(x,new oo(c,h,g),M.index),function xE(r,c){const h=r.contentQueries||(r.contentQueries=[]);c!==(h.length?h[h.length-1]:-1)&&h.push(r.queries.length-1,c)}(x,r),2==(2&h)&&(x.staticContentQueries=!0)}!function vx(r,c,h){const g=new hx(4==(4&h));(function ks(r,c,h,g){const x=Xh(c);x.push(h),r.firstCreatePass&&$_(r).push(g,x.length-1)})(r,c,g,g.destroy),null===c[Wo]&&(c[Wo]=new gx),c[Wo].queries.push(new rf(g))}(x,Bt(),h)}function jT(){return function vE(r,c){return r[Wo].queries[c].queryList}(Bt(),Bg())}function Yl(r,c){return r.queries.getByIndex(c)}function bx(r){return!!Xi(r)}const kE=new zi("Application Initializer");let P0=(()=>{var r;class c{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((g,x)=>{this.resolve=g,this.reject=x}),this.appInits=li(kE,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const g=[];for(const M of this.appInits){const O=M();if(Iw(O))g.push(O);else if(Aw(O)){const L=new Promise((V,Y)=>{O.subscribe({complete:V,error:Y})});g.push(L)}}const x=()=>{this.done=!0,this.resolve()};Promise.all(g).then(()=>{x()}).catch(M=>{this.reject(M)}),0===g.length&&x(),this.initialized=!0}}return(r=c).\u0275fac=function(g){return new(g||r)},r.\u0275prov=On({token:r,factory:r.\u0275fac,providedIn:"root"}),c})(),FE=(()=>{var r;class c{log(g){console.log(g)}warn(g){console.warn(g)}}return(r=c).\u0275fac=function(g){return new(g||r)},r.\u0275prov=On({token:r,factory:r.\u0275fac,providedIn:"platform"}),c})();const _y=new zi("LocaleId",{providedIn:"root",factory:()=>li(_y,$n.Optional|$n.SkipSelf)||function eM(){return typeof $localize<"u"&&$localize.locale||fn}()}),tM=new zi("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});let NE=(()=>{var r;class c{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ue.X(!1)}add(){this.hasPendingTasks.next(!0);const g=this.taskId++;return this.pendingTasks.add(g),g}remove(g){this.pendingTasks.delete(g),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return(r=c).\u0275fac=function(g){return new(g||r)},r.\u0275prov=On({token:r,factory:r.\u0275fac,providedIn:"root"}),c})();class nM{constructor(c,h){this.ngModuleFactory=c,this.componentFactories=h}}let iM=(()=>{var r;class c{compileModuleSync(g){return new E0(g)}compileModuleAsync(g){return Promise.resolve(this.compileModuleSync(g))}compileModuleAndAllComponentsSync(g){const x=this.compileModuleSync(g),O=zl(Xi(g).declarations).reduce((L,V)=>{const Y=Tn(V);return Y&&L.push(new wu(Y)),L},[]);return new nM(x,O)}compileModuleAndAllComponentsAsync(g){return Promise.resolve(this.compileModuleAndAllComponentsSync(g))}clearCache(){}clearCacheFor(g){}getModuleId(g){}}return(r=c).\u0275fac=function(g){return new(g||r)},r.\u0275prov=On({token:r,factory:r.\u0275fac,providedIn:"root"}),c})();const UE=new zi(""),wM=new zi("");let R0,EM=(()=>{var r;class c{constructor(g,x,M){this._ngZone=g,this.registry=x,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,R0||(function sf(r){R0=r}(M),M.addToWindow(x)),this._watchAngularEvents(),g.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Xr.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let g=this._callbacks.pop();clearTimeout(g.timeoutId),g.doneCb(this._didWork)}this._didWork=!1});else{let g=this.getPendingTasks();this._callbacks=this._callbacks.filter(x=>!x.updateCb||!x.updateCb(g)||(clearTimeout(x.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(g=>({source:g.source,creationLocation:g.creationLocation,data:g.data})):[]}addCallback(g,x,M){let O=-1;x&&x>0&&(O=setTimeout(()=>{this._callbacks=this._callbacks.filter(L=>L.timeoutId!==O),g(this._didWork,this.getPendingTasks())},x)),this._callbacks.push({doneCb:g,timeoutId:O,updateCb:M})}whenStable(g,x,M){if(M&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(g,x,M),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(g){this.registry.registerApplication(g,this)}unregisterApplication(g){this.registry.unregisterApplication(g)}findProviders(g,x,M){return[]}}return(r=c).\u0275fac=function(g){return new(g||r)(Qn(Xr),Qn(jE),Qn(wM))},r.\u0275prov=On({token:r,factory:r.\u0275fac}),c})(),jE=(()=>{var r;class c{constructor(){this._applications=new Map}registerApplication(g,x){this._applications.set(g,x)}unregisterApplication(g){this._applications.delete(g)}unregisterAllApplications(){this._applications.clear()}getTestability(g){return this._applications.get(g)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(g,x=!0){return R0?.findTestabilityInTree(this,g,x)??null}}return(r=c).\u0275fac=function(g){return new(g||r)},r.\u0275prov=On({token:r,factory:r.\u0275fac,providedIn:"platform"}),c})(),Pu=null;const k0=new zi("AllowMultipleToken"),vy=new zi("PlatformDestroyListeners"),ba=new zi("appBootstrapListener");class Bp{constructor(c,h){this.name=c,this.token=h}}function Nx(r,c,h=[]){const g=`Platform: ${c}`,x=new zi(g);return(M=[])=>{let O=by();if(!O||O.injector.get(k0,!1)){const L=[...h,...M,{provide:x,useValue:!0}];r?r(L):function HE(r){if(Pu&&!Pu.get(k0,!1))throw new it(400,!1);(function F0(){!function Nc(r){Hu=r}(()=>{throw new it(600,!1)})})(),Pu=r;const c=r.get(ZE);(function MM(r){r.get(gv,null)?.forEach(h=>h())})(r)}(function DM(r=[],c){return dl.create({name:c,providers:[{provide:Pm,useValue:"platform"},{provide:vy,useValue:new Set([()=>Pu=null])},...r]})}(L,g))}return function GE(r){const c=by();if(!c)throw new it(401,!1);return c}()}}function by(){return Pu?.get(ZE)??null}let ZE=(()=>{var r;class c{constructor(g){this._injector=g,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(g,x){const M=function IM(r="zone.js",c){return"noop"===r?new Zm:"zone.js"===r?new Xr(c):r}(x?.ngZone,function Bx(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:r?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:r?.runCoalescing??!1}}({eventCoalescing:x?.ngZoneEventCoalescing,runCoalescing:x?.ngZoneRunCoalescing}));return M.run(()=>{const O=function uT(r,c,h){return new w0(r,c,h)}(g.moduleType,this.injector,function WE(r){return[{provide:Xr,useFactory:r},{provide:Sh,multi:!0,useFactory:()=>{const c=li(Vx,{optional:!0});return()=>c.initialize()}},{provide:N0,useFactory:zd},{provide:Rv,useFactory:Wm}]}(()=>M)),L=O.injector.get(Vl,null);return M.runOutsideAngular(()=>{const V=M.onError.subscribe({next:Y=>{L.handleError(Y)}});O.onDestroy(()=>{zp(this._modules,O),V.unsubscribe()})}),function L0(r,c,h){try{const g=h();return Iw(g)?g.catch(x=>{throw c.runOutsideAngular(()=>r.handleError(x)),x}):g}catch(g){throw c.runOutsideAngular(()=>r.handleError(g)),g}}(L,M,()=>{const V=O.injector.get(P0);return V.runInitializers(),V.donePromise.then(()=>(function Wb(r){yt(r,"Expected localeId to be defined"),"string"==typeof r&&(Zb=r.toLowerCase().replace(/_/g,"-"))}(O.injector.get(_y,fn)||fn),this._moduleDoBootstrap(O),O))})})}bootstrapModule(g,x=[]){const M=xy({},x);return function $E(r,c,h){const g=new E0(h);return Promise.resolve(g)}(0,0,g).then(O=>this.bootstrapModuleFactory(O,M))}_moduleDoBootstrap(g){const x=g.injector.get(Bd);if(g._bootstrapComponents.length>0)g._bootstrapComponents.forEach(M=>x.bootstrap(M));else{if(!g.instance.ngDoBootstrap)throw new it(-403,!1);g.instance.ngDoBootstrap(x)}this._modules.push(g)}onDestroy(g){this._destroyListeners.push(g)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new it(404,!1);this._modules.slice().forEach(x=>x.destroy()),this._destroyListeners.forEach(x=>x());const g=this._injector.get(vy,null);g&&(g.forEach(x=>x()),g.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return(r=c).\u0275fac=function(g){return new(g||r)(Qn(dl))},r.\u0275prov=On({token:r,factory:r.\u0275fac,providedIn:"platform"}),c})();function xy(r,c){return Array.isArray(c)?c.reduce(xy,r):{...r,...c}}let Bd=(()=>{var r;class c{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=li(N0),this.zoneIsStable=li(Rv),this.componentTypes=[],this.components=[],this.isStable=li(NE).hasPendingTasks.pipe((0,Le.w)(g=>g?(0,Ye.of)(!1):this.zoneIsStable),(0,Ae.x)(),(0,Ge.B)()),this._injector=li(cl)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(g,x){const M=g instanceof Vm;if(!this._injector.get(P0).done)throw!M&&as(g),new it(405,!1);let L;L=M?g:this._injector.get(wd).resolveComponentFactory(g),this.componentTypes.push(L.componentType);const V=function CM(r){return r.isBoundToModule}(L)?void 0:this._injector.get(tf),te=L.create(dl.NULL,[],x||L.selector,V),me=te.location.nativeElement,Fe=te.injector.get(UE,null);return Fe?.registerApplication(me),te.onDestroy(()=>{this.detachView(te.hostView),zp(this.components,te),Fe?.unregisterApplication(me)}),this._loadComponent(te),te}tick(){if(this._runningTick)throw new it(101,!1);try{this._runningTick=!0;for(let g of this._views)g.detectChanges()}catch(g){this.internalErrorHandler(g)}finally{this._runningTick=!1}}attachView(g){const x=g;this._views.push(x),x.attachToAppRef(this)}detachView(g){const x=g;zp(this._views,x),x.detachFromAppRef()}_loadComponent(g){this.attachView(g.hostView),this.tick(),this.components.push(g);const x=this._injector.get(ba,[]);x.push(...this._bootstrapListeners),x.forEach(M=>M(g))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(g=>g()),this._views.slice().forEach(g=>g.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(g){return this._destroyListeners.push(g),()=>zp(this._destroyListeners,g)}destroy(){if(this._destroyed)throw new it(406,!1);const g=this._injector;g.destroy&&!g.destroyed&&g.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return(r=c).\u0275fac=function(g){return new(g||r)},r.\u0275prov=On({token:r,factory:r.\u0275fac,providedIn:"root"}),c})();function zp(r,c){const h=r.indexOf(c);h>-1&&r.splice(h,1)}const N0=new zi("",{providedIn:"root",factory:()=>li(Vl).handleError.bind(void 0)});function zd(){const r=li(Xr),c=li(Vl);return h=>r.runOutsideAngular(()=>c.handleError(h))}let Vx=(()=>{var r;class c{constructor(){this.zone=li(Xr),this.applicationRef=li(Bd)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return(r=c).\u0275fac=function(g){return new(g||r)},r.\u0275prov=On({token:r,factory:r.\u0275fac,providedIn:"root"}),c})();function qE(){return!1}let Up=(()=>{class c{}return c.__NG_ELEMENT_ID__=Ey,c})();function Ey(r){return function PM(r,c,h){if(Tl(r)&&!h){const g=Ao(r.index,c);return new xu(g,g)}return 47&r.type?new xu(c[Tr],c):null}(Qr(),Bt(),16==(16&r))}class Cy{constructor(){}supports(c){return kt(c)}create(c){return new eC(c)}}const z0=(r,c)=>c;class eC{constructor(c){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=c||z0}forEachItem(c){let h;for(h=this._itHead;null!==h;h=h._next)c(h)}forEachOperation(c){let h=this._itHead,g=this._removalsHead,x=0,M=null;for(;h||g;){const O=!g||h&&h.currentIndex<Gx(g,x,M)?h:g,L=Gx(O,x,M),V=O.currentIndex;if(O===g)x--,g=g._nextRemoved;else if(h=h._next,null==O.previousIndex)x++;else{M||(M=[]);const Y=L-x,te=V-x;if(Y!=te){for(let Fe=0;Fe<Y;Fe++){const qe=Fe<M.length?M[Fe]:M[Fe]=0,St=qe+Fe;te<=St&&St<Y&&(M[Fe]=qe+1)}M[O.previousIndex]=te-Y}}L!==V&&c(O,L,V)}}forEachPreviousItem(c){let h;for(h=this._previousItHead;null!==h;h=h._nextPrevious)c(h)}forEachAddedItem(c){let h;for(h=this._additionsHead;null!==h;h=h._nextAdded)c(h)}forEachMovedItem(c){let h;for(h=this._movesHead;null!==h;h=h._nextMoved)c(h)}forEachRemovedItem(c){let h;for(h=this._removalsHead;null!==h;h=h._nextRemoved)c(h)}forEachIdentityChange(c){let h;for(h=this._identityChangesHead;null!==h;h=h._nextIdentityChange)c(h)}diff(c){if(null==c&&(c=[]),!kt(c))throw new it(900,!1);return this.check(c)?this:null}onDestroy(){}check(c){this._reset();let x,M,O,h=this._itHead,g=!1;if(Array.isArray(c)){this.length=c.length;for(let L=0;L<this.length;L++)M=c[L],O=this._trackByFn(L,M),null!==h&&Object.is(h.trackById,O)?(g&&(h=this._verifyReinsertion(h,M,O,L)),Object.is(h.item,M)||this._addIdentityChange(h,M)):(h=this._mismatch(h,M,O,L),g=!0),h=h._next}else x=0,function Tt(r,c){if(Array.isArray(r))for(let h=0;h<r.length;h++)c(r[h]);else{const h=r[Symbol.iterator]();let g;for(;!(g=h.next()).done;)c(g.value)}}(c,L=>{O=this._trackByFn(x,L),null!==h&&Object.is(h.trackById,O)?(g&&(h=this._verifyReinsertion(h,L,O,x)),Object.is(h.item,L)||this._addIdentityChange(h,L)):(h=this._mismatch(h,L,O,x),g=!0),h=h._next,x++}),this.length=x;return this._truncate(h),this.collection=c,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let c;for(c=this._previousItHead=this._itHead;null!==c;c=c._next)c._nextPrevious=c._next;for(c=this._additionsHead;null!==c;c=c._nextAdded)c.previousIndex=c.currentIndex;for(this._additionsHead=this._additionsTail=null,c=this._movesHead;null!==c;c=c._nextMoved)c.previousIndex=c.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(c,h,g,x){let M;return null===c?M=this._itTail:(M=c._prev,this._remove(c)),null!==(c=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null))?(Object.is(c.item,h)||this._addIdentityChange(c,h),this._reinsertAfter(c,M,x)):null!==(c=null===this._linkedRecords?null:this._linkedRecords.get(g,x))?(Object.is(c.item,h)||this._addIdentityChange(c,h),this._moveAfter(c,M,x)):c=this._addAfter(new tC(h,g),M,x),c}_verifyReinsertion(c,h,g,x){let M=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null);return null!==M?c=this._reinsertAfter(M,c._prev,x):c.currentIndex!=x&&(c.currentIndex=x,this._addToMoves(c,x)),c}_truncate(c){for(;null!==c;){const h=c._next;this._addToRemovals(this._unlink(c)),c=h}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(c,h,g){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(c);const x=c._prevRemoved,M=c._nextRemoved;return null===x?this._removalsHead=M:x._nextRemoved=M,null===M?this._removalsTail=x:M._prevRemoved=x,this._insertAfter(c,h,g),this._addToMoves(c,g),c}_moveAfter(c,h,g){return this._unlink(c),this._insertAfter(c,h,g),this._addToMoves(c,g),c}_addAfter(c,h,g){return this._insertAfter(c,h,g),this._additionsTail=null===this._additionsTail?this._additionsHead=c:this._additionsTail._nextAdded=c,c}_insertAfter(c,h,g){const x=null===h?this._itHead:h._next;return c._next=x,c._prev=h,null===x?this._itTail=c:x._prev=c,null===h?this._itHead=c:h._next=c,null===this._linkedRecords&&(this._linkedRecords=new V0),this._linkedRecords.put(c),c.currentIndex=g,c}_remove(c){return this._addToRemovals(this._unlink(c))}_unlink(c){null!==this._linkedRecords&&this._linkedRecords.remove(c);const h=c._prev,g=c._next;return null===h?this._itHead=g:h._next=g,null===g?this._itTail=h:g._prev=h,c}_addToMoves(c,h){return c.previousIndex===h||(this._movesTail=null===this._movesTail?this._movesHead=c:this._movesTail._nextMoved=c),c}_addToRemovals(c){return null===this._unlinkedRecords&&(this._unlinkedRecords=new V0),this._unlinkedRecords.put(c),c.currentIndex=null,c._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=c,c._prevRemoved=null):(c._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=c),c}_addIdentityChange(c,h){return c.item=h,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=c:this._identityChangesTail._nextIdentityChange=c,c}}class tC{constructor(c,h){this.item=c,this.trackById=h,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class LM{constructor(){this._head=null,this._tail=null}add(c){null===this._head?(this._head=this._tail=c,c._nextDup=null,c._prevDup=null):(this._tail._nextDup=c,c._prevDup=this._tail,c._nextDup=null,this._tail=c)}get(c,h){let g;for(g=this._head;null!==g;g=g._nextDup)if((null===h||h<=g.currentIndex)&&Object.is(g.trackById,c))return g;return null}remove(c){const h=c._prevDup,g=c._nextDup;return null===h?this._head=g:h._nextDup=g,null===g?this._tail=h:g._prevDup=h,null===this._head}}class V0{constructor(){this.map=new Map}put(c){const h=c.trackById;let g=this.map.get(h);g||(g=new LM,this.map.set(h,g)),g.add(c)}get(c,h){const x=this.map.get(c);return x?x.get(c,h):null}remove(c){const h=c.trackById;return this.map.get(h).remove(c)&&this.map.delete(h),c}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Gx(r,c,h){const g=r.previousIndex;if(null===g)return g;let x=0;return h&&g<h.length&&(x=h[g]),g+c+x}class nC{constructor(){}supports(c){return c instanceof Map||xt(c)}create(){return new NM}}class NM{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(c){let h;for(h=this._mapHead;null!==h;h=h._next)c(h)}forEachPreviousItem(c){let h;for(h=this._previousMapHead;null!==h;h=h._nextPrevious)c(h)}forEachChangedItem(c){let h;for(h=this._changesHead;null!==h;h=h._nextChanged)c(h)}forEachAddedItem(c){let h;for(h=this._additionsHead;null!==h;h=h._nextAdded)c(h)}forEachRemovedItem(c){let h;for(h=this._removalsHead;null!==h;h=h._nextRemoved)c(h)}diff(c){if(c){if(!(c instanceof Map||xt(c)))throw new it(900,!1)}else c=new Map;return this.check(c)?this:null}onDestroy(){}check(c){this._reset();let h=this._mapHead;if(this._appendAfter=null,this._forEach(c,(g,x)=>{if(h&&h.key===x)this._maybeAddToChanges(h,g),this._appendAfter=h,h=h._next;else{const M=this._getOrCreateRecordForKey(x,g);h=this._insertBeforeOrAppend(h,M)}}),h){h._prev&&(h._prev._next=null),this._removalsHead=h;for(let g=h;null!==g;g=g._nextRemoved)g===this._mapHead&&(this._mapHead=null),this._records.delete(g.key),g._nextRemoved=g._next,g.previousValue=g.currentValue,g.currentValue=null,g._prev=null,g._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(c,h){if(c){const g=c._prev;return h._next=c,h._prev=g,c._prev=h,g&&(g._next=h),c===this._mapHead&&(this._mapHead=h),this._appendAfter=c,c}return this._appendAfter?(this._appendAfter._next=h,h._prev=this._appendAfter):this._mapHead=h,this._appendAfter=h,null}_getOrCreateRecordForKey(c,h){if(this._records.has(c)){const x=this._records.get(c);this._maybeAddToChanges(x,h);const M=x._prev,O=x._next;return M&&(M._next=O),O&&(O._prev=M),x._next=null,x._prev=null,x}const g=new BM(c);return this._records.set(c,g),g.currentValue=h,this._addToAdditions(g),g}_reset(){if(this.isDirty){let c;for(this._previousMapHead=this._mapHead,c=this._previousMapHead;null!==c;c=c._next)c._nextPrevious=c._next;for(c=this._changesHead;null!==c;c=c._nextChanged)c.previousValue=c.currentValue;for(c=this._additionsHead;null!=c;c=c._nextAdded)c.previousValue=c.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(c,h){Object.is(h,c.currentValue)||(c.previousValue=c.currentValue,c.currentValue=h,this._addToChanges(c))}_addToAdditions(c){null===this._additionsHead?this._additionsHead=this._additionsTail=c:(this._additionsTail._nextAdded=c,this._additionsTail=c)}_addToChanges(c){null===this._changesHead?this._changesHead=this._changesTail=c:(this._changesTail._nextChanged=c,this._changesTail=c)}_forEach(c,h){c instanceof Map?c.forEach(h):Object.keys(c).forEach(g=>h(c[g],g))}}class BM{constructor(c){this.key=c,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function iC(){return new Zx([new Cy])}let Zx=(()=>{var r;class c{constructor(g){this.factories=g}static create(g,x){if(null!=x){const M=x.factories.slice();g=g.concat(M)}return new c(g)}static extend(g){return{provide:c,useFactory:x=>c.create(g,x||iC()),deps:[[c,new Af,new If]]}}find(g){const x=this.factories.find(M=>M.supports(g));if(null!=x)return x;throw new it(901,!1)}}return(r=c).\u0275prov=On({token:r,providedIn:"root",factory:iC}),c})();function lf(){return new Ty([new nC])}let Ty=(()=>{var r;class c{constructor(g){this.factories=g}static create(g,x){if(x){const M=x.factories.slice();g=g.concat(M)}return new c(g)}static extend(g){return{provide:c,useFactory:x=>c.create(g,x||lf()),deps:[[c,new Af,new If]]}}find(g){const x=this.factories.find(M=>M.supports(g));if(x)return x;throw new it(901,!1)}}return(r=c).\u0275prov=On({token:r,providedIn:"root",factory:lf}),c})();const zM=Nx(null,"core",[]);let VM=(()=>{var r;class c{constructor(g){}}return(r=c).\u0275fac=function(g){return new(g||r)(Qn(Bd))},r.\u0275mod=zt({type:r}),r.\u0275inj=ji({}),c})();function YM(r){return"boolean"==typeof r?r:null!=r&&"false"!==r}function Jx(r){const c=Tn(r);if(!c)return null;const h=new wu(c);return{get selector(){return h.selector},get type(){return h.componentType},get inputs(){return h.inputs},get outputs(){return h.outputs},get ngContentSelectors(){return h.ngContentSelectors},get isStandalone(){return c.standalone},get isSignal(){return c.signals}}}},1993:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{O4:()=>Zt});var E=ne(5879);class Ye extends Error{constructor(yt,vt){super(function Ge(_t,yt){return`NG0${Math.abs(_t)}${yt?": "+yt:""}`}(yt,vt)),this.code=yt}}function Zt(_t,yt){const vt=!yt?.manualCleanup;vt&&!yt?.injector&&(0,E.gHi)(Zt);const dn=vt?yt?.injector?.get(E.ktI)??(0,E.f3M)(E.ktI):null;let yn;yn=(0,E.tdS)(yt?.requireSync?{kind:0}:{kind:1,value:yt?.initialValue});const ai=_t.subscribe({next:On=>yn.set({kind:1,value:On}),error:On=>yn.set({kind:2,error:On})});return dn?.onDestroy(ai.unsubscribe.bind(ai)),(0,E.Flj)(()=>{const On=yn();switch(On.kind){case 1:return On.value;case 2:throw On.error;case 0:throw new Ye(601,"`toSignal()` called with `requireSync` but `Observable` did not emit synchronously.")}})}globalThis},7632:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{FT:()=>StoreDevtoolsModule});var _angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5879),_ngrx_store__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4221),rxjs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6232),rxjs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5592),rxjs__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(2096),rxjs__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(3019),rxjs__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(2381),rxjs__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(7328),rxjs_operators__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3020),rxjs_operators__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2181),rxjs_operators__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(7398),rxjs_operators__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(6328),rxjs_operators__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(5178),rxjs_operators__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(3620),rxjs_operators__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(6306),rxjs_operators__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(8180),rxjs_operators__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(9773),rxjs_operators__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(4664),rxjs_operators__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(836),rxjs_operators__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(3093),rxjs_operators__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(2460),rxjs_operators__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(6699),_angular_core_rxjs_interop__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(1993);const PERFORM_ACTION="PERFORM_ACTION",REFRESH="REFRESH",RESET="RESET",ROLLBACK="ROLLBACK",COMMIT="COMMIT",SWEEP="SWEEP",TOGGLE_ACTION="TOGGLE_ACTION",SET_ACTIONS_ACTIVE="SET_ACTIONS_ACTIVE",JUMP_TO_STATE="JUMP_TO_STATE",JUMP_TO_ACTION="JUMP_TO_ACTION",IMPORT_STATE="IMPORT_STATE",LOCK_CHANGES="LOCK_CHANGES",PAUSE_RECORDING="PAUSE_RECORDING";class PerformAction{constructor(Ie,ne){if(this.action=Ie,this.timestamp=ne,this.type=PERFORM_ACTION,typeof Ie.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')}}class Refresh{constructor(){this.type=REFRESH}}class Reset{constructor(Ie){this.timestamp=Ie,this.type=RESET}}class Rollback{constructor(Ie){this.timestamp=Ie,this.type=ROLLBACK}}class Commit{constructor(Ie){this.timestamp=Ie,this.type=COMMIT}}class Sweep{constructor(){this.type=SWEEP}}class ToggleAction{constructor(Ie){this.id=Ie,this.type=TOGGLE_ACTION}}class SetActionsActive{constructor(Ie,ne,E=!0){this.start=Ie,this.end=ne,this.active=E,this.type=SET_ACTIONS_ACTIVE}}class JumpToState{constructor(Ie){this.index=Ie,this.type=JUMP_TO_STATE}}class JumpToAction{constructor(Ie){this.actionId=Ie,this.type=JUMP_TO_ACTION}}class ImportState{constructor(Ie){this.nextLiftedState=Ie,this.type=IMPORT_STATE}}class LockChanges{constructor(Ie){this.status=Ie,this.type=LOCK_CHANGES}}class PauseRecording{constructor(Ie){this.status=Ie,this.type=PAUSE_RECORDING}}class StoreDevtoolsConfig{constructor(){this.maxAge=!1}}const STORE_DEVTOOLS_CONFIG=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.OlP("@ngrx/store-devtools Options"),INITIAL_OPTIONS=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.OlP("@ngrx/store-devtools Initial Config");function noMonitor(){return null}const DEFAULT_NAME="NgRx Store DevTools";function createConfig(Ue){const Ie={maxAge:!1,monitor:noMonitor,actionSanitizer:void 0,stateSanitizer:void 0,name:DEFAULT_NAME,serialize:!1,logOnly:!1,autoPause:!1,trace:!1,traceLimit:75,features:{pause:!0,lock:!0,persist:!0,export:!0,import:"custom",jump:!0,skip:!0,reorder:!0,dispatch:!0,test:!0},connectOutsideZone:!1},ne="function"==typeof Ue?Ue():Ue,Be=ne.features||!!ne.logOnly&&{pause:!0,export:!0,test:!0}||Ie.features;!0===Be.import&&(Be.import="custom");const rt=Object.assign({},Ie,{features:Be},ne);if(rt.maxAge&&rt.maxAge<2)throw new Error(`Devtools 'maxAge' cannot be less than 2, got ${rt.maxAge}`);return rt}function difference(Ue,Ie){return Ue.filter(ne=>Ie.indexOf(ne)<0)}function unliftState(Ue){const{computedStates:Ie,currentStateIndex:ne}=Ue;if(ne>=Ie.length){const{state:Be}=Ie[Ie.length-1];return Be}const{state:E}=Ie[ne];return E}function unliftAction(Ue){return Ue.actionsById[Ue.nextActionId-1]}function liftAction(Ue){return new PerformAction(Ue,+Date.now())}function sanitizeActions(Ue,Ie){return Object.keys(Ie).reduce((ne,E)=>{const Be=Number(E);return ne[Be]=sanitizeAction(Ue,Ie[Be],Be),ne},{})}function sanitizeAction(Ue,Ie,ne){return{...Ie,action:Ue(Ie.action,ne)}}function sanitizeStates(Ue,Ie){return Ie.map((ne,E)=>({state:sanitizeState(Ue,ne.state,E),error:ne.error}))}function sanitizeState(Ue,Ie,ne){return Ue(Ie,ne)}function shouldFilterActions(Ue){return Ue.predicate||Ue.actionsSafelist||Ue.actionsBlocklist}function filterLiftedState(Ue,Ie,ne,E){const Be=[],rt={},p=[];return Ue.stagedActionIds.forEach((ue,Ye)=>{const Ge=Ue.actionsById[ue];Ge&&(Ye&&isActionFiltered(Ue.computedStates[Ye],Ge,Ie,ne,E)||(rt[ue]=Ge,Be.push(ue),p.push(Ue.computedStates[Ye])))}),{...Ue,stagedActionIds:Be,actionsById:rt,computedStates:p}}function isActionFiltered(Ue,Ie,ne,E,Be){const rt=ne&&!ne(Ue,Ie.action),p=E&&!Ie.action.type.match(E.map(Ye=>escapeRegExp(Ye)).join("|")),ue=Be&&Ie.action.type.match(Be.map(Ye=>escapeRegExp(Ye)).join("|"));return rt||p||ue}function escapeRegExp(Ue){return Ue.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function injectZoneConfig(Ue){return{ngZone:Ue?(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.f3M)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.R0b):null,connectOutsideZone:Ue}}let DevtoolsDispatcher=(()=>{var Ue;class Ie extends _ngrx_store__WEBPACK_IMPORTED_MODULE_1__.UO{}return(Ue=Ie).\u0275fac=function(){let ne;return function(Be){return(ne||(ne=_angular_core__WEBPACK_IMPORTED_MODULE_0__.n5z(Ue)))(Be||Ue)}}(),Ue.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yz7({token:Ue,factory:Ue.\u0275fac}),Ie})();const ExtensionActionTypes={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},REDUX_DEVTOOLS_EXTENSION=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.OlP("@ngrx/store-devtools Redux Devtools Extension");let DevtoolsExtension=(()=>{var _class2;class DevtoolsExtension{constructor(Ue,Ie,ne){this.config=Ie,this.dispatcher=ne,this.zoneConfig=injectZoneConfig(this.config.connectOutsideZone),this.devtoolsExtension=Ue,this.createActionStreams()}notify(Ue,Ie){if(this.devtoolsExtension)if(Ue.type===PERFORM_ACTION){if(Ie.isLocked||Ie.isPaused)return;const ne=unliftState(Ie);if(shouldFilterActions(this.config)&&isActionFiltered(ne,Ue,this.config.predicate,this.config.actionsSafelist,this.config.actionsBlocklist))return;const E=this.config.stateSanitizer?sanitizeState(this.config.stateSanitizer,ne,Ie.currentStateIndex):ne,Be=this.config.actionSanitizer?sanitizeAction(this.config.actionSanitizer,Ue,Ie.nextActionId):Ue;this.sendToReduxDevtools(()=>this.extensionConnection.send(Be,E))}else{const ne={...Ie,stagedActionIds:Ie.stagedActionIds,actionsById:this.config.actionSanitizer?sanitizeActions(this.config.actionSanitizer,Ie.actionsById):Ie.actionsById,computedStates:this.config.stateSanitizer?sanitizeStates(this.config.stateSanitizer,Ie.computedStates):Ie.computedStates};this.sendToReduxDevtools(()=>this.devtoolsExtension.send(null,ne,this.getExtensionConfig(this.config)))}}createChangesObservable(){return this.devtoolsExtension?new rxjs__WEBPACK_IMPORTED_MODULE_3__.y(Ue=>{const Ie=this.zoneConfig.connectOutsideZone?this.zoneConfig.ngZone.runOutsideAngular(()=>this.devtoolsExtension.connect(this.getExtensionConfig(this.config))):this.devtoolsExtension.connect(this.getExtensionConfig(this.config));return this.extensionConnection=Ie,Ie.init(),Ie.subscribe(ne=>Ue.next(ne)),Ie.unsubscribe}):rxjs__WEBPACK_IMPORTED_MODULE_2__.E}createActionStreams(){const Ue=this.createChangesObservable().pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_4__.B)()),Ie=Ue.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(ue=>ue.type===ExtensionActionTypes.START)),ne=Ue.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(ue=>ue.type===ExtensionActionTypes.STOP)),E=Ue.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(ue=>ue.type===ExtensionActionTypes.DISPATCH),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(ue=>this.unwrapAction(ue.payload)),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_7__.b)(ue=>ue.type===IMPORT_STATE?this.dispatcher.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(Ye=>Ye.type===_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.wb),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_8__.V)(1e3),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_9__.b)(1e3),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(()=>ue),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_10__.K)(()=>(0,rxjs__WEBPACK_IMPORTED_MODULE_11__.of)(ue)),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_12__.q)(1)):(0,rxjs__WEBPACK_IMPORTED_MODULE_11__.of)(ue))),rt=Ue.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(ue=>ue.type===ExtensionActionTypes.ACTION),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(ue=>this.unwrapAction(ue.payload))).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_13__.R)(ne)),p=E.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_13__.R)(ne));this.start$=Ie.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_13__.R)(ne)),this.actions$=this.start$.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_14__.w)(()=>rt)),this.liftedActions$=this.start$.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_14__.w)(()=>p))}unwrapAction(action){return"string"==typeof action?eval(`(${action})`):action}getExtensionConfig(Ue){const Ie={name:Ue.name,features:Ue.features,serialize:Ue.serialize,autoPause:Ue.autoPause??!1,trace:Ue.trace??!1,traceLimit:Ue.traceLimit??75};return!1!==Ue.maxAge&&(Ie.maxAge=Ue.maxAge),Ie}sendToReduxDevtools(Ue){try{Ue()}catch(Ie){console.warn("@ngrx/store-devtools: something went wrong inside the redux devtools",Ie)}}}return _class2=DevtoolsExtension,_class2.\u0275fac=function Ue(Ie){return new(Ie||_class2)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(REDUX_DEVTOOLS_EXTENSION),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(STORE_DEVTOOLS_CONFIG),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(DevtoolsDispatcher))},_class2.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yz7({token:_class2,factory:_class2.\u0275fac}),DevtoolsExtension})();const INIT_ACTION={type:_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.qg},RECOMPUTE="@ngrx/store-devtools/recompute",RECOMPUTE_ACTION={type:RECOMPUTE};function computeNextEntry(Ue,Ie,ne,E,Be){if(E)return{state:ne,error:"Interrupted by an error up the chain"};let p,rt=ne;try{rt=Ue(ne,Ie)}catch(ue){p=ue.toString(),Be.handleError(ue)}return{state:rt,error:p}}function recomputeStates(Ue,Ie,ne,E,Be,rt,p,ue,Ye){if(Ie>=Ue.length&&Ue.length===rt.length)return Ue;const Ge=Ue.slice(0,Ie),Le=rt.length-(Ye?1:0);for(let Ae=Ie;Ae<Le;Ae++){const ke=rt[Ae],$e=Be[ke].action,Qe=Ge[Ae-1],It=Qe?Qe.state:E,Wt=Qe?Qe.error:void 0,Ot=p.indexOf(ke)>-1?Qe:computeNextEntry(ne,$e,It,Wt,ue);Ge.push(Ot)}return Ye&&Ge.push(Ue[Ue.length-1]),Ge}function liftInitialState(Ue,Ie){return{monitorState:Ie(void 0,{}),nextActionId:1,actionsById:{0:liftAction(INIT_ACTION)},stagedActionIds:[0],skippedActionIds:[],committedState:Ue,currentStateIndex:0,computedStates:[],isLocked:!1,isPaused:!1}}function liftReducerWith(Ue,Ie,ne,E,Be={}){return rt=>(p,ue)=>{let{monitorState:Ye,actionsById:Ge,nextActionId:Le,stagedActionIds:Ae,skippedActionIds:ke,committedState:$e,currentStateIndex:Qe,computedStates:It,isLocked:Wt,isPaused:on}=p||Ie;function Ot(Sn){let gn=Sn,it=Ae.slice(1,gn+1);for(let Ne=0;Ne<it.length;Ne++){if(It[Ne+1].error){gn=Ne,it=Ae.slice(1,gn+1);break}delete Ge[it[Ne]]}ke=ke.filter(Ne=>-1===it.indexOf(Ne)),Ae=[0,...Ae.slice(gn+1)],$e=It[gn].state,It=It.slice(gn),Qe=Qe>gn?Qe-gn:0}function Cn(){Ge={0:liftAction(INIT_ACTION)},Le=1,Ae=[0],ke=[],$e=It[Qe].state,Qe=0,It=[]}p||(Ge=Object.create(Ge));let un=0;switch(ue.type){case LOCK_CHANGES:Wt=ue.status,un=1/0;break;case PAUSE_RECORDING:on=ue.status,on?(Ae=[...Ae,Le],Ge[Le]=new PerformAction({type:"@ngrx/devtools/pause"},+Date.now()),Le++,un=Ae.length-1,It=It.concat(It[It.length-1]),Qe===Ae.length-2&&Qe++,un=1/0):Cn();break;case RESET:Ge={0:liftAction(INIT_ACTION)},Le=1,Ae=[0],ke=[],$e=Ue,Qe=0,It=[];break;case COMMIT:Cn();break;case ROLLBACK:Ge={0:liftAction(INIT_ACTION)},Le=1,Ae=[0],ke=[],Qe=0,It=[];break;case TOGGLE_ACTION:{const{id:Sn}=ue;ke=-1===ke.indexOf(Sn)?[Sn,...ke]:ke.filter(it=>it!==Sn),un=Ae.indexOf(Sn);break}case SET_ACTIONS_ACTIVE:{const{start:Sn,end:gn,active:it}=ue,Ne=[];for(let Nt=Sn;Nt<gn;Nt++)Ne.push(Nt);ke=it?difference(ke,Ne):[...ke,...Ne],un=Ae.indexOf(Sn);break}case JUMP_TO_STATE:Qe=ue.index,un=1/0;break;case JUMP_TO_ACTION:{const Sn=Ae.indexOf(ue.actionId);-1!==Sn&&(Qe=Sn),un=1/0;break}case SWEEP:Ae=difference(Ae,ke),ke=[],Qe=Math.min(Qe,Ae.length-1);break;case PERFORM_ACTION:{if(Wt)return p||Ie;if(on||p&&isActionFiltered(p.computedStates[Qe],ue,Be.predicate,Be.actionsSafelist,Be.actionsBlocklist)){const gn=It[It.length-1];It=[...It.slice(0,-1),computeNextEntry(rt,ue.action,gn.state,gn.error,ne)],un=1/0;break}Be.maxAge&&Ae.length===Be.maxAge&&Ot(1),Qe===Ae.length-1&&Qe++;const Sn=Le++;Ge[Sn]=ue,Ae=[...Ae,Sn],un=Ae.length-1;break}case IMPORT_STATE:({monitorState:Ye,actionsById:Ge,nextActionId:Le,stagedActionIds:Ae,skippedActionIds:ke,committedState:$e,currentStateIndex:Qe,computedStates:It,isLocked:Wt,isPaused:on}=ue.nextLiftedState);break;case _ngrx_store__WEBPACK_IMPORTED_MODULE_1__.qg:un=0,Be.maxAge&&Ae.length>Be.maxAge&&(It=recomputeStates(It,un,rt,$e,Ge,Ae,ke,ne,on),Ot(Ae.length-Be.maxAge),un=1/0);break;case _ngrx_store__WEBPACK_IMPORTED_MODULE_1__.wb:if(It.filter(gn=>gn.error).length>0)un=0,Be.maxAge&&Ae.length>Be.maxAge&&(It=recomputeStates(It,un,rt,$e,Ge,Ae,ke,ne,on),Ot(Ae.length-Be.maxAge),un=1/0);else{if(!on&&!Wt){Qe===Ae.length-1&&Qe++;const gn=Le++;Ge[gn]=new PerformAction(ue,+Date.now()),Ae=[...Ae,gn],un=Ae.length-1,It=recomputeStates(It,un,rt,$e,Ge,Ae,ke,ne,on)}It=It.map(gn=>({...gn,state:rt(gn.state,RECOMPUTE_ACTION)})),Qe=Ae.length-1,Be.maxAge&&Ae.length>Be.maxAge&&Ot(Ae.length-Be.maxAge),un=1/0}break;default:un=1/0}return It=recomputeStates(It,un,rt,$e,Ge,Ae,ke,ne,on),Ye=E(Ye,ue),{monitorState:Ye,actionsById:Ge,nextActionId:Le,stagedActionIds:Ae,skippedActionIds:ke,committedState:$e,currentStateIndex:Qe,computedStates:It,isLocked:Wt,isPaused:on}}}let StoreDevtools=(()=>{var Ue;class Ie{constructor(E,Be,rt,p,ue,Ye,Ge,Le){const Ae=liftInitialState(Ge,Le.monitor),ke=liftReducerWith(Ge,Ae,Ye,Le.monitor,Le),$e=(0,rxjs__WEBPACK_IMPORTED_MODULE_15__.T)((0,rxjs__WEBPACK_IMPORTED_MODULE_15__.T)(Be.asObservable().pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_16__.T)(1)),p.actions$).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(liftAction)),E,p.liftedActions$).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_17__.Q)(rxjs__WEBPACK_IMPORTED_MODULE_18__.N)),Qe=rt.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(ke)),It=injectZoneConfig(Le.connectOutsideZone),Wt=new rxjs__WEBPACK_IMPORTED_MODULE_19__.t(1);this.liftedStateSubscription=$e.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_20__.M)(Qe),emitInZone(It),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_21__.R)(({state:Cn},[un,Sn])=>{let gn=Sn(Cn,un);return un.type!==PERFORM_ACTION&&shouldFilterActions(Le)&&(gn=filterLiftedState(gn,Le.predicate,Le.actionsSafelist,Le.actionsBlocklist)),p.notify(un,gn),{state:gn,action:un}},{state:Ae,action:null})).subscribe(({state:Cn,action:un})=>{Wt.next(Cn),un.type===PERFORM_ACTION&&ue.next(un.action)}),this.extensionStartSubscription=p.start$.pipe(emitInZone(It)).subscribe(()=>{this.refresh()});const on=Wt.asObservable(),Ot=on.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.U)(unliftState));Object.defineProperty(Ot,"state",{value:(0,_angular_core_rxjs_interop__WEBPACK_IMPORTED_MODULE_22__.O4)(Ot,{manualCleanup:!0,requireSync:!0})}),this.dispatcher=E,this.liftedState=on,this.state=Ot}ngOnDestroy(){this.liftedStateSubscription.unsubscribe(),this.extensionStartSubscription.unsubscribe()}dispatch(E){this.dispatcher.next(E)}next(E){this.dispatcher.next(E)}error(E){}complete(){}performAction(E){this.dispatch(new PerformAction(E,+Date.now()))}refresh(){this.dispatch(new Refresh)}reset(){this.dispatch(new Reset(+Date.now()))}rollback(){this.dispatch(new Rollback(+Date.now()))}commit(){this.dispatch(new Commit(+Date.now()))}sweep(){this.dispatch(new Sweep)}toggleAction(E){this.dispatch(new ToggleAction(E))}jumpToAction(E){this.dispatch(new JumpToAction(E))}jumpToState(E){this.dispatch(new JumpToState(E))}importState(E){this.dispatch(new ImportState(E))}lockChanges(E){this.dispatch(new LockChanges(E))}pauseRecording(E){this.dispatch(new PauseRecording(E))}}return(Ue=Ie).\u0275fac=function(E){return new(E||Ue)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(DevtoolsDispatcher),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.UO),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.n$),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(DevtoolsExtension),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.Y$),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_angular_core__WEBPACK_IMPORTED_MODULE_0__.qLn),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.Y6),_angular_core__WEBPACK_IMPORTED_MODULE_0__.LFG(STORE_DEVTOOLS_CONFIG))},Ue.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yz7({token:Ue,factory:Ue.\u0275fac}),Ie})();function emitInZone({ngZone:Ue,connectOutsideZone:Ie}){return ne=>Ie?new rxjs__WEBPACK_IMPORTED_MODULE_3__.y(E=>ne.subscribe({next:Be=>Ue.run(()=>E.next(Be)),error:Be=>Ue.run(()=>E.error(Be)),complete:()=>Ue.run(()=>E.complete())})):ne}const IS_EXTENSION_OR_MONITOR_PRESENT=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.OlP("@ngrx/store-devtools Is Devtools Extension or Monitor Present");function createIsExtensionOrMonitorPresent(Ue,Ie){return!!Ue||Ie.monitor!==noMonitor}function createReduxDevtoolsExtension(){const Ue="__REDUX_DEVTOOLS_EXTENSION__";return"object"==typeof window&&typeof window[Ue]<"u"?window[Ue]:null}function provideStoreDevtools(Ue={}){return(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.MR2)([DevtoolsExtension,DevtoolsDispatcher,StoreDevtools,{provide:INITIAL_OPTIONS,useValue:Ue},{provide:IS_EXTENSION_OR_MONITOR_PRESENT,deps:[REDUX_DEVTOOLS_EXTENSION,STORE_DEVTOOLS_CONFIG],useFactory:createIsExtensionOrMonitorPresent},{provide:REDUX_DEVTOOLS_EXTENSION,useFactory:createReduxDevtoolsExtension},{provide:STORE_DEVTOOLS_CONFIG,deps:[INITIAL_OPTIONS],useFactory:createConfig},{provide:_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.FR,deps:[StoreDevtools],useFactory:createStateObservable},{provide:_ngrx_store__WEBPACK_IMPORTED_MODULE_1__.mK,useExisting:DevtoolsDispatcher}])}function createStateObservable(Ue){return Ue.state}let StoreDevtoolsModule=(()=>{var Ue;class Ie{static instrument(E={}){return{ngModule:Ie,providers:[provideStoreDevtools(E)]}}}return(Ue=Ie).\u0275fac=function(E){return new(E||Ue)},Ue.\u0275mod=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oAB({type:Ue}),Ue.\u0275inj=_angular_core__WEBPACK_IMPORTED_MODULE_0__.cJS({}),Ie})()},4221:(Ue,Ie,ne)=>{"use strict";ne.d(Ie,{UO:()=>Kt,qg:()=>Ft,Y6:()=>No,mK:()=>Bo,n$:()=>wo,Y$:()=>si,FR:()=>zo,yh:()=>vs,CK:()=>Ea,Aw:()=>xs,cr:()=>bl,wb:()=>Kl,PH:()=>on,ZF:()=>tr,Lq:()=>ss,P1:()=>Qn,on:()=>or,Ky:()=>Ot});var E=ne(5879),Be=ne(5619),rt=ne(5592),p=ne(8645),ue=ne(2381),Ye=ne(3093),Ge=ne(2460),Le=ne(6699),Ae=ne(7398),$e=ne(3997),Qe=ne(1993);const It={};function on(ye,at){if(It[ye]=(It[ye]||0)+1,"function"==typeof at)return un(ye,(...We)=>({...at(...We),type:ye}));switch(at?at._as:"empty"){case"empty":return un(ye,()=>({type:ye}));case"props":return un(ye,We=>({...We,type:ye}));default:throw new Error("Unexpected config.")}}function Ot(){return{_as:"props",_p:void 0}}function un(ye,at){return Object.defineProperty(at,"type",{value:ye,writable:!1})}const Ft="@ngrx/store/init";let Kt=(()=>{var ye;class at extends Be.X{constructor(){super({type:Ft})}next(We){if("function"==typeof We)throw new TypeError("\n        Dispatch expected an object, instead it received a function.\n        If you're using the createAction function, make sure to invoke the function\n        before dispatching the action. For example, someAction should be someAction().");if(typeof We>"u")throw new TypeError("Actions must be objects");if(typeof We.type>"u")throw new TypeError("Actions must have a type property");super.next(We)}complete(){}ngOnDestroy(){super.complete()}}return(ye=at).\u0275fac=function(We){return new(We||ye)},ye.\u0275prov=E.Yz7({token:ye,factory:ye.\u0275fac}),at})();const ui=[Kt],gi=new E.OlP("@ngrx/store Internal Root Guard"),cr=new E.OlP("@ngrx/store Internal Initial State"),No=new E.OlP("@ngrx/store Initial State"),Wn=new E.OlP("@ngrx/store Reducer Factory"),ia=new E.OlP("@ngrx/store Internal Reducer Factory Provider"),Si=new E.OlP("@ngrx/store Initial Reducers"),yr=new E.OlP("@ngrx/store Internal Initial Reducers"),ra=new E.OlP("@ngrx/store Store Features"),st=new E.OlP("@ngrx/store Internal Store Reducers"),dt=new E.OlP("@ngrx/store Internal Feature Reducers"),Mt=new E.OlP("@ngrx/store Internal Feature Configs"),Et=new E.OlP("@ngrx/store Internal Store Features"),Zt=new E.OlP("@ngrx/store Internal Feature Reducers Token"),_t=new E.OlP("@ngrx/store Feature Reducers"),yt=new E.OlP("@ngrx/store User Provided Meta Reducers"),vt=new E.OlP("@ngrx/store Meta Reducers"),dn=new E.OlP("@ngrx/store Internal Resolved Meta Reducers"),yn=new E.OlP("@ngrx/store User Runtime Checks Config"),ai=new E.OlP("@ngrx/store Internal User Runtime Checks Config"),On=new E.OlP("@ngrx/store Internal Runtime Checks"),Yn=new E.OlP("@ngrx/store Check if Action types are unique");function Pi(ye,at={}){const Dt=Object.keys(ye),We={};for(let nn=0;nn<Dt.length;nn++){const Zn=Dt[nn];"function"==typeof ye[Zn]&&(We[Zn]=ye[Zn])}const zt=Object.keys(We);return function(Zn,dr){Zn=void 0===Zn?at:Zn;let Yi=!1;const Tn={};for(let wn=0;wn<zt.length;wn++){const Gi=zt[wn],Xi=Zn[Gi],Mo=(0,We[Gi])(Xi,dr);Tn[Gi]=Mo,Yi=Yi||Mo!==Xi}return Yi?Tn:Zn}}function is(...ye){return function(at){if(0===ye.length)return at;const Dt=ye[ye.length-1];return ye.slice(0,-1).reduceRight((zt,nn)=>nn(zt),Dt(at))}}function Bs(ye,at){return Array.isArray(at)&&at.length>0&&(ye=is.apply(null,[...at,ye])),(Dt,We)=>{const zt=ye(Dt);return(nn,Zn)=>zt(nn=void 0===nn?We:nn,Zn)}}new E.OlP("@ngrx/store Root Store Provider"),new E.OlP("@ngrx/store Feature State Provider");class wo extends rt.y{}class Bo extends Kt{}const Kl="@ngrx/store/update-reducers";let $n=(()=>{var ye;class at extends Be.X{get currentReducers(){return this.reducers}constructor(We,zt,nn,Zn){super(Zn(nn,zt)),this.dispatcher=We,this.initialState=zt,this.reducers=nn,this.reducerFactory=Zn}addFeature(We){this.addFeatures([We])}addFeatures(We){const zt=We.reduce((nn,{reducers:Zn,reducerFactory:dr,metaReducers:Yi,initialState:Tn,key:wn})=>{const Gi="function"==typeof Zn?function xa(ye){const at=Array.isArray(ye)&&ye.length>0?is(...ye):Dt=>Dt;return(Dt,We)=>(Dt=at(Dt),(zt,nn)=>Dt(zt=void 0===zt?We:zt,nn))}(Yi)(Zn,Tn):Bs(dr,Yi)(Zn,Tn);return nn[wn]=Gi,nn},{});this.addReducers(zt)}removeFeature(We){this.removeFeatures([We])}removeFeatures(We){this.removeReducers(We.map(zt=>zt.key))}addReducer(We,zt){this.addReducers({[We]:zt})}addReducers(We){this.reducers={...this.reducers,...We},this.updateReducers(Object.keys(We))}removeReducer(We){this.removeReducers([We])}removeReducers(We){We.forEach(zt=>{this.reducers=function ur(ye,at){return Object.keys(ye).filter(Dt=>Dt!==at).reduce((Dt,We)=>Object.assign(Dt,{[We]:ye[We]}),{})}(this.reducers,zt)}),this.updateReducers(We)}updateReducers(We){this.next(this.reducerFactory(this.reducers,this.initialState)),this.dispatcher.next({type:Kl,features:We})}ngOnDestroy(){this.complete()}}return(ye=at).\u0275fac=function(We){return new(We||ye)(E.LFG(Bo),E.LFG(No),E.LFG(Si),E.LFG(Wn))},ye.\u0275prov=E.Yz7({token:ye,factory:ye.\u0275fac}),at})();const ii=[$n,{provide:wo,useExisting:$n},{provide:Bo,useExisting:Kt}];let si=(()=>{var ye;class at extends p.x{ngOnDestroy(){this.complete()}}return(ye=at).\u0275fac=function(){let Dt;return function(zt){return(Dt||(Dt=E.n5z(ye)))(zt||ye)}}(),ye.\u0275prov=E.Yz7({token:ye,factory:ye.\u0275fac}),at})();const Hr=[si];class zo extends rt.y{}let Eo=(()=>{var ye;class at extends Be.X{constructor(We,zt,nn,Zn){super(Zn);const wn=We.pipe((0,Ye.Q)(ue.N)).pipe((0,Ge.M)(zt)).pipe((0,Le.R)($i,{state:Zn}));this.stateSubscription=wn.subscribe(({state:Gi,action:as})=>{this.next(Gi),nn.next(as)}),this.state=(0,Qe.O4)(this,{manualCleanup:!0,requireSync:!0})}ngOnDestroy(){this.stateSubscription.unsubscribe(),this.complete()}}return(ye=at).INIT=Ft,ye.\u0275fac=function(We){return new(We||ye)(E.LFG(Kt),E.LFG(wo),E.LFG(si),E.LFG(No))},ye.\u0275prov=E.Yz7({token:ye,factory:ye.\u0275fac}),at})();function $i(ye={state:void 0},[at,Dt]){const{state:We}=ye;return{state:Dt(We,at),action:at}}const ao=[Eo,{provide:zo,useExisting:Eo}];let vs=(()=>{var ye;class at extends rt.y{constructor(We,zt,nn){super(),this.actionsObserver=zt,this.reducerManager=nn,this.source=We,this.state=We.state}select(We,...zt){return oa.call(null,We,...zt)(this)}selectSignal(We,zt){return(0,E.Flj)(()=>We(this.state()),{equal:zt?.equal||((nn,Zn)=>nn===Zn)})}lift(We){const zt=new at(this,this.actionsObserver,this.reducerManager);return zt.operator=We,zt}dispatch(We){this.actionsObserver.next(We)}next(We){this.actionsObserver.next(We)}error(We){this.actionsObserver.error(We)}complete(){this.actionsObserver.complete()}addReducer(We,zt){this.reducerManager.addReducer(We,zt)}removeReducer(We){this.reducerManager.removeReducer(We)}}return(ye=at).\u0275fac=function(We){return new(We||ye)(E.LFG(zo),E.LFG(Kt),E.LFG($n))},ye.\u0275prov=E.Yz7({token:ye,factory:ye.\u0275fac}),at})();const Hi=[vs];function oa(ye,at,...Dt){return function(zt){let nn;if("string"==typeof ye){const Zn=[at,...Dt].filter(Boolean);nn=zt.pipe(function ke(...ye){const at=ye.length;if(0===at)throw new Error("list of properties cannot be empty.");return(0,Ae.U)(Dt=>{let We=Dt;for(let zt=0;zt<at;zt++){const nn=We?.[ye[zt]];if(!(typeof nn<"u"))return;We=nn}return We})}(ye,...Zn))}else{if("function"!=typeof ye)throw new TypeError(`Unexpected type '${typeof ye}' in select operator, expected 'string' or 'function'`);nn=zt.pipe((0,Ae.U)(Zn=>ye(Zn,at)))}return nn.pipe((0,$e.x)())}}const Ei="https://ngrx.io/guide/store/configuration/runtime-checks";function Ga(ye){return void 0===ye}function be(ye){return null===ye}function Q(ye){return Array.isArray(ye)}function Oe(ye){return"object"==typeof ye&&null!==ye}function Pe(ye){return"function"==typeof ye}let Yt=!1;function Vn(ye,at){return ye===at}function ei(ye,at=Vn,Dt=Vn){let nn,We=null,zt=null;return{memoized:function Tn(){if(void 0!==nn)return nn.result;if(!We)return zt=ye.apply(null,arguments),We=arguments,zt;if(!function Xn(ye,at,Dt){for(let We=0;We<ye.length;We++)if(!Dt(ye[We],at[We]))return!0;return!1}(arguments,We,at))return zt;const wn=ye.apply(null,arguments);return We=arguments,Dt(zt,wn)?zt:(zt=wn,wn)},reset:function Zn(){We=null,zt=null},setResult:function dr(wn=void 0){nn={result:wn}},clearResult:function Yi(){nn=void 0}}}function Qn(...ye){return function li(ye,at={stateFn:wr}){return function(...Dt){let We=Dt;if(Array.isArray(We[0])){const[wn,...Gi]=We;We=[...wn,...Gi]}else 1===We.length&&function Vo(ye){return!!ye&&"object"==typeof ye&&Object.values(ye).every(at=>"function"==typeof at)}(We[0])&&(We=function Er(ye){const at=Object.values(ye),Dt=Object.keys(ye);return[...at,(...zt)=>Dt.reduce((nn,Zn,dr)=>({...nn,[Zn]:zt[dr]}),{})]}(We[0]));const zt=We.slice(0,We.length-1),nn=We[We.length-1],Zn=zt.filter(wn=>wn.release&&"function"==typeof wn.release),dr=ye(function(...wn){return nn.apply(null,wn)}),Yi=ei(function(wn,Gi){return at.stateFn.apply(null,[wn,zt,Gi,dr])});return Object.assign(Yi.memoized,{release:function Tn(){Yi.reset(),dr.reset(),Zn.forEach(wn=>wn.release())},projector:dr.memoized,setResult:Yi.setResult,clearResult:Yi.clearResult})}}(ei)(...ye)}function wr(ye,at,Dt,We){if(void 0===Dt){const nn=at.map(Zn=>Zn(ye));return We.memoized.apply(null,nn)}const zt=at.map(nn=>nn(ye,Dt));return We.memoized.apply(null,[...zt,Dt])}function tr(ye){return Qn(at=>{const Dt=at[ye];return!function qn(){return Yt}()&&(0,E.X6Q)()&&!(ye in at)&&console.warn(`@ngrx/store: The feature name "${ye}" does not exist in the state, therefore createFeatureSelector cannot access it.  Be sure it is imported in a loaded module using StoreModule.forRoot('${ye}', ...) or StoreModule.forFeature('${ye}', ...).  If the default state is intended to be undefined, as is the case with router state, this development-only warning message can be ignored.`),Dt},at=>at)}function zs(ye){return ye instanceof E.OlP?(0,E.f3M)(ye):ye}function pi(ye,at){return at.map((Dt,We)=>{if(ye[We]instanceof E.OlP){const zt=(0,E.f3M)(ye[We]);return{key:Dt.key,reducerFactory:zt.reducerFactory?zt.reducerFactory:Pi,metaReducers:zt.metaReducers?zt.metaReducers:[],initialState:zt.initialState}}return Dt})}function Vs(ye){return ye.map(at=>at instanceof E.OlP?(0,E.f3M)(at):at)}function co(ye){return"function"==typeof ye?ye():ye}function Ci(ye,at){return ye.concat(at)}function sa(){if((0,E.f3M)(vs,{optional:!0,skipSelf:!0}))throw new TypeError("The root Store has been provided more than once. Feature modules should provide feature states instead.");return"guarded"}function To(ye){Object.freeze(ye);const at=Pe(ye);return Object.getOwnPropertyNames(ye).forEach(Dt=>{if(!Dt.startsWith("\u0275")&&function Ht(ye,at){return Object.prototype.hasOwnProperty.call(ye,at)}(ye,Dt)&&(!at||"caller"!==Dt&&"callee"!==Dt&&"arguments"!==Dt)){const We=ye[Dt];(Oe(We)||Pe(We))&&!Object.isFrozen(We)&&To(We)}}),ye}function rs(ye,at=[]){return(Ga(ye)||be(ye))&&0===at.length?{path:["root"],value:ye}:Object.keys(ye).reduce((We,zt)=>{if(We)return We;const nn=ye[zt];return function tt(ye){return Pe(ye)&&ye.hasOwnProperty("\u0275cmp")}(nn)?We:!(Ga(nn)||be(nn)||function Te(ye){return"number"==typeof ye}(nn)||function _e(ye){return"boolean"==typeof ye}(nn)||function ie(ye){return"string"==typeof ye}(nn)||Q(nn))&&(function je(ye){if(!function Ze(ye){return Oe(ye)&&!Q(ye)}(ye))return!1;const at=Object.getPrototypeOf(ye);return at===Object.prototype||null===at}(nn)?rs(nn,[...at,zt]):{path:[...at,zt],value:nn})},!1)}function Uo(ye,at){if(!1===ye)return;const Dt=ye.path.join("."),We=new Error(`Detected unserializable ${at} at "${Dt}". ${Ei}#strict${at}serializability`);throw We.value=ye.value,We.unserializablePath=Dt,We}function Za(ye){return(0,E.X6Q)()?{strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!0,strictActionImmutability:!0,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1,...ye}:{strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!1,strictActionImmutability:!1,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1}}function ct({strictActionSerializability:ye,strictStateSerializability:at}){return Dt=>ye||at?function Rc(ye,at){return function(Dt,We){at.action(We)&&Uo(rs(We),"action");const zt=ye(Dt,We);return at.state()&&Uo(rs(zt),"state"),zt}}(Dt,{action:We=>ye&&!rr(We),state:()=>at}):Dt}function Us({strictActionImmutability:ye,strictStateImmutability:at}){return Dt=>ye||at?function Co(ye,at){return function(Dt,We){const zt=at.action(We)?To(We):We,nn=ye(Dt,zt);return at.state()?To(nn):nn}}(Dt,{action:We=>ye&&!rr(We),state:()=>at}):Dt}function rr(ye){return ye.type.startsWith("@ngrx")}function Cr({strictActionWithinNgZone:ye}){return at=>ye?function os(ye,at){return function(Dt,We){if(at.action(We)&&!E.R0b.isInAngularZone())throw new Error(`Action '${We.type}' running outside NgZone. ${Ei}#strictactionwithinngzone`);return ye(Dt,We)}}(at,{action:Dt=>ye&&!rr(Dt)}):at}function Jl(ye){return[{provide:ai,useValue:ye},{provide:yn,useFactory:Vd,deps:[ai]},{provide:On,deps:[yn],useFactory:Za},{provide:vt,multi:!0,deps:[On],useFactory:Us},{provide:vt,multi:!0,deps:[On],useFactory:ct},{provide:vt,multi:!0,deps:[On],useFactory:Cr}]}function jo(){return[{provide:Yn,multi:!0,deps:[On],useFactory:wa}]}function Vd(ye){return ye}function wa(ye){if(!ye.strictActionTypeUniqueness)return;const at=Object.entries(It).filter(([,Dt])=>Dt>1).map(([Dt])=>Dt);if(at.length)throw new Error(`Action types are registered more than once, ${at.map(Dt=>`"${Dt}"`).join(", ")}. ${Ei}#strictactiontypeuniqueness`)}function en(ye={},at={}){return[{provide:gi,useFactory:sa},{provide:cr,useValue:at.initialState},{provide:No,useFactory:co,deps:[cr]},{provide:yr,useValue:ye},{provide:st,useExisting:ye instanceof E.OlP?ye:yr},{provide:Si,deps:[yr,[new E.tBr(st)]],useFactory:zs},{provide:yt,useValue:at.metaReducers?at.metaReducers:[]},{provide:dn,deps:[vt,yt],useFactory:Ci},{provide:ia,useValue:at.reducerFactory?at.reducerFactory:Pi},{provide:Wn,deps:[ia,dn],useFactory:Bs},ui,ii,Hr,ao,Hi,Jl(at.runtimeChecks),jo()]}function mo(ye,at,Dt={}){return[{provide:Mt,multi:!0,useValue:ye instanceof Object?{}:Dt},{provide:ra,multi:!0,useValue:{key:ye instanceof Object?ye.name:ye,reducerFactory:Dt instanceof E.OlP||!Dt.reducerFactory?Pi:Dt.reducerFactory,metaReducers:Dt instanceof E.OlP||!Dt.metaReducers?[]:Dt.metaReducers,initialState:Dt instanceof E.OlP||!Dt.initialState?void 0:Dt.initialState}},{provide:Et,deps:[Mt,ra],useFactory:pi},{provide:dt,multi:!0,useValue:ye instanceof Object?ye.reducer:at},{provide:Zt,multi:!0,useExisting:at instanceof E.OlP?at:dt},{provide:_t,multi:!0,deps:[dt,[new E.tBr(Zt)]],useFactory:Vs},jo()]}let bl=(()=>{var ye;class at{constructor(We,zt,nn,Zn,dr,Yi){}}return(ye=at).\u0275fac=function(We){return new(We||ye)(E.LFG(Kt),E.LFG(wo),E.LFG(si),E.LFG(vs),E.LFG(gi,8),E.LFG(Yn,8))},ye.\u0275mod=E.oAB({type:ye}),ye.\u0275inj=E.cJS({}),at})(),Ea=(()=>{var ye;class at{constructor(We,zt,nn,Zn,dr){this.features=We,this.featureReducers=zt,this.reducerManager=nn;const Yi=We.map((Tn,wn)=>{const as=zt.shift()[wn];return{...Tn,reducers:as,initialState:co(Tn.initialState)}});nn.addFeatures(Yi)}ngOnDestroy(){this.reducerManager.removeFeatures(this.features)}}return(ye=at).\u0275fac=function(We){return new(We||ye)(E.LFG(Et),E.LFG(_t),E.LFG($n),E.LFG(bl),E.LFG(Yn,8))},ye.\u0275mod=E.oAB({type:ye}),ye.\u0275inj=E.cJS({}),at})(),xs=(()=>{var ye;class at{static forRoot(We,zt){return{ngModule:bl,providers:[...en(We,zt)]}}static forFeature(We,zt,nn={}){return{ngModule:Ea,providers:[...mo(We,zt,nn)]}}}return(ye=at).\u0275fac=function(We){return new(We||ye)},ye.\u0275mod=E.oAB({type:ye}),ye.\u0275inj=E.cJS({}),at})();function or(...ye){return{reducer:ye.pop(),types:ye.map(We=>We.type)}}function ss(ye,...at){const Dt=new Map;for(const We of at)for(const zt of We.types){const nn=Dt.get(zt);Dt.set(zt,nn?(dr,Yi)=>We.reducer(nn(dr,Yi),Yi):We.reducer)}return function(We=ye,zt){const nn=Dt.get(zt.type);return nn?nn(We,zt):We}}},7582:(Ue,Ie,ne)=>{"use strict";function Qe(st,dt,Mt,Et){return new(Mt||(Mt=Promise))(function(_t,yt){function vt(ai){try{yn(Et.next(ai))}catch(On){yt(On)}}function dn(ai){try{yn(Et.throw(ai))}catch(On){yt(On)}}function yn(ai){ai.done?_t(ai.value):function Zt(_t){return _t instanceof Mt?_t:new Mt(function(yt){yt(_t)})}(ai.value).then(vt,dn)}yn((Et=Et.apply(st,dt||[])).next())})}function it(st){return this instanceof it?(this.v=st,this):new it(st)}function Ne(st,dt,Mt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Zt,Et=Mt.apply(st,dt||[]),_t=[];return Zt={},yt("next"),yt("throw"),yt("return"),Zt[Symbol.asyncIterator]=function(){return this},Zt;function yt(Yn){Et[Yn]&&(Zt[Yn]=function(ji){return new Promise(function(so,Pi){_t.push([Yn,ji,so,Pi])>1||vt(Yn,ji)})})}function vt(Yn,ji){try{!function dn(Yn){Yn.value instanceof it?Promise.resolve(Yn.value.v).then(yn,ai):On(_t[0][2],Yn)}(Et[Yn](ji))}catch(so){On(_t[0][3],so)}}function yn(Yn){vt("next",Yn)}function ai(Yn){vt("throw",Yn)}function On(Yn,ji){Yn(ji),_t.shift(),_t.length&&vt(_t[0][0],_t[0][1])}}function $t(st){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Mt,dt=st[Symbol.asyncIterator];return dt?dt.call(st):(st=function Ot(st){var dt="function"==typeof Symbol&&Symbol.iterator,Mt=dt&&st[dt],Et=0;if(Mt)return Mt.call(st);if(st&&"number"==typeof st.length)return{next:function(){return st&&Et>=st.length&&(st=void 0),{value:st&&st[Et++],done:!st}}};throw new TypeError(dt?"Object is not iterable.":"Symbol.iterator is not defined.")}(st),Mt={},Et("next"),Et("throw"),Et("return"),Mt[Symbol.asyncIterator]=function(){return this},Mt);function Et(_t){Mt[_t]=st[_t]&&function(yt){return new Promise(function(vt,dn){!function Zt(_t,yt,vt,dn){Promise.resolve(dn).then(function(yn){_t({value:yn,done:vt})},yt)}(vt,dn,(yt=st[_t](yt)).done,yt.value)})}}}ne.d(Ie,{FC:()=>Ne,KL:()=>$t,mG:()=>Qe,qq:()=>it}),"function"==typeof SuppressedError&&SuppressedError}},Ue=>{Ue(Ue.s=6368)}]);